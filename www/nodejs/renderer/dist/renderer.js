function _defineProperty2(nt,rt,it){return(rt=_toPropertyKey2(rt))in nt?Object.defineProperty(nt,rt,{value:it,enumerable:!0,configurable:!0,writable:!0}):nt[rt]=it,nt}function _toPropertyKey2(nt){var rt=_toPrimitive2(nt,"string");return"symbol"==typeof rt?rt:rt+""}function _toPrimitive2(nt,rt){if("object"!=typeof nt||!nt)return nt;var it=nt[Symbol.toPrimitive];if(void 0!==it){var at=it.call(nt,rt||"default");if("object"!=typeof at)return at;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===rt?String:Number)(nt)}var App=function(){"use strict";function noop$1(){}function run(nt){return nt()}function blank_object(){return Object.create(null)}function run_all(nt){nt.forEach(run)}function is_function(nt){return"function"==typeof nt}function safe_not_equal(nt,rt){return nt!=nt?rt==rt:nt!==rt||nt&&"object"==typeof nt||"function"==typeof nt}let nt,rt;function src_url_equal(rt,it){return rt===it||(nt||(nt=document.createElement("a")),nt.href=it,rt===nt.href)}function append(nt,rt){nt.appendChild(rt)}function insert(nt,rt,it){nt.insertBefore(rt,it||null)}function detach(nt){nt.parentNode&&nt.parentNode.removeChild(nt)}function element(nt){return document.createElement(nt)}function text(nt){return document.createTextNode(nt)}function space(){return text(" ")}function attr(nt,rt,it){null==it?nt.removeAttribute(rt):nt.getAttribute(rt)!==it&&nt.setAttribute(rt,it)}function set_style(nt,rt,it,at){null==it?nt.style.removeProperty(rt):nt.style.setProperty(rt,it,"")}class HtmlTag{constructor(nt=!1){_defineProperty2(this,"is_svg",!1),_defineProperty2(this,"e",void 0),_defineProperty2(this,"n",void 0),_defineProperty2(this,"t",void 0),_defineProperty2(this,"a",void 0),this.is_svg=nt,this.e=this.n=null}c(nt){this.h(nt)}m(nt,rt,it=null){this.e||(this.is_svg?this.e=function svg_element(nt){return document.createElementNS("http://www.w3.org/2000/svg",nt)}(rt.nodeName):this.e=element(11===rt.nodeType?"TEMPLATE":rt.nodeName),this.t="TEMPLATE"!==rt.tagName?rt:rt.content,this.c(nt)),this.i(it)}h(nt){this.e.innerHTML=nt,this.n=Array.from("TEMPLATE"===this.e.nodeName?this.e.content.childNodes:this.e.childNodes)}i(nt){for(let rt=0;rt<this.n.length;rt+=1)insert(this.t,this.n[rt],nt)}p(nt){this.d(),this.h(nt),this.i(this.a)}d(){this.n.forEach(detach)}}function set_current_component(nt){rt=nt}function onMount(nt){(function get_current_component(){if(!rt)throw new Error("Function called outside component initialization");return rt})().$$.on_mount.push(nt)}const it=[],at=[];let st=[];const ot=[],lt=Promise.resolve();let ut=!1;function add_render_callback(nt){st.push(nt)}const ct=new Set;let dt=0;function flush(){if(0!==dt)return;const nt=rt;do{try{for(;dt<it.length;){const nt=it[dt];dt++,set_current_component(nt),update(nt.$$)}}catch(nt){throw it.length=0,dt=0,nt}for(set_current_component(null),it.length=0,dt=0;at.length;)at.pop()();for(let nt=0;nt<st.length;nt+=1){const rt=st[nt];ct.has(rt)||(ct.add(rt),rt())}st.length=0}while(it.length);for(;ot.length;)ot.pop()();ut=!1,ct.clear(),set_current_component(nt)}function update(nt){if(null!==nt.fragment){nt.update(),run_all(nt.before_update);const rt=nt.dirty;nt.dirty=[-1],nt.fragment&&nt.fragment.p(nt.ctx,rt),nt.after_update.forEach(add_render_callback)}}const ht=new Set;let pt;function transition_in(nt,rt){nt&&nt.i&&(ht.delete(nt),nt.i(rt))}function transition_out(nt,rt,it,at){if(nt&&nt.o){if(ht.has(nt))return;ht.add(nt),pt.c.push((()=>{ht.delete(nt)})),nt.o(rt)}}function ensure_array_like(nt){return void 0!==(null==nt?void 0:nt.length)?nt:Array.from(nt)}function destroy_block(nt,rt){nt.d(1),rt.delete(nt.key)}function update_keyed_each(nt,rt,it,at,st,ot,lt,ut,ct,dt,ht,pt){let _t=nt.length,Et=ot.length,St=_t;const wt={};for(;St--;)wt[nt[St].key]=St;const Lt=[],Ct=new Map,Pt=new Map,kt=[];for(St=Et;St--;){const nt=pt(st,ot,St),at=it(nt);let ut=lt.get(at);ut?kt.push((()=>ut.p(nt,rt))):(ut=dt(at,nt),ut.c()),Ct.set(at,Lt[St]=ut),at in wt&&Pt.set(at,Math.abs(St-wt[at]))}const Ot=new Set,Ft=new Set;function insert(nt){transition_in(nt,1),nt.m(ut,ht),lt.set(nt.key,nt),ht=nt.first,Et--}for(;_t&&Et;){const rt=Lt[Et-1],it=nt[_t-1],at=rt.key,st=it.key;rt===it?(ht=rt.first,_t--,Et--):Ct.has(st)?!lt.has(at)||Ot.has(at)?insert(rt):Ft.has(st)?_t--:Pt.get(at)>Pt.get(st)?(Ft.add(at),insert(rt)):(Ot.add(st),_t--):(ct(it,lt),_t--)}for(;_t--;){const rt=nt[_t];Ct.has(rt.key)||ct(rt,lt)}for(;Et;)insert(Lt[Et-1]);return run_all(kt),Lt}function create_component(nt){nt&&nt.c()}function mount_component(nt,rt,it){const{fragment:at,after_update:st}=nt.$$;at&&at.m(rt,it),add_render_callback((()=>{const rt=nt.$$.on_mount.map(run).filter(is_function);nt.$$.on_destroy?nt.$$.on_destroy.push(...rt):run_all(rt),nt.$$.on_mount=[]})),st.forEach(add_render_callback)}function destroy_component(nt,rt){const it=nt.$$;null!==it.fragment&&(!function flush_render_callbacks(nt){const rt=[],it=[];st.forEach((at=>-1===nt.indexOf(at)?rt.push(at):it.push(at))),it.forEach((nt=>nt())),st=rt}(it.after_update),run_all(it.on_destroy),it.fragment&&it.fragment.d(rt),it.on_destroy=it.fragment=null,it.ctx=[])}function make_dirty(nt,rt){-1===nt.$$.dirty[0]&&(it.push(nt),function schedule_update(){ut||(ut=!0,lt.then(flush))}(),nt.$$.dirty.fill(0)),nt.$$.dirty[rt/31|0]|=1<<rt%31}function init(nt,it,at,st,ot,lt,ut=null,ct=[-1]){const dt=rt;set_current_component(nt);const ht=nt.$$={fragment:null,ctx:[],props:lt,update:noop$1,not_equal:ot,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(it.context||(dt?dt.$$.context:[])),callbacks:blank_object(),dirty:ct,skip_bound:!1,root:it.target||dt.$$.root};ut&&ut(ht.root);let pt=!1;if(ht.ctx=at?at(nt,it.props||{},((rt,it,...at)=>{const st=at.length?at[0]:it;return ht.ctx&&ot(ht.ctx[rt],ht.ctx[rt]=st)&&(!ht.skip_bound&&ht.bound[rt]&&ht.bound[rt](st),pt&&make_dirty(nt,rt)),it})):[],ht.update(),pt=!0,run_all(ht.before_update),ht.fragment=!!st&&st(ht.ctx),it.target){if(it.hydrate){const nt=function children(nt){return Array.from(nt.childNodes)}(it.target);ht.fragment&&ht.fragment.l(nt),nt.forEach(detach)}else ht.fragment&&ht.fragment.c();it.intro&&transition_in(nt.$$.fragment),mount_component(nt,it.target,it.anchor),flush()}set_current_component(dt)}class SvelteComponent{constructor(){_defineProperty2(this,"$$",void 0),_defineProperty2(this,"$$set",void 0)}$destroy(){destroy_component(this,1),this.$destroy=noop$1}$on(nt,rt){if(!is_function(rt))return noop$1;const it=this.$$.callbacks[nt]||(this.$$.callbacks[nt]=[]);return it.push(rt),()=>{const nt=it.indexOf(rt);-1!==nt&&it.splice(nt,1)}}$set(nt){this.$$set&&!function is_empty(nt){return 0===Object.keys(nt).length}(nt)&&(this.$$.skip_bound=!0,this.$$set(nt),this.$$.skip_bound=!1)}}function EventHandlers(){}function EventEmitter$1(){EventEmitter$1.init.call(this)}function $getMaxListeners(nt){return void 0===nt._maxListeners?EventEmitter$1.defaultMaxListeners:nt._maxListeners}function _addListener(nt,rt,it,at){var st,ot,lt;if("function"!=typeof it)throw new TypeError('"listener" argument must be a function');if((ot=nt._events)?(ot.newListener&&(nt.emit("newListener",rt,it.listener?it.listener:it),ot=nt._events),lt=ot[rt]):(ot=nt._events=new EventHandlers,nt._eventsCount=0),lt){if("function"==typeof lt?lt=ot[rt]=at?[it,lt]:[lt,it]:at?lt.unshift(it):lt.push(it),!lt.warned&&(st=$getMaxListeners(nt))&&st>0&&lt.length>st){lt.warned=!0;var ut=new Error("Possible EventEmitter memory leak detected. "+lt.length+" "+rt+" listeners added. Use emitter.setMaxListeners() to increase limit");ut.name="MaxListenersExceededWarning",ut.emitter=nt,ut.type=rt,ut.count=lt.length,function emitWarning(nt){"function"==typeof console.warn?console.warn(nt):console.log(nt)}(ut)}}else lt=ot[rt]=it,++nt._eventsCount;return nt}function _onceWrap(nt,rt,it){var at=!1;function g(){nt.removeListener(rt,g),at||(at=!0,it.apply(nt,arguments))}return g.listener=it,g}function listenerCount(nt){var rt=this._events;if(rt){var it=rt[nt];if("function"==typeof it)return 1;if(it)return it.length}return 0}function arrayClone(nt,rt){for(var it=new Array(rt);rt--;)it[rt]=nt[rt];return it}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4"),EventHandlers.prototype=Object.create(null),EventEmitter$1.EventEmitter=EventEmitter$1,EventEmitter$1.usingDomains=!1,EventEmitter$1.prototype.domain=void 0,EventEmitter$1.prototype._events=void 0,EventEmitter$1.prototype._maxListeners=void 0,EventEmitter$1.defaultMaxListeners=10,EventEmitter$1.init=function(){this.domain=null,EventEmitter$1.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new EventHandlers,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter$1.prototype.setMaxListeners=function setMaxListeners(nt){if("number"!=typeof nt||nt<0||isNaN(nt))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=nt,this},EventEmitter$1.prototype.getMaxListeners=function getMaxListeners(){return $getMaxListeners(this)},EventEmitter$1.prototype.emit=function emit(nt){var rt,it,at,st,ot,lt,ut,ct="error"===nt;if(lt=this._events)ct=ct&&null==lt.error;else if(!ct)return!1;if(ut=this.domain,ct){if(rt=arguments[1],!ut){if(rt instanceof Error)throw rt;var dt=new Error('Uncaught, unspecified "error" event. ('+rt+")");throw dt.context=rt,dt}return rt||(rt=new Error('Uncaught, unspecified "error" event')),rt.domainEmitter=this,rt.domain=ut,rt.domainThrown=!1,ut.emit("error",rt),!1}if(!(it=lt[nt]))return!1;var ht="function"==typeof it;switch(at=arguments.length){case 1:!function emitNone(nt,rt,it){if(rt)nt.call(it);else for(var at=nt.length,st=arrayClone(nt,at),ot=0;ot<at;++ot)st[ot].call(it)}(it,ht,this);break;case 2:!function emitOne(nt,rt,it,at){if(rt)nt.call(it,at);else for(var st=nt.length,ot=arrayClone(nt,st),lt=0;lt<st;++lt)ot[lt].call(it,at)}(it,ht,this,arguments[1]);break;case 3:!function emitTwo(nt,rt,it,at,st){if(rt)nt.call(it,at,st);else for(var ot=nt.length,lt=arrayClone(nt,ot),ut=0;ut<ot;++ut)lt[ut].call(it,at,st)}(it,ht,this,arguments[1],arguments[2]);break;case 4:!function emitThree(nt,rt,it,at,st,ot){if(rt)nt.call(it,at,st,ot);else for(var lt=nt.length,ut=arrayClone(nt,lt),ct=0;ct<lt;++ct)ut[ct].call(it,at,st,ot)}(it,ht,this,arguments[1],arguments[2],arguments[3]);break;default:for(st=new Array(at-1),ot=1;ot<at;ot++)st[ot-1]=arguments[ot];!function emitMany(nt,rt,it,at){if(rt)nt.apply(it,at);else for(var st=nt.length,ot=arrayClone(nt,st),lt=0;lt<st;++lt)ot[lt].apply(it,at)}(it,ht,this,st)}return!0},EventEmitter$1.prototype.addListener=function addListener(nt,rt){return _addListener(this,nt,rt,!1)},EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener,EventEmitter$1.prototype.prependListener=function prependListener(nt,rt){return _addListener(this,nt,rt,!0)},EventEmitter$1.prototype.once=function once(nt,rt){if("function"!=typeof rt)throw new TypeError('"listener" argument must be a function');return this.on(nt,_onceWrap(this,nt,rt)),this},EventEmitter$1.prototype.prependOnceListener=function prependOnceListener(nt,rt){if("function"!=typeof rt)throw new TypeError('"listener" argument must be a function');return this.prependListener(nt,_onceWrap(this,nt,rt)),this},EventEmitter$1.prototype.removeListener=function removeListener(nt,rt){var it,at,st,ot,lt;if("function"!=typeof rt)throw new TypeError('"listener" argument must be a function');if(!(at=this._events))return this;if(!(it=at[nt]))return this;if(it===rt||it.listener&&it.listener===rt)0==--this._eventsCount?this._events=new EventHandlers:(delete at[nt],at.removeListener&&this.emit("removeListener",nt,it.listener||rt));else if("function"!=typeof it){for(st=-1,ot=it.length;ot-- >0;)if(it[ot]===rt||it[ot].listener&&it[ot].listener===rt){lt=it[ot].listener,st=ot;break}if(st<0)return this;if(1===it.length){if(it[0]=void 0,0==--this._eventsCount)return this._events=new EventHandlers,this;delete at[nt]}else!function spliceOne(nt,rt){for(var it=rt,at=it+1,st=nt.length;at<st;it+=1,at+=1)nt[it]=nt[at];nt.pop()}(it,st);at.removeListener&&this.emit("removeListener",nt,lt||rt)}return this},EventEmitter$1.prototype.removeAllListeners=function removeAllListeners(nt){var rt,it;if(!(it=this._events))return this;if(!it.removeListener)return 0===arguments.length?(this._events=new EventHandlers,this._eventsCount=0):it[nt]&&(0==--this._eventsCount?this._events=new EventHandlers:delete it[nt]),this;if(0===arguments.length){for(var at,st=Object.keys(it),ot=0;ot<st.length;++ot)"removeListener"!==(at=st[ot])&&this.removeAllListeners(at);return this.removeAllListeners("removeListener"),this._events=new EventHandlers,this._eventsCount=0,this}if("function"==typeof(rt=it[nt]))this.removeListener(nt,rt);else if(rt)do{this.removeListener(nt,rt[rt.length-1])}while(rt[0]);return this},EventEmitter$1.prototype.listeners=function listeners(nt){var rt,it=this._events;return it&&(rt=it[nt])?"function"==typeof rt?[rt.listener||rt]:function unwrapListeners(nt){for(var rt=new Array(nt.length),it=0;it<rt.length;++it)rt[it]=nt[it].listener||nt[it];return rt}(rt):[]},EventEmitter$1.listenerCount=function(nt,rt){return"function"==typeof nt.listenerCount?nt.listenerCount(rt):listenerCount.call(nt,rt)},EventEmitter$1.prototype.listenerCount=listenerCount,EventEmitter$1.prototype.eventNames=function eventNames(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};class EnergySavingController extends EventEmitter$1{constructor(nt){super(),this.main=nt,this.active=!1}start(){!this.active&&this.main.config["timeout-secs-energy-saving"]&&(this.active=!0,this.emit("start"))}end(){this.active&&(this.active=!1,this.emit("end"))}}class Idle extends EventEmitter$1{constructor(nt){super(nt),this.main=nt,this.timeout=5e3,this.awayTimeout=1e4,this.lastIdleTime=Date.now()/1e3,this.idle=!1,this.idleTimer=0,this.awayTimer=0,this.reset(),this.energySaver=new EnergySavingController(this.main),this.main.on("streamer-connect",(()=>this.reset())),this.main.on("streamer-disconnect",(()=>this.reset())),this.main.on("config",(()=>{this.setTimeoutAwayState(this.main.config["timeout-secs-energy-saving"])})),["focus","mousemove","mousedown","touchstart","touchmove","keyup","play"].forEach((nt=>{window.addEventListener(nt,(()=>{setTimeout((()=>this.reset()),400)}))})),window.addEventListener("blur",(()=>this.start()))}setTimeoutAwayState(nt){nt>5?(this.timeout=5e3,this.awayTimeout=1e3*nt-this.timeout):nt?(this.timeout=1e3*Math.min(5,nt),this.awayTimeout=0):(this.timeout=5e3,this.awayTimeout=null),this.reset()}reset(){if(!this.locked){var nt=parseInt(Date.now()/1e3);if(nt<=this.lastResetTime)return;this.isAway=!1,this.lastResetTime=nt,clearTimeout(this.awayTimer),clearTimeout(this.idleTimer),this.idle&&(this.lastIdleTime=nt,this.isIdle=this.idle=!1,this.isAway=!1,this.emit("active")),this.idleTimer=setTimeout((()=>this.start()),this.timeout)}}start(){this.locked||this.idle||(this.idleTime=Date.now()/1e3,this.isIdle=this.idle=!0,this.emit("idle"),"number"==typeof this.awayTimeout&&(this.idleTimer=setTimeout((()=>this.away()),this.awayTimeout)))}away(){this.idle&&(this.isAway=!0,this.emit("away"))}lock(nt){this.lockTimer&&clearTimeout(this.lockTimer),this.locked=!0,this.lockTimer=setTimeout((()=>{this.locked=!1}),1e3*nt)}}const _t=new class BridgeClient extends EventEmitter$1{constructor(){super(),this.config={},this.lang={},this.isReady={renderer:!1,main:!1},this.localEmit=(...nt)=>{try{super.emit(...nt)}catch(rt){console.error(rt,nt)}},this.on("get-lang",(()=>this.channelGetLangCallback())),this.on("lang",(nt=>{this.lang=nt})),this.on("config",((nt,rt)=>{this.config=rt})),this.once("renderer",(()=>{this.isReady.renderer=!0})),this.once("main-ready",((nt,rt)=>{this.isReady.main=!0,this.config=nt,this.localEmit("lang",rt),this.localEmit("config",Object.keys(nt),nt)})),window.capacitor?this.configureAndroidChannel():this.configureElectronChannel(),this.channelGetLangCallback(),this.idle=new Idle(this)}configureAndroidChannel(){const nt=this;this.channel=new class CapacitorChannel extends EventEmitter$1{constructor(){super(),this.originalEmit=this.emit.bind(this),this.emit=(...nt)=>{window.capacitor.NodeJS.whenReady().then((()=>{window.capacitor.NodeJS.send({eventName:"message",args:nt})})).catch(console.error)}}connect(){this.connected||(window.capacitor.NodeJS.addListener("message",(({args:rt})=>{nt.localEmit(...rt)})),this.connected=!0)}post(nt,rt){this.connect(),this.emit(...rt)}},window.plugins.megacubo.on("suspend",(nt=>{window.player&&player.emit("app-pause",!nt),_t.emit("suspend"),capacitor.KeepAwake.allowSleep()})),capacitor.App.addListener("appStateChange",(({isActive:nt})=>{nt&&(window.player&&player.emit("app-resume"),_t.emit("resume"),capacitor.KeepAwake.keepAwake())})),capacitor.KeepAwake.keepAwake()}configureElectronChannel(){const nt=this;this.channel=new class ElectronChannel extends EventEmitter$1{constructor(){super(),this.originalEmit=this.emit.bind(this),this.emit=(...nt)=>parent.api.window.emit(...nt),this.connect()}connect(){this.connected||(parent.api.window.on("message",(rt=>nt.localEmit(...rt))),this.connected=!0)}post(nt,rt){this.connect(),this.emit(...rt)}}}channelGetLangCallback(){const nt=window.navigator.userLanguage||window.navigator.language;this.emit("get-lang-callback",nt,{name:window.Intl.DateTimeFormat().resolvedOptions().timeZone,minutes:-1*(new Date).getTimezoneOffset()},window.navigator.userAgent,window.navigator.onLine)}emit(...nt){this.channel.post("message",Array.from(nt))}waitMain(nt){if(!0===this.isReady.main)return nt();this.once("main-ready",nt)}waitRenderer(nt){if(!0===this.isReady.renderer)return nt();this.once("renderer",nt)}};class MediaPlayerAdapter extends EventEmitter$1{constructor(nt){super(),this.container=nt,this.active=!1}setState(nt,rt){this.state!=nt&&(this.state=nt,this.suspendStateChangeReporting||this.emit("state",nt,rt))}setVars(nt,rt,it,at,st){this.currentSrc=nt,this.currentMimetype=rt,this.currentAdditionalSubtitles=it,this.cookie=at,this.mediatype=st}reload(nt){const rt=this.time(),{currentSrc:it,currentMimetype:at,currentAdditionalSubtitles:st,cookie:ot,mediatype:lt}=this;this.suspendStateChangeReporting=!0,this.unload(),setTimeout((()=>{this.suspendStateChangeReporting=!1,this.setState("loading"),this.load(it,at,st,ot,lt),rt&&"live"==this.mediatype&&this.time(rt+.5),nt&&nt()}),10)}}class MediaPlayerAdapterHTML5 extends MediaPlayerAdapter{constructor(nt){super(nt),this.lastSeenTime=0,this.state="",this._ratio=0,this.hasReceivedRatio=!1,this.uiVisibility=!0,this.currentSrc="",this.currentMimetype=""}setup(nt){console.log("adapter setup"),this.object=this.container.querySelector(nt),this.recycle(),this.patchPauseFn()}patchPauseFn(){void 0===this.object._pause&&(this.object._pause=this.object.pause,this.object.pause=()=>{})}uiVisible(nt){this.uiVisibility=nt}connect(){this.object.currentTime=0,this.object.textTracks.addEventListener("change",(()=>this.emit("subtitleTracks",this.subtitleTracks()))),this.object.addEventListener("click",(nt=>{let rt=nt.target||nt.srcElement;rt.tagName&&rt.tagName.toLowerCase()==tag&&this.emit("click")}));const onerr=nt=>{this.object.error&&(nt=this.object.error);const rt=this.time(),it=nt?String(nt.message?nt.message:nt):"unknown error",at=this.object.error||3==this.object.networkState||this.object.readyState<2||it.match(new RegExp("(pipeline_error|demuxer)","i"));if(console.error("Video error",rt,this.errorsCount,nt,it,this.object.networkState+", "+this.object.readyState,at),at)if(this.errorsCount++,this.errorsCount>=(rt>0?20:2))this.emit("error",String(nt.message||nt),!0),this.setState("");else{const nt=this.errorsCount;this.reload((()=>{this.errorsCount=nt}))}};if(this.currentMimetype.match(new RegExp("(mpegts|mpegurl)","i")))this.object.addEventListener("error",(()=>setTimeout((()=>this.object.error&&onerr()),10)));else{this.object.addEventListener("error",onerr);const nt=this.object.querySelector("source");nt&&nt.addEventListener("error",onerr)}this.object.addEventListener("ended",(nt=>{console.log("video ended",nt),this.emit("ended",String(nt))})),this.object.addEventListener("timeupdate",(nt=>{this.emit("timeupdate",this.object.currentTime),"loading"===this.state&&this.processState()})),this.object.addEventListener("durationchange",(nt=>{this.object.duration&&this.duration!=this.object.duration&&(this.duration=this.object.duration,this.duration&&this.errorsCount&&(this.errorsCount=0)),this.emit("durationchange")})),this.object.addEventListener("loadedmetadata",(nt=>{if(this.object.videoHeight){let nt=this.object.videoWidth/this.object.videoHeight;nt>0&&!this.hasReceivedRatio&&(this.hasReceivedRatio=!0,this.emit("setup-ratio",nt)),this.ratio(nt)}this.emit("audioTracks",this.audioTracks()),this.emit("subtitleTracks",this.subtitleTracks())})),this.object.addEventListener("waiting",(()=>{this.setState("loading")})),this.object.addEventListener("playing",(()=>{this.setState("playing")})),["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","seeked","stalled","suspend"].forEach((nt=>{this.object.addEventListener(nt,this.processState.bind(this))})),this.processState()}disconnect(){this.recycle()}recycle(){if(this.object.parentNode&&this.object.getAttribute("src")){const nt=this.object.volume;this.object&&(this.object.pause(),this.object.removeAttribute("src"),this.object.load());const rt=document.createElement("video");rt.autoplay=!0,this.object.replaceWith(rt),this.object.parentNode&&this.object.parentNode.removeChild(this.object),this.object=rt,this.object.volume=nt,this.patchPauseFn()}}recycle(){const nt=this.object.parentNode;if(nt){const rt=this.object.volume;this.object.pause(),this.object.removeAttribute("src"),this.object.load();const it=this.object.cloneNode(!1);it.autoplay=!0,nt.removeChild(this.object),nt.appendChild(it),this.object=it,this.object.volume=rt,this.patchPauseFn()}}setTextTracks(nt,rt){const it=nt.querySelectorAll("track");for(var at=0;at<it.length;at++)nt.removeChild(it[at]);rt&&rt.split("§").forEach(((rt,it)=>{const at=document.createElement("track");at.kind="captions",at.src=rt,0==it&&(at.mode="showing",at.enabled=!0);const st=new URL(rt),ot=st.searchParams.get("lang"),lt=st.searchParams.get("label");ot&&(at.srclang=ot),lt&&(at.label=lt),nt.appendChild(at)}))}disableTextTracks(){for(let nt=0;nt<this.object.textTracks.length;nt++)this.object.textTracks.mode="disabled";const nt=this.object.querySelectorAll("track");for(var rt=0;rt<nt.length;rt++)this.object.removeChild(nt[rt])}addTextTrack(nt){if(this.object.readyState<2){const listener=()=>{this.addTextTrack(nt),this.object.removeEventListener("loadedmetadata",listener)};return this.object.addEventListener("loadedmetadata",listener)}this.disableTextTracks();const rt=document.createElement("track");rt.kind="captions",rt.label=nt.name||"English",rt.srclang=nt.language||"en",rt.enabled=!0,rt.src=nt.url,rt.mode="showing",rt.addEventListener("load",(()=>rt.mode="showing")),this.object.appendChild(rt),this.object.textTracks[0].mode="showing"}load(nt,rt,it,at,st){this.setVars(nt,rt,it,at,st),this._paused=!1,this.setState("loading"),this.suspendStateChangeReporting=!0,this.unload(!0),this.active=!0,console.log("adapter load"),this.setTextTracks(this.object,it),this.object.src=nt,this.connect(),this.object.load(),this._paused=!1,this.setState("loading"),this.suspendStateChangeReporting=!1,this.resume(),console.log("adapter resume",this.object.outerHTML,nt,rt)}unload(){console.log("adapter unload"),this.hasReceivedRatio=!1,this.active&&(this.active=!1,this.disconnect(),this.object.currentSrc&&(this.pause(),this._paused=!1,this.object.innerHTML='<source type="video/mp4" src="" />',this.object.removeAttribute("src"),this.object.load()))}resume(){this._paused=!1;let nt=this.object.play();nt&&nt.catch((nt=>{this.active&&console.error(nt,nt.message,this.object.networkState,this.object.readyState)}))}pause(){this._paused=!0,this.object&&this.object._pause&&this.object._pause()}restart(){this.time(0),this.resume()}time(nt){return"number"==typeof nt&&(this.object.currentTime=nt),this.object.currentTime}ratio(nt){if("number"==typeof nt){let rt,it,at,st;window.innerWidth<window.innerHeight?(st=!0,at=window.innerHeight/window.innerWidth):at=window.innerWidth/window.innerHeight,it=at>nt,console.log("ratiochange",it,this.ratioDirection,at,nt,this._ratio),void 0!==this.ratioDirection&&this.ratioDirection==it&&nt==this._ratio&&st==this.inPortrait||(this.inPortrait=st,this._ratio=nt,this.ratioDirection=it,rt=this.inPortrait?"player > div { width: 100vw; height: calc(100vw / "+this._ratio+") !important; }":this.ratioDirection?"player > div { height: 100vh; width: calc(100vh * "+this._ratio+") !important; }":"player > div { width: 100vw; height: calc(100vw / "+this._ratio+") !important; }",this.ratioCSS||(this.ratioCSS=document.createElement("style")),this.ratioCSS.innerText="",this.ratioCSS.appendChild(document.createTextNode(rt)),document.querySelector("head, body").appendChild(this.ratioCSS),console.log("ratioupdated",this.inPortrait))}return this._ratio}playbackRate(nt){return"number"==typeof nt&&(this.object.playbackRate=nt),this.object.playbackRate}videoRatio(){return this.object.videoWidth?this.object.videoWidth/this.object.videoHeight:1.7777777777777777}processState(){var nt="";this.active&&(this.object.paused?!0===this._paused?nt="paused":(nt="loading",this.resume()):this.object.readyState<4?(this.lastSeenTime=this.object.currentTime,nt="loading"):nt="playing"),this.setState(nt)}volume(nt){"number"==typeof nt&&(this.object.volume=nt/100)}audioTracks(){return this.formatTracks(this.object.audioTracks)}audioTrack(nt){for(let rt=0;rt<this.object.audioTracks.length;rt++){const it=rt==nt||this.object.audioTracks[rt].id==nt;this.object.audioTracks[rt].enabled=it}}subtitleTracks(){return this.formatTracks(this.object.textTracks)}subtitleTrack(nt){if(this.object.textTracks)for(let rt=0;rt<this.object.textTracks.length;rt++){const it=rt==nt||this.object.textTracks[rt].id==nt;this.object.textTracks[rt].enabled=it,this.object.textTracks[rt].mode=it?"showing":"disabled"}}formatTracks(nt,rt){if(!nt||"object"!=typeof nt)return[];Array.isArray(nt)||(nt=Array.from(nt));const it=["id","lang","language","enabled","label","name"];return nt.map(((nt,at)=>{const st={};for(const rt of it)nt[rt]&&(st[rt]=nt[rt]);return void 0===st.id&&(st.id=at),void 0!==rt&&rt==st.id&&(st.enabled=!0),st}))}destroy(){console.log("adapter destroy"),this.pause(),this.unload(),this.object=null,this.removeAllListeners()}}class MediaPlayerAdapterHTML5Video extends MediaPlayerAdapterHTML5{constructor(nt){super(nt),this.setup("video")}}class MediaPlayerAdapterHTML5Audio extends MediaPlayerAdapterHTML5{constructor(nt){super(nt),this.setup("audio")}}class MediaPlayerAdapterAndroidNative extends MediaPlayerAdapter{constructor(nt){super(nt),this.object=window.plugins.megacubo||{},this.state="",this.duration=0,this.currentTime=0,this.hasReceivedRatio=!1,this.aspectRatio=1.7777777777777777,this.object.on("ratio",(nt=>{console.log("RECEIVED RATIO",nt),nt.ratio>0&&!this.hasReceivedRatio&&(this.hasReceivedRatio=!0,this.emit("setup-ratio",nt.ratio))})),this.object.on("state",(nt=>{nt!=this.state&&("paused"!=nt||this.duration||(nt="loading"),this.state=nt,this.suspendStateChangeReporting||this.emit("state",this.state))})),this.object.on("timeupdate",(()=>{this.active&&(this.currentTime=this.object.currentTime,this.emit("timeupdate",this.object.currentTime))})),this.object.on("durationchange",(()=>{this.duration=this.object.duration,this.emit("durationchange")})),this.object.on("audioTracks",(nt=>{this.emit("audioTracks",nt)})),this.object.on("subtitleTracks",(nt=>{this.emit("subtitleTracks",nt)})),this.object.on("error",((nt,rt)=>{console.log("Error: ",nt,"data:",rt),this.errorCallback(nt)}))}uiVisible(nt){this.object.uiVisible(nt)}load(nt,rt,it,at,st){this.setVars(nt,rt,it,at,st),this.active=!0,this.currentTime=0,this.duration=0,this.state="loading",this.mediatype=st,this.emit("state",this.state),this.object.play(nt,rt,it,at,st,this.successCallback.bind(this),this.errorCallback.bind(this))}successCallback(){console.warn("exoplayer success",arguments)}errorCallback(...nt){console.error("exoplayer err",nt),this.emit("error",nt.length?nt[0]:"Exoplayer error",!0),this.state="",this.emit("state","")}unload(){this.hasReceivedRatio=!1,this.active=!1,this.object.stop()}resume(){this.object.resume()}pause(){this.object.pause()}restart(){this.time(0),this.resume()}time(nt){return"number"==typeof nt&&(this.currentTime=nt,this.object.seek(nt)),this.currentTime}ratio(nt){return"number"==typeof nt&&this.object.ratio(nt),this.object.aspectRatio}playbackRate(nt){return"number"==typeof nt&&(console.warn("SET PLAYBACK RATE",nt),this.object.setPlaybackRate(nt)),this.object.playbackRate}videoRatio(){return this.object.aspectRatio}volume(nt){this.object.volume(nt)}audioTrack(nt){return this.object.audioTrack(nt)}audioTracks(){return this.object.audioTracks()}subtitleTrack(nt){return this.object.subtitleTrack(nt)}subtitleTracks(){return this.object.subtitleTracks()}addTextTrack(){}destroy(){this.unload(),this.removeAllListeners()}}function getDefaultExportFromCjs$1(nt){return nt&&nt.__esModule&&Object.prototype.hasOwnProperty.call(nt,"default")?nt.default:nt}var Et={exports:{}};self,Et.exports=function(){var nt={4593:function(nt,rt){var it,at,st,ot,lt,l=function(nt){for(var rt=[],it=0;it<nt.length;++it){var at=nt.charCodeAt(it);at<128?rt.push(at):at<2048?(rt.push(192|at>>6),rt.push(128|63&at)):at<65536?(rt.push(224|at>>12),rt.push(128|63&at>>6),rt.push(128|63&at)):(rt.push(240|at>>18),rt.push(128|63&at>>12),rt.push(128|63&at>>6),rt.push(128|63&at))}return rt},c=function(nt){for(var rt=[],it=0;it<nt.length;){var at=nt[it++];at<128||(at<224?(at=(31&at)<<6,at|=63&nt[it++]):at<240?(at=(15&at)<<12,at|=(63&nt[it++])<<6,at|=63&nt[it++]):(at=(7&at)<<18,at|=(63&nt[it++])<<12,at|=(63&nt[it++])<<6,at|=63&nt[it++])),rt.push(String.fromCharCode(at))}return rt.join("")},ut={};it="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",at=function(nt){for(var rt=0,at=[],st=0|nt.length/3;0<st--;){var ot=(nt[rt]<<16)+(nt[rt+1]<<8)+nt[rt+2];rt+=3,at.push(it.charAt(63&ot>>18)),at.push(it.charAt(63&ot>>12)),at.push(it.charAt(63&ot>>6)),at.push(it.charAt(63&ot))}return 2==nt.length-rt?(ot=(nt[rt]<<16)+(nt[rt+1]<<8),at.push(it.charAt(63&ot>>18)),at.push(it.charAt(63&ot>>12)),at.push(it.charAt(63&ot>>6)),at.push("=")):1==nt.length-rt&&(ot=nt[rt]<<16,at.push(it.charAt(63&ot>>18)),at.push(it.charAt(63&ot>>12)),at.push("==")),at.join("")},st=function(){for(var nt=[],rt=0;rt<it.length;++rt)nt[it.charCodeAt(rt)]=rt;return nt["=".charCodeAt(0)]=0,nt}(),ot=function(nt){for(var rt=0,it=[],at=0|nt.length/4;0<at--;){var ot=(st[nt.charCodeAt(rt)]<<18)+(st[nt.charCodeAt(rt+1)]<<12)+(st[nt.charCodeAt(rt+2)]<<6)+st[nt.charCodeAt(rt+3)];it.push(255&ot>>16),it.push(255&ot>>8),it.push(255&ot),rt+=4}return it&&("="==nt.charAt(rt-2)?(it.pop(),it.pop()):"="==nt.charAt(rt-1)&&it.pop()),it},lt={encode:function(nt){for(var rt=[],it=0;it<nt.length;++it)rt.push(nt.charCodeAt(it));return rt},decode:function(nt){for(var rt=0;rt<s.length;++rt)a[rt]=String.fromCharCode(a[rt]);return a.join("")}},ut.decodeArray=function(nt){var rt=ot(nt);return new Uint8Array(rt)},ut.encodeASCII=function(nt){var rt=lt.encode(nt);return at(rt)},ut.decodeASCII=function(nt){var rt=ot(nt);return lt.decode(rt)},ut.encode=function(nt){var rt=l(nt);return at(rt)},ut.decode=function(nt){var rt=ot(nt);return c(rt)},rt.decode=ut.decode,rt.decodeArray=ut.decodeArray,rt.encode=ut.encode,rt.encodeASCII=ut.encodeASCII},452:function(nt,rt){!function(nt){var rt={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},n=function(nt){var it=nt;return rt.hasOwnProperty(nt)&&(it=rt[nt]),String.fromCharCode(it)},it=15,at=32,st={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},ot={17:2,18:4,21:6,22:8,23:10,19:13,20:15},lt={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ut={25:2,26:4,29:6,30:8,31:10,27:13,28:15},ct=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],dt={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(nt){this.time=nt},log:function(nt,rt){var it=this.verboseFilter[nt];this.verboseLevel>=it&&console.log(this.time+" ["+nt+"] "+rt)}},f=function(nt){for(var rt=[],it=0;it<nt.length;it++)rt.push(nt[it].toString(16));return rt},d=function(nt,rt,it,at,st){this.foreground=nt||"white",this.underline=rt||!1,this.italics=it||!1,this.background=at||"black",this.flash=st||!1};d.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(nt){for(var rt=["foreground","underline","italics","background","flash"],it=0;it<rt.length;it++){var at=rt[it];nt.hasOwnProperty(at)&&(this[at]=nt[at])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(nt){return this.foreground===nt.foreground&&this.underline===nt.underline&&this.italics===nt.italics&&this.background===nt.background&&this.flash===nt.flash},copy:function(nt){this.foreground=nt.foreground,this.underline=nt.underline,this.italics=nt.italics,this.background=nt.background,this.flash=nt.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var g=function(nt,rt,it,at,st,ot){this.uchar=nt||" ",this.penState=new d(rt,it,at,st,ot)};g.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(nt,rt){this.uchar=nt,this.penState.copy(rt)},setPenState:function(nt){this.penState.copy(nt)},equals:function(nt){return this.uchar===nt.uchar&&this.penState.equals(nt.penState)},copy:function(nt){this.uchar=nt.uchar,this.penState.copy(nt.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};var h=function(){this.chars=[];for(var nt=0;nt<at;nt++)this.chars.push(new g);this.pos=0,this.currPenState=new d};h.prototype={equals:function(nt){for(var rt=!0,it=0;it<at;it++)if(!this.chars[it].equals(nt.chars[it])){rt=!1;break}return rt},copy:function(nt){for(var rt=0;rt<at;rt++)this.chars[rt].copy(nt.chars[rt])},isEmpty:function(){for(var nt=!0,rt=0;rt<at;rt++)if(!this.chars[rt].isEmpty()){nt=!1;break}return nt},setCursor:function(nt){this.pos!==nt&&(this.pos=nt),this.pos<0?(dt.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>at&&(dt.log("ERROR","Too large cursor position "+this.pos),this.pos=at)},moveCursor:function(nt){var rt=this.pos+nt;if(nt>1)for(var it=this.pos+1;it<rt+1;it++)this.chars[it].setPenState(this.currPenState);this.setCursor(rt)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(nt){nt>=144&&this.backSpace();var rt=n(nt);this.pos>=at?dt.log("ERROR","Cannot insert "+nt.toString(16)+" ("+rt+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(rt,this.currPenState),this.moveCursor(1))},clearFromPos:function(nt){var rt;for(rt=nt;rt<at;rt++)this.chars[rt].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var nt=[],rt=!0,it=0;it<at;it++){var st=this.chars[it].uchar;" "!==st&&(rt=!1),nt.push(st)}return rt?"":nt.join("")},setPenStyles:function(nt){this.currPenState.setStyles(nt),this.chars[this.pos].setPenState(this.currPenState)}};var p=function(){this.rows=[];for(var nt=0;nt<it;nt++)this.rows.push(new h);this.currRow=14,this.nrRollUpRows=null,this.reset()};p.prototype={reset:function(){for(var nt=0;nt<it;nt++)this.rows[nt].clear();this.currRow=14},equals:function(nt){for(var rt=!0,at=0;at<it;at++)if(!this.rows[at].equals(nt.rows[at])){rt=!1;break}return rt},copy:function(nt){for(var rt=0;rt<it;rt++)this.rows[rt].copy(nt.rows[rt])},isEmpty:function(){for(var nt=!0,rt=0;rt<it;rt++)if(!this.rows[rt].isEmpty()){nt=!1;break}return nt},backSpace:function(){this.rows[this.currRow].backSpace()},clearToEndOfRow:function(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function(nt){this.rows[this.currRow].insertChar(nt)},setPen:function(nt){this.rows[this.currRow].setPenStyles(nt)},moveCursor:function(nt){this.rows[this.currRow].moveCursor(nt)},setCursor:function(nt){dt.log("INFO","setCursor: "+nt),this.rows[this.currRow].setCursor(nt)},setPAC:function(nt){dt.log("INFO","pacData = "+JSON.stringify(nt));var rt=nt.row-1;this.nrRollUpRows&&rt<this.nrRollUpRows-1&&(rt=this.nrRollUpRows-1),this.currRow=rt;var it=this.rows[this.currRow];if(null!==nt.indent){var at=nt.indent,st=Math.max(at-1,0);it.setCursor(nt.indent),nt.color=it.chars[st].penState.foreground}var ot={foreground:nt.color,underline:nt.underline,italics:nt.italics,background:"black",flash:!1};this.setPen(ot)},setBkgData:function(nt){dt.log("INFO","bkgData = "+JSON.stringify(nt)),this.backSpace(),this.setPen(nt),this.insertChar(32)},setRollUpRows:function(nt){this.nrRollUpRows=nt},rollUp:function(){if(null!==this.nrRollUpRows){dt.log("TEXT",this.getDisplayText());var nt=this.currRow+1-this.nrRollUpRows,rt=this.rows.splice(nt,1)[0];rt.clear(),this.rows.splice(this.currRow,0,rt),dt.log("INFO","Rolling up")}else dt.log("DEBUG","roll_up but nrRollUpRows not set yet")},getDisplayText:function(nt){nt=nt||!1;for(var rt=[],at="",st=-1,ot=0;ot<it;ot++){var lt=this.rows[ot].getTextString();lt&&(st=ot+1,nt?rt.push("Row "+st+': "'+lt+'"'):rt.push(lt.trim()))}return rt.length>0&&(at=nt?"["+rt.join(" | ")+"]":rt.join("\n")),at},getTextAndFormat:function(){return this.rows}};var m=function(nt,rt){this.chNr=nt,this.outputFilter=rt,this.mode=null,this.verbose=0,this.displayedMemory=new p,this.nonDisplayedMemory=new p,this.lastOutputScreen=new p,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};m.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(nt){this.outputFilter=nt},setPAC:function(nt){this.writeScreen.setPAC(nt)},setBkgData:function(nt){this.writeScreen.setBkgData(nt)},setMode:function(nt){nt!==this.mode&&(this.mode=nt,dt.log("INFO","MODE="+nt),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=nt)},insertChars:function(nt){for(var rt=0;rt<nt.length;rt++)this.writeScreen.insertChar(nt[rt]);var it=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";dt.log("INFO",it+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(dt.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){dt.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){dt.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){dt.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(nt){dt.log("INFO","RU("+nt+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(nt)},cc_FON:function(){dt.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){dt.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){dt.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){dt.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){dt.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){dt.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){dt.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(dt.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var nt=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=nt,this.writeScreen=this.nonDisplayedMemory,dt.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(nt){dt.log("INFO","TO("+nt+") - Tab Offset"),this.writeScreen.moveCursor(nt)},cc_MIDROW:function(nt){var rt={flash:!1};if(rt.underline=nt%2==1,rt.italics=nt>=46,rt.italics)rt.foreground="white";else{var it=Math.floor(nt/2)-16;rt.foreground=["white","green","blue","cyan","red","yellow","magenta"][it]}dt.log("INFO","MIDROW: "+JSON.stringify(rt)),this.writeScreen.setPen(rt)},outputDataUpdate:function(){var nt=dt.time;null!==nt&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(nt,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,nt,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:nt):this.cueStartTime=nt,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(nt){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,nt,this.displayedMemory),this.cueStartTime=nt))}};var y=function(nt,rt,it){this.field=nt||1,this.outputs=[rt,it],this.channels=[new m(1,rt),new m(2,it)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};y.prototype={getHandler:function(nt){return this.channels[nt].getHandler()},setHandler:function(nt,rt){this.channels[nt].setHandler(rt)},addData:function(nt,rt){var it,at,st,ot=!1;this.lastTime=nt,dt.setTime(nt);for(var lt=0;lt<rt.length;lt+=2)at=127&rt[lt],st=127&rt[lt+1],at>=16&&at<=31&&at===this.lastCmdA&&st===this.lastCmdB?(this.lastCmdA=null,this.lastCmdB=null,dt.log("DEBUG","Repeated command ("+f([at,st])+") is dropped")):0!==at||0!==st?(dt.log("DATA","["+f([rt[lt],rt[lt+1]])+"] -> ("+f([at,st])+")"),(it=this.parseCmd(at,st))||(it=this.parseMidrow(at,st)),it||(it=this.parsePAC(at,st)),it||(it=this.parseBackgroundAttributes(at,st)),it||(ot=this.parseChars(at,st))&&(this.currChNr&&this.currChNr>=0?this.channels[this.currChNr-1].insertChars(ot):dt.log("WARNING","No channel found yet. TEXT-MODE?")),it?this.dataCounters.cmd+=2:ot?this.dataCounters.char+=2:(this.dataCounters.other+=2,dt.log("WARNING","Couldn't parse cleaned data "+f([at,st])+" orig: "+f([rt[lt],rt[lt+1]])))):this.dataCounters.padding+=2},parseCmd:function(nt,rt){var it;if(!((20===nt||21===nt||28===nt||29===nt)&&32<=rt&&rt<=47||(23===nt||31===nt)&&33<=rt&&rt<=35))return!1;it=20===nt||21===nt||23===nt?1:2;var at=this.channels[it-1];return 20===nt||21===nt||28===nt||29===nt?32===rt?at.cc_RCL():33===rt?at.cc_BS():34===rt?at.cc_AOF():35===rt?at.cc_AON():36===rt?at.cc_DER():37===rt?at.cc_RU(2):38===rt?at.cc_RU(3):39===rt?at.cc_RU(4):40===rt?at.cc_FON():41===rt?at.cc_RDC():42===rt?at.cc_TR():43===rt?at.cc_RTD():44===rt?at.cc_EDM():45===rt?at.cc_CR():46===rt?at.cc_ENM():47===rt&&at.cc_EOC():at.cc_TO(rt-32),this.lastCmdA=nt,this.lastCmdB=rt,this.currChNr=it,!0},parseMidrow:function(nt,rt){var it=null;if((17===nt||25===nt)&&32<=rt&&rt<=47){if((it=17===nt?1:2)!==this.currChNr)return dt.log("ERROR","Mismatch channel in midrow parsing"),!1;var at=this.channels[it-1];return at.insertChars([32]),at.cc_MIDROW(rt),dt.log("DEBUG","MIDROW ("+f([nt,rt])+")"),this.lastCmdA=nt,this.lastCmdB=rt,!0}return!1},parsePAC:function(nt,rt){var it,at;if(!((17<=nt&&nt<=23||25<=nt&&nt<=31)&&64<=rt&&rt<=127||(16===nt||24===nt)&&64<=rt&&rt<=95))return!1;it=nt<=23?1:2,at=64<=rt&&rt<=95?1===it?st[nt]:lt[nt]:1===it?ot[nt]:ut[nt];var ct=this.interpretPAC(at,rt);return this.channels[it-1].setPAC(ct),this.lastCmdA=nt,this.lastCmdB=rt,this.currChNr=it,!0},interpretPAC:function(nt,rt){var it,at={color:null,italics:!1,indent:null,underline:!1,row:nt};return it=rt>95?rt-96:rt-64,at.underline=!(1&~it),it<=13?at.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(it/2)]:it<=15?(at.italics=!0,at.color="white"):at.indent=4*Math.floor((it-16)/2),at},parseChars:function(nt,rt){var it,at=null,st=null,ot=null;if(nt>=25?(at=2,ot=nt-8):(at=1,ot=nt),17<=ot&&ot<=19?(it=17===ot?rt+80:18===ot?rt+112:rt+144,dt.log("INFO","Special char '"+n(it)+"' in channel "+at),st=[it],this.lastCmdA=nt,this.lastCmdB=rt):32<=nt&&nt<=127&&(st=0===rt?[nt]:[nt,rt],this.lastCmdA=null,this.lastCmdB=null),st){var lt=f(st);dt.log("DEBUG","Char codes =  "+lt.join(","))}return st},parseBackgroundAttributes:function(nt,rt){var it,at,st;return((16===nt||24===nt)&&32<=rt&&rt<=47||(23===nt||31===nt)&&45<=rt&&rt<=47)&&(it={},16===nt||24===nt?(at=Math.floor((rt-32)/2),it.background=ct[at],rt%2==1&&(it.background=it.background+"_semi")):45===rt?it.background="transparent":(it.foreground="black",47===rt&&(it.underline=!0)),st=nt<24?1:2,this.channels[st-1].setBkgData(it),this.lastCmdA=nt,this.lastCmdB=rt,!0)},reset:function(){for(var nt=0;nt<this.channels.length;nt++)this.channels[nt]&&this.channels[nt].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(nt){for(var rt=0;rt<this.channels.length;rt++)this.channels[rt]&&this.channels[rt].cueSplitAtTime(nt)}},nt.logger=dt,nt.PenState=d,nt.CaptionScreen=p,nt.Cea608Parser=y,nt.findCea608Nalus=function(nt,rt,it){for(var at=0,st=rt,ot=[],o=function(nt,rt,it,at){if(4!==nt||rt<8)return null;var st=it.getUint8(at),ot=it.getUint16(at+1),lt=it.getUint32(at+3),ut=it.getUint8(at+7);return 181==st&&49==ot&&1195456820==lt&&3==ut};st<rt+it;){if(at=nt.getUint32(st),6==(31&nt.getUint8(st+4)))for(var lt=st+5,ut=-1;lt<st+4+at-1;){ut=0;for(var ct=255;255===ct;)ut+=ct=nt.getUint8(lt),lt++;var dt=0;for(ct=255;255===ct;)dt+=ct=nt.getUint8(lt),lt++;o(ut,dt,nt,lt)&&ot.push([lt,dt]),lt+=dt}st+=at+4}return ot},nt.extractCea608DataFromRange=function(nt,rt){var it=rt[0],at=[[],[]];it+=8;var st=31&nt.getUint8(it);it+=2;for(var ot=0;ot<st;ot++){var lt=nt.getUint8(it),ut=4&lt,ct=3&lt;it++;var dt=nt.getUint8(it);it++;var ht=nt.getUint8(it);it++,ut&&(127&dt)+(127&ht)!=0&&(0===ct?(at[0].push(dt),at[0].push(ht)):1===ct&&(at[1].push(dt),at[1].push(ht)))}return at}}(rt)},8416:function(nt,rt,it){var at=it(1139),st=it(5448),ot=it(6398),lt=it(2032),ut=(it(5530),"undefined"!=typeof window&&window||it.g),ct=ut.dashjs;ct||(ct=ut.dashjs={}),ct.MediaPlayer=at.Z,ct.FactoryMaker=st.Z,ct.Debug=ot.Z,ct.Version=(0,lt.e)()},6398:function(nt,rt,it){var at=it(5595),st=it(8512),ot=it(5448),lt=1,ut=2,ct=3,dt=4,ht=5;function f(nt){nt=nt||{};var rt,it,ot,pt,_t=this.context,Et=(0,at.Z)(_t).getInstance(),St=nt.settings,wt=[];function m(nt){return nt&&nt.bind?nt.bind(window.console):window.console.log.bind(window.console)}function y(){for(var nt=arguments.length,rt=new Array(nt),it=0;it<nt;it++)rt[it]=arguments[it];S.apply(void 0,[lt,this].concat(rt))}function E(){for(var nt=arguments.length,rt=new Array(nt),it=0;it<nt;it++)rt[it]=arguments[it];S.apply(void 0,[ut,this].concat(rt))}function v(){for(var nt=arguments.length,rt=new Array(nt),it=0;it<nt;it++)rt[it]=arguments[it];S.apply(void 0,[ct,this].concat(rt))}function _(){for(var nt=arguments.length,rt=new Array(nt),it=0;it<nt;it++)rt[it]=arguments[it];S.apply(void 0,[dt,this].concat(rt))}function T(){for(var nt=arguments.length,rt=new Array(nt),it=0;it<nt;it++)rt[it]=arguments[it];S.apply(void 0,[ht,this].concat(rt))}function S(nt,rt){var at="",lt=null;it&&(lt=(new Date).getTime(),at+="["+(lt-pt)+"]"),ot&&rt&&rt.getClassName&&(at+="["+rt.getClassName()+"]",rt.getType&&(at+="["+rt.getType()+"]")),at.length>0&&(at+=" ");for(var ut=arguments.length,ct=new Array(ut>2?ut-2:0),dt=2;dt<ut;dt++)ct[dt-2]=arguments[dt];Array.apply(null,ct).forEach((function(nt){at+=nt+" "})),wt[nt]&&St&&St.get().debug.logLevel>=nt&&wt[nt](at),St&&St.get().debug.dispatchEvent&&Et.trigger(st.Z.LOG,{message:at,level:nt})}return rt={getLogger:function(nt){return{fatal:y.bind(nt),error:E.bind(nt),warn:v.bind(nt),info:_.bind(nt),debug:T.bind(nt)}},setLogTimestampVisible:function(nt){it=nt},setCalleeNameVisible:function(nt){ot=nt}},it=!0,ot=!0,pt=(new Date).getTime(),"undefined"!=typeof window&&window.console&&(wt[lt]=m(window.console.error),wt[ut]=m(window.console.error),wt[ct]=m(window.console.warn),wt[dt]=m(window.console.info),wt[ht]=m(window.console.debug)),rt}f.__dashjs_factory_name="Debug";var pt=ot.Z.getSingletonFactory(f);pt.LOG_LEVEL_NONE=0,pt.LOG_LEVEL_FATAL=lt,pt.LOG_LEVEL_ERROR=ut,pt.LOG_LEVEL_WARNING=ct,pt.LOG_LEVEL_INFO=dt,pt.LOG_LEVEL_DEBUG=ht,ot.Z.updateSingletonFactory(f.__dashjs_factory_name,pt),rt.Z=pt},5595:function(nt,rt,it){var at=it(5448),st=it(8825);function a(){var nt={};function t(rt,it,at){var st=-1;return nt[rt]?(nt[rt].some((function(nt,rt){if(nt&&nt.callback===it&&(!at||at===nt.scope))return st=rt,!0})),st):st}var rt={on:function(rt,it,at){var st=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!rt)throw new Error("event type cannot be null or undefined");if(!it||"function"!=typeof it)throw new Error("listener must be a function: "+it);var ot=st.priority||0;if(!(t(rt,it,at)>=0)){nt[rt]=nt[rt]||[];var lt={callback:it,scope:at,priority:ot};at&&at.getStreamId&&(lt.streamId=at.getStreamId()),at&&at.getType&&(lt.mediaType=at.getType()),st&&st.mode&&(lt.mode=st.mode);var ut=nt[rt].some((function(it,at){if(it&&ot>it.priority)return nt[rt].splice(at,0,lt),!0}));ut||nt[rt].push(lt)}},off:function(rt,it,at){if(rt&&it&&nt[rt]){var st=t(rt,it,at);st<0||(nt[rt][st]=null)}},trigger:function(rt){var it=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},at=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(rt&&nt[rt]){if((it=it||{}).hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");it.type=rt,at.streamId&&(it.streamId=at.streamId),at.mediaType&&(it.mediaType=at.mediaType),nt[rt].filter((function(nt){return!(!nt||at.streamId&&nt.streamId&&nt.streamId!==at.streamId||at.mediaType&&nt.mediaType&&nt.mediaType!==at.mediaType||at.mode&&nt.mode&&nt.mode!==at.mode||!nt.mode&&at.mode&&at.mode===st.Z.EVENT_MODE_ON_RECEIVE)})).forEach((function(nt){return nt&&nt.callback.call(nt.scope,it)}))}},reset:function(){nt={}}};return rt}a.__dashjs_factory_name="EventBus";var ot=at.Z.getSingletonFactory(a);ot.EVENT_PRIORITY_LOW=0,ot.EVENT_PRIORITY_HIGH=5e3,at.Z.updateSingletonFactory(a.__dashjs_factory_name,ot),rt.Z=ot},5448:function(nt,rt){var it=function(){var nt,rt=[],it={},at={};function i(nt,it){for(var at in rt){var st=rt[at];if(st.context===nt&&st.name===it)return st.instance}return null}function a(nt,rt){return rt[nt]}function o(nt,rt,it){nt in it&&(it[nt]=rt)}function s(rt,it,at){var st,ot=rt.__dashjs_factory_name,lt=it[ot];if(lt){var ut=lt.instance;if(!lt.override)return ut.apply({context:it,factory:nt},at);for(var ct in st=rt.apply({context:it},at),ut=ut.apply({context:it,factory:nt,parent:st},at))st.hasOwnProperty(ct)&&(st[ct]=ut[ct])}else st=rt.apply({context:it},at);return st.getClassName=function(){return ot},st}return nt={extend:function(nt,rt,it,at){!at[nt]&&rt&&(at[nt]={instance:rt,override:it})},getSingletonInstance:i,setSingletonInstance:function(nt,it,at){for(var st in rt){var ot=rt[st];if(ot.context===nt&&ot.name===it)return void(rt[st].instance=at)}rt.push({name:it,context:nt,instance:at})},deleteSingletonInstances:function(nt){rt=rt.filter((function(rt){return rt.context!==nt}))},getSingletonFactory:function(nt){var at=a(nt.__dashjs_factory_name,it);return at||(at=function(it){var at;return void 0===it&&(it={}),{getInstance:function(){return at||(at=i(it,nt.__dashjs_factory_name)),at||(at=s(nt,it,arguments),rt.push({name:nt.__dashjs_factory_name,context:it,instance:at})),at}}},it[nt.__dashjs_factory_name]=at),at},getSingletonFactoryByName:function(nt){return a(nt,it)},updateSingletonFactory:function(nt,rt){o(nt,rt,it)},getClassFactory:function(nt){var rt=a(nt.__dashjs_factory_name,at);return rt||(rt=function(rt){return void 0===rt&&(rt={}),{create:function(){return s(nt,rt,arguments)}}},at[nt.__dashjs_factory_name]=rt),rt},getClassFactoryByName:function(nt){return a(nt,at)},updateClassFactory:function(nt,rt){o(nt,rt,at)}},nt}();rt.Z=it},1264:function(nt,rt,it){var at=it(5448),st=it(703),ot=it(6398),lt=it(3393),ut=it(7855),ct=it(5595),dt=it(8512);function c(nt){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},c(nt)}function f(nt,rt,it){return rt in nt?Object.defineProperty(nt,rt,{value:it,enumerable:!0,configurable:!0,writable:!0}):nt[rt]=it,nt}function d(){var nt,rt,it=this.context,at=(0,ct.Z)(it).getInstance(),ht={"streaming.delay.liveDelay":dt.Z.SETTING_UPDATED_LIVE_DELAY,"streaming.delay.liveDelayFragmentCount":dt.Z.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,"streaming.liveCatchup.enabled":dt.Z.SETTING_UPDATED_CATCHUP_ENABLED,"streaming.liveCatchup.playbackRate.min":dt.Z.SETTING_UPDATED_PLAYBACK_RATE_MIN,"streaming.liveCatchup.playbackRate.max":dt.Z.SETTING_UPDATED_PLAYBACK_RATE_MAX},pt={debug:{logLevel:ot.Z.LOG_LEVEL_WARNING,dispatchEvent:!1},streaming:{abandonLoadTimeout:1e4,wallclockTimeUpdateInterval:100,manifestUpdateRetryInterval:100,liveUpdateTimeThresholdInMilliseconds:0,cacheInitSegments:!1,applyServiceDescription:!0,applyProducerReferenceTime:!0,applyContentSteering:!0,eventControllerRefreshDelay:100,enableManifestDurationMismatchFix:!0,parseInbandPrft:!1,enableManifestTimescaleMismatchFix:!1,capabilities:{filterUnsupportedEssentialProperties:!0,useMediaCapabilitiesApi:!1},timeShiftBuffer:{calcFromSegmentTimeline:!1,fallbackToSegmentTimeline:!0},metrics:{maxListDepth:100},delay:{liveDelayFragmentCount:NaN,liveDelay:NaN,useSuggestedPresentationDelay:!0},protection:{keepProtectionMediaKeys:!1,ignoreEmeEncryptedEvent:!1,detectPlayreadyMessageFormat:!0},buffer:{enableSeekDecorrelationFix:!1,fastSwitchEnabled:!0,flushBufferAtTrackSwitch:!1,reuseExistingSourceBuffers:!0,bufferPruningInterval:10,bufferToKeep:20,bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:60,initialBufferLevel:NaN,stableBufferTime:12,longFormContentDurationThreshold:600,stallThreshold:.3,useAppendWindow:!0,setStallState:!0,avoidCurrentTimeRangePruning:!1,useChangeTypeForTrackSwitch:!0,mediaSourceDurationInfinity:!0,resetSourceBuffersForTrackSwitch:!1},gaps:{jumpGaps:!0,jumpLargeGaps:!0,smallGapLimit:1.5,threshold:.3,enableSeekFix:!0,enableStallFix:!1,stallSeek:.1},utcSynchronization:{enabled:!0,useManifestDateHeaderTimeSource:!0,backgroundAttempts:2,timeBetweenSyncAttempts:30,maximumTimeBetweenSyncAttempts:600,minimumTimeBetweenSyncAttempts:2,timeBetweenSyncAttemptsAdjustmentFactor:2,maximumAllowedDrift:100,enableBackgroundSyncAfterSegmentDownloadError:!0,defaultTimingSource:{scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"https://time.akamai.com/?iso&ms"}},scheduling:{defaultTimeout:500,lowLatencyTimeout:0,scheduleWhilePaused:!0},text:{defaultEnabled:!0,dispatchForManualRendering:!1,extendSegmentedCues:!0,imsc:{displayForcedOnlyMode:!1,enableRollUp:!0},webvtt:{customRenderingEnabled:!1}},liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN},playbackBufferMin:.5,enabled:null,mode:lt.Z.LIVE_CATCHUP_MODE_DEFAULT},lastBitrateCachingInfo:{enabled:!0,ttl:36e4},lastMediaSettingsCachingInfo:{enabled:!0,ttl:36e4},saveLastMediaSettingsForCurrentStreamingSession:!0,cacheLoadThresholds:{video:50,audio:5},trackSwitchMode:{audio:lt.Z.TRACK_SWITCH_MODE_ALWAYS_REPLACE,video:lt.Z.TRACK_SWITCH_MODE_NEVER_REPLACE},selectionModeForInitialTrack:lt.Z.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY,fragmentRequestTimeout:2e4,fragmentRequestProgressTimeout:-1,manifestRequestTimeout:1e4,retryIntervals:(nt={},f(nt,ut.w.MPD_TYPE,500),f(nt,ut.w.XLINK_EXPANSION_TYPE,500),f(nt,ut.w.MEDIA_SEGMENT_TYPE,1e3),f(nt,ut.w.INIT_SEGMENT_TYPE,1e3),f(nt,ut.w.BITSTREAM_SWITCHING_SEGMENT_TYPE,1e3),f(nt,ut.w.INDEX_SEGMENT_TYPE,1e3),f(nt,ut.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE,1e3),f(nt,ut.w.LICENSE,1e3),f(nt,ut.w.OTHER_TYPE,1e3),f(nt,"lowLatencyReductionFactor",10),nt),retryAttempts:(rt={},f(rt,ut.w.MPD_TYPE,3),f(rt,ut.w.XLINK_EXPANSION_TYPE,1),f(rt,ut.w.MEDIA_SEGMENT_TYPE,3),f(rt,ut.w.INIT_SEGMENT_TYPE,3),f(rt,ut.w.BITSTREAM_SWITCHING_SEGMENT_TYPE,3),f(rt,ut.w.INDEX_SEGMENT_TYPE,3),f(rt,ut.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE,3),f(rt,ut.w.LICENSE,3),f(rt,ut.w.OTHER_TYPE,3),f(rt,"lowLatencyMultiplyFactor",5),rt),abr:{movingAverageMethod:lt.Z.MOVING_AVERAGE_SLIDING_WINDOW,ABRStrategy:lt.Z.ABR_STRATEGY_DYNAMIC,additionalAbrRules:{insufficientBufferRule:!0,switchHistoryRule:!0,droppedFramesRule:!0,abandonRequestsRule:!0},abrRulesParameters:{abandonRequestsRule:{graceTimeThreshold:500,abandonMultiplier:1.8,minLengthToAverage:5}},bandwidthSafetyFactor:.9,useDefaultABRRules:!0,useDeadTimeLatency:!0,limitBitrateByPortal:!1,usePixelRatioInLimitBitrateByPortal:!1,maxBitrate:{audio:-1,video:-1},minBitrate:{audio:-1,video:-1},maxRepresentationRatio:{audio:1,video:1},initialBitrate:{audio:-1,video:-1},initialRepresentationRatio:{audio:-1,video:-1},autoSwitchBitrate:{audio:!0,video:!0},fetchThroughputCalculationMode:lt.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING},cmcd:{enabled:!1,sid:null,cid:null,rtp:null,rtpSafetyFactor:5,mode:lt.Z.CMCD_MODE_QUERY,enabledKeys:["br","d","ot","tb","bl","dl","mtp","nor","nrr","su","bs","rtp","cid","pr","sf","sid","st","v"]},cmsd:{enabled:!1,abr:{applyMb:!1,etpWeightRatio:0}}},errors:{recoverAttempts:{mediaErrorDecode:5}}},_t=st.Z.clone(pt);function p(nt,rt,it){for(var ot in nt)nt.hasOwnProperty(ot)&&(rt.hasOwnProperty(ot)?"object"!==c(nt[ot])||nt[ot]instanceof Array||null===nt[ot]?(rt[ot]=st.Z.clone(nt[ot]),ht[it+ot]&&at.trigger(ht[it+ot])):p(nt[ot],rt[ot],it.slice()+ot+"."):console.error("Settings parameter "+it+ot+" is not supported"))}return{get:function(){return _t},update:function(nt){"object"===c(nt)&&p(nt,_t,"")},reset:function(){_t=st.Z.clone(pt)}}}d.__dashjs_factory_name="Settings";var ht=at.Z.getSingletonFactory(d);rt.Z=ht},703:function(nt,rt,it){var at=it(3875),st=it.n(at),ot=it(1067);function o(nt){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},o(nt)}function s(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var lt=function(){function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e)}var nt;return nt=[{key:"mixin",value:function(nt,rt,it){var at,st={};if(nt)for(var ot in rt)rt.hasOwnProperty(ot)&&(at=rt[ot],ot in nt&&(nt[ot]===at||ot in st&&st[ot]===at)||("object"===o(nt[ot])&&null!==nt[ot]?nt[ot]=e.mixin(nt[ot],at,it):nt[ot]=it(at)));return nt}},{key:"clone",value:function(nt){if(!nt||"object"!==o(nt))return nt;var rt;if(nt instanceof Array){rt=[];for(var it=0,at=nt.length;it<at;++it)it in nt&&rt.push(e.clone(nt[it]))}else rt={};return e.mixin(rt,nt,e.clone)}},{key:"addAditionalQueryParameterToUrl",value:function(nt,rt){try{if(!rt||0===rt.length)return nt;var it=new URL(nt);return rt.forEach((function(nt){nt.key&&nt.value&&it.searchParams.set(nt.key,nt.value)})),it.href}catch(rt){return nt}}},{key:"parseHttpHeaders",value:function(nt){var rt={};if(!nt)return rt;for(var it=nt.trim().split("\r\n"),at=0,st=it.length;at<st;at++){var ot=it[at],lt=ot.indexOf(": ");lt>0&&(rt[ot.substring(0,lt)]=ot.substring(lt+2))}return rt}},{key:"generateUuid",value:function(){var nt=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(rt){var it=(nt+16*Math.random())%16|0;return nt=Math.floor(nt/16),("x"==rt?it:3&it|8).toString(16)}))}},{key:"generateHashCode",value:function(nt){var rt=0;if(0===nt.length)return rt;for(var it=0;it<nt.length;it++)rt=(rt<<5)-rt+nt.charCodeAt(it),rt|=0;return rt}},{key:"getRelativeUrl",value:function(nt,rt){try{var it=new URL(nt),at=new URL(rt);if(it.protocol=at.protocol,it.origin!==at.origin)return rt;var ot=st().relative(it.pathname.substr(0,it.pathname.lastIndexOf("/")),at.pathname.substr(0,at.pathname.lastIndexOf("/"))),lt=0===ot.length?1:0;return ot+=at.pathname.substr(at.pathname.lastIndexOf("/")+lt,at.pathname.length-1),at.pathname.length<ot.length?at.pathname:ot}catch(nt){return rt}}},{key:"parseUserAgent",value:function(){var nt=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{var rt=null===nt&&"undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"";return(0,ot.UAParser)(rt)}catch(nt){return{}}}},{key:"stringHasProtocol",value:function(nt){return/(http(s?)):\/\//i.test(nt)}}],nt&&s(e,nt),e}();rt.Z=lt},2032:function(nt,rt,it){function r(){return"4.7.4"}it.d(rt,{e:function(){return r}})},2230:function(nt,rt){function n(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var it=function(){function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e)}var nt;return(nt=[{key:"extend",value:function(nt,rt){if(nt){var it=!!rt&&rt.override,at=!!rt&&rt.publicOnly;for(var st in nt)!nt.hasOwnProperty(st)||this[st]&&!it||at&&-1===nt[st].indexOf("public_")||(this[st]=nt[st])}}}])&&n(e.prototype,nt),e}();rt.Z=it},4351:function(nt,rt,it){function r(nt){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},r(nt)}function i(nt,rt){return i=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},i(nt,rt)}function a(nt,rt){return!rt||"object"!==r(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function o(nt){return o=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},o(nt)}var at=function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&i(nt,rt)}(s,nt);var rt,it,at=(rt=s,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=o(rt);if(it){var st=o(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return a(this,nt)});function s(){var nt;return function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,s),(nt=at.call(this)).ATTEMPT_BACKGROUND_SYNC="attemptBackgroundSync",nt.BUFFERING_COMPLETED="bufferingCompleted",nt.BUFFER_CLEARED="bufferCleared",nt.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",nt.BUFFER_REPLACEMENT_STARTED="bufferReplacementStarted",nt.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",nt.CMSD_STATIC_HEADER="cmsdStaticHeader",nt.CURRENT_TRACK_CHANGED="currentTrackChanged",nt.DATA_UPDATE_COMPLETED="dataUpdateCompleted",nt.INBAND_EVENTS="inbandEvents",nt.INITIAL_STREAM_SWITCH="initialStreamSwitch",nt.INIT_FRAGMENT_LOADED="initFragmentLoaded",nt.INIT_FRAGMENT_NEEDED="initFragmentNeeded",nt.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",nt.ORIGINAL_MANIFEST_LOADED="originalManifestLoaded",nt.LOADING_COMPLETED="loadingCompleted",nt.LOADING_PROGRESS="loadingProgress",nt.LOADING_DATA_PROGRESS="loadingDataProgress",nt.LOADING_ABANDONED="loadingAborted",nt.MANIFEST_UPDATED="manifestUpdated",nt.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",nt.MEDIA_FRAGMENT_NEEDED="mediaFragmentNeeded",nt.QUOTA_EXCEEDED="quotaExceeded",nt.SEGMENT_LOCATION_BLACKLIST_ADD="segmentLocationBlacklistAdd",nt.SEGMENT_LOCATION_BLACKLIST_CHANGED="segmentLocationBlacklistChanged",nt.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD="serviceLocationBlacklistAdd",nt.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",nt.SERVICE_LOCATION_LOCATION_BLACKLIST_ADD="serviceLocationLocationBlacklistAdd",nt.SERVICE_LOCATION_LOCATION_BLACKLIST_CHANGED="serviceLocationLocationBlacklistChanged",nt.SET_FRAGMENTED_TEXT_AFTER_DISABLED="setFragmentedTextAfterDisabled",nt.SET_NON_FRAGMENTED_TEXT="setNonFragmentedText",nt.SOURCE_BUFFER_ERROR="sourceBufferError",nt.STREAMS_COMPOSED="streamsComposed",nt.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",nt.STREAM_REQUESTING_COMPLETED="streamRequestingCompleted",nt.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",nt.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",nt.UPDATE_TIME_SYNC_OFFSET="updateTimeSyncOffset",nt.URL_RESOLUTION_FAILED="urlResolutionFailed",nt.VIDEO_CHUNK_RECEIVED="videoChunkReceived",nt.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",nt.XLINK_ELEMENT_LOADED="xlinkElementLoaded",nt.XLINK_READY="xlinkReady",nt.SEEK_TARGET="seekTarget",nt.SETTING_UPDATED_LIVE_DELAY="settingUpdatedLiveDelay",nt.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT="settingUpdatedLiveDelayFragmentCount",nt.SETTING_UPDATED_CATCHUP_ENABLED="settingUpdatedCatchupEnabled",nt.SETTING_UPDATED_PLAYBACK_RATE_MIN="settingUpdatedPlaybackRateMin",nt.SETTING_UPDATED_PLAYBACK_RATE_MAX="settingUpdatedPlaybackRateMax",nt}return s}(it(8342).Z);rt.Z=at},8512:function(nt,rt,it){function r(nt){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},r(nt)}function i(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}function a(nt,rt){return a=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},a(nt,rt)}function o(nt,rt){return!rt||"object"!==r(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function s(nt){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},s(nt)}var at=function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&a(nt,rt)}(u,nt);var rt,it,at=(rt=u,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=s(rt);if(it){var st=s(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return o(this,nt)});function u(){return i(this,u),at.apply(this,arguments)}return u}(it(4351).Z),st=new at;rt.Z=st},8342:function(nt,rt){function n(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var it=function(){function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e)}var nt;return(nt=[{key:"extend",value:function(nt,rt){if(nt){var it=!!rt&&rt.override,at=!!rt&&rt.publicOnly;for(var st in nt)!nt.hasOwnProperty(st)||this[st]&&!it||at&&-1===nt[st].indexOf("public_")||(this[st]=nt[st])}}}])&&n(e.prototype,nt),e}();rt.Z=it},9326:function(nt,rt,it){var at=it(3186),st=it(7855),ot=it(5448),lt=it(8825),ut=it(7387),ct=it(1553);function l(nt){var rt,it,ot,dt,ht,pt=(nt=nt||{}).eventBus,_t=nt.debug,Et=nt.urlUtils,St=nt.type,wt=nt.streamInfo,Lt=nt.segmentsController,Ct=nt.timelineConverter,Pt=nt.baseURLController;function v(){return St}function _(){ot=null}function T(nt,rt,it){var at,st,ot=Pt.resolve(it.path),lt={};return ot&&rt!==ot.url&&Et.isRelative(rt)?(at=ot.url,st=ot.serviceLocation,lt=ot.queryParams,rt&&(at=Et.resolve(rt,at))):at=rt,!Et.isRelative(at)&&(nt.url=at,nt.serviceLocation=st,nt.queryParams=lt,!0)}function S(nt,rt){if(null==rt)return null;var it=new at.Z,ot=rt.representation,lt=ot.adaptation.period.mpd.manifest.Period_asArray[ot.adaptation.period.index].AdaptationSet_asArray[ot.adaptation.index].Representation_asArray[ot.index].bandwidth,ct=rt.media;return ct=(0,ut.vi)(ct,"Number",rt.replacementNumber),ct=(0,ut.vi)(ct,"Time",rt.replacementTime),ct=(0,ut.vi)(ct,"Bandwidth",lt),ct=(0,ut.Aj)(ct,ot.id),ct=(0,ut.eR)(ct),it.mediaType=v(),it.type=st.w.MEDIA_SEGMENT_TYPE,it.range=rt.mediaRange,it.startTime=rt.presentationStartTime,it.mediaStartTime=rt.mediaStartTime,it.duration=rt.duration,it.timescale=ot.timescale,it.availabilityStartTime=rt.availabilityStartTime,it.availabilityEndTime=rt.availabilityEndTime,it.availabilityTimeComplete=ot.availabilityTimeComplete,it.wallStartTime=rt.wallStartTime,it.quality=ot.index,it.index=rt.index,it.mediaInfo=nt,it.adaptationIndex=ot.adaptation.index,it.representationId=ot.id,T(it,ct,ot)?it:void 0}function b(nt,rt,at){var st=null;if(!rt||!rt.segmentInfoType)return st;var lt=Lt.getSegmentByTime(rt,at);return lt&&(ot=lt,it.debug("Index for time "+at+" is "+lt.index),st=S(nt,lt)),st}function A(nt,rt,at){var st=null,lt=Lt.getSegmentByIndex(rt,at,ot?ot.mediaStartTime:-1);if(lt)st=S(nt,lt),ot=lt;else{if(dt&&!ht)return it.debug(v()+" No segment found at index: "+at+". Wait for next loop"),null;ht=!0}return st}function I(){it.debug("Dynamic stream complete"),ht=!0}return rt={getCurrentIndex:function(){return ot?ot.index:-1},getInitRequest:function(nt,rt){return rt?function(nt,rt,it){var ot=new at.Z,lt=rt.adaptation.period,ct=lt.start;if(ot.mediaType=it,ot.type=st.w.INIT_SEGMENT_TYPE,ot.range=rt.range,ot.availabilityStartTime=Ct.calcAvailabilityStartTimeFromPresentationTime(ct,rt,dt),ot.availabilityEndTime=Ct.calcAvailabilityEndTimeFromPresentationTime(ct+lt.duration,rt,dt),ot.quality=rt.index,ot.mediaInfo=nt,ot.representationId=rt.id,T(ot,rt.initialization,rt))return ot.url=(0,ut.vi)(ot.url,"Bandwidth",rt.bandwidth),ot}(nt,rt,v()):null},getNextSegmentRequest:function(nt,rt){return rt&&rt.segmentInfoType?A(nt,rt,ot?ot.index+1:0):null},getNextSegmentRequestIdempotent:function(nt,rt){var it=ot?ot.index+1:0,at=Lt.getSegmentByIndex(rt,it,ot?ot.mediaStartTime:-1);return at?S(nt,at):null},getSegmentRequestForTime:b,getStreamId:function(){return wt.id},getStreamInfo:function(){return wt},getType:v,getValidTimeAheadOfTargetTime:function(nt,rt,it,at){try{if(isNaN(nt)||!rt||!it)return NaN;if(nt<0&&(nt=0),isNaN(at)&&(at=.5),b(rt,it,nt))return nt;if(it.adaptation.period.start+it.adaptation.period.duration<nt)return NaN;for(var st=isFinite(it.adaptation.period.duration)?it.adaptation.period.start+it.adaptation.period.duration:nt+30,ot=Math.min(nt+at,st),lt=NaN,ut=null;ot<=st;){var ct=null;if(ot<=st&&(ct=b(rt,it,ot)),ct){lt=ot,ut=ct;break}ot+=at}if(ut){var dt=ut.startTime+ut.duration;return nt>ut.startTime&&dt-nt>at?nt:!isNaN(ut.startTime)&&nt<ut.startTime&&lt>ut.startTime?ut.startTime+.001:Math.min(dt-at,lt)}return lt}catch(nt){return NaN}},initialize:function(nt){dt=nt,ht=!1,Lt.initialize(nt)},isLastSegmentRequested:function(nt,rt){if(!nt||!ot)return!1;if(ht)return!0;if(!isFinite(nt.adaptation.period.duration))return!1;if(ot.presentationStartTime+ot.duration>rt)return!1;if(nt.mediaFinishedInformation&&!isNaN(nt.mediaFinishedInformation.numberOfSegments)&&!isNaN(ot.index)&&ot.index>=nt.mediaFinishedInformation.numberOfSegments-1){if(!dt||nt.segmentInfoType===ct.Z.SEGMENT_TEMPLATE)return!0;if(dt&&nt.segmentInfoType===ct.Z.SEGMENT_LIST&&nt.adaptation.period.nextPeriodId)return!0}return!!(dt&&nt.adaptation.period.nextPeriodId&&nt.segmentInfoType===ct.Z.SEGMENT_TIMELINE&&nt.mediaFinishedInformation&&!isNaN(nt.mediaFinishedInformation.mediaTimeOfLastSignaledSegment)&&ot&&!isNaN(ot.mediaStartTime)&&!isNaN(ot.duration)&&ot.mediaStartTime+ot.duration>=nt.mediaFinishedInformation.mediaTimeOfLastSignaledSegment-.05)},repeatSegmentRequest:function(nt,rt){return rt&&rt.segmentInfoType?A(nt,rt,ot?ot.index:0):null},reset:function(){_(),pt.off(lt.Z.DYNAMIC_TO_STATIC,I,rt)}},it=_t.getLogger(rt),_(),pt.on(lt.Z.DYNAMIC_TO_STATIC,I,rt),rt}l.__dashjs_factory_name="DashHandler",rt.Z=ot.Z.getClassFactory(l)},1553:function(nt,rt){function n(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var it=new(function(){function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var nt;return(nt=[{key:"init",value:function(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.ESSENTIAL_PROPERTY_ASARRAY="EssentialProperty_asArray",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.SUPPLEMENTAL_PROPERTY_ASARRAY="SupplementalProperty_asArray",this.INBAND_EVENT_STREAM="InbandEventStream",this.PRODUCER_REFERENCE_TIME="ProducerReferenceTime",this.INBAND="inband",this.TYPE="type",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.VIEWPOINT_ASARRAY="Viewpoint_asArray",this.ROLE_ASARRAY="Role_asArray",this.REPRESENTATION_ASARRAY="Representation_asArray",this.PRODUCERREFERENCETIME_ASARRAY="ProducerReferenceTime_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.STATIC="static",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:priority",this.DVB_WEIGHT="dvb:weight",this.DVB_URL="dvb:url",this.DVB_MIMETYPE="dvb:mimeType",this.DVB_FONTFAMILY="dvb:fontFamily",this.SUGGESTED_PRESENTATION_DELAY="suggestedPresentationDelay",this.SERVICE_DESCRIPTION="ServiceDescription",this.SERVICE_DESCRIPTION_SCOPE="Scope",this.SERVICE_DESCRIPTION_LATENCY="Latency",this.SERVICE_DESCRIPTION_PLAYBACK_RATE="PlaybackRate",this.SERVICE_DESCRIPTION_OPERATING_QUALITY="OperatingQuality",this.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH="OperatingBandwidth",this.PATCH_LOCATION="PatchLocation",this.PATCH_LOCATION_AS_ARRAY="PatchLocation_asArray",this.LOCATION="Location",this.LOCATION_AS_ARRAY="Location_asArray",this.PUBLISH_TIME="publishTime",this.ORIGINAL_PUBLISH_TIME="originalPublishTime",this.ORIGINAL_MPD_ID="mpdId",this.WALL_CLOCK_TIME="wallClockTime",this.PRESENTATION_TIME="presentationTime",this.LABEL="Label",this.GROUP_LABEL="GroupLabel",this.CONTENT_STEERING="ContentSteering",this.CONTENT_STEERING_AS_ARRAY="ContentSteering_asArray",this.DEFAULT_SERVICE_LOCATION="defaultServiceLocation",this.QUERY_BEFORE_START="queryBeforeStart",this.CLIENT_REQUIREMENT="clientRequirement",this.TTL="ttl",this.CONTENT_STEERING_RESPONSE={VERSION:"VERSION",TTL:"TTL",RELOAD_URI:"RELOAD-URI",PATHWAY_PRIORITY:"PATHWAY-PRIORITY",PATHWAY_CLONES:"PATHWAY-CLONES",BASE_ID:"BASE-ID",ID:"ID",URI_REPLACEMENT:"URI-REPLACEMENT",HOST:"HOST",PARAMS:"PARAMS"},this.PRODUCER_REFERENCE_TIME_TYPE={ENCODER:"encoder",CAPTURED:"captured",APPLICATION:"application"},this.SEGMENT_ALIGNMENT="segmentAlignment",this.SUB_SEGMENT_ALIGNMENT="subsegmentAlignment"}}])&&n(e.prototype,nt),e}());rt.Z=it},7802:function(nt,rt,it){var at=it(5448),st=it(1724),ot=it(3636),lt=it(1736),ut=it(5246);function u(nt){nt=nt||{};var rt,it,at=this.context,ct=nt.dashConstants,dt=nt.type,ht=nt.segmentBaseController;function f(nt){return nt?nt.segments?it[ct.SEGMENT_BASE]:it[nt.segmentInfoType]:null}return rt={initialize:function(rt){it[ct.SEGMENT_TIMELINE]=(0,st.Z)(at).create(nt,rt),it[ct.SEGMENT_TEMPLATE]=(0,ot.Z)(at).create(nt,rt),it[ct.SEGMENT_LIST]=(0,lt.Z)(at).create(nt,rt),it[ct.SEGMENT_BASE]=(0,ut.Z)(at).create(nt,rt)},updateInitData:function(nt,rt){return rt?Promise.resolve():ht.getSegmentBaseInitSegment({representation:nt,mediaType:dt})},updateSegmentData:function(nt,rt){return rt?Promise.resolve():ht.getSegmentList({mimeType:nt.mimeType,representation:nt,mediaType:dt})},getSegmentByIndex:function(nt,rt,it){var at=f(nt);return at?at.getSegmentByIndex(nt,rt,it):null},getSegmentByTime:function(nt,rt){var it=f(nt);return it?it.getSegmentByTime(nt,rt):null},getMediaFinishedInformation:function(nt){var rt=f(nt);return rt?rt.getMediaFinishedInformation(nt):{numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN}}},it={},rt}u.__dashjs_factory_name="SegmentsController";var ct=at.Z.getClassFactory(u);rt.Z=ct},1736:function(nt,rt,it){var at=it(5448),st=it(3393),ot=it(7387);function o(nt,rt){var it=(nt=nt||{}).timelineConverter;function r(){if(!it||!it.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(st.Z.MISSING_CONFIG_ERROR)}function o(nt,at){if(r(),!nt)return null;var st=nt.adaptation.period.mpd.manifest.Period_asArray[nt.adaptation.period.index].AdaptationSet_asArray[nt.adaptation.index].Representation_asArray[nt.index].SegmentList,lt=st.SegmentURL_asArray.length,ut=nt&&!isNaN(nt.startNumber)?nt.startNumber:1,ct=Math.max(ut-1,0),dt=Math.max(at-ct,0),ht=null;if(dt<lt){var pt=st.SegmentURL_asArray[dt];(ht=(0,ot.NF)(it,rt,nt,at))&&(ht.replacementTime=(ut+at-1)*nt.segmentDuration,ht.media=pt.media?pt.media:"",ht.mediaRange=pt.mediaRange,ht.indexRange=pt.indexRange)}return ht}return{getSegmentByIndex:o,getSegmentByTime:function(nt,rt){if(r(),!nt)return null;var at=nt.segmentDuration;if(isNaN(at))return null;var st=it.calcPeriodRelativeTimeFromMpdRelativeTime(nt,rt);return o(nt,Math.floor(st/at))},getMediaFinishedInformation:function(nt){var rt={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!nt)return rt;var it=nt.adaptation.period.mpd.manifest.Period_asArray[nt.adaptation.period.index].AdaptationSet_asArray[nt.adaptation.index].Representation_asArray[nt.index].SegmentList,at=nt&&!isNaN(nt.startNumber)?nt.startNumber:1,st=Math.max(at-1,0);return rt.numberOfSegments=st+it.SegmentURL_asArray.length,rt}}}o.__dashjs_factory_name="ListSegmentsGetter";var lt=at.Z.getClassFactory(o);rt.Z=lt},5246:function(nt,rt,it){var at=it(5448),st=it(3393);function a(nt){var rt=(nt=nt||{}).timelineConverter;function n(){if(!rt||!rt.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(st.Z.MISSING_CONFIG_ERROR)}function r(nt,rt){if(n(),!nt)return null;var it,at=nt.segments?nt.segments.length:-1;if(rt<at&&(it=nt.segments[rt])&&it.index===rt)return it;for(var st=0;st<at;st++)if((it=nt.segments[st])&&it.index===rt)return it;return null}return{getSegmentByIndex:r,getSegmentByTime:function(nt,rt){n();var it=function(nt,rt){if(!nt)return-1;var it,at,st,ot,lt,ut=nt.segments,ct=ut?ut.length:null,dt=-1;if(ut&&ct>0)for(lt=0;lt<ct;lt++)if(st=(at=ut[lt]).presentationStartTime,rt+(it=(ot=at.duration)/2)>=st&&rt-it<st+ot){dt=at.index;break}return dt}(nt,rt);return r(nt,it)},getMediaFinishedInformation:function(nt){var rt={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};return nt&&nt.segments?(rt.numberOfSegments=nt.segments.length,rt):rt}}}a.__dashjs_factory_name="SegmentBaseGetter";var ot=at.Z.getClassFactory(a);rt.Z=ot},7387:function(nt,rt,it){it.d(rt,{Aj:function(){return o},NF:function(){return c},TJ:function(){return f},eR:function(){return a},vi:function(){return s}});var at=it(2011);function i(nt,rt){for(;nt.length<rt;)nt="0"+nt;return nt}function a(nt){return nt?nt.split("$$").join("$"):nt}function o(nt,rt){if(!rt||!nt||-1===nt.indexOf("$RepresentationID$"))return nt;var it=rt.toString();return nt.split("$RepresentationID$").join(it)}function s(nt,rt,it){var at,st,ot,lt,ut,ct,dt=rt.length,ht=2;if(!nt)return nt;for(;;){if((at=nt.indexOf("$"+rt))<0)return nt;if((st=nt.indexOf("$",at+dt))<0)return nt;if((ot=nt.indexOf("%0",at+dt))>at&&ot<st)switch(lt=nt.charAt(st-1),ut=parseInt(nt.substring(ot+ht,st-1),10),lt){case"d":case"i":case"u":ct=i(it.toString(),ut);break;case"x":ct=i(it.toString(16),ut);break;case"X":ct=i(it.toString(16),ut).toUpperCase();break;case"o":ct=i(it.toString(8),ut);break;default:return nt}else ct=it;nt=nt.substring(0,at)+ct+nt.substring(st+1)}}function u(nt,rt,it,st,ot,lt,ut,ct){var dt,ht=new at.Z;return ht.representation=nt,ht.duration=rt,ht.presentationStartTime=it,ht.mediaStartTime=st,ht.availabilityStartTime=ot.calcAvailabilityStartTimeFromPresentationTime(lt,nt,ut),ht.availabilityEndTime=ot.calcAvailabilityEndTimeFromPresentationTime(lt+rt,nt,ut),ht.wallStartTime=ot.calcWallTimeForSegment(ht,ut),ht.replacementNumber=(dt=ct,ht.representation.startNumber+dt),ht.index=ct,ht}function l(nt,rt,it,at){var st=rt.adaptation.period;if(isFinite(st.duration)&&st.start+st.duration<=it.presentationStartTime)return!1;if(at){if("INF"===rt.availabilityTimeOffset)return!0;var ot=nt.getClientReferenceTime();return it.availabilityStartTime.getTime()<=ot&&(!isFinite(it.availabilityEndTime)||it.availabilityEndTime.getTime()>=ot)}return!0}function c(nt,rt,it,at){var st,ot,lt;st=it.segmentDuration,isNaN(st)&&(st=it.adaptation.period.duration),ot=parseFloat((it.adaptation.period.start+at*st).toFixed(5)),lt=parseFloat((ot+st).toFixed(5));var ut=u(it,st,ot,nt.calcMediaTimeFromPresentationTime(ot,it),nt,lt,rt,at);return l(nt,it,ut,rt)?ut:null}function f(nt,rt,it,at,st,ot,lt,ut,ct,dt){var ht,pt,_t=at/ot,Et=st/ot;return ht=nt.calcPresentationTimeFromMediaTime(_t,it),l(nt,it,pt=u(it,Et,ht,_t,nt,ht+Et,rt,ct),rt)?(pt.replacementTime=dt||at,lt=s(lt,"Number",pt.replacementNumber),lt=s(lt,"Time",pt.replacementTime),pt.media=lt,pt.mediaRange=ut,pt):null}},3636:function(nt,rt,it){var at=it(5448),st=it(3393),ot=it(7387);function o(nt,rt){var it=(nt=nt||{}).timelineConverter;function r(){if(!it||!it.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(st.Z.MISSING_CONFIG_ERROR)}function o(nt,at){if(r(),!nt)return null;var st=nt.adaptation.period.mpd.manifest.Period_asArray[nt.adaptation.period.index].AdaptationSet_asArray[nt.adaptation.index].Representation_asArray[nt.index].SegmentTemplate;at=Math.max(at,0);var lt=(0,ot.NF)(it,rt,nt,at);if(lt){lt.replacementTime=Math.round((at-1)*nt.segmentDuration*nt.timescale,10);var ut=st.media;ut=(0,ot.vi)(ut,"Number",lt.replacementNumber),ut=(0,ot.vi)(ut,"Time",lt.replacementTime),lt.media=ut}return lt}return{getSegmentByIndex:o,getSegmentByTime:function(nt,rt){if(r(),!nt)return null;var at=nt.segmentDuration;if(isNaN(at))return null;var st=it.calcPeriodRelativeTimeFromMpdRelativeTime(nt,rt);return o(nt,Math.floor(st/at))},getMediaFinishedInformation:function(nt){var rt={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!nt)return rt;var it=nt.segmentDuration;return isNaN(it)?rt.numberOfSegments=1:rt.numberOfSegments=Math.ceil(nt.adaptation.period.duration/it),rt}}}o.__dashjs_factory_name="TemplateSegmentsGetter";var lt=at.Z.getClassFactory(o);rt.Z=lt},1724:function(nt,rt,it){var at=it(5448),st=it(3393),ot=it(7387);function o(nt,rt){var it=(nt=nt||{}).timelineConverter,at=nt.dashMetrics;function o(){if(!it)throw new Error(st.Z.MISSING_CONFIG_ERROR)}function s(nt,rt){var it,at,st,ot,lt,ut,ct,dt=nt.adaptation.period.mpd.manifest.Period_asArray[nt.adaptation.period.index].AdaptationSet_asArray[nt.adaptation.index].Representation_asArray[nt.index].SegmentTemplate||nt.adaptation.period.mpd.manifest.Period_asArray[nt.adaptation.period.index].AdaptationSet_asArray[nt.adaptation.index].Representation_asArray[nt.index].SegmentList,ht=dt.SegmentTimeline,pt=dt.SegmentURL_asArray,_t=0,Et=-1;ct=nt.timescale;var St=!1;for(st=0,ot=(it=ht.S_asArray).length;st<ot&&!St;st++)for(ut=0,(at=it[st]).hasOwnProperty("r")&&(ut=at.r),at.hasOwnProperty("t")&&(_t=at.t),ut<0&&(ut=u(nt,it[st+1],at,ct,_t/ct)),lt=0;lt<=ut&&!St;lt++)(St=rt(_t,dt,pt,at,ct,++Et,st))&&(nt.segmentDuration=at.d/ct),_t+=at.d}function u(nt,rt,st,ot,lt){var ut;if(rt&&rt.hasOwnProperty("t"))ut=rt.t/ot;else try{var ct=0;if(isNaN(nt.adaptation.period.start)||isNaN(nt.adaptation.period.duration)||!isFinite(nt.adaptation.period.duration)){var dt=at.getCurrentDVRInfo();ct=isNaN(dt.end)?0:dt.end}else ct=nt.adaptation.period.start+nt.adaptation.period.duration;ut=it.calcMediaTimeFromPresentationTime(ct,nt),nt.segmentDuration=st.d/ot}catch(nt){ut=0}return Math.max(Math.ceil((ut-lt)/(st.d/ot))-1,0)}return{getSegmentByIndex:function(nt,at,st){if(o(),!nt)return null;var lt=null,ut=!1;return s(nt,(function(at,ct,dt,ht,pt,_t,Et){if(ut||st<0){var St=ct.media,wt=ht.mediaRange;return dt&&(St=dt[Et].media||"",wt=dt[Et].mediaRange),lt=(0,ot.TJ)(it,rt,nt,at,ht.d,pt,St,wt,_t,ht.tManifest),!0}return at>=st*pt-.5*ht.d&&(ut=!0),!1})),lt},getSegmentByTime:function(nt,at){if(o(),!nt)return null;void 0===at&&(at=null);var st=null,lt=it.calcMediaTimeFromPresentationTime(at,nt);return s(nt,(function(at,ut,ct,dt,ht,pt,_t){var Et=parseFloat((lt*ht).toPrecision(15));if(Et<at+dt.d&&Et>=at){var St=ut.media,wt=dt.mediaRange;return ct&&(St=ct[_t].media||"",wt=ct[_t].mediaRange),st=(0,ot.TJ)(it,rt,nt,at,dt.d,ht,St,wt,pt,dt.tManifest),!0}return!1})),st},getMediaFinishedInformation:function(nt){if(!nt)return 0;var rt,it,at,st,ot,lt,ut,ct=(nt.adaptation.period.mpd.manifest.Period_asArray[nt.adaptation.period.index].AdaptationSet_asArray[nt.adaptation.index].Representation_asArray[nt.index].SegmentTemplate||nt.adaptation.period.mpd.manifest.Period_asArray[nt.adaptation.period.index].AdaptationSet_asArray[nt.adaptation.index].Representation_asArray[nt.index].SegmentList).SegmentTimeline,dt=0,ht=0,pt=0;for(ut=nt.timescale,st=(rt=ct.S_asArray).length,at=0;at<st;at++)for(lt=0,(it=rt[at]).hasOwnProperty("r")&&(lt=it.r),it.hasOwnProperty("t")&&(ht=(dt=it.t)/ut),lt<0&&(lt=u(nt,rt[at+1],it,ut,ht)),ot=0;ot<=lt;ot++)pt++,ht=(dt+=it.d)/ut;return{numberOfSegments:pt,mediaTimeOfLastSignaledSegment:ht}}}}o.__dashjs_factory_name="TimelineSegmentsGetter";var lt=at.Z.getClassFactory(o);rt.Z=lt},2011:function(nt,rt){rt.Z=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.wallStartTime=NaN,this.representation=null}},2610:function(nt,rt){rt.Z=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value=""}},1139:function(nt,rt,it){it.d(rt,{Z:function(){return _o}});var at=it(452),st=it.n(at),ot=it(3393),lt=it(1553),ut=it(3860),ct=it(5595),dt=it(8512),ht=it(5448),pt=it(6398),_t=it(8825);function g(){var nt,rt,it,at,st,lt,ht,Et,St,wt,Lt,Ct,Pt,kt,Ot,Ft,Bt,Ut,Gt,Ht,jt,Kt,$t,Yt,Wt,Qt=this.context,en=(0,ct.Z)(Qt).getInstance();function P(){k(),kt=!1,wt=0,Lt=0,Bt=0,$t=!1,Ut=!0,Gt=!1,Yt=!1,Ht=NaN,Ft=NaN,ht&&(en.off(dt.Z.DATA_UPDATE_COMPLETED,J,nt),en.off(dt.Z.LOADING_PROGRESS,Ee,nt),en.off(dt.Z.MANIFEST_UPDATED,Se,nt),en.off(dt.Z.STREAMS_COMPOSED,be,nt),en.off(_t.Z.PLAYBACK_ENDED,pe,nt),en.off(_t.Z.STREAM_INITIALIZING,_e,nt),en.off(_t.Z.REPRESENTATION_SWITCH,Te,nt),en.off(_t.Z.BUFFER_LEVEL_STATE_CHANGED,te,nt),Q(),ht.removeEventListener("canplay",$),ht.removeEventListener("canplaythrough",ee),ht.removeEventListener("play",ne),ht.removeEventListener("waiting",re),ht.removeEventListener("playing",ie),ht.removeEventListener("pause",ae),ht.removeEventListener("error",me),ht.removeEventListener("seeking",oe),ht.removeEventListener("seeked",se),ht.removeEventListener("timeupdate",ue),ht.removeEventListener("progress",le),ht.removeEventListener("ratechange",ce),ht.removeEventListener("loadedmetadata",fe),ht.removeEventListener("loadeddata",de),ht.removeEventListener("stalled",ve),ht.removeEventListener("ended",ge),ht.removeEventListener("volumechange",he)),St=null,ht=null,Ct=null,Pt=null}function L(){return parseFloat((F(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)-G()).toFixed(5))}function F(nt){var rt=nt||Ct;return rt.start+rt.duration}function x(){var nt=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Ct&&ht&&ht.getElement()?(nt&&Pt&&B(G()),ht.play()):kt=!0}function k(){Ct&&ht&&ht.pause()}function U(nt){var it=arguments.length>1&&void 0!==arguments[1]&&arguments[1],at=arguments.length>2&&void 0!==arguments[2]&&arguments[2],st=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Ct&&ht&&ht.getElement()&&nt!==(isNaN(Ht)?ht.getTime():Ht)&&((jt=!0===at)||(Ht=nt),rt.info("Requesting seek to time: "+nt+(jt?" (internal)":"")),Pt&&st&&B(nt),ht.setCurrentTime(nt,it))}function Z(){if(Ct&&ht&&Pt){var nt=it&&it.hasVideoTrack()?ot.Z.VIDEO:ot.Z.AUDIO,rt=st.getCurrentDVRInfo(nt);return rt&&rt.range?rt.range.end:0}}function B(nt){var rt=new Date(Et.getClientReferenceTime()),it=lt.getRegularPeriods()[0],at=Et.calcPresentationTimeFromWallTime(rt,it);wt=at-nt}function G(){return Ct&&ht?ht.getTime():null}function q(){return Ct&&ht?ht.isPaused():null}function Y(){return Ct&&ht?ht.isSeeking():null}function j(){return Ct&&ht?ht.isStalled():null}function H(){return Ct&&ht?ht.getPlaybackRate():null}function V(){return Ct&&ht?ht.getEnded():null}function K(){return Pt}function z(){var nt=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!q()&&Pt&&0!==ht.getReadyState()&&!Y()&&!$t){nt||(nt=it.hasVideoTrack()?ot.Z.VIDEO:ot.Z.AUDIO);var at=G(),st=W(at,nt);!isNaN(st)&&st!==at&&!Y()&&(j()||Kt||1===ht.getReadyState())&&(rt.debug("UpdateCurrentTime: Seek to actual time: ".concat(st," from currentTime: ").concat(at)),U(st,!1,!1))}}function W(nt,rt){var it=st.getCurrentDVRInfo(rt),at=it?it.range:null;return at?nt>at.end?Math.max(at.end-wt,at.start):nt>0&&nt+.25<at.start&&Math.abs(nt-at.start)<31536e4?Gt?Math.max(at.end-wt,at.start):at.start:nt:NaN}function X(){null===St&&(St=setInterval((function(){!function(){if(en.trigger(dt.Z.WALLCLOCK_TIME_UPDATED,{isDynamic:Pt,time:new Date}),K()){var nt=Date.now();(isNaN(Ft)||nt>Ft+Wt.get().streaming.liveUpdateTimeThresholdInMilliseconds)&&(it.addDVRMetric(),q()?function(){var nt=Date.now();(!Ot||nt>Ot+500)&&(Ot=nt,ue())}():z(),Ft=nt)}}()}),Wt.get().streaming.wallclockTimeUpdateInterval))}function Q(){clearInterval(St),St=null}function J(nt){var rt=lt.convertRepresentationToRepresentationInfo(nt.currentRepresentation),it=rt?rt.mediaInfo.streamInfo:null;null!==it&&Ct.id===it.id&&(Ct=it)}function $(){en.trigger(dt.Z.CAN_PLAY)}function ee(){en.trigger(dt.Z.CAN_PLAY_THROUGH)}function te(nt){nt.streamId===it.getActiveStreamInfo().id&&(Kt=nt.state===ut.Z.BUFFER_EMPTY,Wt.get().streaming.buffer.setStallState&&ht.setStallState(nt.mediaType,nt.state===ut.Z.BUFFER_EMPTY))}function ne(){rt.info("Native video element event: play"),z(),X(),en.trigger(dt.Z.PLAYBACK_STARTED,{startTime:G()})}function re(){rt.info("Native video element event: waiting"),en.trigger(dt.Z.PLAYBACK_WAITING,{playingTime:G()})}function ie(){rt.info("Native video element event: playing"),jt=!1,en.trigger(dt.Z.PLAYBACK_PLAYING,{playingTime:G()})}function ae(){rt.info("Native video element event: pause"),en.trigger(dt.Z.PLAYBACK_PAUSED,{ended:V()})}function oe(){if(!jt){var nt=G();isNaN(Ht)||Ht===nt||(nt=Ht),Ht=NaN,rt.info("Seeking to: "+nt),X(),en.trigger(dt.Z.PLAYBACK_SEEKING,{seekTime:nt,streamId:Ct.id})}}function se(){rt.info("Native video element event: seeked"),jt=!1,en.trigger(dt.Z.PLAYBACK_SEEKED)}function ue(){Ct&&en.trigger(dt.Z.PLAYBACK_TIME_UPDATED,{timeToEnd:L(),time:G(),streamId:Ct.id})}function le(){en.trigger(dt.Z.PLAYBACK_PROGRESS,{streamId:Ct.id})}function ce(){var nt=H();rt.info("Native video element event: ratechange: ",nt),en.trigger(dt.Z.PLAYBACK_RATE_CHANGED,{playbackRate:nt})}function fe(){rt.info("Native video element event: loadedmetadata"),en.trigger(dt.Z.PLAYBACK_METADATA_LOADED),X()}function de(){rt.info("Native video element event: loadeddata"),en.trigger(dt.Z.PLAYBACK_LOADED_DATA)}function ge(){rt.info("Native video element event: ended"),k(),Q();var nt=it?it.getActiveStreamInfo():null;nt&&en.trigger(dt.Z.PLAYBACK_ENDED,{isLast:nt.isLast})}function he(){en.trigger(dt.Z.PLAYBACK_VOLUME_CHANGED)}function pe(nt){if(St&&nt.isLast){rt.info("onPlaybackEnded -- PLAYBACK_ENDED but native video element didn't fire ended");var it=nt.seekTime?nt.seekTime:F();ht.setCurrentTime(it),k(),Q()}}function me(nt){var rt=nt.target||nt.srcElement;en.trigger(dt.Z.PLAYBACK_ERROR,{error:rt.error})}function ye(){Pt=!1}function Ee(nt){if(!1===nt.stream&&Gt&&!isNaN(nt.request.duration)){var it=1.2*nt.request.duration;it>wt&&(rt.warn("Browser does not support fetch API with StreamReader. Increasing live delay to be 20% higher than segment duration:",it.toFixed(2)),wt=it,Lt=it)}}function ve(nt){en.trigger(dt.Z.PLAYBACK_STALLED,{e:nt})}function _e(nt){var it;(it=nt.mediaInfo)&&it.supplementalProperties&&it.supplementalProperties[ot.Z.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME]&&"true"===it.supplementalProperties[ot.Z.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME].value&&(rt.debug("Low Latency critical SupplementalProperty set: Enabling low Latency"),Gt=!0)}function Te(nt){var rt=it.getActiveStreamInfo();nt&&rt&&nt.currentRepresentation&&nt.streamId&&nt.streamId===rt.id&&nt.mediaType&&(nt.mediaType===ot.Z.VIDEO||nt.mediaType===ot.Z.AUDIO)&&(Ut=nt.currentRepresentation.availabilityTimeComplete,(Gt=!Ut)&&!Yt&&(Yt=!0))}function Se(){$t=!0}function be(){$t=!1}return nt={initialize:function(rt,it){Ct=rt,!0!==it&&(ht.addEventListener("canplay",$),ht.addEventListener("canplaythrough",ee),ht.addEventListener("play",ne),ht.addEventListener("waiting",re),ht.addEventListener("playing",ie),ht.addEventListener("pause",ae),ht.addEventListener("error",me),ht.addEventListener("seeking",oe),ht.addEventListener("seeked",se),ht.addEventListener("timeupdate",ue),ht.addEventListener("progress",le),ht.addEventListener("ratechange",ce),ht.addEventListener("loadedmetadata",fe),ht.addEventListener("loadeddata",de),ht.addEventListener("stalled",ve),ht.addEventListener("ended",ge),ht.addEventListener("volumechange",he),Pt=Ct.manifestInfo.isDynamic,Kt=!1,jt=!1,en.on(dt.Z.DATA_UPDATE_COMPLETED,J,nt),en.on(dt.Z.LOADING_PROGRESS,Ee,nt),en.on(dt.Z.MANIFEST_UPDATED,Se,nt),en.on(dt.Z.STREAMS_COMPOSED,be,nt),en.on(_t.Z.PLAYBACK_ENDED,pe,nt,{priority:ct.Z.EVENT_PRIORITY_HIGH}),en.on(_t.Z.STREAM_INITIALIZING,_e,nt),en.on(_t.Z.REPRESENTATION_SWITCH,Te,nt),en.on(_t.Z.BUFFER_LEVEL_STATE_CHANGED,te,nt),en.on(_t.Z.DYNAMIC_TO_STATIC,ye,nt),kt&&(kt=!1,x()))},setConfig:function(nt){nt&&(nt.streamController&&(it=nt.streamController),nt.serviceDescriptionController&&(at=nt.serviceDescriptionController),nt.dashMetrics&&(st=nt.dashMetrics),nt.adapter&&(lt=nt.adapter),nt.videoModel&&(ht=nt.videoModel),nt.timelineConverter&&(Et=nt.timelineConverter),nt.settings&&(Wt=nt.settings))},getTimeToStreamEnd:L,getBufferLevel:function(){var nt=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,rt=null;return it.getActiveStreamProcessors().forEach((function(it){if(!nt||0===nt.length||-1===nt.indexOf(it.getType())){var at=it.getBufferLevel();rt=null===rt?at:Math.min(rt,at)}})),rt},getPlaybackStalled:function(){return Kt},getTime:G,getLowLatencyModeEnabled:function(){return Gt},getInitialCatchupModeActivated:function(){return Yt},getIsManifestUpdateInProgress:function(){return $t},getPlaybackRate:H,getPlayedRanges:function(){return Ct&&ht?ht.getPlayedRanges():null},getEnded:V,getIsDynamic:K,getStreamController:function(){return it},computeAndSetLiveDelay:function(nt,rt){var it,st,ot,ut=!isNaN(nt)&&isFinite(nt)?nt:NaN,ct=lt.getSuggestedPresentationDelay(),dt=at.getServiceDescriptionSettings();return it=isNaN(Wt.get().streaming.delay.liveDelay)?null===Wt.get().streaming.delay.liveDelayFragmentCount||isNaN(Wt.get().streaming.delay.liveDelayFragmentCount)||isNaN(ut)?dt&&!isNaN(dt.liveDelay)&&dt.liveDelay>0?dt.liveDelay:!0===Wt.get().streaming.delay.useSuggestedPresentationDelay&&null!==ct&&!isNaN(ct)&&ct>0?ct:isNaN(ut)?rt&&!isNaN(rt.minBufferTime)?4*rt.minBufferTime:4*Ct.manifestInfo.minBufferTime:4*ut:ut*Wt.get().streaming.delay.liveDelayFragmentCount:Wt.get().streaming.delay.liveDelay,null!==(ot=lt.getAvailabilityStartTime())&&(Bt=ot),st=rt&&rt.dvrWindowSize>0?Math.min(it,rt.dvrWindowSize):it,wt=st,Lt=st,st},getLiveDelay:function(){return wt},getOriginalLiveDelay:function(){return Lt},getCurrentLiveLatency:function(){if(!Pt||isNaN(Bt))return NaN;var nt=G();if(isNaN(nt)||0===nt)return 0;var rt=(new Date).getTime()+1e3*Et.getClientTimeOffset();return Math.max(((rt-Bt-1e3*nt)/1e3).toFixed(3),0)},play:x,isPaused:q,isStalled:j,pause:k,isSeeking:Y,getStreamEndTime:F,seek:U,seekToOriginalLive:function(){var nt=arguments.length>0&&void 0!==arguments[0]&&arguments[0],rt=arguments.length>1&&void 0!==arguments[1]&&arguments[1],it=arguments.length>2&&void 0!==arguments[2]&&arguments[2],at=Z();0!==at&&U(at-(wt=Lt),nt,rt,it)},seekToCurrentLive:function(){var nt=arguments.length>0&&void 0!==arguments[0]&&arguments[0],rt=arguments.length>1&&void 0!==arguments[1]&&arguments[1],it=arguments.length>2&&void 0!==arguments[2]&&arguments[2],at=Z();0!==at&&U(at-wt,nt,rt,it)},reset:P,updateCurrentTime:z,getAvailabilityStartTime:function(){return Bt}},rt=(0,pt.Z)(Qt).getInstance().getLogger(nt),P(),nt}g.__dashjs_factory_name="PlaybackController";var Et=ht.Z.getSingletonFactory(g),St=it(3186),wt="loading",Lt="executed",Ct="failed";function v(nt){var rt,it,at,st,ot=(nt=nt||{}).eventBus,lt=nt.events,ut=nt.dashMetrics,ct=nt.fragmentLoader,dt=nt.debug,ht=nt.streamInfo,pt=nt.type;function d(nt){var rt;return!!nt&&(rt=!1,at.some((function(it){if(at=nt,st=it,!isNaN(at.index)&&at.startTime===st.startTime&&at.adaptationIndex===st.adaptationIndex&&at.type===st.type||function(nt,rt){return isNaN(nt.index)&&isNaN(rt.index)&&nt.quality===rt.quality}(nt,it)||function(nt,rt){return nt.action===St.Z.ACTION_COMPLETE&&nt.action===rt.action}(nt,it))return rt=!0;var at,st})),rt)}function g(nt){return isNaN(nt.duration)?.25:Math.min(nt.duration/8,.5)}function h(nt){at=at.filter((function(rt){var it=g(rt);return isNaN(rt.startTime)||void 0!==nt&&rt.startTime>=nt-it}))}function v(nt,rt){rt<=nt+.5||(at=at.filter((function(it){var at=g(it);return isNaN(it.startTime)||it.startTime>=rt-at||isNaN(it.duration)||it.startTime+it.duration<=nt+at})))}function _(nt,rt,it){for(var at=nt.length-1;at>=0;at--){var st=nt[at],ot=st.startTime,lt=ot+st.duration;if(it=isNaN(it)?g(st):it,!isNaN(ot)&&!isNaN(lt)&&rt+it>=ot&&rt-it<lt||isNaN(ot)&&isNaN(rt))return st}return null}function T(nt,rt){ut.addSchedulingInfo(nt,rt),ut.addRequestsQueue(nt.mediaType,st,at)}function S(nt){nt.sender===ct&&(st.splice(st.indexOf(nt.request),1),nt.response&&!nt.error&&at.push(nt.request),T(nt.request,nt.error?Ct:Lt),ot.trigger(lt.FRAGMENT_LOADING_COMPLETED,{request:nt.request,response:nt.response,error:nt.error,sender:this},{streamId:ht.id,mediaType:pt}))}function b(nt){nt.sender===ct&&ot.trigger(lt.FRAGMENT_LOADING_PROGRESS,{request:nt.request,response:nt.response,error:nt.error,sender:this},{streamId:ht.id,mediaType:pt})}function A(nt){nt.sender===ct&&ot.trigger(lt.FRAGMENT_LOADING_ABANDONED,{request:nt.request},{streamId:ht.id,mediaType:pt})}function I(){at=[],st=[]}return rt={getStreamId:function(){return ht.id},getType:function(){return pt},getRequests:function(nt){var rt=nt?nt.state instanceof Array?nt.state:[nt.state]:[],it=[];return rt.forEach((function(rt){var ot=function(nt){var rt;switch(nt){case wt:rt=st;break;case Lt:rt=at;break;default:rt=[]}return rt}(rt);it=it.concat(function(nt,rt){return rt.hasOwnProperty("time")?[_(nt,rt.time,rt.threshold)]:nt.filter((function(nt){for(var it in rt)if("state"!==it&&rt.hasOwnProperty(it)&&nt[it]!=rt[it])return!1;return!0}))}(ot,nt))})),it},isFragmentLoaded:d,isFragmentLoadedOrPending:function(nt){var rt,it=!1,at=0;if(!(it=d(nt)))for(at=0;at<st.length;at++)rt=st[at],nt.url===rt.url&&nt.startTime===rt.startTime&&(it=!0);return it},removeExecutedRequestsBeforeTime:h,removeExecutedRequestsAfterTime:function(nt){at=at.filter((function(rt){return isNaN(rt.startTime)||void 0!==nt&&rt.startTime<nt}))},syncExecutedRequestsWithBufferedRange:function(nt,rt){if(nt&&0!==nt.length){for(var it=0,at=0,st=nt.length;at<st;at++)v(it,nt.start(at)),it=nt.end(at);rt>0&&v(it,rt)}else h()},abortRequests:function(){it.debug("abort requests"),ct.abort(),st=[]},executeRequest:function(nt){nt.action===St.Z.ACTION_DOWNLOAD?(T(nt,wt),st.push(nt),function(nt){ot.trigger(lt.FRAGMENT_LOADING_STARTED,{request:nt},{streamId:ht.id,mediaType:pt}),ct.load(nt)}(nt)):it.warn("Unknown request action.")},reset:function(){ot.off(lt.LOADING_COMPLETED,S,this),ot.off(lt.LOADING_DATA_PROGRESS,b,this),ot.off(lt.LOADING_ABANDONED,A,this),ct&&ct.reset(),I()},resetInitialSettings:I,addExecutedRequest:function(nt){at.push(nt)}},it=dt.getLogger(rt),I(),ot.on(lt.LOADING_COMPLETED,S,rt),ot.on(lt.LOADING_DATA_PROGRESS,b,rt),ot.on(lt.LOADING_ABANDONED,A,rt),rt}v.__dashjs_factory_name="FragmentModel";var Pt=ht.Z.getClassFactory(v);Pt.FRAGMENT_MODEL_LOADING=wt,Pt.FRAGMENT_MODEL_EXECUTED=Lt,Pt.FRAGMENT_MODEL_CANCELED="canceled",Pt.FRAGMENT_MODEL_FAILED=Ct,ht.Z.updateClassFactory(v.__dashjs_factory_name,Pt);var kt=Pt,Ot=it(5459);function b(nt){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},b(nt)}function A(nt,rt){return A=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},A(nt,rt)}function I(nt,rt){return!rt||"object"!==b(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function R(nt){return R=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},R(nt)}var Ft=new(function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&A(nt,rt)}(i,nt);var rt,it,at=(rt=i,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=R(rt);if(it){var st=R(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return I(this,nt)});function i(){var nt;return function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,i),(nt=at.call(this)).MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE=10,nt.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE=11,nt.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE=12,nt.SEGMENT_BASE_LOADER_ERROR_CODE=15,nt.TIME_SYNC_FAILED_ERROR_CODE=16,nt.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE=17,nt.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE=18,nt.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=19,nt.APPEND_ERROR_CODE=20,nt.REMOVE_ERROR_CODE=21,nt.DATA_UPDATE_FAILED_ERROR_CODE=22,nt.CAPABILITY_MEDIASOURCE_ERROR_CODE=23,nt.CAPABILITY_MEDIAKEYS_ERROR_CODE=24,nt.DOWNLOAD_ERROR_ID_MANIFEST_CODE=25,nt.DOWNLOAD_ERROR_ID_SIDX_CODE=26,nt.DOWNLOAD_ERROR_ID_CONTENT_CODE=27,nt.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE=28,nt.DOWNLOAD_ERROR_ID_XLINK_CODE=29,nt.MANIFEST_ERROR_ID_PARSE_CODE=31,nt.MANIFEST_ERROR_ID_NOSTREAMS_CODE=32,nt.TIMED_TEXT_ERROR_ID_PARSE_CODE=33,nt.MANIFEST_ERROR_ID_MULTIPLEXED_CODE=34,nt.MEDIASOURCE_TYPE_UNSUPPORTED_CODE=35,nt.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE="parsing failed for ",nt.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading manifest: ",nt.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading Xlink element: ",nt.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE="Segments update failed",nt.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE="no segments are available yet",nt.SEGMENT_BASE_LOADER_ERROR_MESSAGE="error loading segment ranges from sidx",nt.TIME_SYNC_FAILED_ERROR_MESSAGE="Failed to synchronize client and server time",nt.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE="request is null",nt.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE="Failed to resolve a valid URL",nt.APPEND_ERROR_MESSAGE="chunk is not defined",nt.REMOVE_ERROR_MESSAGE="Removing data from the SourceBuffer",nt.DATA_UPDATE_FAILED_ERROR_MESSAGE="Data update failed",nt.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE="mediasource is not supported",nt.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE="mediakeys is not supported",nt.TIMED_TEXT_ERROR_MESSAGE_PARSE="parsing error :",nt.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE="Error creating source buffer of type : ",nt}return i}(it(2230).Z)),Bt=it(1264),Ut=it(7855);function D(nt){var rt,it,at,st,lt,ut,ct=this.context,ht=(0,Bt.Z)(ct).getInstance(),_t=nt.textController,Et=nt.eventBus,St=[],wt=[],Lt=!1,Ct=nt.mediaSource,Pt=null;function v(nt){return new Promise((function(rt){M((function(){st.changeType&&st.changeType(nt),rt()}))}))}function _(nt){return st=_t.getTextSourceBuffer(nt),Promise.resolve()}function T(){if("function"==typeof st.addEventListener)try{st.addEventListener("updateend",D,!1),st.addEventListener("error",O,!1),st.addEventListener("abort",O,!1)}catch(nt){ut=setInterval(D,50)}else ut=setInterval(D,50)}function b(nt){return new Promise((function(rt){st&&ht.get().streaming.buffer.useAppendWindow?M((function(){try{if(!st)return void rt();var it=Ct.duration,ot=0;nt&&!isNaN(nt.start)&&!isNaN(nt.duration)&&isFinite(nt.duration)&&(it=nt.start+nt.duration),nt&&!isNaN(nt.start)&&(ot=nt.start),st.appendWindowEnd===it&&st.appendWindowStart===ot||(st.appendWindowStart=0,st.appendWindowEnd=it+.01,st.appendWindowStart=Math.max(ot-.1,0),at.debug("Updated append window for ".concat(lt.type,". Set start to ").concat(st.appendWindowStart," and end to ").concat(st.appendWindowEnd))),rt()}catch(nt){at.warn("Failed to set append window"),rt()}})):rt()}))}function A(nt){return new Promise((function(rt){st?M((function(){try{st.timestampOffset===nt||isNaN(nt)||(st.timestampOffset=nt,at.debug("Set MSE timestamp offset to ".concat(nt))),rt()}catch(nt){rt()}})):rt()}))}function I(){if(!Lt&&wt.length>0){Lt=!0;var nt=wt[0];wt.splice(0,1);var t=function(){Lt=!1,wt.length>0&&I.call(this),nt&&nt.data&&nt.data.segmentType&&nt.data.segmentType!==Ut.w.INIT_SEGMENT_TYPE&&delete nt.data.bytes,nt.promise.resolve({chunk:nt.data})};try{Pt=nt.request,0===nt.data.bytes.byteLength?t.call(this):(st.appendBuffer?st.appendBuffer(nt.data.bytes):st.append(nt.data.bytes,nt.data),M(t.bind(this)))}catch(t){at.fatal('SourceBuffer append failed "'+t+'"'),wt.length>0?I():Lt=!1,delete nt.data.bytes,nt.promise.reject({chunk:nt.data,error:new Ot.Z(t.code,t.message)})}}}function R(){St.length>0&&(st.updating||(St.shift()(),R()))}function D(){st.updating||R()}function O(nt){var rt,at,st=nt.target||{};rt=dt.Z.SOURCE_BUFFER_ERROR,at={error:st,lastRequestAppended:Pt}||{},Et.trigger(rt,at,{streamId:lt.streamInfo.id,mediaType:it})}function M(nt){St.push(nt),st.updating||R()}return rt={getType:function(){return it},getAllBufferRanges:function(){try{return st.buffered}catch(nt){return at.error("getAllBufferRanges exception: "+nt.message),null}},getBuffer:function(){return st},append:function(nt){var rt=this,it=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(at,st){nt?(wt.push({data:nt,promise:{resolve:at,reject:st},request:it}),M(I.bind(rt))):st({chunk:nt,error:new Ot.Z(Ft.APPEND_ERROR_CODE,Ft.APPEND_ERROR_MESSAGE)})}))},remove:function(nt){return new Promise((function(rt,it){var at=nt.start,ot=nt.end;at>=0&&ot>at?M((function(){try{st.remove(at,ot),M((function(){rt({from:at,to:ot,unintended:!1}),nt.resolve&&nt.resolve()}))}catch(rt){it({from:at,to:ot,unintended:!1,error:new Ot.Z(Ft.REMOVE_ERROR_CODE,Ft.REMOVE_ERROR_MESSAGE)}),nt.reject&&nt.reject(rt)}})):rt()}))},abort:function(){return new Promise((function(nt){try{wt=[],"open"===Ct.readyState?M((function(){try{st&&st.abort(),nt()}catch(rt){nt()}})):st&&st.setTextTrack&&"ended"===Ct.readyState?(st.abort(),nt()):nt()}catch(rt){nt()}}))},reset:function(){if(st){try{St=[],function(){try{"function"==typeof st.removeEventListener&&(st.removeEventListener("updateend",D,!1),st.removeEventListener("error",O,!1),st.removeEventListener("abort",O,!1)),clearInterval(ut)}catch(nt){at.error(nt)}}(),Lt=!1,wt=[],st.getClassName&&"TextSourceBuffer"===st.getClassName()||(at.debug("Removing sourcebuffer from media source"),Ct.removeSourceBuffer(st))}catch(nt){}st=null}Pt=null},updateTimestampOffset:A,initializeForStreamSwitch:function(nt,rt,at){it=(lt=nt).type;var ot=lt.codec;!function(nt){st=nt.getBuffer()}(at),T();var ut=[];return ut.push(new Promise((function(nt){M((function(){var rt=st.appendWindowStart,it=st.appendWindowEnd;st&&(st.abort(),st.appendWindowStart=rt,st.appendWindowEnd=it),nt()}))}))),ut.push(b(lt.streamInfo)),ht.get().streaming.buffer.useChangeTypeForTrackSwitch&&ut.push(v(ot)),rt&&void 0!==rt.MSETimeOffset&&ut.push(A(rt.MSETimeOffset)),Promise.all(ut)},initializeForFirstUse:function(nt,rt,at){it=(lt=rt).type;var ut=lt.codec;try{if(ut.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))return _(nt);st=Ct.addSourceBuffer(ut),T();var ct=[];return ct.push(b(lt.streamInfo)),at&&void 0!==at.MSETimeOffset&&ct.push(A(at.MSETimeOffset)),Promise.all(ct)}catch(rt){return lt.type==ot.Z.TEXT&&!lt.isFragmented||-1!==ut.indexOf('codecs="stpp')||-1!==ut.indexOf('codecs="vtt')||-1!==ut.indexOf("text/vtt")?_(nt):Promise.reject(rt)}},updateAppendWindow:b,changeType:v},at=(0,pt.Z)(ct).getInstance().getLogger(rt),rt}D.__dashjs_factory_name="SourceBufferSink";var Gt=ht.Z.getClassFactory(D);function M(nt){var rt,it,at,st=this.context,ot=[],lt=nt;function s(nt,rt){return ot=ot.filter((function(it){return!((isNaN(rt)||it.start<rt)&&(isNaN(nt)||it.end>nt))})),Promise.resolve()}return rt={getAllBufferRanges:function(){for(var nt=[],rt=0;rt<ot.length;rt++){var it=ot[rt];0===nt.length||it.start>nt[nt.length-1].end?nt.push({start:it.start,end:it.end}):nt[nt.length-1].end=it.end}var at={start:function(rt){return nt[rt].start},end:function(rt){return nt[rt].end}};return Object.defineProperty(at,"length",{get:function(){return nt.length}}),at},append:function(nt){return"InitializationSegment"!==nt.segmentType?(ot.push(nt),ot.sort((function(nt,rt){return nt.start-rt.start})),at=null):at=nt,it.debug("PreBufferSink appended chunk s: "+nt.start+"; e: "+nt.end),lt&&lt({chunk:nt}),Promise.resolve()},remove:s,abort:function(){return Promise.resolve()},discharge:function(nt,rt){var it=function(nt,rt){return ot.filter((function(it){return(isNaN(rt)||it.start<rt)&&(isNaN(nt)||it.end>nt)}))}(nt,rt);return at&&(it.push(at),at=null),s(nt,rt),it},reset:function(){ot=[],at=null,lt=null},updateTimestampOffset:function(){return Promise.resolve()},waitForUpdateEnd:function(nt){nt()},getBuffer:function(){return this}},it=(0,pt.Z)(st).getInstance().getLogger(rt),rt}M.__dashjs_factory_name="PreBufferSink";var Ht=ht.Z.getClassFactory(M);function L(){var nt={};return{save:function(rt){var it=rt.streamId,at=rt.representationId;nt[it]=nt[it]||{},nt[it][at]=rt},extract:function(rt,it){return nt&&nt[rt]&&nt[rt][it]?nt[rt][it]:null},reset:function(){nt={}}}}L.__dashjs_factory_name="InitCache";var jt=ht.Z.getSingletonFactory(L),Kt=.01,$t="BufferController";function U(nt){nt=nt||{};var rt,it,at,st,lt,ht,Et,St,wt,Lt,Ct,Pt,Bt,Yt,Wt,Qt,en,nn,an,ln,hn,fn=this.context,pn=(0,ct.Z)(fn).getInstance(),mn=nt.errHandler,gn=nt.fragmentModel,_n=nt.representationController,vn=nt.adapter,En=nt.textController,Tn=nt.abrController,bn=nt.playbackController,An=nt.streamInfo,Rn=nt.type,In=nt.settings;function W(nt){var rt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(it,at){ht=nt,wt&&rt&&"function"==typeof wt.discharge?(Lt=wt,Q(rt).then((function(){it()})).catch((function(nt){at(nt)}))):it()}))}function X(nt){return vn.convertRepresentationToRepresentationInfo(_n.getRepresentationForQuality(nt))}function Q(nt){var rt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new Promise((function(it,at){nn&&nt?ht?(Ct=!1,$(nt,rt).then((function(nt){it(nt)})).catch((function(nt){at(nt)}))):(Ct=!0,J().then((function(nt){it(nt)})).catch((function(nt){at(nt)}))):it(null)}))}function J(){var nt=this;return new Promise((function(rt,it){var at=Tn.getQualityFor(Rn,An.id);wt=Ht(fn).create(ie.bind(nt)),_e(X(at)).then((function(){rt(wt)})).catch((function(){it()}))}))}function $(nt,rt){return new Promise((function(at,st){var lt=Tn.getQualityFor(Rn,An.id);wt=Gt(fn).create({mediaSource:ht,textController:En,eventBus:pn}),function(nt,rt,it){var at=X(it);return rt&&rt[Rn]&&(Rn===ot.Z.VIDEO||Rn===ot.Z.AUDIO)?wt.initializeForStreamSwitch(nt,at,rt[Rn]):wt.initializeForFirstUse(An,nt,at)}(nt,rt,lt).then((function(){return _e(X(lt))})).then((function(){at(wt)})).catch((function(nt){it.fatal("Caught error on create SourceBuffer: "+nt),mn.error(new Ot.Z(Ft.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,Ft.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+Rn)),st(nt)}))}))}function ee(nt){In.get().streaming.cacheInitSegments&&(it.info("Init fragment finished loading saving to",Rn+"'s init cache"),nn.save(nt.chunk)),it.debug("Append Init fragment",Rn," with representationId:",nt.chunk.representationId," and quality:",nt.chunk.quality,", data size:",nt.chunk.bytes.byteLength),ne(nt.chunk)}function te(nt){ne(nt.chunk,nt.request)}function ne(nt){var rt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;wt&&(wt.append(nt,rt).then((function(nt){ie(nt)})).catch((function(nt){ie(nt)})),nt.mediaInfo.type===ot.Z.VIDEO&&Ne(dt.Z.VIDEO_CHUNK_RECEIVED,{chunk:nt}))}function re(nt){if(nt&&nt.length>0)for(var rt=0,at=nt.length;rt<at;rt++)it.debug("Buffered range: "+nt.start(rt)+" - "+nt.end(rt)+", currentTime = ",bn.getTime())}function ie(nt){if(nt.error)return 22===nt.error.code&&function(){if(en=!0,lt=.8*Ie(),it.warn("Quota exceeded, Critical Buffer: "+lt),lt>0){var nt=Math.max(.2*lt,1),rt=lt-nt,at=Math.min(In.get().streaming.buffer.bufferTimeAtTopQuality,.9*rt),st=Math.min(In.get().streaming.buffer.bufferTimeAtTopQualityLongForm,.9*rt),ot={streaming:{buffer:{bufferToKeep:parseFloat(nt.toFixed(5)),bufferTimeAtTopQuality:parseFloat(at.toFixed(5)),bufferTimeAtTopQualityLongForm:parseFloat(st.toFixed(5))}}};In.update(ot)}}(),void(22!==nt.error.code&&we()||(it.warn("Clearing playback buffer to overcome quota exceed situation"),Ne(dt.Z.QUOTA_EXCEEDED,{criticalBufferLevel:lt,quotaExceededTime:nt.chunk.start}),ye(me())));if(wt&&(fe(),en=!1,(Yt=nt.chunk)&&Yt.endFragment)){Yt&&!isNaN(Yt.index)&&(Et=Math.max(Yt.index,Et),de());var rt=wt.getAllBufferRanges();Yt.segmentType===Ut.w.MEDIA_SEGMENT_TYPE&&(re(rt),se(),function(){if(!isNaN(hn)&&!Ct)if(Rn===ot.Z.AUDIO||Rn===ot.Z.VIDEO){var nt=bn.getTime(),rt=ce(nt,0),it=ce(hn,0);if(rt&&it&&rt.start===it.start)hn=NaN;else{var at=_n.getCurrentRepresentation().segmentDuration,st=ce(hn,at);st&&(In.get().streaming.buffer.enableSeekDecorrelationFix&&Math.abs(nt-hn)>at?hn<=st.end&&bn.seek(Math.max(hn,st.start),!1,!0):nt<st.start&&bn.seek(st.start,!1,!0))}}else hn=NaN}());var at=!1;Pt&&(Pt.indexOf(Yt)>0&&(at=!0),Pt=null),Yt&&!at&&Ne(dt.Z.BYTES_APPENDED_END_FRAGMENT,{quality:Yt.quality,startTime:Yt.start,index:Yt.index,bufferedRanges:rt,segmentType:Yt.segmentType,mediaType:Rn})}}function ae(){return new Promise((function(nt,rt){var it=oe();if(!it||0===it.length)return se(),void nt();ye(it).then((function(){nt()})).catch((function(nt){rt(nt)}))}))}function oe(nt){var rt=[],at=wt.getAllBufferRanges();if(!at||0===at.length)return rt;if(!nt&&0!==nt||isNaN(nt))rt.push({start:at.start(0),end:at.end(at.length-1)+.5});else{var st=function(nt,rt){var it=In.get().streaming.buffer.bufferToKeep,at=rt.start(0);if(nt-at>it){var st=Math.max(0,nt-it),ot=gn.getRequests({state:kt.FRAGMENT_MODEL_EXECUTED,time:nt,threshold:Kt})[0];if(ot&&(st=Math.min(ot.startTime,st)),st>0)return{start:at,end:st}}return null}(nt,at),ot=function(nt,rt){var at=rt.end(rt.length-1)+.5,st=Re(nt),ot=An.manifestInfo.duration>=In.get().streaming.buffer.longFormContentDurationThreshold?In.get().streaming.buffer.bufferTimeAtTopQualityLongForm:In.get().streaming.buffer.bufferTimeAtTopQuality,lt=isNaN(st)?nt:Math.min(st,nt+ot);if(lt>=rt.end(rt.length-1))return null;var ut=gn.getRequests({state:kt.FRAGMENT_MODEL_EXECUTED,time:nt,threshold:Kt})[0];if(ut&&(lt=Math.max(ut.startTime+ut.duration,lt)),In.get().streaming.buffer.avoidCurrentTimeRangePruning)for(var ct=0;ct<rt.length;ct++)if(rt.start(ct)<=nt&&nt<=rt.end(ct)&&rt.start(ct)<=lt&&lt<=rt.end(ct)){var dt=lt;lt=ct+1<rt.length?rt.start(ct+1):rt.end(ct)+1,it.debug("Buffered range ["+rt.start(ct)+", "+rt.end(ct)+"] overlaps with targetTime "+nt+" and range to be pruned ["+dt+", "+at+"], using ["+lt+", "+at+"] instead"+(lt<at?"":" (no actual pruning)"));break}return lt<rt.end(rt.length-1)?{start:lt,end:at}:null}(nt,at);st&&rt.push(st),ot&&rt.push(ot)}return rt}function se(){(!ln||Rn===ot.Z.TEXT&&En.isTextEnabled())&&fe()}function ue(){ge()}function le(){ge(),hn=NaN}function ce(nt,rt){if(!wt)return null;var it,at,st=wt.getAllBufferRanges(),ot=0,lt=0,ut=null,ct=null,dt=0,ht=isNaN(rt)?.15:rt;if(null!=st){for(at=0,it=st.length;at<it;at++)if(ot=st.start(at),lt=st.end(at),null===ut)dt=Math.abs(ot-nt),(nt>=ot&&nt<lt||dt<=ht)&&(ut=ot,ct=lt);else{if(!((dt=ot-ct)<=ht))break;ct=lt}if(null!==ut)return{start:ut,end:ct}}return null}function fe(){if(bn){var nt=bn.getTime()||0;Ct&&(nt=isNaN(hn)?0:hn);var rt=In.get().streaming.gaps.jumpGaps&&!isNaN(In.get().streaming.gaps.smallGapLimit)?In.get().streaming.gaps.smallGapLimit:NaN;st=Math.max(function(nt,rt){var it;return In.get().streaming.gaps.jumpGaps&&(rt=In.get().streaming.gaps.smallGapLimit),null===(it=ce(nt,rt))?0:it.end-nt}(nt,rt),0),Ne(dt.Z.BUFFER_LEVEL_UPDATED,{mediaType:Rn,bufferLevel:st}),ge()}}function de(){var nt=Et>=St-1,rt=bn.getTimeToStreamEnd(An)-st<1e-5;!nt&&!rt||at||(Ae(!0),it.debug("checkIfBufferingCompleted trigger BUFFERING_COMPLETED for stream id ".concat(An.id," and type ").concat(Rn)))}function ge(){Rn!==ot.Z.AUDIO&&Rn!==ot.Z.VIDEO||((!bn.getLowLatencyModeEnabled()&&st<In.get().streaming.buffer.stallThreshold||0===st)&&!at?he(ut.Z.BUFFER_EMPTY):(at||st>=In.get().streaming.buffer.stallThreshold||bn.getLowLatencyModeEnabled()&&st>0)&&he(ut.Z.BUFFER_LOADED))}function he(nt){Bt===nt||nt===ut.Z.BUFFER_EMPTY&&0===bn.getTime()||Rn===ot.Z.TEXT&&!En.isTextEnabled()||(Bt=nt,Ne(dt.Z.BUFFER_LEVEL_STATE_CHANGED,{state:nt}),Ne(nt===ut.Z.BUFFER_LOADED?dt.Z.BUFFER_LOADED:dt.Z.BUFFER_EMPTY),it.debug(nt===ut.Z.BUFFER_LOADED?"Got enough buffer to start":"Waiting for more buffer before starting playback"))}function pe(){wt&&Rn!==ot.Z.TEXT&&(at||ye(me()))}function me(){var nt=[],rt=wt.getAllBufferRanges();if(!rt||0===rt.length)return nt;var it=bn.getTime(),at=Math.max(0,it-In.get().streaming.buffer.bufferToKeep),st=gn.getRequests({state:kt.FRAGMENT_MODEL_EXECUTED,time:it,threshold:Kt})[0];if(st)at=Math.min(st.startTime,at);else if(0===it&&bn.getIsDynamic())return[];if(rt.start(0)<=at){for(var ot={start:0,end:at},lt=0;lt<rt.length&&rt.end(lt)<=at;lt++)ot.end=rt.end(lt);ot.start<ot.end&&nt.push(ot)}return nt}function ye(nt){return new Promise((function(rt,it){if(nt&&wt&&0!==nt.length){var at=[];nt.forEach((function(nt){at.push(function(nt){return new Promise((function(rt,it){nt.resolve=rt,nt.reject=it,an.push(nt)}))}(nt))})),Qt||Ee(),Promise.all(at).then((function(){rt()})).catch((function(nt){it(nt)}))}else rt()}))}function Ee(){try{if(0===an.length||!wt)return it.debug("Nothing to prune, halt pruning"),an=[],void(Qt=!1);var nt=wt.getBuffer();if(!nt||!nt.buffered||0===nt.buffered.length)return it.debug("SourceBuffer is empty (or does not exist), halt pruning"),an=[],void(Qt=!1);var rt=an.shift();it.debug("".concat(Rn,": Removing buffer from: ").concat(rt.start," to ").concat(rt.end)),Qt=!0,bn.getTime()<rt.end&&Ae(!1),wt.remove(rt).then((function(nt){ve(nt)})).catch((function(nt){ve(nt)}))}catch(nt){Qt=!1}}function ve(nt){it.debug("onRemoved buffer from:",nt.from,"to",nt.to),wt&&(re(wt.getAllBufferRanges()),0===an.length&&(Qt=!1,fe()),nt.unintended&&(it.warn("Detected unintended removal from:",nt.from,"to",nt.to,"setting streamprocessor time to",nt.from),Ne(dt.Z.SEEK_TARGET,{time:nt.from})),Qt?Ee():(ln?ln=!1:fe(),Ne(dt.Z.BUFFER_CLEARED,{from:nt.from,to:nt.to,unintended:nt.unintended,hasEnoughSpaceToAppend:we(),quotaExceeded:en})))}function _e(nt){return new Promise((function(rt){nt&&void 0!==nt.MSETimeOffset&&wt&&wt.updateTimestampOffset?wt.updateTimestampOffset(nt.MSETimeOffset).then((function(){rt()})).catch((function(){rt()})):rt()}))}function Te(){return wt&&!at?wt.updateAppendWindow(An):Promise.resolve()}function Se(){++Wt*(In.get().streaming.wallclockTimeUpdateInterval/1e3)>=In.get().streaming.buffer.bufferPruningInterval&&(Wt=0,pe())}function be(){ge()}function Ae(nt){(at=nt)?Ne(dt.Z.BUFFERING_COMPLETED):St=Number.POSITIVE_INFINITY}function Ie(){try{var nt,rt,it=wt.getAllBufferRanges(),at=0;if(!it)return at;for(rt=0,nt=it.length;rt<nt;rt++)at+=it.end(rt)-it.start(rt);return at}catch(nt){return 0}}function Re(nt){try{var rt=nt,it=wt.getAllBufferRanges();if(!it||0===it.length)return NaN;for(var at=0;rt===nt&&at<it.length;){var st=it.start(at),ot=it.end(at);rt>=st&&rt<=ot&&(rt=ot),at+=1}return rt===nt?NaN:rt}catch(nt){}}function we(){var nt=Ie();return isNaN(nt)||nt<lt}function Ne(nt,rt){var it=rt||{};pn.trigger(nt,it,{streamId:An.id,mediaType:Rn})}function Ce(nt,rt){if(lt=Number.POSITIVE_INFINITY,Bt=void 0,St=Number.POSITIVE_INFINITY,Et=0,Yt=null,at=!1,Qt=!1,en=!1,st=0,Wt=0,an=[],hn=NaN,Ct=!1,wt){var it=wt;wt=null,nt||rt||it.abort().then((function(){it.reset(rt),it=null}))}ln=!1}return rt={initialize:function(nt){W(nt),pn.on(dt.Z.INIT_FRAGMENT_LOADED,ee,rt),pn.on(dt.Z.MEDIA_FRAGMENT_LOADED,te,rt),pn.on(dt.Z.WALLCLOCK_TIME_UPDATED,Se,rt),pn.on(_t.Z.PLAYBACK_PLAYING,le,rt),pn.on(_t.Z.PLAYBACK_PROGRESS,se,rt),pn.on(_t.Z.PLAYBACK_TIME_UPDATED,se,rt),pn.on(_t.Z.PLAYBACK_RATE_CHANGED,be,rt),pn.on(_t.Z.PLAYBACK_STALLED,ue,rt)},getStreamId:function(){return An.id},getType:function(){return Rn},getBufferControllerType:function(){return $t},createBufferSink:Q,dischargePreBuffer:function(){if(wt&&Lt&&"function"==typeof Lt.discharge){var nt=Lt.getAllBufferRanges();if(nt.length>0){for(var rt="Beginning "+Rn+"PreBuffer discharge, adding buffer for:",at=0;at<nt.length;at++)rt+=" start: "+nt.start(at)+", end: "+nt.end(at)+";";it.debug(rt)}else it.debug("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");Pt=[];for(var st=Lt.discharge(),ot=null,lt=0;lt<st.length;lt++){var ut=st[lt];if(ut.segmentType!==Ut.w.INIT_SEGMENT_TYPE){var ct=nn.extract(ut.streamId,ut.representationId);ct&&ot!==ct&&(Pt.push(ct),wt.append(ct),ot=ct)}Pt.push(ut),wt.append(ut)}Lt.reset(),Lt=null}},getBuffer:function(){return wt},getBufferLevel:function(){return st},getRangeAt:ce,hasBufferAtTime:function(nt){try{var rt=wt.getAllBufferRanges();if(!rt||0===rt.length)return!1;for(var at=0;at<rt.length;){var st=rt.start(at),ot=rt.end(at);if(nt>=st&&nt<=ot)return!0;at+=1}return!1}catch(nt){return it.error(nt),!1}},pruneBuffer:pe,setMediaSource:W,getMediaSource:function(){return ht},appendInitSegmentFromCache:function(nt){var rt=nn.extract(An.id,nt);return!!rt&&(it.info("Append Init fragment",Rn," with representationId:",rt.representationId," and quality:",rt.quality,", data size:",rt.bytes.byteLength),ne(rt),!0)},getIsBufferingCompleted:function(){return at},setIsBufferingCompleted:Ae,getIsPruningInProgress:function(){return Qt},reset:function(nt,rt){pn.off(dt.Z.INIT_FRAGMENT_LOADED,ee,this),pn.off(dt.Z.MEDIA_FRAGMENT_LOADED,te,this),pn.off(dt.Z.WALLCLOCK_TIME_UPDATED,Se,this),pn.off(_t.Z.PLAYBACK_PLAYING,le,this),pn.off(_t.Z.PLAYBACK_PROGRESS,se,this),pn.off(_t.Z.PLAYBACK_TIME_UPDATED,se,this),pn.off(_t.Z.PLAYBACK_RATE_CHANGED,be,this),pn.off(_t.Z.PLAYBACK_STALLED,ue,this),Ce(nt,rt)},prepareForPlaybackSeek:function(){return at&&Ae(!1),wt.abort()},prepareForReplacementTrackSwitch:function(nt){return new Promise((function(rt,it){wt.abort().then((function(){return Te()})).then((function(){return In.get().streaming.buffer.useChangeTypeForTrackSwitch?wt.changeType(nt):Promise.resolve()})).then((function(){return ae()})).then((function(){Ae(!1),rt()})).catch((function(nt){it(nt)}))}))},prepareForNonReplacementTrackSwitch:function(nt){return new Promise((function(rt,it){Te().then((function(){return In.get().streaming.buffer.useChangeTypeForTrackSwitch?wt.changeType(nt):Promise.resolve()})).then((function(){rt()})).catch((function(nt){it(nt)}))}))},prepareForForceReplacementQualitySwitch:function(nt){return new Promise((function(rt,it){wt.abort().then((function(){return Te()})).then((function(){return ae()})).then((function(){return _e(nt)})).then((function(){Ae(!1),rt()})).catch((function(nt){it(nt)}))}))},updateAppendWindow:Te,getAllRangesWithSafetyFactor:oe,getContinuousBufferTimeForTargetTime:Re,clearBuffers:ye,pruneAllSafely:ae,updateBufferTimestampOffset:_e,setSeekTarget:function(nt){hn=nt},segmentRequestingCompleted:function(nt){isNaN(nt)||(St=nt,de())}},it=(0,pt.Z)(fn).getInstance().getLogger(rt),nn=jt(fn).getInstance(),Ce(),rt}U.__dashjs_factory_name=$t;var Yt=ht.Z.getClassFactory(U),Wt="NotFragmentedTextBufferController";function G(nt){nt=nt||{};var rt,it,at,st,ot,lt,ut=this.context,ht=(0,ct.Z)(ut).getInstance(),pt=nt.textController,_t=nt.errHandler,Et=nt.streamInfo,St=nt.type;function p(nt){st=nt}function m(nt){var rt,at;it!==nt&&(it=nt)&&(rt=dt.Z.BUFFERING_COMPLETED,at={},ht.trigger(rt,at,{streamId:Et.id,mediaType:St}))}function y(nt){nt.chunk.bytes&&!it&&(lt.save(nt.chunk),ot.append(nt.chunk),m(!0))}return rt={initialize:function(nt){p(nt)},getStreamId:function(){return Et.id},getType:function(){return St},getBufferControllerType:function(){return Wt},createBufferSink:function(nt){return new Promise((function(rt,it){try{(ot=Gt(ut).create({mediaSource:st,textController:pt,eventBus:ht})).initializeForFirstUse(Et,nt),at||(ot.getBuffer()&&"function"==typeof ot.getBuffer().initialize&&ot.getBuffer().initialize(),at=!0),rt(ot)}catch(nt){_t.error(new Ot.Z(Ft.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,Ft.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+St)),it(nt)}}))},dischargePreBuffer:function(){},getBuffer:function(){return ot},getBufferLevel:function(){return 0},getRangeAt:function(){return null},pruneBuffer:function(){},hasBufferAtTime:function(){return!0},getAllRangesWithSafetyFactor:function(){return[]},getContinuousBufferTimeForTargetTime:function(){return Number.POSITIVE_INFINITY},setMediaSource:p,getMediaSource:function(){return st},appendInitSegmentFromCache:function(nt){return null!==lt.extract(Et.id,nt)},getIsBufferingCompleted:function(){return it},setIsBufferingCompleted:m,getIsPruningInProgress:function(){return!1},reset:function(nt){ht.off(dt.Z.INIT_FRAGMENT_LOADED,y,rt),!nt&&ot&&(ot.abort(),ot.reset(),ot=null)},clearBuffers:function(){return Promise.resolve()},prepareForPlaybackSeek:function(){return Promise.resolve()},prepareForReplacementTrackSwitch:function(){return it=!1,Promise.resolve()},setSeekTarget:function(){},updateAppendWindow:function(){return Promise.resolve()},pruneAllSafely:function(){return Promise.resolve()},updateBufferTimestampOffset:function(){return Promise.resolve()},segmentRequestingCompleted:function(){}},at=!1,st=null,it=!1,lt=jt(ut).getInstance(),ht.on(dt.Z.INIT_FRAGMENT_LOADED,y,rt),rt}G.__dashjs_factory_name=Wt;var Qt=ht.Z.getClassFactory(G);function Y(nt){nt=nt||{};var rt,it,at,st,lt,ht,Et,St,wt,Lt,Ct,Pt,Ot,Ft=this.context,Bt=(0,ct.Z)(Ft).getInstance(),Ut=nt.dashMetrics,Gt=nt.mediaPlayerModel,Ht=nt.fragmentModel,jt=nt.abrController,Kt=nt.playbackController,$t=nt.textController,Yt=nt.type,Wt=nt.bufferController,Qt=nt.representationController,en=nt.settings;function P(){Pt=!0}function L(){Pt=!1}function F(nt){if(!Wt.getIsBufferingCompleted()){x();var rt=isNaN(nt)?0:nt;lt=setTimeout(k,rt)}}function x(){lt&&(clearTimeout(lt),lt=null)}function k(){try{if(function(){try{return Yt===ot.Z.TEXT&&!$t.isTextEnabled()||Kt.isPaused()&&(!Kt.getStreamController().getInitialPlayback()||!Kt.getStreamController().getAutoPlay())&&!en.get().streaming.scheduling.scheduleWhilePaused}catch(nt){return!1}}())return void x();if(function(){try{return!!Pt&&Qt.getCurrentRepresentationInfo()&&(isNaN(wt)||Lt||(nt=it.id,rt=jt.getMaxAllowedIndexFor(Yt,nt),!(!isNaN(St)&&St==rt||(at.info("Top quality "+Yt+" index has changed from "+St+" to "+rt),St=rt,0)))||function(){var nt=Qt.getCurrentRepresentationInfo();return!Yt||!nt||Ut.getCurrentBufferLevel(Yt)<U()}())}catch(nt){return!1}var nt,rt}()){var nt=!1;Ot&&(nt=jt.checkPlaybackQuality(Yt,it.id)),nt||(st=Qt.getCurrentRepresentationInfo(),Ct||st.quality!==wt||Lt?(Lt?(at.debug("Switch track for "+Yt+", representation id = "+st.id),Lt=!1):at.debug("Quality has changed, get init request for representationid = "+st.id),Bt.trigger(dt.Z.INIT_FRAGMENT_NEEDED,{representationId:st.id,sender:rt},{streamId:it.id,mediaType:Yt}),Ot=!1,Ct=!1):(at.debug("Media segment needed for ".concat(Yt," and stream id ").concat(it.id)),Bt.trigger(dt.Z.MEDIA_FRAGMENT_NEEDED,{},{streamId:it.id,mediaType:Yt}),Ot=!0))}else F(Kt.getLowLatencyModeEnabled()?en.get().streaming.scheduling.lowLatencyTimeout:en.get().streaming.scheduling.defaultTimeout)}catch(nt){F(Kt.getLowLatencyModeEnabled()?en.get().streaming.scheduling.lowLatencyTimeout:en.get().streaming.scheduling.defaultTimeout)}var st}function U(){var nt=NaN,rt=Qt.getCurrentRepresentationInfo();return Yt&&rt?(nt=Yt===ot.Z.TEXT?function(){try{if($t.isTextEnabled()){var nt=Qt.getCurrentRepresentationInfo();if(isNaN(nt.fragmentDuration)){var rt=Ut.getCurrentSchedulingInfo(ut.Z.SCHEDULING_INFO);return rt?rt.duration:0}return nt.fragmentDuration}return 0}catch(nt){return 0}}():Yt===ot.Z.AUDIO&&ht?function(){try{var nt=Ut.getCurrentBufferLevel(ot.Z.VIDEO),rt=Qt.getCurrentRepresentationInfo();return isNaN(rt.fragmentDuration)?nt+1:Math.max(nt+1,rt.fragmentDuration)}catch(nt){return 0}}():function(){try{var nt=Qt.getCurrentRepresentationInfo().mediaInfo.streamInfo;return jt.isPlayingAtTopQuality(nt)?nt.manifestInfo.duration>=en.get().streaming.buffer.longFormContentDurationThreshold?en.get().streaming.buffer.bufferTimeAtTopQualityLongForm:en.get().streaming.buffer.bufferTimeAtTopQuality:Gt.getStableBufferTime()}catch(nt){return Gt.getStableBufferTime()}}(),nt):nt}function Z(){B(!0)}function B(nt){if(Kt&&Ht){var rt=Ht.getRequests({state:kt.FRAGMENT_MODEL_EXECUTED,time:Kt.getTime(),threshold:0})[0];rt&&Kt.getTime()>=rt.startTime&&((!Et.mediaInfo||rt.mediaInfo.type===Et.mediaInfo.type&&rt.mediaInfo.index!==Et.mediaInfo.index)&&nt&&Bt.trigger(dt.Z.TRACK_CHANGE_RENDERED,{mediaType:Yt,oldMediaInfo:Et.mediaInfo,newMediaInfo:rt.mediaInfo,streamId:it.id}),rt.quality===Et.quality&&rt.adaptationIndex===Et.adaptationIndex||!nt||(at.debug("Quality change rendered for streamId ".concat(it.id," and type ").concat(Yt)),Bt.trigger(dt.Z.QUALITY_CHANGE_RENDERED,{mediaType:Yt,oldQuality:Et.quality,newQuality:rt.quality,streamId:it.id})),Et={mediaInfo:rt.mediaInfo,quality:rt.quality,adaptationIndex:rt.adaptationIndex})}}function G(){Ht.abortRequests(),x()}function q(){en.get().streaming.scheduling.scheduleWhilePaused||F()}function Y(nt){Ut.updatePlayListTraceMetrics({playbackspeed:nt.playbackRate.toString()})}function j(){Ot=!0,st=0,wt=NaN,Et={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN},St=NaN,Lt=!1,Ct=!1,Pt=!0}return rt={initialize:function(nt){ht=nt,Bt.on(dt.Z.URL_RESOLUTION_FAILED,G,rt),Bt.on(_t.Z.PLAYBACK_STARTED,q,rt),Bt.on(_t.Z.PLAYBACK_RATE_CHANGED,Y,rt),Bt.on(_t.Z.PLAYBACK_TIME_UPDATED,Z,rt),Bt.on(_t.Z.MANAGED_MEDIA_SOURCE_START_STREAMING,P,rt),Bt.on(_t.Z.MANAGED_MEDIA_SOURCE_END_STREAMING,L,rt)},getType:function(){return Yt},getStreamId:function(){return it.id},setTimeToLoadDelay:function(nt){st=nt},getTimeToLoadDelay:function(){return st},setSwitchTrack:function(nt){Lt=nt},getSwitchTrack:function(){return Lt},startScheduleTimer:F,clearScheduleTimer:x,reset:function(){Bt.off(dt.Z.URL_RESOLUTION_FAILED,G,rt),Bt.off(_t.Z.PLAYBACK_STARTED,q,rt),Bt.off(_t.Z.PLAYBACK_RATE_CHANGED,Y,rt),Bt.off(_t.Z.PLAYBACK_TIME_UPDATED,Z,rt),Bt.off(_t.Z.MANAGED_MEDIA_SOURCE_START_STREAMING,P,rt),Bt.off(_t.Z.MANAGED_MEDIA_SOURCE_END_STREAMING,L,rt),x(),B(!1),j(),it=null},getBufferTarget:U,getPlaybackController:function(){return Kt},setCheckPlaybackQuality:function(nt){Ot=nt},setInitSegmentRequired:function(nt){Ct=nt},setLastInitializedQuality:function(nt){wt=nt}},at=(0,pt.Z)(Ft).getInstance().getLogger(rt),j(),it=nt.streamInfo,rt}Y.__dashjs_factory_name="ScheduleController";var en=ht.Z.getClassFactory(Y),nn=it(7387);function V(nt){var rt,it,at,st,lt,ut,ct=(nt=nt||{}).eventBus,dt=nt.events,ht=nt.abrController,pt=nt.dashMetrics,Et=nt.playbackController,St=nt.timelineConverter,wt=nt.type,Lt=nt.streamInfo,Ct=nt.dashConstants,Pt=nt.segmentsController,kt=nt.isDynamic,Ot=nt.adapter;function T(){return wt}function S(){return at}function b(){return ut}function A(){it=null,at=!0,st=[],lt=null}function I(nt){return new Promise((function(rt,it){var at=nt.hasInitialization(),ot=nt.hasSegments(),lt=[];lt.push(Pt.updateInitData(nt,at)),lt.push(Pt.updateSegmentData(nt,ot)),Promise.all(lt).then((function(it){var at;it[0]&&!it[0].error&&(nt=function(nt,rt){return rt&&!rt.error&&rt.representation?rt.representation:nt}(nt,it[0])),it[1]&&!it[1].error&&(nt=function(nt,rt){if(rt&&!rt.error){var it,at,st,ot,lt=rt.segments,ut=[],ct=0;for(it=0,at=lt?lt.length:0;it<at;it++)st=lt[it],(ot=(0,nn.TJ)(St,kt,nt,st.startTime,st.duration,st.timescale,st.media,st.mediaRange,ct))&&(ut.push(ot),ot=null,ct++);return ut.length>0&&(nt.segments=ut),nt}}(nt,it[1])),(at=nt).mediaFinishedInformation=Pt.getMediaFinishedInformation(at),function(nt){if(S()){var rt,it,at=pt.getCurrentManifestUpdate(),ot=!1;if(at){for(var lt=0;lt<at.representationInfo.length;lt++)if((rt=at.representationInfo[lt]).index===nt.index&&rt.mediaType===T()){ot=!0;break}ot||pt.addManifestUpdateRepresentationInfo(nt,T())}if(function(){for(var nt=0,rt=st.length;nt<rt;nt++){var it=st[nt].segmentInfoType;if(!st[nt].hasInitialization()||(it===Ct.SEGMENT_BASE||it===Ct.BASE_URL)&&!st[nt].segments)return!1}return!0}()){ht.setPlaybackQuality(wt,Lt,(it=ut,st.indexOf(it)));var ct=pt.getCurrentDVRInfo(wt);ct&&pt.updateManifestUpdateInfo({latency:ct.range.end-Et.getTime()}),pt.getCurrentRepresentationSwitch(b().adaptation.type)||R(),N()}}}(nt),rt()})).catch((function(nt){it(nt)}))}))}function R(){!function(){if(!(ht&&pt&&Et&&St))throw new Error(ot.Z.MISSING_CONFIG_ERROR)}();var nt=new Date,rt=b(),it=1e3*Et.getTime();rt&&pt.addRepresentationSwitch(rt.adaptation.type,nt,it,rt.id),ct.trigger(_t.Z.REPRESENTATION_SWITCH,{mediaType:wt,streamId:Lt.id,currentRepresentation:rt,numberOfRepresentations:st.length},{streamId:Lt.id,mediaType:wt})}function w(nt){return null==nt||nt>=st.length?null:st[nt]}function N(nt){at=!1,ct.trigger(dt.DATA_UPDATE_COMPLETED,{data:it,currentRepresentation:ut,error:nt},{streamId:Lt.id,mediaType:wt})}function C(nt){ut=nt,lt=Ot.convertRepresentationToRepresentationInfo(ut)}function D(nt){if(nt.newDuration){var rt=b();rt&&rt.adaptation.period&&(rt.adaptation.period.duration=nt.newDuration)}}return rt={getStreamId:function(){return Lt.id},getType:T,getData:function(){return it},isUpdating:S,updateData:function(nt,rt,lt,ut,ct){return new Promise((function(dt,ht){if(at=!0,st=rt,it=nt,C(w(ct)),lt!==ot.Z.VIDEO&&lt!==ot.Z.AUDIO&&(lt!==ot.Z.TEXT||!ut))return N(),void dt();for(var pt=[],_t=0,Et=st.length;_t<Et;_t++){var St=st[_t];pt.push(I(St))}Promise.all(pt).then((function(){C(w(ct)),dt()})).catch((function(nt){ht(nt)}))}))},getCurrentRepresentation:b,getCurrentRepresentationInfo:function(){return lt},getRepresentationForQuality:w,prepareQualityChange:function(nt){C(w(nt)),R()},reset:function(){ct.off(_t.Z.MANIFEST_VALIDITY_CHANGED,D,rt),A()}},A(),ct.on(_t.Z.MANIFEST_VALIDITY_CHANGED,D,rt),rt}V.__dashjs_factory_name="RepresentationController";var an=ht.Z.getClassFactory(V),ln=it(3106),hn=it(9326),fn=it(7473),pn=it(2594);function J(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}var mn=function e(){J(this,e),this.start=null,this.mstart=null,this.starttype=null,this.trace=[]};mn.INITIAL_PLAYOUT_START_REASON="initial_playout",mn.SEEK_START_REASON="seek",mn.RESUME_FROM_PAUSE_START_REASON="resume",mn.METRICS_COLLECTION_START_REASON="metrics_collection_start";var gn=function e(){J(this,e),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null};gn.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",gn.REBUFFERING_REASON="rebuffering",gn.USER_REQUEST_STOP_REASON="user_request",gn.END_OF_PERIOD_STOP_REASON="end_of_period",gn.END_OF_CONTENT_STOP_REASON="end_of_content",gn.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",gn.FAILURE_STOP_REASON="failure";var _n=it(7802);function ne(){return{ntpToUTC:function(nt){var rt=new Date(Date.UTC(1900,0,1,0,0,0));return new Date(rt.getTime()+nt).getTime()}}}ne.__dashjs_factory_name="TimeUtils";var vn=ht.Z.getSingletonFactory(ne);function ie(nt){nt=nt||{};var rt,it,at,st,ht,Et,St,wt,Lt,Ct,Pt,Bt,Gt,Ht,jt,Kt=this.context,$t=(0,ct.Z)(Kt).getInstance(),Wt=nt.streamInfo,nn=nt.type,mn=nt.errHandler,En=nt.mimeType,Tn=nt.timelineConverter,bn=nt.adapter,An=nt.manifestModel,Rn=nt.mediaPlayerModel,In=nt.fragmentModel,Ln=nt.abrController,Dn=nt.playbackController,Mn=nt.mediaController,Nn=nt.textController,xn=nt.dashMetrics,Un=nt.settings,Hn=nt.boxParser,Kn=nt.segmentBlacklistController;function ne(){return Wt.id}function ie(){return nn}function ae(){return bn.getIsTextTrack(wt.getData())}function oe(){ht=[],st=null,Ht=0,Lt=!1,Ct=!1,Pt=!1,jt=null}function se(nt){return!isNaN(nt)&&!isNaN(Wt.duration)&&isFinite(Wt.duration)&&nt>=Wt.start+Wt.duration}function ue(nt){var rt=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(nt.sender)if(Dn.getIsManifestUpdateInProgress())ge();else if((!ae()||Nn.isTextEnabled())&&Et&&nt.representationId&&!Et.appendInitSegmentFromCache(nt.representationId)){var it=wt.getCurrentRepresentation();if(0===it.range)return void le();var at=Bt?Bt.getInitRequest(st,it):null;at?In.executeRequest(at):rt&&(St.setInitSegmentRequired(!0),ge())}}function le(nt){var rt=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Dn.getIsManifestUpdateInProgress()||Et.getIsPruningInProgress())ge();else{var it=de();it?(Lt=!1,Ct=!1,ce(it)):fe(rt)}}function ce(nt){isNaN(nt.startTime+nt.duration)||(Ht=nt.startTime+nt.duration),nt.delayLoadingTime=(new Date).getTime()+St.getTimeToLoadDelay(),St.setTimeToLoadDelay(0),function(nt){var rt=nt.url;return nt.range&&(rt=rt.concat("_",nt.range)),Kn.contains(rt)}(nt)?(it.warn("Fragment request url ".concat(nt.url," for stream id ").concat(Wt.id," and media type ").concat(nn," is on the ignore list and will be skipped")),ge()):(it.debug("Next fragment request url for stream id ".concat(Wt.id," and media type ").concat(nn," is ").concat(nt.url)),In.executeRequest(nt))}function fe(nt){var rt,ot=wt.getCurrentRepresentation();if(!Un.get().streaming.gaps.enableSeekFix||!Lt&&0!==Dn.getTime()||(at?at&&ot.segmentInfoType===lt.Z.SEGMENT_TIMELINE&&(rt=Bt.getValidTimeAheadOfTargetTime(Ht,st,ot,Un.get().streaming.gaps.threshold)):rt=Bt.getValidTimeAheadOfTargetTime(Ht,st,ot,Un.get().streaming.gaps.threshold),isNaN(rt)||rt===Ht)){if(Bt.isLastSegmentRequested(ot,Ht)){var ut=Bt.getCurrentIndex();return it.debug("Segment requesting for stream ".concat(Wt.id," has finished")),$t.trigger(dt.Z.STREAM_REQUESTING_COMPLETED,{segmentIndex:ut},{streamId:Wt.id,mediaType:nn}),Et.segmentRequestingCompleted(ut),void St.clearScheduleTimer()}nt&&ge()}else Dn.isSeeking()||0===Dn.getTime()?(it.warn("Adjusting playback time ".concat(rt," because of gap in the manifest. Seeking by ").concat(rt-Ht)),Dn.seek(rt,!1,!1)):(it.warn("Adjusting buffering time ".concat(rt," because of gap in the manifest. Adjusting time by ").concat(rt-Ht)),Fe(rt),nt&&ge())}function de(){var nt,rt=Ne();if(isNaN(Ht)||ie()===ot.Z.TEXT&&!Nn.isTextEnabled())return null;if(Bt){var it=wt&&rt?wt.getRepresentationForQuality(rt.quality):null;nt=Lt?Bt.getSegmentRequestForTime(st,it,Ht):Ct?Bt.repeatSegmentRequest(st,it):Bt.getNextSegmentRequest(st,it)}return nt}function ge(){St.startScheduleTimer(Dn.getLowLatencyModeEnabled()?Un.get().streaming.scheduling.lowLatencyTimeout:Un.get().streaming.scheduling.defaultTimeout)}function he(nt){nt.error||Et.getIsBufferingCompleted()||Et.updateBufferTimestampOffset(nt.currentRepresentation)}function pe(nt){xn.addBufferState(nn,nt.state,St.getBufferTarget()),nt.state!==ut.Z.BUFFER_EMPTY||Dn.isSeeking()||(it.info("Buffer is empty! Stalling!"),xn.pushPlayListTraceMetrics(new Date,gn.REBUFFERING_REASON))}function me(nt){In.syncExecutedRequestsWithBufferedRange(Et.getBuffer().getAllBufferRanges(),Wt.duration),nt.quotaExceeded&&nt.from>Dn.getTime()&&Fe(nt.from),nt.hasEnoughSpaceToAppend&&nt.quotaExceeded&&St.startScheduleTimer()}function ye(nt){if(nt&&nt.lastRequestAppended&&nt.lastRequestAppended.url){var rt=nt.lastRequestAppended.url;nt.lastRequestAppended.range&&(rt=rt.concat("_",nt.lastRequestAppended.range)),it.warn("Blacklisting segment with url ".concat(rt)),Kn.add(rt)}}function Ee(nt){if(it.debug("Appended bytes for ".concat(nt.mediaType," and stream id ").concat(nt.streamId)),nt.segmentType===Ut.w.INIT_SEGMENT_TYPE){var rt=nt.quality;St.setLastInitializedQuality(rt),it.info("["+nn+"] lastInitializedRepresentationInfo changed to "+nt.quality)}jt?ve(jt):St.startScheduleTimer(0)}function ve(nt){var rt=In.getRequests({state:kt.FRAGMENT_MODEL_LOADING});if(rt&&rt.length>0)return it.debug("Preparing for default quality switch: Waiting for ongoing segment request to be finished before applying switch."),void(jt=nt);Et.updateBufferTimestampOffset(nt).then((function(){St.setCheckPlaybackQuality(!1),st.segmentAlignment||st.subSegmentAlignment?St.startScheduleTimer():Pe(),jt=null,Pt=!1})).catch((function(){jt=null,Pt=!1}))}function _e(nt){it.info("onFragmentLoadingAbandoned request: "+nt.request.url+" has been aborted"),Dn.isSeeking()||St.getSwitchTrack()||Pt||(it.info("onFragmentLoadingAbandoned request: "+nt.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),nt.request&&nt.request.isInitializationRequest()?St.setInitSegmentRequired(!0):Fe(nt.request.startTime+nt.request.duration/2),St.startScheduleTimer(0))}function Te(nt){it.info("OnFragmentLoadingCompleted for stream id "+Wt.id+" and media type "+nn+" - Url:",nt.request?nt.request.url:"undefined",nt.request.range?", Range:"+nt.request.range:""),ae()&&St.startScheduleTimer(0),nt.error&&nt.request.serviceLocation&&function(nt){it.info("Fragment loading completed with an error"),nt&&nt.request&&nt.request.type&&(nt.request.type===Ut.w.INIT_SEGMENT_TYPE?ue({representationId:nt.request.representationId,sender:{}},!1):nt.request.type===Ut.w.MEDIA_SEGMENT_TYPE&&(Fe(nt.request.startTime+nt.request.duration/2),le({},!1)))}(nt)}function Se(){Fe(Dn.getTime()),we().startScheduleTimer()}function be(nt){var rt=nt.currentTrackInfo;if(rt){var it=ht.find((function(nt){return nt.index===rt.index&&nt.lang===rt.lang}));it&&Re(it).then((function(){Et.setIsBufferingCompleted(!1),Fe(Dn.getTime()),St.setInitSegmentRequired(!0),St.startScheduleTimer()}))}}function Ae(nt){Fe(nt.quotaExceededTime),St.clearScheduleTimer()}function Ie(){return Et?Et.getBuffer():null}function Re(nt){nt===st||nt&&st&&nt.type!==st.type||(st=nt);var rt=bn.getRealAdaptation(Wt,st),it=bn.getVoRepresentations(st);if(wt){var lt,ut=wt.getData(),ct=Ln.getMaxAllowedIndexFor(nn,Wt.id),dt=Ln.getMinAllowedIndexFor(nn,Wt.id),ht=null;return null!==ut&&ut.id===rt.id||nn===ot.Z.TEXT?lt=Ln.getQualityFor(nn,Wt.id):(ht=Ln.getThroughputHistory().getAverageThroughput(nn,at)||Ln.getInitialBitrateFor(nn,Wt.id),lt=Ln.getQualityForBitrate(st,ht,Wt.id)),void 0!==dt&&lt<dt&&(lt=dt),lt>ct&&(lt=ct),wt.updateData(rt,it,nn,st.isFragmented,lt)}return Promise.resolve()}function we(){return St}function Ne(nt){var rt;return void 0!==nt?((0,ln.SE)(nt),rt=wt?wt.getRepresentationForQuality(nt):null):rt=wt?wt.getCurrentRepresentation():null,bn.convertRepresentationToRepresentationInfo(rt)}function Ce(){return!!Et&&Et.getIsBufferingCompleted()}function De(nt){if(Un.get().streaming.enableManifestTimescaleMismatchFix){var rt=nt.chunk,it=rt.bytes,at=Ne(rt.quality),st=wt&&at?wt.getRepresentationForQuality(at.quality):null;at&&st&&(st.timescale=Hn.getMediaTimescaleFromMoov(it))}}function Oe(nt){var rt=nt.chunk,it=rt.bytes,at=rt.quality,st=Ne(at),ot=wt&&st?wt.getRepresentationForQuality(st.quality):null;if(st&&ot){var ut;if(Un.get().streaming.parseInbandPrft&&nt.request.type===Ut.w.MEDIA_SEGMENT_TYPE){var ct=function(nt,rt){var it=nt.getBoxes("prft"),at=[];return it.forEach((function(nt){at.push(function(nt,rt){var it="unknown";switch(nt.flags){case 0:it=lt.Z.PRODUCER_REFERENCE_TIME_TYPE.ENCODER;break;case 16:it=lt.Z.PRODUCER_REFERENCE_TIME_TYPE.APPLICATION;break;case 24:it=lt.Z.PRODUCER_REFERENCE_TIME_TYPE.CAPTURED}var at=1e3*nt.ntp_timestamp_sec+nt.ntp_timestamp_frac/Math.pow(2,32)*1e3;return{type:it,ntpTimestamp:at=vn(Kt).getInstance().ntpToUTC(at),mediaTime:nt.media_time/rt}}(nt,rt))})),at}(ut=ut||Hn.parse(it),ot.timescale);ct&&ct.length&&$t.trigger(_t.Z.INBAND_PRFT,{data:ct},{streamId:Wt.id,mediaType:nn})}var ht=bn.getEventsFor(st.mediaInfo,null,Wt),pt=bn.getEventsFor(st,ot,Wt);if(ht&&ht.length>0||pt&&pt.length>0){var Et=In.getRequests({state:kt.FRAGMENT_MODEL_EXECUTED,quality:at,index:rt.index})[0],St=function(nt,rt,it,at){try{for(var st={},ot=[],lt=it.concat(at),ut=0,ct=lt.length;ut<ct;ut++)st[lt[ut].schemeIdUri+"/"+lt[ut].value]=lt[ut];var dt=nt.getBoxes("emsg");if(!dt||0===dt.length)return ot;for(var ht=nt.getBox("sidx"),pt=!ht||isNaN(ht.earliest_presentation_time)||isNaN(ht.timescale)?rt&&!isNaN(rt.mediaStartTime)?rt.mediaStartTime:0:ht.earliest_presentation_time/ht.timescale,_t=Math.max(pt,0),Et=wt.getCurrentRepresentation(),St=0,Lt=dt.length;St<Lt;St++){var Ct=bn.getEvent(dt[St],st,_t,Et);Ct&&ot.push(Ct)}return ot}catch(nt){return[]}}(ut=ut||Hn.parse(it),Et,ht,pt);$t.trigger(dt.Z.INBAND_EVENTS,{events:St},{streamId:Wt.id})}}}function Me(){var nt=Dn.getTime();Un.get().streaming.buffer.flushBufferAtTrackSwitch&&Dn.seek(nt+.001,!1,!0),Fe(nt),Et.setSeekTarget(nt),St.startScheduleTimer()}function Pe(){var nt=Dn.getTime(),rt=Et.getContinuousBufferTimeForTargetTime(nt);Fe(isNaN(rt)?nt:rt),St.startScheduleTimer()}function Le(nt){nt&&!isNaN(nt.time)&&(Fe(nt.time),Et.setSeekTarget(nt.time))}function Fe(nt){Ht=nt,Lt=!0}return rt={initialize:function(it,st,ut){Gt=(0,_n.Z)(Kt).create({events:dt.Z,eventBus:$t,streamInfo:Wt,timelineConverter:Tn,dashConstants:lt.Z,segmentBaseController:nt.segmentBaseController,type:nn}),Bt=(0,hn.Z)(Kt).create({streamInfo:Wt,type:nn,timelineConverter:Tn,dashMetrics:xn,mediaPlayerModel:Rn,baseURLController:nt.baseURLController,errHandler:mn,segmentsController:Gt,settings:Un,boxParser:Hn,events:dt.Z,eventBus:$t,errors:Ft,debug:(0,pt.Z)(Kt).getInstance(),requestModifier:(0,fn.Z)(Kt).getInstance(),dashConstants:lt.Z,constants:ot.Z,urlUtils:(0,pn.Z)(Kt).getInstance()}),at=Wt.manifestInfo.isDynamic,Bt.initialize(at),Ln.registerStreamType(nn,rt),wt=an(Kt).create({streamInfo:Wt,type:nn,abrController:Ln,dashMetrics:xn,playbackController:Dn,timelineConverter:Tn,dashConstants:lt.Z,events:dt.Z,eventBus:$t,errors:Ft,isDynamic:at,adapter:bn,segmentsController:Gt}),Et=function(nt,rt){return nt?nt!==ot.Z.TEXT||rt?Yt(Kt).create({streamInfo:Wt,type:nt,mediaPlayerModel:Rn,manifestModel:An,fragmentModel:In,errHandler:mn,mediaController:Mn,representationController:wt,adapter:bn,textController:Nn,abrController:Ln,playbackController:Dn,settings:Un}):Qt(Kt).create({streamInfo:Wt,type:nt,mimeType:En,fragmentModel:In,textController:Nn,errHandler:mn,settings:Un}):(mn.error(new Ot.Z(Ft.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,Ft.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+"not properly defined")),null)}(nn,ut),Et&&Et.initialize(it),(St=en(Kt).create({streamInfo:Wt,type:nn,mimeType:En,adapter:bn,dashMetrics:xn,mediaPlayerModel:Rn,fragmentModel:In,abrController:Ln,playbackController:Dn,textController:Nn,mediaController:Mn,bufferController:Et,representationController:wt,settings:Un})).initialize(st),Ht=0,Lt=!1,Ct=!1},getStreamId:ne,getType:ie,isUpdating:function(){return!!wt&&wt.isUpdating()},getBufferController:function(){return Et},dischargePreBuffer:function(){Et.dischargePreBuffer()},getFragmentModel:function(){return In},getScheduleController:we,getRepresentationController:function(){return wt},getRepresentationInfo:Ne,getBufferLevel:function(){return Et?Et.getBufferLevel():0},isBufferingCompleted:Ce,createBufferSinks:function(nt){var rt=Ie();return rt?Promise.resolve(rt):Et?Et.createBufferSink(st,nt):Promise.resolve(null)},updateStreamInfo:function(nt){return Wt=nt,Ce()?Promise.resolve():Et.updateAppendWindow()},getStreamInfo:function(){return Wt},selectMediaInfo:Re,clearMediaInfoArray:function(){ht=[]},addMediaInfo:function(nt){-1===ht.indexOf(nt)&&ht.push(nt)},prepareTrackSwitch:function(){return new Promise((function(nt){it.debug("Preparing track switch for type ".concat(nn));var rt=nn===ot.Z.TEXT||Un.get().streaming.trackSwitchMode[nn]===ot.Z.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&Dn.getTimeToStreamEnd(Wt)>Un.get().streaming.buffer.stallThreshold;if(Et.getIsBufferingCompleted()&&!rt)return Et.prepareForNonReplacementTrackSwitch(st.codec).then((function(){$t.trigger(dt.Z.BUFFERING_COMPLETED,{},{streamId:Wt.id,mediaType:nn})})).catch((function(){$t.trigger(dt.Z.BUFFERING_COMPLETED,{},{streamId:Wt.id,mediaType:nn})})),void nt();St.clearScheduleTimer(),St.setSwitchTrack(!0),rt?($t.trigger(dt.Z.BUFFER_REPLACEMENT_STARTED,{mediaType:nn,streamId:Wt.id},{mediaType:nn,streamId:Wt.id}),In.abortRequests(),Et.prepareForReplacementTrackSwitch(st.codec).then((function(){var nt=Ne();return Et.updateBufferTimestampOffset(nt)})).then((function(){Me(),nt()})).catch((function(){Me(),nt()}))):Et.prepareForNonReplacementTrackSwitch(st.codec).then((function(){Pe(),nt()})).catch((function(){Pe(),nt()}))}))},prepareQualityChange:function(nt){jt&&it.warn("Canceling queued representation switch to ".concat(jt.quality," for ").concat(nn)),it.debug("Preparing quality switch for type ".concat(nn));var rt=nt.newQuality;Pt=!0,St.clearScheduleTimer(),wt.prepareQualityChange(rt);var at=Ne(rt);nt.reason&&nt.reason.forceReplace?function(nt){In.abortRequests(),$t.trigger(dt.Z.BUFFER_REPLACEMENT_STARTED,{mediaType:nn,streamId:Wt.id},{mediaType:nn,streamId:Wt.id}),St.setCheckPlaybackQuality(!1),Et.prepareForForceReplacementQualitySwitch(nt).then((function(){Me(),jt=null,Pt=!1})).catch((function(){Me(),jt=null,Pt=!1}))}(at):nt&&nt.reason&&nt.reason.forceAbandon?function(nt){Et.updateBufferTimestampOffset(nt).then((function(){In.abortRequests(),Ct=!0,St.setCheckPlaybackQuality(!1),St.startScheduleTimer(),Pt=!1,jt=null})).catch((function(){jt=null,Pt=!1}))}(at):Un.get().streaming.buffer.fastSwitchEnabled?function(nt){var rt=Dn.getTime(),it=1.5*(isNaN(nt.fragmentDuration)?1:nt.fragmentDuration),at=In.getRequests({state:kt.FRAGMENT_MODEL_EXECUTED,time:rt+it,threshold:0})[0];if(at&&!ae()){var st=Et.getBufferLevel(),ot=Ln.getAbandonmentStateFor(Wt.id,nn);at.quality<nt.quality&&st>=it&&ot!==ut.Z.ABANDON_LOAD?Et.updateBufferTimestampOffset(nt).then((function(){In.abortRequests(),Fe(rt+it),St.setCheckPlaybackQuality(!1),St.startScheduleTimer(),Pt=!1})).catch((function(){Pt=!1})):ve(nt)}else ve(nt)}(at):ve(at),xn.pushPlayListTraceMetrics(new Date,gn.REPRESENTATION_SWITCH_STOP_REASON),xn.createPlaylistTraceMetrics(at.id,1e3*Dn.getTime(),Dn.getPlaybackRate())},getMediaInfo:function(){return st},getMediaSource:function(){return Et.getMediaSource()},setMediaSource:function(nt){return Et.setMediaSource(nt,st)},getBuffer:Ie,setExplicitBufferingTime:Fe,finalisePlayList:function(nt,rt){xn.pushPlayListTraceMetrics(nt,rt)},probeNextRequest:function(){var nt=Ne(),rt=wt&&nt?wt.getRepresentationForQuality(nt.quality):null;return Bt.getNextSegmentRequestIdempotent(st,rt)},prepareInnerPeriodPlaybackSeeking:function(nt){return new Promise((function(rt){if(Et.hasBufferAtTime(nt.seekTime))return Et.pruneBuffer(),se(Et.getContinuousBufferTimeForTargetTime(nt.seekTime))&&Et.setIsBufferingCompleted(!0),void rt();St.clearScheduleTimer(),In.abortRequests(),Et.prepareForPlaybackSeek().then((function(){var rt=Et.getAllRangesWithSafetyFactor(nt.seekTime);return Et.clearBuffers(rt)})).then((function(){var it=Et.getContinuousBufferTimeForTargetTime(nt.seekTime);if(se(it))Et.setIsBufferingCompleted(!0),rt();else{var at=isNaN(it)?nt.seekTime:it;Fe(at),Et.setSeekTarget(at);var st=[];st.push(Et.updateAppendWindow());var ot=Ne();st.push(Et.updateBufferTimestampOffset(ot)),Promise.all(st).then((function(){St.setInitSegmentRequired(!0),St.setCheckPlaybackQuality(!1),St.startScheduleTimer(),rt()}))}})).catch((function(nt){it.error(nt)}))}))},prepareOuterPeriodPlaybackSeeking:function(){return new Promise((function(nt,rt){try{St.clearScheduleTimer(),In.abortRequests(),Et.prepareForPlaybackSeek().then((function(){return Et.pruneAllSafely()})).then((function(){nt()}))}catch(nt){rt(nt)}}))},reset:function(nt,it){Bt&&Bt.reset(),Et&&(Et.reset(nt,it),Et=null),St&&(St.reset(),St=null),wt&&(wt.reset(),wt=null),Gt&&(Gt=null),Ln&&Ln.unRegisterStreamType(ne(),nn),$t.off(dt.Z.DATA_UPDATE_COMPLETED,he,rt),$t.off(dt.Z.INIT_FRAGMENT_NEEDED,ue,rt),$t.off(dt.Z.MEDIA_FRAGMENT_NEEDED,le,rt),$t.off(dt.Z.INIT_FRAGMENT_LOADED,De,rt),$t.off(dt.Z.MEDIA_FRAGMENT_LOADED,Oe,rt),$t.off(dt.Z.BUFFER_LEVEL_STATE_CHANGED,pe,rt),$t.off(dt.Z.BUFFER_CLEARED,me,rt),$t.off(dt.Z.SEEK_TARGET,Le,rt),$t.off(dt.Z.FRAGMENT_LOADING_ABANDONED,_e,rt),$t.off(dt.Z.FRAGMENT_LOADING_COMPLETED,Te,rt),$t.off(dt.Z.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Se,rt),$t.off(dt.Z.SET_NON_FRAGMENTED_TEXT,be,rt),$t.off(dt.Z.QUOTA_EXCEEDED,Ae,rt),$t.off(dt.Z.SOURCE_BUFFER_ERROR,ye,rt),$t.off(dt.Z.BYTES_APPENDED_END_FRAGMENT,Ee,rt),oe(),nn=null,Wt=null}},it=(0,pt.Z)(Kt).getInstance().getLogger(rt),oe(),$t.on(dt.Z.DATA_UPDATE_COMPLETED,he,rt,{priority:ct.Z.EVENT_PRIORITY_HIGH}),$t.on(dt.Z.INIT_FRAGMENT_NEEDED,ue,rt),$t.on(dt.Z.MEDIA_FRAGMENT_NEEDED,le,rt),$t.on(dt.Z.INIT_FRAGMENT_LOADED,De,rt),$t.on(dt.Z.MEDIA_FRAGMENT_LOADED,Oe,rt),$t.on(dt.Z.BUFFER_LEVEL_STATE_CHANGED,pe,rt),$t.on(dt.Z.BUFFER_CLEARED,me,rt),$t.on(dt.Z.SEEK_TARGET,Le,rt),$t.on(dt.Z.FRAGMENT_LOADING_ABANDONED,_e,rt),$t.on(dt.Z.FRAGMENT_LOADING_COMPLETED,Te,rt),$t.on(dt.Z.QUOTA_EXCEEDED,Ae,rt),$t.on(dt.Z.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Se,rt),$t.on(dt.Z.SET_NON_FRAGMENTED_TEXT,be,rt),$t.on(dt.Z.SOURCE_BUFFER_ERROR,ye,rt),$t.on(dt.Z.BYTES_APPENDED_END_FRAGMENT,Ee,rt),rt}ie.__dashjs_factory_name="StreamProcessor";var En=ht.Z.getClassFactory(ie),Tn=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representationId=null,this.endFragment=null},bn=it(9032);function ue(nt,rt){if(nt){if("string"==typeof nt)return le(nt,rt);var it=Object.prototype.toString.call(nt).slice(8,-1);return"Object"===it&&nt.constructor&&(it=nt.constructor.name),"Map"===it||"Set"===it?Array.from(nt):"Arguments"===it||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(it)?le(nt,rt):void 0}}function le(nt,rt){(null==rt||rt>nt.length)&&(rt=nt.length);for(var it=0,at=new Array(rt);it<rt;it++)at[it]=nt[it];return at}function ce(nt){nt=nt||{};var rt,it,at=this.context,st=nt.requestModifier,lt=nt.lowLatencyThroughputModel,ut=nt.boxParser,ct=(0,Bt.Z)(at).getInstance();function l(nt){var rt,at=new Date,dt=nt.request,ht=new Headers;if(dt.range&&ht.append("Range","bytes="+dt.range),nt.headers)for(var pt in nt.headers){var _t=nt.headers[pt];_t&&ht.append(pt,_t)}dt.requestStartDate||(dt.requestStartDate=at),st&&st.modifyRequestHeader&&st.modifyRequestHeader({setRequestHeader:function(nt,rt){ht.append(nt,rt)}},{url:nt.url}),"function"==typeof window.AbortController&&(rt=new AbortController,nt.abortController=rt,rt.signal.onabort=nt.onabort);var Et={method:nt.method,headers:ht,credentials:nt.withCredentials?"include":void 0,signal:rt?rt.signal:void 0},St=ct.get().streaming.abr.fetchThroughputCalculationMode,wt=Date.now(),Lt=0;new Promise((function(nt){if(St===ot.Z.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&lt&&(Lt=lt.getThroughputCapacityDelayMS(dt,1e3*it.getCurrentBufferLevel(dt.mediaType))))return setTimeout(nt,Lt);nt()})).then((function(){var rt=Date.now();fetch(nt.url,Et).then((function(at){nt.response||(nt.response={}),nt.response.status=at.status,nt.response.statusText=at.statusText,nt.response.responseURL=at.url,at.ok||nt.onerror();var st,ct="",ht=function(nt){var rt;if("undefined"==typeof Symbol||null==nt[Symbol.iterator]){if(Array.isArray(nt)||(rt=ue(nt))){rt&&(nt=rt);var it=0,i=function(){};return{s:i,n:function(){return it>=nt.length?{done:!0}:{done:!1,value:nt[it++]}},e:function(nt){throw nt},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var at,st=!0,ot=!1;return{s:function(){rt=nt[Symbol.iterator]()},n:function(){var nt=rt.next();return st=nt.done,nt},e:function(nt){ot=!0,at=nt},f:function(){try{st||null==rt.return||rt.return()}finally{if(ot)throw at}}}}(at.headers.keys());try{for(ht.s();!(st=ht.n()).done;){var pt=st.value;ct+=pt+": "+at.headers.get(pt)+"\r\n"}}catch(nt){ht.e(nt)}finally{ht.f()}if(nt.response.responseHeaders=ct,!at.body)return at.arrayBuffer().then((function(rt){nt.response.response=rt;var it={loaded:rt.byteLength,total:rt.byteLength,stream:!1};nt.progress(it),nt.onload(),nt.onend()}));var _t,Et,Ct,Pt,kt=parseInt(at.headers.get("Content-Length"),10),Ot=0,Ft=!1,Bt=new Uint8Array,Ut=0;if(St===ot.Z.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&lt){var Gt=rt,Ht=0,jt=(Pt=2,function(nt){if(Array.isArray(nt))return nt}(Ct=at.body.tee())||function(nt,rt){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(nt)){var it=[],at=!0,st=!1,ot=void 0;try{for(var lt,ut=nt[Symbol.iterator]();!(at=(lt=ut.next()).done)&&(it.push(lt.value),!rt||it.length!==rt);at=!0);}catch(nt){st=!0,ot=nt}finally{try{at||null==ut.return||ut.return()}finally{if(st)throw ot}}return it}}(Ct,Pt)||ue(Ct,Pt)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),Kt=jt[0],$t=jt[1];_t=Kt.getReader(),Et=[],_t.read().then((function r(at){var st=at.value,ot=at.done;if(Ht=Date.now(),st&&st.length){var ut=Ht-Gt,ht=st.length;Et.push({chunkDownloadTimeRelativeMS:Ht-rt,chunkDownloadDurationMS:ut,chunkBytes:ht,kbps:Math.round(8*ht/(ut/1e3)),bufferLevel:it.getCurrentBufferLevel(dt.mediaType)})}if(ot){var pt=Ht-rt,St=Et.reduce((function(nt,rt){return nt+rt.chunkBytes}),0);return lt.addMeasurement(dt,pt,Et,wt,Lt,ct),void nt.progress({loaded:St,total:St,lengthComputable:!0,time:lt.getEstimatedDownloadDurationMS(dt),stream:!0})}return Gt=Date.now(),_t.read().then(r)})),nt.reader=$t.getReader()}else nt.reader=at.body.getReader();var Yt=[],Wt=[],Qt=[],en=!0;c(nt,(function t(rt){var it=rt.value;if(rt.done){if(Bt){if(St!==ot.Z.ABR_FETCH_THROUGHPUT_CALCULATION_AAST){var at=null,st=null;St===ot.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING?(at=function(nt,rt){try{var it,at;it=nt.filter((function(rt,it){return it<nt.length-1})),at=rt.filter((function(nt,it){return it<rt.length-1}));var st=[];if(it.length>1){for(var ot=0,lt=0,ut=0;ut<it.length;ut++)if(it[ut]&&at[ut]){var ct=at[ut].ts-it[ut].ts;if(ct>1)st.push(8*at[ut].bytes/ct),lt=0;else{0===lt&&(lt=it[ut].ts,ot=0);var dt=at[ut].ts-lt;dt>1?(ot+=at[ut].bytes,st.push(8*ot/dt),lt=0):ot+=at[ut].bytes}}if(st.length>0)return st.reduce((function(nt,rt){return nt+rt}),0)/st.length}return null}catch(nt){return null}}(Wt,Qt),at&&(st=8*Ot/at)):St===ot.Z.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA&&(st=f(Yt,Ot)),nt.progress({loaded:Ot,total:isNaN(kt)?Ot:kt,lengthComputable:!0,time:st,stream:!0})}nt.response.response=Bt.buffer}return nt.onload(),void nt.onend()}if(it&&it.length>0){Bt=function(nt,rt){if(0===nt.length)return rt;var it=new Uint8Array(nt.length+rt.length);return it.set(nt),it.set(rt,nt.length),it}(Bt,it),Ot+=it.length,Yt.push({ts:Date.now(),bytes:it.length}),St===ot.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&en&&ut.findLastTopIsoBoxCompleted(["moof"],Bt,Ut).found&&(en=!1,Wt.push({ts:performance.now(),bytes:it.length}));var lt=ut.findLastTopIsoBoxCompleted(["moov","mdat"],Bt,Ut);if(lt.found){var ct,dt=lt.lastCompletedOffset+lt.size;St!==ot.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING||en||(en=!0,Qt.push({ts:performance.now(),bytes:Bt.length})),dt===Bt.length?(ct=Bt,Bt=new Uint8Array):(ct=new Uint8Array(Bt.subarray(0,dt)),Bt=Bt.subarray(dt)),nt.progress({data:ct.buffer,lengthComputable:!1,noTrace:!0}),Ut=0}else Ut=lt.lastCompletedOffset,Ft||(nt.progress({lengthComputable:!1,noTrace:!0}),Ft=!0)}c(nt,t)}))})).catch((function(rt){nt.onerror&&nt.onerror(rt)}))}))}function c(nt,rt){nt.reader.read().then(rt).catch((function(rt){nt.onerror&&200===nt.response.status&&nt.onerror(rt)}))}function f(nt,rt){try{if((nt=nt.filter((function(it){return it.bytes>rt/4/nt.length}))).length>1){var it=0,at=(nt[nt.length-1].ts-nt[0].ts)/nt.length;return nt.forEach((function(rt,st){var ot=nt[st+1];if(ot){var lt=ot.ts-rt.ts;it+=lt<at?lt:0}})),it}return null}catch(nt){return null}}return rt={load:function(nt){st&&st.modifyRequest?(0,fn.k)(nt,st).then((function(){return l(nt)})):l(nt)},abort:function(nt){if(nt.abortController)nt.abortController.abort();else if(nt.reader)try{nt.reader.cancel(),nt.onabort()}catch(nt){}},calculateDownloadedTime:f,setup:function(nt){it=nt.dashMetrics}},rt}ce.__dashjs_factory_name="FetchLoader";var An=ht.Z.getClassFactory(ce),Rn=it(1180);function ge(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var In=function(){function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.codecs=null,this.mimeType=null,this.codecPrivateData=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.mediaFinishedInformation={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN},this.bandwidth=NaN,this.width=NaN,this.height=NaN,this.scanType=null,this.maxPlayoutRate=NaN,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0,this.frameRate=null}var nt;return(nt=[{key:"hasInitialization",value:function(){return null!==this.initialization||null!==this.range}},{key:"hasSegments",value:function(){return this.segmentInfoType!==lt.Z.BASE_URL&&this.segmentInfoType!==lt.Z.SEGMENT_BASE&&!this.indexRange}}])&&ge(e.prototype,nt),e}(),Ln=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.period=null,this.index=-1,this.type=null},Dn=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null,this.nextPeriodId=null};Dn.DEFAULT_ID="defaultId";var Mn=Dn,Nn=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.publishTime=null,this.minimumUpdatePeriod=NaN,this.mediaPresentationDuration=NaN},xn=it(2610),Un=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="",this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN},Hn=function e(nt,rt,it,at){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=nt||"",this.serviceLocation=rt||nt||"",this.dvbPriority=it||1,this.dvbWeight=at||1,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0,this.queryParams={}};Hn.DEFAULT_DVB_PRIORITY=1,Hn.DEFAULT_DVB_WEIGHT=1;var Kn=Hn,Yn=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri="",this.presentationTimeOffset=0},Wn=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.inband=!1,this.type="encoder",this.applicationScheme=null,this.wallClockTime=null,this.presentationTime=NaN,this.UTCTiming=null},Jn=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaultServiceLocation=null,this.defaultServiceLocationArray=[],this.queryBeforeStart=!1,this.serverUrl=null,this.clientRequirement=!0};function Re(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var er=function(){function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri=null,this.value=null,this.id=null}var nt;return(nt=[{key:"init",value:function(nt){return nt&&(this.schemeIdUri=nt.schemeIdUri?nt.schemeIdUri:null,this.value=nt.value?nt.value:null,this.id=nt.id?nt.id:null,nt[lt.Z.DVB_URL]&&(this.dvbUrl=nt[lt.Z.DVB_URL]),nt[lt.Z.DVB_MIMETYPE]&&(this.dvbMimeType=nt[lt.Z.DVB_MIMETYPE]),nt[lt.Z.DVB_FONTFAMILY]&&(this.dvbFontFamily=nt[lt.Z.DVB_FONTFAMILY])),this}}])&&Re(e.prototype,nt),e}(),or=it(3101),dr=it.n(or);function De(){return{areEqual:function(nt,rt){return dr()(nt,rt)}}}De.__dashjs_factory_name="ObjectUtils";var fr=ht.Z.getSingletonFactory(De),yr=it(7803),Er=function e(nt,rt){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=nt||"",this.serviceLocation=rt||null,this.queryParams={}},br=function e(nt,rt,it){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=nt||"",this.serviceLocation=rt||null,this.ttl=it||NaN,this.queryParams={}};function Fe(nt,rt){var it=Object.keys(nt);if(Object.getOwnPropertySymbols){var at=Object.getOwnPropertySymbols(nt);rt&&(at=at.filter((function(rt){return Object.getOwnPropertyDescriptor(nt,rt).enumerable}))),it.push.apply(it,at)}return it}function xe(nt){for(var rt=1;rt<arguments.length;rt++){var it=null!=arguments[rt]?arguments[rt]:{};rt%2?Fe(Object(it),!0).forEach((function(rt){ke(nt,rt,it[rt])})):Object.getOwnPropertyDescriptors?Object.defineProperties(nt,Object.getOwnPropertyDescriptors(it)):Fe(Object(it)).forEach((function(rt){Object.defineProperty(nt,rt,Object.getOwnPropertyDescriptor(it,rt))}))}return nt}function ke(nt,rt,it){return rt in nt?Object.defineProperty(nt,rt,{value:it,enumerable:!0,configurable:!0,writable:!0}):nt[rt]=it,nt}function Ue(nt,rt){var it;if("undefined"==typeof Symbol||null==nt[Symbol.iterator]){if(Array.isArray(nt)||(it=Ze(nt))||rt){it&&(nt=it);var at=0,i=function(){};return{s:i,n:function(){return at>=nt.length?{done:!0}:{done:!1,value:nt[at++]}},e:function(nt){throw nt},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var st,ot=!0,lt=!1;return{s:function(){it=nt[Symbol.iterator]()},n:function(){var nt=it.next();return ot=nt.done,nt},e:function(nt){lt=!0,st=nt},f:function(){try{ot||null==it.return||it.return()}finally{if(lt)throw st}}}}function Ze(nt,rt){if(nt){if("string"==typeof nt)return Be(nt,rt);var it=Object.prototype.toString.call(nt).slice(8,-1);return"Object"===it&&nt.constructor&&(it=nt.constructor.name),"Map"===it||"Set"===it?Array.from(nt):"Arguments"===it||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(it)?Be(nt,rt):void 0}}function Be(nt,rt){(null==rt||rt>nt.length)&&(rt=nt.length);for(var it=0,at=new Array(rt);it<rt;it++)at[it]=nt[it];return at}function Ge(){var nt,rt,it,at,st=this.context,ut=(0,pn.Z)(st).getInstance(),ct=Number.isInteger||function(nt){return"number"==typeof nt&&isFinite(nt)&&Math.floor(nt)===nt};function l(nt,rt){if(!nt)throw new Error("adaptation is not defined");if(!rt)throw new Error("type is not defined");if(nt.Representation_asArray&&nt.Representation_asArray.length){var it=v(nt.Representation_asArray[0]);if(it&&it.length>0&&yr.Y.indexOf(it[0].schemeIdUri)>=0)return rt===ot.Z.IMAGE}if(nt.ContentComponent_asArray&&nt.ContentComponent_asArray.length>0){if(nt.ContentComponent_asArray.length>1)return rt===ot.Z.MUXED;if(nt.ContentComponent_asArray[0].contentType===rt)return!0}var at=rt===ot.Z.TEXT?new RegExp("(ttml|vtt|wvtt|stpp)"):new RegExp(rt);if(nt.Representation_asArray&&nt.Representation_asArray.length){var st=nt.Representation_asArray[0].codecs;if(at.test(st))return!0}if(nt.hasOwnProperty(lt.Z.MIME_TYPE))return at.test(nt.mimeType);if(nt.Representation_asArray)for(var ut,ct=0;ct<nt.Representation_asArray.length;ct++)if((ut=nt.Representation_asArray[ct]).hasOwnProperty(lt.Z.MIME_TYPE))return at.test(ut.mimeType);return!1}function c(nt){if(!nt)throw new Error("adaptation is not defined");if(nt.hasOwnProperty(lt.Z.SEGMENT_TEMPLATE)||nt.hasOwnProperty(lt.Z.SEGMENT_TIMELINE)||nt.hasOwnProperty(lt.Z.SEGMENT_LIST)||nt.hasOwnProperty(lt.Z.SEGMENT_BASE))return!0;if(nt.Representation_asArray&&nt.Representation_asArray.length>0){var rt=nt.Representation_asArray[0];if(rt.hasOwnProperty(lt.Z.SEGMENT_TEMPLATE)||rt.hasOwnProperty(lt.Z.SEGMENT_TIMELINE)||rt.hasOwnProperty(lt.Z.SEGMENT_LIST)||rt.hasOwnProperty(lt.Z.SEGMENT_BASE))return!0}return!1}function d(nt){return l(nt,ot.Z.VIDEO)}function g(nt){return l(nt,ot.Z.TEXT)}function h(nt){return l(nt,ot.Z.IMAGE)}function p(nt){return nt&&Array.isArray(nt.Representation_asArray)&&nt.Representation_asArray.sort((function(nt,rt){return nt.bandwidth-rt.bandwidth})),nt}function m(nt,rt){return nt&&nt.Period_asArray&&ct(rt)&&nt.Period_asArray[rt]?nt.Period_asArray[rt].AdaptationSet_asArray:[]}function y(nt){return nt&&nt.Period_asArray?nt.Period_asArray:[]}function E(nt){var rt=!1;return nt&&nt.hasOwnProperty("type")&&(rt=nt.type===lt.Z.DYNAMIC),rt}function v(nt){return nt&&nt.EssentialProperty_asArray&&nt.EssentialProperty_asArray.length?nt.EssentialProperty_asArray.map((function(nt){return{schemeIdUri:nt.schemeIdUri,value:nt.value}})):null}function _(nt){if(!nt||!nt.S_asArray)return NaN;var rt=nt.S_asArray[0],it=nt.S_asArray[1];return rt.hasOwnProperty("d")?rt.d:it.t-rt.t}function T(nt,rt){if(!nt)throw new Error("Period cannot be null or undefined");var it=Mn.DEFAULT_ID+"_"+rt;return nt.hasOwnProperty(lt.Z.ID)&&nt.id.length>0&&"__proto__"!==nt.id&&(it=nt.id),it}function b(nt,rt,it){var at,st=[];if(!nt)return st;for(at=0;at<nt.length;at++){var ut=new Yn;if(ut.timescale=1,ut.representation=rt,!nt[at].hasOwnProperty(ot.Z.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");ut.schemeIdUri=nt[at].schemeIdUri,nt[at].hasOwnProperty(lt.Z.TIMESCALE)&&(ut.timescale=nt[at].timescale),nt[at].hasOwnProperty(lt.Z.VALUE)&&(ut.value=nt[at].value),st.push(ut),ut.period=it}return st}function A(nt){var rt=[],it=nt.BaseURL_asArray||[nt.baseUri],at=!1;return it.some((function(it){if(it){var st=new Kn,ot=it.__text||it;return ut.isRelative(ot)&&(at=!0,nt.baseUri&&(ot=ut.resolve(ot,nt.baseUri))),st.url=ot,it.hasOwnProperty(lt.Z.SERVICE_LOCATION)&&it.serviceLocation.length?st.serviceLocation=it.serviceLocation:st.serviceLocation=ot,it.hasOwnProperty(lt.Z.DVB_PRIORITY)&&(st.dvbPriority=it[lt.Z.DVB_PRIORITY]),it.hasOwnProperty(lt.Z.DVB_WEIGHT)&&(st.dvbWeight=it[lt.Z.DVB_WEIGHT]),it.hasOwnProperty(lt.Z.AVAILABILITY_TIME_OFFSET)&&(st.availabilityTimeOffset=it[lt.Z.AVAILABILITY_TIME_OFFSET]),it.hasOwnProperty(lt.Z.AVAILABILITY_TIME_COMPLETE)&&(st.availabilityTimeComplete="false"!==it[lt.Z.AVAILABILITY_TIME_COMPLETE]),rt.push(st),at}})),rt}function I(nt){var rt=new Jn;return rt.serverUrl=nt.__text,nt.hasOwnProperty(lt.Z.DEFAULT_SERVICE_LOCATION)&&(rt.defaultServiceLocation=nt[lt.Z.DEFAULT_SERVICE_LOCATION],rt.defaultServiceLocationArray=rt.defaultServiceLocation.split(" ")),nt.hasOwnProperty(lt.Z.QUERY_BEFORE_START)&&(rt.queryBeforeStart="true"===nt[lt.Z.QUERY_BEFORE_START].toLowerCase()),nt.hasOwnProperty(lt.Z.CLIENT_REQUIREMENT)&&(rt.clientRequirement="false"!==nt[lt.Z.CLIENT_REQUIREMENT].toLowerCase()),rt}return nt={getIsTypeOf:l,getIsText:g,getIsFragmented:c,getProducerReferenceTimesForAdaptation:function(nt){var rt=nt&&nt.hasOwnProperty(lt.Z.PRODUCERREFERENCETIME_ASARRAY)?nt[lt.Z.PRODUCERREFERENCETIME_ASARRAY]:[];(nt&&nt.hasOwnProperty(lt.Z.REPRESENTATION_ASARRAY)?nt[lt.Z.REPRESENTATION_ASARRAY]:[]).forEach((function(nt){var it;nt.hasOwnProperty(lt.Z.PRODUCERREFERENCETIME_ASARRAY)&&rt.push.apply(rt,function(nt){if(Array.isArray(nt))return Be(nt)}(it=nt[lt.Z.PRODUCERREFERENCETIME_ASARRAY])||function(nt){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(nt))return Array.from(nt)}(it)||Ze(it)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}));var it=[];return rt.forEach((function(nt){var rt=new Wn;nt.hasOwnProperty(lt.Z.ID)&&(rt[lt.Z.ID]=nt[lt.Z.ID],nt.hasOwnProperty(lt.Z.WALL_CLOCK_TIME)&&(rt[lt.Z.WALL_CLOCK_TIME]=nt[lt.Z.WALL_CLOCK_TIME],nt.hasOwnProperty(lt.Z.PRESENTATION_TIME)&&(rt[lt.Z.PRESENTATION_TIME]=nt[lt.Z.PRESENTATION_TIME],nt.hasOwnProperty(lt.Z.INBAND)&&(rt[lt.Z.INBAND]="false"!==nt[lt.Z.INBAND]),nt.hasOwnProperty(lt.Z.TYPE)&&(rt[lt.Z.TYPE]=nt[lt.Z.TYPE]),it.push(rt))))})),it},getLanguageForAdaptation:function(nt){var rt="";return nt&&nt.hasOwnProperty(lt.Z.LANG)&&(rt=nt.lang),rt},getViewpointForAdaptation:function(nt){return nt&&nt.hasOwnProperty(lt.Z.VIEWPOINT_ASARRAY)&&nt[lt.Z.VIEWPOINT_ASARRAY].length?nt[lt.Z.VIEWPOINT_ASARRAY].map((function(nt){return(new er).init(nt)})):[]},getRolesForAdaptation:function(nt){return nt&&nt.hasOwnProperty(lt.Z.ROLE_ASARRAY)&&nt[lt.Z.ROLE_ASARRAY].length?nt[lt.Z.ROLE_ASARRAY].map((function(nt){return(new er).init(nt)})):[]},getAccessibilityForAdaptation:function(nt){return nt&&nt.hasOwnProperty(lt.Z.ACCESSIBILITY_ASARRAY)&&nt[lt.Z.ACCESSIBILITY_ASARRAY].length?nt[lt.Z.ACCESSIBILITY_ASARRAY].map((function(nt){return(new er).init(nt)})):[]},getAudioChannelConfigurationForAdaptation:function(nt){return nt&&nt.hasOwnProperty(lt.Z.AUDIOCHANNELCONFIGURATION_ASARRAY)&&nt[lt.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].length?nt[lt.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].map((function(nt){return(new er).init(nt)})):[]},getAudioChannelConfigurationForRepresentation:function(nt){return nt&&nt.hasOwnProperty(lt.Z.AUDIOCHANNELCONFIGURATION_ASARRAY)&&nt[lt.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].length?nt[lt.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].map((function(nt){return(new er).init(nt)})):[]},getAdaptationForIndex:function(nt,rt,it){var at=m(rt,it);return at.length>0&&ct(nt)?at[nt]:null},getIndexForAdaptation:function(nt,rt,it){if(!nt)return-1;for(var at=m(rt,it),ot=0;ot<at.length;ot++)if(fr(st).getInstance().areEqual(at[ot],nt))return ot;return-1},getAdaptationForId:function(nt,rt,it){var at,st,ot=m(rt,it);for(at=0,st=ot.length;at<st;at++)if(ot[at].hasOwnProperty(lt.Z.ID)&&ot[at].id===nt)return ot[at];return null},getAdaptationsForType:function(nt,rt,it){var at,st,ot=m(nt,rt),lt=[];for(at=0,st=ot.length;at<st;at++)l(ot[at],it)&&lt.push(p(ot[at]));return lt},getRealPeriods:y,getRealPeriodForIndex:function(nt,rt){var it=y(rt);return it.length>0&&ct(nt)?it[nt]:null},getCodec:function(nt,rt,it){var at=null;if(nt&&nt.Representation_asArray&&nt.Representation_asArray.length>0){var st=ct(rt)&&rt>=0&&rt<nt.Representation_asArray.length?nt.Representation_asArray[rt]:nt.Representation_asArray[0];st&&(at=st.mimeType+';codecs="'+st.codecs+'"',it&&void 0!==st.width&&(at+=';width="'+st.width+'";height="'+st.height+'"'))}return at&&(at=at.replace(/\sprofiles=[^;]*/g,"")),at},getSelectionPriority:function(nt){try{var rt=nt&&void 0!==nt.selectionPriority?parseInt(nt.selectionPriority):1;return isNaN(rt)?1:rt}catch(nt){return 1}},getMimeType:function(nt){return nt&&nt.Representation_asArray&&nt.Representation_asArray.length>0?nt.Representation_asArray[0].mimeType:null},getKID:function(nt){return nt&&nt.hasOwnProperty(lt.Z.CENC_DEFAULT_KID)?nt[lt.Z.CENC_DEFAULT_KID]:null},getLabelsForAdaptation:function(nt){if(!nt||!Array.isArray(nt.Label_asArray))return[];for(var rt=[],it=0;it<nt.Label_asArray.length;it++)rt.push({lang:nt.Label_asArray[it].lang,text:nt.Label_asArray[it].__text||nt.Label_asArray[it]});return rt},getContentProtectionData:function(nt){return nt&&nt.hasOwnProperty(lt.Z.CONTENTPROTECTION_ASARRAY)&&0!==nt.ContentProtection_asArray.length?nt.ContentProtection_asArray:null},getIsDynamic:E,getId:function(nt){return nt&&nt[lt.Z.ID]||null},hasProfile:function(nt,rt){var it=!1;return nt&&nt.profiles&&nt.profiles.length>0&&(it=-1!==nt.profiles.indexOf(rt)),it},getDuration:function(nt){return nt&&nt.hasOwnProperty(lt.Z.MEDIA_PRESENTATION_DURATION)?nt.mediaPresentationDuration:nt&&"dynamic"==nt.type?Number.POSITIVE_INFINITY:Number.MAX_SAFE_INTEGER||Number.MAX_VALUE},getBandwidth:function(nt){return nt&&nt.bandwidth?nt.bandwidth:NaN},getManifestUpdatePeriod:function(nt){var rt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,it=NaN;return nt&&nt.hasOwnProperty(lt.Z.MINIMUM_UPDATE_PERIOD)&&(it=nt.minimumUpdatePeriod),isNaN(it)?it:Math.max(it-rt,1)},getPublishTime:function(nt){return nt&&nt.hasOwnProperty(lt.Z.PUBLISH_TIME)?new Date(nt[lt.Z.PUBLISH_TIME]):null},getRepresentationCount:function(nt){return nt&&Array.isArray(nt.Representation_asArray)?nt.Representation_asArray.length:0},getBitrateListForAdaptation:function(nt){var rt=p(nt);return(rt&&Array.isArray(rt.Representation_asArray)?rt.Representation_asArray:[]).map((function(nt){return{bandwidth:nt.bandwidth,width:nt.width||0,height:nt.height||0,scanType:nt.scanType||null,id:nt.id||null}}))},getRepresentationFor:function(nt,rt){return rt&&rt.Representation_asArray&&rt.Representation_asArray.length>0&&ct(nt)?rt.Representation_asArray[nt]:null},getRepresentationsForAdaptation:function(nt){var rt,it,at,st,ot=[],ut=function(nt){if(nt&&nt.period&&ct(nt.period.index)){var rt=nt.period.mpd.manifest.Period_asArray[nt.period.index];if(rt&&rt.AdaptationSet_asArray&&ct(nt.index))return p(rt.AdaptationSet_asArray[nt.index])}}(nt);if(ut&&ut.Representation_asArray){if(nt&&nt.period&&ct(nt.period.index)){var dt=A(nt.period.mpd.manifest);dt&&(it=dt[0])}for(var ht=0,pt=ut.Representation_asArray.length;ht<pt;++ht){var _t=ut.Representation_asArray[ht],Et=new In;if(Et.index=ht,Et.adaptation=nt,_t.hasOwnProperty(lt.Z.ID)&&(Et.id=_t.id),_t.hasOwnProperty(lt.Z.CODECS)&&(Et.codecs=_t.codecs),_t.hasOwnProperty(lt.Z.MIME_TYPE)&&(Et.mimeType=_t[lt.Z.MIME_TYPE]),_t.hasOwnProperty(lt.Z.CODEC_PRIVATE_DATA)&&(Et.codecPrivateData=_t.codecPrivateData),_t.hasOwnProperty(lt.Z.BANDWITH)&&(Et.bandwidth=_t.bandwidth),_t.hasOwnProperty(lt.Z.WIDTH)&&(Et.width=_t.width),_t.hasOwnProperty(lt.Z.HEIGHT)&&(Et.height=_t.height),_t.hasOwnProperty(lt.Z.SCAN_TYPE)&&(Et.scanType=_t.scanType),_t.hasOwnProperty(lt.Z.MAX_PLAYOUT_RATE)&&(Et.maxPlayoutRate=_t.maxPlayoutRate),_t.hasOwnProperty(lt.Z.SEGMENT_BASE)?(rt=_t.SegmentBase,Et.segmentInfoType=lt.Z.SEGMENT_BASE):_t.hasOwnProperty(lt.Z.SEGMENT_LIST)?(rt=_t.SegmentList).hasOwnProperty(lt.Z.SEGMENT_TIMELINE)?Et.segmentInfoType=lt.Z.SEGMENT_TIMELINE:Et.segmentInfoType=lt.Z.SEGMENT_LIST:_t.hasOwnProperty(lt.Z.SEGMENT_TEMPLATE)?((rt=_t.SegmentTemplate).hasOwnProperty(lt.Z.SEGMENT_TIMELINE)?Et.segmentInfoType=lt.Z.SEGMENT_TIMELINE:Et.segmentInfoType=lt.Z.SEGMENT_TEMPLATE,rt.hasOwnProperty(lt.Z.INITIALIZATION_MINUS)&&(Et.initialization=rt.initialization.split("$Bandwidth$").join(_t.bandwidth).split("$RepresentationID$").join(_t.id))):Et.segmentInfoType=lt.Z.BASE_URL,Et.essentialProperties=v(_t),rt){if(rt.hasOwnProperty(lt.Z.INITIALIZATION)){var St=rt.Initialization;St.hasOwnProperty(lt.Z.SOURCE_URL)&&(Et.initialization=St.sourceURL),St.hasOwnProperty(lt.Z.RANGE)&&(Et.range=St.range)}else g(ut)&&c(ut)&&ut.mimeType&&-1===ut.mimeType.indexOf("application/mp4")&&(Et.range=0);rt.hasOwnProperty(lt.Z.TIMESCALE)&&(Et.timescale=rt.timescale),rt.hasOwnProperty(lt.Z.DURATION)?Et.segmentDuration=rt.duration/Et.timescale:_t.hasOwnProperty(lt.Z.SEGMENT_TEMPLATE)&&(rt=_t.SegmentTemplate).hasOwnProperty(lt.Z.SEGMENT_TIMELINE)&&(Et.segmentDuration=_(rt.SegmentTimeline)/Et.timescale),rt.hasOwnProperty(lt.Z.MEDIA)&&(Et.media=rt.media),rt.hasOwnProperty(lt.Z.START_NUMBER)&&(Et.startNumber=rt.startNumber),rt.hasOwnProperty(lt.Z.INDEX_RANGE)&&(Et.indexRange=rt.indexRange),rt.hasOwnProperty(lt.Z.PRESENTATION_TIME_OFFSET)&&(Et.presentationTimeOffset=rt.presentationTimeOffset/Et.timescale),rt.hasOwnProperty(lt.Z.AVAILABILITY_TIME_OFFSET)?Et.availabilityTimeOffset=rt.availabilityTimeOffset:it&&void 0!==it.availabilityTimeOffset&&(Et.availabilityTimeOffset=it.availabilityTimeOffset),rt.hasOwnProperty(lt.Z.AVAILABILITY_TIME_COMPLETE)?Et.availabilityTimeComplete="false"!==rt.availabilityTimeComplete:it&&void 0!==it.availabilityTimeComplete&&(Et.availabilityTimeComplete=it.availabilityTimeComplete)}Et.MSETimeOffset=(st=(at=Et).presentationTimeOffset,at.adaptation.period.start-st),Et.path=[nt.period.index,nt.index,ht],ot.push(Et)}}return ot},getAdaptationsForPeriod:function(nt){var it,at,st,ut=nt&&ct(nt.index)?nt.mpd.manifest.Period_asArray[nt.index]:null,dt=[];if(ut&&ut.AdaptationSet_asArray)for(st=0;st<ut.AdaptationSet_asArray.length;st++)at=ut.AdaptationSet_asArray[st],it=new Ln,at.hasOwnProperty(lt.Z.ID)&&(it.id=at.id),it.index=st,it.period=nt,l(at,ot.Z.MUXED)?it.type=ot.Z.MUXED:l(at,ot.Z.AUDIO)?it.type=ot.Z.AUDIO:d(at)?it.type=ot.Z.VIDEO:g(at)?it.type=ot.Z.TEXT:h(at)?it.type=ot.Z.IMAGE:rt.warn("Unknown Adaptation stream type"),dt.push(it);return dt},getRegularPeriods:function(nt){var at,st,ut=!!nt&&E(nt.manifest),ct=[],dt=null,ht=null,pt=null,_t=null;for(st=0,at=nt&&nt.manifest&&nt.manifest.Period_asArray?nt.manifest.Period_asArray.length:0;st<at;st++)(ht=nt.manifest.Period_asArray[st]).hasOwnProperty(lt.Z.START)?(_t=new Mn).start=ht.start:null!==dt&&dt.hasOwnProperty(lt.Z.DURATION)&&null!==pt?(_t=new Mn).start=parseFloat((pt.start+pt.duration).toFixed(5)):0!==st||ut||((_t=new Mn).start=0),null!==pt&&isNaN(pt.duration)&&(null!==_t?pt.duration=parseFloat((_t.start-pt.start).toFixed(5)):rt.warn("First period duration could not be calculated because lack of start and duration period properties. This will cause timing issues during playback")),null!==_t&&(_t.id=T(ht,st),_t.index=st,_t.mpd=nt,ht.hasOwnProperty(lt.Z.DURATION)&&(_t.duration=ht.duration),pt&&(pt.nextPeriodId=_t.id),ct.push(_t),dt=ht,pt=_t),ht=null,_t=null;return 0===ct.length||null!==pt&&isNaN(pt.duration)&&(pt.duration=parseFloat((function(nt){!function(){if(!it||!it.hasOwnProperty("error"))throw new Error(ot.Z.MISSING_CONFIG_ERROR)}();var rt,at=E(nt.mpd.manifest);return nt.mpd.manifest.mediaPresentationDuration?rt=nt.mpd.manifest.mediaPresentationDuration:nt.duration?rt=nt.duration:at?rt=Number.POSITIVE_INFINITY:it.error(new Ot.Z(Ft.MANIFEST_ERROR_ID_PARSE_CODE,"Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.",nt)),rt}(pt)-pt.start).toFixed(5))),ct},getMpd:function(nt){var rt=new Nn;return nt&&(rt.manifest=nt,nt.hasOwnProperty(lt.Z.AVAILABILITY_START_TIME)?rt.availabilityStartTime=new Date(nt.availabilityStartTime.getTime()):nt.loadedTime&&(rt.availabilityStartTime=new Date(nt.loadedTime.getTime())),nt.hasOwnProperty(lt.Z.AVAILABILITY_END_TIME)&&(rt.availabilityEndTime=new Date(nt.availabilityEndTime.getTime())),nt.hasOwnProperty(lt.Z.MINIMUM_UPDATE_PERIOD)&&(rt.minimumUpdatePeriod=nt.minimumUpdatePeriod),nt.hasOwnProperty(lt.Z.MEDIA_PRESENTATION_DURATION)&&(rt.mediaPresentationDuration=nt.mediaPresentationDuration),nt.hasOwnProperty(lt.Z.SUGGESTED_PRESENTATION_DELAY)&&(rt.suggestedPresentationDelay=nt.suggestedPresentationDelay),nt.hasOwnProperty(lt.Z.TIMESHIFT_BUFFER_DEPTH)&&(rt.timeShiftBufferDepth=nt.timeShiftBufferDepth),nt.hasOwnProperty(lt.Z.MAX_SEGMENT_DURATION)&&(rt.maxSegmentDuration=nt.maxSegmentDuration),nt.hasOwnProperty(lt.Z.PUBLISH_TIME)&&(rt.publishTime=new Date(nt.publishTime))),rt},getEventsForPeriod:function(nt){var rt,it,st=nt&&nt.mpd&&nt.mpd.manifest?nt.mpd.manifest:null,ut=st?st.Period_asArray:null,dt=ut&&nt&&ct(nt.index)?ut[nt.index].EventStream_asArray:null,ht=[];if(dt)for(rt=0;rt<dt.length;rt++){var pt=new Yn;if(pt.period=nt,pt.timescale=1,!dt[rt].hasOwnProperty(ot.Z.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(pt.schemeIdUri=dt[rt][ot.Z.SCHEME_ID_URI],dt[rt].hasOwnProperty(lt.Z.TIMESCALE)&&(pt.timescale=dt[rt][lt.Z.TIMESCALE]),dt[rt].hasOwnProperty(lt.Z.VALUE)&&(pt.value=dt[rt][lt.Z.VALUE]),dt[rt].hasOwnProperty(lt.Z.PRESENTATION_TIME_OFFSET)&&(pt.presentationTimeOffset=dt[rt][lt.Z.PRESENTATION_TIME_OFFSET]),it=0;dt[rt].Event_asArray&&it<dt[rt].Event_asArray.length;it++){var _t=dt[rt].Event_asArray[it],Et=new Un;Et.presentationTime=0,Et.eventStream=pt,_t.hasOwnProperty(lt.Z.PRESENTATION_TIME)&&(Et.presentationTime=_t.presentationTime);var St=pt.presentationTimeOffset?pt.presentationTimeOffset/pt.timescale:0;Et.calculatedPresentationTime=Et.presentationTime/pt.timescale+nt.start-St,_t.hasOwnProperty(lt.Z.DURATION)&&(Et.duration=_t.duration/pt.timescale),_t.hasOwnProperty(lt.Z.ID)?Et.id=_t.id:Et.id=null,_t.Signal&&_t.Signal.Binary?Et.messageData=at.decodeArray(_t.Signal.Binary.toString()):Et.messageData=_t.messageData||_t.__cdata||_t.__text,ht.push(Et)}}return ht},getEssentialPropertiesForAdaptation:function(nt){var rt={};if(nt&&nt.hasOwnProperty(lt.Z.ESSENTIAL_PROPERTY_ASARRAY)){var it,at=Ue(nt.EssentialProperty_asArray);try{for(at.s();!(it=at.n()).done;){var st=it.value;st.hasOwnProperty(ot.Z.SCHEME_ID_URI)&&(rt[st[ot.Z.SCHEME_ID_URI]]=xe({},st))}}catch(nt){at.e(nt)}finally{at.f()}}return rt},getEssentialPropertiesAsArrayForAdaptation:function(nt){return nt&&nt.hasOwnProperty(lt.Z.ESSENTIAL_PROPERTY_ASARRAY)&&nt.EssentialProperty_asArray.length?nt.EssentialProperty_asArray.map((function(nt){return(new er).init(nt)})):[]},getEssentialPropertiesForRepresentation:v,getEventStreamForAdaptationSet:function(nt,rt,it){var at,st,ot;return nt&&nt.Period_asArray&&rt&&rt.period&&ct(rt.period.index)&&(st=nt.Period_asArray[rt.period.index])&&st.AdaptationSet_asArray&&ct(rt.index)&&(ot=st.AdaptationSet_asArray[rt.index])&&(at=ot.InbandEventStream_asArray),b(at,null,it)},getEventStreamForRepresentation:function(nt,rt,it){var at,st,ot,lt;return nt&&nt.Period_asArray&&rt&&rt.adaptation&&rt.adaptation.period&&ct(rt.adaptation.period.index)&&(st=nt.Period_asArray[rt.adaptation.period.index])&&st.AdaptationSet_asArray&&ct(rt.adaptation.index)&&(ot=st.AdaptationSet_asArray[rt.adaptation.index])&&ot.Representation_asArray&&ct(rt.index)&&(lt=ot.Representation_asArray[rt.index])&&(at=lt.InbandEventStream_asArray),b(at,rt,it)},getUTCTimingSources:function(nt){var rt=E(nt),it=!!nt&&nt.hasOwnProperty(lt.Z.AVAILABILITY_START_TIME),at=nt?nt.UTCTiming_asArray:null,st=[];return(rt||it)&&at&&at.forEach((function(nt){var rt=new xn.Z;nt.hasOwnProperty(ot.Z.SCHEME_ID_URI)&&(rt.schemeIdUri=nt.schemeIdUri,nt.hasOwnProperty(lt.Z.VALUE)&&(rt.value=nt.value.toString(),st.push(rt)))})),st},getBaseURLsFromElement:A,getRepresentationSortFunction:function(){return function(nt,rt){return nt.bandwidth-rt.bandwidth}},getContentSteering:function(nt){if(nt&&nt.hasOwnProperty(lt.Z.CONTENT_STEERING_AS_ARRAY))return I(nt[lt.Z.CONTENT_STEERING_AS_ARRAY][0])},getLocation:function(nt){return nt&&nt.hasOwnProperty(lt.Z.LOCATION_AS_ARRAY)?nt[lt.Z.LOCATION_AS_ARRAY].map((function(nt){var rt=nt.__text||nt,it=nt.hasOwnProperty(lt.Z.SERVICE_LOCATION)?nt[lt.Z.SERVICE_LOCATION]:null;return new Er(rt,it)})):[]},getPatchLocation:function(nt){return nt&&nt.hasOwnProperty(lt.Z.PATCH_LOCATION_AS_ARRAY)?nt[lt.Z.PATCH_LOCATION_AS_ARRAY].map((function(nt){var rt=nt.__text||nt,it=nt.hasOwnProperty(lt.Z.SERVICE_LOCATION)?nt[lt.Z.SERVICE_LOCATION]:null,at=nt.hasOwnProperty(lt.Z.TTL)?1e3*parseFloat(nt[lt.Z.TTL]):NaN;return new br(rt,it,at)})):[]},getSuggestedPresentationDelay:function(nt){return nt&&nt.hasOwnProperty(lt.Z.SUGGESTED_PRESENTATION_DELAY)?nt.suggestedPresentationDelay:null},getAvailabilityStartTime:function(nt){return nt&&nt.hasOwnProperty(lt.Z.AVAILABILITY_START_TIME)&&null!==nt.availabilityStartTime?nt.availabilityStartTime.getTime():null},getServiceDescriptions:function(nt){var rt=[];if(nt&&nt.hasOwnProperty(lt.Z.SERVICE_DESCRIPTION)){var it,at=Ue(nt.ServiceDescription_asArray);try{for(at.s();!(it=at.n()).done;){var st=it.value,ot=null,ut=null,ct=null,dt=null,ht=null,pt=null,_t=null;for(var Et in st)st.hasOwnProperty(Et)&&(Et===lt.Z.ID?ot=st[Et]:Et===lt.Z.SERVICE_DESCRIPTION_SCOPE?ut=st[Et].schemeIdUri:Et===lt.Z.SERVICE_DESCRIPTION_LATENCY?ct={target:parseInt(st[Et].target),max:parseInt(st[Et].max),min:parseInt(st[Et].min),referenceId:parseInt(st[Et].referenceId)}:Et===lt.Z.SERVICE_DESCRIPTION_PLAYBACK_RATE?dt={max:parseFloat(st[Et].max),min:parseFloat(st[Et].min)}:Et===lt.Z.SERVICE_DESCRIPTION_OPERATING_QUALITY?ht={mediaType:st[Et].mediaType,max:parseInt(st[Et].max),min:parseInt(st[Et].min),target:parseInt(st[Et].target),type:st[Et].type,maxQualityDifference:parseInt(st[Et].maxQualityDifference)}:Et===lt.Z.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH?pt={mediaType:st[Et].mediaType,max:parseInt(st[Et].max),min:parseInt(st[Et].min),target:parseInt(st[Et].target)}:Et===lt.Z.CONTENT_STEERING&&(_t=I(st[Et])));rt.push({id:ot,schemeIdUri:ut,latency:ct,playbackRate:dt,operatingQuality:ht,operatingBandwidth:pt,contentSteering:_t})}}catch(nt){at.e(nt)}finally{at.f()}}return rt},getSegmentAlignment:function(nt){return!(!nt||!nt.hasOwnProperty(lt.Z.SEGMENT_ALIGNMENT))&&"true"===nt[lt.Z.SEGMENT_ALIGNMENT]},getSubSegmentAlignment:function(nt){return!(!nt||!nt.hasOwnProperty(lt.Z.SUB_SEGMENT_ALIGNMENT))&&"true"===nt[lt.Z.SUB_SEGMENT_ALIGNMENT]},getSupplementalPropertiesForAdaptation:function(nt){var rt={};if(nt&&nt.hasOwnProperty(lt.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)){var it,at=Ue(nt.SupplementalProperty_asArray);try{for(at.s();!(it=at.n()).done;){var st=it.value;st.hasOwnProperty(ot.Z.SCHEME_ID_URI)&&(rt[st[ot.Z.SCHEME_ID_URI]]=xe({},st))}}catch(nt){at.e(nt)}finally{at.f()}}return rt},getSupplementalPropertiesAsArrayForAdaptation:function(nt){return nt&&nt.hasOwnProperty(lt.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)&&nt.SupplementalProperty_asArray.length?nt.SupplementalProperty_asArray.map((function(nt){return(new er).init(nt)})):[]},getSupplementalPropertiesForRepresentation:function(nt){var rt={};if(nt&&nt.hasOwnProperty(lt.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)){var it,at=Ue(nt.SupplementalProperty_asArray);try{for(at.s();!(it=at.n()).done;){var st=it.value;st.hasOwnProperty(ot.Z.SCHEME_ID_URI)&&(rt[st[ot.Z.SCHEME_ID_URI]]=xe({},st))}}catch(nt){at.e(nt)}finally{at.f()}}return rt},getSupplementalPropertiesAsArrayForRepresentation:function(nt){return nt&&nt.hasOwnProperty(lt.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)&&nt.SupplementalProperty_asArray.length?nt.SupplementalProperty_asArray.map((function(nt){return(new er).init(nt)})):[]},setConfig:function(nt){nt&&(nt.errHandler&&(it=nt.errHandler),nt.BASE64&&(at=nt.BASE64))}},rt=(0,pt.Z)(st).getInstance().getLogger(nt),nt}Ge.__dashjs_factory_name="DashManifestModel";var Ar=ht.Z.getSingletonFactory(Ge),Lr=it(703);function je(nt,rt){var it;if("undefined"==typeof Symbol||null==nt[Symbol.iterator]){if(Array.isArray(nt)||(it=function(nt,rt){if(nt){if("string"==typeof nt)return He(nt,rt);var it=Object.prototype.toString.call(nt).slice(8,-1);return"Object"===it&&nt.constructor&&(it=nt.constructor.name),"Map"===it||"Set"===it?Array.from(nt):"Arguments"===it||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(it)?He(nt,rt):void 0}}(nt))||rt){it&&(nt=it);var at=0,i=function(){};return{s:i,n:function(){return at>=nt.length?{done:!0}:{done:!1,value:nt[at++]}},e:function(nt){throw nt},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var st,ot=!0,lt=!1;return{s:function(){it=nt[Symbol.iterator]()},n:function(){var nt=it.next();return ot=nt.done,nt},e:function(nt){lt=!0,st=nt},f:function(){try{ot||null==it.return||it.return()}finally{if(lt)throw st}}}}function He(nt,rt){(null==rt||rt>nt.length)&&(rt=nt.length);for(var it=0,at=new Array(rt);it<rt;it++)at[it]=nt[it];return at}function Ve(){var nt,rt,it,at,st,lt,ut,dt,ht,pt,Et=this.context,St=(0,ct.Z)(Et).getInstance(),wt=(0,Bt.Z)(Et).getInstance();function m(){it={pr:1,nor:null,st:null,sf:null,sid:"".concat(Lr.Z.generateUuid()),cid:null},ht={},dt={},pt={},E()}function y(){E()}function E(){if(lt){var nt=lt.getStreamController();if(nt&&"function"==typeof nt.getActiveStream){var rt=nt.getActiveStream();rt&&(ut=rt.getProcessors())}}}function v(nt,rt){var it,at={},st=je(rt);try{for(st.s();!(it=st.n()).done;){var ot=it.value;nt[ot]&&(at[ot]=nt[ot])}}catch(nt){st.e(nt)}finally{st.f()}return at}function _(nt){var rt=wt.get().streaming.cmcd.enabledKeys;return nt.filter((function(nt){return rt.includes(nt)}))}function T(nt){try{return nt.type===Ut.w.MPD_TYPE?((ct=S()).ot="m",ct):nt.type===Ut.w.MEDIA_SEGMENT_TYPE?(rt=nt.mediaType,pt.hasOwnProperty(rt)||(pt[rt]=!1),dt.hasOwnProperty(rt)||(dt[rt]=!1),ht.hasOwnProperty(rt)||(ht[rt]=!1),function(nt){var rt,ct=S(),_t=function(nt){try{var rt=nt.quality,it=nt.mediaInfo.bitrateList;return parseInt(it[rt].bandwidth/1e3)}catch(nt){return null}}(nt),Et=function(nt){try{return isNaN(nt.duration)?NaN:Math.round(1e3*nt.duration)}catch(nt){return null}}(nt),St=function(nt){try{return 100*parseInt(at.getThroughputHistory().getSafeAverageThroughput(nt)/100)}catch(nt){return null}}(nt.mediaType),Lt=function(nt){try{var rt=it.pr,at=st.getCurrentBufferLevel(nt);return isNaN(rt)||isNaN(at)?null:100*parseInt(at/rt*10)}catch(nt){return null}}(nt.mediaType),Ct=b(nt.mediaType),Pt=function(nt){try{var rt=at.getTopBitrateInfoFor(nt);return Math.round(rt.bitrate/1e3)}catch(nt){return null}}(nt.mediaType),kt=it.pr,Ot=function(nt){if(ut&&0!==ut.length){var rt,it=je(ut);try{for(it.s();!(rt=it.n()).done;){var at=rt.value;if(at.getType()===nt)return at.probeNextRequest()}}catch(nt){it.e(nt)}finally{it.f()}}}(nt.mediaType);nt.mediaType===ot.Z.VIDEO&&(rt="v"),nt.mediaType===ot.Z.AUDIO&&(rt="a"),nt.mediaType===ot.Z.TEXT&&(rt="application/mp4"===nt.mediaInfo.mimeType?"tt":"c");var Ft=wt.get().streaming.cmcd.rtp;return Ft||(Ft=function(nt){try{var rt=lt.getPlaybackRate();rt||(rt=1);var it=nt.quality,at=nt.mediaType,st=nt.mediaInfo,ot=nt.duration;if(!st)return NaN;var ut=b(at);0===ut&&(ut=500);var ct=st.bitrateList[it].bandwidth*ot/1e3/(ut/rt/1e3),dt=wt.get().streaming.cmcd.rtpSafetyFactor&&!isNaN(wt.get().streaming.cmcd.rtpSafetyFactor)?wt.get().streaming.cmcd.rtpSafetyFactor:5;return 100*(parseInt(ct*dt/100)+1)}catch(nt){return NaN}}(nt)),isNaN(Ft)||(ct.rtp=Ft),Ot&&(nt.url!==Ot.url?ct.nor=encodeURIComponent(Lr.Z.getRelativeUrl(nt.url,Ot.url)):Ot.range&&(ct.nrr=Ot.range)),_t&&(ct.br=_t),rt&&(ct.ot=rt),isNaN(Et)||(ct.d=Et),isNaN(St)||(ct.mtp=St),isNaN(Lt)||(ct.dl=Lt),isNaN(Ct)||(ct.bl=Ct),isNaN(Pt)||(ct.tb=Pt),isNaN(kt)||1===kt||(ct.pr=kt),ht[nt.mediaType]&&(ct.bs=!0,ht[nt.mediaType]=!1),!dt[nt.mediaType]&&pt[nt.mediaType]||(ct.su=!0,dt[nt.mediaType]=!1,pt[nt.mediaType]=!0),ct}(nt)):nt.type===Ut.w.INIT_SEGMENT_TYPE?function(){var nt=S();return nt.ot="i",nt.su=!0,nt}():nt.type===Ut.w.OTHER_TYPE||nt.type===Ut.w.XLINK_EXPANSION_TYPE?function(){var nt=S();return nt.ot="o",nt}():nt.type===Ut.w.LICENSE?function(){var nt=S();return nt.ot="k",nt}():null}catch(nt){return null}var rt,ct}function S(){var nt={},rt=wt.get().streaming.cmcd.cid?wt.get().streaming.cmcd.cid:it.cid;return nt.v=1,nt.sid=wt.get().streaming.cmcd.sid?wt.get().streaming.cmcd.sid:it.sid,nt.sid="".concat(nt.sid),rt&&(nt.cid="".concat(rt)),isNaN(it.pr)||1===it.pr||null===it.pr||(nt.pr=it.pr),it.st&&(nt.st=it.st),it.sf&&(nt.sf=it.sf),nt}function b(nt){try{var rt=st.getCurrentBufferLevel(nt);return isNaN(rt)?null:100*parseInt(10*rt)}catch(nt){return null}}function A(nt){try{it.pr=nt.playbackRate}catch(nt){}}function I(rt){try{var at=nt.getIsDynamic(rt.data)?"l":"v",st=rt.protocol&&"MSS"===rt.protocol?"s":"d";it.st="".concat(at),it.sf="".concat(st)}catch(nt){}}function R(nt){try{nt.state&&nt.mediaType&&nt.state===_t.Z.BUFFER_EMPTY&&(ht[nt.mediaType]||(ht[nt.mediaType]=!0),dt[nt.mediaType]||(dt[nt.mediaType]=!0))}catch(nt){}}function w(){for(var nt in ht)ht.hasOwnProperty(nt)&&(ht[nt]=!0);for(var rt in dt)dt.hasOwnProperty(rt)&&(dt[rt]=!0)}function D(nt){try{if(!nt)return null;var rt=Object.keys(nt).sort((function(nt,rt){return nt.localeCompare(rt)})),it=rt.length,at=rt.reduce((function(rt,at,st){return"v"===at&&1===nt[at]||("string"==typeof nt[at]&&"ot"!==at&&"sf"!==at&&"st"!==at?rt+="".concat(at,"=").concat(JSON.stringify(nt[at])):rt+="".concat(at,"=").concat(nt[at]),st<it-1&&(rt+=",")),rt}),"");return(at=at.replace(/=true/g,"")).replace(/,\s*$/,"")}catch(nt){return null}}return rt={getQueryParameter:function(nt){try{if(wt.get().streaming.cmcd&&wt.get().streaming.cmcd.enabled){var rt=T(nt),it=function(nt){try{var rt=wt.get().streaming.cmcd.enabledKeys;return Object.keys(nt).filter((function(nt){return rt.includes(nt)})).reduce((function(rt,it){return rt[it]=nt[it],rt}),{})}catch(rt){return nt}}(rt),at=D(it);return St.trigger(Rn.Z.CMCD_DATA_GENERATED,{url:nt.url,mediaType:nt.mediaType,cmcdData:rt,cmcdString:at}),{key:"CMCD",value:at}}return null}catch(nt){return null}},getHeaderParameters:function(nt){try{if(wt.get().streaming.cmcd&&wt.get().streaming.cmcd.enabled){var rt=T(nt),it=v(rt,_(["br","d","ot","tb"])),at=v(rt,_(["bl","dl","mtp","nor","nrr","su"])),st=v(rt,_(["bs","rtp"])),ot=v(rt,_(["cid","pr","sf","sid","st","v"])),lt={"CMCD-Object":D(it),"CMCD-Request":D(at),"CMCD-Status":D(st),"CMCD-Session":D(ot)};return St.trigger(Rn.Z.CMCD_DATA_GENERATED,{url:nt.url,mediaType:nt.mediaType,cmcdData:rt,headers:lt}),lt}return null}catch(nt){return null}},setConfig:function(nt){nt&&(nt.abrController&&(at=nt.abrController),nt.dashMetrics&&(st=nt.dashMetrics),nt.playbackController&&(lt=nt.playbackController))},reset:function(){St.off(_t.Z.PLAYBACK_RATE_CHANGED,A,this),St.off(_t.Z.MANIFEST_LOADED,I,this),St.off(_t.Z.BUFFER_LEVEL_STATE_CHANGED,R,rt),St.off(_t.Z.PLAYBACK_SEEKED,w,rt),m()},initialize:function(){St.on(_t.Z.PLAYBACK_RATE_CHANGED,A,rt),St.on(_t.Z.MANIFEST_LOADED,I,rt),St.on(_t.Z.BUFFER_LEVEL_STATE_CHANGED,R,rt),St.on(_t.Z.PLAYBACK_SEEKED,w,rt),St.on(_t.Z.PERIOD_SWITCH_COMPLETED,y,rt)}},nt=Ar(Et).getInstance(),m(),rt}Ve.__dashjs_factory_name="CmcdModel";var Dr=ht.Z.getSingletonFactory(Ve);function ze(nt){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},ze(nt)}function We(nt,rt){We=function(nt,rt){return new a(nt,void 0,rt)};var it=Qe(RegExp),at=RegExp.prototype,st=new WeakMap;function a(nt,rt,at){var ot=it.call(this,nt,rt);return st.set(ot,at||st.get(nt)),ot}function o(nt,rt){var it=st.get(rt);return Object.keys(it).reduce((function(rt,at){return rt[at]=nt[it[at]],rt}),Object.create(null))}return Xe(a,it),a.prototype.exec=function(nt){var rt=at.exec.call(this,nt);return rt&&(rt.groups=o(rt,this)),rt},a.prototype[Symbol.replace]=function(nt,rt){if("string"==typeof rt){var it=st.get(this);return at[Symbol.replace].call(this,nt,rt.replace(/\$<([^>]+)>/g,(function(nt,rt){return"$"+it[rt]})))}if("function"==typeof rt){var ot=this;return at[Symbol.replace].call(this,nt,(function(){var nt=[];return nt.push.apply(nt,arguments),"object"!==ze(nt[nt.length-1])&&nt.push(o(nt,ot)),rt.apply(this,nt)}))}return at[Symbol.replace].call(this,nt,rt)},We.apply(this,arguments)}function Xe(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&et(nt,rt)}function Qe(nt){var rt="function"==typeof Map?new Map:void 0;return Qe=function(nt){if(null===nt||(it=nt,-1===Function.toString.call(it).indexOf("[native code]")))return nt;var it;if("function"!=typeof nt)throw new TypeError("Super expression must either be null or a function");if(void 0!==rt){if(rt.has(nt))return rt.get(nt);rt.set(nt,r)}function r(){return Je(nt,arguments,tt(this).constructor)}return r.prototype=Object.create(nt.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),et(r,nt)},Qe(nt)}function Je(nt,rt,it){return Je=$e()?Reflect.construct:function(nt,rt,it){var at=[null];at.push.apply(at,rt);var st=new(Function.bind.apply(nt,at));return it&&et(st,it.prototype),st},Je.apply(null,arguments)}function $e(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}function et(nt,rt){return et=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},et(nt,rt)}function tt(nt){return tt=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},tt(nt)}var Mr="static",Zr="dynamic",Vr="cmsd-",jr=Vr+Mr,$r=Vr+Zr,zr="stream",Xr=["mb","st","sf","v"],Qr={video:"v",audio:"a",text:"tt",stream:zr},ei=/^[-0-9]/;function ft(){var nt,rt,it,at,st=this.context,ot=(0,ct.Z)(st).getInstance();function o(){it={},at={}}function s(nt){nt&&Object.keys(nt).forEach((function(rt){Xr.includes(rt)||delete nt[rt]}))}function c(nt){return!nt||"false"!==nt.toLowerCase()&&(ei.test(nt)?parseInt(nt,10):nt.replace(/["]+/g,""))}function d(nt){try{for(var it={},at=nt.split(","),st=0;st<at.length;st++){var ot=at[st].split("="),lt=ot[0],ut=c(ot[1]);it[lt]=ut}return it}catch(nt){rt.error("Failed to parse CMSD-Static response header value:",nt)}}function g(nt){try{for(var it={},at=nt.split(","),st=at[at.length-1].split(";"),ot=1;ot<st.length;ot++){var lt=st[ot].split("="),ut=lt[0],ct=c(lt[1]);it[ut]=ct}return it}catch(nt){return rt.error("Failed to parse CMSD-Dynamic response header value:",nt),[]}}function h(nt){return Qr[nt]||"o"}function p(nt,rt,st){var ot=nt===Mr?it:at,lt=ot[rt]||{},ut=ot[zr]||{};return lt[st]||ut[st]}return nt={setConfig:function(){},initialize:function(){},reset:function(){o()},parseResponseHeaders:function(nt,rt){for(var st=null,lt=null,ut=nt.split("\r\n"),ct=ut.length-1;ct>=0;ct--){var ht=ut[ct].match(We(/^((?:(?!:)[\s\S])*):[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(.*)$/,{key:1,value:2}));if(ht&&ht.groups){var pt=ht.groups.key.toLowerCase(),_t=ht.groups.value;switch(pt){case jr:st=d(_t),ot.trigger(dt.Z.CMSD_STATIC_HEADER,st);break;case $r:lt||(lt=g(_t))}}}var Et=zr;return st&&st.ot?Et=st.ot:rt&&(Et=h(rt)),s(it[Et]),s(at[Et]),st&&(it[Et]=Object.assign(it[Et]||{},st)),lt&&(at[Et]=Object.assign(at[Et]||{},lt)),{static:st,dynamic:lt}},getMaxBitrate:function(nt){var rt=h(nt);return p(Zr,rt,"mb")||-1},getEstimatedThroughput:function(nt){var rt=h(nt);return p(Zr,rt,"etp")||null},getResponseDelay:function(nt){var rt=h(nt);return p(Zr,rt,"rd")||null},getRoundTripTime:function(nt){var rt=h(nt);return p(Zr,rt,"rtt")||null}},rt=(0,pt.Z)(st).getInstance().getLogger(nt),o(),nt}ft.__dashjs_factory_name="CmsdModel";var ni=ht.Z.getSingletonFactory(ft);function gt(){var nt,rt,it=this.context,at={};function i(){rt=(0,pt.Z)(it).getInstance().getLogger(nt)}function a(nt){for(var rt={},it=0,at=0,st=0,ot=0,lt=nt.length,ut=0;ut<lt;++ut)it+=nt[ut].chunkDownloadTimeRelativeMS,at+=nt[ut].bufferLevel,st+=nt[ut].chunkDownloadTimeRelativeMS*nt[ut].bufferLevel,ot+=nt[ut].chunkDownloadTimeRelativeMS*nt[ut].chunkDownloadTimeRelativeMS;return rt.m=(st-it*at/lt)/(ot-it*it/lt),rt.b=at/lt-rt.m*it/lt,function(nt){return rt.m*nt+rt.b}}function o(nt){var rt,it=!0,at=nt.reduce((function(nt,rt){return nt+rt.bufferLevelAtSegmentEnd}),0)/nt.length;return nt.forEach((function(nt){Math.abs(nt.bufferLevelAtSegmentEnd/nt.bufferLevelAtSegmentStart)<.95&&(it=!1),nt.bufferLevelAtSegmentEnd/at<.8&&(it=!1),rt?rt>nt.bitrate&&(it=!1):rt=nt.bitrate})),it}return nt={setup:i,addMeasurement:function(nt,rt,it,st,ot){nt&&nt.mediaType&&!at[nt.mediaType]&&(at[nt.mediaType]=[]);var lt=nt.mediaInfo.bitrateList.find((function(rt){return rt.id===nt.representationId}));at[nt.mediaType].push({index:nt.index,repId:nt.representationId,mediaType:nt.mediaType,requestTimeMS:st,adjustedAvailabilityStartTimeMS:nt.availabilityStartTime.getTime(),segDurationMS:1e3*nt.duration,chunksDurationMS:it.reduce((function(nt,rt){return nt+rt.chunkDownloadDurationMS}),0),segmentBytes:it.reduce((function(nt,rt){return nt+rt.chunkBytes}),0),bitrate:lt&&lt.bandwidth,bitrateList:nt.mediaInfo.bitrateList,chunkMeasurements:it,fetchDownloadDurationMS:rt,throughputCapacityDelayMS:ot,getEstimatedBufferLevel:a(it.slice(1))}),at[nt.mediaType].length>10&&at[nt.mediaType].shift()},getThroughputCapacityDelayMS:function(nt,rt){var it=at[nt.mediaType]&&at[nt.mediaType].slice(-3);return!it||it.length<3?0:o(it)?rt/4>250?250:rt/4:0},getEstimatedDownloadDurationMS:function(nt){var it=at[nt.mediaType].slice(-1).pop(),st=at[nt.mediaType].slice(-3),ot=it.chunkMeasurements.slice(-1).pop().chunkDownloadTimeRelativeMS;it.bufferLevelAtSegmentStart=it.getEstimatedBufferLevel(ot/2),it.bufferLevelAtSegmentEnd=it.getEstimatedBufferLevel(ot);var lt=o(st),ut=lt?.6:.8;if(it.isBufferStable&&1.05*it.segDurationMS<it.fetchDownloadDurationMS)return it.fetchDownloadDurationMS;if(!lt||it.segDurationMS<it.fetchDownloadDurationMS)return.8*it.fetchDownloadDurationMS;if(it.adjustedAvailabilityStartTimeMS<=it.requestTimeMS+it.throughputCapacityDelayMS-it.segDurationMS)return.8*it.fetchDownloadDurationMS;for(var ct=it.requestTimeMS+it.throughputCapacityDelayMS-it.adjustedAvailabilityStartTimeMS,dt=0,ht=0,pt=0,_t=0;_t<it.chunkMeasurements.length;_t++){var Et=it.chunkMeasurements[_t];if(ct<ht+Et.chunkDownloadDurationMS)break;ht+=Et.chunkDownloadDurationMS,dt+=Et.chunkBytes,pt++}if(ct<0&&rt.warn("request time was before adjusted availibitly start time"),dt&&ht&&pt>.2*it.chunkMeasurements.length){var St=dt/ht,wt=it.segmentBytes/St;return it.fetchDownloadDurationMS<wt?it.fetchDownloadDurationMS*ut:wt*ut}var Lt=it.bitrate;return it.bitrateList.some((function(nt){if(nt.bandwidth>it.bitrate)return Lt=nt.bandwidth,!0})),Lt===it.bitrate?it.fetchDownloadDurationMS*ut:ut*it.segmentBytes*8*1e3/Lt}},i(),nt}gt.__dashjs_factory_name="LowLatencyThroughputModel";var ii=ht.Z.getSingletonFactory(gt),ai=it(5717);function mt(nt,rt,it){return rt in nt?Object.defineProperty(nt,rt,{value:it,enumerable:!0,configurable:!0,writable:!0}):nt[rt]=it,nt}function yt(nt){nt=nt||{};var rt,it,at,st,lt,ut,ht,_t,Et,St,wt,Lt=this.context,Ct=nt.errHandler,Pt=nt.dashMetrics,kt=nt.mediaPlayerModel,Ft=nt.requestModifier,Gt=nt.boxParser,Ht=nt.errors,jt=nt.requestTimeout||0,Kt=(0,ct.Z)(Lt).getInstance(),$t=(0,Bt.Z)(Lt).getInstance();function w(nt,rt){var ct,pt=nt.request,wt=[],Bt=!0,Ht=!0,Yt=new Date,Wt=Yt,Qt=0,en=null,nn=null;if(!Ft||!Pt||!Ct)throw new Error("config object is not correct or missing");var an,x=function(nt){pt.requestStartDate=Yt,pt.requestEndDate=new Date,pt.firstByteDate=pt.firstByteDate||Yt,pt.fileLoaderType=nn;var rt=ct.response?ct.response.responseURL:null,it=ct.response?ct.response.status:null,at=ct.response&&ct.response.getAllResponseHeaders?ct.response.getAllResponseHeaders():ct.response?ct.response.responseHeaders:null,st=at&&$t.get().streaming.cmsd&&$t.get().streaming.cmsd.enabled?ht.parseResponseHeaders(at,pt.mediaType):null;Pt.addHttpRequest(pt,rt,it,at,nt?wt:null,st)},k=function(nt){Ht=!1,x(nt),pt.type===Ut.w.MPD_TYPE&&(Pt.addManifestUpdate(pt),Kt.trigger(dt.Z.MANIFEST_LOADING_FINISHED,{request:pt}))},U=function(){if(en&&(clearTimeout(en),en=null),-1!==it.indexOf(ct)&&(it.splice(it.indexOf(ct),1),Ht))if(k(!1),rt>0){try{$t.get().streaming.utcSynchronization.enableBackgroundSyncAfterSegmentDownloadError&&pt.type===Ut.w.MEDIA_SEGMENT_TYPE&&kt.getRetryAttemptsForType(Ut.w.MEDIA_SEGMENT_TYPE)===rt&&Kt.trigger(dt.Z.ATTEMPT_BACKGROUND_SYNC)}catch(nt){}rt--;var at={config:nt};st.push(at),at.timeout=setTimeout((function(){-1!==st.indexOf(at)&&(st.splice(st.indexOf(at),1),w(nt,rt))}),kt.getRetryIntervalsForType(pt.type))}else{if(pt.type===Ut.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE)return;Ct.error(new Ot.Z(lt[pt.type],pt.url+" is not available",{request:pt,response:ct.response})),nt.error&&nt.error(pt,"error",ct.response.statusText,ct.response),nt.complete&&nt.complete(pt,ct.response.statusText)}};pt.hasOwnProperty("availabilityTimeComplete")&&!1===pt.availabilityTimeComplete&&window.fetch&&"arraybuffer"===pt.responseType&&pt.type===Ut.w.MEDIA_SEGMENT_TYPE?((an=An(Lt).create({requestModifier:Ft,lowLatencyThroughputModel:Et,boxParser:Gt})).setup({dashMetrics:Pt}),nn=ot.Z.FILE_LOADER_TYPES.FETCH):(an=(0,bn.Z)(Lt).create({requestModifier:Ft}),nn=ot.Z.FILE_LOADER_TYPES.XHR);var ln=null,hn=Ft.modifyRequestURL?Ft.modifyRequestURL(pt.url):pt.url;if($t.get().streaming.cmcd&&$t.get().streaming.cmcd.enabled){var fn=$t.get().streaming.cmcd.mode;if(fn===ot.Z.CMCD_MODE_QUERY){var pn=function(nt){try{var rt=[],it=ut.getQueryParameter(nt);return it&&rt.push(it),rt}catch(nt){return[]}}(pt);hn=Lr.Z.addAditionalQueryParameterToUrl(hn,pn)}else fn===ot.Z.CMCD_MODE_HEADER&&(ln=ut.getHeaderParameters(pt))}var mn=_t.getXHRWithCredentialsForType(pt.type);if(pt.queryParams){var gn=Object.keys(pt.queryParams).map((function(nt){return{key:nt,value:pt.queryParams[nt]}}));hn=Lr.Z.addAditionalQueryParameterToUrl(hn,gn)}pt.url=hn,ct={url:hn,method:Ut.w.GET,withCredentials:mn,request:pt,onload:function(){ct.response.status>=200&&ct.response.status<=299&&(k(!0),nt.success&&nt.success(ct.response.response,ct.response.statusText,ct.response.responseURL),nt.complete&&nt.complete(pt,ct.response.statusText))},onend:U,onerror:U,progress:function(rt){var it=new Date;Bt&&(Bt=!1,(!rt.lengthComputable||rt.lengthComputable&&rt.total!==rt.loaded)&&(pt.firstByteDate=it)),rt.lengthComputable&&(pt.bytesLoaded=rt.loaded,pt.bytesTotal=rt.total),rt.noTrace||(wt.push({s:Wt,d:rt.time?rt.time:it.getTime()-Wt.getTime(),b:[rt.loaded?rt.loaded-Qt:0]}),Wt=it,Qt=rt.loaded),en&&(clearTimeout(en),en=null),$t.get().streaming.fragmentRequestProgressTimeout>0&&(en=setTimeout((function(){St.warn("Abort request "+ct.url+" due to progress timeout"),ct.response.onabort=null,ct.loader.abort(ct),U()}),$t.get().streaming.fragmentRequestProgressTimeout)),nt.progress&&rt&&nt.progress(rt)},onabort:function(){x(!0),en&&(clearTimeout(en),en=null),nt.abort&&nt.abort(pt)},ontimeout:function(nt){var rt;if(nt.lengthComputable){var it=nt.loaded/nt.total*100;rt="Request timeout: loaded: "+nt.loaded+", out of: "+nt.total+" : "+it.toFixed(3)+"% Completed"}else rt="Request timeout: non-computable download size";St.warn(rt)},loader:an,timeout:jt,headers:ln};var _n=(new Date).getTime();if(isNaN(pt.delayLoadingTime)||_n>=pt.delayLoadingTime)it.push(ct),an.load(ct);else{var vn={httpRequest:ct};at.push(vn),vn.delayTimeout=setTimeout((function(){if(-1!==at.indexOf(vn)){at.splice(at.indexOf(vn),1);try{Yt=new Date,Wt=Yt,it.push(vn.httpRequest),an.load(vn.httpRequest)}catch(nt){vn.httpRequest.onerror()}}}),pt.delayLoadingTime-_n)}}return rt={load:function(nt){nt.request?w(nt,kt.getRetryAttemptsForType(nt.request.type)):nt.error&&nt.error(nt.request,"error")},abort:function(){st.forEach((function(nt){clearTimeout(nt.timeout),nt.config.request&&nt.config.abort&&nt.config.abort(nt.config.request)})),st=[],at.forEach((function(nt){return clearTimeout(nt.delayTimeout)})),at=[],it.forEach((function(nt){nt.request.type!==Ut.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE&&(nt.onloadend=nt.onerror=nt.onprogress=void 0,nt.loader.abort(nt))})),it=[]}},St=(0,pt.Z)(Lt).getInstance().getLogger(rt),it=[],at=[],st=[],ut=Dr(Lt).getInstance(),ht=ni(Lt).getInstance(),Et=ii(Lt).getInstance(),_t=(0,ai.Z)(Lt).getInstance(),mt(wt={},Ut.w.MPD_TYPE,Ht.DOWNLOAD_ERROR_ID_MANIFEST_CODE),mt(wt,Ut.w.XLINK_EXPANSION_TYPE,Ht.DOWNLOAD_ERROR_ID_XLINK_CODE),mt(wt,Ut.w.INIT_SEGMENT_TYPE,Ht.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE),mt(wt,Ut.w.MEDIA_SEGMENT_TYPE,Ht.DOWNLOAD_ERROR_ID_CONTENT_CODE),mt(wt,Ut.w.INDEX_SEGMENT_TYPE,Ht.DOWNLOAD_ERROR_ID_CONTENT_CODE),mt(wt,Ut.w.BITSTREAM_SWITCHING_SEGMENT_TYPE,Ht.DOWNLOAD_ERROR_ID_CONTENT_CODE),mt(wt,Ut.w.OTHER_TYPE,Ht.DOWNLOAD_ERROR_ID_CONTENT_CODE),lt=wt,rt}yt.__dashjs_factory_name="HTTPLoader";var si=ht.Z.getClassFactory(yt);function vt(){var nt;function t(){nt={}}function n(){t()}return n(),{getLoader:function(rt){for(var it in nt)if(nt.hasOwnProperty(it)&&rt.startsWith(it))return nt[it];return si},registerLoader:function(rt,it){nt[rt]=it},unregisterLoader:function(rt){nt[rt]&&delete nt[rt]},unregisterAllLoader:t,reset:n}}vt.__dashjs_factory_name="SchemeLoaderFactory";var ui=ht.Z.getSingletonFactory(vt);function Tt(nt){nt=nt||{};var rt,it,at=this.context;return rt=ui(at).getInstance(),{load:function(st){if(!it){var ot=rt.getLoader(st&&st.request?st.request.url:null);it=ot(at).create({errHandler:nt.errHandler,mediaPlayerModel:nt.mediaPlayerModel,requestModifier:nt.requestModifier,dashMetrics:nt.dashMetrics,boxParser:nt.boxParser?nt.boxParser:null,constants:nt.constants?nt.constants:null,dashConstants:nt.dashConstants?nt.dashConstants:null,urlUtils:nt.urlUtils?nt.urlUtils:null,requestTimeout:isNaN(nt.requestTimeout)?0:nt.requestTimeout,errors:nt.errors})}it.load(st)},abort:function(){it&&it.abort()}}}Tt.__dashjs_factory_name="URLLoader";var ci=ht.Z.getClassFactory(Tt);function bt(nt){return bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},bt(nt)}function At(nt,rt){return At=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},At(nt,rt)}function It(nt,rt){return!rt||"object"!==bt(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function Rt(nt){return Rt=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},Rt(nt)}var fi=function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&At(nt,rt)}(i,nt);var rt,it,at=(rt=i,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=Rt(rt);if(it){var st=Rt(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return It(this,nt)});function i(nt){var rt;return function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,i),(rt=at.call(this,nt)).checkForExistenceOnly=!0,rt}return i}(St.Z);function Nt(nt){nt=nt||{};var rt,it,at=this.context,st=nt.eventBus,lt=nt.events,ut=nt.urlUtils,ct=nt.errors,dt=nt.streamId;return rt={checkForExistence:function(nt){var t=function(rt){st.trigger(lt.CHECK_FOR_EXISTENCE_COMPLETED,{request:nt,exists:rt})};if(nt){var rt=new fi(nt.url);it.load({request:rt,success:function(){t(!0)},error:function(){t(!1)}})}else t(!1)},load:function(nt){var r=function(it,at){st.trigger(lt.LOADING_COMPLETED,{request:nt,response:it||null,error:at||null,sender:rt})};nt?it.load({request:nt,progress:function(it){st.trigger(lt.LOADING_PROGRESS,{request:nt,stream:it.stream,streamId:dt}),it.data&&st.trigger(lt.LOADING_DATA_PROGRESS,{request:nt,response:it.data||null,error:null,sender:rt})},success:function(nt){r(nt)},error:function(nt,rt,it){r(void 0,new Ot.Z(ct.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE,it,rt))},abort:function(nt){nt&&st.trigger(lt.LOADING_ABANDONED,{mediaType:nt.mediaType,request:nt,sender:rt})}}):r(void 0,new Ot.Z(ct.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE,ct.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE))},abort:function(){it&&it.abort()},reset:function(){it&&(it.abort(),it=null)}},it=ci(at).create({errHandler:nt.errHandler,errors:ct,dashMetrics:nt.dashMetrics,mediaPlayerModel:nt.mediaPlayerModel,requestModifier:nt.requestModifier,urlUtils:ut,constants:ot.Z,boxParser:nt.boxParser,dashConstants:nt.dashConstants,requestTimeout:nt.settings.get().streaming.fragmentRequestTimeout}),rt}Nt.__dashjs_factory_name="FragmentLoader";var pi=ht.Z.getClassFactory(Nt);function Dt(){return{modifyResponseAsync:function(nt){return Promise.resolve(nt)}}}Dt.__dashjs_factory_name="SegmentResponseModifier";var gi=ht.Z.getSingletonFactory(Dt);function Mt(nt){nt=nt||{};var rt,it,at,st=this.context,lt=(0,ct.Z)(st).getInstance(),ut=nt.errHandler,ht=nt.mediaPlayerModel,Et=nt.dashMetrics,St=(0,pt.Z)(st).getInstance(),wt=gi(st).getInstance(),Lt=nt.streamInfo;function y(){return Lt.id}function E(){for(var nt in at)at[nt].reset();at={}}function v(nt){if(nt.sender){var rt=nt.request,at=nt.response,st=rt.isInitializationRequest(),ut=rt.mediaInfo.streamInfo;if(nt.error&&(rt.mediaType===ot.Z.AUDIO||rt.mediaType===ot.Z.VIDEO||rt.mediaType===ot.Z.TEXT&&rt.mediaInfo.isFragmented)&&lt.trigger(dt.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD,{entry:nt.request.serviceLocation}),at&&ut){var ct=function(nt,rt,it,at){var st=new Tn;return st.streamId=it,st.mediaInfo=rt.mediaInfo,st.segmentType=rt.type,st.start=rt.startTime,st.duration=rt.duration,st.end=st.start+st.duration,st.bytes=nt,st.index=rt.index,st.quality=rt.quality,st.representationId=rt.representationId,st.endFragment=at,st}(at,rt,Lt.id,nt.type!==dt.Z.FRAGMENT_LOADING_PROGRESS);wt.modifyResponseAsync(ct).then((function(nt){lt.trigger(st?dt.Z.INIT_FRAGMENT_LOADED:dt.Z.MEDIA_FRAGMENT_LOADED,{chunk:nt,request:rt},{streamId:ut.id,mediaType:rt.mediaType})})).catch((function(nt){it.error(nt),lt.trigger(st?dt.Z.INIT_FRAGMENT_LOADED:dt.Z.MEDIA_FRAGMENT_LOADED,{chunk:ct,request:rt},{streamId:ut.id,mediaType:rt.mediaType})}))}else it.warn("No "+rt.mediaType+" bytes to push or stream is inactive.")}}return rt={getStreamId:y,getModel:function(rt){var it=at[rt];return it||(it=kt(st).create({streamInfo:Lt,type:rt,dashMetrics:Et,fragmentLoader:pi(st).create({dashMetrics:Et,mediaPlayerModel:ht,errHandler:ut,requestModifier:(0,fn.Z)(st).getInstance(),settings:nt.settings,boxParser:nt.boxParser,eventBus:lt,events:dt.Z,errors:Ft,dashConstants:nt.dashConstants,urlUtils:nt.urlUtils,streamId:y()}),debug:St,eventBus:lt,events:dt.Z}),at[rt]=it),it},reset:function(){lt.off(_t.Z.FRAGMENT_LOADING_COMPLETED,v,this),lt.off(_t.Z.FRAGMENT_LOADING_PROGRESS,v,this),E()}},it=St.getLogger(rt),E(),lt.on(_t.Z.FRAGMENT_LOADING_COMPLETED,v,rt),lt.on(_t.Z.FRAGMENT_LOADING_PROGRESS,v,rt),rt}Mt.__dashjs_factory_name="FragmentController";var _i=ht.Z.getClassFactory(Mt),yi=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=null,this.width=null,this.height=null,this.x=null,this.y=null},vi=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN};function xt(nt){var rt,it,at=this.context,st=nt.streamInfo;function o(nt){it.setTrackByIndex(nt)}function s(){it&&it.reset()}return rt={getStreamId:function(){return st.id},initialize:function(){it.addTracks();var nt=it.getTracks();nt&&nt.length>0&&o(0)},provide:function(nt,rt){if("function"==typeof rt){var at,st,ot=it.getCurrentTrack();if(!ot||ot.segmentDuration<=0||null==nt)rt(null);else{(st=it.getThumbnailRequestForTime(nt))&&(ot.segmentDuration=st.duration),at=nt%ot.segmentDuration;var lt=Math.floor(at*ot.tilesHor*ot.tilesVert/ot.segmentDuration),ut=new yi;if(ut.width=Math.floor(ot.widthPerTile),ut.height=Math.floor(ot.heightPerTile),ut.x=Math.floor(lt%ot.tilesHor)*ot.widthPerTile,ut.y=Math.floor(lt/ot.tilesHor)*ot.heightPerTile,"readThumbnail"in ot)return ot.readThumbnail(nt,(function(nt){ut.url=nt,rt(ut)}));if(st)ut.url=st.url,ot.segmentDuration=NaN;else{var ct=Math.floor(nt/ot.segmentDuration);ut.url=function(nt,rt){var it=rt+nt.startNumber,at=(0,nn.vi)(nt.templateUrl,"Number",it);return at=(0,nn.vi)(at,"Time",(it-1)*nt.segmentDuration*nt.timescale),at=(0,nn.vi)(at,"Bandwidth",nt.bandwidth),(0,nn.eR)(at)}(ot,ct)}rt(ut)}}},setTrackByIndex:o,getCurrentTrackIndex:function(){return it.getCurrentTrackIndex()},getBitrateList:function(){var nt=it.getTracks(),rt=0;return nt.map((function(nt){var it=new vi;return it.mediaType=ot.Z.IMAGE,it.qualityIndex=rt++,it.bitrate=nt.bitrate,it.width=nt.width,it.height=nt.height,it}))},reset:s},s(),it=(0,yr.Z)(at).create({streamInfo:st,adapter:nt.adapter,baseURLController:nt.baseURLController,timelineConverter:nt.timelineConverter,debug:nt.debug,eventBus:nt.eventBus,events:nt.events,dashConstants:nt.dashConstants,dashMetrics:nt.dashMetrics,segmentBaseController:nt.segmentBaseController}),rt}xt.__dashjs_factory_name="ThumbnailController";var Ti=ht.Z.getClassFactory(xt),bi=it(7417);function Zt(nt){var rt;nt=nt||{};var it=[],at=(0,ct.Z)(this.context).getInstance(),st=nt.updateEventName,ot=nt.addBlacklistEventName;function o(nt){-1===it.indexOf(nt)&&(it.push(nt),at.trigger(st,{entry:nt}))}return rt={add:o,contains:function(nt){return!!(it.length&&nt&&nt.length)&&-1!==it.indexOf(nt)},reset:function(){it=[]}},ot&&at.on(ot,(function(nt){o(nt.entry)}),rt),rt}Zt.__dashjs_factory_name="BlackListController";var Ai=ht.Z.getClassFactory(Zt),Ri=[ot.Z.VIDEO,ot.Z.AUDIO,ot.Z.TEXT,ot.Z.MUXED,ot.Z.IMAGE];function qt(nt){nt=nt||{};var rt,it,at,st,ut,ht,_t,Et,St,wt,Lt,Ct,Pt,kt,Bt,Ut,Gt,Ht,jt=this.context,Kt=(0,ct.Z)(jt).getInstance(),$t=(0,pn.Z)(jt).getInstance(),Yt=nt.manifestModel,Wt=nt.mediaPlayerModel,Qt=nt.dashMetrics,en=nt.manifestUpdater,nn=nt.adapter,an=nt.timelineConverter,ln=nt.capabilities,hn=nt.errHandler,fn=nt.abrController,mn=nt.playbackController,gn=nt.eventController,_n=nt.mediaController,vn=nt.protectionController,Tn=nt.textController,bn=nt.videoModel,An=nt.streamInfo,Rn=nt.settings;function V(nt,rt){return new Promise((function(st,lt){ne(),wt=!0,ie();var ut=bn.getElement(),ct=[];Ri.forEach((function(rt){(rt!==ot.Z.TEXT||nt)&&(rt!==ot.Z.VIDEO||!ut||ut&&/^VIDEO$/i.test(ut.nodeName))&&ct.push(K(rt,nt))})),Promise.all(ct).then((function(){return nt=rt,new Promise((function(rt){var it={},st=at.map((function(rt){return rt.createBufferSinks(nt)}));Promise.all(st).then((function(nt){nt.forEach((function(nt){nt&&(it[nt.getType()]=nt)})),rt(it)})).catch((function(){rt(it)}))}));var nt})).then((function(rt){if(wt=!1,0===at.length){var ot="No streams to play.";hn.error(new Ot.Z(Ft.MANIFEST_ERROR_ID_NOSTREAMS_CODE,ot,Yt.getValue())),it.fatal(ot)}else oe();nt&&Tn.createTracks(An),st(rt)})).catch((function(nt){lt(nt)}))}))}function K(rt,st){var ut,ct=nn.getAllMediaInfoForType(An,rt),ht=[],pt=null;if(!ct||0===ct.length)return it.info("No "+rt+" data."),Promise.resolve();rt===ot.Z.VIDEO&&(_t=!0),rt===ot.Z.AUDIO&&(Et=!0);for(var St=0,wt=ct.length;St<wt;St++)pt=ct[St],rt===ot.Z.TEXT&&pt.isEmbedded&&(Tn.addEmbeddedTrack(An,pt),ht.push(pt)),z(pt)&&_n.addTrack(pt);if(ht.length>0&&(_n.setInitialMediaSettingsForType(rt,An),Tn.addMediaInfosToBuffer(An,rt,ht)),ct=ct.filter((function(nt){return!nt.isEmbedded})),0===ct.length)return Promise.resolve();if(rt===ot.Z.IMAGE)return(Ct=Ti(jt).create({streamInfo:An,adapter:nn,baseURLController:nt.baseURLController,timelineConverter:nt.timelineConverter,debug:Ut,eventBus:Kt,events:dt.Z,dashConstants:lt.Z,dashMetrics:nt.dashMetrics,segmentBaseController:nt.segmentBaseController})).initialize(),Promise.resolve();Kt.trigger(dt.Z.STREAM_INITIALIZING,{streamInfo:An,mediaInfo:pt}),_n.setInitialMediaSettingsForType(rt,An);var kt=function(rt,it){var st=rt&&rt.length>0?rt[0]:null,lt=Lt.getModel(st?st.type:null),ut=st?st.type:null,ct=st?st.mimeType:null,dt=st?st.isFragmented:null,ht=En(jt).create({streamInfo:An,type:ut,mimeType:ct,timelineConverter:an,adapter:nn,manifestModel:Yt,mediaPlayerModel:Wt,fragmentModel:lt,dashMetrics:nt.dashMetrics,baseURLController:nt.baseURLController,segmentBaseController:nt.segmentBaseController,abrController:fn,playbackController:mn,mediaController:_n,textController:Tn,errHandler:hn,settings:Rn,boxParser:Bt,segmentBlacklistController:Pt});ht.initialize(it,_t,dt),at.push(ht);for(var pt=0;pt<rt.length;pt++)ht.addMediaInfo(rt[pt]);return ut===ot.Z.TEXT&&Tn.addMediaInfosToBuffer(An,ut,rt,lt),ht}(ct,st);return(ut=_n.getCurrentTrackFor(rt,An.id))?(fn.updateTopQualityIndex(ut),kt.selectMediaInfo(rt===ot.Z.TEXT&&ut.isEmbedded?ct[0]:ut)):Promise.resolve()}function z(nt){var rt,at=nt?nt.type:null;return at===ot.Z.MUXED?(rt="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",it.fatal(rt),hn.error(new Ot.Z(Ft.MANIFEST_ERROR_ID_MULTIPLEXED_CODE,rt,Yt.getValue())),!1):!(at!==ot.Z.TEXT&&at!==ot.Z.IMAGE&&nt.contentProtection&&!ln.supportsEncryptedMedia()&&(hn.error(new Ot.Z(Ft.CAPABILITY_MEDIAKEYS_ERROR_CODE,Ft.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE)),1))}function W(nt){for(var rt=at?at.length:0,it=0;it<rt;it++){var st=at[it].getFragmentModel();st.abortRequests(),st.resetInitialSettings(),at[it].reset(!1,nt)}Tn&&Tn.deactivateStream(An),at=[],ut=!1,ht=!1,me(!1),J(!1),Kt.trigger(dt.Z.STREAM_DEACTIVATED,{streamInfo:An})}function X(nt){W(nt),st=!1,_t=!1,Et=!1,St={},wt=!1,Gt=!1,Ht=[]}function J(nt){Gt=nt}function $(){return An?An.start:NaN}function ee(){return An?An.id:null}function te(){return An}function ne(){if(!bn||!fn)throw new Error(ot.Z.MISSING_CONFIG_ERROR)}function re(nt){nt.error&&(hn.error(nt.error),it.fatal(nt.error.message))}function ie(){if(gn){var nt=nn.getEventsFor(An);nt&&nt.length>0&&gn.addInlineEvents(nt,An.id)}}function oe(){for(var nt=at.length,rt=St.audio||St.video?new Ot.Z(Ft.DATA_UPDATE_FAILED_ERROR_CODE,Ft.DATA_UPDATE_FAILED_ERROR_MESSAGE):null,it=0;it<nt;it++)if(at[it].isUpdating()||wt)return;if(vn){vn.clearMediaInfoArray();for(var lt=0;lt<nt&&at[lt];lt++){var ut=at[lt].getType(),ct=at[lt].getMediaInfo();if(ut===ot.Z.AUDIO||ut===ot.Z.VIDEO||ut===ot.Z.TEXT&&ct.isFragmented){var ht=at[lt].getMediaInfo();ht&&vn.initializeForMedia(ht)}}vn.handleKeySystemFromManifest()}rt?hn.error(rt):st||(st=!0,bn.waitForReadyState(ot.Z.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,(function(){Kt.trigger(dt.Z.STREAM_INITIALIZED,{streamInfo:An})})))}function se(){var nt=de(),rt=nt.length;if(0!==rt){for(var at=0;at<rt;at++)if(!nt[at].isBufferingCompleted()&&(nt[at].getType()===ot.Z.AUDIO||nt[at].getType()===ot.Z.VIDEO))return void it.debug("onBufferingCompleted - One streamProcessor has finished but",nt[at].getType(),"one is not buffering completed");it.debug("onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),ht=!0,Kt.trigger(dt.Z.STREAM_BUFFERING_COMPLETED,{streamInfo:An},{streamInfo:An})}else it.warn("onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined")}function ue(nt){St[nt.mediaType]=nt.error,oe()}function le(nt){gn&&gn.addInbandEvents(nt.events,An.id)}function ce(nt){return nt&&nt.type?fe(nt.type):null}function fe(nt){return nt?de().filter((function(rt){return rt.getType()===nt}))[0]:null}function de(){for(var nt,rt,it=[],st=0;st<at.length;st++)(nt=(rt=at[st]).getType())!==ot.Z.AUDIO&&nt!==ot.Z.VIDEO&&nt!==ot.Z.TEXT||it.push(rt);return it}function ge(nt,rt){var it=te(),at=rt.getStreamInfo();if(!at||!it)return!0;var st=nn.getAdaptationForType(at.index,nt,at),ot=nn.getAdaptationForType(it.index,nt,it);return st&&ot?!(!he(ot)&&he(st)):!st&&!ot}function he(nt){return!!nt&&!!(nt.ContentProtection||nt.Representation_asArray&&nt.Representation_asArray.length>0&&nt.Representation_asArray[0].ContentProtection)}function pe(nt,rt){var it=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!nt||!nt.hasOwnProperty("getStreamInfo"))return!1;var at=nt.getStreamInfo(),st=it?it.getStreamInfo():te();if(!at||!st)return!1;var ot=nn.getAdaptationForType(at.index,rt,at),lt=nn.getAdaptationForType(st.index,rt,st);if(!ot||!lt)return!ot&&!lt;var ut=ot&&lt&&ot.mimeType===lt.mimeType,ct=lt.Representation_asArray.map((function(nt){return nt.codecs})),dt=ot.Representation_asArray.map((function(nt){return nt.codecs})),ht=dt.some((function(nt){return ct.indexOf(nt)>-1})),pt=dt.some((function(nt){return ct.some((function(rt){return ln.codecRootCompatibleWithCodec(rt,nt)}))}));return ht||pt&&ut}function me(nt){kt=nt}function ye(){return kt}return rt={initialize:function(){Kt.on(dt.Z.BUFFERING_COMPLETED,se,rt),Kt.on(dt.Z.DATA_UPDATE_COMPLETED,ue,rt),Kt.on(dt.Z.INBAND_EVENTS,le,rt),vn&&(Kt.on(dt.Z.KEY_ERROR,re,rt),Kt.on(dt.Z.SERVER_CERTIFICATE_UPDATED,re,rt),Kt.on(dt.Z.LICENSE_REQUEST_COMPLETE,re,rt),Kt.on(dt.Z.KEY_SYSTEM_SELECTED,re,rt),Kt.on(dt.Z.KEY_SESSION_CREATED,re,rt),Kt.on(dt.Z.KEY_STATUSES_CHANGED,re,rt)),Tn.initializeForStream(An),Kt.trigger(dt.Z.STREAM_UPDATED,{streamInfo:An})},getStreamId:function(){return An?An.id:null},activate:function(nt,rt){return new Promise((function(it,at){if(!ut)return ye()?(ut=!0,Kt.trigger(dt.Z.STREAM_ACTIVATED,{streamInfo:An}),void it(rt)):void function(nt,rt){return V(nt,rt)}(nt,rt).then((function(nt){ut=!0,Kt.trigger(dt.Z.STREAM_ACTIVATED,{streamInfo:An}),it(nt)})).catch((function(nt){at(nt)}));it(rt)}))},deactivate:W,getIsActive:function(){return ut},getDuration:function(){return An?An.duration:NaN},getStartTime:$,getId:ee,getStreamInfo:te,getHasAudioTrack:function(){return Et},getHasVideoTrack:function(){return _t},startPreloading:function(nt,rt){return new Promise((function(st,ot){ye()?ot():(it.info("[startPreloading] Preloading next stream with id ".concat(ee())),me(!0),V(nt,rt).then((function(){for(var nt=0;nt<at.length&&at[nt];nt++)at[nt].setExplicitBufferingTime($()),at[nt].getScheduleController().startScheduleTimer();st()})).catch((function(){me(!1),ot()})))}))},initializeForTextWithMediaSource:function(nt){return new Promise((function(rt,it){K(ot.Z.TEXT,nt).then((function(){return(nt=fe(ot.Z.TEXT))?nt.createBufferSinks():Promise.resolve();var nt})).then((function(){Tn.createTracks(An),rt()})).catch((function(nt){it(nt)}))}))},getThumbnailController:function(){return Ct},getBitrateListFor:function(nt){if(ne(),nt===ot.Z.IMAGE)return Ct?Ct.getBitrateList():[];var rt=function(nt){for(var rt=null,it=0;it<at.length;it++)if((rt=at[it]).getType()===nt)return rt.getMediaInfo();return null}(nt);return fn.getBitrateList(rt)},updateData:function(nt){return new Promise((function(rt){wt=!0,An=nt,gn&&ie();for(var it=[],st=0,ot=at.length;st<ot;st++){var lt=at[st],ut=lt.getMediaInfo();it.push(lt.updateStreamInfo(An));var ct=nn.getAllMediaInfoForType(An,lt.getType());if(ct=ct.filter((function(nt){return!nt.isEmbedded}))){lt.clearMediaInfoArray();for(var ht=0;ht<ct.length;ht++){var pt=ct[ht];lt.addMediaInfo(ct[ht]),nn.areMediaInfosEqual(ut,pt)&&(fn.updateTopQualityIndex(pt),it.push(lt.selectMediaInfo(pt)))}}}Promise.all(it).then((function(){for(it=[];Ht.length>0;){var nt=Ht.pop(),rt=nt.newMediaInfo,at=ce(nt.oldMediaInfo);if(!at)return;it.push(at.prepareTrackSwitch()),it.push(at.selectMediaInfo(rt))}return Promise.all(it)})).then((function(){wt=!1,oe(),Kt.trigger(dt.Z.STREAM_UPDATED,{streamInfo:An}),rt()}))}))},reset:function(nt){Lt&&(Lt.reset(),Lt=null),fn&&An&&fn.clearDataForStream(An.id),Pt&&(Pt.reset(),Pt=null),X(nt),An=null,Kt.off(dt.Z.DATA_UPDATE_COMPLETED,ue,rt),Kt.off(dt.Z.BUFFERING_COMPLETED,se,rt),Kt.off(dt.Z.INBAND_EVENTS,le,rt),vn&&(Kt.off(dt.Z.KEY_ERROR,re,rt),Kt.off(dt.Z.SERVER_CERTIFICATE_UPDATED,re,rt),Kt.off(dt.Z.LICENSE_REQUEST_COMPLETE,re,rt),Kt.off(dt.Z.KEY_SYSTEM_SELECTED,re,rt),Kt.off(dt.Z.KEY_SESSION_CREATED,re,rt),Kt.off(dt.Z.KEY_STATUSES_CHANGED,re,rt))},getProcessors:de,setMediaSource:function(nt){return new Promise((function(rt,st){for(var ot=[],lt=0;lt<at.length;)z(at[lt].getMediaInfo())?(ot.push(at[lt].setMediaSource(nt)),lt++):(at[lt].reset(),at.splice(lt,1));Promise.all(ot).then((function(){for(var nt=0;nt<at.length;nt++)at[nt].dischargePreBuffer();if(0===at.length){var st="No streams to play.";hn.error(new Ot.Z(Ft.MANIFEST_ERROR_ID_NOSTREAMS_CODE,st+"nostreams",Yt.getValue())),it.fatal(st)}rt()})).catch((function(nt){it.error(nt),st(nt)}))}))},isMediaCodecCompatible:function(nt){var rt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return pe(nt,ot.Z.VIDEO,rt)&&pe(nt,ot.Z.AUDIO,rt)},isProtectionCompatible:function(nt){return!nt||ge(ot.Z.VIDEO,nt)&&ge(ot.Z.AUDIO,nt)},getPreloaded:ye,getIsEndedEventSignaled:function(){return Gt},setIsEndedEventSignaled:J,getAdapter:function(){return nn},getHasFinishedBuffering:function(){return ht},setPreloaded:me,startScheduleControllers:function(){for(var nt=at.length,rt=0;rt<nt&&at[rt];rt++)at[rt].getScheduleController().startScheduleTimer()},prepareTrackChange:function(nt){if(ut&&An){ht=!1;var rt=nt.newMediaInfo,at=Yt.getValue();nn.setCurrentMediaInfo(An.id,rt.type,rt);var st=ce(rt);if(st){var lt=mn.getTime();it.info("Stream -  Process track changed at current time "+lt),at.refreshManifestOnSwitchTrack?(Ht.push(nt),en.getIsUpdating()||(it.debug("Stream -  Refreshing manifest for switch track"),en.refreshManifest())):st.selectMediaInfo(rt).then((function(){rt.type!==ot.Z.VIDEO&&rt.type!==ot.Z.AUDIO||fn.updateTopQualityIndex(rt),st.prepareTrackSwitch()}))}}},prepareQualityChange:function(nt){var rt=fe(nt.mediaType);rt&&rt.prepareQualityChange(nt)}},function(){try{Ut=(0,pt.Z)(jt).getInstance(),it=Ut.getLogger(rt),X(),Bt=(0,bi.Z)(jt).getInstance(),Pt=Ai(jt).create({updateEventName:dt.Z.SEGMENT_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:dt.Z.SEGMENT_LOCATION_BLACKLIST_ADD}),Lt=_i(jt).create({streamInfo:An,mediaPlayerModel:Wt,dashMetrics:Qt,errHandler:hn,settings:Rn,boxParser:Bt,dashConstants:lt.Z,urlUtils:$t})}catch(nt){throw nt}}(),rt}qt.__dashjs_factory_name="Stream";var Ii=ht.Z.getClassFactory(qt),wi=function e(nt){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=nt||null,this.type=Ut.w.CONTENT_STEERING_TYPE,this.responseType="json"},Ci=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.version=null,this.ttl=300,this.reloadUri=null,this.pathwayPriority=[],this.pathwayClones=[]};function Vt(){var nt,rt,it,at,st,ot,ut,ct,dt,ht,Et,St,wt,Lt,Ct,Pt=this.context,kt=(0,pn.Z)(Pt).getInstance();function _(nt){I(nt,"baseUrl")}function T(nt){I(nt,"location")}function S(nt){if(nt&&nt.request&&nt.request.serviceLocation&&nt.request.requestStartDate&&nt.request.requestEndDate&&!isNaN(nt.request.bytesTotal)){var rt=nt.request.serviceLocation,it=nt.request.requestEndDate.getTime()-nt.request.requestStartDate.getTime();A(rt,parseInt(8*nt.request.bytesTotal/it*1e3))}}function b(nt){nt&&nt.httpRequest&&nt.httpRequest._serviceLocation&&!isNaN(nt.throughput)&&A(nt.httpRequest._serviceLocation,1e3*nt.throughput)}function A(nt,rt){st[nt]||(st[nt]=[]),st[nt].push(rt),st[nt].length>4&&st[nt].shift()}function I(nt,rt){if(nt&&nt.request&&nt.request.serviceLocation){var it=nt.request.serviceLocation;-1===at[rt].all.indexOf(it)&&at[rt].all.push(it),at[rt].current=it}}function R(){var nt=Et.getValue(),rt=Ct.getContentSteering(nt);return rt||(rt=wt.getServiceDescriptionSettings().contentSteering),rt}function N(){return new Promise((function(nt){try{var ot=R();if(!ot||!ot.serverUrl)return void nt();var ct=function(nt){var rt=nt.serverUrl;it&&it.reloadUri&&(rt=kt.isRelative(it.reloadUri)?kt.resolve(it.reloadUri,nt.serverUrl):it.reloadUri);var ot=[],lt=at.baseUrl.all.concat(at.location.all);if(lt.length>0){var ut=lt.map((function(nt){var rt=function(nt){if(!nt||!st[nt]||0===st[nt].length)return-1;var rt=st[nt].reduce((function(nt,rt){return nt+rt}))/st[nt].length;return parseInt(rt)}(nt);return{serviceLocation:nt,throughput:rt}}));ut.sort((function(nt,rt){return rt.throughput-nt.throughput}));var ct="",dt="";ut.forEach((function(nt,rt){0!==rt&&(ct="".concat(ct,","),nt.throughput>-1&&(dt="".concat(dt,","))),ct="".concat(ct).concat(nt.serviceLocation),nt.throughput>-1&&(dt="".concat(dt).concat(nt.throughput))})),ot.push({key:"_DASH_pathway",value:'"'.concat(ct,'"')}),ot.push({key:"_DASH_throughput",value:dt})}return Lr.Z.addAditionalQueryParameterToUrl(rt,ot)}(ot),dt=new wi(ct);ut.load({request:dt,success:function(rt){!function(nt){nt&&nt[lt.Z.CONTENT_STEERING_RESPONSE.VERSION]&&1===parseInt(nt[lt.Z.CONTENT_STEERING_RESPONSE.VERSION])&&((it=new Ci).version=nt[lt.Z.CONTENT_STEERING_RESPONSE.VERSION],nt[lt.Z.CONTENT_STEERING_RESPONSE.TTL]&&!isNaN(nt[lt.Z.CONTENT_STEERING_RESPONSE.TTL])&&(it.ttl=nt[lt.Z.CONTENT_STEERING_RESPONSE.TTL]),nt[lt.Z.CONTENT_STEERING_RESPONSE.RELOAD_URI]&&(it.reloadUri=nt[lt.Z.CONTENT_STEERING_RESPONSE.RELOAD_URI]),nt[lt.Z.CONTENT_STEERING_RESPONSE.PATHWAY_PRIORITY]&&(it.pathwayPriority=nt[lt.Z.CONTENT_STEERING_RESPONSE.PATHWAY_PRIORITY]),nt[lt.Z.CONTENT_STEERING_RESPONSE.PATHWAY_CLONES]&&(it.pathwayClones=nt[lt.Z.CONTENT_STEERING_RESPONSE.PATHWAY_CLONES],it.pathwayClones=it.pathwayClones.filter((function(nt){return function(nt){return nt[lt.Z.CONTENT_STEERING_RESPONSE.BASE_ID]&&nt[lt.Z.CONTENT_STEERING_RESPONSE.ID]&&nt[lt.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT]&&nt[lt.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][lt.Z.CONTENT_STEERING_RESPONSE.HOST]}(nt)}))),O())}(rt),Lt.trigger(_t.Z.CONTENT_STEERING_REQUEST_COMPLETED,{currentSteeringResponseData:it,url:ct}),nt()},error:function(at,st,ot,lt){!function(nt,at){try{switch(rt.warn("Error fetching data from content steering server",nt),at.status){case 410:break;case 429:var st=at&&at.getResponseHeader?at.getResponseHeader("retry-after"):null;null!==st&&(it||(it={}),it.ttl=parseInt(st)),O();break;default:O()}}catch(nt){rt.error(nt)}}(at,lt),nt(at)},complete:function(){at.baseUrl.all=C(at.baseUrl),at.location.all=C(at.location)}})}catch(rt){nt(rt)}}))}function C(nt){return nt.all&&0!==nt.all.length&&nt.current?nt.all.filter((function(rt){return rt===nt.current})):[]}function D(nt){try{var at=[];return nt&&0!==nt.length&&it&&it.pathwayClones&&0!==it.pathwayClones.length?(it.pathwayClones.forEach((function(rt){var it=nt.filter((function(nt){return rt[lt.Z.CONTENT_STEERING_RESPONSE.BASE_ID]===nt.serviceLocation})),st=null;if(it&&it.length>0&&(st=it[0]),st){var ot=new URL(st.url),ut=rt[lt.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][lt.Z.CONTENT_STEERING_RESPONSE.HOST];ut=Lr.Z.stringHasProtocol(ut)?ut:"".concat(ot.protocol,"//").concat(ut);var ct={synthesizedUrl:"".concat(ut).concat(ot.pathname),serviceLocation:rt[lt.Z.CONTENT_STEERING_RESPONSE.ID],queryParams:rt[lt.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][lt.Z.CONTENT_STEERING_RESPONSE.PARAMS],reference:st};at.push(ct)}})),at):at}catch(nt){return rt.error(nt),[]}}function O(){it&&it.ttl&&!isNaN(it.ttl)&&(ot&&clearTimeout(ot),ot=setTimeout((function(){N()}),1e3*it.ttl))}function M(){ot&&clearTimeout(ot),ot=null}function P(){it=null,st={},at={baseUrl:{current:null,all:[]},location:{current:null,all:[]}},M()}return nt={reset:function(){P(),Lt.off(_t.Z.FRAGMENT_LOADING_STARTED,_,nt),Lt.off(_t.Z.MANIFEST_LOADING_STARTED,T,nt),Lt.off(_t.Z.MANIFEST_LOADING_FINISHED,S,nt),Lt.off(_t.Z.THROUGHPUT_MEASUREMENT_STORED,b,nt)},setConfig:function(nt){nt&&(nt.adapter&&(Ct=nt.adapter),nt.errHandler&&(ct=nt.errHandler),nt.dashMetrics&&(dt=nt.dashMetrics),nt.mediaPlayerModel&&(ht=nt.mediaPlayerModel),nt.requestModifier&&(St=nt.requestModifier),nt.manifestModel&&(Et=nt.manifestModel),nt.serviceDescriptionController&&(wt=nt.serviceDescriptionController),nt.eventBus&&(Lt=nt.eventBus))},loadSteeringData:N,getCurrentSteeringResponseData:function(){return it},shouldQueryBeforeStart:function(){var nt=R();return!!nt&&nt.queryBeforeStart},getSteeringDataFromManifest:R,stopSteeringRequestTimer:M,getSynthesizedBaseUrlElements:function(nt){try{return D(nt).map((function(nt){var rt=new Kn(nt.synthesizedUrl,nt.serviceLocation);return rt.queryParams=nt.queryParams,rt.dvbPriority=nt.reference.dvbPriority,rt.dvbWeight=nt.reference.dvbWeight,rt.availabilityTimeOffset=nt.reference.availabilityTimeOffset,rt.availabilityTimeComplete=nt.reference.availabilityTimeComplete,rt}))}catch(nt){return rt.error(nt),[]}},getSynthesizedLocationElements:function(nt){try{return D(nt).map((function(nt){var rt=new Er(nt.synthesizedUrl,nt.serviceLocation);return rt.queryParams=nt.queryParams,rt}))}catch(nt){return rt.error(nt),[]}},initialize:function(){ut=ci(Pt).create({errHandler:ct,dashMetrics:dt,mediaPlayerModel:ht,requestModifier:St,errors:Ft}),Lt.on(_t.Z.FRAGMENT_LOADING_STARTED,_,nt),Lt.on(_t.Z.MANIFEST_LOADING_STARTED,T,nt),Lt.on(_t.Z.MANIFEST_LOADING_FINISHED,S,nt),Lt.on(_t.Z.THROUGHPUT_MEASUREMENT_STORED,b,nt)}},rt=(0,pt.Z)(Pt).getInstance().getLogger(nt),P(),nt}Vt.__dashjs_factory_name="ContentSteeringController";var Mi=ht.Z.getSingletonFactory(Vt);function zt(){var nt,rt,it,at=this.context,st=(0,Bt.Z)(at).getInstance();return nt={select:function(nt){if(!nt||0===nt.length)return null;var at=null;return st.get().streaming.applyContentSteering&&(at=function(nt){var at=it.getCurrentSteeringResponseData();return at&&at.pathwayPriority&&at.pathwayPriority.length>0?function(){for(var nt=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],it=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],at=0,st=null,a=function(){var ot=nt[at],lt=it.findIndex((function(nt){return nt.serviceLocation&&nt.serviceLocation===ot}));if(-1!==lt&&!rt.contains(it[lt].serviceLocation))return st=it[lt],"break";at+=1};at<nt.length&&"break"!==a(););return st}(at.pathwayPriority,nt):null}(nt)),at||(at=function(nt){return nt[0]}(nt)),at},setConfig:function(nt){nt.blacklistController&&(rt=nt.blacklistController),nt.contentSteeringController&&(it=nt.contentSteeringController)},reset:function(){rt.reset()}},rt=Ai(at).create({updateEventName:dt.Z.SERVICE_LOCATION_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:dt.Z.SERVICE_LOCATION_LOCATION_BLACKLIST_ADD}),it=Mi(at).getInstance(),nt}zt.__dashjs_factory_name="LocationSelector";var Pi=ht.Z.getClassFactory(zt);function Xt(){var nt,rt,it,at,st,ot,ut,ht,Et,St,wt,Lt,Ct,Pt,kt=this.context,Ot=(0,ct.Z)(kt).getInstance(),Bt=(0,pn.Z)(kt).getInstance();function S(){it=NaN,ut=!1,st=!0,ot=!1,b()}function b(){null!==at&&(clearTimeout(at),at=null)}function A(nt){b(),ot||(isNaN(nt)&&!isNaN(it)&&(nt=1e3*it),isNaN(nt)||(rt.debug("Refresh manifest in "+nt+" milliseconds."),at=setTimeout(C,nt)))}function I(){var nt=arguments.length>0&&void 0!==arguments[0]&&arguments[0];ut=!0;var rt=Et.getValue(),it=rt.url,at=null,st=wt.getPatchLocation(rt),ot=St.select(st),lt=null;if(ot&&!nt)it=ot.url,at=ot.serviceLocation,lt=ot.queryParams;else{var ct=R(rt),dt=St.select(ct);dt&&(it=dt.url,at=dt.serviceLocation,lt=dt.queryParams)}Bt.isRelative(it)&&(it=Bt.resolve(it,rt.url)),ht.load(it,at,lt)}function R(nt){var rt=wt.getLocation(nt),it=Ct.getSynthesizedLocationElements(rt);return rt.concat(it)}function N(nt){if(nt){if(wt.getIsPatch(nt)){var at=nt;nt=Et.getValue();var ct=wt.isPatchValid(nt,at),ht=ct;if(ct){var pt=wt.getPublishTime(nt);ht=wt.applyPatchToManifest(nt,at);var _t=wt.getPublishTime(nt);ht=pt.getTime()!=_t.getTime()}if(!ht)return rt.debug("Patch provided is invalid, performing full manifest refresh"),void I(!0);nt.loadedTime=new Date}}else(nt=Et.getValue()).loadedTime=new Date;if(Et.getValue()&&Et.getValue().type===lt.Z.DYNAMIC&&nt.type===lt.Z.STATIC)return Ot.trigger(dt.Z.DYNAMIC_TO_STATIC),ut=!1,void(ot=!0);Et.setValue(nt);var St=new Date,Lt=(St.getTime()-nt.loadedTime.getTime())/1e3;1e3*(it=wt.getManifestUpdatePeriod(nt,Lt))>2147483647&&(it=2147483.647),Ot.trigger(dt.Z.MANIFEST_UPDATED,{manifest:nt}),rt.info("Manifest has been refreshed at "+St+"["+St.getTime()/1e3+"] "),st||A()}function C(){st||(ut?A(Pt.get().streaming.manifestUpdateRetryInterval):I())}function D(nt){nt.error?nt.error.code===Ft.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE&&Lt.error(nt.error):N(nt.manifest)}function O(){st=!1,A()}function M(){(st=!Pt.get().streaming.scheduling.scheduleWhilePaused)&&b()}function P(){ut=!1}return nt={initialize:function(){S(),Ot.on(dt.Z.STREAMS_COMPOSED,P,this),Ot.on(_t.Z.PLAYBACK_STARTED,O,this),Ot.on(_t.Z.PLAYBACK_PAUSED,M,this),Ot.on(dt.Z.INTERNAL_MANIFEST_LOADED,D,this)},setManifest:function(nt){N(nt)},refreshManifest:I,getIsUpdating:function(){return ut},setConfig:function(nt){nt&&(nt.manifestModel&&(Et=nt.manifestModel),nt.adapter&&(wt=nt.adapter),nt.manifestLoader&&(ht=nt.manifestLoader),nt.errHandler&&(Lt=nt.errHandler),nt.locationSelector&&(St=nt.locationSelector),nt.settings&&(Pt=nt.settings),nt.contentSteeringController&&(Ct=nt.contentSteeringController))},reset:function(){Ot.off(_t.Z.PLAYBACK_STARTED,O,this),Ot.off(_t.Z.PLAYBACK_PAUSED,M,this),Ot.off(dt.Z.STREAMS_COMPOSED,P,this),Ot.off(dt.Z.INTERNAL_MANIFEST_LOADED,D,this),S()}},rt=(0,pt.Z)(kt).getInstance().getLogger(nt),St=Pi(kt).create(),nt}Xt.__dashjs_factory_name="ManifestUpdater";var ki=ht.Z.getClassFactory(Xt);function Jt(){var nt,rt,it,at,st,ot,lt,ut,ht,_t,Et,St,wt,Lt,Ct,Pt,kt=this.context,Bt=(0,ct.Z)(kt).getInstance(),Gt=(0,pn.Z)(kt).getInstance();function b(){ut=[],ht=[],_t=null,Et=null,wt=null,St=NaN,it=!1,at=!1,Lt=st.get().streaming.utcSynchronization.timeBetweenSyncAttempts}function A(){st.get().streaming.utcSynchronization.enabled&&!it&&!at&&wt&&wt.value&&wt.schemeIdUri&&!isNaN(St)&&!isNaN(st.get().streaming.utcSynchronization.backgroundAttempts)&&(Et&&(Date.now()-Et)/1e3<30||(ut=[],at=!0,I(isNaN(st.get().streaming.utcSynchronization.backgroundAttempts)?2:st.get().streaming.utcSynchronization.backgroundAttempts)))}function I(nt){try{if(nt<=0)return void B();var rt=Date.now();ot[wt.schemeIdUri](wt.value,(function(it){var at=Date.now(),st=N(rt,at,it);ut.push(st),I(nt-1)}),(function(){B()}))}catch(nt){B()}}function R(){var nt=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||0;if(!ht||0===ht.length||nt>=ht.length)D();else{var rt=ht[nt];if(rt)if(ot.hasOwnProperty(rt.schemeIdUri)){var it=(new Date).getTime();ot[rt.schemeIdUri](rt.value,(function(nt){var at=(new Date).getTime(),st=N(it,at,nt);wt=rt,D(st)}),(function(){R(nt+1)}))}else R(nt+1);else D()}}function N(nt,rt,it){return it-(rt-(rt-nt)/2)}function D(){var nt=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,rt=isNaN(nt);rt&&st.get().streaming.utcSynchronization.useManifestDateHeaderTimeSource?U():Z(rt,nt)}function O(nt){var rt=Date.parse(nt);return isNaN(rt)&&(rt=function(nt){var rt,it,at=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(nt);return rt=Date.UTC(parseInt(at[1],10),parseInt(at[2],10)-1,parseInt(at[3],10),parseInt(at[4],10),parseInt(at[5],10),at[6]&&(parseInt(at[6],10)||0),at[7]&&1e3*parseFloat(at[7])||0),at[9]&&at[10]&&(it=60*parseInt(at[9],10)+parseInt(at[10],10),rt+=("+"===at[8]?-1:1)*it*60*1e3),new Date(rt).getTime()}(nt)),rt}function M(nt){return Date.parse(nt)}function P(nt){return Date.parse(nt)}function L(nt,rt,it){it()}function F(nt,rt,it){var at=O(nt);isNaN(at)?it():rt(at)}function x(nt,rt,it,at,st){var ot,lt,ut=!1,ct=new XMLHttpRequest,dt=st?Ut.w.HEAD:Ut.w.GET,ht=rt.match(/\S+/g);if(rt=ht.shift(),ot=function(){ut||(ut=!0,ht.length?x(nt,ht.join(" "),it,at,st):at())},lt=function(){var rt,at;200===ct.status&&(rt=st?ct.getResponseHeader("Date"):ct.response,at=nt(rt),isNaN(at)||(it(at),ut=!0))},Gt.isRelative(rt)){var pt=Pt.resolve();pt&&(rt=Gt.resolve(rt,pt.url))}ct.open(dt,rt),ct.timeout=5e3,ct.onload=lt,ct.onloadend=ot,ct.send()}function k(nt,rt,it){x(P,nt,rt,it,!0)}function U(){var nt=lt.getLatestMPDRequestHeaderValueByID("Date"),rt=null!==nt?new Date(nt).getTime():Number.NaN;isNaN(rt)?Z(!0):Z(!1,rt-Date.now())}function Z(nt,at){if(isNaN(St)||isNaN(at)||nt||function(nt){try{var it,at=G(nt),ot=isNaN(Lt)?30:Lt,lt=isNaN(st.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor)?2:st.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor,ut=isNaN(st.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts)?600:st.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts,ct=isNaN(st.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts)?2:st.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts;at?(it=Math.min(ot*lt,ut),rt.debug("Increasing timeBetweenSyncAttempts to ".concat(it))):(it=Math.max(ot/lt,ct),rt.debug("Decreasing timeBetweenSyncAttempts to ".concat(it))),Lt=it}catch(nt){}}(at),!nt&&!isNaN(at)){_t=Date.now(),it=!1;var ot=isNaN(St);St=at,ot&&A(),rt.debug("Completed UTC sync. Setting client - server offset to ".concat(at))}nt&&(wt=null,it=!1,Ct.error(new Ot.Z(Ft.TIME_SYNC_FAILED_ERROR_CODE,Ft.TIME_SYNC_FAILED_ERROR_MESSAGE))),Bt.trigger(dt.Z.UPDATE_TIME_SYNC_OFFSET,{offset:at}),Bt.trigger(dt.Z.TIME_SYNCHRONIZATION_COMPLETED)}function B(){if(ut&&0!==ut.length){var nt=ut.reduce((function(nt,rt){return nt+rt}),0)/ut.length;G(nt)?rt.debug("Completed background UTC sync. Offset is within allowed threshold and is not adjusted."):(rt.debug("Completed background UTC sync. Setting client - server offset to ".concat(nt)),St=nt,Bt.trigger(dt.Z.UPDATE_TIME_SYNC_OFFSET,{offset:St})),at=!1,Et=Date.now()}}function G(nt){try{if(isNaN(St))return!0;var rt=st.get().streaming.utcSynchronization.maximumAllowedDrift&&!isNaN(st.get().streaming.utcSynchronization.maximumAllowedDrift)?st.get().streaming.utcSynchronization.maximumAllowedDrift:100;return nt>=St-rt&&nt<=St+rt}catch(nt){return!0}}return nt={initialize:function(){b(),ot={"urn:mpeg:dash:utc:http-head:2014":k,"urn:mpeg:dash:utc:http-xsdate:2014":x.bind(null,O),"urn:mpeg:dash:utc:http-iso:2014":x.bind(null,M),"urn:mpeg:dash:utc:direct:2014":F,"urn:mpeg:dash:utc:http-head:2012":k,"urn:mpeg:dash:utc:http-xsdate:2012":x.bind(null,O),"urn:mpeg:dash:utc:http-iso:2012":x.bind(null,M),"urn:mpeg:dash:utc:direct:2012":F,"urn:mpeg:dash:utc:http-ntp:2014":L,"urn:mpeg:dash:utc:ntp:2014":L,"urn:mpeg:dash:utc:sntp:2014":L}},attemptSync:function(nt,rt){ht=nt,it||(function(nt){try{if(!nt||!st.get().streaming.utcSynchronization.enabled)return!1;var rt=isNaN(Lt)?30:Lt;return!(_t&&rt&&!isNaN(rt))||(Date.now()-_t)/1e3>=rt}catch(nt){return!0}}(rt)?(it=!0,R()):Bt.trigger(dt.Z.TIME_SYNCHRONIZATION_COMPLETED))},setConfig:function(nt){nt&&(nt.dashMetrics&&(lt=nt.dashMetrics),nt.baseURLController&&(Pt=nt.baseURLController),nt.errHandler&&(Ct=nt.errHandler),nt.settings&&(st=nt.settings))},reset:function(){b(),Bt.off(dt.Z.ATTEMPT_BACKGROUND_SYNC,A,nt)}},rt=(0,pt.Z)(kt).getInstance().getLogger(nt),Bt.on(dt.Z.ATTEMPT_BACKGROUND_SYNC,A,nt),nt}Jt.__dashjs_factory_name="TimeSyncController";var Ni=ht.Z.getSingletonFactory(Jt);Ni.HTTP_TIMEOUT_MS=5e3,ht.Z.updateSingletonFactory(Jt.__dashjs_factory_name,Ni);var Oi=Ni;function tn(){var nt,rt,it,at,st,ot=this.context,lt=(0,ct.Z)(ot).getInstance();return nt={attachMediaSource:function(nt){var it=window.URL.createObjectURL(rt);return nt.setSource(it),"managedMediaSource"===at&&(nt.setDisableRemotePlayback(!0),rt.addEventListener("startstreaming",(function(){lt.trigger(_t.Z.MANAGED_MEDIA_SOURCE_START_STREAMING)})),rt.addEventListener("endstreaming",(function(){lt.trigger(_t.Z.MANAGED_MEDIA_SOURCE_END_STREAMING)}))),it},createMediaSource:function(){var nt="WebKitMediaSource"in window,it="MediaSource"in window;return"ManagedMediaSource"in window?(rt=new ManagedMediaSource,at="managedMediaSource",st.info("Created ManagedMediaSource")):it?(rt=new MediaSource,at="mediaSource",st.info("Created MediaSource")):nt&&(rt=new WebKitMediaSource,st.info("Created WebkitMediaSource")),rt},detachMediaSource:function(nt){nt.setSource(null)},setConfig:function(nt){nt&&nt.settings&&(it=nt.settings)},setDuration:function e(nt){rt&&"open"===rt.readyState&&(null===nt&&isNaN(nt)||rt.duration!==nt&&(nt!==1/0||it.get().streaming.buffer.mediaSourceDurationInfinity||(nt=Math.pow(2,32)),function(nt){for(var rt=nt.sourceBuffers,it=0;it<rt.length;it++)if(rt[it].updating)return!0;return!1}(rt)?setTimeout(e.bind(null,nt),50):(st.info("Set MediaSource duration:"+nt),rt.duration=nt)))},setSeekable:function(nt,it){rt&&"function"==typeof rt.setLiveSeekableRange&&"function"==typeof rt.clearLiveSeekableRange&&"open"===rt.readyState&&nt>=0&&nt<it&&(rt.clearLiveSeekableRange(),rt.setLiveSeekableRange(nt,it))},signalEndOfStream:function(nt){if(nt&&"open"===nt.readyState){for(var rt=nt.sourceBuffers,it=0;it<rt.length;it++){if(rt[it].updating)return;if(0===rt[it].buffered.length)return}st.info("call to mediaSource endOfStream"),nt.endOfStream()}}},st=(0,pt.Z)(ot).getInstance().getLogger(nt),nt}tn.__dashjs_factory_name="MediaSourceController";var Fi=ht.Z.getSingletonFactory(tn);function rn(){var nt,rt,it,at,st,ot,lt,ut,dt,ht,Et,St="urn:mpeg:dash:event:2012",wt="discarded",Lt="updated",Ct="added",Pt=this.context,kt=(0,ct.Z)(Pt).getInstance();function _(){if(!lt||!ut)throw new Error("setConfig function has to be called previously")}function T(){Et=!1,it={},at={},st=null,ht=!1,ot=Date.now()/1e3}function S(){try{if(!ht){ht=!0;var nt=ut.getTime(),st=nt-ot;st=ot>0?Math.max(0,st):0,b(at,st,nt),b(it,st,nt),A(at),A(it),ot=nt,ht=!1}}catch(nt){ht=!1,rt.error(nt)}}function b(nt,it,at){try{N(nt,(function(st){if(void 0!==st){var ot=isNaN(st.duration)?0:st.duration;st.calculatedPresentationTime<=at&&st.calculatedPresentationTime+it+ot>=at?D(st,_t.Z.EVENT_MODE_ON_START):(C(at,ot+it,st.calculatedPresentationTime)||function(nt){try{var it=nt.eventStream.period.start+nt.eventStream.period.duration;return nt.calculatedPresentationTime>it}catch(nt){return rt.error(nt),!1}}(st))&&(rt.debug("Removing event ".concat(st.id," from period ").concat(st.eventStream.period.id," as it is expired or invalid")),function(nt,it){try{var at=it.eventStream.schemeIdUri,st=it.eventStream.period.id,ot=it.eventStream.value,lt=it.id;nt[st][at]=nt[st][at].filter((function(nt){return ot&&nt.eventStream.value&&nt.eventStream.value!==ot||nt.id!==lt})),0===nt[st][at].length&&delete nt[st][at]}catch(nt){rt.error(nt)}}(nt,st))}}))}catch(nt){rt.error(nt)}}function A(nt){try{for(var it in nt)nt.hasOwnProperty(it)&&0===Object.keys(nt[it]).length&&delete nt[it]}catch(nt){rt.error(nt)}}function I(nt,rt){var it=arguments.length>2&&void 0!==arguments[2]&&arguments[2],at=nt.eventStream.schemeIdUri,st=nt.eventStream.value,ot=nt.id,lt=wt;rt[at]||(rt[at]=[]);var ut=rt[at].findIndex((function(nt){return(!st||nt.eventStream.value&&nt.eventStream.value===st)&&nt.id===ot}));if(-1===ut)rt[at].push(nt),nt.triggeredReceivedEvent=!1,nt.triggeredStartEvent=!1,lt=Ct;else if(it){var ct=rt[at][ut];nt.triggeredReceivedEvent=ct.triggeredReceivedEvent,nt.triggeredStartEvent=ct.triggeredStartEvent,rt[at][ut]=nt,lt=Lt}return lt}function R(nt){try{if(1==nt.eventStream.value){var it,at=nt.calculatedPresentationTime;it=4294967295==nt.calculatedPresentationTime?NaN:nt.calculatedPresentationTime+nt.duration,kt.trigger(_t.Z.MANIFEST_VALIDITY_CHANGED,{id:nt.id,validUntil:at,newDuration:it,newManifestValidAfter:NaN},{mode:_t.Z.EVENT_MODE_ON_START})}}catch(nt){rt.error(nt)}}function w(nt){try{var it=ut.getTime();N(nt,(function(nt){var rt=nt.eventStream&&nt.eventStream.period&&!isNaN(nt.eventStream.period.duration)?nt.eventStream.period.duration:NaN,at=nt.eventStream&&nt.eventStream.period&&!isNaN(nt.eventStream.period.start)?nt.eventStream.period.start:NaN;if(!isNaN(rt)&&!isNaN(at)){var st=nt.calculatedPresentationTime;Math.abs(st-it)<300&&D(nt,_t.Z.EVENT_MODE_ON_START)}}))}catch(nt){rt.error(nt)}}function N(nt,it){try{if(nt)for(var at=Object.keys(nt),st=0;st<at.length;st++)for(var ot=nt[at[st]],lt=Object.keys(ot),ut=0;ut<lt.length;ut++)ot[lt[ut]].forEach((function(nt){void 0!==nt&&it(nt)}))}catch(nt){rt.error(nt)}}function C(nt,it,at){try{return nt-it>at}catch(nt){return rt.error(nt),!1}}function D(nt,it){try{var at=ut.getTime(),st=nt.id;if(it===_t.Z.EVENT_MODE_ON_RECEIVE&&!nt.triggeredReceivedEvent)return rt.debug("Received event ".concat(st)),nt.triggeredReceivedEvent=!0,void kt.trigger(nt.eventStream.schemeIdUri,{event:nt},{mode:it});nt.triggeredStartEvent||(nt.eventStream.schemeIdUri===St&&1==nt.eventStream.value?0===nt.duration&&0===nt.presentationTimeDelta||(rt.debug("Starting manifest refresh event ".concat(st," at ").concat(at)),function(){try{_(),lt.refreshManifest()}catch(nt){rt.error(nt)}}()):"urn:mpeg:dash:event:callback:2015"===nt.eventStream.schemeIdUri&&1==nt.eventStream.value?(rt.debug("Starting callback event ".concat(st," at ").concat(at)),function(nt){try{(0,bn.Z)(Pt).create({}).load({method:"get",url:nt,request:{responseType:"arraybuffer"}})}catch(nt){rt.error(nt)}}(nt.messageData)):(rt.debug("Starting event ".concat(st," from period ").concat(nt.eventStream.period.id," at ").concat(at)),kt.trigger(nt.eventStream.schemeIdUri,{event:nt},{mode:it})),nt.triggeredStartEvent=!0)}catch(nt){rt.error(nt)}}return nt={addInlineEvents:function(nt,at){try{if(_(),it[at]||(it[at]={}),nt)for(var st=0;st<nt.length;st++){var ot=nt[st];if(!C(ut.getTime(),isNaN(ot.duration)?0:ot.duration,ot.calculatedPresentationTime)){var lt=I(ot,it[at],!0);lt===Ct?(rt.debug("Added inline event with id ".concat(ot.id," from period ").concat(at)),D(ot,_t.Z.EVENT_MODE_ON_RECEIVE)):lt===Lt&&rt.debug("Updated inline event with id ".concat(ot.id," from period ").concat(at))}}}catch(nt){throw nt}},addInbandEvents:function(nt,it){try{_(),at[it]||(at[it]={});for(var st=0;st<nt.length;st++){var ot=nt[st];C(ut.getTime(),isNaN(ot.duration)?0:ot.duration,ot.calculatedPresentationTime)||(I(ot,at[it],!1)===Ct?(ot.eventStream.schemeIdUri===St&&R(ot),rt.debug("Added inband event with id ".concat(ot.id," from period ").concat(it)),D(ot,_t.Z.EVENT_MODE_ON_RECEIVE)):rt.debug("Inband event with scheme_id_uri ".concat(ot.eventStream.schemeIdUri,", value ").concat(ot.eventStream.value,", period id ").concat(it," and event id ").concat(ot.id," was ignored because it has been added before.")))}S()}catch(nt){throw nt}},getInbandEvents:function(){return at},getInlineEvents:function(){return it},start:function(){try{_(),rt.debug("Start Event Controller");var nt=dt.get().streaming.eventControllerRefreshDelay;Et||isNaN(nt)||(Et=!0,st=setInterval(S,nt))}catch(nt){throw nt}},setConfig:function(nt){try{if(!nt)return;nt.manifestUpdater&&(lt=nt.manifestUpdater),nt.playbackController&&(ut=nt.playbackController),nt.settings&&(dt=nt.settings)}catch(nt){throw nt}},reset:function(){(function(){try{null!==st&&Et&&(clearInterval(st),st=null,Et=!1,function(){try{w(at),w(it)}catch(nt){rt.error(nt)}}())}catch(nt){throw nt}})(),T()}},rt=(0,pt.Z)(Pt).getInstance().getLogger(nt),T(),nt}rn.__dashjs_factory_name="EventController";var Gi=ht.Z.getSingletonFactory(rn),Zi={LEVELS:{SUGGESTION:"Suggestion",WARNING:"Warning",ERROR:"Error"},EVENTS:{NO_UTC_TIMING_ELEMENT:{key:"NO_UTC_TIMING_ELEMENT",message:"No UTCTiming element is present in the manifest. You may experience playback failures. For a detailed validation use https://conformance.dashif.org/"},NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE:{key:"NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE",message:'SMPTE 2052-1:2013 defines the attribute name as "imageType" and does not define "imagetype"'},INVALID_DVR_WINDOW:{key:"INVALID_DVR_WINDOW",message:"No valid segment found when applying a specification compliant DVR window calculation. Using SegmentTimeline entries as a fallback."}}};function sn(nt,rt){(null==rt||rt>nt.length)&&(rt=nt.length);for(var it=0,at=new Array(rt);it<rt;it++)at[it]=nt[it];return at}function un(){var nt,rt,it,at,st,lt,ht,Et,St,wt,Lt,Ct,Pt,kt,Bt,Ut,Gt,Ht,Kt,$t,Yt,Wt,Qt,en,nn,an,ln,hn,fn,pn,_n,vn,En,Tn,bn,An,Rn,In,Ln,Dn,Mn,Nn,xn,Un,Hn,Kn,Yn,Wn,Jn=this.context,er=(0,ct.Z)(Jn).getInstance();function se(){if(!(lt&&lt.hasOwnProperty("load")&&Yt&&Yt.hasOwnProperty("initialize")&&Yt.hasOwnProperty("reset")&&Yt.hasOwnProperty("getClientTimeOffset")&&ht&&$t&&St&&En))throw new Error(ot.Z.MISSING_CONFIG_ERROR)}function ue(){if(!st||!st.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")}function le(){!function(){try{var nt=Et.getStreamsInfo();if(!Qt&&0===nt.length)throw new Error("There are no periods in the MPD");Qt&&nt.length>0&&St.updateManifestUpdateInfo({currentTime:En.getTime(),buffered:vn.getBufferRange(),presentationStartTime:nt[0].start,clientTimeOffset:Yt.getClientTimeOffset()}),Wt.length>0&&function(nt){0!==nt.length?Wt=Wt.filter((function(it){var at=nt.filter((function(nt){return nt.id===it.getId()})).length>0||it.getId()===Qt.getId();return at||(rt.debug("Removing stream ".concat(it.getId())),it.reset(!0)),at})):rt.warn("No periods included in the current manifest. Skipping the filtering of outdated stream objects.")}(nt);for(var it=[],at=0,st=nt.length;at<st;at++){var ot=nt[at];it.push(fe(ot)),St.addManifestUpdateStreamInfo(ot)}Promise.all(it).then((function(){return new Promise((function(rt,it){Qt?rt():de(nt,rt,it)}))})).then((function(){er.trigger(dt.Z.STREAMS_COMPOSED),Me()})).catch((function(nt){throw nt}))}catch(nt){$t.error(new Ot.Z(Ft.MANIFEST_ERROR_ID_NOSTREAMS_CODE,nt.message+" nostreamscomposed",ht.getValue())),pn=!0,Qe()}}()}function ce(){Hn=!0}function fe(nt){var rt=ze(nt.id);return rt?rt.updateData(nt):(rt=Ii(Jn).create({manifestModel:ht,mediaPlayerModel:bn,dashMetrics:St,manifestUpdater:st,adapter:Et,timelineConverter:Yt,capabilities:it,capabilitiesFilter:at,errHandler:$t,baseURLController:Pt,segmentBaseController:kt,textController:nn,abrController:Ut,playbackController:En,eventController:Ht,mediaController:Gt,protectionController:en,videoModel:vn,streamInfo:nt,settings:Un}),Wt.push(rt),rt.initialize(),Promise.resolve())}function de(nt,it,at){try{Ae();var st=St.getCurrentDVRInfo().range;if(st.end<st.start){Kn&&clearTimeout(Kn);var ot=Math.min(1e3*(-1*(st.end-st.start)+2),2147483647);return rt.debug("Waiting for ".concat(ot," ms before playback can start")),er.trigger(dt.Z.AST_IN_FUTURE,{delay:ot}),void(Kn=setTimeout((function(){de(nt,it,at)}),ot))}Un.get().streaming.applyProducerReferenceTime&&Tn.calculateProducerReferenceTimeOffsets(nt);var lt=nt[0].manifestInfo;if(Un.get().streaming.applyServiceDescription&&Tn.applyServiceDescription(lt),Et.getIsDynamic()){var ut=Be(nt,lt);En.computeAndSetLiveDelay(ut,lt)}(Un.get().streaming.applyContentSteering&&Ct.shouldQueryBeforeStart()?Ct.loadSteeringData():Promise.resolve()).then((function(){var nt=ht.getValue();nt&&Pt.update(nt),ge(),it()})).catch((function(nt){rt.error(nt),ge(),it()}))}catch(nt){at(nt)}}function ge(){var nt=function(){var nt;if(Et.getIsDynamic()){var it=St.getCurrentDVRInfo();nt=(it&&it.range?it.range.end:0)-En.getOriginalLiveDelay();var at=it?it.range:null;if(at){if(isNaN(Yn)&&-1===Yn.toString().indexOf("posix:")){var st=ke(!0);isNaN(st)||(rt.info("Start time from URI parameters: ".concat(st)),nt=Math.min(nt,st))}else{rt.info("Start time provided by the app: ".concat(Yn));var ot=Ue(!0,Yn);isNaN(ot)||(nt=Math.min(nt,ot))}var lt=Un.get().streaming.timeShiftBuffer.calcFromSegmentTimeline?.1:0;nt=Math.max(nt,at.start+lt)}}else if(nt=$e()[0].getStreamInfo().start,isNaN(Yn)){var ut=ke(!1);isNaN(ut)||(rt.info("Start time from URI parameters: ".concat(ut)),nt=Math.max(nt,ut))}else{rt.info("Start time provided by the app: ".concat(Yn));var ct=Ue(!1,Yn);isNaN(ct)||(nt=Math.max(nt,ct))}return nt}(),it=be(nt),at=null!==it?it:Wt[0];er.trigger(dt.Z.INITIAL_STREAM_SWITCH,{startTime:nt}),he(at,null,nt),Dn||(Dn=setInterval((function(){!hn&&En.getTimeToStreamEnd()<=0&&!En.isSeeking()&&er.trigger(dt.Z.PLAYBACK_ENDED,{isLast:Ke().isLast})}),200))}function he(nt,it,at){try{if(hn||!nt||it===nt&&nt.getIsActive())return;hn=!0,er.trigger(dt.Z.PERIOD_SWITCH_STARTED,{fromStreamInfo:it?it.getStreamInfo():null,toStreamInfo:nt.getStreamInfo()});var st=!1;Qt=nt,it&&(st=Te(nt,it),it.deactivate(st)),at=isNaN(at)?!st&&it?nt.getStreamInfo().start:NaN:at,rt.info("Switch to stream ".concat(nt.getId(),". Seektime is ").concat(at,", current playback time is ").concat(En.getTime(),". Seamless period switch is set to ").concat(st)),Nn=Nn.filter((function(nt){return nt.getId()!==Qt.getId()})),En.initialize(Ke(),!!it),vn.getElement()?pe(at,st,!1):me(at,st)}catch(nt){hn=!1}}function pe(nt,it){var at,st=arguments.length>2&&void 0!==arguments[2]&&arguments[2];function a(){if(_n&&"open"===_n.readyState){rt.debug("MediaSource is open!"),window.URL.revokeObjectURL(at),_n.removeEventListener("sourceopen",a),_n.removeEventListener("webkitsourceopen",a),xe();var ot=St.getCurrentDVRInfo();wt.setSeekable(ot.range.start,ot.range.end),st?(isNaN(nt)||En.seek(nt,!0,!0),Qt.setMediaSource(_n).then((function(){Qt.initializeForTextWithMediaSource(_n)}))):me(nt,it)}}function o(){_n.addEventListener("sourceopen",a,!1),_n.addEventListener("webkitsourceopen",a,!1),at=wt.attachMediaSource(vn),rt.debug("MediaSource attached to element.  Waiting on open...")}_n?it?me(nt,it):(wt.detachMediaSource(vn),o()):(_n=wt.createMediaSource(),o())}function me(nt,rt){Qt.activate(_n,rt?Mn:void 0,nt).then((function(rt){if(rt){var it=Object.keys(rt);it.length>0&&rt[it[0]].getBuffer().changeType&&(xn=!0),Mn=rt}isNaN(nt)||(er.trigger(dt.Z.SEEK_TARGET,{time:nt},{streamId:Qt.getId()}),En.seek(nt,!1,!0),Qt.startScheduleControllers()),hn=!1,er.trigger(dt.Z.PERIOD_SWITCH_COMPLETED,{toStreamInfo:Ke()})}))}function ye(nt){var rt=be(nt.seekTime);rt&&rt!==Qt?rt&&rt!==Qt&&(Ee(),function(nt,rt){var it=nt&&!isNaN(nt.seekTime)?nt.seekTime:NaN,at=Qt.getProcessors().map((function(rt){return rt.prepareOuterPeriodPlaybackSeeking(nt)}));Promise.all(at).then((function(){he(rt,Qt,it)})).catch((function(nt){$t.error(nt)}))}(nt,rt)):(Ee(),function(nt){Qt.getProcessors().forEach((function(rt){return rt.prepareInnerPeriodPlaybackSeeking(nt)})),je(gn.USER_REQUEST_STOP_REASON)}(nt)),He(mn.SEEK_START_REASON)}function Ee(){ve()}function ve(){Nn&&Nn.length>0&&(Nn.forEach((function(nt){nt.deactivate(!0)})),Nn=[])}function _e(nt){if(nt.newMediaInfo.streamInfo.id===Qt.getId()){if(ve(),Un.get().streaming.buffer.resetSourceBuffersForTrackSwitch&&nt.oldMediaInfo&&nt.oldMediaInfo.codec!==nt.newMediaInfo.codec){var rt=En.getTime();return Qt.deactivate(!1),void pe(rt,!1,!1)}Qt.prepareTrackChange(nt)}}function Te(nt,rt){try{return Un.get().streaming.buffer.reuseExistingSourceBuffers&&(rt.isProtectionCompatible(nt)||Hn)&&(xn&&Un.get().streaming.buffer.useChangeTypeForTrackSwitch||rt.isMediaCodecCompatible(nt,rt))}catch(nt){return!1}}function Se(nt){var rt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_n&&!nt.getPreloaded()&&Te(nt,rt)&&nt.startPreloading(_n,Mn).then((function(){Nn.push(nt)}))}function be(nt){if(isNaN(nt))return null;for(var rt=Wt.length,it=0;it<rt;it++){var at=Wt[it];if(nt<parseFloat((at.getStartTime()+at.getDuration()).toFixed(5)))return at}return null}function Ae(){try{var nt=Et.getIsDynamic(),rt=Et.getStreamsInfo()[0].manifestInfo,it=En.getTime(),at=Yt.calcTimeShiftBufferWindow(Wt,nt),st=Le();if(void 0===at.start||void 0===at.end)return;st&&0!==st.length?st.forEach((function(nt){St.addDVRInfo(nt.getType(),it,rt,at)})):St.addDVRInfo(ot.Z.VIDEO,it,rt,at)}catch(nt){}}function Ie(nt){if(In&&ln){var rt=bn.getInitialBufferLevel(),it=[ot.Z.TEXT];(isNaN(rt)||rt<=En.getBufferLevel(it)||Et.getIsDynamic()&&rt>En.getLiveDelay())&&(In=!1,He(mn.INITIAL_PLAYOUT_START_REASON),En.play())}nt&&nt.mediaType&&St.addBufferLevel(nt.mediaType,new Date,1e3*nt.bufferLevel)}function Re(nt){nt.streamInfo.id===Qt.getId()&&nt.reason&&nt.reason.forceReplace&&ve(),ze(nt.streamInfo.id).prepareQualityChange(nt)}function we(){if(Et.getIsDynamic()&&0!==En.getOriginalLiveDelay()&&Qt){var nt=Et.getStreamsInfo();if(nt.length>0){var rt=nt[0].manifestInfo,it=Be(nt,rt);En.computeAndSetLiveDelay(it,rt)}}}function Ne(){if(qe()){var nt=vn.getPlaybackQuality();nt&&St.addDroppedFrames(nt)}}function Ce(){rt.debug("[onPlaybackStarted]"),!In&&Rn&&He(mn.RESUME_FROM_PAUSE_START_REASON),In&&(In=!1),Ln&&(Ln=!1,Un.get().streaming.applyContentSteering&&!Ct.shouldQueryBeforeStart()&&Ct.loadSteeringData()),Rn=!1}function De(nt){rt.debug("[onPlaybackPaused]"),nt.ended||(Rn=!0,je(gn.USER_REQUEST_STOP_REASON))}function Oe(nt){rt.debug("Stream with id ".concat(nt.streamInfo.id," finished buffering"));var it=nt.streamInfo.isLast;_n&&it?(rt.info("[onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),wt.signalEndOfStream(_n)):Me()}function Me(){if(Qt&&Qt.getHasFinishedBuffering())for(var nt=function(){var nt=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{var rt=nt||Qt||null;if(rt){var it=rt.getStreamInfo();return Wt.filter((function(nt){var rt=nt.getStreamInfo();return rt.start>it.start&&it.id!==rt.id}))}}catch(nt){return[]}}(Qt),rt=0;rt<nt.length;){var it=nt[rt],at=0===rt?Qt:nt[rt-1];!it.getPreloaded()&&at.getHasFinishedBuffering()&&_n&&Se(it,at),rt+=1}}function Pe(){Dn&&(clearInterval(Dn),Dn=null)}function Le(){return Qt?Qt.getProcessors():[]}function Fe(nt){if(Qt&&!Qt.getIsEndedEventSignaled()){Qt.setIsEndedEventSignaled(!0);var it=function(){var nt=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||Qt||null;if(!nt)return null;for(var rt=nt.getStreamInfo(),it=rt.start,at=0,st=-1,ot=NaN;at<Wt.length;){var lt=Wt[at].getStreamInfo(),ut=lt.start-it;ut>0&&(isNaN(ot)||ut<ot)&&rt.id!==lt.id&&(ot=ut,st=at),at+=1}return st>=0?Wt[st]:null}();it?(rt.debug("StreamController onEnded, found next stream with id ".concat(it.getStreamInfo().id,". Switching from ").concat(Qt.getStreamInfo().id," to ").concat(it.getStreamInfo().id)),he(it,Qt,NaN)):(rt.debug("StreamController no next stream found"),Qt.setIsEndedEventSignaled(!1)),je(it?gn.END_OF_PERIOD_STOP_REASON:gn.END_OF_CONTENT_STOP_REASON)}nt&&nt.isLast&&(Pe(),Ct.stopSteeringRequestTimer())}function xe(nt){var rt=nt||Ke().manifestInfo.duration;wt.setDuration(rt)}function ke(nt){var rt=Bt.getURIFragmentData();if(!rt||!rt.t)return NaN;var it=$e()[0].getStreamInfo().start;return rt.t=rt.t.split(",")[0],Ze(nt,rt.t,it)}function Ue(nt,rt){var it=0;return nt||(it=$e()[0].getStreamInfo().start),Ze(nt,rt,it)}function Ze(nt,rt,it){var at=Et.getRegularPeriods()[0],st=rt.toString(),ot=-1!==st.indexOf("posix:")?"now"===st.substring(6)?Date.now()/1e3:parseFloat(st.substring(6)):NaN;return nt&&!isNaN(ot)?Yt.calcPresentationTimeFromWallTime(new Date(1e3*ot),at):parseFloat(st)+it}function Be(nt,rt){try{var it=NaN;if(rt&&!isNaN(rt.maxFragmentDuration)&&isFinite(rt.maxFragmentDuration))return rt.maxFragmentDuration;if(nt&&1===nt.length){var at=nt[0],st=[ot.Z.VIDEO,ot.Z.AUDIO,ot.Z.TEXT].reduce((function(nt,rt){var it=Et.getMediaInfoForType(at,rt);return it&&!1!==it.isFragmented&&nt.push(it),nt}),[]).reduce((function(nt,rt){var it=Et.getVoRepresentations(rt);return it&&it.length>0&&it.forEach((function(rt){rt&&nt.push(rt)})),nt}),[]).reduce((function(nt,rt){var it=Et.convertRepresentationToRepresentationInfo(rt);return it&&it.fragmentDuration&&!isNaN(it.fragmentDuration)&&nt.push(it.fragmentDuration),nt}),[]);it=Math.max.apply(Math,function(nt){if(Array.isArray(nt))return sn(nt)}(lt=st)||function(nt){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(nt))return Array.from(nt)}(lt)||function(nt,rt){if(nt){if("string"==typeof nt)return sn(nt,rt);var it=Object.prototype.toString.call(nt).slice(8,-1);return"Object"===it&&nt.constructor&&(it=nt.constructor.name),"Map"===it||"Set"===it?Array.from(nt):"Arguments"===it||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(it)?sn(nt,rt):void 0}}(lt)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}return isFinite(it)?it:NaN}catch(nt){return NaN}var lt}function Ge(nt){if(nt.error)pn=!0,Qe();else{rt.info("Manifest updated... updating data system wide.");var it=nt.manifest;Et.updatePeriods(it);var st=Et.getUTCTimingSources();!Et.getIsDynamic()||st&&0!==st.length||er.trigger(_t.Z.CONFORMANCE_VIOLATION,{level:Zi.LEVELS.WARNING,event:Zi.EVENTS.NO_UTC_TIMING_ELEMENT});var ot=Et.getIsDynamic()?st.concat(An.getUTCTimingSources()):st;at.filterUnsupportedFeatures(it).then((function(){Pt.initialize(it),Lt.attemptSync(ot,Et.getIsDynamic())}))}}function qe(){return!!Qt&&Qt.getHasVideoTrack()}function Ye(){return!!Qt&&Qt.getHasAudioTrack()}function je(nt,rt){rt=rt||new Date,Le().forEach((function(it){it.finalisePlayList(rt,nt)})),St.addPlayList()}function He(nt){St.createPlaylistMetrics(1e3*En.getTime(),nt)}function Ve(nt){if(nt.error){var it="";switch(nt.error.code){case 1:it="MEDIA_ERR_ABORTED";break;case 2:it="MEDIA_ERR_NETWORK";break;case 3:it="MEDIA_ERR_DECODE",Wn.counts.mediaErrorDecode+=1;break;case 4:it="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:it="MEDIA_ERR_ENCRYPTED";break;default:it="UNKNOWN"}"MEDIA_ERR_DECODE"===it&&Un.get().errors.recoverAttempts.mediaErrorDecode>=Wn.counts.mediaErrorDecode?function(){rt.warn("A MEDIA_ERR_DECODE occured: Resetting the MediaSource");var nt=En.getTime();Qt.deactivate(!1),rt.warn("MediaSource has been resetted. Resuming playback from time ".concat(nt)),pe(nt,!1,!1)}():(fn=!0,nt.error.message&&(it+=" ("+nt.error.message+")"),nt.error.msExtendedCode&&(it+=" (0x"+(nt.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),rt.fatal("Video Element Error: "+it),nt.error&&rt.fatal(nt.error),$t.error(new Ot.Z(nt.error.code,it)),Qe())}}function Ke(){return Qt?Qt.getStreamInfo():null}function ze(nt){for(var rt=0,it=Wt.length;rt<it;rt++)if(Wt[rt].getId()===nt)return Wt[rt];return null}function We(nt){isNaN(nt.newDuration)||xe(nt.newDuration)}function Xe(){Wt=[],Yn=NaN,en=null,hn=!1,Qt=null,fn=!1,pn=!1,In=!0,Ln=!0,Rn=!1,ln=!0,Dn=null,Hn=!1,xn=!1,Nn=[],Kn=null,Wn={counts:{mediaErrorDecode:0}}}function Qe(){se(),Lt.reset(),je(fn||pn?gn.FAILURE_STOP_REASON:gn.USER_REQUEST_STOP_REASON);for(var rt=0,it=Wt?Wt.length:0;rt<it;rt++)Wt[rt].reset(fn);er.off(_t.Z.PLAYBACK_TIME_UPDATED,Ne,nt),er.off(_t.Z.PLAYBACK_SEEKING,ye,nt),er.off(_t.Z.PLAYBACK_ERROR,Ve,nt),er.off(_t.Z.PLAYBACK_STARTED,Ce,nt),er.off(_t.Z.PLAYBACK_PAUSED,De,nt),er.off(_t.Z.PLAYBACK_ENDED,Fe,nt),er.off(_t.Z.METRIC_ADDED,Je,nt),er.off(_t.Z.MANIFEST_VALIDITY_CHANGED,We,nt),er.off(_t.Z.BUFFER_LEVEL_UPDATED,Ie,nt),er.off(_t.Z.QUALITY_CHANGE_REQUESTED,Re,nt),dt.Z.KEY_SESSION_UPDATED&&er.off(dt.Z.KEY_SESSION_UPDATED,ce,nt),er.off(dt.Z.MANIFEST_UPDATED,Ge,nt),er.off(dt.Z.STREAM_BUFFERING_COMPLETED,Oe,nt),er.off(dt.Z.TIME_SYNCHRONIZATION_COMPLETED,le,nt),er.off(dt.Z.CURRENT_TRACK_CHANGED,_e,nt),er.off(dt.Z.SETTING_UPDATED_LIVE_DELAY,we,nt),er.off(dt.Z.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,we,nt),Pt.reset(),st.reset(),Ht.reset(),St.clearAllCurrentMetrics(),ht.setValue(null),lt.reset(),Yt.reset(),Kt.reset(),_n&&(wt.detachMediaSource(vn),_n=null),vn=null,en&&(en=null,an=null,ht.getValue()&&er.trigger(dt.Z.PROTECTION_DESTROYED,{data:ht.getValue().url})),Pe(),er.trigger(dt.Z.STREAM_TEARDOWN_COMPLETE),Xe()}function Je(nt){if(nt.metric===ut.Z.DVR_INFO){var rt=Ye()?ot.Z.AUDIO:ot.Z.VIDEO;nt.mediaType===rt&&wt.setSeekable(nt.value.range.start,nt.value.range.end)}}function $e(){return Wt}return nt={initialize:function(rt,it){se(),ln=rt,an=it,Yt.initialize(),(st=ki(Jn).create()).setConfig({manifestModel:ht,adapter:Et,manifestLoader:lt,errHandler:$t,settings:Un,contentSteeringController:Ct}),st.initialize(),(Ht=Gi(Jn).getInstance()).setConfig({manifestUpdater:st,playbackController:En,settings:Un}),Ht.start(),Lt.setConfig({dashMetrics:St,baseURLController:Pt,errHandler:$t,settings:Un}),Lt.initialize(),wt.setConfig({settings:Un}),en&&(er.trigger(dt.Z.PROTECTION_CREATED,{controller:en}),en.setMediaElement(vn.getElement()),an&&en.setProtectionData(an)),er.on(_t.Z.PLAYBACK_TIME_UPDATED,Ne,nt),er.on(_t.Z.PLAYBACK_SEEKING,ye,nt),er.on(_t.Z.PLAYBACK_ERROR,Ve,nt),er.on(_t.Z.PLAYBACK_STARTED,Ce,nt),er.on(_t.Z.PLAYBACK_PAUSED,De,nt),er.on(_t.Z.PLAYBACK_ENDED,Fe,nt),er.on(_t.Z.METRIC_ADDED,Je,nt),er.on(_t.Z.MANIFEST_VALIDITY_CHANGED,We,nt),er.on(_t.Z.BUFFER_LEVEL_UPDATED,Ie,nt),er.on(_t.Z.QUALITY_CHANGE_REQUESTED,Re,nt),dt.Z.KEY_SESSION_UPDATED&&er.on(dt.Z.KEY_SESSION_UPDATED,ce,nt),er.on(dt.Z.MANIFEST_UPDATED,Ge,nt),er.on(dt.Z.STREAM_BUFFERING_COMPLETED,Oe,nt),er.on(dt.Z.TIME_SYNCHRONIZATION_COMPLETED,le,nt),er.on(dt.Z.CURRENT_TRACK_CHANGED,_e,nt),er.on(dt.Z.SETTING_UPDATED_LIVE_DELAY,we,nt),er.on(dt.Z.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,we,nt)},getActiveStreamInfo:Ke,addDVRMetric:Ae,hasVideoTrack:qe,hasAudioTrack:Ye,getStreamById:ze,getStreamForTime:be,getTimeRelativeToStreamId:function(nt,rt){for(var it=null,at=0,st=0,ot=null,lt=0;lt<Wt.length;lt++){if(st=(it=Wt[lt]).getStartTime(),ot=it.getDuration(),Number.isFinite(st)&&(at=st),it.getId()===rt)return nt-at;Number.isFinite(ot)&&(at+=ot)}return null},load:function(nt){var rt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;se(),Yn=rt,lt.load(nt)},loadWithManifest:function(nt){var rt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;ue(),Yn=rt,st.setManifest(nt)},getActiveStreamProcessors:Le,setConfig:function(nt){nt&&(nt.capabilities&&(it=nt.capabilities),nt.capabilitiesFilter&&(at=nt.capabilitiesFilter),nt.manifestLoader&&(lt=nt.manifestLoader),nt.manifestModel&&(ht=nt.manifestModel),nt.mediaPlayerModel&&(bn=nt.mediaPlayerModel),nt.customParametersModel&&(An=nt.customParametersModel),nt.protectionController&&(en=nt.protectionController),nt.adapter&&(Et=nt.adapter),nt.dashMetrics&&(St=nt.dashMetrics),nt.errHandler&&($t=nt.errHandler),nt.timelineConverter&&(Yt=nt.timelineConverter),nt.videoModel&&(vn=nt.videoModel),nt.playbackController&&(En=nt.playbackController),nt.serviceDescriptionController&&(Tn=nt.serviceDescriptionController),nt.contentSteeringController&&(Ct=nt.contentSteeringController),nt.textController&&(nn=nt.textController),nt.abrController&&(Ut=nt.abrController),nt.mediaController&&(Gt=nt.mediaController),nt.settings&&(Un=nt.settings),nt.baseURLController&&(Pt=nt.baseURLController),nt.uriFragmentModel&&(Bt=nt.uriFragmentModel),nt.segmentBaseController&&(kt=nt.segmentBaseController),nt.manifestUpdater&&(st=nt.manifestUpdater))},setProtectionData:function(nt){an=nt,en&&en.setProtectionData(an)},getIsStreamSwitchInProgress:function(){return hn},switchToVideoElement:function(nt){Qt&&(En.initialize(Ke()),pe(nt,!1,!0))},getHasMediaOrInitialisationError:function(){return fn||pn},getStreams:$e,getActiveStream:function(){return Qt},getInitialPlayback:function(){return In},getAutoPlay:function(){return ln},refreshManifest:function(){st.getIsUpdating()||st.refreshManifest()},reset:Qe},rt=(0,pt.Z)(Jn).getInstance().getLogger(nt),Lt=Oi(Jn).getInstance(),wt=Fi(Jn).getInstance(),Kt=jt(Jn).getInstance(),Xe(),nt}un.__dashjs_factory_name="StreamController";var Hi=ht.Z.getSingletonFactory(un);function cn(){var nt,rt,it,at,st,lt,ut,ht,_t,Et,St,wt,Lt=this.context,Ct=(0,ct.Z)(Lt).getInstance();function E(){wt.debug("Stopping the gap controller"),st&&(clearInterval(st),st=null),function(){Ct.off(dt.Z.WALLCLOCK_TIME_UPDATED,b,this),Ct.off(dt.Z.INITIAL_STREAM_SWITCH,S,this),Ct.off(dt.Z.PLAYBACK_SEEKING,v,this),Ct.off(dt.Z.BUFFER_REPLACEMENT_STARTED,_,nt),Ct.off(dt.Z.TRACK_CHANGE_RENDERED,T,nt)}(),st=null,lt=NaN,at=0,Et=null,St={}}function v(){Et&&(clearTimeout(Et),Et=null)}function _(nt){try{if(nt.streamId!==ht.getActiveStreamInfo().id||nt.mediaType!==ot.Z.VIDEO&&nt.mediaType!==ot.Z.AUDIO)return;nt.streamId===ht.getActiveStreamInfo().id&&(St[nt.mediaType]=!0)}catch(nt){wt.error(nt)}}function T(nt){nt&&nt.mediaType&&(St[nt.mediaType]=!1)}function S(){st||function(){try{st||(wt.debug("Starting the gap controller"),st=setInterval((function(){A()&&N(ut.getTime())}),100))}catch(nt){}}()}function b(){if(A(it.get().streaming.gaps.enableSeekFix)&&++at>=10){var nt=ut.getTime();rt===nt?N(nt,!0):(rt=nt,lt=NaN),at=0}}function A(){var nt=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!ht.getActiveStream())return!1;var rt=Object.keys(St).some((function(nt){return St[nt]})),at=!!nt&&I();return!rt&&it.get().streaming.gaps.jumpGaps&&ht.getActiveStreamProcessors().length>0&&(!ut.isSeeking()||at)&&!ut.isPaused()&&!ht.getIsStreamSwitchInProgress()&&!ht.getHasMediaOrInitialisationError()}function I(){var nt=ht.getActiveStream(),rt=parseFloat((nt.getStartTime()+nt.getDuration()).toFixed(5));return ut.getTime()+it.get().streaming.gaps.threshold>=rt}function R(nt,rt){try{if(!nt||nt.length<=1&&rt>0)return NaN;for(var at=NaN,st=0;isNaN(at)&&st<nt.length;){var ot=st>0?nt.end(st-1):0;rt<nt.start(st)&&ot-rt<it.get().streaming.gaps.threshold&&(at=st),st+=1}return at}catch(nt){return null}}function w(nt,rt){for(var it=0,at=nt.length;it<at;it++)if(rt>=nt.start(it)&&rt<=nt.end(it))return!0;return!1}function N(nt){var rt,at=arguments.length>1&&void 0!==arguments[1]&&arguments[1],st=it.get().streaming.gaps.enableStallFix,ot=it.get().streaming.gaps.stallSeek,ct=it.get().streaming.gaps.smallGapLimit,dt=it.get().streaming.gaps.jumpLargeGaps,pt=_t.getBufferRange(),St=NaN,Lt=!1;if(rt=R(pt,nt),!isNaN(rt)){var Ct=pt.start(rt),Pt=Ct-nt;Pt>0&&(Pt<=ct||dt)&&(St=Ct)}var kt=ut.getTimeToStreamEnd();if(isNaN(St)&&at&&isFinite(kt)&&!isNaN(kt)&&kt<ct&&(St=parseFloat(ut.getStreamEndTime().toFixed(5)),Lt=!0),st&&isNaN(St)&&at&&isNaN(rt)&&w(pt,nt)&&(0===ot?(wt.warn("Toggle play pause to break stall"),_t.pause(),_t.play()):(wt.warn("Jumping ".concat(ot,"s to break stall")),St=nt+ot)),St>0&&lt!==St&&St>nt&&!Et){var Ot=St-nt;if(Lt){var Ft=ht.getStreamForTime(St),Bt=Ft&&!!Ft.getPreloaded();wt.warn("Jumping to end of stream because of gap from ".concat(nt," to ").concat(St,". Gap duration: ").concat(Ot)),ut.seek(St,!0,Bt)}else{var Ut=ut.getIsDynamic(),Gt=rt>0?pt.end(rt-1):nt,Ht=Ut?1e3*Math.max(0,Ot-.1):0;Et=window.setTimeout((function(){ut.seek(St,!0,!0),wt.warn("Jumping gap occuring in period ".concat(ht.getActiveStream().getStreamId()," starting at ").concat(Gt," and ending at ").concat(St,". Jumping by: ").concat(St-Gt)),Et=null}),Ht)}lt=St}}return nt={reset:E,setConfig:function(nt){nt&&(nt.settings&&(it=nt.settings),nt.playbackController&&(ut=nt.playbackController),nt.streamController&&(ht=nt.streamController),nt.videoModel&&(_t=nt.videoModel))},initialize:function(){!function(){Ct.on(dt.Z.WALLCLOCK_TIME_UPDATED,b,this),Ct.on(dt.Z.INITIAL_STREAM_SWITCH,S,this),Ct.on(dt.Z.PLAYBACK_SEEKING,v,this),Ct.on(dt.Z.BUFFER_REPLACEMENT_STARTED,_,nt),Ct.on(dt.Z.TRACK_CHANGE_RENDERED,T,nt)}()}},wt=(0,pt.Z)(Lt).getInstance().getLogger(nt),E(),nt}cn.__dashjs_factory_name="GapController";var ji=ht.Z.getSingletonFactory(cn);function dn(){var nt,rt,it,at,st,lt,ht,Et,St,wt,Lt=this.context,Ct=(0,ct.Z)(Lt).getInstance();function E(){rt=!1;var nt=Lr.Z.parseUserAgent();it=nt&&nt.browser&&nt.browser.name&&"safari"===nt.browser.name.toLowerCase()}function v(){rt=!1}function _(nt){if(nt.streamId===lt.getActiveStreamInfo().id&&St){var rt=ht.getLiveDelay();ht.getBufferLevel()>rt/2&&(St=!1)}}function T(nt){nt.streamId===lt.getActiveStreamInfo().id&&(St=nt.state===ut.Z.BUFFER_EMPTY)}function S(){Et.getCatchupModeEnabled()||at.setPlaybackRate(1)}function b(){ht.getIsDynamic()&&Et.getCatchupModeEnabled()&&(Et.getCatchupPlaybackRates().max>0||Et.getCatchupPlaybackRates().min<0)&&!ht.isPaused()&&!ht.isSeeking()&&function(){try{return!(!ht.getTime()>0||rt)&&(I()===ot.Z.LIVE_CATCHUP_MODE_LOLP?function(nt,rt){try{return Math.abs(A())>0||nt<rt}catch(nt){return!1}}(ht.getBufferLevel(),st.get().streaming.liveCatchup.playbackBufferMin):function(){try{return Math.abs(A())>0}catch(nt){return!1}}())}catch(nt){return!1}}()&&function(){if(!rt&&at){var nt,lt=at.getPlaybackRate(),ut=Et.getCatchupPlaybackRates(),ct=ht.getBufferLevel(),dt=A(),pt=Et.getCatchupMaxDrift();if(!isNaN(pt)&&pt>0&&dt>pt)wt.info("[CatchupController]: Low Latency catchup mechanism. Latency too high, doing a seek to live point"),rt=!0,ht.seekToCurrentLive(!0,!1);else{var _t=ht.getCurrentLiveLatency(),Lt=ht.getLiveDelay();nt=I()===ot.Z.LIVE_CATCHUP_MODE_LOLP?function(nt,rt,it,at,st){var ot;if(st<at){var lt=Math.abs(nt.min),ut=5*(st-at);ot=1-lt+2*lt/(1+Math.pow(Math.E,-ut)),wt.debug("[LoL+ playback control_buffer-based] bufferLevel: "+st+", newRate: "+ot)}else{if(Math.abs(rt-it)<=.02*it)ot=1;else{var ct=rt-it,dt=ct<0?Math.abs(nt.min):nt.max,ht=5*ct;ot=1-dt+2*dt/(1+Math.pow(Math.E,-ht))}wt.debug("[LoL+ playback control_latency-based] latency: "+rt+", newRate: "+ot)}return ot}(ut,_t,Lt,st.get().streaming.liveCatchup.playbackBufferMin,ct):function(nt,rt,it,at){if(St)return 1;var st=rt-it,ot=st<0?Math.abs(nt.min):nt.max,lt=5*st,ut=1-ot+2*ot/(1+Math.pow(Math.E,-lt));return ht.getPlaybackStalled()&&at<=it/2&&st>0&&(ut=1),ut}(ut,_t,Lt,ct);var Ct=it?.25:.02/(.5/ut.max);nt&&Math.abs(lt-nt)>=Ct&&(wt.debug("[CatchupController]: Setting playback rate to ".concat(nt)),at.setPlaybackRate(nt))}}}()}function A(){return ht.getCurrentLiveLatency()-ht.getLiveDelay()}function I(){var nt=st.get().streaming.liveCatchup.playbackBufferMin;return st.get().streaming.liveCatchup.mode!==ot.Z.LIVE_CATCHUP_MODE_LOLP||null===nt||isNaN(nt)?ot.Z.LIVE_CATCHUP_MODE_DEFAULT:ot.Z.LIVE_CATCHUP_MODE_LOLP}function R(){Et.getCatchupPlaybackRates(!0)}return nt={reset:function(){Ct.off(_t.Z.BUFFER_LEVEL_UPDATED,_,nt),Ct.off(_t.Z.BUFFER_LEVEL_STATE_CHANGED,T,nt),Ct.off(_t.Z.PLAYBACK_PROGRESS,b,nt),Ct.off(_t.Z.PLAYBACK_TIME_UPDATED,b,nt),Ct.off(_t.Z.PLAYBACK_SEEKED,v,nt),Ct.off(dt.Z.SETTING_UPDATED_CATCHUP_ENABLED,S,nt),Ct.off(dt.Z.SETTING_UPDATED_PLAYBACK_RATE_MIN,R,nt),Ct.off(dt.Z.SETTING_UPDATED_PLAYBACK_RATE_MAX,R,nt),Ct.off(_t.Z.STREAM_INITIALIZED,R,nt),E(),at.setPlaybackRate(1,!0)},setConfig:function(nt){nt&&(nt.settings&&(st=nt.settings),nt.videoModel&&(at=nt.videoModel),nt.streamController&&(lt=nt.streamController),nt.playbackController&&(ht=nt.playbackController),nt.mediaPlayerModel&&(Et=nt.mediaPlayerModel))},initialize:function(){Ct.on(_t.Z.BUFFER_LEVEL_UPDATED,_,nt),Ct.on(_t.Z.BUFFER_LEVEL_STATE_CHANGED,T,nt),Ct.on(_t.Z.PLAYBACK_PROGRESS,b,nt),Ct.on(_t.Z.PLAYBACK_TIME_UPDATED,b,nt),Ct.on(_t.Z.PLAYBACK_SEEKED,v,nt),Ct.on(dt.Z.SETTING_UPDATED_CATCHUP_ENABLED,S,nt),Ct.on(dt.Z.SETTING_UPDATED_PLAYBACK_RATE_MIN,R,nt),Ct.on(dt.Z.SETTING_UPDATED_PLAYBACK_RATE_MAX,R,nt),Ct.on(_t.Z.STREAM_INITIALIZED,R,nt),R()}},wt=(0,pt.Z)(Lt).getInstance().getLogger(nt),E(),nt}dn.__dashjs_factory_name="CatchupController";var qi=ht.Z.getSingletonFactory(dn),Ki=[ot.Z.SERVICE_DESCRIPTION_DVB_LL_SCHEME],$i="video",Yi="audio";function yn(){var nt,rt,it,at,st,ut=this.context;function u(){rt={liveDelay:NaN,liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN}},minBitrate:{},maxBitrate:{},initialBitrate:{},contentSteering:null},it=[]}function l(nt,it,st){try{rt[nt][it]=st/1e3}catch(nt){at.error(nt)}}return nt={getServiceDescriptionSettings:function(){return rt},getProducerReferenceTimeOffsets:function(){return it},calculateProducerReferenceTimeOffsets:function(nt){try{var rt=[];if(nt&&nt.length>0){var ut=[ot.Z.VIDEO,ot.Z.AUDIO,ot.Z.TEXT],ct=st.getAvailabilityStartTime()/1e3;nt.forEach((function(nt){var it=ut.reduce((function(rt,it){return rt.concat(st.getAllMediaInfoForType(nt,it))}),[]).reduce((function(rt,it){return st.getProducerReferenceTimes(nt,it).forEach((function(at){var ot=st.getVoRepresentations(it);if(ot&&ot.length>0&&ot[0].adaptation&&ot[0].segmentInfoType===lt.Z.SEGMENT_TEMPLATE){var ut=ot[0],dt=new Date(at[lt.Z.WALL_CLOCK_TIME]).getTime()/1e3-(at[lt.Z.PRESENTATION_TIME]/ut[lt.Z.TIMESCALE]-ut[lt.Z.PRESENTATION_TIME_OFFSET]+nt.start),ht=ct-dt;rt.push({id:at[lt.Z.ID],to:ht})}})),rt}),[]);rt=rt.concat(it)}))}it=rt}catch(nt){at.error(nt),it=[]}},applyServiceDescription:function(nt){if(nt&&nt.serviceDescriptions){var st=nt.serviceDescriptions.filter((function(nt){return Ki.includes(nt.schemeIdUri)})),lt=nt.serviceDescriptions.filter((function(nt){return null==nt.schemeIdUri})),ut=st.length>0?st[st.length-1]:lt[lt.length-1];ut&&(ut.latency&&ut.latency.target>0&&function(nt){var st;if(nt.schemeIdUri,ot.Z.SERVICE_DESCRIPTION_DVB_LL_SCHEME,st=function(nt){return{liveDelay:nt.latency.target/1e3,maxDrift:!isNaN(nt.latency.max)&&nt.latency.max>nt.latency.target?(nt.latency.max-nt.latency.target+500)/1e3:NaN,referenceId:nt.latency.referenceId||NaN}}(nt),it.length>0){var lt=function(nt){var rt,at=0,st=it.filter((function(rt){return rt.id===nt.referenceId}));return 0===st.length?(at=it.length>0?it[0].to:0,rt=it[0].id||NaN):(at=st[0].to||0,rt=st[0].id||NaN),{to:at,id:rt}}(st),ut=lt.to,ct=lt.id;rt.liveDelay=st.liveDelay-ut,rt.liveCatchup.maxDrift=st.maxDrift,at.debug("\n                Found latency properties coming from service description. Applied time offset of ".concat(ut," from ProducerReferenceTime element with id ").concat(ct,".\n                Live Delay: ").concat(st.liveDelay-ut,", Live catchup max drift: ").concat(st.maxDrift,"\n            "))}else rt.liveDelay=st.liveDelay,rt.liveCatchup.maxDrift=st.maxDrift,at.debug("Found latency properties coming from service description: Live Delay: ".concat(st.liveDelay,", Live catchup max drift: ").concat(st.maxDrift))}(ut),ut.playbackRate&&function(nt){var it=nt.playbackRate.min?Math.round(1e3*(nt.playbackRate.min-1))/1e3:NaN,st=nt.playbackRate.max?Math.round(1e3*(nt.playbackRate.max-1))/1e3:NaN;rt.liveCatchup.playbackRate.min=it,rt.liveCatchup.playbackRate.max=st,at.debug("Found latency properties coming from service description: Live catchup min playback rate: ".concat(it)),at.debug("Found latency properties coming from service description: Live catchup max playback rate: ".concat(st))}(ut),ut.operatingQuality,ut.operatingBandwidth&&function(nt){if(nt&&nt.operatingBandwidth&&nt.operatingBandwidth.mediaType&&"all"!==nt.operatingBandwidth.mediaType){var rt={};rt.minBandwidth=nt.operatingBandwidth.min,rt.maxBandwidth=nt.operatingBandwidth.max,rt.targetBandwidth=nt.operatingBandwidth.target;var it=[];nt.operatingBandwidth.mediaType===$i||nt.operatingBandwidth.mediaType===Yi?it.push(nt.operatingBandwidth.mediaType):"any"===nt.operatingBandwidth.mediaType&&(it.push(Yi),it.push($i)),it.forEach((function(nt){isNaN(rt.minBandwidth)||l("minBitrate",nt,rt.minBandwidth),isNaN(rt.maxBandwidth)||l("maxBitrate",nt,rt.maxBandwidth),isNaN(rt.targetBandwidth)||l("initialBitrate",nt,rt.targetBandwidth)}))}}(ut),ut.contentSteering&&function(nt){rt.contentSteering=nt.contentSteering}(ut))}},reset:function(){u()},setConfig:function(nt){nt&&nt.adapter&&(st=nt.adapter)}},at=(0,pt.Z)(ut).getInstance().getLogger(nt),u(),nt}yn.__dashjs_factory_name="ServiceDescriptionController";var Wi=ht.Z.getSingletonFactory(yn),Qi=it(3973),ta=it.n(Qi),na=it(3039);function Sn(){var nt,rt,it,at,st,lt,ut,ht,_t=this.context,Et=(0,ct.Z)(_t).getInstance();function h(nt,rt){return nt&&it[rt]&&it[rt][nt]?it[rt][nt].list:[]}function p(nt,rt){return nt&&it[rt]&&it[rt][nt]?it[rt][nt].current:null}function m(nt){var rt=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(nt&&nt.streamInfo){var st=nt.type,ut=nt.streamInfo.id,ct=p(st,ut);if(it[ut]&&it[ut][st]&&(it[ut][st].current=nt,it[ut][st].current&&(st!==ot.Z.TEXT&&!v(nt,ct)||st===ot.Z.TEXT&&nt.isFragmented)&&Et.trigger(dt.Z.CURRENT_TRACK_CHANGED,{oldMediaInfo:ct,newMediaInfo:nt,switchMode:at.get().streaming.trackSwitchMode[st]},{streamId:ut}),!rt)){var pt=T(nt);if(!pt||!it[ut][st].storeLastSettings)return;pt.roles&&(pt.role=pt.roles[0],delete pt.roles),pt.accessibility&&(pt.accessibility=pt.accessibility[0]),pt.audioChannelConfiguration&&(pt.audioChannelConfiguration=pt.audioChannelConfiguration[0]),lt[st]=pt,ht.setSavedMediaSettings(st,pt)}}}function y(nt,rt){nt&&rt&&(st[nt]=rt)}function E(nt){return nt?st[nt]:null}function v(nt,rt){if(!nt&&!rt)return!0;if(!nt||!rt)return!1;var it=nt.id===rt.id,at=nt.viewpoint===rt.viewpoint,st=JSON.stringify(nt.viewpointsWithSchemeIdUri)===JSON.stringify(rt.viewpointsWithSchemeIdUri),ot=nt.lang===rt.lang,lt=nt.codec===rt.codec,ut=nt.roles.toString()===rt.roles.toString(),ct=JSON.stringify(nt.rolesWithSchemeIdUri)===JSON.stringify(rt.rolesWithSchemeIdUri),dt=nt.accessibility.toString()===rt.accessibility.toString(),ht=JSON.stringify(nt.accessibilitiesWithSchemeIdUri)===JSON.stringify(rt.accessibilitiesWithSchemeIdUri),pt=nt.audioChannelConfiguration.toString()===rt.audioChannelConfiguration.toString(),_t=JSON.stringify(nt.audioChannelConfigurationsWithSchemeIdUri)===JSON.stringify(rt.audioChannelConfigurationsWithSchemeIdUri);return it&&lt&&at&&st&&ot&&ut&&ct&&dt&&ht&&pt&&_t}function _(){it={},lt={},st={audio:null,video:null,text:null}}function T(nt){var rt={lang:nt.lang,viewpoint:nt.viewpoint,roles:nt.roles,accessibility:nt.accessibility,audioChannelConfiguration:nt.audioChannelConfiguration,codec:nt.codec};return rt.lang||rt.viewpoint||rt.role&&rt.role.length>0||rt.accessibility&&rt.accessibility.length>0||rt.audioChannelConfiguration&&rt.audioChannelConfiguration.length>0?rt:null}function S(nt,rt,it){var at=[];return nt.forEach((function(nt){rt(it,nt)&&at.push(nt)})),0!==at.length?at:nt}function b(nt,rt){try{return!nt.lang||nt.lang instanceof RegExp?rt.lang.match(nt.lang):""!==rt.lang&&(0,na.extendedFilter)(rt.lang,ta()(nt.lang)).length>0}catch(nt){return!1}}function A(nt,rt){return void 0===nt.index||null===nt.index||rt.index===nt.index}function I(nt,rt){return!nt.viewpoint||nt.viewpoint===rt.viewpoint}function R(nt,rt){var it=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!nt.role||!!rt.roles.filter((function(rt){return rt===nt.role}))[0]||rt.type===ot.Z.AUDIO&&it}function w(nt,rt){return nt.accessibility?!!rt.accessibility.filter((function(rt){return rt===nt.accessibility}))[0]:!rt.accessibility.length}function N(nt,rt){return!nt.audioChannelConfiguration||!!rt.audioChannelConfiguration.filter((function(rt){return rt===nt.audioChannelConfiguration}))[0]}function C(nt,rt){return!nt.codec||nt.codec===rt.codec}function D(nt){var rt,it=0,at=[];return nt.forEach((function(nt){(rt=Math.max.apply(Math,nt.bitrateList.map((function(nt){return nt.bandwidth}))))>it?(it=rt,at=[nt]):rt===it&&at.push(nt)})),at}function O(nt){var rt,it=1/0,at=[];return nt.forEach((function(nt){var st=nt.bitrateList.reduce((function(nt,rt){var it=Math.max(1,rt.width*rt.height);return nt+rt.bandwidth/it}),0);(rt=st/nt.bitrateList.length)<it?(it=rt,at=[nt]):rt===it&&at.push(nt)})),at}function M(nt){var rt,it=0,at=[];return nt.forEach((function(nt){(rt=nt.representationCount)>it?(it=rt,at=[nt]):rt===it&&at.push(nt)})),at}function P(nt,it){if(nt===ot.Z.TEXT)return it[0];var st,lt=at.get().streaming.selectionModeForInitialTrack,ct=ut.getCustomInitialTrackSelectionFunction();if(ct&&"function"==typeof ct)st=ct(it);else switch(lt){case ot.Z.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY:st=function(nt){var rt,it,at=(rt=0,it=[],nt.forEach((function(nt){isNaN(nt.selectionPriority)||(nt.selectionPriority>rt?(rt=nt.selectionPriority,it=[nt]):nt.selectionPriority===rt&&it.push(nt))})),it);return at.length>1&&(at=D(at)),at.length>1&&(at=M(at)),at}(it);break;case ot.Z.TRACK_SELECTION_MODE_HIGHEST_BITRATE:st=function(nt){var rt=D(nt);return rt.length>1&&(rt=M(rt)),rt}(it);break;case ot.Z.TRACK_SELECTION_MODE_FIRST_TRACK:st=L(it);break;case ot.Z.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY:st=function(nt){var rt=O(nt);return rt.length>1&&(rt=D(rt)),rt}(it);break;case ot.Z.TRACK_SELECTION_MODE_WIDEST_RANGE:st=function(nt){var rt=M(nt);return rt.length>1&&(rt=D(nt)),rt}(it);break;default:rt.warn("Track selection mode ".concat(lt," is not supported. Falling back to TRACK_SELECTION_MODE_FIRST_TRACK")),st=L(it)}return st.length>0?st[0]:it[0]}function L(nt){return nt[0]}return nt={setInitialMediaSettingsForType:function(nt,rt){var it=lt[nt]||E(nt),at=h(nt,rt.id),st=[];it||((it=ht.getSavedMediaSettings(nt))&&delete it.codec,y(nt,it)),at&&0!==at.length&&(it&&(st=S(st=Array.from(at),b,it),st=S(st,A,it),st=S(st,I,it),nt===ot.Z.AUDIO&&lt[nt]||(st=S(st,R,it)),st=S(st,w,it),st=S(st,N,it),st=S(st,C,it)),0===st.length?m(P(nt,at),!0):st.length>1?m(P(nt,st)):m(st[0]))},addTrack:function(nt){if(nt){var rt=nt.type;if((st=rt)===ot.Z.AUDIO||st===ot.Z.VIDEO||st===ot.Z.TEXT||st===ot.Z.IMAGE){var st,lt,ut=nt.streamInfo.id;it[ut]||(it[ut]={audio:{list:[],storeLastSettings:lt=at.get().streaming.saveLastMediaSettingsForCurrentStreamingSession,current:null},video:{list:[],storeLastSettings:lt,current:null},text:{list:[],storeLastSettings:lt,current:null},image:{list:[],storeLastSettings:lt,current:null}});for(var ct=it[ut][rt].list,dt=0,ht=ct.length;dt<ht;++dt)if(v(ct[dt],nt))return;ct.push(nt)}}},getTracksFor:h,getCurrentTrackFor:p,isCurrentTrack:function(nt){if(!nt)return!1;var rt=nt.type,at=nt.streamInfo.id;return it[at]&&it[at][rt]&&v(it[at][rt].current,nt)},setTrack:m,selectInitialTrack:P,setInitialSettings:y,getInitialSettings:E,getTracksWithHighestBitrate:D,getTracksWithHighestEfficiency:O,getTracksWithWidestRange:M,isTracksEqual:v,matchSettings:function(nt,rt){var it=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{var at=!1;if(nt.lang){if(nt.lang instanceof RegExp)at=rt.lang.match(nt.lang);else if(""!==rt.lang){var st=ta()(nt.lang);st&&(at=(0,na.extendedFilter)(rt.lang,st).length>0)}}else at=!0;var lt=void 0===nt.index||null===nt.index||rt.index===nt.index,ut=!nt.viewpoint||nt.viewpoint===rt.viewpoint,ct=!nt.role||!!rt.roles.filter((function(rt){return rt===nt.role}))[0],dt=!nt.accessibility||!!rt.accessibility.filter((function(rt){return rt===nt.accessibility}))[0],ht=!nt.audioChannelConfiguration||!!rt.audioChannelConfiguration.filter((function(rt){return rt===nt.audioChannelConfiguration}))[0];return at&&lt&&ut&&(ct||rt.type===ot.Z.AUDIO&&it)&&dt&&ht}catch(nt){return!1}},matchSettingsLang:b,matchSettingsIndex:A,matchSettingsViewPoint:I,matchSettingsRole:R,matchSettingsAccessibility:w,matchSettingsAudioChannelConfig:N,saveTextSettingsDisabled:function(){ht.setSavedMediaSettings(ot.Z.TEXT,null)},setConfig:function(nt){nt&&(nt.domStorage&&(ht=nt.domStorage),nt.settings&&(at=nt.settings),nt.customParametersModel&&(ut=nt.customParametersModel))},reset:_},rt=(0,pt.Z)(_t).getInstance().getLogger(nt),_(),nt}Sn.__dashjs_factory_name="MediaController";var ra=ht.Z.getSingletonFactory(Sn);ht.Z.updateSingletonFactory(Sn.__dashjs_factory_name,ra);var ia=ra,aa=NaN,sa=function e(nt,rt){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.data={baseUrls:nt||null,selectedIdx:rt||aa},this.children=[]};function wn(){var nt,rt,it,at,st=this.context,ot=fr(st).getInstance();function o(nt,rt,it){var at=s(it);nt[rt]?ot.areEqual(at,nt[rt].data.baseUrls)||(nt[rt].data.baseUrls=at,nt[rt].data.selectedIdx=aa):nt[rt]=new sa(at)}function s(nt){var rt=it.getBaseURLsFromElement(nt),st=at.getSynthesizedBaseUrlElements(rt);return st&&st.length>0&&(rt=rt.concat(st)),rt}function u(nt,it){var at=it||rt;nt(at.data),at.children&&at.children.forEach((function(rt){return u(nt,rt)}))}function l(){rt=new sa}return nt={reset:l,update:function(nt){!function(nt){!function(){if(!it||!it.hasOwnProperty("getBaseURLsFromElement")||!it.hasOwnProperty("getRepresentationSortFunction"))throw new Error("setConfig function has to be called previously")}();var at=s(nt);ot.areEqual(at,rt.data.baseUrls)||(rt.data.baseUrls=at,rt.data.selectedIdx=aa),nt&&nt.Period_asArray&&nt.Period_asArray.forEach((function(nt,at){o(rt.children,at,nt),nt.AdaptationSet_asArray&&nt.AdaptationSet_asArray.forEach((function(nt,st){o(rt.children[at].children,st,nt),nt.Representation_asArray&&nt.Representation_asArray.sort(it.getRepresentationSortFunction()).forEach((function(nt,it){o(rt.children[at].children[st].children,it,nt)}))}))}))}(nt)},getForPath:function(nt){var it=rt,at=[it.data];return nt&&nt.forEach((function(nt){(it=it.children[nt])&&at.push(it.data)})),at.filter((function(nt){return nt.baseUrls.length}))},invalidateSelectedIndexes:function(nt){u((function(rt){isNaN(rt.selectedIdx)||nt===rt.baseUrls[rt.selectedIdx].serviceLocation&&(rt.selectedIdx=aa)}))},setConfig:function(nt){nt.adapter&&(it=nt.adapter),nt.contentSteeringController&&(at=nt.contentSteeringController)},getBaseUrls:function(nt){return s(nt)}},l(),nt}wn.__dashjs_factory_name="BaseURLTreeModel";var oa=ht.Z.getClassFactory(wn);function Cn(nt){var rt=(nt=nt||{}).blacklistController;return{select:function(nt){return nt&&function(nt){var rt,it,at=0,st=[],ot=0;if((it=nt.sort((function(nt,rt){var it=nt.dvbPriority-rt.dvbPriority;return isNaN(it)?0:it})).filter((function(nt,rt,it){return!rt||it[0].dvbPriority&&nt.dvbPriority&&it[0].dvbPriority===nt.dvbPriority}))).length)return it.length>1&&(it.forEach((function(nt){at+=nt.dvbWeight,st.push(at)})),rt=Math.floor(Math.random()*(at-1)),st.every((function(nt,it){return ot=it,!(rt<nt)}))),it[ot]}((it=[],nt.filter((function(nt){return!rt.contains(nt.serviceLocation)||(nt.dvbPriority&&it.push(nt.dvbPriority),!1)})).filter((function(nt){return!it.length||!nt.dvbPriority||-1===it.indexOf(nt.dvbPriority)}))));var it}}}Cn.__dashjs_factory_name="DVBSelector";var la=ht.Z.getClassFactory(Cn);function On(nt){var rt=(nt=nt||{}).blacklistController;return{select:function(nt){var it,at=0;return nt&&nt.some((function(nt,it){return at=it,!rt.contains(nt.serviceLocation)}))&&(it=nt[at]),it}}}On.__dashjs_factory_name="BasicSelector";var ca=ht.Z.getClassFactory(On);function Pn(){var nt,rt,it,at=this.context;function i(){for(var nt=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],rt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],at=0,st=NaN,a=function(){var ot=nt[at],lt=rt.findIndex((function(nt){return nt.serviceLocation&&nt.serviceLocation===ot}));if(-1!==lt&&!it.contains(rt[lt].serviceLocation))return st=lt,"break";at+=1};at<nt.length&&"break"!==a(););return st}return nt={selectBaseUrlIndex:function(nt){var it=NaN;if(isNaN(nt.selectedIdx)){var at=rt.getSteeringDataFromManifest();at&&at.defaultServiceLocationArray.length>0&&(it=i(at.defaultServiceLocationArray,nt.baseUrls))}var st=rt.getCurrentSteeringResponseData();return nt.baseUrls&&nt.baseUrls.length&&st&&st.pathwayPriority&&st.pathwayPriority.length&&(it=i(st.pathwayPriority,nt.baseUrls)),it},setConfig:function(nt){nt.blacklistController&&(it=nt.blacklistController),nt.contentSteeringController&&(rt=nt.contentSteeringController)}},rt=Mi(at).getInstance(),nt}Pn.__dashjs_factory_name="ContentSteeringSelector";var da=ht.Z.getClassFactory(Pn);function Fn(){var nt,rt,it,at,st,ot,lt=this.context,ut=(0,ct.Z)(lt).getInstance(),ht=(0,Bt.Z)(lt).getInstance();function f(){rt.reset()}return nt={chooseSelector:function(nt){(0,ln.PS)(nt,"boolean"),ot=nt?at:it},select:function(nt){if(nt){if(ht.get().streaming.applyContentSteering){var rt=st.selectBaseUrlIndex(nt);isNaN(rt)||-1===rt||(nt.selectedIdx=rt)}if(!isNaN(nt.selectedIdx))return nt.baseUrls[nt.selectedIdx];var at=ot.select(nt.baseUrls);return at?(nt.selectedIdx=nt.baseUrls.indexOf(at),at):(ut.trigger(dt.Z.URL_RESOLUTION_FAILED,{error:new Ot.Z(Ft.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE,Ft.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE)}),void(ot===it&&f()))}},reset:f,setConfig:function(nt){nt.selector&&(ot=nt.selector),nt.contentSteeringSelector&&(st=nt.contentSteeringSelector)}},rt=Ai(lt).create({updateEventName:dt.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,addBlacklistEventName:dt.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD}),it=ca(lt).create({blacklistController:rt}),at=la(lt).create({blacklistController:rt}),(st=da(lt).create()).setConfig({blacklistController:rt}),ot=it,nt}Fn.__dashjs_factory_name="BaseURLSelector";var fa=ht.Z.getClassFactory(Fn);function kn(){var nt,rt,it,at,st,ot=this.context,lt=(0,ct.Z)(ot).getInstance(),ut=(0,pn.Z)(ot).getInstance();function c(nt){it.update(nt),at.chooseSelector(rt.getIsDVB(nt)),lt.trigger(_t.Z.BASE_URLS_UPDATED,{baseUrls:f(nt)})}function f(nt){return it.getBaseUrls(nt)}return nt={reset:function(){it.reset(),at.reset()},initialize:function(nt){it.setConfig({adapter:rt,contentSteeringController:st}),c(nt)},resolve:function(nt){var rt=it.getForPath(nt).reduce((function(nt,rt){var it=at.select(rt);return it?(ut.isRelative(it.url)?nt.url=ut.resolve(it.url,nt.url):(nt.url=it.url,nt.serviceLocation=it.serviceLocation),nt.availabilityTimeOffset=it.availabilityTimeOffset,nt.availabilityTimeComplete=it.availabilityTimeComplete,nt.queryParams=it.queryParams,nt):new Kn}),new Kn);if(!ut.isRelative(rt.url))return rt},setConfig:function(nt){nt.baseURLTreeModel&&(it=nt.baseURLTreeModel),nt.baseURLSelector&&(at=nt.baseURLSelector),nt.adapter&&(rt=nt.adapter),nt.contentSteeringController&&(st=nt.contentSteeringController)},getBaseUrls:f,update:c},it=oa(ot).create(),at=fa(ot).create(),lt.on(dt.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,(function(nt){it.invalidateSelectedIndexes(nt.entry)}),nt),nt}kn.__dashjs_factory_name="BaseURLController";var pa=ht.Z.getClassFactory(kn);function Zn(nt){return Zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},Zn(nt)}function Bn(nt,rt){return Bn=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},Bn(nt,rt)}function Gn(nt,rt){return!rt||"object"!==Zn(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function qn(nt){return qn=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},qn(nt)}var ga=function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&Bn(nt,rt)}(i,nt);var rt,it,at=(rt=i,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=qn(rt);if(it){var st=qn(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return Gn(this,nt)});function i(nt,rt){var it;return function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,i),(it=at.call(this)).url=nt||null,it.type=rt||null,it.mediaType=ot.Z.STREAM,it.responseType="",it}return i}(St.Z);function jn(nt){nt=nt||{};var rt=this.context,it=(0,ct.Z)(rt).getInstance(),at=ci(rt).create({errHandler:nt.errHandler,dashMetrics:nt.dashMetrics,mediaPlayerModel:nt.mediaPlayerModel,requestModifier:nt.requestModifier,errors:Ft});return{load:function(nt,rt,st){var a=function(at,ot){rt.resolved=!0,rt.resolvedContent=at||null,it.trigger(dt.Z.XLINK_ELEMENT_LOADED,{element:rt,resolveObject:st,error:at||ot?null:new Ot.Z(Ft.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE,Ft.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE+nt)})};if("urn:mpeg:dash:resolve-to-zero:2013"===nt)a(null,!0);else{var ot=new ga(nt,Ut.w.XLINK_EXPANSION_TYPE);at.load({request:ot,success:function(nt){a(nt)},error:function(){a(null)}})}},reset:function(){at&&(at.abort(),at=null)}}}jn.__dashjs_factory_name="XlinkLoader";var _a=ht.Z.getClassFactory(jn),Vn=function(nt){function t(nt){var rt=nt.localName;return null==rt&&(rt=nt.baseName),null!=rt&&""!=rt||(rt=nt.nodeName),rt}function n(nt){return"string"==typeof nt?nt.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):nt}function r(nt,rt,it,at){for(var st=0;st<nt.length;st++){var ot=nt[st];if("string"==typeof ot){if(ot==at)break}else if(ot instanceof RegExp){if(ot.test(at))break}else if("function"==typeof ot&&ot(rt,it,at))break}return st!=nt.length}function i(rt,it,at){"property"===nt.arrayAccessForm&&(rt[it]instanceof Array?rt[it+"_asArray"]=rt[it]:rt[it+"_asArray"]=[rt[it]]),!(rt[it]instanceof Array)&&nt.arrayAccessFormPaths.length>0&&r(nt.arrayAccessFormPaths,rt,it,at)&&(rt[it]=[rt[it]])}function a(nt){var rt=nt.split(/[-T:+Z]/g),it=new Date(rt[0],rt[1]-1,rt[2]),at=rt[5].split(".");if(it.setHours(rt[3],rt[4],at[0]),at.length>1&&it.setMilliseconds(at[1]),rt[6]&&rt[7]){var st=60*rt[6]+Number(rt[7]);st=0+("-"==(/\d\d-\d\d:\d\d$/.test(nt)?"-":"+")?-1*st:st),it.setMinutes(it.getMinutes()-st-it.getTimezoneOffset())}else-1!==nt.indexOf("Z",nt.length-1)&&(it=new Date(Date.UTC(it.getFullYear(),it.getMonth(),it.getDate(),it.getHours(),it.getMinutes(),it.getSeconds(),it.getMilliseconds())));return it}function o(rt,it,at,st){return!(1==it&&nt.xmlElementsFilter.length>0)||r(nt.xmlElementsFilter,rt,at,st)}function s(rt,it){if(9==rt.nodeType){for(var at=new Object,st=rt.childNodes,ot=0;ot<st.length;ot++)1==(ut=st[ot]).nodeType&&(nt.ignoreRoot?at=s(ut):(at={})[ct=t(ut)]=s(ut));return at}if(1==rt.nodeType){(at=new Object).__cnt=0;var lt=[];for(st=rt.childNodes,ot=0;ot<st.length;ot++){var ut,ct=t(ut=st[ot]);if(8!=ut.nodeType){var dt=it+"."+ct;if(o(at,ut.nodeType,ct,dt))if(at.__cnt++,null==at[ct]){var ht=s(ut,dt);("#text"!=ct||/[^\s]/.test(ht))&&((pt={})[ct]=ht,lt.push(pt)),at[ct]=ht,i(at,ct,dt)}else{var pt;null!=at[ct]&&(at[ct]instanceof Array||(at[ct]=[at[ct]],i(at,ct,dt))),ht=s(ut,dt),("#text"!=ct||/[^\s]/.test(ht))&&((pt={})[ct]=ht,lt.push(pt)),at[ct][at[ct].length]=ht}}}at.__children=lt;for(var _t=t(rt),Et=0;Et<rt.attributes.length;Et++){var St=rt.attributes[Et];at.__cnt++;for(var wt=St.value,Lt=0,Ct=nt.matchers.length;Lt<Ct;Lt++){var Pt=nt.matchers[Lt];Pt.test(St,_t)&&(wt=Pt.converter(St.value))}at[nt.attributePrefix+St.name]=wt}var kt=function(nt){return nt.prefix}(rt);return null!=kt&&""!=kt&&(at.__cnt++,at.__prefix=kt),null!=at["#text"]&&(at.__text=at["#text"],at.__text instanceof Array&&(at.__text=at.__text.join("\n")),nt.stripWhitespaces&&(at.__text=at.__text.trim()),delete at["#text"],"property"==nt.arrayAccessForm&&delete at["#text_asArray"],at.__text=function(rt,it,at){if(nt.datetimeAccessFormPaths.length>0){var st=at.split(".#")[0];return r(nt.datetimeAccessFormPaths,rt,it,st)?a(rt):rt}return rt}(at.__text,ct,it+"."+ct)),null!=at["#cdata-section"]&&(at.__cdata=at["#cdata-section"],delete at["#cdata-section"],"property"==nt.arrayAccessForm&&delete at["#cdata-section_asArray"]),0==at.__cnt&&"text"==nt.emptyNodeForm?at="":1==at.__cnt&&null!=at.__text?at=at.__text:1!=at.__cnt||null==at.__cdata||nt.keepCData?at.__cnt>1&&null!=at.__text&&nt.skipEmptyTextNodesForObj&&(nt.stripWhitespaces&&""==at.__text||""==at.__text.trim())&&delete at.__text:at=at.__cdata,delete at.__cnt,!nt.enableToStringFunc||null==at.__text&&null==at.__cdata||(at.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),at}if(3==rt.nodeType||4==rt.nodeType)return rt.nodeValue}function u(rt,it,at,st){var ot="<"+(null!=rt&&null!=rt.__prefix?rt.__prefix+":":"")+it;if(null!=at)for(var lt=0;lt<at.length;lt++){var ut=at[lt],ct=rt[ut];nt.escapeMode&&(ct=n(ct)),ot+=" "+ut.substr(nt.attributePrefix.length)+"=",nt.useDoubleQuotes?ot+='"'+ct+'"':ot+="'"+ct+"'"}return ot+(st?"/>":">")}function l(nt,rt){return"</"+(null!=nt.__prefix?nt.__prefix+":":"")+rt+">"}function c(rt,it){return"property"==nt.arrayAccessForm&&(st="_asArray",-1!==(at=it.toString()).indexOf(st,at.length-st.length))||0==it.toString().indexOf(nt.attributePrefix)||0==it.toString().indexOf("__")||rt[it]instanceof Function;var at,st}function f(nt){var rt=0;if(nt instanceof Object)for(var it in nt)c(nt,it)||rt++;return rt}function d(rt,it,at){return 0==nt.jsonPropertiesFilter.length||""==at||r(nt.jsonPropertiesFilter,rt,it,at)}function g(rt){var it=[];if(rt instanceof Object)for(var at in rt)-1==at.toString().indexOf("__")&&0==at.toString().indexOf(nt.attributePrefix)&&it.push(at);return it}function h(rt){var it="";return rt instanceof Object?it+=function(rt){var it="";return null!=rt.__cdata&&(it+="<![CDATA["+rt.__cdata+"]]>"),null!=rt.__text&&(nt.escapeMode?it+=n(rt.__text):it+=rt.__text),it}(rt):null!=rt&&(nt.escapeMode?it+=n(rt):it+=rt),it}function p(nt,rt){return""===nt?rt:nt+"."+rt}function m(nt,rt,it,at){var st="";if(0==nt.length)st+=u(nt,rt,it,!0);else for(var ot=0;ot<nt.length;ot++)st+=u(nt[ot],rt,g(nt[ot]),!1),st+=y(nt[ot],p(at,rt)),st+=l(nt[ot],rt);return st}function y(nt,rt){var it="";if(f(nt)>0)for(var at in nt)if(!c(nt,at)&&(""==rt||d(nt,at,p(rt,at)))){var st=nt[at],ot=g(st);null==st||null==st?it+=u(st,at,ot,!0):st instanceof Object?st instanceof Array?it+=m(st,at,ot,rt):st instanceof Date?(it+=u(st,at,ot,!1),it+=st.toISOString(),it+=l(st,at)):f(st)>0||null!=st.__text||null!=st.__cdata?(it+=u(st,at,ot,!1),it+=y(st,p(rt,at)),it+=l(st,at)):it+=u(st,at,ot,!0):(it+=u(st,at,ot,!1),it+=h(st),it+=l(st,at))}return it+h(nt)}void 0===(nt=nt||{}).escapeMode&&(nt.escapeMode=!0),void 0===nt.attributePrefix&&(nt.attributePrefix="_"),nt.arrayAccessForm=nt.arrayAccessForm||"none",nt.emptyNodeForm=nt.emptyNodeForm||"text",void 0===nt.enableToStringFunc&&(nt.enableToStringFunc=!0),nt.arrayAccessFormPaths=nt.arrayAccessFormPaths||[],void 0===nt.skipEmptyTextNodesForObj&&(nt.skipEmptyTextNodesForObj=!0),void 0===nt.stripWhitespaces&&(nt.stripWhitespaces=!0),nt.datetimeAccessFormPaths=nt.datetimeAccessFormPaths||[],void 0===nt.useDoubleQuotes&&(nt.useDoubleQuotes=!1),nt.xmlElementsFilter=nt.xmlElementsFilter||[],nt.jsonPropertiesFilter=nt.jsonPropertiesFilter||[],void 0===nt.keepCData&&(nt.keepCData=!1),void 0===nt.ignoreRoot&&(nt.ignoreRoot=!1),this.parseXmlString=function(nt){var rt;if(void 0===nt)return null;if(window.DOMParser){var it=new window.DOMParser;try{(rt=it.parseFromString(nt,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(rt=null)}catch(nt){rt=null}}else 0==nt.indexOf("<?")&&(nt=nt.substr(nt.indexOf("?>")+2)),(rt=new ActiveXObject("Microsoft.XMLDOM")).async="false",rt.loadXML(nt);return rt},this.asArray=function(nt){return void 0===nt||null==nt?[]:nt instanceof Array?nt:[nt]},this.toXmlDateTime=function(nt){return nt instanceof Date?nt.toISOString():"number"==typeof nt?new Date(nt).toISOString():null},this.asDateTime=function(nt){return"string"==typeof nt?a(nt):nt},this.xml2json=function(nt){return s(nt)},this.xml_str2json=function(nt){var rt=this.parseXmlString(nt);return null!=rt?this.xml2json(rt):null},this.json2xml_str=function(nt){return y(nt,"")},this.json2xml=function(nt){var rt=this.json2xml_str(nt);return this.parseXmlString(rt)},this.getVersion=function(){return"1.2.0"}},ya="onLoad";function zn(nt){nt=nt||{};var rt,it,at,st,ot,ut,ht=this.context,pt=(0,ct.Z)(ht).getInstance(),_t=(0,pn.Z)(ht).getInstance();function g(nt,rt,it){var at,st,ot={};ot.elements=nt,ot.type=rt,ot.resolveType=it,0===ot.elements.length&&p(ot);for(var lt=0;lt<ot.elements.length;lt++)at=ot.elements[lt],st=_t.isHTTPURL(at.url)?at.url:at.originalContent.BaseURL+at.url,ut.load(st,at,ot)}function h(nt){var rt,it,at="";if(rt=nt.element,it=nt.resolveObject,rt.resolvedContent){var st=0;0===rt.resolvedContent.indexOf("<?xml")&&(st=rt.resolvedContent.indexOf("?>")+2),at=rt.resolvedContent.substr(0,st)+"<response>"+rt.resolvedContent.substr(st)+"</response>",rt.resolvedContent=ot.xml_str2json(at)}(function(nt){var rt;for(rt=0;rt<nt.elements.length;rt++)if(!1===nt.elements[rt].resolved)return!1;return!0})(it)&&p(it)}function p(nt){var rt,it,ot=[];if(function(nt){var rt,it,ot,lt,ut,ct,dt=[];for(lt=nt.elements.length-1;lt>=0;lt--){if(it=(rt=nt.elements[lt]).type+"_asArray",rt.resolvedContent){if(rt.resolvedContent)for(ut=0;ut<rt.resolvedContent[it].length;ut++)ot=rt.resolvedContent[it][ut],dt.push(ot)}else delete rt.originalContent["xlink:actuate"],delete rt.originalContent["xlink:href"],dt.push(rt.originalContent);for(rt.parentElement[it].splice(rt.index,1),ct=0;ct<dt.length;ct++)rt.parentElement[it].splice(rt.index+ct,0,dt[ct]);dt=[]}nt.elements.length>0&&at.run(st)}(nt),"onActuate"===nt.resolveType&&pt.trigger(dt.Z.XLINK_READY,{manifest:st}),nt.resolveType===ya)switch(nt.type){case lt.Z.PERIOD:for(rt=0;rt<st[lt.Z.PERIOD+"_asArray"].length;rt++)(it=st[lt.Z.PERIOD+"_asArray"][rt]).hasOwnProperty(lt.Z.ADAPTATION_SET+"_asArray")&&(ot=ot.concat(m(it[lt.Z.ADAPTATION_SET+"_asArray"],it,lt.Z.ADAPTATION_SET,ya))),it.hasOwnProperty(lt.Z.EVENT_STREAM+"_asArray")&&(ot=ot.concat(m(it[lt.Z.EVENT_STREAM+"_asArray"],it,lt.Z.EVENT_STREAM,ya)));g(ot,lt.Z.ADAPTATION_SET,ya);break;case lt.Z.ADAPTATION_SET:pt.trigger(dt.Z.XLINK_READY,{manifest:st})}}function m(nt,rt,it,at){var st,ot,lt,ut=[];for(ot=nt.length-1;ot>=0;ot--)(st=nt[ot]).hasOwnProperty("xlink:href")&&"urn:mpeg:dash:resolve-to-zero:2013"===st["xlink:href"]&&nt.splice(ot,1);for(ot=0;ot<nt.length;ot++)(st=nt[ot]).hasOwnProperty("xlink:href")&&st.hasOwnProperty("xlink:actuate")&&st["xlink:actuate"]===at&&(lt=y(st["xlink:href"],rt,it,ot,at,st),ut.push(lt));return ut}function y(nt,rt,it,at,st,ot){return{url:nt,parentElement:rt,type:it,index:at,resolveType:st,originalContent:ot,resolvedContent:null,resolved:!1}}return rt={resolveManifestOnLoad:function(nt){ot=new Vn({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:it}),(st=nt).Period_asArray?g(m(st.Period_asArray,st,lt.Z.PERIOD,ya),lt.Z.PERIOD,ya):pt.trigger(dt.Z.XLINK_READY,{manifest:st})},setMatchers:function(nt){nt&&(it=nt)},setIron:function(nt){nt&&(at=nt)},reset:function(){pt.off(dt.Z.XLINK_ELEMENT_LOADED,h,rt),ut&&(ut.reset(),ut=null)}},pt.on(dt.Z.XLINK_ELEMENT_LOADED,h,rt),ut=_a(ht).create({errHandler:nt.errHandler,dashMetrics:nt.dashMetrics,mediaPlayerModel:nt.mediaPlayerModel,requestModifier:nt.requestModifier,settings:nt.settings}),rt}zn.__dashjs_factory_name="XlinkController";var va=ht.Z.getClassFactory(zn);function Xn(nt){return Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},Xn(nt)}function Qn(nt){function t(nt,rt){for(var it in nt)rt.hasOwnProperty(it)||(rt[it]=nt[it])}function n(nt,rt,it){for(var at=0,st=nt.length;at<st;++at){var ot=nt[at];if(rt[ot.name])if(it[ot.name]){if(ot.merge){var lt=rt[ot.name],ut=it[ot.name];"object"===Xn(lt)&&"object"===Xn(ut)?t(lt,ut):it[ot.name]=lt+ut}}else it[ot.name]=rt[ot.name]}}function r(nt,rt){for(var it=0,at=nt.children.length;it<at;++it){var st=nt.children[it],ot=rt[st.name+"_asArray"];if(ot)for(var lt=0,ut=ot.length;lt<ut;++lt){var ct=ot[lt];n(nt.properties,rt,ct),r(st,ct)}}}return{run:function(rt){if(null===rt||"object"!==Xn(rt))return rt;if(rt.Period_asArray&&"period"in nt)for(var it=nt.period,at=rt.Period_asArray,st=0,ot=at.length;st<ot;++st){var lt=at[st];if(r(it,lt),"adaptationset"in nt){var ut=lt.AdaptationSet_asArray;if(ut)for(var ct=nt.adaptationset,dt=0,ht=ut.length;dt<ht;++dt)r(ct,ut[dt])}}return rt}}}Qn.__dashjs_factory_name="ObjectIron";var Ta=ht.Z.getClassFactory(Qn);function $n(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var Ra=function(){function e(nt,rt){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this._test=nt,this._converter=rt}var nt;return(nt=[{key:"test",get:function(){return this._test}},{key:"converter",get:function(){return this._converter}}])&&$n(e.prototype,nt),e}();function tr(nt){return tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},tr(nt)}function nr(nt,rt,it){return rt in nt?Object.defineProperty(nt,rt,{value:it,enumerable:!0,configurable:!0,writable:!0}):nt[rt]=it,nt}function rr(nt,rt){return rr=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},rr(nt,rt)}function ir(nt,rt){return!rt||"object"!==tr(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function ar(nt){return ar=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},ar(nt)}var wa=function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&rr(nt,rt)}(i,nt);var rt,it,at=(rt=i,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=ar(rt);if(it){var st=ar(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return ir(this,nt)});function i(){return function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,i),at.call(this,(function(nt,rt){var it,at=(nr(it={},lt.Z.MPD,[lt.Z.ID,lt.Z.PROFILES]),nr(it,lt.Z.PERIOD,[lt.Z.ID]),nr(it,lt.Z.BASE_URL,[lt.Z.SERVICE_LOCATION,lt.Z.BYTE_RANGE]),nr(it,lt.Z.SEGMENT_BASE,[lt.Z.INDEX_RANGE]),nr(it,lt.Z.INITIALIZATION,[lt.Z.RANGE]),nr(it,lt.Z.REPRESENTATION_INDEX,[lt.Z.RANGE]),nr(it,lt.Z.SEGMENT_LIST,[lt.Z.INDEX_RANGE]),nr(it,lt.Z.BITSTREAM_SWITCHING,[lt.Z.RANGE]),nr(it,lt.Z.SEGMENT_URL,[lt.Z.MEDIA_RANGE,lt.Z.INDEX_RANGE]),nr(it,lt.Z.SEGMENT_TEMPLATE,[lt.Z.INDEX_RANGE,lt.Z.MEDIA,lt.Z.INDEX,lt.Z.INITIALIZATION_MINUS,lt.Z.BITSTREAM_SWITCHING_MINUS]),nr(it,lt.Z.ASSET_IDENTIFIER,[lt.Z.VALUE,lt.Z.ID]),nr(it,lt.Z.EVENT_STREAM,[lt.Z.VALUE]),nr(it,lt.Z.ADAPTATION_SET,[lt.Z.PROFILES,lt.Z.MIME_TYPE,lt.Z.SEGMENT_PROFILES,lt.Z.CODECS,lt.Z.CONTENT_TYPE]),nr(it,lt.Z.FRAME_PACKING,[lt.Z.VALUE,lt.Z.ID]),nr(it,lt.Z.AUDIO_CHANNEL_CONFIGURATION,[lt.Z.VALUE,lt.Z.ID]),nr(it,lt.Z.CONTENT_PROTECTION,[lt.Z.VALUE,lt.Z.ID]),nr(it,lt.Z.ESSENTIAL_PROPERTY,[lt.Z.VALUE,lt.Z.ID]),nr(it,lt.Z.SUPPLEMENTAL_PROPERTY,[lt.Z.VALUE,lt.Z.ID]),nr(it,lt.Z.INBAND_EVENT_STREAM,[lt.Z.VALUE,lt.Z.ID]),nr(it,lt.Z.ACCESSIBILITY,[lt.Z.VALUE,lt.Z.ID]),nr(it,lt.Z.ROLE,[lt.Z.VALUE,lt.Z.ID]),nr(it,lt.Z.RATING,[lt.Z.VALUE,lt.Z.ID]),nr(it,lt.Z.VIEWPOINT,[lt.Z.VALUE,lt.Z.ID]),nr(it,lt.Z.CONTENT_COMPONENT,[lt.Z.CONTENT_TYPE]),nr(it,lt.Z.REPRESENTATION,[lt.Z.ID,lt.Z.DEPENDENCY_ID,lt.Z.MEDIA_STREAM_STRUCTURE_ID]),nr(it,lt.Z.SUBSET,[lt.Z.ID]),nr(it,lt.Z.METRICS,[lt.Z.METRICS_MINUS]),nr(it,lt.Z.REPORTING,[lt.Z.VALUE,lt.Z.ID]),it);if(at.hasOwnProperty(rt)){var st=at[rt];return void 0!==st&&st.indexOf(nt.name)>=0}return!1}),(function(nt){return String(nt)}))}return i}(Ra);function sr(nt){return sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},sr(nt)}function ur(nt,rt){return ur=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},ur(nt,rt)}function lr(nt,rt){return!rt||"object"!==sr(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function cr(nt){return cr=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},cr(nt)}var La=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,Ca=function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&ur(nt,rt)}(i,nt);var rt,it,at=(rt=i,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=cr(rt);if(it){var st=cr(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return lr(this,nt)});function i(){return function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,i),at.call(this,(function(nt){for(var rt=[lt.Z.MIN_BUFFER_TIME,lt.Z.MEDIA_PRESENTATION_DURATION,lt.Z.MINIMUM_UPDATE_PERIOD,lt.Z.TIMESHIFT_BUFFER_DEPTH,lt.Z.MAX_SEGMENT_DURATION,lt.Z.MAX_SUBSEGMENT_DURATION,lt.Z.SUGGESTED_PRESENTATION_DELAY,lt.Z.START,ot.Z.START_TIME,lt.Z.DURATION],it=rt.length,at=0;at<it;at++)if(nt.nodeName===rt[at])return La.test(nt.value);return!1}),(function(nt){var rt=La.exec(nt),it=31536e3*parseFloat(rt[3]||0)+2592e3*parseFloat(rt[5]||0)+86400*parseFloat(rt[7]||0)+3600*parseFloat(rt[9]||0)+60*parseFloat(rt[11]||0)+parseFloat(rt[13]||0);return void 0!==rt[1]&&(it=-it),it}))}return i}(Ra);function gr(nt){return gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},gr(nt)}function hr(nt,rt){return hr=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},hr(nt,rt)}function pr(nt,rt){return!rt||"object"!==gr(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function mr(nt){return mr=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},mr(nt)}var Ma=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,Oa=function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&hr(nt,rt)}(i,nt);var rt,it,at=(rt=i,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=mr(rt);if(it){var st=mr(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return pr(this,nt)});function i(){return function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,i),at.call(this,(function(nt){return Ma.test(nt.value)}),(function(nt){var rt,it=Ma.exec(nt);if(rt=Date.UTC(parseInt(it[1],10),parseInt(it[2],10)-1,parseInt(it[3],10),parseInt(it[4],10),parseInt(it[5],10),it[6]&&parseInt(it[6],10)||0,it[7]&&1e3*parseFloat(it[7])||0),it[9]&&it[10]){var at=60*parseInt(it[9],10)+parseInt(it[10],10);rt+=("+"===it[8]?-1:1)*at*60*1e3}return new Date(rt)}))}return i}(Ra);function vr(nt){return vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},vr(nt)}function _r(nt,rt){return _r=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},_r(nt,rt)}function Tr(nt,rt){return!rt||"object"!==vr(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function Sr(nt){return Sr=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},Sr(nt)}var xa=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,Ba=function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&_r(nt,rt)}(i,nt);var rt,it,at=(rt=i,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=Sr(rt);if(it){var st=Sr(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return Tr(this,nt)});function i(){return function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,i),at.call(this,(function(nt){return xa.test(nt.value)}),(function(nt){return parseFloat(nt)}))}return i}(Ra);function Ir(nt){return Ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},Ir(nt)}function Rr(nt,rt,it){return rt in nt?Object.defineProperty(nt,rt,{value:it,enumerable:!0,configurable:!0,writable:!0}):nt[rt]=it,nt}function wr(nt,rt){return wr=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},wr(nt,rt)}function Nr(nt,rt){return!rt||"object"!==Ir(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function Cr(nt){return Cr=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},Cr(nt)}var Ua=function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&wr(nt,rt)}(i,nt);var rt,it,at=(rt=i,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=Cr(rt);if(it){var st=Cr(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return Nr(this,nt)});function i(){return function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,i),at.call(this,(function(nt,rt){var it,at=(Rr(it={},lt.Z.ADAPTATION_SET,[lt.Z.LANG]),Rr(it,lt.Z.REPRESENTATION,[lt.Z.LANG]),Rr(it,lt.Z.CONTENT_COMPONENT,[lt.Z.LANG]),Rr(it,lt.Z.LABEL,[lt.Z.LANG]),Rr(it,lt.Z.GROUP_LABEL,[lt.Z.LANG]),it);if(at.hasOwnProperty(rt)){var st=at[rt];return void 0!==st&&st.indexOf(nt.name)>=0}return!1}),(function(nt){return ta()(nt)||String(nt)}))}return i}(Ra);function Or(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var qa=function(){function e(nt){var rt;!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=nt,this._merge=(rt=nt)&&rt.length&&rt.charAt(0)===rt.charAt(0).toUpperCase()}var nt;return(nt=[{key:"name",get:function(){return this._name}},{key:"merge",get:function(){return this._merge}}])&&Or(e.prototype,nt),e}();function Pr(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var $a=function(){function e(nt,rt,it){var at=this;!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=nt||"",this._properties=[],this._children=it||[],Array.isArray(rt)&&rt.forEach((function(nt){at._properties.push(new qa(nt))}))}var nt;return(nt=[{key:"name",get:function(){return this._name}},{key:"children",get:function(){return this._children}},{key:"properties",get:function(){return this._properties}}])&&Pr(e.prototype,nt),e}();function Fr(nt){return Fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},Fr(nt)}function xr(nt,rt){return xr=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},xr(nt,rt)}function kr(nt,rt){return!rt||"object"!==Fr(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function Ur(nt){return Ur=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},Ur(nt)}var za=function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&xr(nt,rt)}(i,nt);var rt,it,at=(rt=i,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=Ur(rt);if(it){var st=Ur(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return kr(this,nt)});function i(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,i);var nt=[lt.Z.PROFILES,lt.Z.WIDTH,lt.Z.HEIGHT,lt.Z.SAR,lt.Z.FRAMERATE,lt.Z.AUDIO_SAMPLING_RATE,lt.Z.MIME_TYPE,lt.Z.SEGMENT_PROFILES,lt.Z.CODECS,lt.Z.MAXIMUM_SAP_PERIOD,lt.Z.START_WITH_SAP,lt.Z.MAX_PLAYOUT_RATE,lt.Z.CODING_DEPENDENCY,lt.Z.SCAN_TYPE,lt.Z.FRAME_PACKING,lt.Z.AUDIO_CHANNEL_CONFIGURATION,lt.Z.CONTENT_PROTECTION,lt.Z.ESSENTIAL_PROPERTY,lt.Z.ESSENTIAL_PROPERTY+"_asArray",lt.Z.SUPPLEMENTAL_PROPERTY,lt.Z.INBAND_EVENT_STREAM];return at.call(this,lt.Z.ADAPTATION_SET,nt,[new $a(lt.Z.REPRESENTATION,nt,[new $a(lt.Z.SUB_REPRESENTATION,nt)])])}return i}($a);function Br(nt){return Br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},Br(nt)}function Gr(nt,rt){return Gr=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},Gr(nt,rt)}function qr(nt,rt){return!rt||"object"!==Br(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function Yr(nt){return Yr=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},Yr(nt)}var Xa=function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&Gr(nt,rt)}(i,nt);var rt,it,at=(rt=i,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=Yr(rt);if(it){var st=Yr(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return qr(this,nt)});function i(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,i);var nt=[lt.Z.SEGMENT_BASE,lt.Z.SEGMENT_TEMPLATE,lt.Z.SEGMENT_LIST];return at.call(this,lt.Z.PERIOD,nt,[new $a(lt.Z.ADAPTATION_SET,nt,[new $a(lt.Z.REPRESENTATION,nt)])])}return i}($a);function Hr(nt){nt=nt||{};var rt,it,at,st,ot,lt=this.context,ut=nt.debug;return rt={parse:function(nt){var rt,at=window.performance.now();if(!(rt=st.xml_str2json(nt)))throw new Error("parsing the manifest failed");var lt=window.performance.now();rt.Patch?((rt=rt.Patch).add_asArray&&rt.add_asArray.forEach((function(nt){return ot.run(nt)})),rt.replace_asArray&&rt.replace_asArray.forEach((function(nt){return ot.run(nt)}))):(rt=rt.MPD,ot.run(rt));var ut=window.performance.now();return it.info("Parsing complete: ( xml2json: "+(lt-at).toPrecision(3)+"ms, objectiron: "+(ut-lt).toPrecision(3)+"ms, total: "+((ut-at)/1e3).toPrecision(3)+"s)"),rt.protocol="DASH",rt},getMatchers:function(){return at},getIron:function(){return ot}},it=ut.getLogger(rt),at=[new Ca,new Oa,new Ba,new Ua,new wa],st=new Vn({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!0,ignoreRoot:!1,matchers:at}),ot=Ta(lt).create({adaptationset:new za,period:new Xa}),rt}Hr.__dashjs_factory_name="DashParser";var Ja=ht.Z.getClassFactory(Hr);function Kr(nt){nt=nt||{};var rt,it,at,st,ut,ht=this.context,pt=nt.debug,_t=nt.settings,Et=(0,ct.Z)(ht).getInstance(),St=(0,pn.Z)(ht).getInstance(),wt=nt.mssHandler,Lt=nt.errHandler;function y(nt){Et.trigger(dt.Z.INTERNAL_MANIFEST_LOADED,{manifest:nt.manifest})}function E(nt){var rt=null;return nt.indexOf("SmoothStreamingMedia")>-1?(wt&&(rt=wt.createMssParser(),wt.createMssFragmentProcessor(),wt.registerEvents()),rt):nt.indexOf("MPD")>-1||nt.indexOf("Patch")>-1?Ja(ht).create({debug:pt}):rt}return rt={load:function(nt){var rt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,ot=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,lt=new Date,ct=new ga(nt,Ut.w.MPD_TYPE);rt&&(ct.serviceLocation=rt),ot&&(ct.queryParams=ot),ct.requestStartDate||(ct.requestStartDate=lt),Et.trigger(dt.Z.MANIFEST_LOADING_STARTED,{request:ct}),at.load({request:ct,success:function(rt,at,ot){var lt,ct,ht;if(st)if(ot&&ot!==nt?(ct=St.parseBaseUrl(ot),lt=ot):(St.isRelative(nt)&&(nt=St.resolve(nt,window.location.href)),ct=St.parseBaseUrl(nt)),"No Content"!=at)if(null===ut&&(ut=E(rt)),null!==ut){st.setMatchers(ut.getMatchers()),st.setIron(ut.getIron());try{ht=ut.parse(rt)}catch(rt){return void Et.trigger(dt.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new Ot.Z(Ft.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,Ft.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(nt))})}if(ht){if(ht.url=lt||nt,ht.originalUrl||(ht.originalUrl=ht.url),_t&&_t.get().streaming.enableManifestDurationMismatchFix&&ht.mediaPresentationDuration&&ht.Period_asArray.length>1){var pt=ht.Period_asArray.reduce((function(nt,rt){return nt+rt.duration}),0);!isNaN(pt)&&ht.mediaPresentationDuration>pt&&(it.warn("Media presentation duration greater than duration of all periods. Setting duration to total period duration"),ht.mediaPresentationDuration=pt)}ht.baseUri=ct,ht.loadedTime=new Date,st.resolveManifestOnLoad(ht),Et.trigger(dt.Z.ORIGINAL_MANIFEST_LOADED,{originalManifest:rt})}else Et.trigger(dt.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new Ot.Z(Ft.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,Ft.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(nt))})}else Et.trigger(dt.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new Ot.Z(Ft.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,Ft.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(nt))});else Et.trigger(dt.Z.INTERNAL_MANIFEST_LOADED,{manifest:null})},error:function(rt,it,at){Et.trigger(dt.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new Ot.Z(Ft.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE,Ft.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE+"".concat(nt,", ").concat(at))})}})},reset:function(){Et.off(dt.Z.XLINK_READY,y,rt),wt&&wt.reset(),st&&(st.reset(),st=null),at&&(at.abort(),at=null)}},it=pt.getLogger(rt),Et.on(dt.Z.XLINK_READY,y,rt),at=ci(ht).create({errHandler:nt.errHandler,dashMetrics:nt.dashMetrics,mediaPlayerModel:nt.mediaPlayerModel,requestModifier:nt.requestModifier,urlUtils:St,constants:ot.Z,dashConstants:lt.Z,errors:Ft,requestTimeout:nt.settings.get().streaming.manifestRequestTimeout}),st=va(ht).create({errHandler:Lt,dashMetrics:nt.dashMetrics,mediaPlayerModel:nt.mediaPlayerModel,requestModifier:nt.requestModifier,settings:nt.settings}),ut=null,rt}Kr.__dashjs_factory_name="ManifestLoader";var es=ht.Z.getClassFactory(Kr);function Wr(){var nt=this.context,rt=(0,ct.Z)(nt).getInstance();return{error:function(nt){rt.trigger(dt.Z.ERROR,{error:nt})}}}Wr.__dashjs_factory_name="ErrorHandler";var ts=ht.Z.getSingletonFactory(Wr),ns=it(1715);function Jr(){var nt,rt,it,at,st,lt,ut=this.context,ht=(0,ct.Z)(ut).getInstance();function d(nt,at){if(!at||!at.Period_asArray||0===at.Period_asArray.length)return Promise.resolve();var st=[];return at.Period_asArray.forEach((function(at){st.push(function(nt,at){return new Promise((function(st){if(nt&&nt.AdaptationSet_asArray&&0!==nt.AdaptationSet_asArray.length){var ut=[];nt.AdaptationSet_asArray.forEach((function(nt){rt.getIsTypeOf(nt,at)&&ut.push(function(nt,at){return new Promise((function(st){if(nt.Representation_asArray&&0!==nt.Representation_asArray.length){var ut=[],ct=[];nt.Representation_asArray.forEach((function(st,lt){var dt=rt.getCodec(nt,lt,!1),ht=function(nt,rt,it){switch(nt){case ot.Z.VIDEO:return function(nt,rt){return{codec:rt,width:nt.width||null,height:nt.height||null,framerate:nt.frameRate||null,bitrate:nt.bandwidth||null}}(rt,it);case ot.Z.AUDIO:return function(nt,rt){var it=nt.audioSamplingRate||null;return{codec:rt,bitrate:nt.bandwidth||null,samplerate:it}}(rt,it);default:return null}}(at,st,dt);ct.push(ht),ut.push(it.supportsCodec(ht,at))})),Promise.all(ut).then((function(rt){nt.Representation_asArray=nt.Representation_asArray.filter((function(nt,it){return rt[it]||lt.debug("[Stream] Codec ".concat(ct[it].codec," not supported ")),rt[it]})),st()})).catch((function(){st()}))}else st()}))}(nt,at))})),Promise.all(ut).then((function(){nt.AdaptationSet_asArray=nt.AdaptationSet_asArray.filter((function(nt){var rt=nt.Representation_asArray&&nt.Representation_asArray.length>0;return rt||(ht.trigger(dt.Z.ADAPTATION_SET_REMOVED_NO_CAPABILITIES,{adaptationSet:nt}),lt.warn("AdaptationSet has been removed because of no supported Representation")),rt})),st()})).catch((function(){st()}))}else st()}))}(at,nt))})),Promise.all(st)}return nt={setConfig:function(nt){nt&&(nt.adapter&&(rt=nt.adapter),nt.capabilities&&(it=nt.capabilities),nt.settings&&(at=nt.settings),nt.customParametersModel&&(st=nt.customParametersModel))},filterUnsupportedFeatures:function(nt){return new Promise((function(ut){var ct=[];ct.push(d(ot.Z.VIDEO,nt)),ct.push(d(ot.Z.AUDIO,nt)),Promise.all(ct).then((function(){at.get().streaming.capabilities.filterUnsupportedEssentialProperties&&function(nt){nt&&nt.Period_asArray&&0!==nt.Period_asArray.length&&nt.Period_asArray.forEach((function(nt){nt.AdaptationSet_asArray=nt.AdaptationSet_asArray.filter((function(nt){return!nt.Representation_asArray||0===nt.Representation_asArray.length||(nt.Representation_asArray=nt.Representation_asArray.filter((function(nt){var at=rt.getEssentialPropertiesForRepresentation(nt);if(at&&at.length>0)for(var st=0;st<at.length;){if(!it.supportsEssentialProperty(at[st]))return lt.debug("[Stream] EssentialProperty not supported: "+at[st].schemeIdUri),!1;st+=1}return!0})),nt.Representation_asArray&&nt.Representation_asArray.length>0)}))}))}(nt),function(nt){var rt=st.getCustomCapabilitiesFilters();rt&&0!==rt.length&&nt&&nt.Period_asArray&&0!==nt.Period_asArray.length&&nt.Period_asArray.forEach((function(nt){nt.AdaptationSet_asArray=nt.AdaptationSet_asArray.filter((function(nt){return!nt.Representation_asArray||0===nt.Representation_asArray.length||(nt.Representation_asArray=nt.Representation_asArray.filter((function(nt){return!rt.some((function(rt){return!rt(nt)}))})),nt.Representation_asArray&&nt.Representation_asArray.length>0)}))}))}(nt),ut()})).catch((function(){ut()}))}))}},lt=(0,pt.Z)(ut).getInstance().getLogger(nt),nt}Jr.__dashjs_factory_name="CapabilitiesFilter";var rs=ht.Z.getSingletonFactory(Jr),is=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null};function ti(){var nt;return{initialize:function(rt){if(nt=new is,!rt)return null;var it=rt.indexOf("#");if(-1!==it)for(var at=rt.substr(it+1).split("&"),st=0,ot=at.length;st<ot;++st){var lt=at[st],ut=lt.indexOf("=");if(-1!==ut){var ct=lt.substring(0,ut);nt.hasOwnProperty(ct)&&(nt[ct]=lt.substr(ut+1))}}},getURIFragmentData:function(){return nt}}}ti.__dashjs_factory_name="URIFragmentModel";var as=ht.Z.getSingletonFactory(ti);function ri(){var nt,rt=this.context,it=(0,ct.Z)(rt).getInstance();return{getValue:function(){return nt},setValue:function(rt){nt=rt,rt&&it.trigger(dt.Z.MANIFEST_LOADED,{data:rt})}}}ri.__dashjs_factory_name="ManifestModel";var ss=ht.Z.getSingletonFactory(ri),os=-.5;function oi(){var nt,rt,it,at,st=this.context,ot=(0,Bt.Z)(st).getInstance();function o(nt,it){return isNaN(nt)?0:nt>0?(it&&rt.warn("Supplied minimum playback rate is a positive value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):nt<os?(it&&rt.warn("Supplied minimum playback rate is out of range and will be limited to ".concat(os,": ").concat(-50,"% playback speed.")),os):nt}function s(nt,it){return isNaN(nt)?0:nt<0?(it&&rt.warn("Supplied maximum playback rate is a negative value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):nt>1?(it&&rt.warn("Supplied maximum playback rate is out of range and will be limited to ".concat(1,": ").concat(200,"% playback speed.")),1):nt}function u(){var nt=ot.get().streaming.buffer.stableBufferTime>0?ot.get().streaming.buffer.stableBufferTime:ot.get().streaming.buffer.fastSwitchEnabled?20:12,rt=it.getLiveDelay();return!isNaN(rt)&&rt>0?Math.min(nt,rt):nt}return nt={getCatchupMaxDrift:function(){if(!isNaN(ot.get().streaming.liveCatchup.maxDrift)&&ot.get().streaming.liveCatchup.maxDrift>0)return ot.get().streaming.liveCatchup.maxDrift;var nt=at.getServiceDescriptionSettings();return nt&&nt.liveCatchup&&!isNaN(nt.liveCatchup.maxDrift)&&nt.liveCatchup.maxDrift>0?nt.liveCatchup.maxDrift:12},getCatchupModeEnabled:function(){return null!==ot.get().streaming.liveCatchup.enabled?ot.get().streaming.liveCatchup.enabled:it.getInitialCatchupModeActivated()},getStableBufferTime:u,getInitialBufferLevel:function(){var nt=ot.get().streaming.buffer.initialBufferLevel;return isNaN(nt)||nt<0?0:Math.min(u(),nt)},getRetryAttemptsForType:function(nt){var rt=isNaN(ot.get().streaming.retryAttempts.lowLatencyMultiplyFactor)?5:ot.get().streaming.retryAttempts.lowLatencyMultiplyFactor;return it.getLowLatencyModeEnabled()?ot.get().streaming.retryAttempts[nt]*rt:ot.get().streaming.retryAttempts[nt]},getRetryIntervalsForType:function(nt){var rt=isNaN(ot.get().streaming.retryIntervals.lowLatencyReductionFactor)?10:ot.get().streaming.retryIntervals.lowLatencyReductionFactor;return it.getLowLatencyModeEnabled()?ot.get().streaming.retryIntervals[nt]/rt:ot.get().streaming.retryIntervals[nt]},getCatchupPlaybackRates:function(nt){var rt=ot.get().streaming.liveCatchup.playbackRate;if(!isNaN(rt.min)||!isNaN(rt.max))return{min:o(rt.min,nt),max:s(rt.max,nt)};var it=at.getServiceDescriptionSettings();if(it&&it.liveCatchup&&(!isNaN(it.liveCatchup.playbackRate.min)||!isNaN(it.liveCatchup.playbackRate.max))){var st=it.liveCatchup.playbackRate;return{min:o(st.min,nt),max:s(st.max,nt)}}return{min:-.5,max:.5}},getAbrBitrateParameter:function(nt,rt){try{var it=ot.get().streaming.abr[nt][rt];if(!isNaN(it)&&-1!==it)return it;var st=at.getServiceDescriptionSettings();return st&&st[nt]&&!isNaN(st[nt][rt])?st[nt][rt]:-1}catch(nt){return-1}},setConfig:function(nt){nt.playbackController&&(it=nt.playbackController),nt.serviceDescriptionController&&(at=nt.serviceDescriptionController)},reset:function(){}},rt=(0,pt.Z)(st).getInstance().getLogger(nt),nt}oi.__dashjs_factory_name="MediaPlayerModel";var ls=ht.Z.getSingletonFactory(oi),us=it(1767);function li(nt){var rt=(nt=nt||{}).abrController,it=nt.switchHistory,at=nt.droppedFramesHistory,st=nt.currentRequest,ot=nt.useBufferOccupancyABR,lt=nt.useL2AABR,ut=nt.useLoLPABR,ct=nt.streamProcessor?nt.streamProcessor.getScheduleController():null,dt=nt.streamProcessor?nt.streamProcessor.getRepresentationInfo():null,ht=nt.videoModel?nt.videoModel:null;function f(){return dt?dt.mediaInfo:null}return{getMediaType:function(){var nt=f();return nt?nt.type:null},getMediaInfo:f,getDroppedFramesHistory:function(){return at},getCurrentRequest:function(){return st},getSwitchHistory:function(){return it},getStreamInfo:function(){var nt=f();return nt?nt.streamInfo:null},getScheduleController:function(){return ct},getAbrController:function(){return rt},getRepresentationInfo:function(){return dt},useBufferOccupancyABR:function(){return ot},useL2AABR:function(){return lt},useLoLPABR:function(){return ut},getVideoModel:function(){return ht}}}li.__dashjs_factory_name="RulesContext";var cs=ht.Z.getClassFactory(li),ds=it(2068);function di(){var nt=[],rt=[];return{push:function(it){it.newValue===ds.Z.NO_CHANGE&&(it.newValue=it.oldValue),nt[it.oldValue]||(nt[it.oldValue]={noDrops:0,drops:0,dropSize:0});var at=it.newValue-it.oldValue,st=at<0?1:0,ot=st?-at:0,lt=st?0:1;if(nt[it.oldValue].drops+=st,nt[it.oldValue].dropSize+=ot,nt[it.oldValue].noDrops+=lt,rt.push({idx:it.oldValue,noDrop:lt,drop:st,dropSize:ot}),rt.length>8){var ut=rt.shift();nt[ut.idx].drops-=ut.drop,nt[ut.idx].dropSize-=ut.dropSize,nt[ut.idx].noDrops-=ut.noDrop}},getSwitchRequests:function(){return nt},reset:function(){nt=[],rt=[]}}}di.__dashjs_factory_name="SwitchRequestHistory";var hs=ht.Z.getClassFactory(di);function hi(){var nt={},rt={},it={};return{push:function(at,st,ot){if(st){nt[at]||(nt[at]=[],rt[at]=0,it[at]=0);var lt=ot&&ot.droppedVideoFrames?ot.droppedVideoFrames:0,ut=ot&&ot.totalVideoFrames?ot.totalVideoFrames:0,ct=lt-rt[at];rt[at]=lt;var dt=ut-it[at];it[at]=ut;var ht=nt[at];isNaN(st)||(ht[st]?(ht[st].droppedVideoFrames+=ct,ht[st].totalVideoFrames+=dt):ht[st]={droppedVideoFrames:ct,totalVideoFrames:dt})}},getFrameHistory:function(rt){return nt[rt]},clearForStream:function(at){try{delete nt[at],delete rt[at],delete it[at]}catch(nt){}},reset:function(){nt={},rt={},it={}}}}hi.__dashjs_factory_name="DroppedFramesHistory";var fs=ht.Z.getClassFactory(hi);function mi(nt){var rt,it,at,st,lt,ut=this.context,dt=(nt=nt||{}).settings,ht=(0,ct.Z)(ut).getInstance();function f(nt,rt,it,at){var st=Math.pow(.5,it/at.fast);nt.fastEstimate=(1-st)*rt+st*nt.fastEstimate;var ot=Math.pow(.5,it/at.slow);nt.slowEstimate=(1-ot)*rt+ot*nt.slowEstimate,nt.totalWeight+=it}function g(nt,ut,ct){return dt.get().streaming.abr.movingAverageMethod!==ot.Z.MOVING_AVERAGE_SLIDING_WINDOW?function(nt,rt){var it=nt?lt.throughputHalfLife:lt.latencyHalfLife,ot=nt?at[rt]:st[rt];if(!ot||ot.totalWeight<=0)return NaN;var ut=ot.fastEstimate/(1-Math.pow(.5,ot.totalWeight/it.fast)),ct=ot.slowEstimate/(1-Math.pow(.5,ot.totalWeight/it.slow));return nt?Math.min(ut,ct):Math.max(ut,ct)}(nt,ut):function(nt,at,st){var ot=function(nt,at,st){var ot,lt;if(nt?(ot=rt[at],lt=st?3:4):(ot=it[at],lt=4),ot){if(lt>=ot.length)lt=ot.length;else if(nt)for(var ut=1;ut<lt;++ut){var ct=ot[ot.length-ut]/ot[ot.length-ut-1];if((ct>=1.3||ct<=1/1.3)&&(lt+=1)===ot.length)break}}else lt=0;return lt}(nt,at,st),lt=(nt?rt:it)[at];return 0!==ot&&lt&&0!==lt.length?(lt=lt.slice(-ot)).reduce((function(nt,rt){return nt+rt}))/lt.length:NaN}(nt,ut,ct)}function h(nt,rt){return g(!0,nt,rt)}function p(nt){rt[nt]=rt[nt]||[],it[nt]=it[nt]||[],at[nt]=at[nt]||{fastEstimate:0,slowEstimate:0,totalWeight:0},st[nt]=st[nt]||{fastEstimate:0,slowEstimate:0,totalWeight:0}}function m(){rt={},it={},at={},st={}}var pt={push:function(nt,ut,ct){if(ut.trace&&ut.trace.length){var pt,Et=ut.tresponse.getTime()-ut.trequest.getTime()||1,St=ut._tfinish.getTime()-ut.tresponse.getTime()||1,wt=ut.trace.reduce((function(nt,rt){return nt+rt.b[0]}),0),Lt=0;if(0!==(pt=ut._fileLoaderType&&ut._fileLoaderType===ot.Z.FILE_LOADER_TYPES.FETCH?ut.trace.reduce((function(nt,rt){return nt+rt.d}),0):ct?St:Et+St)&&(Lt=Math.round(8*wt/pt)),ut.cmsd){var Ct=ut.cmsd.dynamic&&ut.cmsd.dynamic.etp?ut.cmsd.dynamic.etp:null;if(Ct){var Pt=dt.get().streaming.cmsd.abr.etpWeightRatio;Pt>0&&Pt<=1&&(Lt=Lt*(1-Pt)+Ct*Pt)}}if(p(nt),function(nt,rt,it){return nt===ot.Z.VIDEO?it<dt.get().streaming.cacheLoadThresholds[ot.Z.VIDEO]:nt===ot.Z.AUDIO?it<dt.get().streaming.cacheLoadThresholds[ot.Z.AUDIO]:void 0}(nt,0,St)){if(rt[nt].length>0&&!rt[nt].hasCachedEntries)return;rt[nt].hasCachedEntries=!0}else rt[nt]&&rt[nt].hasCachedEntries&&function(nt){delete rt[nt],delete it[nt],delete at[nt],delete st[nt],p(nt)}(nt);rt[nt].push(Lt),ht.trigger(_t.Z.THROUGHPUT_MEASUREMENT_STORED,{throughput:Lt,mediaType:nt,httpRequest:ut}),rt[nt].length>20&&rt[nt].shift(),it[nt].push(Et),it[nt].length>20&&it[nt].shift(),f(at[nt],Lt,.001*St,lt.throughputHalfLife),f(st[nt],Et,1,lt.latencyHalfLife)}},getAverageThroughput:h,getSafeAverageThroughput:function(nt,rt){var it=h(nt,rt);return isNaN(it)||(it*=dt.get().streaming.abr.bandwidthSafetyFactor),it},getAverageLatency:function(nt){return g(!1,nt)},reset:m};return lt={throughputHalfLife:{fast:3,slow:8},latencyHalfLife:{fast:1,slow:2}},m(),pt}mi.__dashjs_factory_name="ThroughputHistory";var ps=ht.Z.getClassFactory(mi);function Ei(){var nt,rt,it,at,st,lt,ht,Et,St,wt,Lt,Ct,Pt,Ot,Ft,Bt,Gt,Ht,jt,Kt,$t,Yt,Wt,Qt,en,nn,an,hn=this.context,fn=(0,pt.Z)(hn).getInstance(),pn=(0,ct.Z)(hn).getInstance();function U(){st={},lt={},Et={},ht={},Kt={},Wt={},Qt={},en={},void 0===wt&&(wt=!1),$t&&$t.reset(),jt=void 0,$t=void 0,Yt=void 0,clearTimeout(St),St=null}function Z(rt){var st=rt.request.mediaType,ot=rt.streamId;if(st&&ot&&ht[ot]&&an.get().streaming.abr.autoSwitchBitrate[st]){var lt=ht[ot][st];if(lt){var ct=cs(hn).create({abrController:nt,streamProcessor:lt,currentRequest:rt.request,useBufferOccupancyABR:Wt[st],useL2AABR:Qt[st],useLoLPABR:en[st],videoModel:Ot}),dt=it.shouldAbandonFragment(ct,ot);dt.quality>ds.Z.NO_CHANGE&&lt.getFragmentModel().getRequests({state:kt.FRAGMENT_MODEL_LOADING,index:rt.request.index})[0]&&(Et[ot][st].state=ut.Z.ABANDON_LOAD,Kt[ot][st].reset(),Kt[ot][st].push({oldValue:j(st,ot),newValue:dt.quality,confidence:1,reason:dt.reason}),H(st,at.getActiveStreamInfo(),dt.quality,dt.reason),clearTimeout(St),St=setTimeout((function(){Et[ot][st].state=ut.Z.ALLOW_LOAD,St=null}),an.get().streaming.abandonLoadTimeout))}}}function B(nt){nt.mediaType===ot.Z.VIDEO&&(void 0!==jt&&$t.push(nt.streamId,jt,Ot.getPlaybackQuality()),jt=nt.newQuality)}function G(nt){var it,at;nt.metric!==ut.Z.HTTP_REQUEST||!nt.value||nt.value.type!==Ut.w.MEDIA_SEGMENT_TYPE||nt.mediaType!==ot.Z.AUDIO&&nt.mediaType!==ot.Z.VIDEO||Yt.push(nt.mediaType,nt.value,an.get().streaming.abr.useDeadTimeLatency),nt.metric!==ut.Z.BUFFER_LEVEL||nt.mediaType!==ot.Z.AUDIO&&nt.mediaType!==ot.Z.VIDEO||(it=nt.mediaType,at=.001*nt.value.level,an.get().streaming.abr.ABRStrategy===ot.Z.ABR_STRATEGY_DYNAMIC&&function(nt,it){try{var at=Ft.getStableBufferTime(),st=at,ot=.5*at,lt=Wt[nt],ut=it>(lt?ot:st);Wt[nt]=ut,ut!==lt&&(ut?rt.info("["+nt+"] switching from throughput to buffer occupancy ABR rule (buffer: "+it.toFixed(3)+")."):rt.info("["+nt+"] switching from buffer occupancy to throughput ABR rule (buffer: "+it.toFixed(3)+")."))}catch(nt){rt.error(nt)}}(it,at))}function q(nt,it){try{var at;return st[it]=st[it]||{},st[it].hasOwnProperty(nt)||(st[it][nt]=0),at=function(nt,rt){var it=st[rt][nt],at=it;if(!ht[rt]||!ht[rt][nt])return at;var ot=Y(nt,rt);void 0!==ot&&(at=Math.max(it,ot));var lt=function(nt,rt){try{var it=Ft.getAbrBitrateParameter("maxBitrate",nt);return it>-1?W(ht[rt][nt].getMediaInfo(),it,rt):void 0}catch(nt){return}}(nt,rt);return void 0!==lt&&(at=Math.min(at,lt)),at}(nt,it),at=function(nt,rt,it){var at=st[it][rt],ot=an.get().streaming.abr.maxRepresentationRatio[rt];return isNaN(ot)||ot>=1||ot<0?nt:Math.min(nt,Math.round(at*ot))}(at,nt,it),at=function(nt,rt,it){if(rt!==ot.Z.VIDEO||!an.get().streaming.abr.limitBitrateByPortal||!ht[it]||!ht[it][rt])return nt;wt||Q();var at=ht[it][rt].getStreamInfo(),st=Pt.getAdaptationForType(at.index,rt,at).Representation_asArray,lt=nt;if(Lt>0&&Ct>0){for(;lt>0&&st[lt]&&Lt<st[lt].width&&Lt-st[lt-1].width<st[lt].width-Lt;)lt-=1;for(;lt<st.length-1&&st[lt].width===st[lt+1].width;)lt+=1}return lt}(at,nt,it),an.get().streaming.cmsd.enabled&&an.get().streaming.cmsd.abr.applyMb&&(at=function(nt,it,at){if("video"!==it)return nt;var st=Gt.getMaxBitrate(it);if(st<0)return nt;var ot=K(at,"audio",j("audio",at));st-=ot?ot.bitrate/1e3:0;var lt=W(ht[at][it].getMediaInfo(),st,at);return rt.debug("Stream ID: "+at+" ["+it+"] Apply max bit rate from CMSD: "+st),Math.min(nt,lt)}(at,nt,it)),at}catch(nt){return}}function Y(nt,rt){try{return function(nt,rt){try{var it=Ft.getAbrBitrateParameter("minBitrate",nt);if(it>-1){var at=ht[rt][nt].getMediaInfo(),st=X(at),ot=W(at,it,rt);return st[ot]&&ot<st.length-1&&st[ot].bitrate<1e3*it&&ot++,ot}return}catch(nt){return}}(nt,rt)}catch(nt){return}}function j(nt){var rt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return rt||(rt=at.getActiveStreamInfo().id),nt&&ht[rt]&&ht[rt][nt]&&rt?(lt[rt]=lt[rt]||{},lt[rt].hasOwnProperty(nt)||(lt[rt][nt]=0),lt[rt][nt]):0}catch(nt){return 0}}function H(nt,rt,it){var at=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(rt&&rt.id&&nt){var st=rt.id,ot=j(nt,st);(0,ln.SE)(it);var lt=q(nt,st);it!==ot&&it>=0&&it<=lt&&V(nt,ot,it,lt,at,st)}}function V(nt,it,at,st,ot,ut){if(nt&&ht[ut]&&ht[ut][nt]){var ct=ht[ut][nt].getStreamInfo(),pt=ct&&ct.manifestInfo&&ct.manifestInfo.isDynamic,_t=nn.getCurrentBufferLevel(nt);rt.info("Stream ID: "+ut+" ["+nt+"] switch from "+it+" to "+at+"/"+st+" (buffer: "+_t+") "+(ot?JSON.stringify(ot):".")),lt[ut]=lt[ut]||{},lt[ut][nt]=at;var Et=K(ut,nt,at);pn.trigger(dt.Z.QUALITY_CHANGE_REQUESTED,{oldQuality:it,newQuality:at,reason:ot,streamInfo:ct,bitrateInfo:Et,maxIdx:st,mediaType:nt},{streamId:ct.id,mediaType:nt});var St=Yt.getAverageThroughput(nt,pt);isNaN(St)||Ht.setSavedBitrateSettings(nt,St)}}function K(nt,rt,it){if(rt&&ht&&ht[nt]&&ht[nt][rt]){var at=X(ht[nt][rt].getMediaInfo());return at[it]?at[it]:null}return null}function W(nt,rt,it){var at=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,st=nt&&nt.type?ht[it][nt.type].getRepresentationInfo():null;if(an.get().streaming.abr.useDeadTimeLatency&&at&&st&&st.fragmentDuration){at/=1e3;var ot=st.fragmentDuration;if(at>ot)return 0;rt*=1-at/ot}for(var lt=X(nt),ut=lt.length-1;ut>=0;ut--)if(1e3*rt>=lt[ut].bitrate)return ut;return 0}function X(nt){var rt=[];if(!nt||!nt.bitrateList)return rt;for(var it,at=nt.bitrateList,st=nt.type,ot=0,lt=at.length;ot<lt;ot++)(it=new vi).mediaType=st,it.qualityIndex=ot,it.bitrate=at[ot].bandwidth,it.width=at[ot].width,it.height=at[ot].height,it.scanType=at[ot].scanType,rt.push(it);return rt}function Q(){if(Ot){var nt=an.get().streaming.abr.usePixelRatioInLimitBitrateByPortal&&window.hasOwnProperty("devicePixelRatio")?window.devicePixelRatio:1;Lt=Ot.getClientWidth()*nt,Ct=Ot.getClientHeight()*nt}}return nt={initialize:function(){$t=fs(hn).create(),Yt=ps(hn).create({settings:an}),(it=(0,us.Z)(hn).create({dashMetrics:nn,customParametersModel:Bt,mediaPlayerModel:Ft,settings:an})).initialize(),pn.on(_t.Z.QUALITY_CHANGE_RENDERED,B,nt),pn.on(_t.Z.METRIC_ADDED,G,nt),pn.on(dt.Z.LOADING_PROGRESS,Z,nt)},isPlayingAtTopQuality:function(nt){var rt=nt?nt.id:null,it=j(ot.Z.AUDIO,rt),at=j(ot.Z.VIDEO,rt);return it===q(ot.Z.AUDIO,rt)&&at===q(ot.Z.VIDEO,rt)},updateTopQualityIndex:function(nt){var rt=nt.type,it=nt.streamInfo.id,at=nt.representationCount-1;return st[it]=st[it]||{},st[it][rt]=at,at},clearDataForStream:function(nt){$t&&$t.clearForStream(nt),ht[nt]&&delete ht[nt],Kt[nt]&&delete Kt[nt],Et[nt]&&delete Et[nt]},getThroughputHistory:function(){return Yt},getBitrateList:X,getQualityForBitrate:W,getTopBitrateInfoFor:function(nt){var rt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(rt||(rt=at.getActiveStreamInfo().id),nt&&ht&&ht[rt]&&ht[rt][nt]){var it=q(nt,rt),st=X(ht[rt][nt].getMediaInfo());return st[it]?st[it]:null}return null},getMinAllowedIndexFor:Y,getMaxAllowedIndexFor:q,getInitialBitrateFor:function(nt,rt){if(function(){if(!Ht||!Ht.hasOwnProperty("getSavedBitrateSettings"))throw new Error(ot.Z.MISSING_CONFIG_ERROR)}(),nt===ot.Z.TEXT)return NaN;var it=Ht.getSavedBitrateSettings(nt),at=Ft.getAbrBitrateParameter("initialBitrate",nt),st=an.get().streaming.abr.initialRepresentationRatio[nt];if(-1===at)if(st>-1){var lt=ht[rt][nt].getStreamInfo(),ut=Pt.getAdaptationForType(lt.index,nt,lt).Representation_asArray;at=Array.isArray(ut)?ut[Math.max(Math.round(ut.length*st)-1,0)].bandwidth/1e3:0}else at=isNaN(it)?nt===ot.Z.VIDEO?1e3:100:it;return at},getQualityFor:j,getAbandonmentStateFor:function(nt,rt){return Et[nt]&&Et[nt][rt]?Et[nt][rt].state:null},setPlaybackQuality:H,checkPlaybackQuality:function(rt,at){try{if(!(rt&&ht&&ht[at]&&ht[at][rt]))return!1;if($t){var st=Ot.getPlaybackQuality();st&&$t.push(at,jt,st)}if(!an.get().streaming.abr.autoSwitchBitrate[rt])return!1;var ot=j(rt,at),lt=cs(hn).create({abrController:nt,switchHistory:Kt[at][rt],droppedFramesHistory:$t,streamProcessor:ht[at][rt],currentValue:ot,useBufferOccupancyABR:Wt[rt],useL2AABR:Qt[rt],useLoLPABR:en[rt],videoModel:Ot}),ct=Y(rt,at),dt=q(rt,at),pt=it.getMaxQuality(lt),_t=pt.quality;return void 0!==ct&&(_t>ds.Z.NO_CHANGE?_t:ot)<ct&&(_t=ct),_t>dt&&(_t=dt),Kt[at][rt].push({oldValue:ot,newValue:_t}),_t>ds.Z.NO_CHANGE&&_t!==ot&&(Et[at][rt].state===ut.Z.ALLOW_LOAD||_t<ot)&&(V(rt,ot,_t,dt,pt.reason,at),!0)}catch(nt){return!1}},setElementSize:Q,setWindowResizeEventCalled:function(nt){wt=nt},registerStreamType:function(nt,rt){var it=rt.getStreamInfo().id;ht[it]||(ht[it]={}),Kt[it]||(Kt[it]={}),Et[it]||(Et[it]={}),Kt[it][nt]=hs(hn).create(),ht[it][nt]=rt,Et[it][nt]={},Et[it][nt].state=ut.Z.ALLOW_LOAD,function(nt){var rt=an.get().streaming.abr.ABRStrategy;rt===ot.Z.ABR_STRATEGY_L2A?(Wt[nt]=!1,en[nt]=!1,Qt[nt]=!0):rt===ot.Z.ABR_STRATEGY_LoLP?(Wt[nt]=!1,en[nt]=!0,Qt[nt]=!1):rt===ot.Z.ABR_STRATEGY_BOLA?(Wt[nt]=!0,en[nt]=!1,Qt[nt]=!1):rt===ot.Z.ABR_STRATEGY_THROUGHPUT?(Wt[nt]=!1,en[nt]=!1,Qt[nt]=!1):rt===ot.Z.ABR_STRATEGY_DYNAMIC&&(Wt[nt]=!(!Wt||!Wt[nt])&&Wt[nt],en[nt]=!1,Qt[nt]=!1)}(nt),nt===ot.Z.VIDEO&&Q()},unRegisterStreamType:function(nt,rt){try{ht[nt]&&ht[nt][rt]&&delete ht[nt][rt],Kt[nt]&&Kt[nt][rt]&&delete Kt[nt][rt],Et[nt]&&Et[nt][rt]&&delete Et[nt][rt]}catch(nt){}},setConfig:function(nt){nt&&(nt.streamController&&(at=nt.streamController),nt.domStorage&&(Ht=nt.domStorage),nt.mediaPlayerModel&&(Ft=nt.mediaPlayerModel),nt.customParametersModel&&(Bt=nt.customParametersModel),nt.cmsdModel&&(Gt=nt.cmsdModel),nt.dashMetrics&&(nn=nt.dashMetrics),nt.adapter&&(Pt=nt.adapter),nt.videoModel&&(Ot=nt.videoModel),nt.settings&&(an=nt.settings))},reset:function(){U(),pn.off(dt.Z.LOADING_PROGRESS,Z,nt),pn.off(_t.Z.QUALITY_CHANGE_RENDERED,B,nt),pn.off(_t.Z.METRIC_ADDED,G,nt),it&&it.reset()}},rt=fn.getLogger(nt),U(),nt}Ei.__dashjs_factory_name="AbrController";var ms=ht.Z.getSingletonFactory(Ei);ms.QUALITY_DEFAULT=0,ht.Z.updateSingletonFactory(Ei.__dashjs_factory_name,ms);var gs=ms,_s=new Map([[ot.Z.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,"loadedmetadata"],[ot.Z.VIDEO_ELEMENT_READY_STATES.HAVE_CURRENT_DATA,"loadeddata"],[ot.Z.VIDEO_ELEMENT_READY_STATES.HAVE_FUTURE_DATA,"canplay"],[ot.Z.VIDEO_ELEMENT_READY_STATES.HAVE_ENOUGH_DATA,"canplaythrough"]]);function Si(){var nt,rt,it,at,st,lt,ut,ht,_t=this.context,Et=(0,ct.Z)(_t).getInstance(),St=[];function p(){it&&(it.playbackRate=1,it.removeEventListener("canplay",p))}function m(){return St.length>0}function y(){if(it&&m()&&0===it.playbackRate){var nt=document.createEvent("Event");nt.initEvent("waiting",!0,!1),it.dispatchEvent(nt)}}function E(nt,rt){it&&it.addEventListener(nt,rt)}function v(nt,rt){it&&it.removeEventListener(nt,rt)}function _(){return it?it.readyState:NaN}function T(){return it?it.buffered:null}function S(nt,rt,at,st,ot){if(it)for(var lt=0;lt<it.textTracks.length;lt++)if(it.textTracks[lt].kind===nt&&(!rt||it.textTracks[lt].label==rt)&&it.textTracks[lt].language===at&&it.textTracks[lt].isTTML===st&&it.textTracks[lt].isEmbedded===ot)return it.textTracks[lt];return null}function b(nt,rt){return nt===ot.Z.VIDEO_ELEMENT_READY_STATES.HAVE_NOTHING||_()>=nt?(rt(),null):function(nt,rt){var it=function n(){v(nt,n),rt(nt)};return E(nt,it),{func:it,event:nt}}(_s.get(nt),rt)}return nt={addEventListener:E,addTextTrack:function(nt,rt,at,st,ot){if(!it)return null;var lt=S(nt,rt,at,st,ot);return lt||((lt=it.addTextTrack(nt,rt,at)).isEmbedded=ot,lt.isTTML=st),lt},appendChild:function(nt){it&&(it.appendChild(nt),void 0!==nt.isTTML&&(it.textTracks[it.textTracks.length-1].isTTML=nt.isTTML,it.textTracks[it.textTracks.length-1].isEmbedded=nt.isEmbedded))},getBufferRange:T,getClientHeight:function(){return it?it.clientHeight:NaN},getClientWidth:function(){return it?it.clientWidth:NaN},getElement:function(){return it},getEnded:function(){return it?it.ended:null},getPlaybackQuality:function(){if(!it)return null;var nt="webkitDroppedFrameCount"in it&&"webkitDecodedFrameCount"in it,rt=null;return"getVideoPlaybackQuality"in it?rt=it.getVideoPlaybackQuality():nt&&(rt={droppedVideoFrames:it.webkitDroppedFrameCount,totalVideoFrames:it.webkitDroppedFrameCount+it.webkitDecodedFrameCount,creationTime:new Date}),rt},getPlaybackRate:function(){return it?it.playbackRate:null},getPlayedRanges:function(){return it?it.played:null},getReadyState:_,getSource:function(){return it?it.src:null},getTTMLRenderingDiv:function(){return lt},getTextTrack:S,getTextTracks:function(){return it?it.textTracks:[]},getTime:function(){return it?isNaN(at)?it.currentTime:at:null},getVideoHeight:function(){return it?it.videoHeight:NaN},getVideoRelativeOffsetLeft:function(){if(it){var nt=it.parentNode.host||it.parentNode;return nt?it.getBoundingClientRect().left-nt.getBoundingClientRect().left:NaN}return NaN},getVideoRelativeOffsetTop:function(){if(it){var nt=it.parentNode.host||it.parentNode;return nt?it.getBoundingClientRect().top-nt.getBoundingClientRect().top:NaN}return NaN},getVideoWidth:function(){return it?it.videoWidth:NaN},getVttRenderingDiv:function(){return ut},initialize:function(){Et.on(dt.Z.PLAYBACK_PLAYING,y,this)},isPaused:function(){return it?it.paused:null},isSeeking:function(){return it?it.seeking||!isNaN(at):null},isStalled:m,pause:function(){it&&(it.pause(),it.autoplay=!1)},play:function(){if(it){it.autoplay=!0;var nt=it.play();nt&&nt.catch&&"undefined"!=typeof Promise&&nt.catch((function(nt){"NotAllowedError"===nt.name&&Et.trigger(dt.Z.PLAYBACK_NOT_ALLOWED),rt.warn("Caught pending play exception - continuing (".concat(nt,")"))}))}},removeChild:function(nt){it&&it.removeChild(nt)},removeEventListener:v,reset:function(){clearTimeout(ht),Et.off(dt.Z.PLAYBACK_PLAYING,y,this)},setCurrentTime:function(nt,rt){it&&(st&&st.func&&st.event&&v(st.event,st.func),at=nt,st=b(ot.Z.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,(function(){if(it)if(it.currentTime!==at)try{at=rt?function(nt){var rt=T(),it=nt,at=9999999999;if(rt)for(var st=0;st<rt.length;st++){var ot=rt.start(st),lt=rt.end(st),ut=Math.abs(ot-nt),ct=Math.abs(lt-nt);if(nt>=ot&&nt<=lt)return nt;ut<at&&(at=ut,it=ot),ct<at&&(at=ct,it=lt)}return it}(at):at,isNaN(at)||(it.currentTime=at),at=NaN}catch(nt){0===it.readyState&&nt.code===nt.INVALID_STATE_ERR&&(ht=setTimeout((function(){it.currentTime=at,at=NaN}),400))}else at=NaN})))},setElement:function(nt){if(!(null==nt||nt&&/^(VIDEO|AUDIO)$/i.test(nt.nodeName)))throw"element is not video or audio DOM type!";(it=nt)&&(it.preload="auto")},setPlaybackRate:function(nt){it&&(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&it.readyState<=2&&nt>0?it.addEventListener("canplay",p):it.playbackRate=nt)},setSource:function(nt){it&&(nt?it.src=nt:(it.removeAttribute("src"),it.load()))},setStallState:function(nt,rt){!function(nt,rt){rt?function(nt){null!==nt&&it&&!it.seeking&&-1===St.indexOf(nt)&&St.push(nt)}(nt):function(nt){var rt=St.indexOf(nt);null!==nt&&-1!==rt&&St.splice(rt,1)}(nt)}(nt,rt)},setTTMLRenderingDiv:function(nt){(lt=nt).style.position="absolute",lt.style.display="flex",lt.style.overflow="hidden",lt.style.pointerEvents="none",lt.style.top=0,lt.style.left=0},setVttRenderingDiv:function(nt){ut=nt},waitForReadyState:b,setDisableRemotePlayback:function(nt){it&&(it.disableRemotePlayback=nt)}},rt=(0,pt.Z)(_t).getInstance().getLogger(nt),at=NaN,nt}Si.__dashjs_factory_name="VideoModel";var ys=ht.Z.getSingletonFactory(Si),vs=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],Es="dashjs_?_bitrate",Ts="dashjs_?_settings",Ss="localStorage",bs="lastBitrate",As="lastMediaSettings";function Di(nt){nt=nt||{};var rt,it,at,st=this.context,lt=nt.settings;function s(nt){if(void 0!==at)return at;var rt;at=!1;try{"undefined"!=typeof window&&(rt=window[nt])}catch(nt){return it.warn("DOMStorage access denied: "+nt.message),at}if(!rt||nt!==Ss)return at;try{rt.setItem("1","1"),rt.removeItem("1"),at=!0}catch(nt){it.warn("DOMStorage is supported, but cannot be used: "+nt.message)}return at}function u(){var nt=6e5;return Math.round((new Date).getTime()/nt)*nt}function l(nt,rt){return s(nt)&&lt.get().streaming[rt+"CachingInfo"].enabled}function c(){if(!lt)throw new Error(ot.Z.MISSING_CONFIG_ERROR)}return rt={getSavedBitrateSettings:function(nt){if(c(),!lt.get().streaming.lastBitrateCachingInfo.enabled)return NaN;var rt=NaN;if(l(Ss,bs)){var at=Es.replace(/\?/,nt);try{var st=JSON.parse(localStorage.getItem(at))||{},ot=(new Date).getTime()-parseInt(st.timestamp,10)>=lt.get().streaming.lastBitrateCachingInfo.ttl||!1,ut=parseFloat(st.bitrate);isNaN(ut)||ot?ot&&localStorage.removeItem(at):(rt=ut,it.debug("Last saved bitrate for "+nt+" was "+ut))}catch(nt){return null}}return rt},setSavedBitrateSettings:function(nt,rt){if(l(Ss,bs)&&rt){var at=Es.replace(/\?/,nt);try{localStorage.setItem(at,JSON.stringify({bitrate:rt.toFixed(3),timestamp:u()}))}catch(nt){it.error(nt.message)}}},getSavedMediaSettings:function(nt){if(c(),!lt.get().streaming.lastMediaSettingsCachingInfo.enabled)return null;var rt=null;if(l(Ss,As)){var it=Ts.replace(/\?/,nt);try{var at=JSON.parse(localStorage.getItem(it))||{},st=(new Date).getTime()-parseInt(at.timestamp,10)>=lt.get().streaming.lastMediaSettingsCachingInfo.ttl||!1;rt=at.settings,st&&(localStorage.removeItem(it),rt=null)}catch(nt){return null}}return rt},setSavedMediaSettings:function(nt,rt){if(l(Ss,As)){var at=Ts.replace(/\?/,nt);try{localStorage.setItem(at,JSON.stringify({settings:rt,timestamp:u()}))}catch(nt){it.error(nt.message)}}}},it=(0,pt.Z)(st).getInstance().getLogger(rt),s(Ss)&&vs.forEach((function(nt){var rt=localStorage.getItem(nt.oldKey);if(rt){localStorage.removeItem(nt.oldKey);try{localStorage.setItem(nt.newKey,rt)}catch(nt){it.error(nt.message)}}})),rt}Di.__dashjs_factory_name="DOMStorage";var Rs=ht.Z.getSingletonFactory(Di),Is=it(2032),ws=it(2011);function Li(){var nt,rt,it,at,st,ot,lt,ut,ct,dt,ht,pt,_t,Et=this.context;function h(nt,it,st,ot){var lt=null,ct=nt?_t.resolve(nt.path):null,dt=ot||{init:!0,url:ct?ct.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,mediaType:it};rt.debug("Start searching for initialization.");var ht=E(dt);ut.load({request:ht,success:function(rt){if(dt.bytesLoaded=dt.range.end,!(lt=at.findInitRange(rt)))return dt.range.end=dt.bytesLoaded+dt.bytesToLoad,h(nt,it,st,dt);nt.range=lt,st(nt)},error:function(){st(nt)}}),rt.debug("Perform init search: "+dt.url)}function m(nt,it,st,ot,lt,ct){if(st&&(void 0===st.start||void 0===st.end)){var dt=st?st.toString().split("-"):null;st=dt?{start:parseFloat(dt[0]),end:parseFloat(dt[1])}:null}lt=lt||y;var ht=null,pt=null,Et=!!st,St=nt?_t.resolve(nt.path):null,wt={init:!1,url:St?St.url:void 0,range:Et?st:{start:0,end:1500},searching:!Et,bytesLoaded:ct?ct.bytesLoaded:0,bytesToLoad:1500,mediaType:it},Lt=E(wt);ut.load({request:Lt,success:function(st){var ut=wt.bytesToLoad,ct=st.byteLength;if(wt.bytesLoaded=wt.range.end-wt.range.start,ht=at.parse(st),(pt=ht.getBox("sidx"))&&pt.isComplete){var dt,_t,Et=pt.references;if(null!=Et&&Et.length>0&&(dt=1===Et[0].reference_type),dt){var St,Lt,Ct,Pt;rt.debug("Initiate multiple SIDX load."),wt.range.end=wt.range.start+pt.size;var kt=[],Ot=0,Ft=(pt.offset||wt.range.start)+pt.size,b=function(rt){rt?(kt=kt.concat(rt),++Ot>=Lt&&(kt.sort((function(nt,rt){return nt.startTime-rt.startTime<0?-1:0})),lt(kt,nt,ot))):lt(null,nt,ot)};for(St=0,Lt=Et.length;St<Lt;St++)Ct=Ft,Pt=Ft+Et[St].referenced_size-1,Ft+=Et[St].referenced_size,m(nt,it,{start:Ct,end:Pt},ot,b,wt)}else rt.debug("Parsing segments from SIDX. representation "+it+" - id: "+nt.id+" for range : "+wt.range.start+" - "+wt.range.end),_t=function(nt,rt){for(var it,at,st,ot,lt=nt.references,ut=lt.length,ct=nt.timescale,dt=nt.earliest_presentation_time,ht=rt.range.start+nt.offset+nt.first_offset+nt.size,pt=[],_t=0;_t<ut;_t++)st=lt[_t].subsegment_duration,ot=lt[_t].referenced_size,(it=new ws.Z).duration=st,it.startTime=dt,it.timescale=ct,at=ht+ot-1,it.mediaRange=ht+"-"+at,pt.push(it),dt+=st,ht+=ot;return pt}(pt,wt),lt(_t,nt,ot)}else{if(pt)wt.range.start=pt.offset||wt.range.start,wt.range.end=wt.range.start+(pt.size||ut);else{if(ct<wt.bytesLoaded)return void lt(null,nt,ot);var Bt=ht.getLastBox();Bt&&Bt.size?(wt.range.start=Bt.offset+Bt.size,wt.range.end=wt.range.start+ut):wt.range.end+=ut}m(nt,it,wt.range,ot,null,wt)}},error:function(){lt(null,nt,ot)}}),rt.debug("Perform SIDX load for type ".concat(it," : ").concat(wt.url," with range ").concat(wt.range.start," - ").concat(wt.range.end))}function y(nt,rt,it){it({segments:nt,representation:rt,error:nt?void 0:new Ot.Z(ct.SEGMENT_BASE_LOADER_ERROR_CODE,ct.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}function E(nt){if(nt.url){var rt=new St.Z;return rt.setInfo(nt),rt}}return nt={setConfig:function(ut){ut.baseURLController&&(_t=ut.baseURLController),ut.dashMetrics&&(ot=ut.dashMetrics),ut.mediaPlayerModel&&(lt=ut.mediaPlayerModel),ut.errHandler&&(it=ut.errHandler),ut.boxParser&&(at=ut.boxParser),ut.debug&&(rt=ut.debug.getLogger(nt)),ut.requestModifier&&(st=ut.requestModifier),ut.errors&&(ct=ut.errors),ut.urlUtils&&(pt=ut.urlUtils),ut.constants&&(dt=ut.constants),ut.dashConstants&&(ht=ut.dashConstants)},initialize:function(){ut=ci(Et).create({errHandler:it,dashMetrics:ot,mediaPlayerModel:lt,requestModifier:st,boxParser:at,errors:ct,urlUtils:pt,constants:dt,dashConstants:ht})},loadInitialization:function(nt,rt){return new Promise((function(it){h(nt,rt,it)}))},loadSegments:function(nt,rt,it){return new Promise((function(at){m(nt,rt,it,at)}))},reset:function(){ut&&(ut.abort(),ut=null)}}}Li.__dashjs_factory_name="SegmentBaseLoader";var Ls=ht.Z.getSingletonFactory(Li);function xi(nt){var rt;nt=nt||{};var it=new DataView(nt.data),at=0;function i(nt,rt){var st=!0,ot=0;if(void 0===rt&&(rt=!1),nt.tag>16777215?(it.getUint32(at)!==nt.tag&&(st=!1),ot=4):nt.tag>65535?(256*it.getUint16(at)+it.getUint8(at+2)!==nt.tag&&(st=!1),ot=3):nt.tag>255?(it.getUint16(at)!==nt.tag&&(st=!1),ot=2):(it.getUint8(at)!==nt.tag&&(st=!1),ot=1),!st&&nt.required&&!rt)throw new Error("required tag not found");return st&&(at+=ot),st}function a(nt){var rt=1,st=128,ot=-1,lt=0,ut=it.getUint8(at),ct=0;for(ct=0;ct<8;ct+=1){if((ut&st)===st){lt=void 0===nt?ut&~st:ut,ot=ct;break}st>>=1}for(ct=0;ct<ot;ct+=1,rt+=1)lt=lt<<8|255&it.getUint8(at+rt);return at+=rt,lt}return rt={getPos:function(){return at},setPos:function(nt){at=nt},consumeTag:i,consumeTagAndSize:function(nt,rt){var it=i(nt,rt);return it&&a(),it},parseTag:function(nt){var it;return i(nt),it=a(),rt[nt.parse](it)},skipOverElement:function(nt,rt){var it,st=i(nt,rt);return st&&(it=a(),at+=it),st},getMatroskaCodedNum:a,getMatroskaFloat:function(nt){var rt;switch(nt){case 4:rt=it.getFloat32(at),at+=4;break;case 8:rt=it.getFloat64(at),at+=8}return rt},getMatroskaUint:function(nt){if(nt>4)return function(nt){for(var rt=Math.floor(Number.MAX_SAFE_INTEGER/256),st=0,ot=0;ot<nt;ot+=1){if(st>rt)throw new Error("Value exceeds safe integer limit");st*=256;var lt=it.getUint8(at+ot);if(st>Number.MAX_SAFE_INTEGER-lt)throw new Error("Value exceeds safe integer limit");st+=lt}return at+=nt,st}(nt);for(var rt=0,st=0;st<nt;st+=1)rt<<=8,rt|=255&it.getUint8(at+st);return at+=nt,rt>>>0},moreData:function(){return at<it.byteLength}}}xi.__dashjs_factory_name="EBMLParser";var Cs=ht.Z.getClassFactory(xi);function Ui(){var nt,rt,it,at,st,lt,ut,ct,dt,ht,pt=this.context;function d(nt){var rt=new St.Z;return rt.setInfo(nt),rt}return nt={setConfig:function(it){if(!(it.baseURLController&&it.dashMetrics&&it.mediaPlayerModel&&it.errHandler))throw new Error(ot.Z.MISSING_CONFIG_ERROR);ht=it.baseURLController,lt=it.dashMetrics,ut=it.mediaPlayerModel,at=it.errHandler,dt=it.errors,rt=it.debug.getLogger(nt),st=it.requestModifier},initialize:function(){ct=ci(pt).create({errHandler:at,dashMetrics:lt,mediaPlayerModel:ut,requestModifier:st,errors:dt})},loadInitialization:function(nt,it){return new Promise((function(at){var st=null,ot=nt?ht.resolve(nt.path):null,lt=nt?nt.range.split("-"):null,ut={range:{start:lt?parseFloat(lt[0]):null,end:lt?parseFloat(lt[1]):null},request:st,url:ot?ot.url:void 0,init:!0,mediaType:it};rt.info("Start loading initialization."),st=d(ut),ct.load({request:st,success:function(){at(nt)},error:function(){at(nt)}}),rt.debug("Perform init load: "+ut.url)}))},loadSegments:function(nt,at,st){return new Promise((function(ot){var lt=null,ut=nt?ht.resolve(nt.path):null,_t=ut?ut.url:void 0;lt=d({bytesLoaded:0,bytesToLoad:8192,range:{start:0,end:8192},request:lt,url:_t,init:!1,mediaType:at}),rt.debug("Parsing ebml header"),ct.load({request:lt,success:function(at){!function(nt,at,st,ot){if(nt&&0!==nt.byteLength){var lt,ut,dt,ht,_t=Cs(pt).create({data:nt}),Et=st?st.split("-"):null,St=null,wt={url:at,range:{start:Et?parseFloat(Et[0]):null,end:Et?parseFloat(Et[1]):null},request:St};for(rt.debug("Parse EBML header: "+wt.url),_t.skipOverElement(it.EBML),_t.consumeTag(it.Segment),dt=_t.getMatroskaCodedNum(),dt+=_t.getPos(),ht=_t.getPos();_t.moreData()&&!_t.consumeTagAndSize(it.Segment.Info,!0);)if(!(_t.skipOverElement(it.Segment.SeekHead,!0)||_t.skipOverElement(it.Segment.Tracks,!0)||_t.skipOverElement(it.Segment.Cues,!0)||_t.skipOverElement(it.Void,!0)))throw new Error("no valid top level element found");for(;void 0===lt;){var Lt=_t.getMatroskaCodedNum(!0),Ct=_t.getMatroskaCodedNum();Lt===it.Segment.Info.Duration.tag?lt=_t[it.Segment.Info.Duration.parse](Ct):_t.setPos(_t.getPos()+Ct)}St=d(wt),ct.load({request:St,success:function(nt){ut=function(nt,at,st,ot){var lt,ut,ct,dt,ht,_t,Et,St;for(ct=[],ht=0,_t=(ut=function(nt){var rt,at,st=[],ot=Cs(pt).create({data:nt});for(ot.consumeTagAndSize(it.Segment.Cues);ot.moreData()&&ot.consumeTagAndSize(it.Segment.Cues.CuePoint,!0);){for((rt={}).CueTime=ot.parseTag(it.Segment.Cues.CuePoint.CueTime),rt.CueTracks=[];ot.moreData()&&ot.consumeTag(it.Segment.Cues.CuePoint.CueTrackPositions,!0);){var lt=ot.getMatroskaCodedNum(),ut=ot.getPos();if((at={}).Track=ot.parseTag(it.Segment.Cues.CuePoint.CueTrackPositions.CueTrack),0===at.Track)throw new Error("Cue track cannot be 0");at.ClusterPosition=ot.parseTag(it.Segment.Cues.CuePoint.CueTrackPositions.CueClusterPosition),rt.CueTracks.push(at),ot.setPos(ut+lt)}if(0===rt.CueTracks.length)throw new Error("Mandatory cuetrack not found");st.push(rt)}if(0===st.length)throw new Error("mandatory cuepoint not found");return st}(nt)).length;ht<_t;ht+=1)dt=new ws.Z,lt=ht<ut.length-1?ut[ht+1].CueTime-ut[ht].CueTime:ot-ut[ht].CueTime,dt.duration=lt,dt.startTime=ut[ht].CueTime,dt.timescale=1e3,Et=ut[ht].CueTracks[0].ClusterPosition+at,St=ht<ut.length-1?ut[ht+1].CueTracks[0].ClusterPosition+at-1:st-1,dt.mediaRange=Et+"-"+St,ct.push(dt);return rt.debug("Parsed cues: "+ct.length+" cues."),ct}(nt,ht,dt,lt),ot(ut)},error:function(){rt.error("Download Error: Cues "+wt.url),ot(null)}}),rt.debug("Perform cues load: "+wt.url+" bytes="+wt.range.start+"-"+wt.range.end)}else ot(null)}(at,_t,st,(function(rt){ot({segments:rt,representation:nt,error:rt?void 0:new Ot.Z(dt.SEGMENT_BASE_LOADER_ERROR_CODE,dt.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}))},error:function(){ot({representation:nt,error:new Ot.Z(dt.SEGMENT_BASE_LOADER_ERROR_CODE,dt.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}})}))},reset:function(){ct&&(ct.abort(),ct=null)}},it={EBML:{tag:440786851,required:!0},Segment:{tag:408125543,required:!0,SeekHead:{tag:290298740,required:!0},Info:{tag:357149030,required:!0,TimecodeScale:{tag:2807729,required:!0,parse:"getMatroskaUint"},Duration:{tag:17545,required:!0,parse:"getMatroskaFloat"}},Tracks:{tag:374648427,required:!0},Cues:{tag:475249515,required:!0,CuePoint:{tag:187,required:!0,CueTime:{tag:179,required:!0,parse:"getMatroskaUint"},CueTrackPositions:{tag:183,required:!0,CueTrack:{tag:247,required:!0,parse:"getMatroskaUint"},CueClusterPosition:{tag:241,required:!0,parse:"getMatroskaUint"}}}}},Void:{tag:236,required:!0}},nt}Ui.__dashjs_factory_name="WebmSegmentBaseLoader";var Ds=ht.Z.getSingletonFactory(Ui);function Bi(nt){nt=nt||{};var rt,it,at,st=this.context,ot=nt.eventBus,lt=nt.events,ut=nt.dashMetrics,ct=nt.mediaPlayerModel,dt=nt.errHandler,ht=nt.baseURLController,pt=nt.debug,_t=nt.boxParser,Et=nt.requestModifier,St=nt.errors;function p(nt){return"webm"===(nt?nt.split("/")[1]:"").toLowerCase()}return rt={initialize:function(){it.initialize(),at.initialize()},getSegmentBaseInitSegment:function(nt){return p(nt.representation.mimeType)?at.loadInitialization(nt.representation,nt.mediaType):it.loadInitialization(nt.representation,nt.mediaType)},getSegmentList:function(nt){return p(nt.mimeType)?at.loadSegments(nt.representation,nt.mediaType,nt.representation?nt.representation.indexRange:null):it.loadSegments(nt.representation,nt.mediaType,nt.representation?nt.representation.indexRange:null)},reset:function(){it.reset(),at.reset()}},it=Ls(st).getInstance(),at=Ds(st).getInstance(),it.setConfig({baseURLController:ht,dashMetrics:ut,mediaPlayerModel:ct,errHandler:dt,eventBus:ot,events:lt,errors:St,debug:pt,boxParser:_t,requestModifier:Et}),at.setConfig({baseURLController:ht,dashMetrics:ut,mediaPlayerModel:ct,errHandler:dt,eventBus:ot,events:lt,errors:St,debug:pt,requestModifier:Et}),rt}Bi.__dashjs_factory_name="SegmentBaseController";var Ms=ht.Z.getSingletonFactory(Bi),Ps=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.quality=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},ks=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.labels=null,this.lang=null,this.viewpoint=null,this.viewpointsWithSchemeIdUri=null,this.accessibility=null,this.accessibilitiesWithSchemeIdUri=null,this.audioChannelConfiguration=null,this.audioChannelConfigurationsWithSchemeIdUri=null,this.roles=null,this.rolesWithSchemeIdUri=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null,this.bitrateList=null,this.isFragmented=null,this.isEmbedded=null,this.selectionPriority=1,this.supplementalProperties={},this.supplementalPropertiesAsArray=[],this.essentialProperties={},this.essentialPropertiesAsArray=[],this.segmentAlignment=!1,this.subSegmentAlignment=!1},Ns=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0},Os=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.dvrWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null,this.serviceDescriptions=[],this.protocol=null};function Vi(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var xs=function(){function e(nt){var rt=this;!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.valid="/"==nt[0],this.path=nt.split("/").filter((function(nt){return 0!==nt.length})).map((function(nt){var it={name:nt},at=nt.indexOf("[");if(-1!=at){it.name=nt.substring(0,at);var st=nt.substring(at+1,nt.length-1);rt.valid=rt.valid&&-1==st.indexOf("[");var ot=st.indexOf("=");-1!=ot?(it.attribute={name:st.substring(1,ot),value:st.substring(ot+1)},-1!=["'",'"'].indexOf(it.attribute.value[0])&&(it.attribute.value=it.attribute.value.substring(1,it.attribute.value.length-1))):it.position=parseInt(st,10)-1}return it}))}var nt;return(nt=[{key:"isValid",value:function(){return this.valid}},{key:"findsElement",value:function(){return!this.findsAttribute()}},{key:"findsAttribute",value:function(){return this.path[this.path.length-1].name.startsWith("@")}},{key:"findsTextReplace",value:function(){return"text()"===this.path[this.path.length-1].name}},{key:"getMpdTarget",value:function(nt,rt){for(var it=null,at=nt,st=1,ot="MPD";st<this.path.length&&null!==at;){it=at;var lt=this.path[st];if(ot=lt.name,st!==this.path.length-1||!ot.startsWith("@")&&"text()"!==ot){var ut=it[ot+"_asArray"]||[];0===ut.length&&it[ot]&&ut.push(it[ot]),lt.position?at=ut[lt.position]||null:lt.attribute?function(){var nt=lt.attribute;at=ut.filter((function(rt){return rt[nt.name]==nt.value}))[0]||null}():at=ut[0]||null}st++}return null===at?null:ot.startsWith("@")?{name:ot.substring(1),leaf:at,target:at}:"text()"===ot?{name:"__text",leaf:at,target:at}:{name:ot,leaf:at,target:rt?it:at}}}])&&Vi(e.prototype,nt),e}();function zi(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var Fs=function(){function e(nt,rt,it){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=nt,this.xpath=rt,this.value=it,this.position=null}var nt;return(nt=[{key:"getMpdTarget",value:function(nt){var rt="remove"===this.action||"replace"===this.action||"before"===this.position||"after"===this.position;return this.xpath.getMpdTarget(nt,rt)}}])&&zi(e.prototype,nt),e}();function Xi(){var nt,rt,it=this.context;return nt={getIsPatch:function(nt){return nt&&nt.hasOwnProperty(lt.Z.ORIGINAL_MPD_ID)||!1},getPublishTime:function(nt){return nt&&nt.hasOwnProperty(lt.Z.PUBLISH_TIME)?new Date(nt[lt.Z.PUBLISH_TIME]):null},getOriginalPublishTime:function(nt){return nt&&nt.hasOwnProperty(lt.Z.ORIGINAL_PUBLISH_TIME)?new Date(nt[lt.Z.ORIGINAL_PUBLISH_TIME]):null},getMpdId:function(nt){return nt&&nt[lt.Z.ORIGINAL_MPD_ID]||null},getPatchOperations:function(nt){return nt?(nt.__children||[]).map((function(nt){var it=Object.keys(nt)[0];if("add"!==it&&"remove"!==it&&"replace"!==it)return rt.warn("Ignoring node of invalid action: ".concat(it)),null;var at=nt[it],st=at.sel;if("add"===it&&at.type){if(!at.type.startsWith("@"))return rt.warn("Ignoring add action for prefixed namespace declaration: ".concat(at.type,"=").concat(at.__text)),null;st="".concat(st,"/").concat(at.type)}var ot=new xs(st);if(!ot.isValid())return rt.warn("Ignoring action with invalid selector: ".concat(it," - ").concat(st)),null;var lt=null;ot.findsAttribute()||ot.findsTextReplace()?lt=at.__text||"":"remove"!==it&&(lt=at.__children.reduce((function(nt,rt){var it=Object.keys(rt)[0];return"#text"!==it&&(nt[it]=nt[it]||[],nt[it].push(rt[it])),nt}),{}));var ut=new Fs(it,ot,lt);return"add"===it&&(ut.position=at.pos),ut})).filter((function(nt){return!!nt})):[]}},rt=(0,pt.Z)(it).getInstance().getLogger(nt),nt}Xi.__dashjs_factory_name="PatchManifestModel";var Bs=ht.Z.getSingletonFactory(Xi);function Ji(){var nt,rt,it,at,st,ot,ut,ct=this.context;function l(nt,it,ot){var ut,ct=rt.getAdaptationsForType(at[0].mpd.manifest,nt,it);if(!ct||0===ct.length)return null;if(ct.length>1&&ot){var dt=d(ot,it);if(st[ot.id]&&st[ot.id][it])for(var ht=0,pt=ct.length;ht<pt;ht++)if(c(st[ot.id][it],dt[ht]))return ct[ht];for(var _t=0,Et=ct.length;_t<Et;_t++)if(ut=ct[_t],rt.getRolesForAdaptation(ut).filter((function(nt){return nt.value===lt.Z.MAIN}))[0])return ct[_t]}return ct[0]}function c(nt,rt){if(!nt||!rt)return!1;var it=nt.id===rt.id,at=nt.codec===rt.codec,st=nt.viewpoint===rt.viewpoint,ot=JSON.stringify(nt.viewpointsWithSchemeIdUri)===JSON.stringify(rt.viewpointsWithSchemeIdUri),lt=nt.lang===rt.lang,ut=nt.roles.toString()===rt.roles.toString(),ct=JSON.stringify(nt.rolesWithSchemeIdUri)===JSON.stringify(rt.rolesWithSchemeIdUri),dt=nt.accessibility.toString()===rt.accessibility.toString(),ht=JSON.stringify(nt.accessibilitiesWithSchemeIdUri)===JSON.stringify(rt.accessibilitiesWithSchemeIdUri),pt=nt.audioChannelConfiguration.toString()===rt.audioChannelConfiguration.toString(),_t=JSON.stringify(nt.audioChannelConfigurationsWithSchemeIdUri)===JSON.stringify(rt.audioChannelConfigurationsWithSchemeIdUri);return it&&at&&st&&ot&&lt&&ut&&ct&&dt&&ht&&pt&&_t}function f(nt,it,at,st,lt,ut){var ct,dt,ht,pt,_t,Et,St=[];if(!st||0===st.length)return[];var wt=rt.getAdaptationsForPeriod(it);for(pt=0,Et=st.length;pt<Et;pt++)if(ct=st[pt],dt=v(wt[ht=rt.getIndexForAdaptation(ct,nt,at.index)]),ut){var Lt=dt.accessibility.length;for(_t=0;_t<Lt;_t++)if(dt){var Ct=dt.accessibility[_t];if(0===Ct.indexOf("cea-608:")){var Pt=Ct.substring(8).split(";");if("CC"===Pt[0].substring(0,2))for(_t=0;_t<Pt.length;_t++)dt||(dt=v.call(this,wt[ht])),_(dt,Pt[_t].substring(0,3),Pt[_t].substring(4)),St.push(dt),dt=null;else for(_t=0;_t<Pt.length;_t++)dt||(dt=v.call(this,wt[ht])),_(dt,"CC"+(_t+1),Pt[_t]),St.push(dt),dt=null}else 0===Ct.indexOf("cea-608")&&(_(dt,ot.CC1,"eng"),St.push(dt),dt=null)}}else lt===ot.IMAGE?(dt.type=ot.IMAGE,St.push(dt),dt=null):dt&&St.push(dt);return St}function d(nt,it,st){var lt=at,ut=st,ct=[];if(ut)S(),lt=g(ut);else{if(!(at.length>0))return ct;ut=at[0].mpd.manifest}var dt=E(nt,lt),ht=rt.getAdaptationsForType(ut,nt?nt.index:null,it);return ct=f(ut,dt,nt,ht,it),it===ot.TEXT&&(ht=rt.getAdaptationsForType(ut,nt?nt.index:null,ot.VIDEO),ct=ct.concat(f(ut,dt,nt,ht,it,!0))),ct}function g(nt){var it=h(nt);return rt.getRegularPeriods(it)}function h(nt){var it=m(nt);return rt.getMpd(it)}function p(){at=[],st={}}function m(nt){return nt||(at.length>0?at[0].mpd.manifest:null)}function y(nt){try{var it=E(nt.streamInfo,at),st=rt.getAdaptationsForPeriod(it);return nt&&nt.streamInfo&&void 0!==nt.streamInfo.id&&st?st[nt.index]:null}catch(nt){return null}}function E(nt,rt){for(var it=rt.length,at=0;at<it;at++){var st=rt[at];if(nt&&nt.id===st.id)return st}return null}function v(nt){if(!nt)return null;var it,at,st,ot,lt,ct=new ks,dt=nt.period.mpd.manifest.Period_asArray[nt.period.index].AdaptationSet_asArray[nt.index];if(ct.id=nt.id,ct.index=nt.index,ct.type=nt.type,ct.streamInfo=T(nt.period),ct.representationCount=rt.getRepresentationCount(dt),ct.labels=rt.getLabelsForAdaptation(dt),ct.lang=rt.getLanguageForAdaptation(dt),ct.segmentAlignment=rt.getSegmentAlignment(dt),ct.subSegmentAlignment=rt.getSubSegmentAlignment(dt),it=rt.getViewpointForAdaptation(dt),ct.viewpoint=it.length?it[0].value:void 0,ct.viewpointsWithSchemeIdUri=it,lt=rt.getAccessibilityForAdaptation(dt),ct.accessibility=lt.map((function(nt){var rt=nt.value,it=rt;return nt.schemeIdUri&&nt.schemeIdUri.search("cea-608")>=0&&void 0!==ut&&(it=rt?"cea-608:"+rt:"cea-608",ct.embeddedCaptions=!0),it})),ct.accessibilitiesWithSchemeIdUri=lt,at=rt.getAudioChannelConfigurationForAdaptation(dt),ct.audioChannelConfiguration=at.map((function(nt){return nt.value})),ct.audioChannelConfigurationsWithSchemeIdUri=at,0===ct.audioChannelConfiguration.length&&Array.isArray(dt.Representation_asArray)&&dt.Representation_asArray.length>0&&(st=rt.getAudioChannelConfigurationForRepresentation(dt.Representation_asArray[0]),ct.audioChannelConfiguration=st.map((function(nt){return nt.value})),ct.audioChannelConfigurationsWithSchemeIdUri=st),ot=rt.getRolesForAdaptation(dt),ct.roles=ot.map((function(nt){return nt.value})),ct.rolesWithSchemeIdUri=ot,ct.codec=rt.getCodec(dt),ct.mimeType=rt.getMimeType(dt),ct.contentProtection=rt.getContentProtectionData(dt),ct.bitrateList=rt.getBitrateListForAdaptation(dt),ct.selectionPriority=rt.getSelectionPriority(dt),ct.contentProtection){var ht=ct.contentProtection.map((function(nt){return rt.getKID(nt)})).filter((function(nt){return null!==nt}));if(ht.length){var pt=ht[0];ct.contentProtection.forEach((function(nt){nt.keyId=pt}))}}if(ct.isText=rt.getIsText(dt),ct.supplementalProperties=rt.getSupplementalPropertiesForAdaptation(dt),(!ct.supplementalProperties||0===Object.keys(ct.supplementalProperties).length)&&Array.isArray(dt.Representation_asArray)&&dt.Representation_asArray.length>0){var _t=dt.Representation_asArray.map((function(nt){return rt.getSupplementalPropertiesForRepresentation(nt)}));_t.every((function(nt){return JSON.stringify(nt)===JSON.stringify(_t[0])}))&&(ct.supplementalProperties=_t[0])}if(ct.supplementalPropertiesAsArray=rt.getSupplementalPropertiesAsArrayForAdaptation(dt),(!ct.supplementalPropertiesAsArray||0===ct.supplementalPropertiesAsArray.length)&&Array.isArray(dt.Representation_asArray)&&dt.Representation_asArray.length>0){var Et=dt.Representation_asArray.map((function(nt){return rt.getSupplementalPropertiesAsArrayForRepresentation(nt)}));Et.every((function(nt){return JSON.stringify(nt)===JSON.stringify(Et[0])}))&&(ct.supplementalPropertiesAsArray=Et[0])}return ct.essentialProperties=rt.getEssentialPropertiesForAdaptation(dt),ct.essentialPropertiesAsArray=rt.getEssentialPropertiesAsArrayForAdaptation(dt),ct.isFragmented=rt.getIsFragmented(dt),ct.isEmbedded=!1,ct}function _(nt,rt,it){nt.id=rt,nt.index=100+parseInt(rt.substring(2,3)),nt.type=ot.TEXT,nt.codec="cea-608-in-SEI",nt.isEmbedded=!0,nt.isFragmented=!1;var at=ta()(it);nt.lang=at||it,nt.roles=["caption"],nt.rolesWithSchemeIdUri=[{schemeIdUri:"urn:mpeg:dash:role:2011",value:"caption"}]}function T(nt){var it,at,st=new Ns;return st.id=nt.id,st.index=nt.index,st.start=nt.start,st.duration=nt.duration,st.manifestInfo=(it=nt.mpd,(at=new Os).dvrWindowSize=it.timeShiftBufferDepth,at.loadedTime=it.manifest.loadedTime,at.availableFrom=it.availabilityStartTime,at.minBufferTime=it.manifest.minBufferTime,at.maxFragmentDuration=it.maxSegmentDuration,at.duration=rt.getDuration(it.manifest),at.isDynamic=rt.getIsDynamic(it.manifest),at.serviceDescriptions=rt.getServiceDescriptions(it.manifest),at.protocol=it.manifest.protocol,at),st.isLast=1===nt.mpd.manifest.Period_asArray.length||Math.abs(st.start+st.duration-st.manifestInfo.duration)<1,st}function S(){if(!ot)throw new Error("setConfig function has to be called previously")}function b(nt){return at.length>0?at[0].mpd.manifest.Period_asArray[nt]:null}function A(nt,rt,it){var at,st,ot,lt,ut;if(nt)for(at=nt.AdaptationSet_asArray,lt=0;lt<at.length;lt+=1)for(ot=at[lt].Representation_asArray,ut=0;ut<ot.length;ut+=1)if(rt===(st=ot[ut]).id)return it?ut:st;return null}return nt={getBandwidthForRepresentation:function(nt,rt){var it;return(it=A(b(rt),nt))?it.bandwidth:null},getIndexForRepresentation:function(nt,rt){return function(nt,rt){var it=A(nt,rt,!0);return null!==it?it:-1}(b(rt),nt)},getMaxIndexForBufferType:function(nt,it){return function(nt,it){var at,st,ot,lt;if(!nt||!it)return-1;for(st=nt.AdaptationSet_asArray,lt=0;lt<st.length;lt+=1)if(ot=(at=st[lt]).Representation_asArray,rt.getIsTypeOf(at,it))return ot.length;return-1}(b(it),nt)},convertRepresentationToRepresentationInfo:function(nt){if(nt){var it=new Ps,at=nt.adaptation.period.mpd.manifest.Period_asArray[nt.adaptation.period.index].AdaptationSet_asArray[nt.adaptation.index],st=rt.getRepresentationFor(nt.index,at);return it.id=nt.id,it.quality=nt.index,it.bandwidth=rt.getBandwidth(st),it.fragmentDuration=nt.segmentDuration||(nt.segments&&nt.segments.length>0?nt.segments[0].duration:NaN),it.MSETimeOffset=nt.MSETimeOffset,it.mediaInfo=v(nt.adaptation),it}return null},getStreamsInfo:function(nt,rt){var it=[],st=at;if(nt&&(S(),st=g(nt)),st.length>0){(!rt||rt>st.length)&&(rt=st.length);for(var ot=0;ot<rt;ot++)it.push(T(st[ot]))}return it},getMediaInfoForType:function(nt,it){if(0===at.length||!nt)return null;var st=E(nt,at);if(!st)return null;var ot=rt.getAdaptationsForPeriod(st),lt=l(nt.index,it,nt);return lt?v(ot[rt.getIndexForAdaptation(lt,at[0].mpd.manifest,nt.index)]):null},getAllMediaInfoForType:d,getAdaptationForType:l,getRealAdaptation:function(nt,it){var st,ot,lt=E(nt,at);return st=it?it.id:null,at.length>0&&lt&&(ot=st?rt.getAdaptationForId(st,at[0].mpd.manifest,lt.index):rt.getAdaptationForIndex(it?it.index:null,at[0].mpd.manifest,lt.index)),ot},getProducerReferenceTimes:function(nt,it){var st,ot,lt=E(nt,at);return st=it?it.id:null,at.length>0&&lt&&(ot=st?rt.getAdaptationForId(st,at[0].mpd.manifest,lt.index):rt.getAdaptationForIndex(it?it.index:null,at[0].mpd.manifest,lt.index)),ot?rt.getProducerReferenceTimesForAdaptation(ot):[]},getRealPeriodByIndex:function(nt){return rt.getRealPeriodForIndex(nt,at[0].mpd.manifest)},getEssentialPropertiesForRepresentation:function(nt){try{return rt.getEssentialPropertiesForRepresentation(nt)}catch(nt){return[]}},getVoRepresentations:function(nt){var it=y(nt);return rt.getRepresentationsForAdaptation(it)},getEventsFor:function(nt,it,st){var ot=[];if(at.length>0){var lt=at[0].mpd.manifest;if(nt instanceof Ns){var ut=E(nt,at);ot=rt.getEventsForPeriod(ut)}else if(nt instanceof ks){var ct=E(st,at);ot=rt.getEventStreamForAdaptationSet(lt,y(nt),ct)}else if(nt instanceof Ps){var dt=E(st,at);ot=rt.getEventStreamForRepresentation(lt,it,dt)}}return ot},getEvent:function(nt,rt,it,at){try{if(!nt||!rt||isNaN(it)||!at)return null;var st=nt.scheme_id_uri,ot=nt.value;if(!rt[st+"/"+ot])return null;var lt,ut=new Un,ct=nt.timescale||1,dt=at.adaptation.period.start,ht=rt[st+"/"+ot],pt=isNaN(at.presentationTimeOffset)?isNaN(ht.presentationTimeOffset)?0:ht.presentationTimeOffset:at.presentationTimeOffset,_t=nt.presentation_time_delta/ct;lt=0===nt.version?dt+it-pt+_t:dt-pt+_t;var Et=nt.event_duration/ct,St=nt.id,wt=nt.message_data;return ut.eventStream=ht,ut.eventStream.value=ot,ut.eventStream.timescale=ct,ut.duration=Et,ut.id=St,ut.calculatedPresentationTime=lt,ut.messageData=wt,ut.presentationTimeDelta=_t,ut}catch(nt){return null}},getMpd:h,setConfig:function(nt){nt&&(nt.constants&&(ot=nt.constants),nt.cea608parser&&(ut=nt.cea608parser),nt.errHandler&&rt.setConfig({errHandler:nt.errHandler}),nt.BASE64&&rt.setConfig({BASE64:nt.BASE64}))},updatePeriods:function(nt){if(!nt)return null;S(),at=g(nt)},getIsTextTrack:function(nt){return rt.getIsText(nt)},getUTCTimingSources:function(){var nt=m();return rt.getUTCTimingSources(nt)},getSuggestedPresentationDelay:function(){var nt=at.length>0?at[0].mpd:null;return rt.getSuggestedPresentationDelay(nt)},getAvailabilityStartTime:function(nt){var it=h(nt);return rt.getAvailabilityStartTime(it)},getIsTypeOf:function(nt,it){return rt.getIsTypeOf(nt,it)},getIsDynamic:function(nt){var it=m(nt);return rt.getIsDynamic(it)},getDuration:function(nt){var it=m(nt);return rt.getDuration(it)},getRegularPeriods:g,getContentSteering:function(nt){return rt.getContentSteering(nt)},getLocation:function(nt){return rt.getLocation(nt)},getPatchLocation:function(nt){var it=rt.getPatchLocation(nt),at=rt.getPublishTime(nt);return it&&0!==it.length&&at?it.filter((function(nt){return isNaN(nt.ttl)||at.getTime()+nt.ttl>(new Date).getTime()})):[]},getManifestUpdatePeriod:function(nt){var it=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return rt.getManifestUpdatePeriod(nt,it)},getPublishTime:function(nt){return rt.getPublishTime(nt)},getIsDVB:function(nt){return rt.hasProfile(nt,"urn:dvb:dash:profile:dvb-dash:2014")},getIsPatch:function(nt){return it.getIsPatch(nt)},getBaseURLsFromElement:function(nt){return rt.getBaseURLsFromElement(nt)},getRepresentationSortFunction:function(){return rt.getRepresentationSortFunction()},getCodec:function(nt,it,at){return rt.getCodec(nt,it,at)},getPeriodById:function(nt){if(!nt||0===at.length)return null;var rt=at.filter((function(rt){return rt.id===nt}));return rt&&rt.length>0?rt[0]:null},setCurrentMediaInfo:function(nt,rt,it){st[nt]=st[nt]||{},st[nt][rt]=st[nt][rt]||{},st[nt][rt]=it},isPatchValid:function(nt,at){var st=rt.getId(nt),ot=it.getMpdId(at),lt=rt.getPublishTime(nt),ut=it.getPublishTime(at),ct=it.getOriginalPublishTime(at);return!!(st&&ot&&st==ot&&lt&&ct&&lt.getTime()==ct.getTime()&&ut&&lt.getTime()<ut.getTime())},applyPatchToManifest:function(nt,rt){it.getPatchOperations(rt).forEach((function(rt){var it=rt.getMpdTarget(nt);if(null!==it){var at=it.name,st=it.target,ot=it.leaf;if(rt.xpath.findsAttribute()||"__text"===at)switch(rt.action){case"add":case"replace":st[at]=rt.value;break;case"remove":delete st[at]}else{var lt=(st[at+"_asArray"]||[]).indexOf(ot),ut="prepend"===rt.position||"before"===rt.position;if(("remove"===rt.action||"replace"===rt.action)&&(delete st[at],-1!=lt)){var ct=st[at+"_asArray"];ct.splice(lt,1),ct.length>1?st[at]=ct:1==ct.length?st[at]=ct[0]:delete st[at+"_asArray"]}"add"!==rt.action&&"replace"!==rt.action||Object.keys(rt.value).forEach((function(nt){var it=rt.value[nt],ot=st[nt+"_asArray"]||[];if(0===ot.length&&st[nt]&&ot.push(st[nt]),0===ot.length)ot=it;else{var ct=ot.length;ct=nt==at&&-1!=lt?lt+(ut?0:1)+("replace"==rt.action?-1:0):ut?0:ot.length,ot.splice.apply(ot,[ct,0].concat(it))}st[nt+"_asArray"]=ot,st[nt]=1==ot.length?ot[0]:ot}))}}}))},areMediaInfosEqual:c,reset:p},rt=Ar(ct).getInstance(),it=Bs(ct).getInstance(),p(),nt}Ji.__dashjs_factory_name="DashAdapter";var Us=ht.Z.getSingletonFactory(Ji);function ea(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var Gs=function(){function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e)}var nt;return nt=[{key:"round10",value:function(nt,rt){return function(nt,rt,it){return void 0===it||0==+it?Math[nt](rt):(it=+it,null===(rt=+rt)||isNaN(rt)||"number"!=typeof it||it%1!=0?NaN:(rt=rt.toString().split("e"),+((rt=(rt=Math[nt](+(rt[0]+"e"+(rt[1]?+rt[1]-it:-it)))).toString().split("e"))[0]+"e"+(rt[1]?+rt[1]+it:it))))}("round",nt,rt)}}],nt&&ea(e,nt),e}(),Zs=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]},Vs=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.mt=null,this.to=null,this.lto=null},Hs=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.level=null},js=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=null,this.state=ut.Z.BUFFER_EMPTY},qs=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.range=null,this.manifestInfo=null},Ks=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.droppedFrames=null};function ua(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}var $s=function e(){ua(this,e),this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]},Ys=function e(){ua(this,e),this.id=null,this.index=null,this.start=null,this.duration=null},zs=function e(){ua(this,e),this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null},Ws=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null},Xs=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.loadingRequests=[],this.executedRequests=[]};function ha(nt){var rt,it,at=(nt=nt||{}).settings,st=this.context,lt=(0,ct.Z)(st).getInstance();function c(){lt.trigger(dt.Z.METRICS_CHANGED)}function f(nt){lt.trigger(dt.Z.METRIC_CHANGED,{mediaType:nt}),c()}function d(nt,rt,it){lt.trigger(dt.Z.METRIC_UPDATED,{mediaType:nt,metric:rt,value:it}),f(nt)}function g(nt,rt,it){lt.trigger(dt.Z.METRIC_ADDED,{mediaType:nt,metric:rt,value:it}),f(nt)}function h(nt,rt){var at=null;return nt?(it.hasOwnProperty(nt)?at=it[nt]:rt||(at=new Zs,it[nt]=at),at):at}function p(nt,rt,it){var st=h(nt);null!==st&&(st[rt].push(it),st[rt].length>at.get().streaming.metrics.maxListDepth&&st[rt].shift())}function m(nt,rt,it){p(nt,rt,it),g(nt,rt,it)}return rt={clearCurrentMetricsForType:function(nt){delete it[nt],f(nt)},clearAllCurrentMetrics:function(){it={},c()},getMetricsFor:h,addHttpRequest:function e(nt,rt,it,at,st,ot,lt,ct,dt,ht,pt,_t,Et,St,wt,Lt,Ct){var Pt=new Ut.w;null!=ot&&ot!==at&&(e(nt,null,it,at,st,null,null,ct,dt,null,null,null,Et,null,null,Lt,Ct),Pt.actualurl=ot),Pt.tcpid=rt,Pt.type=it,Pt.url=at,Pt.range=ct,Pt.trequest=dt,Pt.tresponse=ht,Pt.responsecode=_t,Pt.cmsd=Ct,Pt._tfinish=pt,Pt._stream=nt,Pt._mediaduration=Et,Pt._quality=st,Pt._responseHeaders=St,Pt._serviceLocation=lt,Pt._fileLoaderType=Lt,wt?wt.forEach((function(nt){!function(nt,rt,it,at){var st=new Ut.O;st.s=rt,st.d=it,st.b=at,nt.trace.push(st),nt.interval||(nt.interval=0),nt.interval+=it}(Pt,nt.s,nt.d,nt.b)})):(delete Pt.interval,delete Pt.trace),m(nt,ut.Z.HTTP_REQUEST,Pt)},addRepresentationSwitch:function(nt,rt,it,at,st){var ot=new Vs;ot.t=rt,ot.mt=it,ot.to=at,st?ot.lto=st:delete ot.lto,m(nt,ut.Z.TRACK_SWITCH,ot)},addBufferLevel:function(nt,rt,it){var at=new Hs;at.t=rt,at.level=it,m(nt,ut.Z.BUFFER_LEVEL,at)},addBufferState:function(nt,rt,it){var at=new js;at.target=it,at.state=rt,m(nt,ut.Z.BUFFER_STATE,at)},addDVRInfo:function(nt,rt,it,at){var st=new qs;st.time=rt,st.range=at,st.manifestInfo=it,m(nt,ut.Z.DVR_INFO,st)},addDroppedFrames:function(nt,rt){var it=new Ks,at=h(nt).DroppedFrames;rt&&(it.time=rt.creationTime,it.droppedFrames=rt.droppedVideoFrames,at.length>0&&at[at.length-1]==it||m(nt,ut.Z.DROPPED_FRAMES,it))},addSchedulingInfo:function(nt,rt,it,at,st,ot,lt,ct,dt){var ht=new Ws;ht.mediaType=nt,ht.t=rt,ht.type=it,ht.startTime=at,ht.availabilityStartTime=st,ht.duration=ot,ht.quality=lt,ht.range=ct,ht.state=dt,m(nt,ut.Z.SCHEDULING_INFO,ht)},addRequestsQueue:function(nt,rt,it){var at=new Xs;at.loadingRequests=rt,at.executedRequests=it,h(nt).RequestsQueue=at,g(nt,ut.Z.REQUESTS_QUEUE,at)},addManifestUpdate:function(nt,rt,it,at,st,lt,ct,dt,ht,pt){var _t=new $s;_t.mediaType=nt,_t.type=rt,_t.requestTime=it,_t.fetchTime=at,_t.availabilityStartTime=st,_t.presentationStartTime=lt,_t.clientTimeOffset=ct,_t.currentTime=dt,_t.buffered=ht,_t.latency=pt,p(ot.Z.STREAM,ut.Z.MANIFEST_UPDATE,_t),g(nt,ut.Z.MANIFEST_UPDATE,_t)},updateManifestUpdateInfo:function(nt,rt){if(nt){for(var it in rt)nt[it]=rt[it];d(nt.mediaType,ut.Z.MANIFEST_UPDATE,nt)}},addManifestUpdateStreamInfo:function(nt,rt,it,at,st){if(nt){var ot=new Ys;ot.id=rt,ot.index=it,ot.start=at,ot.duration=st,nt.streamInfo.push(ot),d(nt.mediaType,ut.Z.MANIFEST_UPDATE_STREAM_INFO,nt)}},addManifestUpdateRepresentationInfo:function(nt,rt,it,at,st,ot,lt,ct){if(nt&&nt.representationInfo){var dt=new zs;dt.id=rt,dt.index=it,dt.streamIndex=at,dt.mediaType=st,dt.startNumber=lt,dt.fragmentInfoType=ct,dt.presentationTimeOffset=ot,nt.representationInfo.push(dt),d(nt.mediaType,ut.Z.MANIFEST_UPDATE_TRACK_INFO,nt)}},addPlayList:function(nt){nt.trace&&Array.isArray(nt.trace)?nt.trace.forEach((function(nt){nt.hasOwnProperty("subreplevel")&&!nt.subreplevel&&delete nt.subreplevel})):delete nt.trace,m(ot.Z.STREAM,ut.Z.PLAY_LIST,nt)},addDVBErrors:function(nt){m(ot.Z.STREAM,ut.Z.DVB_ERRORS,nt)}},it={},rt}ha.__dashjs_factory_name="MetricsModel";var Qs=ht.Z.getSingletonFactory(ha);function ma(nt){nt=nt||{};var rt,it,at,st,lt=this.context,ct=nt.metricsModel;function l(nt){var rt=ct.getMetricsFor(nt,!0);if(!rt)return null;var it,at=rt.HttpList,st=null;if(!at||at.length<=0)return null;for(it=at.length-1;it>=0;){if(at[it].responsecode){st=at[it];break}it--}return st}function c(nt){var rt=ct.getMetricsFor(nt,!0);return rt&&rt.HttpList?rt.HttpList:[]}function f(nt,rt){if(!nt)return null;var it=nt[rt];return it&&0!==it.length?it[it.length-1]:null}return rt={getCurrentRepresentationSwitch:function(nt){return f(ct.getMetricsFor(nt,!0),ut.Z.TRACK_SWITCH)},getCurrentBufferState:function(nt){return f(ct.getMetricsFor(nt,!0),ut.Z.BUFFER_STATE)},getCurrentBufferLevel:function(nt){var rt=f(ct.getMetricsFor(nt,!0),ut.Z.BUFFER_LEVEL);return rt?Gs.round10(rt.level/1e3,-3):0},getCurrentHttpRequest:l,getHttpRequests:c,getCurrentDroppedFrames:function(){return f(ct.getMetricsFor(ot.Z.VIDEO,!0),ut.Z.DROPPED_FRAMES)},getCurrentSchedulingInfo:function(nt){return f(ct.getMetricsFor(nt,!0),ut.Z.SCHEDULING_INFO)},getCurrentDVRInfo:function(nt){return f(nt?ct.getMetricsFor(nt,!0):ct.getMetricsFor(ot.Z.VIDEO,!0)||ct.getMetricsFor(ot.Z.AUDIO,!0),ut.Z.DVR_INFO)},getCurrentManifestUpdate:function(){return f(ct.getMetricsFor(ot.Z.STREAM),ut.Z.MANIFEST_UPDATE)},getLatestFragmentRequestHeaderValueByID:function(nt,rt){if(!rt)return null;var it={},at=l(nt);at&&(it=Lr.Z.parseHttpHeaders(at._responseHeaders));var st=it[rt.toLowerCase()];return void 0===st?null:st},getLatestMPDRequestHeaderValueByID:function(nt){if(!nt)return null;var rt,it,at,st={};for(at=(rt=c(ot.Z.STREAM)).length-1;at>=0;at--)if((it=rt[at]).type===Ut.w.MPD_TYPE){st=Lr.Z.parseHttpHeaders(it._responseHeaders);break}var lt=st[nt.toLowerCase()];return void 0===lt?null:lt},addRepresentationSwitch:function(nt,rt,it,at,st){ct.addRepresentationSwitch(nt,rt,it,at,st)},addDVRInfo:function(nt,rt,it,at){ct.addDVRInfo(nt,rt,it,at)},updateManifestUpdateInfo:function(nt){var rt=this.getCurrentManifestUpdate();ct.updateManifestUpdateInfo(rt,nt)},addManifestUpdateStreamInfo:function(nt){if(nt){var rt=this.getCurrentManifestUpdate();ct.addManifestUpdateStreamInfo(rt,nt.id,nt.index,nt.start,nt.duration)}},addManifestUpdateRepresentationInfo:function(nt,rt){if(nt){var it=this.getCurrentManifestUpdate();ct.addManifestUpdateRepresentationInfo(it,nt.id,nt.index,nt.streamIndex,rt,nt.presentationTimeOffset,nt.startNumber,nt.fragmentInfoType)}},addManifestUpdate:function(nt){ct.addManifestUpdate(ot.Z.STREAM,nt.type,nt.requestStartDate,nt.requestEndDate)},addHttpRequest:function(nt,rt,it,at,st,ot){ct.addHttpRequest(nt.mediaType,null,nt.type,nt.url,nt.quality,rt,nt.serviceLocation||null,nt.range||null,nt.requestStartDate,nt.firstByteDate,nt.requestEndDate,it,nt.duration,at,st,nt.fileLoaderType,ot)},addSchedulingInfo:function(nt,rt){ct.addSchedulingInfo(nt.mediaType,new Date,nt.type,nt.startTime,nt.availabilityStartTime,nt.duration,nt.quality,nt.range,rt)},addRequestsQueue:function(nt,rt,it){ct.addRequestsQueue(nt,rt,it)},addBufferLevel:function(nt,rt,it){ct.addBufferLevel(nt,rt,it)},addBufferState:function(nt,rt,it){ct.addBufferState(nt,rt,it)},addDroppedFrames:function(nt){ct.addDroppedFrames(ot.Z.VIDEO,nt)},addPlayList:function(){st&&(ct.addPlayList(st),st=null)},addDVBErrors:function(nt){ct.addDVBErrors(nt)},createPlaylistMetrics:function(nt,rt){(st=new mn).start=new Date,st.mstart=nt,st.starttype=rt},createPlaylistTraceMetrics:function(nt,rt,st){!0===it&&(it=!1,(at=new gn).representationid=nt,at.start=new Date,at.mstart=rt,at.playbackspeed=null!==st?st.toString():null)},updatePlayListTraceMetrics:function(nt){if(at)for(var rt in at)at[rt]=nt[rt]},pushPlayListTraceMetrics:function(nt,rt){if(!1===it&&st&&at&&at.start){var ot=at.start,lt=nt.getTime()-ot.getTime();at.duration=lt,at.stopreason=rt,st.trace.push(at),it=!0}},clearAllCurrentMetrics:function(){ct.clearAllCurrentMetrics()}},ct=ct||Qs(lt).getInstance({settings:nt.settings}),it=!0,at=null,st=null,rt}ma.__dashjs_factory_name="DashMetrics";var Js=ht.Z.getSingletonFactory(ma);function Ea(){var nt,rt,it,at,st=this.context,ut=(0,ct.Z)(st).getInstance(),ht=(0,Bt.Z)(st).getInstance();function f(nt){at=nt}function g(nt,rt,it,at){var st,ot=rt.adaptation.period.mpd,lt=ot.availabilityStartTime;if(at)st=it&&ot.timeShiftBufferDepth!==Number.POSITIVE_INFINITY?new Date(lt.getTime()+1e3*(nt+ot.timeShiftBufferDepth)):ot.availabilityEndTime;else if(it){var ut=rt.availabilityTimeOffset;st=new Date(lt.getTime()+1e3*(nt-ut))}else st=lt;return st}function h(nt,rt){return(nt.getTime()-rt.mpd.availabilityStartTime.getTime()+1e3*at)/1e3}function p(nt,rt){return nt+(rt.adaptation.period.start-rt.presentationTimeOffset)}function m(nt){var it={start:NaN,end:NaN},at=nt[0].getAdapter().getRegularPeriods()[0],st=h(new Date,at);if(!nt||0===nt.length)return{range:it,now:st};nt.forEach((function(nt){var at=nt.getAdapter(),ut=at.getMediaInfoForType(nt.getStreamInfo(),ot.Z.VIDEO)||at.getMediaInfoForType(nt.getStreamInfo(),ot.Z.AUDIO),ct=at.getVoRepresentations(ut)[0],dt={start:NaN,end:NaN};if(ct)if(ct.segmentInfoType===lt.Z.SEGMENT_TIMELINE)dt=function(nt){var it,at,st,ot,lt=nt.adaptation.period.mpd.manifest.Period_asArray[nt.adaptation.period.index].AdaptationSet_asArray[nt.adaptation.index],ut=rt.getRepresentationFor(nt.index,lt),ct=ut.SegmentTemplate||ut.SegmentList,dt=ct.SegmentTimeline,ht=ct.timescale,pt=dt.S_asArray,_t={start:0,end:0},Et=pt[0].t,St=!isNaN(Et),wt=St?Et:0,Lt=0;for(St&&(_t.start=p(wt/ht,nt)),st=0,ot=pt.length;st<ot;st++)at=0,(it=pt[st]).hasOwnProperty("r")&&(at=it.r),Lt+=it.d*(1+at);return _t.end=p((wt+Lt)/ht,nt),_t}(ct);else{var ht=ct.adaptation.period;dt.start=ht.start,dt.end=Math.max(st,ht.start+ht.duration)}!isNaN(dt.start)&&(isNaN(it.start)||it.start>dt.start)&&(it.start=dt.start),!isNaN(dt.end)&&(isNaN(it.end)||it.end<dt.end)&&(it.end=dt.end)})),it.end=Math.min(st,it.end);var ut=E(nt,it.end,!0);return it.end=isNaN(ut)?it.end:ut,it.start=at&&at.mpd&&at.mpd.timeShiftBufferDepth&&!isNaN(at.mpd.timeShiftBufferDepth)&&!isNaN(it.end)?Math.max(it.end-at.mpd.timeShiftBufferDepth,it.start):it.start,it.start=E(nt,it.start),{range:it,now:st}}function y(nt,rt){it=nt-rt.end}function E(nt,rt){var it=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{for(var at=0,st=!1,ot=NaN;!st&&at<nt.length;){var lt=nt[at].getStreamInfo();lt.start<=rt&&(!isFinite(lt.duration)||lt.start+lt.duration>=rt)?(ot=rt,st=!0):!it&&lt.start>rt&&(isNaN(ot)||lt.start<ot)?ot=lt.start:it&&lt.start+lt.duration<rt&&(isNaN(ot)||lt.start+lt.duration>ot)&&(ot=lt.start+lt.duration),at+=1}return ot}catch(nt){return rt}}function v(nt){void 0===nt.offset||isNaN(nt.offset)||f(nt.offset/1e3)}function _(){at=0,it=0}function T(){ut.off(dt.Z.UPDATE_TIME_SYNC_OFFSET,v,this),_()}return nt={initialize:function(){_(),ut.on(dt.Z.UPDATE_TIME_SYNC_OFFSET,v,this)},getClientTimeOffset:function(){return at},setClientTimeOffset:f,getClientReferenceTime:function(){return Date.now()-1e3*it+1e3*at},calcAvailabilityStartTimeFromPresentationTime:function(nt,rt,it){return g(nt,rt,it)},calcAvailabilityEndTimeFromPresentationTime:function(nt,rt,it){return g(nt,rt,it,!0)},calcPresentationTimeFromWallTime:h,calcPresentationTimeFromMediaTime:p,calcPeriodRelativeTimeFromMpdRelativeTime:function(nt,rt){return rt-nt.adaptation.period.start},calcMediaTimeFromPresentationTime:function(nt,rt){return nt-rt.adaptation.period.start+rt.presentationTimeOffset},calcWallTimeForSegment:function(nt,rt){var it,at,st;return rt&&(it=nt.representation.adaptation.period.mpd.suggestedPresentationDelay,at=nt.presentationStartTime+it,st=new Date(nt.availabilityStartTime.getTime()+1e3*at)),st},calcTimeShiftBufferWindow:function(nt,rt){if(!rt)return function(nt){var rt={start:NaN,end:NaN},it=0,at=NaN;return nt.forEach((function(nt){var rt=nt.getStreamInfo();it+=rt.duration,(isNaN(at)||rt.start<at)&&(at=rt.start)})),rt.start=at,rt.end=at+it,rt}(nt);if(ht.get().streaming.timeShiftBuffer.calcFromSegmentTimeline){var it=m(nt);return y(it.now,it.range),it.range}return function(nt){var rt={start:NaN,end:NaN};if(!nt||0===nt.length)return rt;var it=nt[0].getAdapter().getRegularPeriods()[0],at=h(new Date,it),st=it.mpd.timeShiftBufferDepth,ot=isNaN(st)?0:at-st;if(rt.start=E(nt,ot),rt.end=!isNaN(rt.start)&&at<rt.start?at:E(nt,at,!0),!isNaN(st)&&rt.end<at-st&&(rt.end=NaN),ht.get().streaming.timeShiftBuffer.fallbackToSegmentTimeline){var lt=m(nt);if(lt.range.end<rt.start)return ut.trigger(_t.Z.CONFORMANCE_VIOLATION,{level:Zi.LEVELS.WARNING,event:Zi.EVENTS.INVALID_DVR_WINDOW}),y(lt.now,lt.range),lt.range}return rt}(nt)},reset:T},rt=Ar(st).getInstance(),T(),nt}Ea.__dashjs_factory_name="TimelineConverter";var eo=ht.Z.getSingletonFactory(Ea),to=it(4593),no=it(6934);function Sa(nt){return Sa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},Sa(nt)}function ba(nt,rt){return ba=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},ba(nt,rt)}function Aa(nt,rt){return!rt||"object"!==Sa(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function Ia(nt){return Ia=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},Ia(nt)}var ro=function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&ba(nt,rt)}(i,nt);var rt,it,at=(rt=i,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=Ia(rt);if(it){var st=Ia(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return Aa(this,nt)});function i(){var nt;return function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,i),(nt=at.call(this)).captionData=null,nt.label=null,nt.defaultTrack=!1,nt.kind=null,nt.isFragmented=!1,nt.isEmbedded=!1,nt.isTTML=null,nt}return i}(ks),io=it(2295);function Na(){var nt=0;function t(nt){for(var rt="",it=0;it<nt.length;++it)rt+=nt[it].uchar;return rt.length-rt.replace(/^\s+/,"").length}function n(nt){return"left: "+3.125*nt.x+"%; top: "+6.66*nt.y1+"%; width: "+(100-3.125*nt.x)+"%; height: "+6.66*Math.max(nt.y2-1-nt.y1,1)+"%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;"}function r(nt){return"red"===nt?"rgb(255, 0, 0)":"green"===nt?"rgb(0, 255, 0)":"blue"===nt?"rgb(0, 0, 255)":"cyan"===nt?"rgb(0, 255, 255)":"magenta"===nt?"rgb(255, 0, 255)":"yellow"===nt?"rgb(255, 255, 0)":"white"===nt?"rgb(255, 255, 255)":"black"===nt?"rgb(0, 0, 0)":nt}function i(nt,rt){var it=nt.videoHeight/15;return rt?"font-size: "+it+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; color: "+(rt.foreground?r(rt.foreground):"rgb(255, 255, 255)")+"; font-style: "+(rt.italics?"italic":"normal")+"; text-decoration: "+(rt.underline?"underline":"none")+"; white-space: pre; background-color: "+(rt.background?r(rt.background):"transparent")+";":"font-size: "+it+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;"}function a(nt){return nt.replace(/^\s+/g,"")}function o(nt){return nt.replace(/\s+$/g,"")}return{createHTMLCaptionsFromScreen:function(rt,it,at,st){var ot,lt,ut=null,ct=!1,dt=-1,ht={start:it,end:at,spans:[]},pt="style_cea608_white_black",_t={},Et={},St=[];for(ot=0;ot<15;++ot){var wt=st.rows[ot],Lt="",Ct=null;if(!1===wt.isEmpty()){var Pt=t(wt.chars);null===ut&&(ut={x:Pt,y1:ot,y2:ot+1,p:[]}),Pt!==dt&&ct&&(ut.p.push(ht),ht={start:it,end:at,spans:[]},ut.y2=ot,ut.name="region_"+ut.x+"_"+ut.y1+"_"+ut.y2,!1===_t.hasOwnProperty(ut.name)?(St.push(ut),_t[ut.name]=ut):_t[ut.name].p.contat(ut.p),ut={x:Pt,y1:ot,y2:ot+1,p:[]});for(var kt=0;kt<wt.chars.length;++kt){var Ot=wt.chars[kt],Ft=Ot.penState;if(null===Ct||!Ft.equals(Ct)){Lt.trim().length>0&&(ht.spans.push({name:pt,line:Lt,row:ot}),Lt="");var Bt="style_cea608_"+Ft.foreground+"_"+Ft.background;Ft.underline&&(Bt+="_underline"),Ft.italics&&(Bt+="_italics"),Et.hasOwnProperty(Bt)||(Et[Bt]=JSON.parse(JSON.stringify(Ft))),Ct=Ft,pt=Bt}Lt+=Ot.uchar}Lt.trim().length>0&&ht.spans.push({name:pt,line:Lt,row:ot}),ct=!0,dt=Pt}else ct=!1,dt=-1,ut&&(ut.p.push(ht),ht={start:it,end:at,spans:[]},ut.y2=ot,ut.name="region_"+ut.x+"_"+ut.y1+"_"+ut.y2,!1===_t.hasOwnProperty(ut.name)?(St.push(ut),_t[ut.name]=ut):_t[ut.name].p.contat(ut.p),ut=null)}ut&&(ut.p.push(ht),ut.y2=ot+1,ut.name="region_"+ut.x+"_"+ut.y1+"_"+ut.y2,!1===_t.hasOwnProperty(ut.name)?(St.push(ut),_t[ut.name]=ut):_t[ut.name].p.contat(ut.p),ut=null);var Ut=[];for(ot=0;ot<St.length;++ot){var Gt=St[ot],Ht="sub_cea608_"+nt++,jt=document.createElement("div");jt.id=Ht;var Kt=n(Gt);jt.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+Kt;var $t=document.createElement("div");$t.className="paragraph bodyStyle",$t.style.cssText=i(rt);var Yt=document.createElement("div");Yt.className="cueUniWrapper",Yt.style.cssText="unicode-bidi: normal; direction: ltr;";for(var Wt=0;Wt<Gt.p.length;++Wt){var Qt=Gt.p[Wt],en=0;for(lt=0;lt<Qt.spans.length;++lt){var nn=Qt.spans[lt];if(nn.line.length>0){if(0!==lt&&en!=nn.row){var an=document.createElement("br");an.className="lineBreak",Yt.appendChild(an)}var ln=!1;en===nn.row&&(ln=!0),en=nn.row;var hn=Et[nn.name],fn=document.createElement("span");fn.className="spanPadding "+nn.name+" customSpanColor",fn.style.cssText=i(rt,hn),0!==lt&&ln?lt===Qt.spans.length-1?fn.textContent=o(nn.line):fn.textContent=nn.line:Qt.spans.length>1&&lt<Qt.spans.length-1&&nn.row===Qt.spans[lt+1].row?fn.textContent=a(nn.line):fn.textContent=nn.line.trim(),Yt.appendChild(fn)}}}$t.appendChild(Yt),jt.appendChild($t);var pn={bodyStyle:["%",90]};for(var mn in Et)Et.hasOwnProperty(mn)&&(pn[mn]=["%",90]);Ut.push({type:"html",start:it,end:at,cueHTMLElement:jt,cueID:Ht,cellResolution:[32,15],isFromCEA608:!0,fontSize:pn,lineHeight:{},linePadding:{}})}return Ut}}}Na.__dashjs_factory_name="EmbeddedTextHtmlRender";var ao=ht.Z.getSingletonFactory(Na);function Da(nt){var rt,it,at,lt,ut,ht,_t,Et,St,wt,Lt,Ct,Pt,kt,Bt,Gt,Ht,jt=nt.errHandler,Kt=nt.manifestModel,$t=nt.mediaController,Yt=nt.videoModel,Wt=nt.textTracks,Qt=nt.vttParser,en=nt.vttCustomRenderingParser,nn=nt.ttmlParser,an=nt.streamInfo,ln=nt.settings,hn=this.context,fn=(0,ct.Z)(hn).getInstance(),pn=!1;function Z(){ht=null,Et=NaN,St=[],wt=null,_t=!1,ut=[],lt=null}function B(nt){var rt=new ro;for(var it in nt)rt[it]=nt[it];rt.labels=nt.labels,rt.defaultTrack=function(nt){var rt=!1;return Ct.length>1&&nt.isEmbedded?rt=nt.id&&nt.id===ot.Z.CC1:1===Ct.length?nt.id&&"string"==typeof nt.id&&"CC"===nt.id.substring(0,2)&&(rt=!0):0===Ct.length&&(rt=nt.index===ut[0].index),rt}(nt),rt.isFragmented=nt.isFragmented,rt.isEmbedded=!!nt.isEmbedded,rt.isTTML=function(nt){return nt.codec&&nt.codec.search(ot.Z.STPP)>=0||nt.mimeType&&nt.mimeType.search(ot.Z.TTML)>=0}(nt),rt.kind=function(nt,rt){var it=nt.roles&&nt.roles.length>0?rt[nt.roles[0]]:rt.caption;return it===rt.caption||it===rt.subtitle?it:rt.caption}(nt,{subtitle:"subtitles",caption:"captions"}),Wt.addTextTrack(rt)}function G(nt){var rt=nt.chunk;rt.mediaInfo.embeddedCaptions&&Y(rt.bytes,rt)}function q(nt){Lt=nt}function Y(nt,ut){var ct=ut.mediaInfo,dt=ct.type,pt=ct.mimeType,St=ct.codec||pt;St?-1!==ct.codec.indexOf("application/mp4")?function(nt,st,ut){var ct;if("InitializationSegment"===st.segmentType)_t=!0,Et=at.getMediaTimescaleFromMoov(nt);else{if(!_t)return;(ct=at.getSamplesInfo(nt).sampleList).length>0&&(wt=ct[0].cts-st.start*Et),ut.search(ot.Z.STPP)>=0?function(nt,at,st){var ut,ct;for(lt=null!==lt?lt:V(st),ut=0;ut<at.length;ut++){var dt=at[ut],pt=dt.cts,_t=H(),St=_t+pt/Et,wt=St+dt.duration/Et;rt.buffered.add(St,wt);var Ct=new DataView(nt,dt.offset,dt.subSizes[0]),Pt=no.Utils.dataViewToString(Ct,ot.Z.UTF8),kt=[],Ot=dt.offset+dt.subSizes[0];for(ct=1;ct<dt.subSizes.length;ct++){var Ft=new Uint8Array(nt,Ot,dt.subSizes[ct]),Bt=String.fromCharCode.apply(null,Ft);kt.push(Bt),Ot+=dt.subSizes[ct]}try{var Ut=Kt.getValue().ttmlTimeIsRelative?pt/Et:0,Gt=lt.parse(Pt,Ut,pt/Et,(pt+dt.duration)/Et,kt);Wt.addCaptions(Lt,_t,Gt)}catch(nt){ht.removeExecutedRequestsBeforeTime(),this.remove(),it.error("TTML parser error: "+nt.message)}}}(nt,ct,ut):function(nt,at){var st,ot,lt,ut=[];for(st=0;st<at.length;st++){var ct=at[st];ct.cts-=wt;var dt=H()+ct.cts/Et,ht=dt+ct.duration/Et;rt.buffered.add(dt,ht);var pt=nt.slice(ct.offset,ct.offset+ct.size),_t=no.parseBuffer(pt);for(ot=0;ot<_t.boxes.length;ot++){var St=_t.boxes[ot];if(it.debug("VTT box1: "+St.type),"vtte"!==St.type&&"vttc"===St.type){it.debug("VTT vttc boxes.length = "+St.boxes.length);var Ct={styles:{}};for(lt=0;lt<St.boxes.length;lt++){var Pt=St.boxes[lt];if(it.debug("VTT box2: "+Pt.type),"payl"===Pt.type)Ct.start=ct.cts/Et,Ct.end=(ct.cts+ct.duration)/Et,Ct.data=Pt.cue_text;else if("sttg"===Pt.type&&Pt.settings&&""!==Pt.settings)try{var kt=Pt.settings.split(" ");Ct.styles=Qt.getCaptionStyles(kt)}catch(nt){}}Ct&&Ct.data&&(ut.push(Ct),it.debug("VTT  ".concat(Ct.start," - ").concat(Ct.end," :  ").concat(Ct.data)))}}}ut.length>0&&Wt.addCaptions(Lt,0,ut)}(nt,ct)}}(nt,ut,St):dt===ot.Z.VIDEO?function(nt,rt){var ot,lt;if(rt.segmentType===Ut.w.INIT_SEGMENT_TYPE)0===Pt&&(Pt=at.getMediaTimescaleFromMoov(nt));else if(rt.segmentType===Ut.w.MEDIA_SEGMENT_TYPE){if(0===Pt)return void it.warn("CEA-608: No timescale for embeddedTextTrack yet");var ut=(lt=at.getSamplesInfo(nt)).lastSequenceNumber,ct=Math.trunc(rt.start),dt=Math.trunc(rt.end);if(Gt[0]||Gt[1]||function(){for(var nt,rt=0;rt<Ct.length;rt++){if(-1===(nt=Wt.getTrackIdxForId(Ct[rt].id)))return void it.warn("CEA-608: data before track is ready.");var at=j(nt);Gt[rt]=new(st().Cea608Parser)(rt+1,{newCue:at},null)}}(),Pt){if(function(nt,rt,it,at,st){return null!==nt&&null!==rt&&null!==at&&null!==st&&(rt===nt?at!==st:rt!==nt+it)}(kt,ut,lt.numSequences,Bt,ct))for(ot=0;ot<Gt.length;ot++)Gt[ot]&&Gt[ot].reset();for(var ht=function(nt,rt){if(0===rt.length)return null;for(var it={splits:[],fields:[[],[]]},at=new DataView(nt),ot=0;ot<rt.length;ot++)for(var lt=rt[ot],ut=st().findCea608Nalus(at,lt.offset,lt.size),ct=null,dt=0,ht=0;ht<ut.length;ht++)for(var pt=st().extractCea608DataFromRange(at,ut[ht]),_t=0;_t<2;_t++)if(pt[_t].length>0){lt.cts!==ct?dt=0:dt+=1;var Et=H();it.fields[_t].push([lt.cts+Et*Pt,pt[_t],dt]),ct=lt.cts}return it.fields.forEach((function(nt){nt.sort((function(nt,rt){return nt[0]===rt[0]?nt[2]-rt[2]:nt[0]-rt[0]}))})),it}(nt,lt.sampleList),pt=0;pt<Gt.length;pt++){var _t=ht.fields[pt],Et=Gt[pt];if(Et)for(ot=0;ot<_t.length;ot++)Et.addData(_t[ot][0]/Pt,_t[ot][1])}kt=ut,Bt=dt}}}(nt,ut):function(nt,it,at){var st,lt,ut=new DataView(nt,0,nt.byteLength);lt=no.Utils.dataViewToString(ut,ot.Z.UTF8);try{st=V(at).parse(lt,0),Wt.addCaptions(Wt.getCurrentTrackIdx(),0,st),rt.buffered&&rt.buffered.add(it.start,it.end)}catch(nt){jt.error(new Ot.Z(Ft.TIMED_TEXT_ERROR_ID_PARSE_CODE,Ft.TIMED_TEXT_ERROR_MESSAGE_PARSE+nt.message,lt))}}(nt,ut,St):it.error("No text type defined")}function j(nt){return function(rt,it,at){var st;(st=Yt.getTTMLRenderingDiv()?Ht.createHTMLCaptionsFromScreen(Yt.getElement(),rt,it,at):[{start:rt,end:it,data:at.getDisplayText(),styles:{}}])&&Wt.addCaptions(nt,0,st)}}function H(){return isNaN(rt.timestampOffset)?0:rt.timestampOffset}function V(nt){var rt;return nt.search(ot.Z.VTT)>=0?rt=ln.get().streaming.text.webvtt.customRenderingEnabled&&en?en:Qt:(nt.search(ot.Z.TTML)>=0||nt.search(ot.Z.STPP)>=0)&&(rt=nn),rt}function K(nt){Ct.forEach((function(rt){var it=Wt.getTrackIdxForId(rt.id);it>=0&&Wt.deleteCuesFromTrackIdx(it,nt.from,nt.to)}))}return rt={initialize:function(){pn||(Ct=[],Lt=null,Pt=0,Gt=[],kt=null,Bt=null,pn=!0,Ht=ao(hn).getInstance(),fn.on(dt.Z.VIDEO_CHUNK_RECEIVED,G,rt),fn.on(dt.Z.BUFFER_CLEARED,K,rt))},addMediaInfos:function(nt,it,at){if(ut=ut.concat(it),nt===ot.Z.TEXT&&it[0].isFragmented&&!it[0].isEmbedded){ht=at,rt.buffered=(0,io.Z)(hn).create(),St=$t.getTracksFor(ot.Z.TEXT,an.id).filter((function(nt){return nt.isFragmented}));for(var st=$t.getCurrentTrackFor(ot.Z.TEXT,an.id),lt=0;lt<St.length;lt++)if(St[lt]===st){q(lt);break}}for(var ct=0;ct<it.length;ct++)B(it[ct])},resetMediaInfos:function(){ut=[]},getStreamId:function(){return an.id},append:Y,abort:function(){},addEmbeddedTrack:function(nt){if(pn&&nt)if(nt.id===ot.Z.CC1||nt.id===ot.Z.CC3){for(var rt=0;rt<Ct.length;rt++)if(Ct[rt].id===nt.id)return;Ct.push(nt)}else it.warn("Embedded track "+nt.id+" not supported!")},resetEmbedded:function(){fn.off(dt.Z.VIDEO_CHUNK_RECEIVED,G,rt),fn.off(dt.Z.BUFFER_CLEARED,K,rt),Wt&&Wt.deleteAllTextTracks(),pn=!1,Ct=[],Gt=[null,null],kt=null,Bt=null},getConfig:function(){return{fragmentModel:ht,fragmentedTracks:St,videoModel:Yt}},setCurrentFragmentedTrackIdx:q,remove:function(nt,it){void 0===nt&&nt===it&&(nt=rt.buffered.start(0),it=rt.buffered.end(rt.buffered.length-1)),rt.buffered.remove(nt,it),Wt.deleteCuesFromTrackIdx(Lt,nt,it)},reset:function(){Z(),ut=[],at=null}},it=(0,pt.Z)(hn).getInstance().getLogger(rt),at=(0,bi.Z)(hn).getInstance(),Z(),rt}Da.__dashjs_factory_name="TextSourceBuffer";var so=ht.Z.getClassFactory(Da),oo=it(4403);function Pa(nt,rt){(null==rt||rt>nt.length)&&(rt=nt.length);for(var it=0,at=new Array(rt);it<rt;it++)at[it]=nt[it];return at}var lo=["text","align","fontSize","id","isd","line","lineAlign","lineHeight","linePadding","position","positionAlign","region","size","snapToLines","vertical"];function Fa(nt){var rt,it,at,st,lt,ut,ht,Et,St,wt,Lt,Ct,Pt,kt,Ot,Ft,Bt,Ut,Gt,Ht,jt=this.context,Kt=(0,ct.Z)(jt).getInstance(),$t=nt.videoModel,Yt=nt.streamInfo,Wt=nt.settings;function O(nt,rt,it,at,st,ot){var lt=0,ut=0;nt/rt>it/at?lt=(ut=rt)/at*it:ut=(lt=nt)/it*at;var ct,dt,ht=0,pt=0;return lt/ut>st?(pt=ut,ht=ut*st):(ht=lt,pt=lt/st),ct=(nt-ht)/2,dt=(rt-pt)/2,ot?{x:ct+.1*ht,y:dt+.1*pt,w:.8*ht,h:.8*pt}:{x:ct,y:dt,w:ht,h:pt}}function M(nt,rt){var it=$t.getClientWidth(),at=$t.getClientHeight(),st=$t.getVideoWidth(),ot=$t.getVideoHeight(),lt=$t.getVideoRelativeOffsetTop(),ut=$t.getVideoRelativeOffsetLeft();if(0!==st&&0!==ot){var ct=st/ot,dt=!1;nt.isFromCEA608&&(ct=3.5/3,dt=!0);var pt=O.call(this,it,at,st,ot,ct,dt),Ct=pt.w,Pt=pt.h,Ft=pt.x,Ut=pt.y;if(Ct!=St||Pt!=wt||Ft!=ht||Ut!=Et||rt){if(ht=Ft+ut,Et=Ut+lt,St=Ct,wt=Pt,Lt){var Gt=Lt.style;Gt&&(Gt.left=ht+"px",Gt.top=Et+"px",Gt.width=St+"px",Gt.height=wt+"px",Gt.zIndex=kt&&document[kt]||Ot?Bt:null,Kt.trigger(_t.Z.CAPTION_CONTAINER_RESIZE))}var Ht=nt.activeCues;if(Ht)for(var jt=Ht.length,Yt=0;Yt<jt;++Yt){var Wt=Ht[Yt];Wt.scaleCue(Wt)}}}}function P(nt){var rt,it,at,st,ot,lt=St,ut=wt;if(nt.cellResolution){var ct=[lt/nt.cellResolution[0],ut/nt.cellResolution[1]];if(nt.linePadding)for(rt in nt.linePadding)if(nt.linePadding.hasOwnProperty(rt)){it=(nt.linePadding[rt]*ct[0]).toString();for(var dt=document.getElementsByClassName("spanPadding"),ht=0;ht<dt.length;ht++)dt[ht].style.cssText=dt[ht].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+it),dt[ht].style.cssText=dt[ht].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+it)}if(nt.fontSize){for(rt in nt.fontSize)if(nt.fontSize.hasOwnProperty(rt)){"%"===nt.fontSize[rt][0]?at=nt.fontSize[rt][1]/100:"c"===nt.fontSize[rt][0]&&(at=nt.fontSize[rt][1]),it=(at*ct[1]).toString(),ot="defaultFontSize"!==rt?document.getElementsByClassName(rt):document.getElementsByClassName("paragraph");for(var pt=0;pt<ot.length;pt++)ot[pt].style.cssText=ot[pt].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+it)}if(nt.lineHeight)for(rt in nt.lineHeight)if(nt.lineHeight.hasOwnProperty(rt)){"%"===nt.lineHeight[rt][0]?st=nt.lineHeight[rt][1]/100:"c"===nt.fontSize[rt][0]&&(st=nt.lineHeight[rt][1]),it=(st*ct[1]).toString(),ot=document.getElementsByClassName(rt);for(var _t=0;_t<ot.length;_t++)ot[_t].style.cssText=ot[_t].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+it)}}}if(nt.isd){var Et=document.getElementById(nt.cueID);Et&&Lt.removeChild(Et),F(nt)}}function L(nt,rt){var it=/^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/,at=/^#(.*)$/;if(it.test(rt)){var st=it.exec(rt),ot=parseInt(st[4],10)-1;return"data:image/png;base64,"+btoa(nt.images[ot])}if(at.test(rt)){var lt=at.exec(rt)[1];return"data:image/png;base64,"+nt.embeddedImages[lt]}return rt}function F(nt){if(Lt){ie.call(this);var rt=document.createElement("div");Lt.appendChild(rt),Ft=(0,oo.renderHTML)(nt.isd,rt,(function(rt){return L(nt,rt)}),Lt.clientHeight,Lt.clientWidth,Wt.get().streaming.text.imsc.displayForcedOnlyMode,(function(nt){it.info("renderCaption :",nt)}),Ft,Wt.get().streaming.text.imsc.enableRollUp),rt.id=nt.cueID,Kt.trigger(_t.Z.CAPTION_RENDERED,{captionDiv:rt,currentTrackIdx:ut})}}function x(nt,rt){return!!rt&&rt.endTime>=nt.startTime}function k(nt,rt){return!!Wt.get().streaming.text.extendSegmentedCues&&!!function(nt,rt,it){for(var at=0;at<it.length;at++){var st=it[at];if(JSON.stringify(nt[st])!==JSON.stringify(rt[st]))return!1}return!0}(rt,nt,lo)&&(rt.endTime=Math.max(rt.endTime,nt.endTime),!0)}function U(nt,rt){rt&&rt.forEach((function(rt){rt.kind&&"image"===rt.kind&&(rt.src=L(nt,rt.src)),U(nt,rt.contents)}))}function Z(nt,rt,at){var st=W(nt),lt=Wt.get().streaming.text.dispatchForManualRendering;if(st&&Array.isArray(at)&&0!==at.length)for(var ut=0;ut<at.length;ut++){var ct=null,dt=at[ut];st.cellResolution=dt.cellResolution,st.isFromCEA608=dt.isFromCEA608,isNaN(dt.start)||isNaN(dt.end)||(lt?ct=B(dt,rt):H(dt)&&Lt?ct=Y(dt,rt,st):dt.data&&(ct=j(dt,rt,st)));try{if(ct){if(!J(st,ct))if(Wt.get().streaming.text.webvtt.customRenderingEnabled)st.manualCueList||(st.manualCueList=[]),st.manualCueList.push(ct);else{var ht=void 0;st.cues&&0!==st.cues.length&&(ht=st.cues[st.cues.length-1]),x(ct,ht)?k(ct,ht)||(ht.isd&&(ht.onexit=function(){}),st.mode!==ot.Z.TEXT_DISABLED&&st.addCue(ct)):st.mode!==ot.Z.TEXT_DISABLED&&st.addCue(ct)}var pt=Wt.get().streaming.buffer.bufferToKeep;ee(st,0,$t.getTime()-pt)}else it.error("Impossible to display subtitles. You might have missed setting a TTML rendering div via player.attachTTMLRenderingDiv(TTMLRenderingDiv)")}catch(nt){throw te(st),st.addCue(ct),nt}}}function B(nt,rt){var it=V(nt,rt);return it.onenter=function(){H(nt)&&Ht&&Ht.cueID!==it.cueID&&q(Ht),delete it.type,Ht=it,G(it)},it.onexit=function(){q(it),Ht=null},it}function G(nt){Kt.trigger(_t.Z.CUE_ENTER,nt)}function q(nt){Kt.trigger(_t.Z.CUE_EXIT,{cueID:nt.cueID})}function Y(nt,rt,at){var st=this,lt=V(nt,rt);return Lt.style.left=ht+"px",Lt.style.top=Et+"px",Lt.style.width=St+"px",Lt.style.height=wt+"px",lt.onenter=function(){var nt=this;at.mode===ot.Z.TEXT_SHOWING&&(this.isd?(Gt?requestAnimationFrame((function(){return F(nt)})):F(this),it.debug("Cue enter id:"+this.cueID)):(Lt.appendChild(this.cueHTMLElement),P.call(st,this),Kt.trigger(_t.Z.CAPTION_RENDERED,{captionDiv:this.cueHTMLElement,currentTrackIdx:ut})))},lt.onexit=function(){if(Lt)for(var nt=Lt.childNodes,rt=0;rt<nt.length;++rt)nt[rt].id===this.cueID&&(it.debug("Cue exit id:"+nt[rt].id),Lt.removeChild(nt[rt]),--rt)},lt}function j(nt,rt,at){var st=V(nt,rt);if(st.isActive=!1,nt.styles)try{void 0!==nt.styles.align&&"align"in st&&(st.align=nt.styles.align),void 0!==nt.styles.line&&"line"in st&&(st.line=nt.styles.line),void 0!==nt.styles.snapToLines&&"snapToLines"in st&&(st.snapToLines=nt.styles.snapToLines),void 0!==nt.styles.position&&"position"in st&&(st.position=nt.styles.position),void 0!==nt.styles.size&&"size"in st&&(st.size=nt.styles.size)}catch(nt){it.error(nt)}return st.onenter=function(){at.mode===ot.Z.TEXT_SHOWING&&Kt.trigger(_t.Z.CAPTION_RENDERED,{currentTrackIdx:ut})},st}function H(nt){return"html"===nt.type}function V(nt,rt){return H(nt)?function(nt,rt){var it=new at(nt.start+rt,nt.end+rt,"");return it.cueHTMLElement=nt.cueHTMLElement,it.isd=nt.isd,it.images=nt.images,it.embeddedImages=nt.embeddedImages,it.cueID=nt.cueID,it.scaleCue=P.bind(self),it.cellResolution=nt.cellResolution,it.lineHeight=nt.lineHeight,it.linePadding=nt.linePadding,it.fontSize=nt.fontSize,it.isd&&U(it,it.isd.contents),it}(nt,rt):function(nt,rt){var it=new at(nt.start-rt,nt.end-rt,nt.data);return it.cueID="".concat(it.startTime,"_").concat(it.endTime),it}(nt,rt)}function K(nt){if(Ct)for(var rt=Ct.childNodes,it=0;it<rt.length;++it)rt[it].id===nt.cueID&&(Ct.removeChild(rt[it]),--it)}function z(){var nt,rt=[],it=function(nt,rt){var it;if("undefined"==typeof Symbol||null==nt[Symbol.iterator]){if(Array.isArray(nt)||(it=function(nt,rt){if(nt){if("string"==typeof nt)return Pa(nt,rt);var it=Object.prototype.toString.call(nt).slice(8,-1);return"Object"===it&&nt.constructor&&(it=nt.constructor.name),"Map"===it||"Set"===it?Array.from(nt):"Arguments"===it||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(it)?Pa(nt,rt):void 0}}(nt))||rt){it&&(nt=it);var at=0,i=function(){};return{s:i,n:function(){return at>=nt.length?{done:!0}:{done:!1,value:nt[at++]}},e:function(nt){throw nt},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var st,ot=!0,lt=!1;return{s:function(){it=nt[Symbol.iterator]()},n:function(){var nt=it.next();return ot=nt.done,nt},e:function(nt){lt=!0,st=nt},f:function(){try{ot||null==it.return||it.return()}finally{if(lt)throw st}}}}($t.getTextTracks());try{for(it.s();!(nt=it.n()).done;){var at=nt.value;at.manualMode===ot.Z.TEXT_SHOWING&&rt.push(at)}}catch(nt){it.e(nt)}finally{it.f()}return rt}function W(nt){return nt>=0&&st[nt]?$t.getTextTrack(st[nt].kind,st[nt].id,st[nt].lang,st[nt].isTTML,st[nt].isEmbedded):null}function X(nt){var rt=this;if(nt!==ut){var it=W(ut=nt);Q.call(this,it),Pt&&(clearInterval(Pt),Pt=null),it&&"html"===it.renderingType&&(M.call(this,it,!0),window.ResizeObserver?(Ut=new window.ResizeObserver((function(){M.call(rt,it,!0)}))).observe($t.getElement()):Pt=setInterval(M.bind(this,it),500))}}function Q(nt){ie.call(this),nt&&"html"===nt.renderingType?ne.call(this):re.call(this)}function J(nt,rt){if(!nt.cues)return!1;for(var it=0;it<nt.cues.length;it++)if(nt.cues[it].startTime===rt.startTime&&nt.cues[it].endTime===rt.endTime)return!0;return!1}function $(nt,rt,it){var at=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return!!nt&&(isNaN(rt)||(at?nt.startTime:nt.endTime)>=rt)&&(isNaN(it)||(at?nt.endTime:nt.startTime)<=it)}function ee(nt,rt,it){var at,st;if(!(it<rt)&&nt&&(nt.cues||nt.manualCueList)){var ot=nt.cues&&nt.cues.length>0?"native":"custom",lt="native"===ot?nt.cues:nt.manualCueList;if(!lt||0===lt.length)return;for(var ut=lt.length-1;ut>=0;ut--)!$(lt[ut],rt,it,!0)||(at=lt[ut],st=$t.getTime(),at.startTime>=st&&at.endTime<=st)||("native"===ot?nt.removeCue(lt[ut]):(K(lt[ut]),delete nt.manualCueList[ut]))}}function te(nt,rt,it){var at=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(nt&&(nt.cues||nt.manualCueList)){var st=nt.cues&&nt.cues.length>0?"native":"custom",ot="native"===st?nt.cues:nt.manualCueList;if(!ot||0===ot.length)return;for(var lt=ot.length-1;lt>=0;lt--)$(ot[lt],rt,it,at)&&("native"===st?(ot[lt].onexit&&ot[lt].onexit(),nt.removeCue(ot[lt])):(K(ot[lt]),delete nt.manualCueList[lt]))}}function ne(){var nt=document.getElementById("native-cue-style");if(!nt){(nt=document.createElement("style")).id="native-cue-style",document.head.appendChild(nt);var rt=nt.sheet,at=$t.getElement();try{at&&(at.id?rt.insertRule("#"+at.id+"::cue {background: transparent}",0):0!==at.classList.length?rt.insertRule("."+at.className+"::cue {background: transparent}",0):rt.insertRule("video::cue {background: transparent}",0))}catch(nt){it.info(""+nt.message)}}}function re(){var nt=document.getElementById("native-cue-style");nt&&document.head.removeChild(nt)}function ie(){if(Lt)for(;Lt.firstChild;)Lt.removeChild(Lt.firstChild)}return rt={initialize:function(){"undefined"!=typeof window&&"undefined"!=typeof navigator&&(at=window.VTTCue||window.TextTrackCue,st=[],lt=[],ut=-1,ht=0,Et=0,St=0,wt=0,Lt=null,Ct=null,Pt=null,Ot=!1,Bt=2147483647,Ft=null,Gt="requestAnimationFrame"in window,void 0!==document.fullscreenElement?kt="fullscreenElement":void 0!==document.webkitIsFullScreen?kt="webkitIsFullScreen":document.msFullscreenElement?kt="msFullscreenElement":document.mozFullScreen&&(kt="mozFullScreen"))},getStreamId:function(){return Yt.id},addTextTrack:function(nt){st.push(nt)},addCaptions:Z,createTracks:function(){var nt=Wt.get().streaming.text.dispatchForManualRendering;st.sort((function(nt,rt){return nt.index-rt.index})),Lt=$t.getTTMLRenderingDiv(),Ct=$t.getVttRenderingDiv();for(var rt,it,at,ct,ht,pt,Et=-1,St=0;St<st.length;St++){var wt=(it=(rt=st[St]).kind,at=void 0!==rt.id?rt.id:rt.lang,ct=rt.lang,ht=rt.isTTML,pt=rt.isEmbedded,$t.addTextTrack(it,at,ct,ht,pt));lt.push(wt),st[St].defaultTrack&&(wt.default=!0,Et=St);var Pt=W(St);Pt&&(Pt.mode=ot.Z.TEXT_SHOWING,Lt&&(st[St].isTTML||st[St].isEmbedded)?Pt.renderingType="html":Pt.renderingType="default"),Z(St,0,st[St].captionData),Kt.trigger(_t.Z.TEXT_TRACK_ADDED)}if(X.call(this,Et),Et>=0){Kt.on(_t.Z.PLAYBACK_METADATA_LOADED,(function e(){var nt=W(Et);nt&&"html"===nt.renderingType&&M.call(this,nt,!0),Kt.off(_t.Z.PLAYBACK_METADATA_LOADED,e,this)}),this);for(var kt=0;kt<st.length;kt++){var Ot=W(kt);Ot&&(Ot.mode=kt!==Et||nt?ot.Z.TEXT_HIDDEN:ot.Z.TEXT_SHOWING,Ot.manualMode=kt===Et?ot.Z.TEXT_SHOWING:ot.Z.TEXT_HIDDEN)}}Kt.trigger(dt.Z.TEXT_TRACKS_QUEUE_INITIALIZED,{index:ut,tracks:st,streamId:Yt.id})},getCurrentTrackIdx:function(){return ut},setCurrentTrackIdx:X,getTrackIdxForId:function(nt){for(var rt=-1,it=0;it<st.length;it++)if(st[it].id===nt){rt=it;break}return rt},getCurrentTrackInfo:function(){return st[ut]},setModeForTrackIdx:function(nt,rt){var it=W(nt);it&&it.mode!==rt&&(it.mode=rt),it&&it.manualMode!==rt&&(it.manualMode=rt)},deleteCuesFromTrackIdx:function(nt,rt,it){var at=W(nt);at&&te(at,rt,it)},deleteAllTextTracks:function(){for(var nt=lt?lt.length:0,rt=0;rt<nt;rt++){var it=W(rt);it&&te.call(this,it,Yt.start,Yt.start+Yt.duration,!1)}lt=[],st=[],Pt&&(clearInterval(Pt),Pt=null),Ut&&$t&&(Ut.unobserve($t.getElement()),Ut=null),ut=-1,ie.call(this)},manualCueProcessing:function(nt){var rt=z();if(rt&&rt.length>0){var it=rt[0].manualCueList;it&&it.length>0&&it.forEach((function(rt){rt.startTime<=nt&&rt.endTime>=nt&&!rt.isActive?(rt.isActive=!0,Wt.get().streaming.text.dispatchForManualRendering?G(rt):WebVTT.processCues(window,[rt],Ct,rt.cueID)):rt.isActive&&(rt.startTime>nt||rt.endTime<nt)&&(rt.isActive=!1,Wt.get().streaming.text.dispatchForManualRendering?q(rt):K(rt))}))}},disableManualTracks:function(){var nt=z();if(nt&&nt.length>0){var rt=nt[0].manualCueList;rt&&rt.length>0&&rt.forEach((function(nt){if(nt.isActive)if(nt.isActive=!1,Wt.get().streaming.text.dispatchForManualRendering)q(nt);else if(Ct)for(var rt=Ct.childNodes,it=0;it<rt.length;++it)rt[it].id===nt.cueID&&(Ct.removeChild(rt[it]),--it)}))}}},it=(0,pt.Z)(jt).getInstance().getLogger(rt),rt}Fa.__dashjs_factory_name="TextTracks";var uo=ht.Z.getClassFactory(Fa);function ka(){var nt,rt,it,at,st,ot,lt=this.context;function s(nt){var rt=nt.split(":"),it=rt.length-1;return nt=60*parseInt(rt[it-1],10)+parseFloat(rt[it]),2===it&&(nt+=3600*parseInt(rt[0],10)),nt}function u(nt){var rt=nt.split(at),it=rt[1].split(ot);return it.shift(),rt[1]=it[0],it.shift(),{cuePoints:rt,styles:l(it)}}function l(nt){var rt={};return nt.forEach((function(nt){if(nt.split(/:/).length>1){var it=nt.split(/:/)[1],at=!1;it&&-1!=it.search(/%/)&&(at=!0,it=parseInt(it.replace(/%/,""),10)),(nt.match(/align/)||nt.match(/A/))&&(rt.align=it),(nt.match(/line/)||nt.match(/L/))&&(rt.line="auto"===it?it:parseInt(it,10),at&&(rt.snapToLines=!1)),(nt.match(/position/)||nt.match(/P/))&&(rt.position=it),(nt.match(/size/)||nt.match(/S/))&&(rt.size=it)}})),rt}function c(nt,rt){for(var it,st=rt,ot="",lt="";""!==nt[st]&&st<nt.length;)st++;if((it=st-rt)>1)for(var ut=0;ut<it;ut++){if((lt=nt[rt+ut]).match(at)){ot="";break}ot+=lt,ut!==it-1&&(ot+="\n")}else(lt=nt[rt]).match(at)||(ot=lt);return ot}return nt={parse:function(nt){var ot,lt,ut=[];if(!nt)return ut;ot=(nt=nt.split(it)).length,lt=-1;for(var ct=0;ct<ot;ct++){var dt=nt[ct];if(dt.length>0&&"WEBVTT"!==dt&&dt.match(at)){var ht=u(dt),pt=ht.cuePoints,_t=ht.styles,Et=c(nt,ct+1),St=s(pt[0].replace(st,"")),wt=s(pt[1].replace(st,""));!isNaN(St)&&!isNaN(wt)&&St>=lt&&wt>St?""!==Et?(lt=St,ut.push({start:St,end:wt,data:Et,styles:_t})):rt.error("Skipping cue due to empty/malformed cue text"):rt.error("Skipping cue due to incorrect cue timing")}}return ut},getCaptionStyles:l},rt=(0,pt.Z)(lt).getInstance().getLogger(nt),it=/(?:\r\n|\r|\n)/gm,at=/-->/,st=/(^[\s]+|[\s]+$)/g,ot=/\s\b/g,nt}ka.__dashjs_factory_name="VTTParser";var co=ht.Z.getSingletonFactory(ka);function Za(){var nt,rt;return nt={parse:function(nt){var it=[];return rt.oncue=function(nt){nt.start=nt.startTime,nt.end=nt.endTime,nt.data=nt.text,nt.styles={align:nt.align,line:nt.line,position:nt.position,size:nt.size},it.push(nt)},rt.parse(nt),it}},function(){try{window&&window.WebVTT&&window.WebVTT.Parser&&(rt=new window.WebVTT.Parser(window,window.vttjs,window.WebVTT.StringDecoder()))}catch(nt){}}(),nt}Za.__dashjs_factory_name="VttCustomRenderingParser";var ho=ht.Z.getSingletonFactory(Za);function Ga(){var nt,rt,it=this.context,at=(0,ct.Z)(it).getInstance(),st=0;return nt={parse:function(nt,it,ot,lt,ut){var ct,ht,pt,Et="",St=[],wt={},Lt={},Ct="",Pt="",kt={onOpenTag:function(nt,it,st){if(st[" imagetype"]&&!st[" imageType"]&&(at.trigger(_t.Z.CONFORMANCE_VIOLATION,{level:Zi.LEVELS.ERROR,event:Zi.EVENTS.NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE}),st[" imageType"]=st[" imagetype"]),"image"===it&&("http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt"===nt||"http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"===nt)){if(!st[" imageType"]||"PNG"!==st[" imageType"].value)return void rt.warn("smpte-tt imageType != PNG. Discarded");Ct=st["http://www.w3.org/XML/1998/namespace id"].value}},onCloseTag:function(){Ct&&(Lt[Ct]=Pt.trim()),Pt="",Ct=""},onText:function(nt){Ct&&(Pt+=nt)}};if(!nt)throw Et="no ttml data to parse",new Error(Et);wt.data=nt,at.trigger(dt.Z.TTML_TO_PARSE,wt);var Ot=(0,oo.fromXML)(wt.data,(function(nt){Et=nt}),kt);at.trigger(dt.Z.TTML_PARSED,{ttmlString:wt.data,ttmlDoc:Ot});var Ft,Bt=Ot.getMediaTimeEvents();for(pt=0;pt<Bt.length;pt++){var Ut=(0,oo.generateISD)(Ot,Bt[pt],(function(nt){Et=nt}));Ut.contents.some((function(nt){return nt.contents.length}))&&(ct=Bt[pt]+it)<(ht=Bt[pt+1]+it)&&St.push({start:ct,end:ht,type:"html",cueID:(Ft="cue_TTML_"+st,st++,Ft),isd:Ut,images:ut,embeddedImages:Lt})}if(""!==Et)throw rt.error(Et),new Error(Et);return St}},rt=(0,pt.Z)(it).getInstance().getLogger(nt),nt}Ga.__dashjs_factory_name="TTMLParser";var fo=ht.Z.getSingletonFactory(Ga);function Ya(nt,rt){var it=Object.keys(nt);if(Object.getOwnPropertySymbols){var at=Object.getOwnPropertySymbols(nt);rt&&(at=at.filter((function(rt){return Object.getOwnPropertyDescriptor(nt,rt).enumerable}))),it.push.apply(it,at)}return it}function ja(nt){for(var rt=1;rt<arguments.length;rt++){var it=null!=arguments[rt]?arguments[rt]:{};rt%2?Ya(Object(it),!0).forEach((function(rt){Ha(nt,rt,it[rt])})):Object.getOwnPropertyDescriptors?Object.defineProperties(nt,Object.getOwnPropertyDescriptors(it)):Ya(Object(it)).forEach((function(rt){Object.defineProperty(nt,rt,Object.getOwnPropertyDescriptor(it,rt))}))}return nt}function Ha(nt,rt,it){return rt in nt?Object.defineProperty(nt,rt,{value:it,enumerable:!0,configurable:!0,writable:!0}):nt[rt]=it,nt}function Va(nt,rt){(null==rt||rt>nt.length)&&(rt=nt.length);for(var it=0,at=new Array(rt);it<rt;it++)at[it]=nt[it];return at}function Ka(nt){var rt,it,at,st=this.context,lt=(0,ct.Z)(st).getInstance(),ut=(0,pn.Z)(st).getInstance(),dt=nt.adapter,ht=nt.baseURLController;function g(nt,rt){var it,st,lt=!1;if(ht.resolve()){var ct=dt.getVoRepresentations(nt);ct&&ct.length>0&&(it=ht.resolve(ct[0].path).url)}var pt=nt.essentialPropertiesAsArray.filter((function(nt){return nt.schemeIdUri&&nt.schemeIdUri===ot.Z.FONT_DOWNLOAD_DVB_SCHEME})),_t=nt.supplementalPropertiesAsArray.filter((function(nt){return nt.schemeIdUri&&nt.schemeIdUri===ot.Z.FONT_DOWNLOAD_DVB_SCHEME}));pt.length>0?(lt=!0,st=pt):st=_t,st.forEach((function(st){if(function(nt){return!(!(nt.value&&"1"===nt.value&&nt.dvbUrl&&nt.dvbUrl.length>0&&nt.dvbFontFamily&&nt.dvbFontFamily.length>0&&nt.dvbMimeType)||nt.dvbMimeType!==ot.Z.OFF_MIMETYPE&&nt.dvbMimeType!==ot.Z.WOFF_MIMETYPE)}(st)){var ct=(dt=st.dvbUrl,ht=it,ut.isPathAbsolute(dt)?dt:ut.isRelative(dt)?ht?ut.resolve(dt,ht):ut.resolve(dt):dt);at.push({fontFamily:st.dvbFontFamily,url:ct,mimeType:st.dvbMimeType,trackId:nt.id,streamId:rt,isEssential:lt,status:"unloaded",fontFace:new FontFace(st.dvbFontFamily,"url(".concat(ct,")"),{display:"swap"})})}var dt,ht}))}function h(nt,rt){var it=at[nt];at[nt]=ja(ja({},it),{},{status:rt})}function p(){at=[]}return rt={addFontsFromTracks:function(nt,rt){if(nt&&Array.isArray(nt)&&rt)for(var it=0;it<nt.length;it++)g(nt[it],rt)},downloadFonts:function(){for(var e=function(nt){var rt=at[nt];document.fonts.add(rt.fontFace),lt.trigger(_t.Z.DVB_FONT_DOWNLOAD_ADDED,rt),rt.fontFace.load().then((function(){h(nt,"loaded"),lt.trigger(_t.Z.DVB_FONT_DOWNLOAD_COMPLETE,rt)}),(function(at){h(nt,"error"),it.debug("Font download error: ",at),lt.trigger(_t.Z.DVB_FONT_DOWNLOAD_FAILED,rt)}))},nt=0;nt<at.length;nt++)e(nt)},getFonts:function(){return at},getFontsForTrackId:function(nt){return at.filter((function(rt){return rt.trackId&&rt.trackId===nt}))},reset:function(){!function(){var nt,rt=function(nt,rt){var it;if("undefined"==typeof Symbol||null==nt[Symbol.iterator]){if(Array.isArray(nt)||(it=function(nt,rt){if(nt){if("string"==typeof nt)return Va(nt,rt);var it=Object.prototype.toString.call(nt).slice(8,-1);return"Object"===it&&nt.constructor&&(it=nt.constructor.name),"Map"===it||"Set"===it?Array.from(nt):"Arguments"===it||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(it)?Va(nt,rt):void 0}}(nt))||rt){it&&(nt=it);var at=0,i=function(){};return{s:i,n:function(){return at>=nt.length?{done:!0}:{done:!1,value:nt[at++]}},e:function(nt){throw nt},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var st,ot=!0,lt=!1;return{s:function(){it=nt[Symbol.iterator]()},n:function(){var nt=it.next();return ot=nt.done,nt},e:function(nt){lt=!0,st=nt},f:function(){try{ot||null==it.return||it.return()}finally{if(lt)throw st}}}}(at);try{for(rt.s();!(nt=rt.n()).done;){var st=nt.value,ot=document.fonts.delete(st.fontFace);it.debug("Removal of fontFamily: ".concat(st.fontFamily," was ").concat(ot?"successful":"unsuccessful"))}}catch(nt){rt.e(nt)}finally{rt.f()}}(),p()}},it=(0,pt.Z)(st).getInstance().getLogger(rt),p(),rt}Ka.__dashjs_factory_name="DVBFonts";var po=ht.Z.getClassFactory(Ka);function Wa(nt){var rt,it,at,st,lt,ut,ht,Et,St,wt,Lt,Ct,Pt,kt,Ot=this.context,Ft=nt.adapter,Bt=nt.errHandler,Ut=nt.manifestModel,Gt=nt.mediaController,Ht=nt.baseURLController,jt=nt.videoModel,Kt=nt.settings;function N(nt){if(kt.error("Could not download ".concat(nt.isEssential?"an essential":"a"," font - fontFamily: ").concat(nt.fontFamily,", url: ").concat(nt.url)),nt.isEssential){var rt=st[nt.streamId].getTrackIdxForId(nt.trackId);st[nt.streamId].setModeForTrackIdx(rt,ot.Z.TEXT_DISABLED)}}function C(nt){if(kt.debug("Successfully downloaded ".concat(nt.isEssential?"an essential":"a"," font - fontFamily: ").concat(nt.fontFamily,", url: ").concat(nt.url)),nt.isEssential){var rt=st[nt.streamId].getTrackIdxForId(nt.trackId);rt===st[nt.streamId].getCurrentTrackIdx()?st[nt.streamId].setModeForTrackIdx(rt,ot.Z.TEXT_SHOWING):st[nt.streamId].setModeForTrackIdx(rt,ot.Z.TEXT_HIDDEN)}}function D(nt){var rt=nt.tracks,at=nt.index,lt=nt.streamId;if(!1===Kt.get().streaming.text.defaultEnabled&&!P()||Ct)L(lt,-1);else{var ut=Gt.getCurrentTrackFor(ot.Z.TEXT,lt);if(ut){var ct={lang:ut.lang,role:ut.roles[0],index:ut.index,codec:ut.codec,accessibility:ut.accessibility[0]};rt.some((function(nt,rt){if(Gt.matchSettings(ct,nt))return L(lt,rt),at=rt,!0}))}St=!1}it[lt].lastEnabledIndex=at,Et.trigger(_t.Z.TEXT_TRACKS_ADDED,{enabled:P(),index:at,tracks:rt,streamId:lt}),Lt=!0,Pt.addFontsFromTracks(rt,lt),Pt.getFonts().forEach((function(nt){if(nt.isEssential){var rt=st[nt.streamId].getTrackIdxForId(nt.trackId);st[nt.streamId].setModeForTrackIdx(rt,ot.Z.TEXT_DISABLED)}})),Pt.downloadFonts()}function O(nt){try{var rt=nt.streamId;if(!st[rt]||isNaN(nt.time))return;st[rt].manualCueProcessing(nt.time)}catch(nt){}}function M(nt){try{var rt=nt.streamId;if(!st[rt])return;st[rt].disableManualTracks()}catch(nt){}}function P(){var nt=!0;return St&&!wt&&(nt=!1),nt}function L(nt,rt){(St=-1===rt)&&Gt&&Gt.saveTextSettingsDisabled();var it=F(nt);if(it!==rt&&st[nt]){st[nt].disableManualTracks();var lt=st[nt].getCurrentTrackInfo(),ut=lt?jt.getTextTrack(lt.kind,lt.id,lt.lang,lt.isTTML,lt.isEmbedded):null;ut&&ut.mode!==ot.Z.TEXT_DISABLED&&st[nt].setModeForTrackIdx(it,ot.Z.TEXT_HIDDEN),st[nt].setCurrentTrackIdx(rt),lt=st[nt].getCurrentTrackInfo();var ct=Kt.get().streaming.text.dispatchForManualRendering;lt&&!ct&&lt.mode!==ot.Z.TEXT_DISABLED&&st[nt].setModeForTrackIdx(rt,ot.Z.TEXT_SHOWING),lt&&lt.isFragmented&&!lt.isEmbedded?function(nt,rt,it){if(at[nt])for(var lt=at[nt].getConfig().fragmentedTracks,ut=0;ut<lt.length;ut++){var ct=lt[ut];if(rt.lang===ct.lang&&(ct.id?rt.id===ct.id:rt.index===ct.index)){var ht=Gt.getCurrentTrackFor(ot.Z.TEXT,nt);(ct.id?ht.id!==ct.id:ht.index!==ct.index)?(st[nt].deleteCuesFromTrackIdx(it),at[nt].setCurrentFragmentedTrackIdx(ut)):-1===it&&Et.trigger(dt.Z.SET_FRAGMENTED_TEXT_AFTER_DISABLED,{},{streamId:nt,mediaType:ot.Z.TEXT})}}}(nt,lt,it):lt&&!lt.isFragmented&&function(nt,rt){Et.trigger(dt.Z.SET_NON_FRAGMENTED_TEXT,{currentTrackInfo:rt},{streamId:nt,mediaType:ot.Z.TEXT})}(nt,lt),Gt.setTrack(lt)}}function F(nt){return st[nt].getCurrentTrackIdx()}function x(){at={},st={},it={},St=!0,Lt=!1,Ct=!1}return rt={deactivateStream:function(nt){if(nt){var rt=nt.id;at[rt]&&at[rt].resetMediaInfos(),st[rt]&&st[rt].deleteAllTextTracks()}},initialize:function(){Pt=po(Ot).create({adapter:Ft,baseURLController:Ht}),Et.on(dt.Z.TEXT_TRACKS_QUEUE_INITIALIZED,D,rt),Et.on(dt.Z.DVB_FONT_DOWNLOAD_FAILED,N,rt),Et.on(dt.Z.DVB_FONT_DOWNLOAD_COMPLETE,C,rt),Kt.get().streaming.text.webvtt.customRenderingEnabled&&(Et.on(dt.Z.PLAYBACK_TIME_UPDATED,O,rt),Et.on(dt.Z.PLAYBACK_SEEKING,M,rt))},initializeForStream:function(nt){var rt=nt.id,ot=uo(Ot).create({videoModel:jt,settings:Kt,streamInfo:nt});ot.initialize(),st[rt]=ot;var ct=so(Ot).create({errHandler:Bt,adapter:Ft,dvbFonts:Pt,manifestModel:Ut,mediaController:Gt,videoModel:jt,textTracks:ot,vttParser:lt,vttCustomRenderingParser:ut,ttmlParser:ht,streamInfo:nt,settings:Kt});ct.initialize(),at[rt]=ct,it[rt]={},it[rt].lastEnabledIndex=-1},createTracks:function(nt){var rt=nt.id;st[rt]&&st[rt].createTracks()},getTextSourceBuffer:function(nt){var rt=nt.id;if(at&&at[rt])return at[rt]},getAllTracksAreDisabled:function(){return St},addEmbeddedTrack:function(nt,rt){var it=nt.id;at[it]&&at[it].addEmbeddedTrack(rt)},enableText:function(nt,rt){return(0,ln.PS)(rt,"boolean"),P()!==rt&&(rt&&L(nt,it[nt].lastEnabledIndex),rt||(it[nt].lastEnabledIndex=F(nt),Lt?L(nt,-1):Ct=!0)),!0},isTextEnabled:P,setTextTrack:L,getCurrentTrackIdx:F,enableForcedTextStreaming:function(nt){return(0,ln.PS)(nt,"boolean"),wt=nt,!0},addMediaInfosToBuffer:function(nt,rt,it){var st=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,ot=nt.id;at[ot]&&at[ot].addMediaInfos(rt,it,st)},reset:function(){Pt.reset(),x(),Et.off(dt.Z.TEXT_TRACKS_QUEUE_INITIALIZED,D,rt),Et.off(dt.Z.DVB_FONT_DOWNLOAD_FAILED,N,rt),Et.off(dt.Z.DVB_FONT_DOWNLOAD_COMPLETE,C,rt),Kt.get().streaming.text.webvtt.customRenderingEnabled&&(Et.off(dt.Z.PLAYBACK_TIME_UPDATED,O,rt),Et.off(dt.Z.PLAYBACK_SEEKING,M,rt)),Object.keys(at).forEach((function(nt){at[nt].resetEmbedded(),at[nt].reset()}))}},wt=!1,Lt=!1,Ct=!1,lt=co(Ot).getInstance(),ut=ho(Ot).getInstance(),ht=fo(Ot).getInstance(),Et=(0,ct.Z)(Ot).getInstance(),kt=(0,pt.Z)(Ot).getInstance().getLogger(rt),x(),rt}Wa.__dashjs_factory_name="TextController";var mo=ht.Z.getClassFactory(Wa);function Qa(){var nt,rt,it,at,St,wt,Lt,Ct,Pt,kt,Gt,Ht,jt,Kt,$t,Yt,Wt,Qt,en,nn,an,hn,mn,gn,_n,vn,En,Tn,bn,An,Rn,In,Ln,Dn,Mn,Nn,xn,Un,Hn,Kn="You must first call initialize() and set a source before calling this method",Yn="You must first call initialize() and set a valid source and view before calling this method",Wn="You must first call attachView() to set the video element before calling this method",Jn="You must first call attachSource() with a valid source before calling this method",er="MediaPlayer not initialized!",or=this.context,dr=(0,ct.Z)(or).getInstance(),fr=(0,Bt.Z)(or).getInstance(),yr=(0,pt.Z)(or).getInstance({settings:fr});function fe(){Ie(null),be(null),at=null,Kt&&(Kt.reset(),Kt=null),$t&&($t.reset(),$t=null),nn&&nn.reset(),fr.reset(),Wt&&(Wt.reset(),Wt=null)}function de(){return!!it&&!!Nn.getElement()}function ge(){return(0,Is.e)()}function he(){if(!Lt)throw Yn;return Tn.isPaused()}function pe(){if(!Lt)throw Yn;return Tn.getIsDynamic()}function me(nt){var rt=_n&&_n.hasVideoTrack()?ot.Z.VIDEO:ot.Z.AUDIO,it=In.getCurrentDVRInfo(rt);if(!it)return 0;var at=Tn.getOriginalLiveDelay(),st=it.range.start+nt;return st>it.range.end-at&&(st=it.range.end-at),st}function ye(nt){if(!Lt)throw Yn;var rt=Se().currentTime;if(void 0!==nt)rt=_n.getTimeRelativeToStreamId(rt,nt);else if(Tn.getIsDynamic()){var it=_n&&_n.hasVideoTrack()?ot.Z.VIDEO:ot.Z.AUDIO,at=In.getCurrentDVRInfo(it);rt=null===at||0===rt?0:Math.max(0,rt-at.range.start)}return rt}function Ee(){if(!Lt)throw Yn;var nt=Se().duration;if(Tn.getIsDynamic()){var rt=_n&&_n.hasVideoTrack()?ot.Z.VIDEO:ot.Z.AUDIO,it=In.getCurrentDVRInfo(rt);nt=it?it.range.end-it.range.start:0}return nt}function ve(nt){(0,ln.PS)(nt,"boolean"),Ct=nt}function _e(){nn.restoreDefaultUTCTimingSources()}function Te(){return In}function Se(){if(!Nn.getElement())throw Wn;return Nn.getElement()}function be(nt){if(!St)throw er;Nn.setElement(nt),nt&&(De(),function(){if(!$t){var nt=dashjs.MetricsReporting;if("function"==typeof nt){var rt=nt(or).create();$t=rt.createMetricsReporting({debug:yr,eventBus:dr,mediaElement:Se(),adapter:Qt,dashMetrics:In,mediaPlayerModel:en,events:dt.Z,constants:ot.Z,metricsConstants:ut.Z})}}}(),function(){if(!Yt){var nt=dashjs.MssHandler;"function"==typeof nt&&(Ft.extend(nt.errors),Yt=nt(or).create({eventBus:dr,mediaPlayerModel:en,dashMetrics:In,manifestModel:Ln,playbackController:Tn,streamController:_n,protectionController:Kt,baseURLController:hn,errHandler:an,events:dt.Z,constants:ot.Z,debug:yr,initSegmentType:Ut.w.INIT_SEGMENT_TYPE,BASE64:to,ISOBoxer:no,settings:fr}))}}(),_n&&_n.switchToVideoElement(Pt)),Lt&&we(),Pe(Pt)}function Ae(nt){if(!wt)throw Kn;var rt=_n.getActiveStreamInfo();return rt?jt.getTracksFor(nt,rt.id):[]}function Ie(nt){var rt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;if(!St)throw er;"string"==typeof nt&&xn.initialize(nt),null==rt&&(rt=NaN),isNaN(rt)||(rt=Math.max(0,rt)),Pt=rt,it=nt,(wt||Lt)&&we(),de()&&Pe(Pt)}function Re(){if(!wt)throw Kn;var nt=_n.getActiveStreamInfo();return nt?_n.getStreamById(nt.id):null}function we(){Lt=!1,wt=!1,Qt.reset(),_n.reset(),En.reset(),Rn.reset(),Tn.reset(),bn.reset(),An.reset(),kt.reset(),jt.reset(),Hn.reset(),Kt&&(fr.get().streaming.protection.keepProtectionMediaKeys?Kt.stop():(Kt.reset(),Kt=null,De())),vn.reset(),Dn.reset(),Mn.reset()}function Ne(){var nt=Ce();_n||(_n=Hi(or).getInstance()),vn||(vn=mo(or).create({errHandler:an,manifestModel:Ln,adapter:Qt,mediaController:jt,baseURLController:hn,videoModel:Nn,settings:fr})),gn.setConfig({capabilities:mn,customParametersModel:nn,adapter:Qt,settings:fr,manifestModel:Ln,errHandler:an}),_n.setConfig({capabilities:mn,capabilitiesFilter:gn,manifestLoader:nt,manifestModel:Ln,mediaPlayerModel:en,customParametersModel:nn,protectionController:Kt,textController:vn,adapter:Qt,dashMetrics:In,errHandler:an,timelineConverter:Ht,videoModel:Nn,playbackController:Tn,serviceDescriptionController:bn,contentSteeringController:An,abrController:kt,mediaController:jt,settings:fr,baseURLController:hn,uriFragmentModel:xn,segmentBaseController:Hn}),En.setConfig({settings:fr,playbackController:Tn,streamController:_n,videoModel:Nn,timelineConverter:Ht,adapter:Qt}),Tn.setConfig({streamController:_n,serviceDescriptionController:bn,dashMetrics:In,adapter:Qt,videoModel:Nn,timelineConverter:Ht,settings:fr}),Rn.setConfig({streamController:_n,playbackController:Tn,mediaPlayerModel:en,videoModel:Nn,settings:fr}),kt.setConfig({streamController:_n,domStorage:Un,mediaPlayerModel:en,customParametersModel:nn,cmsdModel:Mn,dashMetrics:In,adapter:Qt,videoModel:Nn,settings:fr}),Dn.setConfig({abrController:kt,dashMetrics:In,playbackController:Tn}),Mn.setConfig({}),kt.initialize(),_n.initialize(Ct,at),vn.initialize(),En.initialize(),Rn.initialize(),Dn.initialize(),Mn.initialize(),An.initialize(),Hn.initialize()}function Ce(){return es(or).create({debug:yr,errHandler:an,dashMetrics:In,mediaPlayerModel:en,requestModifier:(0,fn.Z)(or).getInstance(),mssHandler:Yt,settings:fr})}function De(){if(Kt)return Kt;var nt=dashjs.Protection;if("function"==typeof nt){var rt=nt(or).create();return dt.Z.extend(nt.events),_t.Z.extend(nt.events,{publicOnly:!0}),Ft.extend(nt.errors),mn||(mn=(0,ns.Z)(or).getInstance()),Kt=rt.createProtectionSystem({debug:yr,errHandler:an,videoModel:Nn,customParametersModel:nn,capabilities:mn,eventBus:dr,events:dt.Z,BASE64:to,constants:ot.Z,cmcdModel:Dn,settings:fr})}return null}function Oe(){if(!St)throw er;if(Wt)return Wt;var nt=dashjs.OfflineController;if("function"==typeof nt){dt.Z.extend(nt.events),_t.Z.extend(nt.events,{publicOnly:!0}),Ft.extend(nt.errors);var rt=Ce(),it=ki(or).create();return it.setConfig({manifestModel:Ln,adapter:Qt,manifestLoader:rt,errHandler:an,contentSteeringController:An}),Wt=nt(or).create({debug:yr,manifestUpdater:it,baseURLController:hn,manifestLoader:rt,manifestModel:Ln,mediaPlayerModel:en,abrController:kt,playbackController:Tn,adapter:Qt,errHandler:an,dashMetrics:In,timelineConverter:Ht,segmentBaseController:Hn,schemeLoaderFactory:Gt,eventBus:dr,events:dt.Z,errors:Ft,constants:ot.Z,settings:fr,dashConstants:lt.Z,urlUtils:(0,pn.Z)(or).getInstance()})}return null}function Me(nt){var rt=_n&&_n.hasVideoTrack()?ot.Z.VIDEO:ot.Z.AUDIO,it=In.getCurrentDVRInfo(rt);return it?nt+(it.manifestInfo.availableFrom.getTime()/1e3+it.range.start):0}function Pe(){var nt=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN;Wt&&Wt.resetRecords(),!wt&&it&&(wt=!0,rt.info("Streaming Initialized"),Ne(),"string"==typeof it?_n.load(it,nt):_n.loadWithManifest(it,nt)),!Lt&&de()&&(Lt=!0,rt.info("Playback Initialized"))}return nt={initialize:function(nt,it,at){var lt=arguments.length>3&&void 0!==arguments[3]?arguments[3]:NaN;mn||(mn=(0,ns.Z)(or).getInstance()).setConfig({settings:fr}),an||(an=ts(or).getInstance()),mn.supportsMediaSource()?(St||(St=!0,Ht=eo(or).getInstance(),kt||(kt=gs(or).getInstance()).setConfig({settings:fr}),Gt||(Gt=ui(or).getInstance()),Tn||(Tn=Et(or).getInstance()),jt||(jt=ia(or).getInstance()),_n||(_n=Hi(or).getInstance()),En||(En=ji(or).getInstance()),Rn||(Rn=qi(or).getInstance()),bn||(bn=Wi(or).getInstance()),An||(An=Mi(or).getInstance()),gn||(gn=rs(or).getInstance()),Qt=Us(or).getInstance(),Ln=ss(or).getInstance(),Dn=Dr(or).getInstance(),Mn=ni(or).getInstance(),In=Js(or).getInstance({settings:fr}),Un=Rs(or).getInstance({settings:fr}),Qt.setConfig({constants:ot.Z,cea608parser:st(),errHandler:an,BASE64:to}),hn||(hn=pa(or).create()),hn.setConfig({adapter:Qt,contentSteeringController:An}),bn.setConfig({adapter:Qt}),Hn||(Hn=Ms(or).getInstance({dashMetrics:In,mediaPlayerModel:en,errHandler:an,baseURLController:hn,events:dt.Z,eventBus:dr,debug:yr,boxParser:(0,bi.Z)(or).getInstance(),requestModifier:(0,fn.Z)(or).getInstance(),errors:Ft})),jt.setConfig({domStorage:Un,settings:fr,customParametersModel:nn}),en.setConfig({playbackController:Tn,serviceDescriptionController:bn}),An.setConfig({adapter:Qt,errHandler:an,dashMetrics:In,mediaPlayerModel:en,manifestModel:Ln,serviceDescriptionController:bn,eventBus:dr,requestModifier:(0,fn.Z)(or).getInstance()}),_e(),ve(void 0===at||at),Oe()),nt&&be(nt),it&&Ie(it,lt),rt.info("[dash.js "+ge()+"] MediaPlayer has been initialized")):an.error(new Ot.Z(Ft.CAPABILITY_MEDIASOURCE_ERROR_CODE,Ft.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE))},setConfig:function(nt){nt&&(nt.capabilities&&(mn=nt.capabilities),nt.capabilitiesFilter&&(gn=nt.capabilitiesFilter),nt.streamController&&(_n=nt.streamController),nt.textController&&(vn=nt.textController),nt.gapController&&(En=nt.gapController),nt.playbackController&&(Tn=nt.playbackController),nt.serviceDescriptionController&&(bn=nt.serviceDescriptionController),nt.contentSteeringController&&(An=nt.contentSteeringController),nt.catchupController&&(Rn=nt.catchupController),nt.mediaPlayerModel&&(en=nt.mediaPlayerModel),nt.customParametersModel&&(nn=nt.customParametersModel),nt.abrController&&(kt=nt.abrController),nt.schemeLoaderFactory&&(Gt=nt.schemeLoaderFactory),nt.mediaController&&(jt=nt.mediaController),nt.settings&&(fr=nt.settings))},on:function(nt,rt,it,at){dr.on(nt,rt,it,at)},off:function(nt,rt,it){dr.off(nt,rt,it)},extend:function(nt,rt,it){ht.Z.extend(nt,rt,it,or)},attachView:be,attachSource:Ie,refreshManifest:function(nt){if(!St)throw er;if(!de())return nt(null,Jn);var rt=this;"function"==typeof nt&&dr.on(dt.Z.INTERNAL_MANIFEST_LOADED,(function n(it){dr.off(dt.Z.INTERNAL_MANIFEST_LOADED,n,rt),it.error?nt(null,it.error):nt(it.manifest)}),rt),_n.refreshManifest()},isReady:de,preload:function(){if(!Nn.getElement()&&!wt){if(!it)throw Jn;Pe(Pt)}},play:function(){if(!Lt)throw Yn;(!Ct||he()&&Lt)&&Tn.play(!0)},isPaused:he,pause:function(){if(!Lt)throw Yn;Tn.pause()},isSeeking:function(){if(!Lt)throw Yn;return Tn.isSeeking()},isDynamic:pe,getLowLatencyModeEnabled:function(){if(!Lt)throw Yn;return Tn.getLowLatencyModeEnabled()},seek:function(nt){if(!Lt)throw Yn;if((0,ln.PS)(nt,"number"),isNaN(nt))throw ot.Z.BAD_ARGUMENT_ERROR;nt<0&&(nt=0);var rt=Tn.getIsDynamic()?me(nt):nt,it=Se();!Tn.getIsDynamic()&&it.duration&&(rt=Math.min(it.duration,rt)),Tn.seek(rt,!1,!1,!0)},seekToOriginalLive:function(){Lt&&pe()&&Tn.seekToOriginalLive()},setPlaybackRate:function(nt){Se().playbackRate=nt},getPlaybackRate:function(){return Se().playbackRate},setMute:function(nt){(0,ln.PS)(nt,"boolean"),Se().muted=nt},isMuted:function(){return Se().muted},setVolume:function(nt){if("number"!=typeof nt||isNaN(nt)||nt<0||nt>1)throw ot.Z.BAD_ARGUMENT_ERROR;Se().volume=nt},getVolume:function(){return Se().volume},time:ye,duration:Ee,timeAsUTC:function(){if(!Lt)throw Yn;return ye()<0?NaN:Me(ye())},durationAsUTC:function(){if(!Lt)throw Yn;return Me(Ee())},getActiveStream:Re,getDVRWindowSize:function(){var nt=_n&&_n.hasVideoTrack()?ot.Z.VIDEO:ot.Z.AUDIO,rt=In.getCurrentDVRInfo(nt);return rt?rt.manifestInfo.dvrWindowSize:0},getDVRSeekOffset:me,getAvailableBaseUrls:function(){var nt=Ln.getValue();return nt?hn.getBaseUrls(nt):[]},getAvailableLocations:function(){var nt=Ln.getValue();if(!nt)return[];var rt=Qt.getLocation(nt),it=An.getSynthesizedLocationElements(rt);return rt.concat(it)},getTargetLiveDelay:function(){if(!Lt)throw Yn;return Tn.getOriginalLiveDelay()},convertToTimeCode:function(nt){nt=Math.max(nt,0);var rt=Math.floor(nt/3600),it=Math.floor(nt%3600/60),at=Math.floor(nt%3600%60);return(0===rt?"":rt<10?"0"+rt.toString()+":":rt.toString()+":")+(it<10?"0"+it.toString():it.toString())+":"+(at<10?"0"+at.toString():at.toString())},formatUTC:function(nt,rt,it){var at=arguments.length>3&&void 0!==arguments[3]&&arguments[3],st=new Date(1e3*nt),ot=st.toLocaleDateString(rt),lt=st.toLocaleTimeString(rt,{hour12:it});return at?lt+" "+ot:lt},getVersion:ge,getDebug:function(){return yr},getBufferLength:function(nt){var it=[ot.Z.VIDEO,ot.Z.AUDIO,ot.Z.TEXT];if(nt)return-1!==it.indexOf(nt)?Te().getCurrentBufferLevel(nt)||NaN:(rt.warn("getBufferLength requested for invalid type"),NaN);var at=it.map((function(nt){return Ae(nt).length>0?Te().getCurrentBufferLevel(nt):Number.MAX_VALUE})).reduce((function(nt,rt){return Math.min(nt,rt)}));return at===Number.MAX_VALUE?NaN:at},getTTMLRenderingDiv:function(){return Nn?Nn.getTTMLRenderingDiv():null},getVideoElement:Se,getSource:function(){if(!it)throw Jn;return it},updateSource:function(nt){it=nt,_n.load(it)},getCurrentLiveLatency:function(){if(!St)throw er;return Lt?Tn.getCurrentLiveLatency():NaN},getTopBitrateInfoFor:function(nt){if(!wt)throw Kn;return kt.getTopBitrateInfoFor(nt)},setAutoPlay:ve,getAutoPlay:function(){return Ct},getDashMetrics:Te,getQualityFor:function(nt){if(!wt)throw Kn;if(nt===ot.Z.IMAGE){var rt=Re();if(!rt)return-1;var it=rt.getThumbnailController();return it?it.getCurrentTrackIndex():-1}return kt.getQualityFor(nt)},setQualityFor:function(nt,rt){var it=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!wt)throw Kn;if(nt===ot.Z.IMAGE){var at=Re();if(!at)return;var st=at.getThumbnailController();st&&st.setTrackByIndex(rt)}kt.setPlaybackQuality(nt,_n.getActiveStreamInfo(),rt,{forceReplace:it})},updatePortalSize:function(){kt.setElementSize(),kt.setWindowResizeEventCalled(!0)},enableText:function(nt){var rt=_n.getActiveStreamInfo();return!(!rt||!vn)&&vn.enableText(rt.id,nt)},enableForcedTextStreaming:function(nt){return!(!_n.getActiveStreamInfo()||!vn)&&vn.enableForcedTextStreaming(nt)},isTextEnabled:function(){var nt=_n.getActiveStreamInfo();return!(!nt||!vn)&&vn.isTextEnabled(nt)},setTextTrack:function(nt){if(!Lt)throw Yn;var rt=_n.getActiveStreamInfo();rt&&vn&&vn.setTextTrack(rt.id,nt)},getBitrateInfoListFor:function(nt){if(!wt)throw Kn;var rt=Re();return rt?rt.getBitrateListFor(nt):[]},getStreamsFromManifest:function(nt){if(!wt)throw Kn;return Qt.getStreamsInfo(nt)},getTracksFor:Ae,getTracksForTypeFromManifest:function(nt,rt,it){if(!wt)throw Kn;return(it=it||Qt.getStreamsInfo(rt,1)[0])?Qt.getAllMediaInfoForType(it,nt,rt):[]},getCurrentTrackFor:function(nt){if(!wt)throw Kn;var rt=_n.getActiveStreamInfo();return jt.getCurrentTrackFor(nt,rt.id)},setInitialMediaSettingsFor:function(nt,rt){if(!St)throw er;jt.setInitialSettings(nt,rt)},getInitialMediaSettingsFor:function(nt){if(!St)throw er;return jt.getInitialSettings(nt)},setCurrentTrack:function(nt){var rt=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!wt)throw Kn;jt.setTrack(nt,rt)},addABRCustomRule:function(nt,rt,it){nn.addAbrCustomRule(nt,rt,it)},removeABRCustomRule:function(nt){nn.removeAbrCustomRule(nt)},removeAllABRCustomRule:function(){nn.removeAllAbrCustomRule()},getABRCustomRules:function(){return nn.getAbrCustomRules()},getAverageThroughput:function(nt){var rt=kt.getThroughputHistory(),it=Tn.getIsDynamic();return rt?rt.getAverageThroughput(nt,it):0},retrieveManifest:function(nt,rt){var it=Ce(),at=this;dr.on(dt.Z.INTERNAL_MANIFEST_LOADED,(function e(nt){nt.error?rt(null,nt.error):rt(nt.manifest),dr.off(dt.Z.INTERNAL_MANIFEST_LOADED,e,at),it.reset()}),at),xn.initialize(nt),it.load(nt)},addUTCTimingSource:function(nt,rt){nn.addUTCTimingSource(nt,rt)},removeUTCTimingSource:function(nt,rt){nn.removeUTCTimingSource(nt,rt)},clearDefaultUTCTimingSources:function(){nn.clearDefaultUTCTimingSources()},restoreDefaultUTCTimingSources:_e,setXHRWithCredentialsForType:function(nt,rt){nn.setXHRWithCredentialsForType(nt,rt)},getXHRWithCredentialsForType:function(nt){return nn.getXHRWithCredentialsForType(nt)},getProtectionController:function(){return De()},attachProtectionController:function(nt){Kt=nt},setProtectionData:function(nt){at=nt,_n&&_n.setProtectionData(at)},registerLicenseRequestFilter:function(nt){nn.registerLicenseRequestFilter(nt)},registerLicenseResponseFilter:function(nt){nn.registerLicenseResponseFilter(nt)},unregisterLicenseRequestFilter:function(nt){nn.unregisterLicenseRequestFilter(nt)},unregisterLicenseResponseFilter:function(nt){nn.unregisterLicenseResponseFilter(nt)},registerCustomCapabilitiesFilter:function(nt){nn.registerCustomCapabilitiesFilter(nt)},unregisterCustomCapabilitiesFilter:function(nt){nn.unregisterCustomCapabilitiesFilter(nt)},setCustomInitialTrackSelectionFunction:function(nt){nn.setCustomInitialTrackSelectionFunction(nt)},resetCustomInitialTrackSelectionFunction:function(){nn.resetCustomInitialTrackSelectionFunction(null)},attachTTMLRenderingDiv:function(nt){if(!Nn.getElement())throw Wn;Nn.setTTMLRenderingDiv(nt)},attachVttRenderingDiv:function(nt){if(!Nn.getElement())throw Wn;Nn.setVttRenderingDiv(nt)},getCurrentTextTrackIndex:function(){var nt=_n.getActiveStreamInfo();if(nt&&vn)return vn.getCurrentTrackIdx(nt.id)},provideThumbnail:function(nt,rt){if("function"==typeof rt)if(nt<0)rt(null);else{var it=Tn.getIsDynamic()?me(nt):nt,at=_n.getStreamForTime(it);if(null!==at){var st=at.getThumbnailController();if(st)return st.provide(it,rt);rt(null)}else rt(null)}},getDashAdapter:function(){return Qt},getOfflineController:function(){return Oe()},triggerSteeringRequest:function(){if(An)return An.loadSteeringData()},getCurrentSteeringResponseData:function(){if(An)return An.getCurrentSteeringResponseData()},getSettings:function(){return fr.get()},updateSettings:function(nt){fr.update(nt)},resetSettings:function(){fr.reset()},reset:fe,destroy:function(){fe(),ht.Z.deleteSingletonInstances(or)}},rt=yr.getLogger(nt),St=!1,Lt=!1,wt=!1,Ct=!0,Pt=NaN,Kt=null,Wt=null,at=null,Qt=null,Hn=null,dt.Z.extend(_t.Z),en=ls(or).getInstance(),nn=(0,ai.Z)(or).getInstance(),Nn=ys(or).getInstance(),xn=as(or).getInstance(),nt}Qa.__dashjs_factory_name="MediaPlayer";var go=ht.Z.getClassFactory(Qa);go.events=_t.Z,go.errors=Ft,ht.Z.updateClassFactory(Qa.__dashjs_factory_name,go);var _o=go},8825:function(nt,rt,it){function r(nt){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},r(nt)}function i(nt,rt){return i=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},i(nt,rt)}function a(nt,rt){return!rt||"object"!==r(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function o(nt){return o=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},o(nt)}var at=new(function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&i(nt,rt)}(s,nt);var rt,it,at=(rt=s,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=o(rt);if(it){var st=o(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return a(this,nt)});function s(){var nt;return function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,s),(nt=at.call(this)).AST_IN_FUTURE="astInFuture",nt.BASE_URLS_UPDATED="baseUrlsUpdated",nt.BUFFER_EMPTY="bufferStalled",nt.BUFFER_LOADED="bufferLoaded",nt.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",nt.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",nt.DVB_FONT_DOWNLOAD_ADDED="dvbFontDownloadAdded",nt.DVB_FONT_DOWNLOAD_COMPLETE="dvbFontDownloadComplete",nt.DVB_FONT_DOWNLOAD_FAILED="dvbFontDownloadFailed",nt.DYNAMIC_TO_STATIC="dynamicToStatic",nt.ERROR="error",nt.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",nt.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",nt.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",nt.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",nt.LOG="log",nt.MANIFEST_LOADING_STARTED="manifestLoadingStarted",nt.MANIFEST_LOADING_FINISHED="manifestLoadingFinished",nt.MANIFEST_LOADED="manifestLoaded",nt.METRICS_CHANGED="metricsChanged",nt.METRIC_CHANGED="metricChanged",nt.METRIC_ADDED="metricAdded",nt.METRIC_UPDATED="metricUpdated",nt.PERIOD_SWITCH_STARTED="periodSwitchStarted",nt.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",nt.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",nt.QUALITY_CHANGE_RENDERED="qualityChangeRendered",nt.TRACK_CHANGE_RENDERED="trackChangeRendered",nt.STREAM_INITIALIZING="streamInitializing",nt.STREAM_UPDATED="streamUpdated",nt.STREAM_ACTIVATED="streamActivated",nt.STREAM_DEACTIVATED="streamDeactivated",nt.STREAM_INITIALIZED="streamInitialized",nt.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",nt.TEXT_TRACKS_ADDED="allTextTracksAdded",nt.TEXT_TRACK_ADDED="textTrackAdded",nt.CUE_ENTER="cueEnter",nt.CUE_EXIT="cueExit",nt.THROUGHPUT_MEASUREMENT_STORED="throughputMeasurementStored",nt.TTML_PARSED="ttmlParsed",nt.TTML_TO_PARSE="ttmlToParse",nt.CAPTION_RENDERED="captionRendered",nt.CAPTION_CONTAINER_RESIZE="captionContainerResize",nt.CAN_PLAY="canPlay",nt.CAN_PLAY_THROUGH="canPlayThrough",nt.PLAYBACK_ENDED="playbackEnded",nt.PLAYBACK_ERROR="playbackError",nt.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",nt.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",nt.PLAYBACK_LOADED_DATA="playbackLoadedData",nt.PLAYBACK_PAUSED="playbackPaused",nt.PLAYBACK_PLAYING="playbackPlaying",nt.PLAYBACK_PROGRESS="playbackProgress",nt.PLAYBACK_RATE_CHANGED="playbackRateChanged",nt.PLAYBACK_SEEKED="playbackSeeked",nt.PLAYBACK_SEEKING="playbackSeeking",nt.PLAYBACK_STALLED="playbackStalled",nt.PLAYBACK_STARTED="playbackStarted",nt.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",nt.PLAYBACK_VOLUME_CHANGED="playbackVolumeChanged",nt.PLAYBACK_WAITING="playbackWaiting",nt.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged",nt.EVENT_MODE_ON_START="eventModeOnStart",nt.EVENT_MODE_ON_RECEIVE="eventModeOnReceive",nt.CONFORMANCE_VIOLATION="conformanceViolation",nt.REPRESENTATION_SWITCH="representationSwitch",nt.ADAPTATION_SET_REMOVED_NO_CAPABILITIES="adaptationSetRemovedNoCapabilities",nt.CONTENT_STEERING_REQUEST_COMPLETED="contentSteeringRequestCompleted",nt.INBAND_PRFT="inbandPrft",nt.MANAGED_MEDIA_SOURCE_START_STREAMING="managedMediaSourceStartStreaming",nt.MANAGED_MEDIA_SOURCE_END_STREAMING="managedMediaSourceEndStreaming",nt}return s}(it(8342).Z));rt.Z=at},3393:function(nt,rt){function n(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var it=new(function(){function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var nt;return(nt=[{key:"init",value:function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.MUXED="muxed",this.IMAGE="image",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.CONTENT_STEERING="contentSteering",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_L2A="abrL2A",this.ABR_STRATEGY_LoLP="abrLoLP",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA="abrFetchThroughputCalculationDownloadedData",this.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING="abrFetchThroughputCalculationMoofParsing",this.ABR_FETCH_THROUGHPUT_CALCULATION_AAST="abrFetchThroughputCalculationAAST",this.LIVE_CATCHUP_MODE_DEFAULT="liveCatchupModeDefault",this.LIVE_CATCHUP_MODE_LOLP="liveCatchupModeLoLP",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)",this.TRACK_SWITCH_MODE_ALWAYS_REPLACE="alwaysReplace",this.TRACK_SWITCH_MODE_NEVER_REPLACE="neverReplace",this.TRACK_SELECTION_MODE_FIRST_TRACK="firstTrack",this.TRACK_SELECTION_MODE_HIGHEST_BITRATE="highestBitrate",this.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY="highestEfficiency",this.TRACK_SELECTION_MODE_WIDEST_RANGE="widestRange",this.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY="highestSelectionPriority",this.CMCD_MODE_QUERY="query",this.CMCD_MODE_HEADER="header",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.TEXT_DISABLED="disabled",this.CC1="CC1",this.CC3="CC3",this.UTF8="utf-8",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.SERVICE_DESCRIPTION_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:scope:2019",this.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:critical:2019",this.FONT_DOWNLOAD_DVB_SCHEME="urn:dvb:dash:fontdownload:2014",this.XML="XML",this.ARRAY_BUFFER="ArrayBuffer",this.DVB_REPORTING_URL="dvb:reportingUrl",this.DVB_PROBABILITY="dvb:probability",this.OFF_MIMETYPE="application/font-sfnt",this.WOFF_MIMETYPE="application/font-woff",this.VIDEO_ELEMENT_READY_STATES={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},this.FILE_LOADER_TYPES={FETCH:"fetch_loader",XHR:"xhr_loader"}}}])&&n(e.prototype,nt),e}());rt.Z=it},3860:function(nt,rt){function n(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var it=new(function(){function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var nt;return(nt=[{key:"init",value:function(){this.TCP_CONNECTION="TcpList",this.HTTP_REQUEST="HttpList",this.TRACK_SWITCH="RepSwitchList",this.BUFFER_LEVEL="BufferLevel",this.BUFFER_LOADED="bufferLoaded",this.ABANDON_LOAD="abandonload",this.ALLOW_LOAD="allowload",this.BUFFER_EMPTY="bufferStalled",this.BUFFER_STATE="BufferState",this.DVR_INFO="DVRInfo",this.DROPPED_FRAMES="DroppedFrames",this.SCHEDULING_INFO="SchedulingInfo",this.REQUESTS_QUEUE="RequestsQueue",this.MANIFEST_UPDATE="ManifestUpdate",this.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo",this.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo",this.PLAY_LIST="PlayList",this.DVB_ERRORS="DVBErrors",this.HTTP_REQUEST_DVB_REPORTING_TYPE="DVBReporting"}}])&&n(e.prototype,nt),e}());rt.Z=it},8080:function(nt,rt,it){it.d(rt,{default:function(){return Yt}});var at=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null};at.SSL_CONNECTION_FAILED_PREFIX="SSL",at.DNS_RESOLUTION_FAILED="C00",at.HOST_UNREACHABLE="C01",at.CONNECTION_REFUSED="C02",at.CONNECTION_ERROR="C03",at.CORRUPT_MEDIA_ISOBMFF="M00",at.CORRUPT_MEDIA_OTHER="M01",at.BASE_URL_CHANGED="F00",at.BECAME_REPORTER="S00";var st=at,ot=it(1180);function o(nt){var rt,it,at=(nt=nt||{}).eventBus,lt=nt.dashMetrics,ut=nt.metricsConstants,ct=nt.events;function l(nt){var rt=new st;if(it){for(var at in nt)nt.hasOwnProperty(at)&&(rt[at]=nt[at]);rt.mpdurl||(rt.mpdurl=it.originalUrl||it.url),rt.terror||(rt.terror=new Date),lt.addDVBErrors(rt)}}function c(nt){nt.error||(it=nt.manifest)}function f(nt){l({errorcode:st.BASE_URL_CHANGED,servicelocation:nt.entry})}function d(){l({errorcode:st.BECAME_REPORTER})}function g(nt){var rt;nt.metric===ut.HTTP_REQUEST&&(0===(rt=nt.value).responsecode||null==rt.responsecode||rt.responsecode>=400||rt.responsecode<100||rt.responsecode>=600)&&l({errorcode:rt.responsecode||st.CONNECTION_ERROR,url:rt.url,terror:rt.tresponse,servicelocation:rt._serviceLocation})}function h(nt){var rt;switch(nt.error?nt.error.code:0){case MediaError.MEDIA_ERR_NETWORK:rt=st.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:rt=st.CORRUPT_MEDIA_OTHER;break;default:return}l({errorcode:rt})}return rt={initialize:function(){at.on(ct.MANIFEST_UPDATED,c,rt),at.on(ct.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,f,rt),at.on(ct.METRIC_ADDED,g,rt),at.on(ct.METRIC_UPDATED,g,rt),at.on(ct.PLAYBACK_ERROR,h,rt),at.on(ot.Z.BECAME_REPORTING_PLAYER,d,rt)},reset:function(){at.off(ct.MANIFEST_UPDATED,c,rt),at.off(ct.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,f,rt),at.off(ct.METRIC_ADDED,g,rt),at.off(ct.METRIC_UPDATED,g,rt),at.off(ct.PLAYBACK_ERROR,h,rt),at.off(ot.Z.BECAME_REPORTING_PLAYER,d,rt)}}}o.__dashjs_factory_name="DVBErrorsTranslator";var lt=dashjs.FactoryMaker.getSingletonFactory(o),ut=it(2295);function l(nt){nt=nt||{};var rt,it,at=!1,st=this.context,ot=nt.mediaElement;return rt={initialize:function(nt){nt&&nt.length&&(nt.forEach((function(nt){var rt=nt.starttime,at=rt+nt.duration;it.add(rt,at)})),at=!!nt[0]._useWallClockTime)},reset:function(){it.clear()},isEnabled:function(){var nt,rt=it.length;if(!rt)return!0;nt=at?(new Date).getTime()/1e3:ot.currentTime;for(var st=0;st<rt;st+=1){var lt=it.start(st),ut=it.end(st);if(lt<=nt&&nt<ut)return!0}return!1}},it=(0,ut.Z)(st).create(),rt}l.__dashjs_factory_name="RangeController";var ct=dashjs.FactoryMaker.getClassFactory(l);function f(){return{serialise:function e(nt){var rt,it,at=[],st=[];for(rt in nt)if(nt.hasOwnProperty(rt)&&0!==rt.indexOf("_")){if(null==(it=nt[rt])&&(it=""),Array.isArray(it)){if(!it.length)continue;st=[],it.forEach((function(nt){var rt="Object"!==Object.prototype.toString.call(nt).slice(8,-1);st.push(rt?nt:e(nt))})),it=st.map(encodeURIComponent).join(",")}else"string"==typeof it?it=encodeURIComponent(it):it instanceof Date?it=it.toISOString():"number"==typeof it&&(it=Math.round(it));at.push(rt+"="+it)}return at.join("&")}}}f.__dashjs_factory_name="MetricSerialiser";var dt=dashjs.FactoryMaker.getSingletonFactory(f);function g(){var nt,rt,it,at=window.crypto||window.msCrypto,st=Uint32Array,ot=Math.pow(2,8*st.BYTES_PER_ELEMENT)-1;function o(){at&&(nt||(nt=new st(10)),at.getRandomValues(nt),rt=0)}return it={random:function(it,st){var lt;return it||(it=0),st||(st=1),at?(rt===nt.length&&o(),lt=nt[rt]/ot,rt+=1):lt=Math.random(),lt*(st-it)+it}},o(),it}g.__dashjs_factory_name="RNG";var ht=dashjs.FactoryMaker.getSingletonFactory(g),pt=it(5717);function m(nt){var rt;nt=nt||{};var it,at,st,ot,lt,ut,ct,_t=this.context,Et=[],St=nt.metricsConstants;function g(){ot=!1,lt=!1,ut=null,ct=null}return rt={report:function(nt,rt){Array.isArray(rt)||(rt=[rt]),lt&&ct.isEnabled()&&rt.forEach((function(rt){var st=it.serialise(rt);nt!==St.DVB_ERRORS&&(st="metricname=".concat(nt,"&").concat(st)),function(nt,rt,it){var st=new XMLHttpRequest;st.withCredentials=at.getXHRWithCredentialsForType(St.HTTP_REQUEST_DVB_REPORTING_TYPE);var a=function(){var nt=Et.indexOf(st);-1!==nt&&(Et.splice(nt,1),!(st.status>=200&&st.status<300)&&it&&it())};Et.push(st);try{st.open("GET",nt),st.onloadend=a,st.onerror=a,st.send()}catch(nt){st.onerror()}}(st="".concat(ut,"?").concat(st),0,(function(){lt=!1}))}))},initialize:function(nt,rt){var it;if(ct=rt,!(ut=nt.dvbReportingUrl))throw new Error("required parameter missing (dvb:reportingUrl)");ot||((it=nt.dvbProbability)&&(1e3===it||it/1e3>=st.random())&&(lt=!0),ot=!0)},reset:function(){g()}},it=dt(_t).getInstance(),st=ht(_t).getInstance(),at=(0,pt.Z)(_t).getInstance(),g(),rt}m.__dashjs_factory_name="DVBReporting";var _t=dashjs.FactoryMaker.getClassFactory(m);function E(nt){nt=nt||{};var rt,it={"urn:dvb:dash:reporting:2014":_t},at=this.context,st=nt.debug?nt.debug.getLogger(rt):{},ot=nt.metricsConstants,lt=nt.mediaPlayerModel||{};return{create:function(nt,rt){var ut;try{(ut=it[nt.schemeIdUri](at).create({metricsConstants:ot,mediaPlayerModel:lt})).initialize(nt,rt)}catch(rt){ut=null,st.error("ReportingFactory: could not create Reporting with schemeIdUri ".concat(nt.schemeIdUri," (").concat(rt.message,")"))}return ut},register:function(nt,rt){it[nt]=rt},unregister:function(nt){delete it[nt]}}}E.__dashjs_factory_name="ReportingFactory";var Et=dashjs.FactoryMaker.getSingletonFactory(E);function _(nt){var rt=[],it=Et(this.context).getInstance(nt);return{initialize:function(nt,at){nt.some((function(nt){var st=it.create(nt,at);if(st)return rt.push(st),!0}))},reset:function(){rt.forEach((function(nt){return nt.reset()})),rt=[]},report:function(nt,it){rt.forEach((function(rt){return rt.report(nt,it)}))}}}_.__dashjs_factory_name="ReportingController";var St=dashjs.FactoryMaker.getClassFactory(_);function S(){return{reconstructFullMetricName:function(nt,rt,it){var at=nt;return rt&&(at+="("+rt,it&&it.length&&(at+=","+it),at+=")"),at},validateN:function(nt){if(!nt)throw new Error("missing n");if(isNaN(nt))throw new Error("n is NaN");if(nt<0)throw new Error("n must be positive");return nt}}}S.__dashjs_factory_name="HandlerHelpers";var wt=dashjs.FactoryMaker.getSingletonFactory(S);function A(nt){var rt,it,at,st,ot;nt=nt||{};var lt=this.context,ut=wt(lt).getInstance(),ct=[],dt=nt.metricsConstants;function c(){var nt=function(){try{return Object.keys(ct).map((function(nt){return ct[nt]})).reduce((function(nt,rt){return nt.level<rt.level?nt:rt}))}catch(nt){return}}();nt&&ot!==nt.t&&(ot=nt.t,rt.report(at,nt))}return{initialize:function(nt,ot,lt){ot&&(it=ut.validateN(lt),rt=ot,at=ut.reconstructFullMetricName(nt,lt),st=setInterval(c,it))},reset:function(){clearInterval(st),st=null,it=0,rt=null,ot=null},handleNewMetric:function(nt,rt,it){nt===dt.BUFFER_LEVEL&&(ct[it]=rt)}}}A.__dashjs_factory_name="BufferLevelHandler";var Lt=dashjs.FactoryMaker.getClassFactory(A),Ct=dashjs.FactoryMaker.getClassFactory((function(nt){var rt,it=(nt=nt||{}).eventBus,at=nt.metricsConstants;function i(){it.off(ot.Z.METRICS_INITIALISATION_COMPLETE,i,this),it.trigger(ot.Z.BECAME_REPORTING_PLAYER)}return{initialize:function(nt,at){at&&(rt=at,it.on(ot.Z.METRICS_INITIALISATION_COMPLETE,i,this))},reset:function(){rt=null},handleNewMetric:function(nt,it){nt===at.DVB_ERRORS&&rt&&rt.report(nt,it)}}}));function w(nt){var rt,it,at,st,ot;nt=nt||{};var lt=[],ut=wt(this.context).getInstance(),ct=nt.metricsConstants;function l(){var nt=lt;nt.length&&rt&&rt.report(st,nt),lt=[]}return{initialize:function(nt,lt,ct,dt){lt&&(it=ut.validateN(ct),rt=lt,dt&&dt.length&&(at=dt),st=ut.reconstructFullMetricName(nt,ct,dt),ot=setInterval(l,it))},reset:function(){clearInterval(ot),ot=null,it=null,at=null,lt=[],rt=null},handleNewMetric:function(nt,rt){nt===ct.HTTP_REQUEST&&(at&&at!==rt.type||lt.push(rt))}}}w.__dashjs_factory_name="HttpListHandler";var Pt=dashjs.FactoryMaker.getClassFactory(w);function C(){var nt,rt;return{initialize:function(it,at){nt=it,rt=at},reset:function(){rt=null,nt=void 0},handleNewMetric:function(it,at){it===nt&&rt&&rt.report(nt,at)}}}C.__dashjs_factory_name="GenericMetricHandler";var kt=dashjs.FactoryMaker.getClassFactory(C);function O(nt){var rt,it=(nt=nt||{}).debug?nt.debug.getLogger(rt):{},at=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/,st=this.context,ot={BufferLevel:Lt,DVBErrors:Ct,HttpList:Pt,PlayList:kt,RepSwitchList:kt,TcpList:kt};return{create:function(rt,lt){var ut,ct=rt.match(at);if(ct){try{(ut=ot[ct[1]](st).create({eventBus:nt.eventBus,metricsConstants:nt.metricsConstants})).initialize(ct[1],lt,ct[3],ct[5])}catch(nt){ut=null,it.error("MetricsHandlerFactory: Could not create handler for type ".concat(ct[1]," with args ").concat(ct[3],", ").concat(ct[5]," (").concat(nt.message,")"))}return ut}},register:function(nt,rt){ot[nt]=rt},unregister:function(nt){delete ot[nt]}}}O.__dashjs_factory_name="MetricsHandlerFactory";var Ot=dashjs.FactoryMaker.getSingletonFactory(O);function P(nt){nt=nt||{};var rt,it=[],at=this.context,st=nt.eventBus,ot=nt.events,lt=Ot(at).getInstance({debug:nt.debug,eventBus:nt.eventBus,metricsConstants:nt.metricsConstants});function s(nt){it.forEach((function(rt){rt.handleNewMetric(nt.metric,nt.value,nt.mediaType)}))}return rt={initialize:function(nt,at){nt.split(",").forEach((function(nt,rt,st){var ot;if(-1!==nt.indexOf("(")&&-1===nt.indexOf(")")){var ut=st[rt+1];ut&&-1===ut.indexOf("(")&&-1!==ut.indexOf(")")&&(nt+=","+ut,delete st[rt+1])}(ot=lt.create(nt,at))&&it.push(ot)})),st.on(ot.METRIC_ADDED,s,rt),st.on(ot.METRIC_UPDATED,s,rt)},reset:function(){st.off(ot.METRIC_ADDED,s,rt),st.off(ot.METRIC_UPDATED,s,rt),it.forEach((function(nt){return nt.reset()})),it=[]}}}P.__dashjs_factory_name="MetricsHandlersController";var Ft=dashjs.FactoryMaker.getClassFactory(P);function F(nt){var rt,it,at;nt=nt||{};var st=this.context;function a(){rt&&rt.reset(),it&&it.reset(),at&&at.reset()}return{initialize:function(ot){try{(at=ct(st).create({mediaElement:nt.mediaElement})).initialize(ot.Range),(it=St(st).create({debug:nt.debug,metricsConstants:nt.metricsConstants,mediaPlayerModel:nt.mediaPlayerModel})).initialize(ot.Reporting,at),(rt=Ft(st).create({debug:nt.debug,eventBus:nt.eventBus,metricsConstants:nt.metricsConstants,events:nt.events})).initialize(ot.metrics,it)}catch(nt){throw a(),nt}},reset:a}}F.__dashjs_factory_name="MetricsController";var Bt=dashjs.FactoryMaker.getClassFactory(F),Ut=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.metrics="",this.Range=[],this.Reporting=[]},Gt=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.starttime=0,this.duration=1/0,this._useWallClockTime=!1},Ht=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value="",this.dvbReportingUrl="",this.dvbProbability=1e3};function B(nt){var rt=(nt=nt||{}).adapter,it=nt.constants;return{getMetrics:function(nt){var at=[];return nt&&nt.Metrics_asArray&&nt.Metrics_asArray.forEach((function(st){var ot=new Ut,lt=rt.getIsDynamic(nt);st.hasOwnProperty("metrics")&&(ot.metrics=st.metrics,st.Range_asArray&&st.Range_asArray.forEach((function(at){var st=new Gt;st.starttime=function(nt,at,st){var ot,lt,ut=0;return at?ut=rt.getAvailabilityStartTime(nt)/1e3:(ot=rt.getRegularPeriods(nt)).length&&(ut=ot[0].start),lt=ut,st&&st.hasOwnProperty(it.START_TIME)&&(lt+=st.starttime),lt}(nt,lt,at),at.hasOwnProperty("duration")?st.duration=at.duration:st.duration=rt.getDuration(nt),st._useWallClockTime=lt,ot.Range.push(st)})),st.Reporting_asArray&&(st.Reporting_asArray.forEach((function(nt){var rt=new Ht;nt.hasOwnProperty(it.SCHEME_ID_URI)&&(rt.schemeIdUri=nt.schemeIdUri,nt.hasOwnProperty("value")&&(rt.value=nt.value),nt.hasOwnProperty(it.DVB_REPORTING_URL)&&(rt.dvbReportingUrl=nt[it.DVB_REPORTING_URL]),nt.hasOwnProperty(it.DVB_PROBABILITY)&&(rt.dvbProbability=nt[it.DVB_PROBABILITY]),ot.Reporting.push(rt))})),at.push(ot)))})),at}}}B.__dashjs_factory_name="ManifestParsing";var jt=dashjs.FactoryMaker.getSingletonFactory(B);function q(nt){var rt;nt=nt||{};var it={},at=this.context,st=nt.eventBus,lt=nt.events;function s(rt){if(!rt.error){var lt=Object.keys(it);jt(at).getInstance({adapter:nt.adapter,constants:nt.constants}).getMetrics(rt.manifest).forEach((function(rt){var st=JSON.stringify(rt);if(it.hasOwnProperty(st))lt.splice(st,1);else try{var ot=Bt(at).create(nt);ot.initialize(rt),it[st]=ot}catch(nt){}})),lt.forEach((function(nt){it[nt].reset(),delete it[nt]})),st.trigger(ot.Z.METRICS_INITIALISATION_COMPLETE)}}function u(){Object.keys(it).forEach((function(nt){it[nt].reset()})),it={}}return rt={reset:function(){st.off(lt.MANIFEST_UPDATED,s,rt),st.off(lt.STREAM_TEARDOWN_COMPLETE,u,rt)}},st.on(lt.MANIFEST_UPDATED,s,rt),st.on(lt.STREAM_TEARDOWN_COMPLETE,u,rt),rt}q.__dashjs_factory_name="MetricsCollectionController";var Kt=dashjs.FactoryMaker.getClassFactory(q);function j(){var nt=this.context;return{createMetricsReporting:function(rt){return lt(nt).getInstance({eventBus:rt.eventBus,dashMetrics:rt.dashMetrics,metricsConstants:rt.metricsConstants,events:rt.events}).initialize(),Kt(nt).create(rt)},getReportingFactory:function(){return Et(nt).getInstance()},getMetricsHandlerFactory:function(){return Ot(nt).getInstance()}}}j.__dashjs_factory_name="MetricsReporting";var $t=dashjs.FactoryMaker.getClassFactory(j);$t.events=ot.Z,dashjs.FactoryMaker.updateClassFactory(j.__dashjs_factory_name,$t);var Yt=$t},1180:function(nt,rt,it){function r(nt){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},r(nt)}function i(nt,rt){return i=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},i(nt,rt)}function a(nt,rt){return!rt||"object"!==r(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function o(nt){return o=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},o(nt)}var at=new(function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&i(nt,rt)}(s,nt);var rt,it,at=(rt=s,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=o(rt);if(it){var st=o(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return a(this,nt)});function s(){var nt;return function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,s),(nt=at.call(this)).METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",nt.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer",nt.CMCD_DATA_GENERATED="cmcdDataGenerated",nt}return s}(it(8342).Z));rt.Z=at},5717:function(nt,rt,it){var at=it(2610),st=it(5448),ot=it(1264),lt=it(3106),ut=it(1767),ct=it(3393);function l(){var nt,rt,it,st,dt,ht,pt,_t,Et=this.context,St=(0,ot.Z)(Et).getInstance();function p(){st=[],dt=[],ht=[],_t=[],pt=null,rt=[]}function m(nt,rt){var it=-1;nt.some((function(nt,at){if(nt===rt)return it=at,!0})),it<0||nt.splice(it,1)}function y(nt){var rt;for(rt=0;rt<_t.length;rt++)if(_t[rt].rulename===nt)return rt;return-1}function E(nt,it){v(nt,it);var st=new at.Z;st.schemeIdUri=nt,st.value=it,rt.push(st)}function v(nt,it){(0,lt.PS)(nt,"string"),(0,lt.PS)(it,"string"),rt.forEach((function(at,st){at.schemeIdUri===nt&&at.value===it&&rt.splice(st,1)}))}return nt={getCustomInitialTrackSelectionFunction:function(){return pt},setCustomInitialTrackSelectionFunction:function(nt){pt=nt},resetCustomInitialTrackSelectionFunction:function(){pt=null},getLicenseResponseFilters:function(){return dt},getLicenseRequestFilters:function(){return st},getCustomCapabilitiesFilters:function(){return ht},registerCustomCapabilitiesFilter:function(nt){ht.push(nt)},registerLicenseResponseFilter:function(nt){dt.push(nt)},registerLicenseRequestFilter:function(nt){st.push(nt)},unregisterCustomCapabilitiesFilter:function(nt){m(ht,nt)},unregisterLicenseResponseFilter:function(nt){m(dt,nt)},unregisterLicenseRequestFilter:function(nt){m(st,nt)},addAbrCustomRule:function(nt,rt,it){if("string"!=typeof nt||nt!==ut.Z.ABANDON_FRAGMENT_RULES&&nt!==ut.Z.QUALITY_SWITCH_RULES||"string"!=typeof rt)throw ct.Z.BAD_ARGUMENT_ERROR;var at=y(rt);-1===at?_t.push({type:nt,rulename:rt,rule:it}):(_t[at].type=nt,_t[at].rule=it)},removeAllAbrCustomRule:function(){_t=[]},removeAbrCustomRule:function(nt){if(nt){var rt=y(nt);-1!==rt&&_t.splice(rt,1)}else _t=[]},getAbrCustomRules:function(){return _t},addUTCTimingSource:E,removeUTCTimingSource:v,getUTCTimingSources:function(){return rt},clearDefaultUTCTimingSources:function(){rt=[]},restoreDefaultUTCTimingSources:function(){var nt=St.get().streaming.utcSynchronization.defaultTimingSource;E(nt.scheme,nt.value)},setXHRWithCredentialsForType:function e(nt,rt){nt?it[nt]=!!rt:Object.keys(it).forEach((function(nt){e(nt,rt)}))},getXHRWithCredentialsForType:function(nt){var rt=it[nt];return void 0===rt?it.default:rt},setConfig:function(){},reset:function(){p()}},it={default:!1},p(),nt}l.__dashjs_factory_name="CustomParametersModel",rt.Z=st.Z.getSingletonFactory(l)},9032:function(nt,rt,it){var at=it(5448),st=it(7473);function a(nt){var rt=(nt=nt||{}).requestModifier;function n(nt){var it=new Date,at=nt.request,st=new XMLHttpRequest;if(st.open(nt.method,nt.url,!0),at.responseType&&(st.responseType=at.responseType),at.range&&st.setRequestHeader("Range","bytes="+at.range),at.requestStartDate||(at.requestStartDate=it),rt&&rt.modifyRequestHeader&&(st=rt.modifyRequestHeader(st,{url:nt.url})),nt.headers)for(var ot in nt.headers){var lt=nt.headers[ot];lt&&st.setRequestHeader(ot,lt)}st.withCredentials=nt.withCredentials,st.onload=nt.onload,st.onloadend=nt.onend,st.onerror=nt.onerror,st.onprogress=nt.progress,st.onabort=nt.onabort,st.ontimeout=nt.ontimeout,st.timeout=nt.timeout,st.send(),nt.response=st}return{load:function(nt){rt&&rt.modifyRequest?(0,st.k)(nt,rt).then((function(){return n(nt)})):n(nt)},abort:function(nt){var rt=nt.response;rt.onloadend=rt.onerror=rt.onprogress=void 0,rt.abort()}}}a.__dashjs_factory_name="XHRLoader";var ot=at.Z.getClassFactory(a);rt.Z=ot},1737:function(nt,rt,it){function r(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}it.d(rt,{default:function(){return Mn}});var at={attributes:["Laurl","laurl"],prefixes:["clearkey","dashif"]},st=function(){function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e)}var nt;return nt=[{key:"findCencContentProtection",value:function(nt){for(var rt=null,it=0;it<nt.length;++it){var at=nt[it];"urn:mpeg:dash:mp4protection:2011"!==at.schemeIdUri.toLowerCase()||"cenc"!==at.value.toLowerCase()&&"cbcs"!==at.value.toLowerCase()||(rt=at)}return rt}},{key:"getPSSHData",value:function(nt){var rt=8,it=new DataView(nt),at=it.getUint8(rt);return rt+=20,at>0&&(rt+=4+16*it.getUint32(rt)),rt+=4,nt.slice(rt)}},{key:"getPSSHForKeySystem",value:function(nt,rt){var it=e.parsePSSHList(rt);return nt&&it.hasOwnProperty(nt.uuid.toLowerCase())?it[nt.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function(nt,rt){return"pssh"in nt?(nt.pssh.__text=nt.pssh.__text.replace(/\r?\n|\r/g,"").replace(/\s+/g,""),rt.decodeArray(nt.pssh.__text).buffer):null}},{key:"parsePSSHList",value:function(nt){if(null==nt)return[];for(var rt=new DataView(nt.buffer||nt),it={},at=0;;){var st,ot,lt=void 0,ut=at;if(at>=rt.buffer.byteLength)break;if(st=at+rt.getUint32(at),at+=4,1886614376===rt.getUint32(at))if(at+=4,0===(ot=rt.getUint8(at))||1===ot){at++,at+=3,lt="";var ct=void 0,dt=void 0;for(ct=0;ct<4;ct++)lt+=1===(dt=rt.getUint8(at+ct).toString(16)).length?"0"+dt:dt;for(at+=4,lt+="-",ct=0;ct<2;ct++)lt+=1===(dt=rt.getUint8(at+ct).toString(16)).length?"0"+dt:dt;for(at+=2,lt+="-",ct=0;ct<2;ct++)lt+=1===(dt=rt.getUint8(at+ct).toString(16)).length?"0"+dt:dt;for(at+=2,lt+="-",ct=0;ct<2;ct++)lt+=1===(dt=rt.getUint8(at+ct).toString(16)).length?"0"+dt:dt;for(at+=2,lt+="-",ct=0;ct<6;ct++)lt+=1===(dt=rt.getUint8(at+ct).toString(16)).length?"0"+dt:dt;at+=6,at+=4,it[lt=lt.toLowerCase()]=rt.buffer.slice(ut,st),at=st}else at=st;else at=st}return it}},{key:"getLicenseServerUrlFromMediaInfo",value:function(nt,rt){try{if(!nt||0===nt.length)return null;for(var it=0,st=null;it<nt.length&&!st;){var ot=nt[it];if(ot&&ot.contentProtection&&ot.contentProtection.length>0){var lt=ot.contentProtection.filter((function(nt){return nt.schemeIdUri&&nt.schemeIdUri===rt}));if(lt&&lt.length>0)for(var ut=0;ut<lt.length&&!st;){for(var ct=lt[ut],dt=0;dt<at.attributes.length&&!st;){for(var ht=0,pt=at.attributes[dt];ht<at.prefixes.length&&!st;){var _t=at.prefixes[ht];ct[pt]&&ct[pt].__prefix&&ct[pt].__prefix===_t&&ct[pt].__text&&(st=ct[pt].__text),ht+=1}dt+=1}ut+=1}}it+=1}return st}catch(nt){return null}}}],nt&&r(e,nt),e}(),ot=function e(nt,rt){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.contentType=nt,this.robustness=rt},lt=function e(nt,rt,it,at,st){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.initDataTypes=["cenc"],nt&&nt.length&&(this.audioCapabilities=nt),rt&&rt.length&&(this.videoCapabilities=rt),this.distinctiveIdentifier=it,this.persistentState=at,this.sessionTypes=st};function u(nt){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},u(nt)}function l(nt,rt){return l=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},l(nt,rt)}function c(nt,rt){return!rt||"object"!==u(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function f(nt){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},f(nt)}var ut=new(function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&l(nt,rt)}(i,nt);var rt,it,at=(rt=i,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=f(rt);if(it){var st=f(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return c(this,nt)});function i(){var nt;return function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,i),(nt=at.call(this)).MEDIA_KEYERR_CODE=100,nt.MEDIA_KEYERR_UNKNOWN_CODE=101,nt.MEDIA_KEYERR_CLIENT_CODE=102,nt.MEDIA_KEYERR_SERVICE_CODE=103,nt.MEDIA_KEYERR_OUTPUT_CODE=104,nt.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,nt.MEDIA_KEYERR_DOMAIN_CODE=106,nt.MEDIA_KEY_MESSAGE_ERROR_CODE=107,nt.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,nt.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,nt.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,nt.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,nt.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,nt.KEY_SESSION_CREATED_ERROR_CODE=113,nt.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,nt.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",nt.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",nt.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",nt.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",nt.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",nt.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",nt.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",nt.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",nt.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",nt.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",nt.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",nt.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",nt.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",nt.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --",nt}return i}(it(2230).Z)),ct=it(5459),dt=function e(nt,rt,it,at,st,ot,lt,ut){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=nt,this.method=rt,this.responseType=it,this.headers=at,this.withCredentials=st,this.messageType=ot,this.sessionId=lt,this.data=ut},ht=function e(nt,rt,it){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=nt,this.headers=rt,this.data=it},pt=it(7855),_t=it(703),Et=it(3393),St=it(5448);function _(nt){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},_(nt)}function T(nt){var rt,it,at,St,wt,Lt,Ct,Pt,kt,Ot,Ft,Bt=(nt=nt||{}).protectionKeyController,Ut=nt.protectionModel,Gt=nt.eventBus,Ht=nt.events,jt=nt.debug,Kt=nt.BASE64,$t=nt.constants,Yt=[],Wt=nt.cmcdModel,Qt=nt.settings,en=nt.customParametersModel;function L(){if(!(Gt&&Gt.hasOwnProperty("on")&&Bt&&Bt.hasOwnProperty("getSupportedKeySystemsFromContentProtection")))throw new Error("Missing config parameter(s)")}function F(nt,rt){Pt||kt?Pt&&x():function(nt,rt){if(!kt){kt=!0;var at,st=[];nt=nt.sort((function(rt,it){return(wt&&wt[rt.ks.systemString]&&wt[rt.ks.systemString].priority>=0?wt[rt.ks.systemString].priority:nt.length)-(wt&&wt[it.ks.systemString]&&wt[it.ks.systemString].priority>=0?wt[it.ks.systemString].priority:nt.length)}));for(var ot=0;ot<nt.length;ot++){var lt=Y(nt[ot]);st.push({ks:nt[ot].ks,configs:[lt],protData:nt[ot].protData})}Ut.requestKeySystemAccess(st).then((function(nt){var rt=(at=nt.data).mksa&&at.mksa.selectedSystemString?at.mksa.selectedSystemString:at.keySystem.systemString;return it.info("DRM: KeySystem Access Granted for system string ("+rt+")!  Selecting key system..."),Ut.selectKeySystem(at)})).then((function(nt){if(Pt=nt,kt=!1,Ut){Gt.trigger(Ht.KEY_SYSTEM_SELECTED,{data:at});var rt=B(Pt);rt&&rt.serverCertificate&&rt.serverCertificate.length>0&&Ut.setServerCertificate(Kt.decodeArray(rt.serverCertificate).buffer),x()}})).catch((function(nt){Pt=null,kt=!1,rt||Gt.trigger(Ht.KEY_SYSTEM_SELECTED,{data:null,error:new ct.Z(ut.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,ut.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+nt.error)})}))}}(nt,rt)}function x(){for(var nt,rt=0;rt<at.length;rt++)for(nt=0;nt<at[rt].length;nt++)if(Pt===at[rt][nt].ks){k(at[rt][nt]);break}at=[]}function k(nt){if(Bt.isClearKey(Pt)&&nt.protData&&nt.protData.hasOwnProperty("clearkeys")&&0!==Object.keys(nt.protData.clearkeys).length){var rt={kids:Object.keys(nt.protData.clearkeys)};nt.initData=(new TextEncoder).encode(JSON.stringify(rt))}nt.sessionId?U(nt):null!==nt.initData&&Z(nt)}function U(nt){L(),Ut.loadKeySession(nt)}function Z(nt){var rt=st.getPSSHForKeySystem(Pt,nt?nt.initData:null);if(rt){if(function(nt){if(!nt)return!1;try{for(var rt=Ut.getSessions(),it=0;it<rt.length;it++)if(rt[it].getKeyId()===nt)return!0;return!1}catch(nt){return!1}}(nt.keyId))return;if(G(rt))return;try{nt.initData=rt,Ut.createKeySession(nt)}catch(nt){Gt.trigger(Ht.KEY_SESSION_CREATED,{data:null,error:new ct.Z(ut.KEY_SESSION_CREATED_ERROR_CODE,ut.KEY_SESSION_CREATED_ERROR_MESSAGE+nt.message)})}}else nt&&nt.initData?Ut.createKeySession(nt):Gt.trigger(Ht.KEY_SESSION_CREATED,{data:null,error:new ct.Z(ut.KEY_SESSION_CREATED_ERROR_CODE,ut.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+(Pt?Pt.systemString:null)+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function B(nt){if(nt){var rt=nt.systemString;if(wt)return rt in wt?wt[rt]:null}return null}function G(nt){if(!nt)return!1;try{for(var rt=Ut.getAllInitData(),at=0;at<rt.length;at++)if(Bt.initDataEquals(nt,rt[at]))return it.debug("DRM: Ignoring initData because we have already seen it!"),!0;return!1}catch(nt){return!1}}function q(nt){L(),nt?(Ut.setMediaElement(nt),Gt.on(Ht.NEED_KEY,J,rt)):null===nt&&(Ut.setMediaElement(nt),Gt.off(Ht.NEED_KEY,J,rt))}function Y(nt){var rt=nt.protData,it=[],at=[],st=rt&&rt.audioRobustness&&rt.audioRobustness.length>0?rt.audioRobustness:Ct,ut=rt&&rt.videoRobustness&&rt.videoRobustness.length>0?rt.videoRobustness:Ct,ct=nt.sessionType,dt=rt&&rt.distinctiveIdentifier?rt.distinctiveIdentifier:"optional",ht=rt&&rt.persistentState?rt.persistentState:"temporary"===ct?"optional":"required";return St.forEach((function(nt){nt.type===$t.AUDIO?it.push(new ot(nt.codec,st)):nt.type===$t.VIDEO&&at.push(new ot(nt.codec,ut))})),new lt(it,at,dt,ht,[ct])}function j(nt){nt.error?Gt.trigger(Ht.KEY_STATUSES_CHANGED,{data:null,error:nt.error}):it.debug("DRM: key status = "+nt.status)}function H(nt){it.debug("DRM: onKeyMessage");var rt=nt.data;Gt.trigger(Ht.KEY_MESSAGE,{data:rt});var at=rt.messageType?rt.messageType:"license-request",ot=rt.message,lt=rt.sessionToken,Et=B(Pt),wt=Bt.getLicenseServerModelInstance(Pt,Et,at),Lt={sessionToken:lt,messageType:at};if(ot&&0!==ot.byteLength){if(!wt)return it.debug("DRM: License server request not required for this message (type = "+nt.data.messageType+").  Session ID = "+lt.getSessionId()),void V(Lt);if(Bt.isClearKey(Pt)){var Ct=Bt.processClearKeyLicenseRequest(Pt,Et,ot);if(Ct&&Ct.keyPairs&&Ct.keyPairs.length>0)return it.debug("DRM: ClearKey license request handled by application!"),V(Lt),void Ut.updateKeySession(lt,Ct)}!function(nt,rt,it){var at=nt.sessionToken,ot=nt.messageType?nt.messageType:"license-request",lt={sessionToken:at,messageType:ot},Et=Pt?Pt.systemString:null,wt=function(nt,rt,it,at,ot){var lt=null,ut=at.message;if(nt&&nt.serverURL){var ct=nt.serverURL;"string"==typeof ct&&""!==ct?lt=ct:"object"===_(ct)&&ct.hasOwnProperty(rt)&&(lt=ct[rt])}else if(nt&&nt.laURL&&""!==nt.laURL)lt=nt.laURL;else if(!(lt=st.getLicenseServerUrlFromMediaInfo(St,Pt.schemeIdURI))&&!Bt.isClearKey(Pt)){var dt=st.getPSSHData(it.initData);(lt=Pt.getLicenseServerURLFromInitData(dt))||(lt=at.laURL)}return ot.getServerURLFromMessage(lt,ut,rt)}(it,ot,at,nt,rt);if(wt){var Lt={},Ct=!1;it&&W(Lt,it.httpRequestHeaders);var kt=nt.message;W(Lt,Pt.getRequestHeadersFromMessage(kt)),Object.keys(Lt).forEach((function(nt){"authorization"===nt.toLowerCase()&&(Ct=!0)})),it&&"boolean"==typeof it.withCredentials&&(Ct=it.withCredentials);var T=function(nt){if(Ut)if(nt.status>=200&&nt.status<=299){var it=_t.Z.parseHttpHeaders(nt.getAllResponseHeaders?nt.getAllResponseHeaders():null),st=new ht(nt.responseURL,it,nt.response);Q(en.getLicenseResponseFilters(),st).then((function(){var it=rt.getLicenseMessage(st.data,Et,ot);null!==it?(V(lt),Ut.updateKeySession(at,it)):X(nt,lt,Et,ot,rt)}))}else X(nt,lt,Et,ot,rt)},S=function(nt){V(lt,new ct.Z(ut.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,ut.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+Et+' update, XHR aborted. status is "'+nt.statusText+'" ('+nt.status+"), readyState is "+nt.readyState))},I=function(nt){V(lt,new ct.Z(ut.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,ut.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+Et+' update, XHR error. status is "'+nt.statusText+'" ('+nt.status+"), readyState is "+nt.readyState))},Ot=Pt.getLicenseRequestFromMessage(kt),Ft=rt.getHTTPMethod(ot),Gt=rt.getResponseType(Et,ot),Ht=it&&!isNaN(it.httpTimeout)?it.httpTimeout:8e3,jt=at.getSessionId()||null,Kt=new dt(wt,Ft,Gt,Lt,Ct,ot,jt,Ot),$t=isNaN(Qt.get().streaming.retryAttempts[pt.w.LICENSE])?3:Qt.get().streaming.retryAttempts[pt.w.LICENSE];Q(en.getLicenseRequestFilters(),Kt).then((function(){K(Kt,$t,Ht,T,S,I)}))}else V(lt,new ct.Z(ut.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,ut.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE))}(rt,wt,Et)}else V(Lt,new ct.Z(ut.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,ut.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE))}function V(nt,rt){Gt.trigger(Ht.LICENSE_REQUEST_COMPLETE,{data:nt,error:rt})}function K(nt,rt,at,st,ot,lt){var ut=new XMLHttpRequest;if(Qt.get().streaming.cmcd&&Qt.get().streaming.cmcd.enabled&&Qt.get().streaming.cmcd.mode===Et.Z.CMCD_MODE_QUERY){var ct=Wt.getQueryParameter({url:nt.url,type:pt.w.LICENSE});ct&&(nt.url=_t.Z.addAditionalQueryParameterToUrl(nt.url,[ct]))}for(var dt in ut.open(nt.method,nt.url,!0),ut.responseType=nt.responseType,ut.withCredentials=nt.withCredentials,at>0&&(ut.timeout=at),nt.headers)ut.setRequestHeader(dt,nt.headers[dt]);if(Qt.get().streaming.cmcd&&Qt.get().streaming.cmcd.enabled&&Qt.get().streaming.cmcd.mode===Et.Z.CMCD_MODE_HEADER){var ht=Wt.getHeaderParameters({url:nt.url,type:pt.w.LICENSE});if(ht)for(var St in ht){var wt=ht[St];wt&&ut.setRequestHeader(St,wt)}}var g=function(){rt--;var it=isNaN(Qt.get().streaming.retryIntervals[pt.w.LICENSE])?1e3:Qt.get().streaming.retryIntervals[pt.w.LICENSE];Ft=setTimeout((function(){K(nt,rt,at,st,ot,lt)}),it)};ut.onload=function(){Ot=null,this.status>=200&&this.status<=299||rt<=0?st(this):(it.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+rt),g())},ut.ontimeout=ut.onerror=function(){Ot=null,rt<=0?lt(this):(it.warn("License request network request failed . Retrying it... Pending retries: "+rt),g())},ut.onabort=function(){ot(this)},Gt.trigger(Ht.LICENSE_REQUEST_SENDING,{url:nt.url,headers:nt.headers,payload:nt.data,sessionId:nt.sessionId}),Ot=ut,ut.send(nt.data)}function z(){Ot&&(Ot.onloadend=Ot.onerror=Ot.onprogress=void 0,Ot.abort(),Ot=null),Ft&&(clearTimeout(Ft),Ft=null)}function W(nt,rt){if(rt)for(var it in rt)nt[it]=rt[it]}function X(nt,rt,it,at,st){var ot="NONE",lt=null;nt.response&&(ot=st.getErrorResponse(nt.response,it,at),lt={serverResponse:nt.response||null,responseCode:nt.status||null,responseText:nt.statusText||null}),V(rt,new ct.Z(ut.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,ut.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+it+' update, XHR complete. status is "'+nt.statusText+'" ('+nt.status+"), readyState is "+nt.readyState+".  Response is "+ot,lt))}function Q(nt,rt){return nt?nt.reduce((function(nt,it){return nt.then((function(){return it(rt)}))}),Promise.resolve()):Promise.resolve()}function J(nt,rt){if(!Qt.get().streaming.protection.ignoreEmeEncryptedEvent){if(it.debug("DRM: onNeedKey"),"cenc"!==nt.key.initDataType)return void it.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+nt.key.initDataType);if(0===St.length&&(it.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),(rt=void 0===rt?1:rt+1)<5))return void Yt.push(setTimeout((function(){J(nt,rt)}),500));var ot=nt.key.initData;if(ArrayBuffer.isView(ot)&&(ot=ot.buffer),Pt){var lt=st.getPSSHForKeySystem(Pt,ot);if(lt&&G(lt))return}it.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(ot)));var ut=Bt.getSupportedKeySystemsFromSegmentPssh(ot,wt,Lt);if(0===ut.length)return void it.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!");!function(nt){at.push(nt),F(nt,!1)}(ut)}}return rt={initializeForMedia:function(nt){if(!nt)throw new Error("mediaInfo can not be null or undefined");L(),St.push(nt)},clearMediaInfoArray:function(){St=[]},handleKeySystemFromManifest:function(){if(St&&0!==St.length){var nt=[];St.forEach((function(rt){var it=Bt.getSupportedKeySystemsFromContentProtection(rt.contentProtection,wt,Lt);it.length>0&&(0===nt.length&&(nt=it),at.push(it))})),nt&&nt.length>0&&F(nt,!0)}},createKeySession:Z,loadKeySession:U,removeKeySession:function(nt){L(),Ut.removeKeySession(nt)},closeKeySession:function(nt){L(),Ut.closeKeySession(nt)},setServerCertificate:function(nt){L(),Ut.setServerCertificate(nt)},setMediaElement:q,setSessionType:function(nt){Lt=nt},setRobustnessLevel:function(nt){Ct=nt},setProtectionData:function(nt){wt=nt,Bt.setProtectionData(nt)},getSupportedKeySystemsFromContentProtection:function(nt){return L(),Bt.getSupportedKeySystemsFromContentProtection(nt,wt,Lt)},getKeySystems:function(){return Bt?Bt.getKeySystems():[]},setKeySystems:function(nt){Bt&&Bt.setKeySystems(nt)},stop:function(){z(),Ut&&Ut.stop()},reset:function(){Gt.off(Ht.INTERNAL_KEY_MESSAGE,H,rt),Gt.off(Ht.INTERNAL_KEY_STATUS_CHANGED,j,rt),L(),z(),q(null),Pt=null,kt=!1,Ut&&(Ut.reset(),Ut=null),Yt.forEach((function(nt){return clearTimeout(nt)})),Yt=[],St=[],at=[]}},it=jt.getLogger(rt),at=[],St=[],Lt="temporary",Ct="",Ot=null,Ft=null,Gt.on(Ht.INTERNAL_KEY_MESSAGE,H,rt),Gt.on(Ht.INTERNAL_KEY_STATUS_CHANGED,j,rt),rt}T.__dashjs_factory_name="ProtectionController";var wt=St.Z.getClassFactory(T),Lt=function e(nt,rt){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.keyID=nt,this.key=rt};function A(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var Ct=function(){function e(nt,rt){if(function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),rt&&"persistent"!==rt&&"temporary"!==rt)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=nt,this.type=rt}var nt;return(nt=[{key:"toJWK",value:function(){var nt,rt=this.keyPairs.length,it={keys:[]};for(nt=0;nt<rt;nt++){var at={kty:"oct",alg:"A128KW",kid:this.keyPairs[nt].keyID,k:this.keyPairs[nt].key};it.keys.push(at)}this.type&&(it.type=this.type);var st=JSON.stringify(it),ot=st.length,lt=new ArrayBuffer(ot),ut=new Uint8Array(lt);for(nt=0;nt<ot;nt++)ut[nt]=st.charCodeAt(nt);return lt}}])&&A(e.prototype,nt),e}();function R(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var Pt=new(function(){function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var nt;return(nt=[{key:"init",value:function(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready",this.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING="com.microsoft.playready.recommendation",this.INITIALIZATION_DATA_TYPE_CENC="cenc",this.INITIALIZATION_DATA_TYPE_KEYIDS="keyids",this.INITIALIZATION_DATA_TYPE_WEBM="webm"}}])&&R(e.prototype,nt),e}()),kt="e2719d58-a985-b3c9-781a-b030af78d30e",Ot=Pt.CLEARKEY_KEYSTEM_STRING,Ft="urn:uuid:"+kt;function O(nt){var rt=(nt=nt||{}).BASE64;return{uuid:kt,schemeIdURI:Ft,systemString:Ot,getInitData:function(nt,it){try{var at=st.parseInitDataFromContentProtection(nt,rt);if(!at&&it){var ot={kids:[function(nt){try{var rt=nt.replace(/-/g,"");return(rt=btoa(rt.match(/\w{2}/g).map((function(nt){return String.fromCharCode(parseInt(nt,16))})).join(""))).replace(/=/g,"").replace(/\//g,"_").replace(/\+/g,"-")}catch(nt){return null}}(it["cenc:default_KID"])]};at=(new TextEncoder).encode(JSON.stringify(ot))}return at}catch(nt){return null}},getRequestHeadersFromMessage:function(){return{"Content-Type":"application/json"}},getLicenseRequestFromMessage:function(nt){return JSON.stringify(JSON.parse(String.fromCharCode.apply(null,new Uint8Array(nt))))},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getClearKeysFromProtectionData:function(nt,rt){var it=null;if(nt){for(var at=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(rt))),st=[],ot=0;ot<at.kids.length;ot++){var lt=at.kids[ot],ut=nt.clearkeys&&nt.clearkeys.hasOwnProperty(lt)?nt.clearkeys[lt]:null;if(!ut)throw new Error("DRM: ClearKey keyID ("+lt+") is not known!");st.push(new Lt(lt,ut))}it=new Ct(st)}return it}}}O.__dashjs_factory_name="KeySystemClearKey";var Bt=dashjs.FactoryMaker.getSingletonFactory(O),Ut="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",Gt=Pt.CLEARKEY_KEYSTEM_STRING,Ht="urn:uuid:"+Ut;function x(nt){var rt,it=nt.BASE64,at=nt.debug.getLogger(rt);return{uuid:Ut,schemeIdURI:Ht,systemString:Gt,getInitData:function(nt){return st.parseInitDataFromContentProtection(nt,it)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(nt){return new Uint8Array(nt)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getClearKeysFromProtectionData:function(nt,rt){var it=null;if(nt){for(var st=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(rt))),ot=[],lt=0;lt<st.kids.length;lt++){var ut=st.kids[lt],ct=nt.clearkeys&&nt.clearkeys.hasOwnProperty(ut)?nt.clearkeys[ut]:null;if(!ct)throw new Error("DRM: ClearKey keyID ("+ut+") is not known!");ot.push(new Lt(ut,ct))}it=new Ct(ot),at.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return it}}}x.__dashjs_factory_name="KeySystemW3CClearKey";var jt=dashjs.FactoryMaker.getSingletonFactory(x),Kt="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",$t=Pt.WIDEVINE_KEYSTEM_STRING,Yt="urn:uuid:"+Kt;function G(nt){var rt=(nt=nt||{}).BASE64;return{uuid:Kt,schemeIdURI:Yt,systemString:$t,getInitData:function(nt){return st.parseInitDataFromContentProtection(nt,rt)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(nt){return new Uint8Array(nt)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null}}}G.__dashjs_factory_name="KeySystemWidevine";var Wt=dashjs.FactoryMaker.getSingletonFactory(G),Qt="9a04f079-9840-4286-ab92-e65be0885f95",en=Pt.PLAYREADY_KEYSTEM_STRING,nn="urn:uuid:"+Qt;function V(nt){var rt="utf-16",it=(nt=nt||{}).BASE64,at=nt.settings;function i(){if(!it||!it.hasOwnProperty("decodeArray")||!it.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}return{uuid:Qt,schemeIdURI:nn,systemString:en,getInitData:function(nt){var rt,at,ot,lt,ut,ct=new Uint8Array([112,115,115,104,0,0,0,0]),dt=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),ht=0,pt=null;if(i(),!nt)return null;if("pssh"in nt)return st.parseInitDataFromContentProtection(nt,it);if("pro"in nt)pt=it.decodeArray(nt.pro.__text);else{if(!("prheader"in nt))return null;pt=it.decodeArray(nt.prheader.__text)}return rt=pt.length,at=4+ct.length+dt.length+4+rt,ot=new ArrayBuffer(at),lt=new Uint8Array(ot),(ut=new DataView(ot)).setUint32(ht,at),ht+=4,lt.set(ct,ht),ht+=ct.length,lt.set(dt,ht),ht+=dt.length,ut.setUint32(ht,rt),ht+=4,lt.set(pt,ht),ht+=rt,lt.buffer},getRequestHeadersFromMessage:function(nt){var it,st,ot={},lt=new DOMParser;if(at&&at.get().streaming.protection.detectPlayreadyMessageFormat&&"utf-16"===rt&&nt&&nt.byteLength%2==1)return ot["Content-Type"]="text/xml; charset=utf-8",ot;var ut="utf-16"===rt?new Uint16Array(nt):new Uint8Array(nt);it=String.fromCharCode.apply(null,ut);for(var ct=(st=lt.parseFromString(it,"application/xml")).getElementsByTagName("name"),dt=st.getElementsByTagName("value"),ht=0;ht<ct.length;ht++)ot[ct[ht].childNodes[0].nodeValue]=dt[ht].childNodes[0].nodeValue;return ot.hasOwnProperty("Content")&&(ot["Content-Type"]=ot.Content,delete ot.Content),ot.hasOwnProperty("Content-Type")||(ot["Content-Type"]="text/xml; charset=utf-8"),ot},getLicenseRequestFromMessage:function(nt){var st=null,ot=new DOMParser;if(at&&at.get().streaming.protection.detectPlayreadyMessageFormat&&"utf-16"===rt&&nt&&nt.byteLength%2==1)return nt;var lt="utf-16"===rt?new Uint16Array(nt):new Uint8Array(nt);i();var ut=String.fromCharCode.apply(null,lt),ct=ot.parseFromString(ut,"application/xml");if(!ct.getElementsByTagName("PlayReadyKeyMessage")[0])return nt;var dt=ct.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;return dt&&(st=it.decode(dt)),st},getLicenseServerURLFromInitData:function(nt){if(nt)for(var rt=new DataView(nt),it=rt.getUint16(4,!0),at=6,st=new DOMParser,ot=0;ot<it;ot++){var lt=rt.getUint16(at,!0);at+=2;var ut=rt.getUint16(at,!0);if(at+=2,1===lt){var ct=nt.slice(at,at+ut),dt=String.fromCharCode.apply(null,new Uint16Array(ct)),ht=st.parseFromString(dt,"application/xml");if(ht.getElementsByTagName("LA_URL")[0]){var pt=ht.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(pt)return pt}if(ht.getElementsByTagName("LUI_URL")[0]){var _t=ht.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(_t)return _t}}else at+=ut}return null},getCDMData:function(nt){var rt,at,st,ot;if(i(),!nt)return null;for(rt=[],ot=0;ot<nt.length;++ot)rt.push(nt.charCodeAt(ot)),rt.push(0);for(rt=String.fromCharCode.apply(null,rt),rt=it.encode(rt),at='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>'.replace("%CUSTOMDATA%",rt),st=[],ot=0;ot<at.length;++ot)st.push(at.charCodeAt(ot)),st.push(0);return new Uint8Array(st).buffer},setPlayReadyMessageFormat:function(nt){if("utf-8"!==nt&&"utf-16"!==nt)throw new Error('Specified message format is not one of "utf-8" or "utf-16"');rt=nt}}}V.__dashjs_factory_name="KeySystemPlayReady";var an=dashjs.FactoryMaker.getSingletonFactory(V);function z(nt){var rt=(nt=nt||{}).BASE64,it={};return it[Pt.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(nt){return rt.decodeArray(nt.license)},getErrorResponse:function(nt){return nt}},it[Pt.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(nt){return nt},getErrorResponse:function(nt){return String.fromCharCode.apply(null,new Uint8Array(nt))}},{getServerURLFromMessage:function(nt){return nt},getHTTPMethod:function(){return"POST"},getResponseType:function(nt){return it[nt].responseType},getLicenseMessage:function(nt,at){return function(){if(!rt||!rt.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}(),it[at].getLicenseMessage(nt)},getErrorResponse:function(nt,rt){return it[rt].getErrorResponse(nt)}}}z.__dashjs_factory_name="DRMToday";var ln=dashjs.FactoryMaker.getSingletonFactory(z);function X(){var nt="http://schemas.xmlsoap.org/soap/envelope/";function t(nt){var rt=String.fromCharCode.apply(null,new Uint8Array(nt));return decodeURIComponent(escape(rt))}function n(rt){if(window.DOMParser){var it=t(rt),at=(new window.DOMParser).parseFromString(it,"text/xml"),st=at?at.getElementsByTagNameNS(nt,"Envelope")[0]:null,ot=st?st.getElementsByTagNameNS(nt,"Body")[0]:null;if(ot&&ot.getElementsByTagNameNS(nt,"Fault")[0])return null}return rt}function r(rt){var it="",at="",st="",ot=-1,lt=-1;if(window.DOMParser){var ut=t(rt),ct=(new window.DOMParser).parseFromString(ut,"text/xml"),dt=ct?ct.getElementsByTagNameNS(nt,"Envelope")[0]:null,ht=dt?dt.getElementsByTagNameNS(nt,"Body")[0]:null,pt=ht?ht.getElementsByTagNameNS(nt,"Fault")[0]:null,_t=pt?pt.getElementsByTagName("detail")[0]:null,Et=_t?_t.getElementsByTagName("Exception")[0]:null,St=null;if(null===pt)return ut;it=(St=pt.getElementsByTagName("faultstring")[0].firstChild)?St.nodeValue:null,null!==Et&&(at=(St=Et.getElementsByTagName("StatusCode")[0])?St.firstChild.nodeValue:null,ot=(st=(St=Et.getElementsByTagName("Message")[0])?St.firstChild.nodeValue:null)?st.lastIndexOf("[")+1:-1,lt=st?st.indexOf("]"):-1,st=st?st.substring(ot,lt):"")}var wt="code: ".concat(at,", name: ").concat(it);return st&&(wt+=", message: ".concat(st)),wt}return{getServerURLFromMessage:function(nt){return nt},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(nt){return n.call(this,nt)},getErrorResponse:function(nt){return r.call(this,nt)}}}X.__dashjs_factory_name="PlayReady";var hn=St.Z.getSingletonFactory(X);function J(){return{getServerURLFromMessage:function(nt){return nt},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(nt){return nt},getErrorResponse:function(nt){return String.fromCharCode.apply(null,new Uint8Array(nt))}}}J.__dashjs_factory_name="Widevine";var fn=dashjs.FactoryMaker.getSingletonFactory(J);function ee(){return{getServerURLFromMessage:function(nt){return nt},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"json"},getLicenseMessage:function(nt){if(!nt.hasOwnProperty("keys"))return null;for(var rt=[],it=0;it<nt.keys.length;it++){var at=nt.keys[it],st=at.kid.replace(/=/g,""),ot=at.k.replace(/=/g,"");rt.push(new Lt(st,ot))}return new Ct(rt)},getErrorResponse:function(nt){return String.fromCharCode.apply(null,new Uint8Array(nt))}}}ee.__dashjs_factory_name="ClearKey";var pn=dashjs.FactoryMaker.getSingletonFactory(ee);function ne(){var nt,rt,it,at,ot,lt,ut,ct,dt=this.context;function c(nt,rt){return rt&&nt in rt?rt[nt]:null}function f(nt,rt){return nt&&nt.sessionId?nt.sessionId:rt&&rt.sessionId?rt.sessionId:null}function d(nt,rt){return nt&&nt.sessionType?nt.sessionType:rt}return nt={initialize:function(){var nt;at=[],nt=an(dt).getInstance({BASE64:ot,settings:lt}),at.push(nt),nt=Wt(dt).getInstance({BASE64:ot}),at.push(nt),nt=Bt(dt).getInstance({BASE64:ot}),at.push(nt),ut=nt,nt=jt(dt).getInstance({BASE64:ot,debug:rt}),at.push(nt),ct=nt},setProtectionData:function(nt){for(var rt,it,st=0;st<at.length;st++){var ot=at[st];ot.hasOwnProperty("init")&&ot.init((rt=ot.systemString,it=void 0,it=null,nt&&(it=rt in nt?nt[rt]:null),it))}},isClearKey:function(nt){return nt===ut||nt===ct},initDataEquals:function(nt,rt){if(nt.byteLength===rt.byteLength){for(var it=new Uint8Array(nt),at=new Uint8Array(rt),st=0;st<it.length;st++)if(it[st]!==at[st])return!1;return!0}return!1},getKeySystems:function(){return at},setKeySystems:function(nt){at=nt},getKeySystemBySystemString:function(nt){for(var rt=0;rt<at.length;rt++)if(at[rt].systemString===nt)return at[rt];return null},getSupportedKeySystemsFromContentProtection:function(nt,rt,it){var ot,lt,ut,ct,dt=[];if(nt){var ht=st.findCencContentProtection(nt);for(ut=0;ut<at.length;++ut){var pt=c((lt=at[ut]).systemString,rt);for(ct=0;ct<nt.length;++ct)if((ot=nt[ct]).schemeIdUri.toLowerCase()===lt.schemeIdURI){var _t=lt.getInitData(ot,ht);dt.push({ks:at[ut],keyId:ot.keyId,initData:_t,protData:pt,cdmData:lt.getCDMData(pt?pt.cdmData:null),sessionId:f(pt,ot),sessionType:d(pt,it)})}}}return dt},getSupportedKeySystemsFromSegmentPssh:function(nt,rt,it){for(var ot,lt=[],ut=st.parsePSSHList(nt),ct=0;ct<at.length;++ct){var dt=c((ot=at[ct]).systemString,rt);ot.uuid in ut&&lt.push({ks:ot,initData:ut[ot.uuid],protData:dt,cdmData:ot.getCDMData(dt?dt.cdmData:null),sessionId:f(dt),sessionType:d(dt,it)})}return lt},getLicenseServerModelInstance:function(nt,rt,it){if("license-release"===it||"individualization-request"===it)return null;var at=null;return rt&&rt.hasOwnProperty("drmtoday")?at=ln(dt).getInstance({BASE64:ot}):nt.systemString===Pt.WIDEVINE_KEYSTEM_STRING?at=fn(dt).getInstance():nt.systemString===Pt.PLAYREADY_KEYSTEM_STRING?at=hn(dt).getInstance():nt.systemString===Pt.CLEARKEY_KEYSTEM_STRING&&(at=pn(dt).getInstance()),at},processClearKeyLicenseRequest:function(nt,rt,at){try{return nt.getClearKeysFromProtectionData(rt,at)}catch(nt){return it.error("Failed to retrieve clearkeys from ProtectionData"),null}},setConfig:function(at){at&&(at.debug&&(rt=at.debug,it=rt.getLogger(nt)),at.BASE64&&(ot=at.BASE64),at.settings&&(lt=at.settings))}},nt}ne.__dashjs_factory_name="ProtectionKeyController";var mn=dashjs.FactoryMaker.getSingletonFactory(ne);function ie(nt){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},ie(nt)}function ae(nt,rt){return ae=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},ae(nt,rt)}function oe(nt,rt){return!rt||"object"!==ie(rt)&&"function"!=typeof rt?function(nt){if(void 0===nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt}(nt):rt}function se(nt){return se=Object.setPrototypeOf?Object.getPrototypeOf:function(nt){return nt.__proto__||Object.getPrototypeOf(nt)},se(nt)}var gn=new(function(nt){!function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Super expression must either be null or a function");nt.prototype=Object.create(rt&&rt.prototype,{constructor:{value:nt,writable:!0,configurable:!0}}),rt&&ae(nt,rt)}(i,nt);var rt,it,at=(rt=i,it=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(nt){return!1}}(),function(){var nt,at=se(rt);if(it){var st=se(this).constructor;nt=Reflect.construct(at,arguments,st)}else nt=at.apply(this,arguments);return oe(this,nt)});function i(){var nt;return function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,i),(nt=at.call(this)).INTERNAL_KEY_MESSAGE="internalKeyMessage",nt.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",nt.KEY_ADDED="public_keyAdded",nt.KEY_ERROR="public_keyError",nt.KEY_MESSAGE="public_keyMessage",nt.KEY_SESSION_CLOSED="public_keySessionClosed",nt.KEY_SESSION_CREATED="public_keySessionCreated",nt.KEY_SESSION_REMOVED="public_keySessionRemoved",nt.KEY_STATUSES_CHANGED="public_keyStatusesChanged",nt.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",nt.KEY_SYSTEM_SELECTED="public_keySystemSelected",nt.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",nt.LICENSE_REQUEST_SENDING="public_licenseRequestSending",nt.NEED_KEY="needkey",nt.PROTECTION_CREATED="public_protectioncreated",nt.PROTECTION_DESTROYED="public_protectiondestroyed",nt.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",nt.TEARDOWN_COMPLETE="protectionTeardownComplete",nt.VIDEO_ELEMENT_SELECTED="videoElementSelected",nt.KEY_SESSION_UPDATED="public_keySessionUpdated",nt}return i}(it(8342).Z)),_n=function e(nt,rt){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.initData=nt,this.initDataType=rt},vn=function e(nt,rt,it,at){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.sessionToken=nt,this.message=rt,this.defaultURL=it,this.messageType=at||"license-request"},En=function e(nt,rt){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.keySystem=nt,this.ksConfiguration=rt},Tn={};function ge(nt){nt=nt||{};var rt,it,at,st,ot,lt,dt,ht,pt=this.context,_t=nt.eventBus,Et=nt.events,St=nt.debug;function p(nt,rt,it,at){if(void 0===navigator.requestMediaKeySystemAccess||"function"!=typeof navigator.requestMediaKeySystemAccess){var st="Insecure origins are not allowed";return _t.trigger(Et.KEY_SYSTEM_ACCESS_COMPLETE,{error:st}),void at({error:st})}var ot=nt[rt].protData&&nt[rt].protData.systemStringPriority?nt[rt].protData.systemStringPriority:null,lt=nt[rt].configs,ut=nt[rt].ks,ct=ut.systemString;(function(nt,rt){return new Promise((function(it,at){m(nt,rt,0,it,at)}))})(ot||(Tn[ct]?Tn[ct]:[ct]),lt).then((function(nt){var rt="function"==typeof nt.getConfiguration?nt.getConfiguration():null,at=new En(ut,rt);at.mksa=nt,_t.trigger(Et.KEY_SYSTEM_ACCESS_COMPLETE,{data:at}),it({data:at})})).catch((function(st){if(rt+1<nt.length)p(nt,rt+1,it,at);else{var ot="Key system access denied! ";_t.trigger(Et.KEY_SYSTEM_ACCESS_COMPLETE,{error:ot+st.message}),at({error:ot+st.message})}}))}function m(nt,rt,at,st,ot){var lt=nt[at];it.debug("Requesting key system access for system string ".concat(lt)),navigator.requestMediaKeySystemAccess(lt,rt).then((function(nt){nt.selectedSystemString=lt,st(nt)})).catch((function(it){at+1<nt.length?m(nt,rt,at+1,st,ot):ot(it)}))}function y(nt){if(!nt||!nt.session)return Promise.resolve;var rt=nt.session;return rt.removeEventListener("keystatuseschange",nt),rt.removeEventListener("message",nt),rt.close()}function E(nt){for(var rt=0;rt<lt.length;rt++)if(lt[rt]===nt){lt.splice(rt,1);break}}function v(nt){var rt,it;return nt&&nt.length>0&&(nt[0]&&("string"==typeof nt[0]?rt=nt[0]:it=nt[0]),nt[1]&&("string"==typeof nt[1]?rt=nt[1]:it=nt[1])),{status:rt,keyId:it}}function _(nt,rt){var at={session:nt,keyId:rt.keyId,initData:rt.initData,sessionId:rt.sessionId,sessionType:rt.sessionType,handleEvent:function(nt){switch(nt.type){case"keystatuseschange":_t.trigger(Et.KEY_STATUSES_CHANGED,{data:this}),nt.target.keyStatuses.forEach((function(){var nt=v(arguments);"expired"===nt.status?_t.trigger(Et.INTERNAL_KEY_STATUS_CHANGED,{error:new ct.Z(ut.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,ut.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)}):_t.trigger(Et.INTERNAL_KEY_STATUS_CHANGED,nt)}));break;case"message":var rt=ArrayBuffer.isView(nt.message)?nt.message.buffer:nt.message;_t.trigger(Et.INTERNAL_KEY_MESSAGE,{data:new vn(this,rt,void 0,nt.messageType)})}},getKeyId:function(){return this.keyId},getSessionId:function(){return nt.sessionId},getSessionType:function(){return this.sessionType},getExpirationTime:function(){return nt.expiration},getKeyStatuses:function(){return nt.keyStatuses},getUsable:function(){var rt=!1;return nt.keyStatuses.forEach((function(){"usable"===v(arguments).status&&(rt=!0)})),rt}};return nt.addEventListener("keystatuseschange",at),nt.addEventListener("message",at),nt.closed.then((function(){E(at),it.debug("DRM: Session closed.  SessionID = "+at.getSessionId()),_t.trigger(Et.KEY_SESSION_CLOSED,{data:at.getSessionId()})})),lt.push(at),at}return rt={getAllInitData:function(){for(var nt=[],rt=0;rt<lt.length;rt++)lt[rt].initData&&nt.push(lt[rt].initData);return nt},getSessions:function(){return lt},requestKeySystemAccess:function(nt){return new Promise((function(rt,it){p(nt,0,rt,it)}))},selectKeySystem:function(nt){return new Promise((function(rt,it){nt.mksa.createMediaKeys().then((function(rt){return at=nt.keySystem,ot=rt,st?st.setMediaKeys(ot):Promise.resolve()})).then((function(){rt(at)})).catch((function(){it({error:"Error selecting keys system ("+nt.keySystem.systemString+")! Could not create MediaKeys -- TODO"})}))}))},setMediaElement:function(nt){st!==nt&&(st&&(st.removeEventListener("encrypted",dt),st.setMediaKeys&&st.setMediaKeys(null)),(st=nt)&&(st.addEventListener("encrypted",dt),st.setMediaKeys&&ot&&st.setMediaKeys(ot)))},setServerCertificate:function(nt){if(!at||!ot)throw new Error("Can not set server certificate until you have selected a key system");ot.setServerCertificate(nt).then((function(){it.info("DRM: License server certificate successfully updated."),_t.trigger(Et.SERVER_CERTIFICATE_UPDATED)})).catch((function(nt){_t.trigger(Et.SERVER_CERTIFICATE_UPDATED,{error:new ct.Z(ut.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,ut.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+nt.name)})}))},createKeySession:function(nt){if(!at||!ot)throw new Error("Can not create sessions until you have selected a key system");var rt=ot.createSession(nt.sessionType),st=_(rt,nt),lt=at.systemString===Pt.CLEARKEY_KEYSTEM_STRING&&(nt.initData||nt.protData&&nt.protData.clearkeys)?Pt.INITIALIZATION_DATA_TYPE_KEYIDS:Pt.INITIALIZATION_DATA_TYPE_CENC;rt.generateRequest(lt,nt.initData).then((function(){it.debug("DRM: Session created.  SessionID = "+st.getSessionId()),_t.trigger(Et.KEY_SESSION_CREATED,{data:st})})).catch((function(nt){E(st),_t.trigger(Et.KEY_SESSION_CREATED,{data:null,error:new ct.Z(ut.KEY_SESSION_CREATED_ERROR_CODE,ut.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+nt.name)})}))},updateKeySession:function(nt,rt){var it=nt.session;ht.isClearKey(at)&&(rt=rt.toJWK()),it.update(rt).then((function(){_t.trigger(Et.KEY_SESSION_UPDATED)})).catch((function(rt){_t.trigger(Et.KEY_ERROR,{error:new ct.Z(ut.MEDIA_KEYERR_CODE,"Error sending update() message! "+rt.name,nt)})}))},loadKeySession:function(nt){if(!at||!ot)throw new Error("Can not load sessions until you have selected a key system");for(var rt=nt.sessionId,st=0;st<lt.length;st++)if(rt===lt[st].sessionId)return void it.warn("DRM: Ignoring session ID because we have already seen it!");var dt=ot.createSession(nt.sessionType),ht=_(dt,nt);dt.load(rt).then((function(nt){nt?(it.debug("DRM: Session loaded.  SessionID = "+ht.getSessionId()),_t.trigger(Et.KEY_SESSION_CREATED,{data:ht})):(E(ht),_t.trigger(Et.KEY_SESSION_CREATED,{data:null,error:new ct.Z(ut.KEY_SESSION_CREATED_ERROR_CODE,ut.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+rt+")")}))})).catch((function(nt){E(ht),_t.trigger(Et.KEY_SESSION_CREATED,{data:null,error:new ct.Z(ut.KEY_SESSION_CREATED_ERROR_CODE,ut.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+rt+")! "+nt.name)})}))},removeKeySession:function(nt){nt.session.remove().then((function(){it.debug("DRM: Session removed.  SessionID = "+nt.getSessionId()),_t.trigger(Et.KEY_SESSION_REMOVED,{data:nt.getSessionId()})}),(function(rt){_t.trigger(Et.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+nt.getSessionId()+"). "+rt.name})}))},closeKeySession:function(nt){y(nt).catch((function(rt){E(nt),_t.trigger(Et.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+nt.getSessionId()+") "+rt.name})}))},stop:function(){for(var nt,rt=0;rt<lt.length;rt++)(nt=lt[rt]).getUsable()||(y(nt),E(nt))},reset:function(){var nt,rt=lt.length;0!==rt?function(){for(var n=function(nt){E(nt),0===lt.length&&(st?(st.removeEventListener("encrypted",dt),st.setMediaKeys(null).then((function(){_t.trigger(Et.TEARDOWN_COMPLETE)}))):_t.trigger(Et.TEARDOWN_COMPLETE))},it=0;it<rt;it++)!function(rt){y(nt),n(rt)}(nt=lt[it])}():_t.trigger(Et.TEARDOWN_COMPLETE)}},it=St.getLogger(rt),at=null,st=null,ot=null,lt=[],ht=mn(pt).getInstance(),dt={handleEvent:function(nt){if("encrypted"===nt.type&&nt.initData){var rt=ArrayBuffer.isView(nt.initData)?nt.initData.buffer:nt.initData;_t.trigger(Et.NEED_KEY,{key:new _n(rt,nt.initDataType)})}}},rt}Tn[Pt.PLAYREADY_KEYSTEM_STRING]=[Pt.PLAYREADY_KEYSTEM_STRING,Pt.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING],Tn[Pt.WIDEVINE_KEYSTEM_STRING]=[Pt.WIDEVINE_KEYSTEM_STRING],Tn[Pt.CLEARKEY_KEYSTEM_STRING]=[Pt.CLEARKEY_KEYSTEM_STRING],ge.__dashjs_factory_name="ProtectionModel_21Jan2015";var bn=dashjs.FactoryMaker.getClassFactory(ge);function pe(nt){nt=nt||{};var rt,it,at,st,ot,dt,ht,pt,_t,Et=this.context,St=nt.eventBus,wt=nt.events,Lt=nt.debug,Ct=nt.api;function E(){try{for(var nt=0;nt<ht.length;nt++)v(ht[nt]);at&&at.removeEventListener(Ct.needkey,pt),St.trigger(wt.TEARDOWN_COMPLETE)}catch(nt){St.trigger(wt.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+nt.message})}}function v(nt){var rt=nt.session;rt.removeEventListener(Ct.error,nt),rt.removeEventListener(Ct.message,nt),rt.removeEventListener(Ct.ready,nt),rt.removeEventListener(Ct.close,nt);for(var it=0;it<ht.length;it++)if(ht[it]===nt){ht.splice(it,1);break}rt[Ct.release]()}function _(){var nt=null,t=function(){at.removeEventListener("loadedmetadata",nt),at[Ct.setMediaKeys](ot),St.trigger(wt.VIDEO_ELEMENT_SELECTED)};at.readyState>=1?t():(nt=t.bind(this),at.addEventListener("loadedmetadata",nt))}return rt={getAllInitData:function(){for(var nt=[],rt=0;rt<ht.length;rt++)nt.push(ht[rt].initData);return nt},getSessions:function(){return ht},requestKeySystemAccess:function(nt){return new Promise((function(rt,it){for(var at=!1,st=0;st<nt.length;st++)for(var ot=nt[st].ks.systemString,ut=nt[st].configs,ct=null,dt=null,ht=0;ht<ut.length;ht++){var pt=ut[ht].audioCapabilities,Et=ut[ht].videoCapabilities;if(pt&&0!==pt.length){ct=[];for(var Lt=0;Lt<pt.length;Lt++)window[Ct.MediaKeys].isTypeSupported(ot,pt[Lt].contentType)&&ct.push(pt[Lt])}if(Et&&0!==Et.length){dt=[];for(var Pt=0;Pt<Et.length;Pt++)window[Ct.MediaKeys].isTypeSupported(ot,Et[Pt].contentType)&&dt.push(Et[Pt])}if(!(!ct&&!dt||ct&&0===ct.length||dt&&0===dt.length)){at=!0;var kt=new lt(ct,dt),Ot=_t.getKeySystemBySystemString(ot),Ft=new En(Ot,kt);St.trigger(wt.KEY_SYSTEM_ACCESS_COMPLETE,{data:Ft}),rt({data:Ft});break}}if(!at){var Bt="Key system access denied! -- No valid audio/video content configurations detected!";St.trigger(wt.KEY_SYSTEM_ACCESS_COMPLETE,{error:Bt}),it({error:Bt})}}))},selectKeySystem:function(nt){return new Promise((function(rt,it){try{ot=nt.mediaKeys=new window[Ct.MediaKeys](nt.keySystem.systemString),st=nt.keySystem,dt=nt,at&&_(),rt(st)}catch(nt){it({error:"Error selecting keys system ("+st.systemString+")! Could not create MediaKeys -- TODO"})}}))},setMediaElement:function(nt){at!==nt&&(at&&at.removeEventListener(Ct.needkey,pt),(at=nt)&&(at.addEventListener(Ct.needkey,pt),ot&&_()))},createKeySession:function(nt){if(!st||!ot||!dt)throw new Error("Can not create sessions until you have selected a key system");var rt=null;if(dt.ksConfiguration.videoCapabilities&&dt.ksConfiguration.videoCapabilities.length>0&&(rt=dt.ksConfiguration.videoCapabilities[0]),null===rt&&dt.ksConfiguration.audioCapabilities&&dt.ksConfiguration.audioCapabilities.length>0&&(rt=dt.ksConfiguration.audioCapabilities[0]),null===rt)throw new Error("Can not create sessions for unknown content types.");var at=rt.contentType,lt=ot.createSession(at,new Uint8Array(nt.initData),nt.cdmData?new Uint8Array(nt.cdmData):null),pt=function(nt,rt){return{session:nt,keyId:rt.keyId,initData:rt.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(nt){switch(nt.type){case Ct.error:St.trigger(wt.KEY_ERROR,{error:new ct.Z(ut.MEDIA_KEYERR_CODE,"KeyError",this)});break;case Ct.message:var rt=ArrayBuffer.isView(nt.message)?nt.message.buffer:nt.message;St.trigger(wt.INTERNAL_KEY_MESSAGE,{data:new vn(this,rt,nt.destinationURL)});break;case Ct.ready:it.debug("DRM: Key added."),St.trigger(wt.KEY_ADDED);break;case Ct.close:it.debug("DRM: Session closed.  SessionID = "+this.getSessionId()),St.trigger(wt.KEY_SESSION_CLOSED,{data:this.getSessionId()})}}}}(lt,nt);lt.addEventListener(Ct.error,pt),lt.addEventListener(Ct.message,pt),lt.addEventListener(Ct.ready,pt),lt.addEventListener(Ct.close,pt),ht.push(pt),it.debug("DRM: Session created.  SessionID = "+pt.getSessionId()),St.trigger(wt.KEY_SESSION_CREATED,{data:pt})},updateKeySession:function(nt,rt){var it=nt.session;_t.isClearKey(st)?it.update(new Uint8Array(rt.toJWK())):it.update(new Uint8Array(rt)),St.trigger(wt.KEY_SESSION_UPDATED)},closeKeySession:v,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:E,reset:E},it=Lt.getLogger(rt),at=null,st=null,ot=null,dt=null,ht=[],_t=mn(Et).getInstance(),pt={handleEvent:function(nt){if(nt.type===Ct.needkey&&nt.initData){var rt=ArrayBuffer.isView(nt.initData)?nt.initData.buffer:nt.initData;St.trigger(wt.NEED_KEY,{key:new _n(rt,"cenc")})}}},rt}pe.__dashjs_factory_name="ProtectionModel_3Feb2014";var An=dashjs.FactoryMaker.getClassFactory(pe);function ye(nt){nt=nt||{};var rt,it,at,st,ot,dt,ht,pt,_t,Et=this.context,St=nt.eventBus,wt=nt.events,Lt=nt.debug,Ct=nt.api,Pt=nt.errHandler;function v(){at&&S();for(var nt=0;nt<ht.length;nt++)_(ht[nt]);St.trigger(wt.TEARDOWN_COMPLETE)}function _(nt){try{at[Ct.cancelKeyRequest](st.systemString,nt.sessionId)}catch(rt){St.trigger(wt.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+nt.sessionId+") "+rt.message})}}function T(nt,rt){if(rt&&nt){for(var it=nt.length,at=0;at<it;at++)if(nt[at].sessionId==rt)return nt[at];return null}return null}function S(){at.removeEventListener(Ct.keyerror,_t),at.removeEventListener(Ct.needkey,_t),at.removeEventListener(Ct.keymessage,_t),at.removeEventListener(Ct.keyadded,_t)}return rt={getAllInitData:function(){for(var nt=[],rt=0;rt<dt.length;rt++)nt.push(dt[rt].initData);for(var it=0;it<ht.length;it++)nt.push(ht[it].initData);return nt},getSessions:function(){return ht.concat(dt)},requestKeySystemAccess:function(nt){return new Promise((function(rt,it){var st=at;st||(st=document.createElement("video"));for(var ut=!1,ct=0;ct<nt.length;ct++)for(var dt=nt[ct].ks.systemString,ht=nt[ct].configs,pt=null,_t=0;_t<ht.length;_t++){var Et=ht[_t].videoCapabilities;if(Et&&0!==Et.length){pt=[];for(var Lt=0;Lt<Et.length;Lt++)""!==st.canPlayType(Et[Lt].contentType,dt)&&pt.push(Et[Lt])}if(pt&&(!pt||0!==pt.length)){ut=!0;var Ct=new lt(null,pt),Pt=ot.getKeySystemBySystemString(dt),kt=new En(Pt,Ct);St.trigger(wt.KEY_SYSTEM_ACCESS_COMPLETE,{data:kt}),rt({data:kt});break}}if(!ut){var Ot="Key system access denied! -- No valid audio/video content configurations detected!";St.trigger(wt.KEY_SYSTEM_ACCESS_COMPLETE,{error:Ot}),it({error:Ot})}}))},selectKeySystem:function(nt){return st=nt.keySystem,Promise.resolve(st)},setMediaElement:function(nt){if(at!==nt){if(at){S();for(var rt=0;rt<ht.length;rt++)_(ht[rt]);ht=[]}(at=nt)&&(at.addEventListener(Ct.keyerror,_t),at.addEventListener(Ct.needkey,_t),at.addEventListener(Ct.keymessage,_t),at.addEventListener(Ct.keyadded,_t),St.trigger(wt.VIDEO_ELEMENT_SELECTED))}},createKeySession:function(nt){if(!st)throw new Error("Can not create sessions until you have selected a key system");if(pt||0===ht.length){var rt={sessionId:null,keyId:nt.keyId,initData:nt.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return dt.push(rt),at[Ct.generateKeyRequest](st.systemString,new Uint8Array(nt.initData)),rt}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(nt,rt){var it=nt.sessionId;if(ot.isClearKey(st))for(var lt=0;lt<rt.keyPairs.length;lt++)at[Ct.addKey](st.systemString,rt.keyPairs[lt].key,rt.keyPairs[lt].keyID,it);else at[Ct.addKey](st.systemString,new Uint8Array(rt),new Uint8Array(nt.initData),it);St.trigger(wt.KEY_SESSION_UPDATED)},closeKeySession:_,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:v,reset:v},it=Lt.getLogger(rt),at=null,st=null,dt=[],ht=[],ot=mn(Et).getInstance(),_t={handleEvent:function(nt){var rt=null;switch(nt.type){case Ct.needkey:var at=ArrayBuffer.isView(nt.initData)?nt.initData.buffer:nt.initData;St.trigger(wt.NEED_KEY,{key:new _n(at,"cenc")});break;case Ct.keyerror:if((rt=T(ht,nt.sessionId))||(rt=T(dt,nt.sessionId)),rt){var st=ut.MEDIA_KEYERR_CODE,ot="";switch(nt.errorCode.code){case 1:st=ut.MEDIA_KEYERR_UNKNOWN_CODE,ot+="MEDIA_KEYERR_UNKNOWN - "+ut.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:st=ut.MEDIA_KEYERR_CLIENT_CODE,ot+="MEDIA_KEYERR_CLIENT - "+ut.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:st=ut.MEDIA_KEYERR_SERVICE_CODE,ot+="MEDIA_KEYERR_SERVICE - "+ut.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:st=ut.MEDIA_KEYERR_OUTPUT_CODE,ot+="MEDIA_KEYERR_OUTPUT - "+ut.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:st=ut.MEDIA_KEYERR_HARDWARECHANGE_CODE,ot+="MEDIA_KEYERR_HARDWARECHANGE - "+ut.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:st=ut.MEDIA_KEYERR_DOMAIN_CODE,ot+="MEDIA_KEYERR_DOMAIN - "+ut.MEDIA_KEYERR_DOMAIN_MESSAGE}ot+="  System Code = "+nt.systemCode,St.trigger(wt.KEY_ERROR,{error:new ct.Z(st,ot,rt)})}else it.error("No session token found for key error");break;case Ct.keyadded:(rt=T(ht,nt.sessionId))||(rt=T(dt,nt.sessionId)),rt?(it.debug("DRM: Key added."),St.trigger(wt.KEY_ADDED,{data:rt})):it.debug("No session token found for key added");break;case Ct.keymessage:if((pt=null!==nt.sessionId&&void 0!==nt.sessionId)?!(rt=T(ht,nt.sessionId))&&dt.length>0&&(rt=dt.shift(),ht.push(rt),rt.sessionId=nt.sessionId,St.trigger(wt.KEY_SESSION_CREATED,{data:rt})):dt.length>0&&(rt=dt.shift(),ht.push(rt),0!==dt.length&&Pt.error(new ct.Z(ut.MEDIA_KEY_MESSAGE_ERROR_CODE,ut.MEDIA_KEY_MESSAGE_ERROR_MESSAGE))),rt){var lt=ArrayBuffer.isView(nt.message)?nt.message.buffer:nt.message;rt.keyMessage=lt,St.trigger(wt.INTERNAL_KEY_MESSAGE,{data:new vn(rt,lt,nt.defaultURL)})}else it.warn("No session token found for key message")}}},rt}ye.__dashjs_factory_name="ProtectionModel_01b";var Rn=dashjs.FactoryMaker.getClassFactory(ye),In=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],Ln=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function Te(){var nt,rt=this.context;function n(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];if("function"==typeof nt[at[Object.keys(at)[0]]])return at}return null}return nt={createProtectionSystem:function(it){var at=null,st=mn(rt).getInstance();st.setConfig({debug:it.debug,BASE64:it.BASE64,settings:it.settings}),st.initialize();var ot=function(it){var at=it.debug,st=at.getLogger(nt),ot=it.eventBus,lt=it.errHandler,ut=it.videoModel?it.videoModel.getElement():null;return ut&&void 0===ut.onencrypted||ut&&void 0===ut.mediaKeys?n(ut,Ln)?(st.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),An(rt).create({debug:at,eventBus:ot,events:it.events,api:n(ut,Ln)})):n(ut,In)?(st.info("EME detected on this user agent! (ProtectionModel_01b)"),Rn(rt).create({debug:at,eventBus:ot,errHandler:lt,events:it.events,api:n(ut,In)})):(st.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(st.info("EME detected on this user agent! (ProtectionModel_21Jan2015)"),bn(rt).create({debug:at,eventBus:ot,events:it.events}))}(it);return!at&&ot&&(at=wt(rt).create({protectionModel:ot,protectionKeyController:st,eventBus:it.eventBus,debug:it.debug,events:it.events,BASE64:it.BASE64,constants:it.constants,cmcdModel:it.cmcdModel,customParametersModel:it.customParametersModel,settings:it.settings}),it.capabilities.setEncryptedMediaSupported(!0)),at}}}Te.__dashjs_factory_name="Protection";var Dn=dashjs.FactoryMaker.getClassFactory(Te);Dn.events=gn,Dn.errors=ut,dashjs.FactoryMaker.updateClassFactory(Te.__dashjs_factory_name,Dn);var Mn=Dn},2068:function(nt,rt,it){var at=it(5448),st={DEFAULT:.5,STRONG:1,WEAK:0};function a(nt,rt,it){var at,ot;return at=void 0===nt?-1:nt,ot=function(nt){var rt=st.DEFAULT;return nt!==st.DEFAULT&&nt!==st.STRONG&&nt!==st.WEAK||(rt=nt),rt}(it),{quality:at,reason:void 0===rt?null:rt,priority:ot}}a.__dashjs_factory_name="SwitchRequest";var ot=at.Z.getClassFactory(a);ot.NO_CHANGE=-1,ot.PRIORITY=st,at.Z.updateClassFactory(a.__dashjs_factory_name,ot),rt.Z=ot},1767:function(nt,rt,it){var at=it(5628),st=it(6535),ot=it(7423),lt=it(895),ut=it(6070),ct=it(3112),dt=it(1914),ht=it(5435),pt=it(5448),_t=it(2068),Et=it(3393),St="qualitySwitchRules",wt="abandonFragmentRules";function m(nt){nt=nt||{};var rt,it,pt=this.context,Lt=nt.mediaPlayerModel,Ct=nt.customParametersModel,Pt=nt.dashMetrics,kt=nt.settings;function _(nt){return nt.filter((function(nt){return nt.quality>_t.Z.NO_CHANGE}))}function T(nt){var rt,it,at,st,ot,lt={},ut=null;if(0!==nt.length){for(lt[_t.Z.PRIORITY.STRONG]={quality:_t.Z.NO_CHANGE,reason:null},lt[_t.Z.PRIORITY.WEAK]={quality:_t.Z.NO_CHANGE,reason:null},lt[_t.Z.PRIORITY.DEFAULT]={quality:_t.Z.NO_CHANGE,reason:null},rt=0,it=nt.length;rt<it;rt+=1)(at=nt[rt]).quality!==_t.Z.NO_CHANGE&&(lt[at.priority].quality===_t.Z.NO_CHANGE||lt[at.priority].quality>at.quality)&&(lt[at.priority].quality=at.quality,lt[at.priority].reason=at.reason||null);return lt[_t.Z.PRIORITY.WEAK].quality!==_t.Z.NO_CHANGE&&(ut=lt[_t.Z.PRIORITY.WEAK]),lt[_t.Z.PRIORITY.DEFAULT].quality!==_t.Z.NO_CHANGE&&(ut=lt[_t.Z.PRIORITY.DEFAULT]),lt[_t.Z.PRIORITY.STRONG].quality!==_t.Z.NO_CHANGE&&(ut=lt[_t.Z.PRIORITY.STRONG]),ut&&(st=ut.quality,ot=ut.reason),(0,_t.Z)(pt).create(st,ot)}}return{initialize:function(){rt=[],it=[],kt.get().streaming.abr.useDefaultABRRules&&(kt.get().streaming.abr.ABRStrategy===Et.Z.ABR_STRATEGY_L2A?rt.push((0,dt.Z)(pt).create({dashMetrics:Pt,settings:kt})):kt.get().streaming.abr.ABRStrategy===Et.Z.ABR_STRATEGY_LoLP?rt.push((0,ht.Z)(pt).create({dashMetrics:Pt})):(rt.push((0,ct.Z)(pt).create({dashMetrics:Pt,mediaPlayerModel:Lt,settings:kt})),rt.push((0,at.Z)(pt).create({dashMetrics:Pt})),kt.get().streaming.abr.additionalAbrRules.insufficientBufferRule&&rt.push((0,st.Z)(pt).create({dashMetrics:Pt,settings:kt})),kt.get().streaming.abr.additionalAbrRules.switchHistoryRule&&rt.push((0,ut.Z)(pt).create()),kt.get().streaming.abr.additionalAbrRules.droppedFramesRule&&rt.push((0,lt.Z)(pt).create()),kt.get().streaming.abr.additionalAbrRules.abandonRequestsRule&&it.push((0,ot.Z)(pt).create({dashMetrics:Pt,mediaPlayerModel:Lt,settings:kt})))),Ct.getAbrCustomRules().forEach((function(nt){nt.type===St&&rt.push(nt.rule(pt).create()),nt.type===wt&&it.push(nt.rule(pt).create())}))},reset:function(){[rt,it].forEach((function(nt){nt&&nt.length&&nt.forEach((function(nt){return nt.reset&&nt.reset()}))})),rt=[],it=[]},getMaxQuality:function(nt){return T(_(rt.map((function(rt){return rt.getMaxIndex(nt)}))))||(0,_t.Z)(pt).create()},getMinSwitchRequest:T,shouldAbandonFragment:function(nt,rt){var at=T(_(it.map((function(it){return it.shouldAbandon(nt,rt)}))));return at&&(at.reason.forceAbandon=!0),at||(0,_t.Z)(pt).create()},getQualitySwitchRules:function(){return rt}}}m.__dashjs_factory_name="ABRRulesCollection";var Lt=pt.Z.getClassFactory(m);Lt.QUALITY_SWITCH_RULES=St,Lt.ABANDON_FRAGMENT_RULES=wt,pt.Z.updateSingletonFactory(m.__dashjs_factory_name,Lt),rt.Z=Lt},7423:function(nt,rt,it){var at=it(2068),st=it(5448),ot=it(6398);function o(nt){nt=nt||{};var rt,it,st,lt,ut,ct=this.context,dt=nt.mediaPlayerModel,ht=nt.dashMetrics,pt=nt.settings;function g(){st={},lt={},ut=[]}return rt={shouldAbandon:function(nt){var rt=(0,at.Z)(ct).create(at.Z.NO_CHANGE,{name:o.__dashjs_factory_name});if(!(nt&&nt.hasOwnProperty("getMediaInfo")&&nt.hasOwnProperty("getMediaType")&&nt.hasOwnProperty("getCurrentRequest")&&nt.hasOwnProperty("getRepresentationInfo")&&nt.hasOwnProperty("getAbrController")))return rt;var ot,_t,Et=nt.getMediaInfo(),St=nt.getMediaType(),wt=nt.getStreamInfo(),Lt=wt?wt.id:null,Ct=nt.getCurrentRequest();if(!isNaN(Ct.index)){ot=St,_t=Ct.index,st[ot]=st[ot]||{},st[ot][_t]=st[ot][_t]||{};var Pt=dt.getStableBufferTime();if(ht.getCurrentBufferLevel(St)>Pt)return rt;var kt=st[St][Ct.index];if(null===kt||null===Ct.firstByteDate||lt.hasOwnProperty(kt.id))return rt;if(void 0===kt.firstByteTime&&(ut[St]=[],kt.firstByteTime=Ct.firstByteDate.getTime(),kt.segmentDuration=Ct.duration,kt.bytesTotal=Ct.bytesTotal,kt.id=Ct.index),kt.bytesLoaded=Ct.bytesLoaded,kt.elapsedTime=(new Date).getTime()-kt.firstByteTime,kt.bytesLoaded>0&&kt.elapsedTime>0&&function(nt,rt){ut[nt]=ut[nt]||[],ut[nt].push(rt)}(St,Math.round(8*kt.bytesLoaded/kt.elapsedTime)),ut[St].length>=pt.get().streaming.abr.abrRulesParameters.abandonRequestsRule.minLengthToAverage&&kt.elapsedTime>pt.get().streaming.abr.abrRulesParameters.abandonRequestsRule.graceTimeThreshold&&kt.bytesLoaded<kt.bytesTotal){var Ot=ut[St].reduce((function(nt,rt){return nt+rt}),0);if(kt.measuredBandwidthInKbps=Math.round(Ot/ut[St].length),kt.estimatedTimeOfDownload=+(8*kt.bytesTotal/kt.measuredBandwidthInKbps/1e3).toFixed(2),kt.estimatedTimeOfDownload<kt.segmentDuration*pt.get().streaming.abr.abrRulesParameters.abandonRequestsRule.abandonMultiplier||0===nt.getRepresentationInfo().quality)return rt;if(!lt.hasOwnProperty(kt.id)){var Ft=nt.getAbrController(),Bt=kt.bytesTotal-kt.bytesLoaded,Ut=Ft.getBitrateList(Et),Gt=Ft.getQualityForBitrate(Et,kt.measuredBandwidthInKbps*pt.get().streaming.abr.bandwidthSafetyFactor,Lt),Ht=Ft.getMinAllowedIndexFor(St,Lt),jt=void 0!==Ht?Math.max(Ht,Gt):Gt;Bt>kt.bytesTotal*Ut[jt].bitrate/Ut[Ft.getQualityFor(St,Lt)].bitrate&&(rt.quality=jt,rt.reason.throughput=kt.measuredBandwidthInKbps,rt.reason.fragmentID=kt.id,rt.reason.rule=this.getClassName(),lt[kt.id]=kt,it.debug("["+St+"] frag id",kt.id," is asking to abandon and switch to quality to ",jt," measured bandwidth was",kt.measuredBandwidthInKbps),delete st[St][kt.id])}}else kt.bytesLoaded===kt.bytesTotal&&delete st[St][kt.id]}return rt},reset:g},it=(0,ot.Z)(ct).getInstance().getLogger(rt),g(),rt}o.__dashjs_factory_name="AbandonRequestsRule",rt.Z=st.Z.getClassFactory(o)},3112:function(nt,rt,it){var at=it(3860),st=it(2068),ot=it(5448),lt=it(7855),ut=it(5595),ct=it(8512),dt=it(6398),ht=it(8825),pt=it(3393),_t=10;function g(nt){nt=nt||{};var rt,it,ot,Et=this.context,St=nt.dashMetrics,wt=nt.mediaPlayerModel,Lt=(0,ut.Z)(Et).getInstance();function y(nt,rt,it){var at=it.reduce((function(nt,rt,at){return rt>it[nt]?at:nt}),0);if(0===at)return null;var st=Math.max(nt,_t+2*rt.length),ot=(it[at]-1)/(st/_t-1);return{gp:ot,Vp:_t/ot}}function E(nt){nt.placeholderBuffer=0,nt.mostAdvancedSegmentStart=NaN,nt.lastSegmentWasReplacement=!1,nt.lastSegmentStart=NaN,nt.lastSegmentDurationS=NaN,nt.lastSegmentRequestTimeMs=NaN,nt.lastSegmentFinishTimeMs=NaN}function v(nt,rt){var it=wt.getStableBufferTime();if(nt.stableBufferTime!==it){var at=y(it,nt.bitrates,nt.utilities);if(at.Vp!==nt.Vp||at.gp!==nt.gp){var st=St.getCurrentBufferLevel(rt),ot=st+nt.placeholderBuffer;ot-=_t,ot*=at.Vp/nt.Vp,ot+=_t,nt.stableBufferTime=it,nt.Vp=at.Vp,nt.gp=at.gp,nt.placeholderBuffer=Math.max(0,ot-st)}}}function _(nt,rt){return nt.Vp*(nt.utilities[rt]+nt.gp)}function T(nt,rt){for(var it=nt.bitrates[rt],at=nt.utilities[rt],st=0,ot=rt-1;ot>=0;--ot)if(nt.utilities[ot]<nt.utilities[rt]){var lt=nt.bitrates[ot],ut=nt.utilities[ot],ct=nt.Vp*(nt.gp+(it*ut-lt*at)/(it-lt));st=Math.max(st,ct)}return st}function S(nt){var rt=nt.mediaType===pt.Z.AUDIO?[pt.Z.AUDIO]:ot;for(var it in rt)ot.hasOwnProperty(it)&&2===ot[it].state&&(ot[it].placeholderBuffer=0)}function b(){for(var nt in ot)if(ot.hasOwnProperty(nt)){var rt=ot[nt];0!==rt.state&&(rt.state=1,E(rt))}}function A(nt){if(nt&&nt.chunk&&nt.chunk.mediaInfo){var rt=ot[nt.chunk.mediaInfo.type];if(rt&&0!==rt.state){var it=nt.chunk.start;isNaN(rt.mostAdvancedSegmentStart)||it>rt.mostAdvancedSegmentStart?(rt.mostAdvancedSegmentStart=it,rt.lastSegmentWasReplacement=!1):rt.lastSegmentWasReplacement=!0,rt.lastSegmentStart=it,rt.lastSegmentDurationS=nt.chunk.duration,rt.lastQuality=nt.chunk.quality,R(rt,nt.chunk.mediaInfo.type)}}}function I(nt){if(nt&&nt.metric===at.Z.HTTP_REQUEST&&nt.value&&nt.value.type===lt.w.MEDIA_SEGMENT_TYPE&&nt.value.trace&&nt.value.trace.length){var rt=ot[nt.mediaType];rt&&0!==rt.state&&(rt.lastSegmentRequestTimeMs=nt.value.trequest.getTime(),rt.lastSegmentFinishTimeMs=nt.value._tfinish.getTime(),R(rt,nt.mediaType))}}function R(nt,rt){if(!isNaN(nt.lastSegmentStart)&&!isNaN(nt.lastSegmentRequestTimeMs)&&!isNaN(nt.placeholderBuffer)){if(nt.placeholderBuffer*=.99,!isNaN(nt.lastSegmentFinishTimeMs)){var it=St.getCurrentBufferLevel(rt)+.001*(nt.lastSegmentFinishTimeMs-nt.lastSegmentRequestTimeMs),at=_(nt,nt.lastQuality),st=Math.max(0,at-it);nt.placeholderBuffer=Math.min(st,nt.placeholderBuffer)}nt.lastSegmentWasReplacement&&!isNaN(nt.lastSegmentDurationS)&&(nt.placeholderBuffer+=nt.lastSegmentDurationS),nt.lastSegmentStart=NaN,nt.lastSegmentRequestTimeMs=NaN}}function w(nt){if(nt){var rt=ot[nt.mediaType];rt&&0!==rt.state&&(rt.abrQuality=nt.newQuality)}}function N(nt){if(nt){var rt=ot[nt.mediaType];if(rt&&0!==rt.state){var it,at=St.getCurrentBufferLevel(nt.mediaType);it=rt.abrQuality>0?T(rt,rt.abrQuality):_t;var st=Math.max(0,it-at);rt.placeholderBuffer=Math.min(rt.placeholderBuffer,st)}}}function C(){ot={}}return rt={getMaxIndex:function(nt){var rt=(0,st.Z)(Et).create();if(!(nt&&nt.hasOwnProperty("getMediaInfo")&&nt.hasOwnProperty("getMediaType")&&nt.hasOwnProperty("getScheduleController")&&nt.hasOwnProperty("getStreamInfo")&&nt.hasOwnProperty("getAbrController")&&nt.hasOwnProperty("useBufferOccupancyABR")))return rt;var at=nt.getMediaInfo(),lt=nt.getMediaType(),ut=nt.getScheduleController(),ct=nt.getStreamInfo(),dt=nt.getAbrController(),ht=dt.getThroughputHistory(),pt=ct?ct.id:null,_t=ct&&ct.manifestInfo&&ct.manifestInfo.isDynamic,Lt=nt.useBufferOccupancyABR();if(rt.reason=rt.reason||{},!Lt)return rt;ut.setTimeToLoadDelay(0);var Ct=function(nt){var rt=nt.getMediaType(),it=ot[rt];return it?0!==it.state&&v(it,rt):(it=function(nt){var rt={},it=nt.getMediaInfo().bitrateList.map((function(nt){return nt.bandwidth})),at=function(nt){return nt.map((function(nt){return Math.log(nt)}))}(it);at=at.map((function(nt){return nt-at[0]+1}));var st=wt.getStableBufferTime(),ot=y(st,it,at);return ot?(rt.state=1,rt.bitrates=it,rt.utilities=at,rt.stableBufferTime=st,rt.Vp=ot.Vp,rt.gp=ot.gp,rt.lastQuality=0,E(rt)):rt.state=0,rt}(nt),ot[rt]=it),it}(nt);if(0===Ct.state)return rt;var Pt,kt=St.getCurrentBufferLevel(lt),Ot=ht.getAverageThroughput(lt,_t),Ft=ht.getSafeAverageThroughput(lt,_t),Bt=ht.getAverageLatency(lt);if(rt.reason.state=Ct.state,rt.reason.throughput=Ot,rt.reason.latency=Bt,isNaN(Ot))return rt;switch(Ct.state){case 1:Pt=dt.getQualityForBitrate(at,Ft,pt,Bt),rt.quality=Pt,rt.reason.throughput=Ft,Ct.placeholderBuffer=Math.max(0,T(Ct,Pt)-kt),Ct.lastQuality=Pt,!isNaN(Ct.lastSegmentDurationS)&&kt>=Ct.lastSegmentDurationS&&(Ct.state=2);break;case 2:!function(nt,rt){var it=Date.now();if(isNaN(nt.lastSegmentFinishTimeMs)){if(!isNaN(nt.lastCallTimeMs)){var at=.001*(it-nt.lastCallTimeMs);nt.placeholderBuffer+=Math.max(0,at)}}else{var st=.001*(it-nt.lastSegmentFinishTimeMs);nt.placeholderBuffer+=Math.max(0,st)}nt.lastCallTimeMs=it,nt.lastSegmentStart=NaN,nt.lastSegmentRequestTimeMs=NaN,nt.lastSegmentFinishTimeMs=NaN,v(nt,rt)}(Ct,lt),Pt=function(nt,rt){for(var it=nt.bitrates.length,at=NaN,st=NaN,ot=0;ot<it;++ot){var lt=(nt.Vp*(nt.utilities[ot]+nt.gp)-rt)/nt.bitrates[ot];(isNaN(st)||lt>=st)&&(st=lt,at=ot)}return at}(Ct,kt+Ct.placeholderBuffer);var Ut=dt.getQualityForBitrate(at,Ft,pt,Bt);Pt>Ct.lastQuality&&Pt>Ut&&(Pt=Math.max(Ut,Ct.lastQuality));var Gt=Math.max(0,kt+Ct.placeholderBuffer-_(Ct,Pt));Gt<=Ct.placeholderBuffer?(Ct.placeholderBuffer-=Gt,Gt=0):(Gt-=Ct.placeholderBuffer,Ct.placeholderBuffer=0,Pt<dt.getMaxAllowedIndexFor(lt,pt)?ut.setTimeToLoadDelay(1e3*Gt):Gt=0),rt.quality=Pt,rt.reason.throughput=Ot,rt.reason.latency=Bt,rt.reason.bufferLevel=kt,rt.reason.placeholderBuffer=Ct.placeholderBuffer,rt.reason.delay=Gt,Ct.lastQuality=Pt;break;default:it.debug("BOLA ABR rule invoked in bad state."),rt.quality=dt.getQualityForBitrate(at,Ft,pt,Bt),rt.reason.state=Ct.state,rt.reason.throughput=Ft,rt.reason.latency=Bt,Ct.state=1,E(Ct)}return rt},reset:function(){C(),Lt.off(ht.Z.BUFFER_EMPTY,S,rt),Lt.off(ht.Z.PLAYBACK_SEEKING,b,rt),Lt.off(ht.Z.METRIC_ADDED,I,rt),Lt.off(ht.Z.QUALITY_CHANGE_REQUESTED,w,rt),Lt.off(ht.Z.FRAGMENT_LOADING_ABANDONED,N,rt),Lt.off(ct.Z.MEDIA_FRAGMENT_LOADED,A,rt)}},it=(0,dt.Z)(Et).getInstance().getLogger(rt),C(),Lt.on(ht.Z.BUFFER_EMPTY,S,rt),Lt.on(ht.Z.PLAYBACK_SEEKING,b,rt),Lt.on(ht.Z.METRIC_ADDED,I,rt),Lt.on(ht.Z.QUALITY_CHANGE_REQUESTED,w,rt),Lt.on(ht.Z.FRAGMENT_LOADING_ABANDONED,N,rt),Lt.on(ct.Z.MEDIA_FRAGMENT_LOADED,A,rt),rt}g.__dashjs_factory_name="BolaRule",rt.Z=ot.Z.getClassFactory(g)},895:function(nt,rt,it){var at=it(5448),st=it(2068),ot=it(6398);function o(){var nt,rt,it=this.context;return nt={getMaxIndex:function(nt){var at=(0,st.Z)(it).create();if(!nt||!nt.hasOwnProperty("getDroppedFramesHistory"))return at;var ot=nt.getDroppedFramesHistory(),lt=nt.getStreamInfo().id;if(ot){var ut=ot.getFrameHistory(lt);if(!ut||0===ut.length)return at;for(var ct=0,dt=0,ht=st.Z.NO_CHANGE,pt=1;pt<ut.length;pt++)if(ut[pt]&&(ct=ut[pt].droppedVideoFrames,(dt=ut[pt].totalVideoFrames)>375&&ct/dt>.15)){ht=pt-1,rt.debug("index: "+ht+" Dropped Frames: "+ct+" Total Frames: "+dt);break}return(0,st.Z)(it).create(ht,{droppedFrames:ct})}return at}},rt=(0,ot.Z)(it).getInstance().getLogger(nt),nt}o.__dashjs_factory_name="DroppedFramesRule",rt.Z=at.Z.getClassFactory(o)},6535:function(nt,rt,it){var at=it(5595),st=it(8512),ot=it(5448),lt=it(6398),ut=it(2068),ct=it(3393),dt=it(3860),ht=it(8825);function f(nt){nt=nt||{};var rt,it,ot,pt=this.context,_t=(0,at.Z)(pt).getInstance(),Et=nt.dashMetrics;function h(){(ot={})[ct.Z.VIDEO]={ignoreCount:2},ot[ct.Z.AUDIO]={ignoreCount:2}}function p(){h()}function m(nt){isNaN(nt.startTime)||nt.mediaType!==ct.Z.AUDIO&&nt.mediaType!==ct.Z.VIDEO||ot[nt.mediaType].ignoreCount>0&&ot[nt.mediaType].ignoreCount--}return rt={getMaxIndex:function(nt){var rt=(0,ut.Z)(pt).create();if(!nt||!nt.hasOwnProperty("getMediaType"))return rt;!function(){if(!Et||!Et.hasOwnProperty("getCurrentBufferLevel")||!Et.hasOwnProperty("getCurrentBufferState"))throw new Error(ct.Z.MISSING_CONFIG_ERROR)}();var at=nt.getMediaType(),st=Et.getCurrentBufferState(at),lt=nt.getRepresentationInfo().fragmentDuration,ht=nt.getStreamInfo(),_t=ht?ht.id:null,St=nt.getScheduleController(),wt=ht&&ht.manifestInfo&&ht.manifestInfo.isDynamic;if(function(nt,rt){return!nt&&ot[rt].ignoreCount>0}(St.getPlaybackController().getLowLatencyModeEnabled(),at)||!lt)return rt;if(st&&st.state===dt.Z.BUFFER_EMPTY)it.debug("["+at+"] Switch to index 0; buffer is empty."),rt.quality=0,rt.reason="InsufficientBufferRule: Buffer is empty";else{var Lt=nt.getMediaInfo(),Ct=nt.getAbrController(),Pt=Ct.getThroughputHistory(),kt=Et.getCurrentBufferLevel(at),Ot=Pt.getAverageThroughput(at,wt),Ft=Pt.getAverageLatency(at),Bt=Ot*(kt/lt)*.5;rt.quality=Ct.getQualityForBitrate(Lt,Bt,_t,Ft),rt.reason="InsufficientBufferRule: being conservative to avoid immediate rebuffering"}return rt},reset:function(){h(),_t.off(ht.Z.PLAYBACK_SEEKING,p,rt),_t.off(st.Z.BYTES_APPENDED_END_FRAGMENT,m,rt)}},it=(0,lt.Z)(pt).getInstance().getLogger(rt),h(),_t.on(ht.Z.PLAYBACK_SEEKING,p,rt),_t.on(st.Z.BYTES_APPENDED_END_FRAGMENT,m,rt),rt}f.__dashjs_factory_name="InsufficientBufferRule",rt.Z=ot.Z.getClassFactory(f)},1914:function(nt,rt,it){var at=it(3860),st=it(2068),ot=it(5448),lt=it(7855),ut=it(5595),ct=it(8512),dt=it(6398),ht=it(3393);function f(nt){nt=nt||{};var rt,it,ot,pt,_t=this.context,Et=nt.dashMetrics,St=(0,ut.Z)(_t).getInstance();function p(nt){nt.placeholderBuffer=0,nt.mostAdvancedSegmentStart=NaN,nt.lastSegmentWasReplacement=!1,nt.lastSegmentStart=NaN,nt.lastSegmentDurationS=NaN,nt.lastSegmentRequestTimeMs=NaN,nt.lastSegmentFinishTimeMs=NaN,nt.lastSegmentUrl=""}function m(){for(var nt in it)if(it.hasOwnProperty(nt)){var rt=it[nt];0!==rt.state&&(rt.state=1,p(rt))}}function y(nt){if(nt&&nt.chunk&&nt.chunk.mediaInfo){var rt=it[nt.chunk.mediaInfo.type],at=ot[nt.chunk.mediaInfo.type];if(rt&&0!==rt.state){var st=nt.chunk.start;isNaN(rt.mostAdvancedSegmentStart)||st>rt.mostAdvancedSegmentStart?(rt.mostAdvancedSegmentStart=st,rt.lastSegmentWasReplacement=!1):rt.lastSegmentWasReplacement=!0,rt.lastSegmentStart=st,rt.lastSegmentDurationS=nt.chunk.duration,rt.lastQuality=nt.chunk.quality,v(rt,at)}}}function E(nt){if(nt&&nt.metric===at.Z.HTTP_REQUEST&&nt.value&&nt.value.type===lt.w.MEDIA_SEGMENT_TYPE&&nt.value.trace&&nt.value.trace.length){var rt=it[nt.mediaType],st=ot[nt.mediaType];rt&&0!==rt.state&&(rt.lastSegmentRequestTimeMs=nt.value.trequest.getTime(),rt.lastSegmentFinishTimeMs=nt.value._tfinish.getTime(),v(rt,st))}}function v(nt,rt){isNaN(nt.lastSegmentStart)||isNaN(nt.lastSegmentRequestTimeMs)||(rt.segment_request_start_s=.001*nt.lastSegmentRequestTimeMs,rt.segment_download_finish_s=.001*nt.lastSegmentFinishTimeMs,nt.lastSegmentStart=NaN,nt.lastSegmentRequestTimeMs=NaN)}function _(nt){if(nt&&nt.mediaType){var rt=it[nt.mediaType];rt&&0!==rt.state&&(rt.abrQuality=nt.newQuality)}}function T(nt,rt){if(nt.length!==rt.length)return-1;for(var it=0,at=0;at<nt.length;at++)it+=nt[at]*rt[at];return it}function S(){it={},ot={}}return rt={getMaxIndex:function(nt){var rt,at=(0,st.Z)(_t).create(),ut=Math.pow(4,.99),ct=Math.max(Math.pow(4,1),ut*Math.sqrt(4)),dt=nt.getMediaInfo(),St=nt.getMediaType(),wt=dt.bitrateList.map((function(nt){return nt.bandwidth})),Lt=wt.length,Ct=nt.getScheduleController(),Pt=nt.getStreamInfo(),kt=nt.getAbrController(),Ot=kt.getThroughputHistory(),Ft=Pt&&Pt.manifestInfo&&Pt.manifestInfo.isDynamic,Bt=nt.useL2AABR(),Ut=Et.getCurrentBufferLevel(St,!0),Gt=Ot.getSafeAverageThroughput(St,Ft),Ht=Ot.getAverageThroughput(St,Ft),jt=Ot.getAverageLatency(St),Kt=nt.getVideoModel().getPlaybackRate();if(!(nt&&nt.hasOwnProperty("getMediaInfo")&&nt.hasOwnProperty("getMediaType")&&nt.hasOwnProperty("getScheduleController")&&nt.hasOwnProperty("getStreamInfo")&&nt.hasOwnProperty("getAbrController")&&nt.hasOwnProperty("useL2AABR")))return at;if(at.reason=at.reason||{},!Bt||St===ht.Z.AUDIO)return at;Ct.setTimeToLoadDelay(0);var $t=function(nt){var rt=nt.getMediaType(),at=it[rt];return at||(at=function(nt){var rt={},it=nt.getMediaInfo(),at=it.bitrateList.map((function(nt){return nt.bandwidth/1e3}));return rt.state=1,rt.bitrates=at,rt.lastQuality=0,function(nt){nt&&nt.type&&(ot[nt.type]={},ot[nt.type].w=[],ot[nt.type].prev_w=[],ot[nt.type].Q=0,ot[nt.type].segment_request_start_s=0,ot[nt.type].segment_download_finish_s=0,ot[nt.type].B_target=1.5)}(it),p(rt),rt}(nt),it[rt]=at),at}(nt);if(0===$t.state)return at;var Yt=ot[St];if(!Yt)return at;if(at.reason.state=$t.state,at.reason.throughput=Ht,at.reason.latency=jt,isNaN(Ht))return at;switch($t.state){case 1:if(rt=kt.getQualityForBitrate(dt,Gt,Pt.id,jt),at.quality=rt,at.reason.throughput=Gt,$t.lastQuality=rt,!isNaN($t.lastSegmentDurationS)&&Ut>=Yt.B_target){$t.state=2,Yt.Q=ut;for(var Wt=0;Wt<Lt;++Wt)Wt===$t.lastQuality?Yt.prev_w[Wt]=1:Yt.prev_w[Wt]=0}break;case 2:var Qt=[],en=Et.getCurrentHttpRequest(St).trace.reduce((function(nt,rt){return nt+rt.d}),0),nn=Et.getCurrentHttpRequest(St).trace.reduce((function(nt,rt){return nt+rt.b[0]}),0),an=Math.round(8*nn/en),ln=Et.getCurrentHttpRequest(St);if(an<1&&(an=1),ln.url===$t.lastSegmentUrl||ln.type===lt.w.INIT_SEGMENT_TYPE)rt=$t.lastQuality;else{for(var hn=$t.lastSegmentDurationS,fn=1,pn=0;pn<Lt;++pn)wt[pn]=wt[pn]/1e3,Kt*wt[pn]>an&&(fn=-1),Yt.w[pn]=Yt.prev_w[pn]+fn*(hn/(2*ct))*((Yt.Q+ut)*(Kt*wt[pn]/an));Yt.w=function(nt){for(var rt=nt.length,it=!1,at=[],st=0;st<rt;++st)at[st]=nt[st];for(var ot=nt.sort((function(nt,rt){return rt-nt})),lt=0,ut=0,ct=[],dt=0;dt<rt-1;++dt)if((ut=((lt+=ot[dt])-1)/(dt+1))>=ot[dt+1]){it=!0;break}it||(ut=(lt+ot[rt-1]-1)/rt);for(var ht=0;ht<rt;++ht)ct[ht]=Math.max(at[ht]-ut,0);return ct}(Yt.w);for(var mn=0;mn<Lt;++mn)Qt[mn]=Yt.w[mn]-Yt.prev_w[mn],Yt.prev_w[mn]=Yt.w[mn];Yt.Q=Math.max(0,Yt.Q-hn+hn*Kt*((T(wt,Yt.prev_w)+T(wt,Qt))/an));for(var gn=[],_n=0;_n<Lt;++_n)gn[_n]=Math.abs(wt[_n]-T(Yt.w,wt));(rt=gn.indexOf(Math.min.apply(Math,gn)))>$t.lastQuality&&wt[$t.lastQuality+1]<=an&&(rt=$t.lastQuality+1),wt[rt]>=an&&(Yt.Q=2*Math.max(ut,Yt.Q)),$t.lastSegmentUrl=ln.url}at.quality=rt,at.reason.throughput=Ht,at.reason.latency=jt,at.reason.bufferLevel=Ut,$t.lastQuality=at.quality;break;default:pt.debug("L2A ABR rule invoked in bad state."),at.quality=kt.getQualityForBitrate(dt,Gt,Pt.id,jt),at.reason.state=$t.state,at.reason.throughput=Gt,at.reason.latency=jt,$t.state=1,p($t)}return at},reset:function(){S(),St.off(ct.Z.PLAYBACK_SEEKING,m,rt),St.off(ct.Z.MEDIA_FRAGMENT_LOADED,y,rt),St.off(ct.Z.METRIC_ADDED,E,rt),St.off(ct.Z.QUALITY_CHANGE_REQUESTED,_,rt)}},pt=(0,dt.Z)(_t).getInstance().getLogger(rt),S(),St.on(ct.Z.PLAYBACK_SEEKING,m,rt),St.on(ct.Z.MEDIA_FRAGMENT_LOADED,y,rt),St.on(ct.Z.METRIC_ADDED,E,rt),St.on(ct.Z.QUALITY_CHANGE_REQUESTED,_,rt),rt}f.__dashjs_factory_name="L2ARule",rt.Z=ot.Z.getClassFactory(f)},6070:function(nt,rt,it){var at=it(5448),st=it(6398),ot=it(2068);function o(){var nt,rt,it=this.context;return nt={getMaxIndex:function(nt){for(var at=nt?nt.getSwitchHistory():null,st=at?at.getSwitchRequests():[],lt=0,ut=0,ct=0,dt=(0,ot.Z)(it).create(),ht=0;ht<st.length;ht++)if(void 0!==st[ht]&&(lt+=st[ht].drops,ut+=st[ht].noDrops,ct+=st[ht].dropSize,lt+ut>=6&&lt/ut>.075)){dt.quality=ht>0&&st[ht].drops>0?ht-1:ht,dt.reason={index:dt.quality,drops:lt,noDrops:ut,dropSize:ct},rt.debug("Switch history rule index: "+dt.quality+" samples: "+(lt+ut)+" drops: "+lt);break}return dt}},rt=(0,st.Z)(it).getInstance().getLogger(nt),nt}o.__dashjs_factory_name="SwitchHistoryRule",rt.Z=at.Z.getClassFactory(o)},5628:function(nt,rt,it){var at=it(5448),st=it(2068),ot=it(3393),lt=it(3860);function s(nt){nt=nt||{};var rt=this.context,it=nt.dashMetrics;return{getMaxIndex:function(nt){var at=(0,st.Z)(rt).create();if(!(nt&&nt.hasOwnProperty("getMediaInfo")&&nt.hasOwnProperty("getMediaType")&&nt.hasOwnProperty("useBufferOccupancyABR")&&nt.hasOwnProperty("getAbrController")&&nt.hasOwnProperty("getScheduleController")))return at;!function(){if(!it||!it.hasOwnProperty("getCurrentBufferState"))throw new Error(ot.Z.MISSING_CONFIG_ERROR)}();var ut=nt.getMediaInfo(),ct=nt.getMediaType(),dt=it.getCurrentBufferState(ct),ht=nt.getScheduleController(),pt=nt.getAbrController(),_t=nt.getStreamInfo(),Et=_t?_t.id:null,St=_t&&_t.manifestInfo?_t.manifestInfo.isDynamic:null,wt=pt.getThroughputHistory(),Lt=wt.getSafeAverageThroughput(ct,St),Ct=wt.getAverageLatency(ct),Pt=nt.useBufferOccupancyABR();return isNaN(Lt)||!dt||Pt||pt.getAbandonmentStateFor(Et,ct)!==lt.Z.ABANDON_LOAD&&(dt.state===lt.Z.BUFFER_LOADED||St)&&(at.quality=pt.getQualityForBitrate(ut,Lt,Et,Ct),ht.setTimeToLoadDelay(0),at.reason={throughput:Lt,latency:Ct}),at},reset:function(){}}}s.__dashjs_factory_name="ThroughputRule",rt.Z=at.Z.getClassFactory(s)},4722:function(nt,rt,it){var at=it(5448),st=it(6398);function a(){var nt,rt,it,at,ot,lt,ut,ct,dt,ht=this.context;function f(){it=null,at=1,ot=100,lt=0,ut=null,ct=null,dt="dynamic_weight_selection"}function d(){var nt=0;if(it)for(var rt=0;rt<it.length;rt++){var at=it[rt];at.state.throughput>nt&&(nt=at.state.throughput)}return nt}function g(nt,rt,it){var at=nt.map((function(nt,at){return it[at]*Math.pow(nt-rt[at],2)})).reduce((function(nt,rt){return nt+rt}));return(at<0?-1:1)*Math.sqrt(Math.abs(at))}function h(nt,rt){return g([nt.state.throughput,nt.state.latency,nt.state.rebuffer,nt.state.switch],[rt.state.throughput,rt.state.latency,rt.state.rebuffer,rt.state.switch],[1,1,1,1])}function p(nt,rt,it){for(var at=0;at<rt.length;at++){var st=rt[at],ot=h(st,nt);m(st,it,Math.exp(-1*Math.pow(ot,2)/(2*Math.pow(.1,2))))}}function m(nt,rt,it){var at=nt.state,st=[.01,.01,.01,.01];at.throughput=at.throughput+(rt[0]-at.throughput)*st[0]*it,at.latency=at.latency+(rt[1]-at.latency)*st[1]*it,at.rebuffer=at.rebuffer+(rt[2]-at.rebuffer)*st[2]*it,at.switch=at.switch+(rt[3]-at.switch)*st[3]*it}return nt={getNextQuality:function(nt,st,ht,pt,_t,Et,St){var wt=ht,Lt=pt,Ct=st,Pt=function(nt){if(!it){it=[];var rt=nt.bitrateList,st=[];lt=rt[0].bandwidth,rt.forEach((function(nt){st.push(nt.bandwidth),nt.bandwidth<lt&&(lt=nt.bandwidth)})),dt=st.map((function(nt){return Math.pow(nt,2)})).reduce((function(nt,rt){return nt+rt})),at=Math.sqrt(dt);for(var ot=0;ot<rt.length;ot++){var ut={qualityIndex:ot,bitrate:rt[ot].bandwidth,state:{throughput:rt[ot].bandwidth/at,latency:0,rebuffer:0,switch:0}};it.push(ut)}ct=function(nt){var rt=[],it=function(nt){for(var rt=[],it=0;it<nt;it++){var at=[Math.random()*d(),Math.random(),Math.random(),Math.random()];rt.push(at)}return rt}(Math.pow(nt.length,2));rt.push(it[0]);for(var at=[1,1,1,1],st=1;st<nt.length;st++){for(var ot=null,lt=null,ut=0;ut<it.length;ut++){for(var ct=it[ut],dt=null,ht=0;ht<rt.length;ht++){var pt=g(ct,rt[ht],at);(null===dt||pt<dt)&&(dt=pt)}(null===lt||dt>lt)&&(ot=ct,lt=dt)}rt.push(ot)}for(var _t=null,Et=null,St=0;St<rt.length;St++){for(var wt=0,Lt=0;Lt<rt.length;Lt++)St!==Lt&&(wt+=g(rt[St],rt[Lt],at));(null===_t||wt>_t)&&(_t=wt,Et=St)}var Ct=[];for(Ct.push(rt[Et]),rt.splice(Et,1);rt.length>0;){for(var Pt=null,kt=null,Ot=0;Ot<rt.length;Ot++){var Ft=g(Ct[0],rt[Ot],at);(null===Pt||Ft<Pt)&&(Pt=Ft,kt=Ot)}Ct.push(rt[kt]),rt.splice(kt,1)}return Ct}(it)}var dt;return it}(nt),kt=st/at;kt>1&&(kt=d()),ht/=ot,rt.debug("getNextQuality called throughput:".concat(kt," latency:").concat(ht," bufferSize:").concat(pt," currentQualityIndex:").concat(Et," playbackRate:").concat(_t));var Ot=Pt[Et],Ft=Ot.bitrate*St.getSegmentDuration()/Ct,Bt=Math.max(0,Ft-Lt);if(Lt-Ft<St.getMinBuffer())return rt.debug("Buffer is low for bitrate= ".concat(Ot.bitrate," downloadTime=").concat(Ft," currentBuffer=").concat(Lt," rebuffer=").concat(Bt)),function(nt,rt){var at=0,st=nt;if(it)for(var ot=0;ot<it.length;ot++){var lt=it[ot];lt.bitrate<nt.bitrate&&lt.bitrate>at&&rt>lt.bitrate&&(at=lt.bitrate,st=lt)}return st}(Ot,Ct).qualityIndex;switch(dt){case"manual_weight_selection":ut=[.4,.4,.4,.4];break;case"random_weight_selection":!function(nt){ut=function(nt){for(var rt=[],it=Math.sqrt(2/nt),at=0;at<4;at++)rt.push(Math.random()*it);return ut=rt}(nt.length)}(Pt);break;default:!function(nt,rt,it,at,st,ot,lt){ut||(ut=ct[ct.length-1]);var dt=nt.findWeightVector(rt,it,at,st,ot,lt);null!==dt&&-1!==dt&&(ut=dt)}(St,Pt,wt,Lt,Bt,Ct,_t)}for(var Ut=null,Gt=null,Ht=null,jt=0;jt<Pt.length;jt++){var Kt=Pt[jt],$t=Kt.state,Yt=[$t.throughput,$t.latency,$t.rebuffer,$t.switch],Wt=ut.slice(),Qt=St.getNextBufferWithBitrate(Kt.bitrate,Lt,Ct),en=Qt<St.getMinBuffer();en&&rt.debug("Buffer is low for bitrate=".concat(Kt.bitrate," downloadTime=").concat(Ft," currentBuffer=").concat(Lt," nextBuffer=").concat(Qt)),(Kt.bitrate>st-1e4||en)&&Kt.bitrate!==lt&&(Wt[0]=100);var nn=g(Yt,[kt,0,0,0],Wt);(null===Ut||nn<Ut)&&(Ut=nn,Gt=Kt.qualityIndex,Ht=Kt)}var an=Math.abs(Ot.bitrate-Ht.bitrate)/at;return p(Ot,Pt,[kt,ht,Bt,an]),p(Ht,Pt,[kt,0,0,an]),Gt},reset:function(){f()}},rt=(0,st.Z)(ht).getInstance().getLogger(nt),f(),nt}a.__dashjs_factory_name="LearningAbrController",rt.Z=at.Z.getClassFactory(a)},5317:function(nt,rt,it){var at=it(5448),st=it(2298);function a(){var nt,rt,it,at,ot;function o(){rt=null,it=null,at=null,ot=null}function s(nt,rt,it,at){var ot=new st.Z;return ot.type=nt,ot.weights.bitrateReward=rt||1,ot.weights.bitrateSwitchPenalty=1,ot.weights.rebufferPenalty=it||1e3,ot.weights.latencyPenalty=[],ot.weights.latencyPenalty.push({threshold:1.1,penalty:.05*at}),ot.weights.latencyPenalty.push({threshold:1e8,penalty:.1*it}),ot.weights.playbackSpeedPenalty=at||200,ot}function u(nt,rt,it,at,st){st.bitrateWSum+=st.weights.bitrateReward*nt,st.lastBitrate&&(st.bitrateSwitchWSum+=st.weights.bitrateSwitchPenalty*Math.abs(nt-st.lastBitrate)),st.lastBitrate=nt,st.rebufferWSum+=st.weights.rebufferPenalty*rt;for(var ot=0;ot<st.weights.latencyPenalty.length;ot++){var lt=st.weights.latencyPenalty[ot];if(it<=lt.threshold){st.latencyWSum+=lt.penalty*it;break}}st.playbackSpeedWSum+=st.weights.playbackSpeedPenalty*Math.abs(1-at),st.totalQoe=st.bitrateWSum-st.bitrateSwitchWSum-st.rebufferWSum-st.latencyWSum-st.playbackSpeedWSum}return nt={setupPerSegmentQoe:function(nt,st,lt){rt=s("segment",nt,st,lt),it=nt,at=st,ot=lt},logSegmentMetrics:function(nt,it,at,st){rt&&u(nt,it,at,st,rt)},getPerSegmentQoe:function(){return rt},calculateSingleUseQoe:function(nt,rt,st,lt){var ut=null;return it&&at&&ot&&(ut=s("segment",it,at,ot)),ut?(u(nt,rt,st,lt,ut),ut.totalQoe):0},reset:function(){o()}},o(),nt}a.__dashjs_factory_name="LoLpQoeEvaluator",rt.Z=at.Z.getClassFactory(a)},5435:function(nt,rt,it){var at=it(6398),st=it(5448),ot=it(4722),lt=it(5317),ut=it(2068),ct=it(3860),dt=it(6523),ht=it(3393);function f(nt){var rt,it,st,pt,_t=(nt=nt||{}).dashMetrics,Et=this.context;return it={getMaxIndex:function(nt){try{var it=(0,ut.Z)(Et).create(),at=nt.getMediaInfo().type,ot=nt.getAbrController(),lt=nt.getStreamInfo(),St=ot.getQualityFor(at,lt.id),wt=nt.getMediaInfo(),Lt=_t.getCurrentBufferState(at),Ct=nt.getScheduleController(),Pt=_t.getCurrentBufferLevel(at,!0),kt=lt&&lt.manifestInfo?lt.manifestInfo.isDynamic:null,Ot=Ct.getPlaybackController(),Ft=Ot.getCurrentLiveLatency();if(!nt.useLoLPABR()||at===ht.Z.AUDIO)return it;Ft||(Ft=0);var Bt=Ot.getPlaybackRate(),Ut=ot.getThroughputHistory().getSafeAverageThroughput(at,kt);if(rt.debug("Throughput ".concat(Math.round(Ut)," kbps")),isNaN(Ut)||!Lt)return it;if(ot.getAbandonmentStateFor(lt.id,at)===ct.Z.ABANDON_LOAD)return it;for(var Gt=wt.bitrateList,Ht=nt.getRepresentationInfo().fragmentDuration,jt=Gt[0].bandwidth/1e3,Kt=Gt[Gt.length-1].bandwidth/1e3,$t=0;$t<Gt.length;$t++){var Yt=Gt[$t].bandwidth/1e3;Yt>Kt?Kt=Yt:Yt<jt&&(jt=Yt)}var Wt=Gt[St].bandwidth/1e3,Qt=_t.getCurrentHttpRequest(at,!0),en=(Qt.tresponse.getTime()-Qt.trequest.getTime())/1e3,nn=en>Ht?en-Ht:0;pt.setupPerSegmentQoe(Ht,Kt,jt),pt.logSegmentMetrics(Wt,nn,Ft,Bt);var an=(0,dt.Z)(Et).create({targetLatency:1.5,bufferMin:.3,segmentDuration:Ht,qoeEvaluator:pt});return it.quality=st.getNextQuality(wt,1e3*Ut,Ft,Pt,Bt,St,an),it.reason={throughput:Ut,latency:Ft},it.priority=ut.Z.PRIORITY.STRONG,Ct.setTimeToLoadDelay(0),it.quality!==St&&rt.debug("[TgcLearningRule]["+at+"] requesting switch to index: ",it.quality,"Average throughput",Math.round(Ut),"kbps"),it}catch(nt){throw nt}},reset:function(){st.reset(),pt.reset()}},rt=(0,at.Z)(Et).getInstance().getLogger(it),st=(0,ot.Z)(Et).create(),pt=(0,lt.Z)(Et).create(),it}f.__dashjs_factory_name="LoLPRule",rt.Z=st.Z.getClassFactory(f)},6523:function(nt,rt,it){var at=it(5448);function i(nt){var rt,it,at,st,ot=nt.targetLatency,lt=nt.bufferMin,ut=nt.segmentDuration,ct=nt.qoeEvaluator;function l(){return ut}function c(nt,rt){var it=l();return rt>it?nt-it:nt+it-rt}return rt={getMinBuffer:function(){return lt},getSegmentDuration:l,getNextBufferWithBitrate:function(nt,rt,it){return c(rt,nt*ut/it)},getNextBuffer:c,findWeightVector:function(nt,rt,st,dt,ht,pt){var _t=null,Et=null,St=null,wt=Math.abs(rt-at);return nt.forEach((function(nt){it.forEach((function(it){it[0];var at=it[1],dt=it[2],Lt=(it[3],nt.bitrate*ut/ht),Ct=c(st,Lt),Pt=(0===dt?10:1/dt)*Math.max(1e-5,Lt-Ct),kt=(0===at?10:1/at)*nt.state.latency,Ot=ct.calculateSingleUseQoe(nt.bitrate,Pt,kt,pt);(null===_t||Ot>_t)&&function(nt,rt,it){return!(nt>ot+it)&&rt>=lt}(rt,Ct,wt)&&(_t=Ot,Et=it,St=nt.bitrate)}))})),null===Et&&null===St&&(Et=-1),at=rt,Et}},it=function e(nt,rt,it){if(it===rt)return nt;for(var at=nt.length,ot=0;ot<at;ot++)for(var lt=nt.shift(),ut=0;ut<st.length;ut++)nt.push(lt.concat(st[ut]));return e(nt,rt,it+1)}((st=[.2,.4,.6,.8,1]).map((function(nt){return[nt]})),4,1),at=0,rt}i.__dashjs_factory_name="LoLpWeightSelector",rt.Z=at.Z.getClassFactory(i)},2298:function(nt,rt){rt.Z=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=null,this.lastBitrate=null,this.weights={},this.weights.bitrateReward=null,this.weights.bitrateSwitchPenalty=null,this.weights.rebufferPenalty=null,this.weights.latencyPenalty=null,this.weights.playbackSpeedPenalty=null,this.bitrateWSum=0,this.bitrateSwitchWSum=0,this.rebufferWSum=0,this.latencyWSum=0,this.playbackSpeedWSum=0,this.totalQoe=0}},7803:function(nt,rt,it){it.d(rt,{Y:function(){return Et}});var at=it(3393),st=it(1553),ot=it(5448),lt=it(2128),ut=it(2594),ct=it(7387),dt=it(7417),ht=it(9032),pt=it(9326),_t=it(7802),Et=["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"];function h(nt){var rt,it,ot,St,wt,Lt,Ct,Pt,kt=this.context,Ot=nt.adapter,Ft=nt.baseURLController,Bt=nt.streamInfo,Ut=nt.timelineConverter,Gt=nt.debug,Ht=nt.eventBus,jt=nt.events,Kt=nt.dashConstants,$t=(0,ut.Z)(kt).getInstance();function C(nt,rt){var at=new lt.Z;at.id=nt.id,at.bitrate=nt.bandwidth,at.width=nt.width,at.height=nt.height,at.tilesHor=1,at.tilesVert=1,nt.essentialProperties&&nt.essentialProperties.forEach((function(nt){if(Et.indexOf(nt.schemeIdUri)>=0&&nt.value){var rt=nt.value.split("x");2!==rt.length||isNaN(rt[0])||isNaN(rt[1])||(at.tilesHor=parseInt(rt[0],10),at.tilesVert=parseInt(rt[1],10))}})),rt?Lt.updateSegmentData(nt).then((function(rt){!function(nt,rt,it){var at=[],st=function(nt,rt){var it,at,st,ot,lt=[],ut=0;for(it=0,at=nt.segments.length;it<at;it++)st=nt.segments[it],(ot=(0,ct.TJ)(Ut,Ot.getIsDynamic(),rt,st.startTime,st.duration,st.timescale,st.media,st.mediaRange,ut))&&(lt.push(ot),ot=null,ut++);return lt}(it,rt);rt.segments=st,nt.segmentDuration=rt.segments[0].duration,nt.readThumbnail=function(nt,it){var st=null;at.some((function(rt){if(rt.start<=nt&&rt.end>nt)return st=rt.url,!0})),st?it(st):rt.segments.some((function(st){if(st.mediaStartTime<=nt&&st.mediaStartTime+st.duration>nt){var ot=Ft.resolve(rt.path);return Ct.load({method:"get",url:ot.url,request:{range:st.mediaRange,responseType:"arraybuffer"},onload:function(nt){var rt=Pt.getSamplesInfo(nt.target.response),ot=new Blob([nt.target.response.slice(rt.sampleList[0].offset,rt.sampleList[0].offset+rt.sampleList[0].size)],{type:"image/jpeg"}),lt=window.URL.createObjectURL(ot);at.push({start:st.mediaStartTime,end:st.mediaStartTime+st.duration,url:lt}),it&&it(lt)}}),!0}}))}}(at,nt,rt)})):(at.startNumber=nt.startNumber,at.segmentDuration=nt.segmentDuration,at.timescale=nt.timescale,at.templateUrl=function(nt){var rt=$t.isRelative(nt.media)?$t.resolve(nt.media,Ft.resolve(nt.path).url):nt.media;return rt?(0,ct.Aj)(rt,nt.id):""}(nt)),at.tilesHor>0&&at.tilesVert>0&&(at.widthPerTile=at.width/at.tilesHor,at.heightPerTile=at.height/at.tilesVert,it.push(at))}function D(){it=[],St=-1,wt=null}return rt={getTracks:function(){return it},addTracks:function(){if(Bt&&Ot&&(wt=Ot.getMediaInfoForType(Bt,at.Z.IMAGE))){var nt=Ot.getVoRepresentations(wt);nt&&nt.length>0&&nt.forEach((function(nt){(nt.segmentInfoType===st.Z.SEGMENT_TEMPLATE&&nt.segmentDuration>0&&nt.media||nt.segmentInfoType===st.Z.SEGMENT_TIMELINE)&&C(nt),nt.segmentInfoType===st.Z.SEGMENT_BASE&&C(nt,!0)})),it.length>0&&it.sort((function(nt,rt){return nt.bitrate-rt.bitrate}))}},reset:D,setTrackByIndex:function(nt){it&&0!==it.length&&(nt>=it.length&&(nt=it.length-1),St=nt)},getCurrentTrack:function(){return St<0?null:it[St]},getCurrentTrackIndex:function(){return St},getThumbnailRequestForTime:function(nt){for(var rt,at=Ot.getVoRepresentations(wt),st=0;st<at.length;st++)if(it[St].id===at[st].id){rt=at[st];break}return ot.getSegmentRequestForTime(wt,rt,nt)}},D(),Ct=(0,ht.Z)(kt).create({}),Pt=(0,dt.Z)(kt).getInstance(),Lt=(0,_t.Z)(kt).create({events:jt,eventBus:Ht,streamInfo:Bt,timelineConverter:Ut,dashConstants:Kt,dashMetrics:nt.dashMetrics,segmentBaseController:nt.segmentBaseController,type:at.Z.IMAGE}),(ot=(0,pt.Z)(kt).create({streamInfo:Bt,type:at.Z.IMAGE,timelineConverter:Ut,segmentsController:Lt,baseURLController:Ft,debug:Gt,eventBus:Ht,events:jt,dashConstants:Kt,urlUtils:$t})).initialize(!!Ot&&Ot.getIsDynamic()),rt}h.__dashjs_factory_name="ThumbnailTracks",rt.Z=ot.Z.getClassFactory(h)},7417:function(nt,rt,it){var at=it(6398),st=it(8260),ot=it(5448),lt=it(6934),ut=it(9597);function u(){var nt,rt,it=this.context;function a(nt){if(!nt)return null;void 0===nt.fileStart&&(nt.fileStart=0);var rt=lt.parseBuffer(nt),at=(0,st.Z)(it).create();return at.setData(rt),at}function u(nt,rt){return nt[rt+3]>>>0|nt[rt+2]<<8>>>0|nt[rt+1]<<16>>>0|nt[rt]<<24>>>0}function l(nt,rt){return String.fromCharCode(nt[rt++])+String.fromCharCode(nt[rt++])+String.fromCharCode(nt[rt++])+String.fromCharCode(nt[rt])}return rt={parse:a,findLastTopIsoBoxCompleted:function(nt,rt,it){if(void 0===it&&(it=0),!rt||it+8>=rt.byteLength)return new ut.Z(0,!1);for(var at,st=rt instanceof ArrayBuffer?new Uint8Array(rt):rt,ot=0;it<st.byteLength;){var lt=u(st,it),ct=l(st,it+4);if(0===lt)break;it+lt<=st.byteLength&&(nt.indexOf(ct)>=0?at=new ut.Z(it,!0,lt):ot=it+lt),it+=lt}return at||new ut.Z(ot,!1)},getMediaTimescaleFromMoov:function(nt){var rt=a(nt),it=rt?rt.getBox("mdhd"):void 0;return it?it.timescale:NaN},getSamplesInfo:function(nt){if(!nt||0===nt.byteLength)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};var rt,it,at,st,ot,lt,ut,ct,dt,ht,pt,_t,Et,St,wt,Lt,Ct=a(nt),Pt=Ct.getBoxes("moof"),kt=Ct.getBoxes("mfhd");wt=Ct.getBoxes("moof").length,St=kt[kt.length-1].sequence_number,it=0,ot=[];var Ot=-1,Ft=-1;for(ht=0;ht<Pt.length;ht++){var Bt=Pt[ht],Ut=Bt.getChildBoxes("traf");for(ct=0;ct<Ut.length;ct++){var Gt=Ut[ct],Ht=Gt.getChildBox("tfhd"),jt=Gt.getChildBox("tfdt");st=jt.baseMediaDecodeTime;var Kt=Gt.getChildBoxes("trun"),$t=Gt.getChildBoxes("subs");for(dt=0;dt<Kt.length;dt++){var Yt=Kt[dt];for(it=Yt.sample_count,Et=(Ht.base_data_offset||0)+(Yt.data_offset||0),ut=0;ut<it;ut++){rt=void 0!==(lt=Yt.samples[ut]).sample_duration?lt.sample_duration:Ht.default_sample_duration,at=void 0!==lt.sample_size?lt.sample_size:Ht.default_sample_size;var Wt={dts:st,cts:st+(void 0!==lt.sample_composition_time_offset?lt.sample_composition_time_offset:0),duration:rt,offset:Bt.offset+Et,size:at,subSizes:[at]};if($t)for(pt=0;pt<$t.length;pt++){var Qt=$t[pt];if(Ot<Qt.entry_count-1&&ut>Ft&&(Ot++,Ft+=Qt.entries[Ot].sample_delta),ut==Ft){Wt.subSizes=[];var en=Qt.entries[Ot];for(_t=0;_t<en.subsample_count;_t++)Wt.subSizes.push(en.subsamples[_t].subsample_size)}}ot.push(Wt),Et+=at,st+=rt}}Lt=st-jt.baseMediaDecodeTime}}return{sampleList:ot,lastSequenceNumber:St,totalDuration:Lt,numSequences:wt}},findInitRange:function(rt){var it=null,at=a(rt);if(!at)return it;var st=at.getBox("ftyp"),ot=at.getBox("moov");return nt.debug("Searching for initialization."),ot&&ot.isComplete&&(it=(st?st.offset:ot.offset)+"-"+(ot.offset+ot.size-1),nt.debug("Found the initialization.  Range: "+it)),it},parsePayload:function(nt,rt,it){if(void 0===it&&(it=0),!rt||it+8>=rt.byteLength)return new ut.Z(0,!1);for(var at,st=rt instanceof ArrayBuffer?new Uint8Array(rt):rt,ot=0;it<st.byteLength;){var lt=u(st,it),ct=l(st,it+4);if(0===lt)break;it+lt<=st.byteLength&&(nt.indexOf(ct)>=0?at=new ut.Z(it,!0,lt,ct):ot=it+lt),it+=lt}return at||new ut.Z(ot,!1)}},nt=(0,at.Z)(it).getInstance().getLogger(rt),rt}u.__dashjs_factory_name="BoxParser",rt.Z=ot.Z.getSingletonFactory(u)},1715:function(nt,rt,it){it.d(rt,{B:function(){return s}});var at=it(5448),st=it(7803),ot=it(3393),lt=[{codec:"avc1",compatibleCodecs:["avc3"]},{codec:"avc3",compatibleCodecs:["avc1"]}];function s(){var nt="ManagedMediaSource"in window,rt="WebKitMediaSource"in window,it="MediaSource"in window;return nt||rt||it}function u(){var nt,rt,it;return nt={setConfig:function(nt){nt&&nt.settings&&(rt=nt.settings)},supportsMediaSource:s,supportsEncryptedMedia:function(){return it},supportsCodec:function(nt,it){return it!==ot.Z.AUDIO&&it!==ot.Z.VIDEO?Promise.resolve(!0):function(nt,it){return rt.get().streaming.capabilities.useMediaCapabilitiesApi&&navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo&&(nt.codec&&it===ot.Z.AUDIO||it===ot.Z.VIDEO&&nt.codec&&nt.width&&nt.height&&nt.bitrate&&nt.framerate)}(nt,it)?function(nt,rt){return new Promise((function(it){if(nt&&nt.codec){var at={type:"media-source"};at[rt]={},at[rt].contentType=nt.codec,at[rt].width=nt.width,at[rt].height=nt.height,at[rt].bitrate=parseInt(nt.bitrate),at[rt].framerate=parseFloat(nt.framerate),navigator.mediaCapabilities.decodingInfo(at).then((function(nt){it(nt.supported)})).catch((function(){it(!1)}))}else it(!1)}))}(nt,it):function(nt){return new Promise((function(rt){if(nt&&nt.codec){var it=nt.codec;nt.width&&nt.height&&(it+=';width="'+nt.width+'";height="'+nt.height+'"'),"ManagedMediaSource"in window&&ManagedMediaSource.isTypeSupported(it)||"MediaSource"in window&&MediaSource.isTypeSupported(it)||"WebKitMediaSource"in window&&WebKitMediaSource.isTypeSupported(it)?rt(!0):rt(!1)}else rt(!1)}))}(nt)},setEncryptedMediaSupported:function(nt){it=nt},supportsEssentialProperty:function(nt){try{return-1!==st.Y.indexOf(nt.schemeIdUri)||ot.Z.FONT_DOWNLOAD_DVB_SCHEME===nt.schemeIdUri}catch(nt){return!0}},codecRootCompatibleWithCodec:function(nt,rt){for(var it,at=nt.split(".")[0],st=0===rt.indexOf(at),ot=0;ot<lt.length;ot++)if(lt[ot].codec===at){it=lt[ot];break}return it?st||it.compatibleCodecs.some((function(nt){return 0===rt.indexOf(nt)})):st}},it=!1,nt}u.__dashjs_factory_name="Capabilities",rt.Z=at.Z.getSingletonFactory(u)},2295:function(nt,rt,it){var at=it(5448),st=it(3106);function a(){return{customTimeRangeArray:[],length:0,add:function(nt,rt){var it;for(it=0;it<this.customTimeRangeArray.length&&nt>this.customTimeRangeArray[it].start;it++);for(this.customTimeRangeArray.splice(it,0,{start:nt,end:rt}),it=0;it<this.customTimeRangeArray.length-1;it++)this.mergeRanges(it,it+1)&&it--;this.length=this.customTimeRangeArray.length},clear:function(){this.customTimeRangeArray=[],this.length=0},remove:function(nt,rt){for(var it=0;it<this.customTimeRangeArray.length;it++)if(nt<=this.customTimeRangeArray[it].start&&rt>=this.customTimeRangeArray[it].end)this.customTimeRangeArray.splice(it,1),it--;else{if(nt>this.customTimeRangeArray[it].start&&rt<this.customTimeRangeArray[it].end){this.customTimeRangeArray.splice(it+1,0,{start:rt,end:this.customTimeRangeArray[it].end}),this.customTimeRangeArray[it].end=nt;break}nt>this.customTimeRangeArray[it].start&&nt<this.customTimeRangeArray[it].end?this.customTimeRangeArray[it].end=nt:rt>this.customTimeRangeArray[it].start&&rt<this.customTimeRangeArray[it].end&&(this.customTimeRangeArray[it].start=rt)}this.length=this.customTimeRangeArray.length},mergeRanges:function(nt,rt){var it=this.customTimeRangeArray[nt],at=this.customTimeRangeArray[rt];return it.start<=at.start&&at.start<=it.end&&it.end<=at.end?(it.end=at.end,this.customTimeRangeArray.splice(rt,1),!0):at.start<=it.start&&it.start<=at.end&&at.end<=it.end?(it.start=at.start,this.customTimeRangeArray.splice(rt,1),!0):at.start<=it.start&&it.start<=at.end&&it.end<=at.end?(this.customTimeRangeArray.splice(nt,1),!0):it.start<=at.start&&at.start<=it.end&&at.end<=it.end&&(this.customTimeRangeArray.splice(rt,1),!0)},start:function(nt){return(0,st.SE)(nt),nt>=this.customTimeRangeArray.length||nt<0?NaN:this.customTimeRangeArray[nt].start},end:function(nt){return(0,st.SE)(nt),nt>=this.customTimeRangeArray.length||nt<0?NaN:this.customTimeRangeArray[nt].end}}}a.__dashjs_factory_name="CustomTimeRanges",rt.Z=at.Z.getClassFactory(a)},5:function(nt,rt,it){var at=it(5448);function i(){var nt,rt=/^[a-z][a-z0-9+\-_.]*:/i,it=/^https?:\/\//i,at=/^https:\/\//i,st=/^([a-z][a-z0-9+\-_.]*:\/\/[^\/]+)\/?/i,a=function(nt,rt){try{return new window.URL(nt,rt).toString()}catch(rt){return nt}},o=function(nt,rt){var it=s;if(!rt)return nt;if(!c(nt))return nt;f(nt)&&(it=u),d(nt)&&(it=l);var at=it(rt),st="/"!==at.charAt(at.length-1)&&"/"!==nt.charAt(0)?"/":"";return[at,nt].join(st)};function s(nt){var rt=nt.indexOf("/"),it=nt.lastIndexOf("/");return-1!==rt?it===rt+1?nt:(-1!==nt.indexOf("?")&&(nt=nt.substring(0,nt.indexOf("?"))),nt.substring(0,it+1)):""}function u(nt){var rt=nt.match(st);return rt?rt[1]:""}function l(nt){var it=nt.match(rt);return it?it[0]:""}function c(nt){return!rt.test(nt)}function f(nt){return c(nt)&&"/"===nt.charAt(0)}function d(nt){return 0===nt.indexOf("//")}return function(){try{new window.URL("x","http://y"),nt=a}catch(nt){}finally{nt=nt||o}}(),{parseBaseUrl:s,parseOrigin:u,parseScheme:l,isRelative:c,isPathAbsolute:f,isSchemeRelative:d,isHTTPURL:function(nt){return it.test(nt)},isHTTPS:function(nt){return at.test(nt)},removeHostname:function(nt){return/^(?:\w+\:\/\/)?([^\/]+)(.*)$/.exec(nt)[2].substring(1)},resolve:function(rt,it){return nt(rt,it)}}}i.__dashjs_factory_name="DefaultURLUtils",rt.Z=at.Z.getSingletonFactory(i)},8260:function(nt,rt,it){var at=it(2839),st=it(5448);function a(){var nt;function t(rt){var it=[];if(!rt||!nt||"function"!=typeof nt.fetchAll)return it;for(var at,st=nt.fetchAll(rt),ot=0,lt=st.length;ot<lt;ot++)(at=n(st[ot]))&&it.push(at);return it}function n(nt){if(!nt)return null;var rt=new at.Z(nt);return nt.hasOwnProperty("_incomplete")&&(rt.isComplete=!nt._incomplete),rt}return{getBox:function(rt){return rt&&nt&&nt.boxes&&0!==nt.boxes.length&&"function"==typeof nt.fetch?n(nt.fetch(rt)):null},getBoxes:t,setData:function(rt){nt=rt},getLastBox:function(){if(!nt||!nt.boxes||!nt.boxes.length)return null;var rt=t(nt.boxes[nt.boxes.length-1].type);return rt.length>0?rt[rt.length-1]:null}}}a.__dashjs_factory_name="IsoFile",rt.Z=st.Z.getClassFactory(a)},7473:function(nt,rt,it){it.d(rt,{k:function(){return i}});var at=it(5448);function i(nt,rt){var it={url:nt.url,method:nt.method,headers:Object.assign({},nt.headers),credentials:nt.withCredentials?"include":void 0,range:nt.request.range};return Promise.resolve(rt.modifyRequest(it)).then((function(){return Object.assign(nt,it,{withCredentials:"include"===it.credentials})}))}function a(){return{modifyRequest:null,modifyRequestURL:function(nt){return nt},modifyRequestHeader:function(nt,rt){return rt.url,nt}}}a.__dashjs_factory_name="RequestModifier",rt.Z=at.Z.getSingletonFactory(a)},3106:function(nt,rt,it){it.d(rt,{PS:function(){return a},SE:function(){return o}});var at=it(3393);function i(nt){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(nt){return typeof nt}:function(nt){return nt&&"function"==typeof Symbol&&nt.constructor===Symbol&&nt!==Symbol.prototype?"symbol":typeof nt},i(nt)}function a(nt,rt){if(i(nt)!==rt)throw at.Z.BAD_ARGUMENT_ERROR}function o(nt){if(null===nt||isNaN(nt)||nt%1!=0)throw at.Z.BAD_ARGUMENT_ERROR+" : argument is not an integer"}},2594:function(nt,rt,it){var at=it(5448),st=it(5);function a(){var nt,rt=[],it=this.context;function r(it,at,st){var ot=function(it){var at;for(at=0;at<rt.length;at++)if(rt[at].regex.test(it))return rt[at].utils;return nt}(st||at);return ot&&"function"==typeof ot[it]?ot[it](at,st):nt[it](at,st)}return nt=(0,st.Z)(it).getInstance(),{registerUrlRegex:function(nt,it){rt.push({regex:nt,utils:it})},parseBaseUrl:function(nt){return r("parseBaseUrl",nt)},parseOrigin:function(nt){return r("parseOrigin",nt)},parseScheme:function(nt){return r("parseScheme",nt)},isRelative:function(nt){return r("isRelative",nt)},isPathAbsolute:function(nt){return r("isPathAbsolute",nt)},isSchemeRelative:function(nt){return r("isSchemeRelative",nt)},isHTTPURL:function(nt){return r("isHTTPURL",nt)},isHTTPS:function(nt){return r("isHTTPS",nt)},removeHostname:function(nt){return r("removeHostname",nt)},resolve:function(nt,rt){return r("resolve",nt,rt)}}}a.__dashjs_factory_name="URLUtils";var ot=at.Z.getSingletonFactory(a);rt.Z=ot},5459:function(nt,rt){rt.Z=function e(nt,rt,it){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=nt||null,this.message=rt||null,this.data=it||null}},3186:function(nt,rt,it){var at=it(7855);function i(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var st=function(){function e(nt){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=e.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaStartTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=nt||null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null}var nt;return(nt=[{key:"isInitializationRequest",value:function(){return this.type&&this.type===at.w.INIT_SEGMENT_TYPE}},{key:"setInfo",value:function(nt){this.type=nt&&nt.init?at.w.INIT_SEGMENT_TYPE:at.w.MEDIA_SEGMENT_TYPE,this.url=nt&&nt.url?nt.url:null,this.range=nt&&nt.range?nt.range.start+"-"+nt.range.end:null,this.mediaType=nt&&nt.mediaType?nt.mediaType:null}}])&&i(e.prototype,nt),e}();st.ACTION_DOWNLOAD="download",st.ACTION_COMPLETE="complete",rt.Z=st},2839:function(nt,rt){function n(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var it=function(){function e(nt){if(function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.offset=nt._offset,this.type=nt.type,this.size=nt.size,this.boxes=[],nt.boxes)for(var rt=0;rt<nt.boxes.length;rt++)this.boxes.push(new e(nt.boxes[rt]));switch(this.isComplete=!0,nt.type){case"sidx":if(this.timescale=nt.timescale,this.earliest_presentation_time=nt.earliest_presentation_time,this.first_offset=nt.first_offset,this.references=nt.references,nt.references){this.references=[];for(var it=0;it<nt.references.length;it++){var at={reference_type:nt.references[it].reference_type,referenced_size:nt.references[it].referenced_size,subsegment_duration:nt.references[it].subsegment_duration};this.references.push(at)}}break;case"emsg":this.id=nt.id,this.version=1===nt.version?1:0,this.value=nt.value,this.timescale=nt.timescale,this.scheme_id_uri=nt.scheme_id_uri,this.presentation_time_delta=1===nt.version?nt.presentation_time:nt.presentation_time_delta,this.event_duration=nt.event_duration,this.message_data=nt.message_data;break;case"mdhd":this.timescale=nt.timescale;break;case"mfhd":this.sequence_number=nt.sequence_number;break;case"subs":this.entry_count=nt.entry_count,this.entries=nt.entries;break;case"tfhd":this.base_data_offset=nt.base_data_offset,this.sample_description_index=nt.sample_description_index,this.default_sample_duration=nt.default_sample_duration,this.default_sample_size=nt.default_sample_size,this.default_sample_flags=nt.default_sample_flags,this.flags=nt.flags;break;case"tfdt":this.version=nt.version,this.baseMediaDecodeTime=nt.baseMediaDecodeTime,this.flags=nt.flags;break;case"trun":if(this.sample_count=nt.sample_count,this.first_sample_flags=nt.first_sample_flags,this.data_offset=nt.data_offset,this.flags=nt.flags,this.samples=nt.samples,nt.samples){this.samples=[];for(var st=0,ot=nt.samples.length;st<ot;st++){var lt={sample_size:nt.samples[st].sample_size,sample_duration:nt.samples[st].sample_duration,sample_composition_time_offset:nt.samples[st].sample_composition_time_offset};this.samples.push(lt)}}break;case"prft":this.version=nt.version,this.reference_track_ID=nt.reference_track_ID,this.ntp_timestamp_sec=nt.ntp_timestamp_sec,this.ntp_timestamp_frac=nt.ntp_timestamp_frac,this.media_time=nt.media_time,this.flags=nt.flags}}var nt;return(nt=[{key:"getChildBox",value:function(nt){for(var rt=0;rt<this.boxes.length;rt++)if(this.boxes[rt].type===nt)return this.boxes[rt]}},{key:"getChildBoxes",value:function(nt){for(var rt=[],it=0;it<this.boxes.length;it++)this.boxes[it].type===nt&&rt.push(this.boxes[it]);return rt}}])&&n(e.prototype,nt),e}();rt.Z=it},9597:function(nt,rt){rt.Z=function e(nt,rt,it){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.lastCompletedOffset=nt,this.found=rt,this.size=it}},2128:function(nt,rt){rt.Z=function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.bitrate=0,this.width=0,this.height=0,this.tilesHor=0,this.tilesVert=0,this.widthPerTile=0,this.heightPerTile=0,this.startNumber=0,this.segmentDuration=0,this.timescale=0,this.templateUrl="",this.id=""}},7855:function(nt,rt,it){function r(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}it.d(rt,{O:function(){return st},w:function(){return at}});var at=function e(){r(this,e),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this.cmsd=null,this._stream=null,this._tfinish=null,this._mediaduration=null,this._quality=null,this._responseHeaders=null,this._serviceLocation=null,this._fileLoaderType=null},st=function e(){r(this,e),this.s=null,this.d=null,this.b=[]};at.GET="GET",at.HEAD="HEAD",at.MPD_TYPE="MPD",at.XLINK_EXPANSION_TYPE="XLinkExpansion",at.INIT_SEGMENT_TYPE="InitializationSegment",at.INDEX_SEGMENT_TYPE="IndexSegment",at.MEDIA_SEGMENT_TYPE="MediaSegment",at.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",at.MSS_FRAGMENT_INFO_SEGMENT_TYPE="FragmentInfoSegment",at.DVB_REPORTING_TYPE="DVBReporting",at.LICENSE="license",at.CONTENT_STEERING_TYPE="ContentSteering",at.OTHER_TYPE="other"},3039:function(nt,rt){function n(nt,rt){return function(it,at){for(var st,ot,lt,ut=r(it,"tag"),ct=r(null==at?"*":at,"range"),dt=[],ht=-1;++ht<ct.length;)if(st=ct[ht].toLowerCase(),rt||"*"!==st){for(ot=-1,lt=[];++ot<ut.length;)if(nt(ut[ot].toLowerCase(),st)){if(!rt)return ut[ot];dt.push(ut[ot])}else lt.push(ut[ot]);ut=lt}return rt?dt:void 0}}function r(nt,rt){var it=nt&&"string"==typeof nt?[nt]:nt;if(!it||"object"!=typeof it||!("length"in it))throw new Error("Invalid "+rt+" `"+it+"`, expected non-empty string");return it}rt.basicFilter=n((function(nt,rt){return"*"===rt||nt===rt||nt.indexOf(rt+"-")>-1}),!0),rt.extendedFilter=n((function(nt,rt){var it=nt.split("-"),at=rt.split("-"),st=0,ot=0;if("*"!==at[ot]&&it[st]!==at[ot])return!1;for(st++,ot++;ot<at.length;)if("*"!==at[ot]){if(!it[st])return!1;if(it[st]!==at[ot]){if(1===it[st].length)return!1;st++}else st++,ot++}else ot++;return!0}),!0),rt.lookup=n((function(nt,rt){for(var it,at=rt;;){if("*"===at||nt===at)return!0;if((it=at.lastIndexOf("-"))<0)return!1;"-"===at.charAt(it-2)&&(it-=2),at=at.slice(0,it)}}))},3973:function(nt,rt,it){nt.exports=it(3854)},3854:function(nt,rt,it){var at=it(2415),st=it(3039),ot=it(7778),lt=it(5813),ut=it(3165),ct=it(9460);nt.exports=function(nt,rt){var it,ht=rt||{},_t=at.parse(String(nt||"").toLowerCase(),ht),Et=at.stringify(_t),St=-1;if(!Et)return Et;for(;++St<ot.length;)st.extendedFilter(Et,ot[St].from).length&&(d(_t,ot[St].from,ot[St].to),Et=at.stringify(_t));for(St=-1;++St<lt.length;)g(_t,lt[St].from.field,lt[St].from.value)&&h(_t,lt[St].to.field,lt[St].to.value);for(Et=at.stringify(Object.assign({},_t,pt)),St=-1;++St<ut.length;)Et===ut[St]&&(d(_t,ut[St],ut[St].split("-").slice(0,-1).join("-")),Et=at.stringify(Object.assign({},_t,pt)));if(_t.extensions.sort(p),ht.warning)for(it in ct)dt.call(ct[it],_t[it])&&ht.warning("Deprecated "+it+" `"+_t[it]+"`, expected one of `"+ct[it][_t[it]].join("`, `")+"`",null,7);return _t.script&&(_t.script=_t.script.charAt(0).toUpperCase()+_t.script.slice(1)),_t.region&&(_t.region=_t.region.toUpperCase()),at.stringify(_t)};var dt={}.hasOwnProperty,ht=new Intl.Collator,pt={variants:[],extensions:[],privateuse:[],irregular:null,regular:null};function d(nt,rt,it){var st,ot=at.parse(rt),lt=at.parse(it),ut=[];for(st in ot)ot[st]&&ot[st].length&&g(nt,st,ot[st])&&ut.push(st);for(st in lt)lt[st]&&lt[st].length&&(ut.indexOf(st)>-1||!nt[st]||!nt[st].length)&&h(nt,st,lt[st])}function g(nt,rt,it){var at,st,ot,lt,ut=!1;if(it){if(st=at=nt[rt],at&&"object"==typeof at)for(st=[],ot=-1;++ot<at.length;)lt=at[ot],it.indexOf(lt)<0?st.push(lt):ut=!0;else at===it&&(st=null,ut=!0);nt[rt]=st}return ut}function h(nt,rt,it){var at,st,ot,lt=nt[rt];if(lt&&"object"==typeof lt)for(at=[].concat(it),st=-1;++st<at.length;)ot=at[st],lt.indexOf(ot)<0&&lt.push(ot);else nt[rt]=it}function p(nt,rt){return ht.compare(nt.singleton,rt.singleton)}},2415:function(nt,rt,it){rt.parse=it(6903),rt.stringify=it(6713)},6903:function(nt,rt,it){var at=it(2219),st=it(3516),ot=it(395),lt=it(858),ut=it(8589);nt.exports=function e(nt,rt){var it,dt,ht,pt=rt||{},_t={language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null},Et=String(nt),St=Et.toLowerCase(),wt=0;if(null==nt)throw new Error("Expected string, got `"+nt+"`");if(ct.call(ut,St))return(null==pt.normalize||pt.normalize)&&ut[St]?e(ut[St]):(_t[-1===lt.indexOf(St)?"irregular":"regular"]=Et,_t);for(;st(St.charCodeAt(wt))&&wt<9;)wt++;if(wt>1&&wt<9){if(_t.language=Et.slice(0,wt),wt<4)for(dt=0;45===St.charCodeAt(wt)&&st(St.charCodeAt(wt+1))&&st(St.charCodeAt(wt+2))&&st(St.charCodeAt(wt+3))&&!st(St.charCodeAt(wt+4));){if(dt>2)return y(wt,3,"Too many extended language subtags, expected at most 3 subtags");_t.extendedLanguageSubtags.push(Et.slice(wt+1,wt+4)),wt+=4,dt++}for(45===St.charCodeAt(wt)&&st(St.charCodeAt(wt+1))&&st(St.charCodeAt(wt+2))&&st(St.charCodeAt(wt+3))&&st(St.charCodeAt(wt+4))&&!st(St.charCodeAt(wt+5))&&(_t.script=Et.slice(wt+1,wt+5),wt+=5),45===St.charCodeAt(wt)&&(st(St.charCodeAt(wt+1))&&st(St.charCodeAt(wt+2))&&!st(St.charCodeAt(wt+3))?(_t.region=Et.slice(wt+1,wt+3),wt+=3):ot(St.charCodeAt(wt+1))&&ot(St.charCodeAt(wt+2))&&ot(St.charCodeAt(wt+3))&&!ot(St.charCodeAt(wt+4))&&(_t.region=Et.slice(wt+1,wt+4),wt+=4));45===St.charCodeAt(wt);){for(ht=it=wt+1;at(St.charCodeAt(ht));){if(ht-it>7)return y(ht,1,"Too long variant, expected at most 8 characters");ht++}if(!(ht-it>4||ht-it>3&&ot(St.charCodeAt(it))))break;_t.variants.push(Et.slice(it,ht)),wt=ht}for(;45===St.charCodeAt(wt)&&120!==St.charCodeAt(wt+1)&&at(St.charCodeAt(wt+1))&&45===St.charCodeAt(wt+2)&&at(St.charCodeAt(wt+3));){for(ht=wt+2,dt=0;45===St.charCodeAt(ht)&&at(St.charCodeAt(ht+1))&&at(St.charCodeAt(ht+2));)for(ht=(it=ht+1)+2,dt++;at(St.charCodeAt(ht));){if(ht-it>7)return y(ht,2,"Too long extension, expected at most 8 characters");ht++}if(!dt)return y(ht,4,"Empty extension, extensions must have at least 2 characters of content");_t.extensions.push({singleton:Et.charAt(wt+1),extensions:Et.slice(wt+3,ht).split("-")}),wt=ht}}else wt=0;if(0===wt&&120===St.charCodeAt(wt)||45===St.charCodeAt(wt)&&120===St.charCodeAt(wt+1))for(ht=wt=wt?wt+2:1;45===St.charCodeAt(ht)&&at(St.charCodeAt(ht+1));){for(ht=it=wt+1;at(St.charCodeAt(ht));){if(ht-it>7)return y(ht,5,"Too long private-use area, expected at most 8 characters");ht++}_t.privateuse.push(Et.slice(wt+1,ht)),wt=ht}return wt!==Et.length?y(wt,6,"Found superfluous content after tag"):_t;function y(nt,rt,it){return pt.warning&&pt.warning(it,rt,nt),pt.forgiving?_t:{language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null}}};var ct={}.hasOwnProperty},6713:function(nt){nt.exports=function(nt){var rt,it,at,st=nt||{},ot=[];if(st.irregular||st.regular)return st.irregular||st.regular;if(st.language)for(ot=ot.concat(st.language,st.extendedLanguageSubtags||[],st.script||[],st.region||[],st.variants||[]),rt=st.extensions||[],it=-1;++it<rt.length;)(at=rt[it]).singleton&&at.extensions&&at.extensions.length&&(ot=ot.concat(at.singleton,at.extensions));return st.privateuse&&st.privateuse.length&&(ot=ot.concat("x",st.privateuse)),ot.join("-")}},1549:function(nt,rt,it){var at=it(6693),st=it(2165),ot="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;rt.Buffer=u,rt.SlowBuffer=function(nt){return+nt!=nt&&(nt=0),u.alloc(+nt)},rt.INSPECT_MAX_BYTES=50;var lt=2147483647;function s(nt){if(nt>lt)throw new RangeError('The value "'+nt+'" is invalid for option "size"');var rt=new Uint8Array(nt);return Object.setPrototypeOf(rt,u.prototype),rt}function u(nt,rt,it){if("number"==typeof nt){if("string"==typeof rt)throw new TypeError('The "string" argument must be of type string. Received type number');return f(nt)}return l(nt,rt,it)}function l(nt,rt,it){if("string"==typeof nt)return function(nt,rt){if("string"==typeof rt&&""!==rt||(rt="utf8"),!u.isEncoding(rt))throw new TypeError("Unknown encoding: "+rt);var it=0|p(nt,rt),at=s(it),st=at.write(nt,rt);return st!==it&&(at=at.slice(0,st)),at}(nt,rt);if(ArrayBuffer.isView(nt))return function(nt){if(G(nt,Uint8Array)){var rt=new Uint8Array(nt);return g(rt.buffer,rt.byteOffset,rt.byteLength)}return d(nt)}(nt);if(null==nt)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof nt);if(G(nt,ArrayBuffer)||nt&&G(nt.buffer,ArrayBuffer))return g(nt,rt,it);if("undefined"!=typeof SharedArrayBuffer&&(G(nt,SharedArrayBuffer)||nt&&G(nt.buffer,SharedArrayBuffer)))return g(nt,rt,it);if("number"==typeof nt)throw new TypeError('The "value" argument must not be of type number. Received type number');var at=nt.valueOf&&nt.valueOf();if(null!=at&&at!==nt)return u.from(at,rt,it);var st=function(nt){if(u.isBuffer(nt)){var rt=0|h(nt.length),it=s(rt);return 0===it.length||nt.copy(it,0,0,rt),it}return void 0!==nt.length?"number"!=typeof nt.length||q(nt.length)?s(0):d(nt):"Buffer"===nt.type&&Array.isArray(nt.data)?d(nt.data):void 0}(nt);if(st)return st;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof nt[Symbol.toPrimitive])return u.from(nt[Symbol.toPrimitive]("string"),rt,it);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof nt)}function c(nt){if("number"!=typeof nt)throw new TypeError('"size" argument must be of type number');if(nt<0)throw new RangeError('The value "'+nt+'" is invalid for option "size"')}function f(nt){return c(nt),s(nt<0?0:0|h(nt))}function d(nt){for(var rt=nt.length<0?0:0|h(nt.length),it=s(rt),at=0;at<rt;at+=1)it[at]=255&nt[at];return it}function g(nt,rt,it){if(rt<0||nt.byteLength<rt)throw new RangeError('"offset" is outside of buffer bounds');if(nt.byteLength<rt+(it||0))throw new RangeError('"length" is outside of buffer bounds');var at;return at=void 0===rt&&void 0===it?new Uint8Array(nt):void 0===it?new Uint8Array(nt,rt):new Uint8Array(nt,rt,it),Object.setPrototypeOf(at,u.prototype),at}function h(nt){if(nt>=lt)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+lt.toString(16)+" bytes");return 0|nt}function p(nt,rt){if(u.isBuffer(nt))return nt.length;if(ArrayBuffer.isView(nt)||G(nt,ArrayBuffer))return nt.byteLength;if("string"!=typeof nt)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof nt);var it=nt.length,at=arguments.length>2&&!0===arguments[2];if(!at&&0===it)return 0;for(var st=!1;;)switch(rt){case"ascii":case"latin1":case"binary":return it;case"utf8":case"utf-8":return U(nt).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*it;case"hex":return it>>>1;case"base64":return Z(nt).length;default:if(st)return at?-1:U(nt).length;rt=(""+rt).toLowerCase(),st=!0}}function m(nt,rt,it){var at=!1;if((void 0===rt||rt<0)&&(rt=0),rt>this.length)return"";if((void 0===it||it>this.length)&&(it=this.length),it<=0)return"";if((it>>>=0)<=(rt>>>=0))return"";for(nt||(nt="utf8");;)switch(nt){case"hex":return D(this,rt,it);case"utf8":case"utf-8":return R(this,rt,it);case"ascii":return N(this,rt,it);case"latin1":case"binary":return C(this,rt,it);case"base64":return I(this,rt,it);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,rt,it);default:if(at)throw new TypeError("Unknown encoding: "+nt);nt=(nt+"").toLowerCase(),at=!0}}function y(nt,rt,it){var at=nt[rt];nt[rt]=nt[it],nt[it]=at}function E(nt,rt,it,at,st){if(0===nt.length)return-1;if("string"==typeof it?(at=it,it=0):it>2147483647?it=2147483647:it<-2147483648&&(it=-2147483648),q(it=+it)&&(it=st?0:nt.length-1),it<0&&(it=nt.length+it),it>=nt.length){if(st)return-1;it=nt.length-1}else if(it<0){if(!st)return-1;it=0}if("string"==typeof rt&&(rt=u.from(rt,at)),u.isBuffer(rt))return 0===rt.length?-1:v(nt,rt,it,at,st);if("number"==typeof rt)return rt&=255,"function"==typeof Uint8Array.prototype.indexOf?st?Uint8Array.prototype.indexOf.call(nt,rt,it):Uint8Array.prototype.lastIndexOf.call(nt,rt,it):v(nt,[rt],it,at,st);throw new TypeError("val must be string, number or Buffer")}function v(nt,rt,it,at,st){var ot,lt=1,ut=nt.length,ct=rt.length;if(void 0!==at&&("ucs2"===(at=String(at).toLowerCase())||"ucs-2"===at||"utf16le"===at||"utf-16le"===at)){if(nt.length<2||rt.length<2)return-1;lt=2,ut/=2,ct/=2,it/=2}function l(nt,rt){return 1===lt?nt[rt]:nt.readUInt16BE(rt*lt)}if(st){var dt=-1;for(ot=it;ot<ut;ot++)if(l(nt,ot)===l(rt,-1===dt?0:ot-dt)){if(-1===dt&&(dt=ot),ot-dt+1===ct)return dt*lt}else-1!==dt&&(ot-=ot-dt),dt=-1}else for(it+ct>ut&&(it=ut-ct),ot=it;ot>=0;ot--){for(var ht=!0,pt=0;pt<ct;pt++)if(l(nt,ot+pt)!==l(rt,pt)){ht=!1;break}if(ht)return ot}return-1}function _(nt,rt,it,at){it=Number(it)||0;var st=nt.length-it;at?(at=Number(at))>st&&(at=st):at=st;var ot=rt.length;at>ot/2&&(at=ot/2);for(var lt=0;lt<at;++lt){var ut=parseInt(rt.substr(2*lt,2),16);if(q(ut))return lt;nt[it+lt]=ut}return lt}function T(nt,rt,it,at){return B(U(rt,nt.length-it),nt,it,at)}function S(nt,rt,it,at){return B(function(nt){for(var rt=[],it=0;it<nt.length;++it)rt.push(255&nt.charCodeAt(it));return rt}(rt),nt,it,at)}function b(nt,rt,it,at){return B(Z(rt),nt,it,at)}function A(nt,rt,it,at){return B(function(nt,rt){for(var it,at,st,ot=[],lt=0;lt<nt.length&&!((rt-=2)<0);++lt)at=(it=nt.charCodeAt(lt))>>8,st=it%256,ot.push(st),ot.push(at);return ot}(rt,nt.length-it),nt,it,at)}function I(nt,rt,it){return 0===rt&&it===nt.length?at.fromByteArray(nt):at.fromByteArray(nt.slice(rt,it))}function R(nt,rt,it){it=Math.min(nt.length,it);for(var at=[],st=rt;st<it;){var ot,lt,ct,dt,ht=nt[st],pt=null,_t=ht>239?4:ht>223?3:ht>191?2:1;if(st+_t<=it)switch(_t){case 1:ht<128&&(pt=ht);break;case 2:128==(192&(ot=nt[st+1]))&&(dt=(31&ht)<<6|63&ot)>127&&(pt=dt);break;case 3:ot=nt[st+1],lt=nt[st+2],128==(192&ot)&&128==(192&lt)&&(dt=(15&ht)<<12|(63&ot)<<6|63&lt)>2047&&(dt<55296||dt>57343)&&(pt=dt);break;case 4:ot=nt[st+1],lt=nt[st+2],ct=nt[st+3],128==(192&ot)&&128==(192&lt)&&128==(192&ct)&&(dt=(15&ht)<<18|(63&ot)<<12|(63&lt)<<6|63&ct)>65535&&dt<1114112&&(pt=dt)}null===pt?(pt=65533,_t=1):pt>65535&&(pt-=65536,at.push(pt>>>10&1023|55296),pt=56320|1023&pt),at.push(pt),st+=_t}return function(nt){var rt=nt.length;if(rt<=ut)return String.fromCharCode.apply(String,nt);for(var it="",at=0;at<rt;)it+=String.fromCharCode.apply(String,nt.slice(at,at+=ut));return it}(at)}rt.kMaxLength=lt,u.TYPED_ARRAY_SUPPORT=function(){try{var nt=new Uint8Array(1),rt={foo:function(){return 42}};return Object.setPrototypeOf(rt,Uint8Array.prototype),Object.setPrototypeOf(nt,rt),42===nt.foo()}catch(nt){return!1}}(),u.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(nt,rt,it){return l(nt,rt,it)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(nt,rt,it){return function(nt,rt,it){return c(nt),nt<=0?s(nt):void 0!==rt?"string"==typeof it?s(nt).fill(rt,it):s(nt).fill(rt):s(nt)}(nt,rt,it)},u.allocUnsafe=function(nt){return f(nt)},u.allocUnsafeSlow=function(nt){return f(nt)},u.isBuffer=function(nt){return null!=nt&&!0===nt._isBuffer&&nt!==u.prototype},u.compare=function(nt,rt){if(G(nt,Uint8Array)&&(nt=u.from(nt,nt.offset,nt.byteLength)),G(rt,Uint8Array)&&(rt=u.from(rt,rt.offset,rt.byteLength)),!u.isBuffer(nt)||!u.isBuffer(rt))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(nt===rt)return 0;for(var it=nt.length,at=rt.length,st=0,ot=Math.min(it,at);st<ot;++st)if(nt[st]!==rt[st]){it=nt[st],at=rt[st];break}return it<at?-1:at<it?1:0},u.isEncoding=function(nt){switch(String(nt).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(nt,rt){if(!Array.isArray(nt))throw new TypeError('"list" argument must be an Array of Buffers');if(0===nt.length)return u.alloc(0);var it;if(void 0===rt)for(rt=0,it=0;it<nt.length;++it)rt+=nt[it].length;var at=u.allocUnsafe(rt),st=0;for(it=0;it<nt.length;++it){var ot=nt[it];if(G(ot,Uint8Array))st+ot.length>at.length?u.from(ot).copy(at,st):Uint8Array.prototype.set.call(at,ot,st);else{if(!u.isBuffer(ot))throw new TypeError('"list" argument must be an Array of Buffers');ot.copy(at,st)}st+=ot.length}return at},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var nt=this.length;if(nt%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var rt=0;rt<nt;rt+=2)y(this,rt,rt+1);return this},u.prototype.swap32=function(){var nt=this.length;if(nt%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var rt=0;rt<nt;rt+=4)y(this,rt,rt+3),y(this,rt+1,rt+2);return this},u.prototype.swap64=function(){var nt=this.length;if(nt%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var rt=0;rt<nt;rt+=8)y(this,rt,rt+7),y(this,rt+1,rt+6),y(this,rt+2,rt+5),y(this,rt+3,rt+4);return this},u.prototype.toString=function(){var nt=this.length;return 0===nt?"":0===arguments.length?R(this,0,nt):m.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(nt){if(!u.isBuffer(nt))throw new TypeError("Argument must be a Buffer");return this===nt||0===u.compare(this,nt)},u.prototype.inspect=function(){var nt="",it=rt.INSPECT_MAX_BYTES;return nt=this.toString("hex",0,it).replace(/(.{2})/g,"$1 ").trim(),this.length>it&&(nt+=" ... "),"<Buffer "+nt+">"},ot&&(u.prototype[ot]=u.prototype.inspect),u.prototype.compare=function(nt,rt,it,at,st){if(G(nt,Uint8Array)&&(nt=u.from(nt,nt.offset,nt.byteLength)),!u.isBuffer(nt))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof nt);if(void 0===rt&&(rt=0),void 0===it&&(it=nt?nt.length:0),void 0===at&&(at=0),void 0===st&&(st=this.length),rt<0||it>nt.length||at<0||st>this.length)throw new RangeError("out of range index");if(at>=st&&rt>=it)return 0;if(at>=st)return-1;if(rt>=it)return 1;if(this===nt)return 0;for(var ot=(st>>>=0)-(at>>>=0),lt=(it>>>=0)-(rt>>>=0),ut=Math.min(ot,lt),ct=this.slice(at,st),dt=nt.slice(rt,it),ht=0;ht<ut;++ht)if(ct[ht]!==dt[ht]){ot=ct[ht],lt=dt[ht];break}return ot<lt?-1:lt<ot?1:0},u.prototype.includes=function(nt,rt,it){return-1!==this.indexOf(nt,rt,it)},u.prototype.indexOf=function(nt,rt,it){return E(this,nt,rt,it,!0)},u.prototype.lastIndexOf=function(nt,rt,it){return E(this,nt,rt,it,!1)},u.prototype.write=function(nt,rt,it,at){if(void 0===rt)at="utf8",it=this.length,rt=0;else if(void 0===it&&"string"==typeof rt)at=rt,it=this.length,rt=0;else{if(!isFinite(rt))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");rt>>>=0,isFinite(it)?(it>>>=0,void 0===at&&(at="utf8")):(at=it,it=void 0)}var st=this.length-rt;if((void 0===it||it>st)&&(it=st),nt.length>0&&(it<0||rt<0)||rt>this.length)throw new RangeError("Attempt to write outside buffer bounds");at||(at="utf8");for(var ot=!1;;)switch(at){case"hex":return _(this,nt,rt,it);case"utf8":case"utf-8":return T(this,nt,rt,it);case"ascii":case"latin1":case"binary":return S(this,nt,rt,it);case"base64":return b(this,nt,rt,it);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,nt,rt,it);default:if(ot)throw new TypeError("Unknown encoding: "+at);at=(""+at).toLowerCase(),ot=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ut=4096;function N(nt,rt,it){var at="";it=Math.min(nt.length,it);for(var st=rt;st<it;++st)at+=String.fromCharCode(127&nt[st]);return at}function C(nt,rt,it){var at="";it=Math.min(nt.length,it);for(var st=rt;st<it;++st)at+=String.fromCharCode(nt[st]);return at}function D(nt,rt,it){var at=nt.length;(!rt||rt<0)&&(rt=0),(!it||it<0||it>at)&&(it=at);for(var st="",ot=rt;ot<it;++ot)st+=dt[nt[ot]];return st}function O(nt,rt,it){for(var at=nt.slice(rt,it),st="",ot=0;ot<at.length-1;ot+=2)st+=String.fromCharCode(at[ot]+256*at[ot+1]);return st}function M(nt,rt,it){if(nt%1!=0||nt<0)throw new RangeError("offset is not uint");if(nt+rt>it)throw new RangeError("Trying to access beyond buffer length")}function P(nt,rt,it,at,st,ot){if(!u.isBuffer(nt))throw new TypeError('"buffer" argument must be a Buffer instance');if(rt>st||rt<ot)throw new RangeError('"value" argument is out of bounds');if(it+at>nt.length)throw new RangeError("Index out of range")}function L(nt,rt,it,at,st,ot){if(it+at>nt.length)throw new RangeError("Index out of range");if(it<0)throw new RangeError("Index out of range")}function F(nt,rt,it,at,ot){return rt=+rt,it>>>=0,ot||L(nt,0,it,4),st.write(nt,rt,it,at,23,4),it+4}function x(nt,rt,it,at,ot){return rt=+rt,it>>>=0,ot||L(nt,0,it,8),st.write(nt,rt,it,at,52,8),it+8}u.prototype.slice=function(nt,rt){var it=this.length;(nt=~~nt)<0?(nt+=it)<0&&(nt=0):nt>it&&(nt=it),(rt=void 0===rt?it:~~rt)<0?(rt+=it)<0&&(rt=0):rt>it&&(rt=it),rt<nt&&(rt=nt);var at=this.subarray(nt,rt);return Object.setPrototypeOf(at,u.prototype),at},u.prototype.readUintLE=u.prototype.readUIntLE=function(nt,rt,it){nt>>>=0,rt>>>=0,it||M(nt,rt,this.length);for(var at=this[nt],st=1,ot=0;++ot<rt&&(st*=256);)at+=this[nt+ot]*st;return at},u.prototype.readUintBE=u.prototype.readUIntBE=function(nt,rt,it){nt>>>=0,rt>>>=0,it||M(nt,rt,this.length);for(var at=this[nt+--rt],st=1;rt>0&&(st*=256);)at+=this[nt+--rt]*st;return at},u.prototype.readUint8=u.prototype.readUInt8=function(nt,rt){return nt>>>=0,rt||M(nt,1,this.length),this[nt]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(nt,rt){return nt>>>=0,rt||M(nt,2,this.length),this[nt]|this[nt+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(nt,rt){return nt>>>=0,rt||M(nt,2,this.length),this[nt]<<8|this[nt+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(nt,rt){return nt>>>=0,rt||M(nt,4,this.length),(this[nt]|this[nt+1]<<8|this[nt+2]<<16)+16777216*this[nt+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(nt,rt){return nt>>>=0,rt||M(nt,4,this.length),16777216*this[nt]+(this[nt+1]<<16|this[nt+2]<<8|this[nt+3])},u.prototype.readIntLE=function(nt,rt,it){nt>>>=0,rt>>>=0,it||M(nt,rt,this.length);for(var at=this[nt],st=1,ot=0;++ot<rt&&(st*=256);)at+=this[nt+ot]*st;return at>=(st*=128)&&(at-=Math.pow(2,8*rt)),at},u.prototype.readIntBE=function(nt,rt,it){nt>>>=0,rt>>>=0,it||M(nt,rt,this.length);for(var at=rt,st=1,ot=this[nt+--at];at>0&&(st*=256);)ot+=this[nt+--at]*st;return ot>=(st*=128)&&(ot-=Math.pow(2,8*rt)),ot},u.prototype.readInt8=function(nt,rt){return nt>>>=0,rt||M(nt,1,this.length),128&this[nt]?-1*(255-this[nt]+1):this[nt]},u.prototype.readInt16LE=function(nt,rt){nt>>>=0,rt||M(nt,2,this.length);var it=this[nt]|this[nt+1]<<8;return 32768&it?4294901760|it:it},u.prototype.readInt16BE=function(nt,rt){nt>>>=0,rt||M(nt,2,this.length);var it=this[nt+1]|this[nt]<<8;return 32768&it?4294901760|it:it},u.prototype.readInt32LE=function(nt,rt){return nt>>>=0,rt||M(nt,4,this.length),this[nt]|this[nt+1]<<8|this[nt+2]<<16|this[nt+3]<<24},u.prototype.readInt32BE=function(nt,rt){return nt>>>=0,rt||M(nt,4,this.length),this[nt]<<24|this[nt+1]<<16|this[nt+2]<<8|this[nt+3]},u.prototype.readFloatLE=function(nt,rt){return nt>>>=0,rt||M(nt,4,this.length),st.read(this,nt,!0,23,4)},u.prototype.readFloatBE=function(nt,rt){return nt>>>=0,rt||M(nt,4,this.length),st.read(this,nt,!1,23,4)},u.prototype.readDoubleLE=function(nt,rt){return nt>>>=0,rt||M(nt,8,this.length),st.read(this,nt,!0,52,8)},u.prototype.readDoubleBE=function(nt,rt){return nt>>>=0,rt||M(nt,8,this.length),st.read(this,nt,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(nt,rt,it,at){nt=+nt,rt>>>=0,it>>>=0,at||P(this,nt,rt,it,Math.pow(2,8*it)-1,0);var st=1,ot=0;for(this[rt]=255&nt;++ot<it&&(st*=256);)this[rt+ot]=nt/st&255;return rt+it},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(nt,rt,it,at){nt=+nt,rt>>>=0,it>>>=0,at||P(this,nt,rt,it,Math.pow(2,8*it)-1,0);var st=it-1,ot=1;for(this[rt+st]=255&nt;--st>=0&&(ot*=256);)this[rt+st]=nt/ot&255;return rt+it},u.prototype.writeUint8=u.prototype.writeUInt8=function(nt,rt,it){return nt=+nt,rt>>>=0,it||P(this,nt,rt,1,255,0),this[rt]=255&nt,rt+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(nt,rt,it){return nt=+nt,rt>>>=0,it||P(this,nt,rt,2,65535,0),this[rt]=255&nt,this[rt+1]=nt>>>8,rt+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(nt,rt,it){return nt=+nt,rt>>>=0,it||P(this,nt,rt,2,65535,0),this[rt]=nt>>>8,this[rt+1]=255&nt,rt+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(nt,rt,it){return nt=+nt,rt>>>=0,it||P(this,nt,rt,4,4294967295,0),this[rt+3]=nt>>>24,this[rt+2]=nt>>>16,this[rt+1]=nt>>>8,this[rt]=255&nt,rt+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(nt,rt,it){return nt=+nt,rt>>>=0,it||P(this,nt,rt,4,4294967295,0),this[rt]=nt>>>24,this[rt+1]=nt>>>16,this[rt+2]=nt>>>8,this[rt+3]=255&nt,rt+4},u.prototype.writeIntLE=function(nt,rt,it,at){if(nt=+nt,rt>>>=0,!at){var st=Math.pow(2,8*it-1);P(this,nt,rt,it,st-1,-st)}var ot=0,lt=1,ut=0;for(this[rt]=255&nt;++ot<it&&(lt*=256);)nt<0&&0===ut&&0!==this[rt+ot-1]&&(ut=1),this[rt+ot]=(nt/lt|0)-ut&255;return rt+it},u.prototype.writeIntBE=function(nt,rt,it,at){if(nt=+nt,rt>>>=0,!at){var st=Math.pow(2,8*it-1);P(this,nt,rt,it,st-1,-st)}var ot=it-1,lt=1,ut=0;for(this[rt+ot]=255&nt;--ot>=0&&(lt*=256);)nt<0&&0===ut&&0!==this[rt+ot+1]&&(ut=1),this[rt+ot]=(nt/lt|0)-ut&255;return rt+it},u.prototype.writeInt8=function(nt,rt,it){return nt=+nt,rt>>>=0,it||P(this,nt,rt,1,127,-128),nt<0&&(nt=255+nt+1),this[rt]=255&nt,rt+1},u.prototype.writeInt16LE=function(nt,rt,it){return nt=+nt,rt>>>=0,it||P(this,nt,rt,2,32767,-32768),this[rt]=255&nt,this[rt+1]=nt>>>8,rt+2},u.prototype.writeInt16BE=function(nt,rt,it){return nt=+nt,rt>>>=0,it||P(this,nt,rt,2,32767,-32768),this[rt]=nt>>>8,this[rt+1]=255&nt,rt+2},u.prototype.writeInt32LE=function(nt,rt,it){return nt=+nt,rt>>>=0,it||P(this,nt,rt,4,2147483647,-2147483648),this[rt]=255&nt,this[rt+1]=nt>>>8,this[rt+2]=nt>>>16,this[rt+3]=nt>>>24,rt+4},u.prototype.writeInt32BE=function(nt,rt,it){return nt=+nt,rt>>>=0,it||P(this,nt,rt,4,2147483647,-2147483648),nt<0&&(nt=4294967295+nt+1),this[rt]=nt>>>24,this[rt+1]=nt>>>16,this[rt+2]=nt>>>8,this[rt+3]=255&nt,rt+4},u.prototype.writeFloatLE=function(nt,rt,it){return F(this,nt,rt,!0,it)},u.prototype.writeFloatBE=function(nt,rt,it){return F(this,nt,rt,!1,it)},u.prototype.writeDoubleLE=function(nt,rt,it){return x(this,nt,rt,!0,it)},u.prototype.writeDoubleBE=function(nt,rt,it){return x(this,nt,rt,!1,it)},u.prototype.copy=function(nt,rt,it,at){if(!u.isBuffer(nt))throw new TypeError("argument should be a Buffer");if(it||(it=0),at||0===at||(at=this.length),rt>=nt.length&&(rt=nt.length),rt||(rt=0),at>0&&at<it&&(at=it),at===it)return 0;if(0===nt.length||0===this.length)return 0;if(rt<0)throw new RangeError("targetStart out of bounds");if(it<0||it>=this.length)throw new RangeError("Index out of range");if(at<0)throw new RangeError("sourceEnd out of bounds");at>this.length&&(at=this.length),nt.length-rt<at-it&&(at=nt.length-rt+it);var st=at-it;return this===nt&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(rt,it,at):Uint8Array.prototype.set.call(nt,this.subarray(it,at),rt),st},u.prototype.fill=function(nt,rt,it,at){if("string"==typeof nt){if("string"==typeof rt?(at=rt,rt=0,it=this.length):"string"==typeof it&&(at=it,it=this.length),void 0!==at&&"string"!=typeof at)throw new TypeError("encoding must be a string");if("string"==typeof at&&!u.isEncoding(at))throw new TypeError("Unknown encoding: "+at);if(1===nt.length){var st=nt.charCodeAt(0);("utf8"===at&&st<128||"latin1"===at)&&(nt=st)}}else"number"==typeof nt?nt&=255:"boolean"==typeof nt&&(nt=Number(nt));if(rt<0||this.length<rt||this.length<it)throw new RangeError("Out of range index");if(it<=rt)return this;var ot;if(rt>>>=0,it=void 0===it?this.length:it>>>0,nt||(nt=0),"number"==typeof nt)for(ot=rt;ot<it;++ot)this[ot]=nt;else{var lt=u.isBuffer(nt)?nt:u.from(nt,at),ut=lt.length;if(0===ut)throw new TypeError('The value "'+nt+'" is invalid for argument "value"');for(ot=0;ot<it-rt;++ot)this[ot+rt]=lt[ot%ut]}return this};var ct=/[^+/0-9A-Za-z-_]/g;function U(nt,rt){var it;rt=rt||1/0;for(var at=nt.length,st=null,ot=[],lt=0;lt<at;++lt){if((it=nt.charCodeAt(lt))>55295&&it<57344){if(!st){if(it>56319){(rt-=3)>-1&&ot.push(239,191,189);continue}if(lt+1===at){(rt-=3)>-1&&ot.push(239,191,189);continue}st=it;continue}if(it<56320){(rt-=3)>-1&&ot.push(239,191,189),st=it;continue}it=65536+(st-55296<<10|it-56320)}else st&&(rt-=3)>-1&&ot.push(239,191,189);if(st=null,it<128){if((rt-=1)<0)break;ot.push(it)}else if(it<2048){if((rt-=2)<0)break;ot.push(it>>6|192,63&it|128)}else if(it<65536){if((rt-=3)<0)break;ot.push(it>>12|224,it>>6&63|128,63&it|128)}else{if(!(it<1114112))throw new Error("Invalid code point");if((rt-=4)<0)break;ot.push(it>>18|240,it>>12&63|128,it>>6&63|128,63&it|128)}}return ot}function Z(nt){return at.toByteArray(function(nt){if((nt=(nt=nt.split("=")[0]).trim().replace(ct,"")).length<2)return"";for(;nt.length%4!=0;)nt+="=";return nt}(nt))}function B(nt,rt,it,at){for(var st=0;st<at&&!(st+it>=rt.length||st>=nt.length);++st)rt[st+it]=nt[st];return st}function G(nt,rt){return nt instanceof rt||null!=nt&&null!=nt.constructor&&null!=nt.constructor.name&&nt.constructor.name===rt.name}function q(nt){return nt!=nt}var dt=function(){for(var nt="0123456789abcdef",rt=new Array(256),it=0;it<16;++it)for(var at=16*it,st=0;st<16;++st)rt[at+st]=nt[it]+nt[st];return rt}()},6693:function(nt,rt){rt.byteLength=function(nt){var rt=u(nt),it=rt[0],at=rt[1];return 3*(it+at)/4-at},rt.toByteArray=function(nt){var rt,it,ot=u(nt),lt=ot[0],ut=ot[1],ct=new st(function(nt,rt,it){return 3*(rt+it)/4-it}(0,lt,ut)),dt=0,ht=ut>0?lt-4:lt;for(it=0;it<ht;it+=4)rt=at[nt.charCodeAt(it)]<<18|at[nt.charCodeAt(it+1)]<<12|at[nt.charCodeAt(it+2)]<<6|at[nt.charCodeAt(it+3)],ct[dt++]=rt>>16&255,ct[dt++]=rt>>8&255,ct[dt++]=255&rt;return 2===ut&&(rt=at[nt.charCodeAt(it)]<<2|at[nt.charCodeAt(it+1)]>>4,ct[dt++]=255&rt),1===ut&&(rt=at[nt.charCodeAt(it)]<<10|at[nt.charCodeAt(it+1)]<<4|at[nt.charCodeAt(it+2)]>>2,ct[dt++]=rt>>8&255,ct[dt++]=255&rt),ct},rt.fromByteArray=function(nt){for(var rt,at=nt.length,st=at%3,ot=[],lt=16383,ut=0,ct=at-st;ut<ct;ut+=lt)ot.push(l(nt,ut,ut+lt>ct?ct:ut+lt));return 1===st?(rt=nt[at-1],ot.push(it[rt>>2]+it[rt<<4&63]+"==")):2===st&&(rt=(nt[at-2]<<8)+nt[at-1],ot.push(it[rt>>10]+it[rt>>4&63]+it[rt<<2&63]+"=")),ot.join("")};for(var it=[],at=[],st="undefined"!=typeof Uint8Array?Uint8Array:Array,ot="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lt=0,ut=ot.length;lt<ut;++lt)it[lt]=ot[lt],at[ot.charCodeAt(lt)]=lt;function u(nt){var rt=nt.length;if(rt%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var it=nt.indexOf("=");return-1===it&&(it=rt),[it,it===rt?0:4-it%4]}function l(nt,rt,at){for(var st,ot,lt=[],ut=rt;ut<at;ut+=3)st=(nt[ut]<<16&16711680)+(nt[ut+1]<<8&65280)+(255&nt[ut+2]),lt.push(it[(ot=st)>>18&63]+it[ot>>12&63]+it[ot>>6&63]+it[63&ot]);return lt.join("")}at["-".charCodeAt(0)]=62,at["_".charCodeAt(0)]=63},2165:function(nt,rt){rt.read=function(nt,rt,it,at,st){var ot,lt,ut=8*st-at-1,ct=(1<<ut)-1,dt=ct>>1,ht=-7,pt=it?st-1:0,_t=it?-1:1,Et=nt[rt+pt];for(pt+=_t,ot=Et&(1<<-ht)-1,Et>>=-ht,ht+=ut;ht>0;ot=256*ot+nt[rt+pt],pt+=_t,ht-=8);for(lt=ot&(1<<-ht)-1,ot>>=-ht,ht+=at;ht>0;lt=256*lt+nt[rt+pt],pt+=_t,ht-=8);if(0===ot)ot=1-dt;else{if(ot===ct)return lt?NaN:1/0*(Et?-1:1);lt+=Math.pow(2,at),ot-=dt}return(Et?-1:1)*lt*Math.pow(2,ot-at)},rt.write=function(nt,rt,it,at,st,ot){var lt,ut,ct,dt=8*ot-st-1,ht=(1<<dt)-1,pt=ht>>1,_t=23===st?Math.pow(2,-24)-Math.pow(2,-77):0,Et=at?0:ot-1,St=at?1:-1,wt=rt<0||0===rt&&1/rt<0?1:0;for(rt=Math.abs(rt),isNaN(rt)||rt===1/0?(ut=isNaN(rt)?1:0,lt=ht):(lt=Math.floor(Math.log(rt)/Math.LN2),rt*(ct=Math.pow(2,-lt))<1&&(lt--,ct*=2),(rt+=lt+pt>=1?_t/ct:_t*Math.pow(2,1-pt))*ct>=2&&(lt++,ct/=2),lt+pt>=ht?(ut=0,lt=ht):lt+pt>=1?(ut=(rt*ct-1)*Math.pow(2,st),lt+=pt):(ut=rt*Math.pow(2,pt-1)*Math.pow(2,st),lt=0));st>=8;nt[it+Et]=255&ut,Et+=St,ut/=256,st-=8);for(lt=lt<<st|ut,dt+=st;dt>0;nt[it+Et]=255&lt,Et+=St,lt/=256,dt-=8);nt[it+Et-St]|=128*wt}},6934:function(nt,rt){var it={parseBuffer:function(nt){return new r(nt).parse()},addBoxProcessor:function(nt,rt){"string"==typeof nt&&"function"==typeof rt&&(i.prototype._boxProcessors[nt]=rt)},createFile:function(){return new r},createBox:function(nt,rt,it){var at=i.create(nt);return rt&&rt.append(at,it),at},createFullBox:function(nt,rt,at){var st=it.createBox(nt,rt,at);return st.version=0,st.flags=0,st},Utils:{}};it.Utils.dataViewToString=function(nt,rt){var it=rt||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(it).decode(nt);var at=[],st=0;if("utf-8"===it)for(;st<nt.byteLength;){var ot=nt.getUint8(st++);ot<128||(ot<224?(ot=(31&ot)<<6,ot|=63&nt.getUint8(st++)):ot<240?(ot=(15&ot)<<12,ot|=(63&nt.getUint8(st++))<<6,ot|=63&nt.getUint8(st++)):(ot=(7&ot)<<18,ot|=(63&nt.getUint8(st++))<<12,ot|=(63&nt.getUint8(st++))<<6,ot|=63&nt.getUint8(st++))),at.push(String.fromCharCode(ot))}else for(;st<nt.byteLength;)at.push(String.fromCharCode(nt.getUint8(st++)));return at.join("")},it.Utils.utf8ToByteArray=function(nt){var rt,it;if("undefined"!=typeof TextEncoder)rt=(new TextEncoder).encode(nt);else for(rt=[],it=0;it<nt.length;++it){var at=nt.charCodeAt(it);at<128?rt.push(at):at<2048?(rt.push(192|at>>6),rt.push(128|63&at)):at<65536?(rt.push(224|at>>12),rt.push(128|63&at>>6),rt.push(128|63&at)):(rt.push(240|at>>18),rt.push(128|63&at>>12),rt.push(128|63&at>>6),rt.push(128|63&at))}return rt},it.Utils.appendBox=function(nt,rt,it){if(rt._offset=nt._cursor.offset,rt._root=nt._root?nt._root:nt,rt._raw=nt._raw,rt._parent=nt,-1!==it)if(null!=it){var at,st=-1;if("number"==typeof it)st=it;else{if("string"==typeof it)at=it;else{if("object"!=typeof it||!it.type)return void nt.boxes.push(rt);at=it.type}for(var ot=0;ot<nt.boxes.length;ot++)if(at===nt.boxes[ot].type){st=ot+1;break}}nt.boxes.splice(st,0,rt)}else nt.boxes.push(rt)},rt.parseBuffer=it.parseBuffer,rt.addBoxProcessor=it.addBoxProcessor,rt.createFile=it.createFile,rt.createBox=it.createBox,rt.createFullBox=it.createFullBox,rt.Utils=it.Utils,it.Cursor=function(nt){this.offset=void 0===nt?0:nt};var r=function(nt){this._cursor=new it.Cursor,this.boxes=[],nt&&(this._raw=new DataView(nt))};r.prototype.fetch=function(nt){var rt=this.fetchAll(nt,!0);return rt.length?rt[0]:null},r.prototype.fetchAll=function(nt,rt){var it=[];return r._sweep.call(this,nt,it,rt),it},r.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var nt=i.parse(this);if(void 0===nt.type)break;this.boxes.push(nt)}return this},r._sweep=function(nt,rt,it){for(var at in this.type&&this.type==nt&&rt.push(this),this.boxes){if(rt.length&&it)return;r._sweep.call(this.boxes[at],nt,rt,it)}},r.prototype.write=function(){var nt,rt=0;for(nt=0;nt<this.boxes.length;nt++)rt+=this.boxes[nt].getLength(!1);var it=new Uint8Array(rt);for(this._rawo=new DataView(it.buffer),this.bytes=it,this._cursor.offset=0,nt=0;nt<this.boxes.length;nt++)this.boxes[nt].write();return it.buffer},r.prototype.append=function(nt,rt){it.Utils.appendBox(this,nt,rt)};var i=function(){this._cursor=new it.Cursor};i.parse=function(nt){var rt=new i;return rt._offset=nt._cursor.offset,rt._root=nt._root?nt._root:nt,rt._raw=nt._raw,rt._parent=nt,rt._parseBox(),nt._cursor.offset=rt._raw.byteOffset+rt._raw.byteLength,rt},i.create=function(nt){var rt=new i;return rt.type=nt,rt.boxes=[],rt},i.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],i.prototype._boxProcessors={},i.prototype._procField=function(nt,rt,it){this._parsing?this[nt]=this._readField(rt,it):this._writeField(rt,it,this[nt])},i.prototype._procFieldArray=function(nt,rt,it,at){var st;if(this._parsing)for(this[nt]=[],st=0;st<rt;st++)this[nt][st]=this._readField(it,at);else for(st=0;st<this[nt].length;st++)this._writeField(it,at,this[nt][st])},i.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},i.prototype._procEntries=function(nt,rt,it){var at;if(this._parsing)for(this[nt]=[],at=0;at<rt;at++)this[nt].push({}),it.call(this,this[nt][at]);else for(at=0;at<rt;at++)it.call(this,this[nt][at])},i.prototype._procSubEntries=function(nt,rt,it,at){var st;if(this._parsing)for(nt[rt]=[],st=0;st<it;st++)nt[rt].push({}),at.call(this,nt[rt][st]);else for(st=0;st<it;st++)at.call(this,nt[rt][st])},i.prototype._procEntryField=function(nt,rt,it,at){this._parsing?nt[rt]=this._readField(it,at):this._writeField(it,at,nt[rt])},i.prototype._procSubBoxes=function(nt,rt){var it;if(this._parsing)for(this[nt]=[],it=0;it<rt;it++)this[nt].push(i.parse(this));else for(it=0;it<rt;it++)this._rawo?this[nt][it].write():this.size+=this[nt][it].getLength()},i.prototype._readField=function(nt,rt){switch(nt){case"uint":return this._readUint(rt);case"int":return this._readInt(rt);case"template":return this._readTemplate(rt);case"string":return-1===rt?this._readTerminatedString():this._readString(rt);case"data":return this._readData(rt);case"utf8":return this._readUTF8String();default:return-1}},i.prototype._readInt=function(nt){var rt=null,it=this._cursor.offset-this._raw.byteOffset;switch(nt){case 8:rt=this._raw.getInt8(it);break;case 16:rt=this._raw.getInt16(it);break;case 32:rt=this._raw.getInt32(it);break;case 64:var at=this._raw.getInt32(it),st=this._raw.getInt32(it+4);rt=at*Math.pow(2,32)+st}return this._cursor.offset+=nt>>3,rt},i.prototype._readUint=function(nt){var rt,it,at=null,st=this._cursor.offset-this._raw.byteOffset;switch(nt){case 8:at=this._raw.getUint8(st);break;case 16:at=this._raw.getUint16(st);break;case 24:at=((rt=this._raw.getUint16(st))<<8)+(it=this._raw.getUint8(st+2));break;case 32:at=this._raw.getUint32(st);break;case 64:rt=this._raw.getUint32(st),it=this._raw.getUint32(st+4),at=rt*Math.pow(2,32)+it}return this._cursor.offset+=nt>>3,at},i.prototype._readString=function(nt){for(var rt="",it=0;it<nt;it++){var at=this._readUint(8);rt+=String.fromCharCode(at)}return rt},i.prototype._readTemplate=function(nt){return this._readUint(nt/2)+this._readUint(nt/2)/Math.pow(2,nt/2)},i.prototype._readTerminatedString=function(){for(var nt="";this._cursor.offset-this._offset<this._raw.byteLength;){var rt=this._readUint(8);if(0===rt)break;nt+=String.fromCharCode(rt)}return nt},i.prototype._readData=function(nt){var rt=nt>0?nt:this._raw.byteLength-(this._cursor.offset-this._offset);if(rt>0){var it=new Uint8Array(this._raw.buffer,this._cursor.offset,rt);return this._cursor.offset+=rt,it}return null},i.prototype._readUTF8String=function(){var nt=this._raw.byteLength-(this._cursor.offset-this._offset),rt=null;return nt>0&&(rt=new DataView(this._raw.buffer,this._cursor.offset,nt),this._cursor.offset+=nt),rt?it.Utils.dataViewToString(rt):rt},i.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._data=this._readData())}},i.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},i.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(i.parse(this))},i.prototype.append=function(nt,rt){it.Utils.appendBox(this,nt,rt)},i.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var nt=0;nt<this.boxes.length;nt++)this.size+=this.boxes[nt].getLength();return this._data&&this._writeData(this._data),this.size},i.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var nt=0;nt<this.boxes.length;nt++)this.boxes[nt].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},i.prototype._writeInt=function(nt,rt){if(this._rawo){var it=this._cursor.offset-this._rawo.byteOffset;switch(nt){case 8:this._rawo.setInt8(it,rt);break;case 16:this._rawo.setInt16(it,rt);break;case 32:this._rawo.setInt32(it,rt);break;case 64:var at=Math.floor(rt/Math.pow(2,32)),st=rt-at*Math.pow(2,32);this._rawo.setUint32(it,at),this._rawo.setUint32(it+4,st)}this._cursor.offset+=nt>>3}else this.size+=nt>>3},i.prototype._writeUint=function(nt,rt){if(this._rawo){var it,at,st=this._cursor.offset-this._rawo.byteOffset;switch(nt){case 8:this._rawo.setUint8(st,rt);break;case 16:this._rawo.setUint16(st,rt);break;case 24:it=(16776960&rt)>>8,at=255&rt,this._rawo.setUint16(st,it),this._rawo.setUint8(st+2,at);break;case 32:this._rawo.setUint32(st,rt);break;case 64:at=rt-(it=Math.floor(rt/Math.pow(2,32)))*Math.pow(2,32),this._rawo.setUint32(st,it),this._rawo.setUint32(st+4,at)}this._cursor.offset+=nt>>3}else this.size+=nt>>3},i.prototype._writeString=function(nt,rt){for(var it=0;it<nt;it++)this._writeUint(8,rt.charCodeAt(it))},i.prototype._writeTerminatedString=function(nt){if(0!==nt.length){for(var rt=0;rt<nt.length;rt++)this._writeUint(8,nt.charCodeAt(rt));this._writeUint(8,0)}},i.prototype._writeTemplate=function(nt,rt){var it=Math.floor(rt),at=(rt-it)*Math.pow(2,nt/2);this._writeUint(nt/2,it),this._writeUint(nt/2,at)},i.prototype._writeData=function(nt){if(nt)if(this._rawo){if(nt instanceof Array){for(var rt=this._cursor.offset-this._rawo.byteOffset,it=0;it<nt.length;it++)this._rawo.setInt8(rt+it,nt[it]);this._cursor.offset+=nt.length}nt instanceof Uint8Array&&(this._root.bytes.set(nt,this._cursor.offset),this._cursor.offset+=nt.length)}else this.size+=nt.length},i.prototype._writeUTF8String=function(nt){var rt=it.Utils.utf8ToByteArray(nt);if(this._rawo)for(var at=new DataView(this._rawo.buffer,this._cursor.offset,rt.length),st=0;st<rt.length;st++)at.setUint8(st,rt[st]);else this.size+=rt.length},i.prototype._writeField=function(nt,rt,it){switch(nt){case"uint":this._writeUint(rt,it);break;case"int":this._writeInt(rt,it);break;case"template":this._writeTemplate(rt,it);break;case"string":-1==rt?this._writeTerminatedString(it):this._writeString(rt,it);break;case"data":this._writeData(it);break;case"utf8":this._writeUTF8String(it)}},i.prototype._boxProcessors.avc1=i.prototype._boxProcessors.avc2=i.prototype._boxProcessors.avc3=i.prototype._boxProcessors.avc4=i.prototype._boxProcessors.hvc1=i.prototype._boxProcessors.hev1=i.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},i.prototype._boxProcessors.ctts=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(nt){this._procEntryField(nt,"sample_count","uint",32),this._procEntryField(nt,"sample_offset",1===this.version?"int":"uint",32)}))},i.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(nt){this._procEntryField(nt,"segment_duration","uint",1===this.version?64:32),this._procEntryField(nt,"media_time","int",1===this.version?64:32),this._procEntryField(nt,"media_rate_integer","int",16),this._procEntryField(nt,"media_rate_fraction","int",16)}))},i.prototype._boxProcessors.emsg=function(){this._procFullBox(),1==this.version?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},i.prototype._boxProcessors.free=i.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},i.prototype._boxProcessors.ftyp=i.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var nt=-1;this._parsing&&(nt=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",nt,"string",4)},i.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},i.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._parsing||"string"!=typeof this.language||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode(96+(this.language>>10&31),96+(this.language>>5&31),96+(31&this.language))),this._procField("pre_defined","uint",16)},i.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},i.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},i.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},i.prototype._boxProcessors.mp4a=i.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},i.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},i.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},i.prototype._boxProcessors.prft=function(){this._procFullBox(),this._procField("reference_track_ID","uint",32),this._procField("ntp_timestamp_sec","uint",32),this._procField("ntp_timestamp_frac","uint",32),this._procField("media_time","uint",1==this.version?64:32)},i.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},i.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},i.prototype._boxProcessors.sdtp=function(){this._procFullBox();var nt=-1;this._parsing&&(nt=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",nt,"uint",8)},i.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",1==this.version?64:32),this._procField("first_offset","uint",1==this.version?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,(function(nt){this._parsing||(nt.reference=(1&nt.reference_type)<<31,nt.reference|=2147483647&nt.referenced_size,nt.sap=(1&nt.starts_with_SAP)<<31,nt.sap|=(3&nt.SAP_type)<<28,nt.sap|=268435455&nt.SAP_delta_time),this._procEntryField(nt,"reference","uint",32),this._procEntryField(nt,"subsegment_duration","uint",32),this._procEntryField(nt,"sap","uint",32),this._parsing&&(nt.reference_type=nt.reference>>31&1,nt.referenced_size=2147483647&nt.reference,nt.starts_with_SAP=nt.sap>>31&1,nt.SAP_type=nt.sap>>28&7,nt.SAP_delta_time=268435455&nt.sap)}))},i.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},i.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,(function(nt){this._procEntryField(nt,"ranges_count","uint",32),this._procSubEntries(nt,"ranges",nt.ranges_count,(function(nt){this._procEntryField(nt,"level","uint",8),this._procEntryField(nt,"range_size","uint",24)}))}))},i.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.sttg=function(){this._procField("settings","utf8")},i.prototype._boxProcessors.stts=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(nt){this._procEntryField(nt,"sample_count","uint",32),this._procEntryField(nt,"sample_delta","uint",32)}))},i.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(nt){this._procEntryField(nt,"sample_delta","uint",32),this._procEntryField(nt,"subsample_count","uint",16),this._procSubEntries(nt,"subsamples",nt.subsample_count,(function(nt){this._procEntryField(nt,"subsample_size","uint",1===this.version?32:16),this._procEntryField(nt,"subsample_priority","uint",8),this._procEntryField(nt,"discardable","uint",8),this._procEntryField(nt,"codec_specific_parameters","uint",32)}))}))},i.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},i.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",1==this.version?64:32)},i.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,(function(nt){this._procEntryField(nt,"time","uint",1===this.version?64:32),this._procEntryField(nt,"moof_offset","uint",1===this.version?64:32),this._procEntryField(nt,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(nt,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(nt,"sample_number","uint",8*(this.length_size_of_sample_num+1))}))},i.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},i.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,(function(nt){256&this.flags&&this._procEntryField(nt,"sample_duration","uint",32),512&this.flags&&this._procEntryField(nt,"sample_size","uint",32),1024&this.flags&&this._procEntryField(nt,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(nt,"sample_composition_time_offset",1===this.version?"int":"uint",32)}))},i.prototype._boxProcessors["url "]=i.prototype._boxProcessors["urn "]=function(){this._procFullBox(),"urn "===this.type&&this._procField("name","string",-1),this._procField("location","string",-1)},i.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},i.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},i.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},i.prototype._boxProcessors.vtte=function(){}},5530:function(nt,rt,it){nt.exports=it(6146).polyfill()},6146:function(nt,rt,it){nt.exports=function(){function e(nt){return"function"==typeof nt}var nt=Array.isArray?Array.isArray:function(nt){return"[object Array]"===Object.prototype.toString.call(nt)},rt=0,at=void 0,st=void 0,o=function(nt,it){ht[rt]=nt,ht[rt+1]=it,2===(rt+=2)&&(st?st(h):wt())},ot="undefined"!=typeof window?window:void 0,lt=ot||{},ut=lt.MutationObserver||lt.WebKitMutationObserver,ct="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),dt="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var nt=setTimeout;return function(){return nt(h,1)}}var ht=new Array(1e3);function h(){for(var nt=0;nt<rt;nt+=2)(0,ht[nt])(ht[nt+1]),ht[nt]=void 0,ht[nt+1]=void 0;rt=0}var pt,_t,Et,St,wt=void 0;function _(nt,rt){var it=this,at=new this.constructor(b);void 0===at[Lt]&&L(at);var st=it._state;if(st){var ot=arguments[st-1];o((function(){return M(st,at,ot,it._result)}))}else D(it,at,nt,rt);return at}function T(nt){if(nt&&"object"==typeof nt&&nt.constructor===this)return nt;var rt=new this(b);return R(rt,nt),rt}wt=ct?function(){return process.nextTick(h)}:ut?(_t=0,Et=new ut(h),St=document.createTextNode(""),Et.observe(St,{characterData:!0}),function(){St.data=_t=++_t%2}):dt?((pt=new MessageChannel).port1.onmessage=h,function(){return pt.port2.postMessage(0)}):void 0===ot?function(){try{var nt=Function("return this")().require("vertx");return void 0!==(at=nt.runOnLoop||nt.runOnContext)?function(){at(h)}:d()}catch(nt){return d()}}():d();var Lt=Math.random().toString(36).substring(2);function b(){}var Ct=void 0;function I(nt,rt,it){rt.constructor===nt.constructor&&it===_&&rt.constructor.resolve===T?function(nt,rt){1===rt._state?N(nt,rt._result):2===rt._state?C(nt,rt._result):D(rt,void 0,(function(rt){return R(nt,rt)}),(function(rt){return C(nt,rt)}))}(nt,rt):void 0===it?N(nt,rt):e(it)?function(nt,rt,it){o((function(nt){var at=!1,st=function(nt,rt,it,at){try{nt.call(rt,it,at)}catch(nt){return nt}}(it,rt,(function(it){at||(at=!0,rt!==it?R(nt,it):N(nt,it))}),(function(rt){at||(at=!0,C(nt,rt))}),nt._label);!at&&st&&(at=!0,C(nt,st))}),nt)}(nt,rt,it):N(nt,rt)}function R(nt,rt){if(nt===rt)C(nt,new TypeError("You cannot resolve a promise with itself"));else if(st=typeof(at=rt),null===at||"object"!==st&&"function"!==st)N(nt,rt);else{var it=void 0;try{it=rt.then}catch(rt){return void C(nt,rt)}I(nt,rt,it)}var at,st}function w(nt){nt._onerror&&nt._onerror(nt._result),O(nt)}function N(nt,rt){nt._state===Ct&&(nt._result=rt,nt._state=1,0!==nt._subscribers.length&&o(O,nt))}function C(nt,rt){nt._state===Ct&&(nt._state=2,nt._result=rt,o(w,nt))}function D(nt,rt,it,at){var st=nt._subscribers,ot=st.length;nt._onerror=null,st[ot]=rt,st[ot+1]=it,st[ot+2]=at,0===ot&&nt._state&&o(O,nt)}function O(nt){var rt=nt._subscribers,it=nt._state;if(0!==rt.length){for(var at=void 0,st=void 0,ot=nt._result,lt=0;lt<rt.length;lt+=3)at=rt[lt],st=rt[lt+it],at?M(it,at,st,ot):st(ot);nt._subscribers.length=0}}function M(nt,rt,it,at){var st=e(it),ot=void 0,lt=void 0,ut=!0;if(st){try{ot=it(at)}catch(nt){ut=!1,lt=nt}if(rt===ot)return void C(rt,new TypeError("A promises callback cannot return that same promise."))}else ot=at;rt._state!==Ct||(st&&ut?R(rt,ot):!1===ut?C(rt,lt):1===nt?N(rt,ot):2===nt&&C(rt,ot))}var Pt=0;function L(nt){nt[Lt]=Pt++,nt._state=void 0,nt._result=void 0,nt._subscribers=[]}var kt=function(){function e(rt,it){this._instanceConstructor=rt,this.promise=new rt(b),this.promise[Lt]||L(this.promise),nt(it)?(this.length=it.length,this._remaining=it.length,this._result=new Array(this.length),0===this.length?N(this.promise,this._result):(this.length=this.length||0,this._enumerate(it),0===this._remaining&&N(this.promise,this._result))):C(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(nt){for(var rt=0;this._state===Ct&&rt<nt.length;rt++)this._eachEntry(nt[rt],rt)},e.prototype._eachEntry=function(nt,rt){var it=this._instanceConstructor,at=it.resolve;if(at===T){var st=void 0,ot=void 0,lt=!1;try{st=nt.then}catch(nt){lt=!0,ot=nt}if(st===_&&nt._state!==Ct)this._settledAt(nt._state,rt,nt._result);else if("function"!=typeof st)this._remaining--,this._result[rt]=nt;else if(it===Ot){var ut=new it(b);lt?C(ut,ot):I(ut,nt,st),this._willSettleAt(ut,rt)}else this._willSettleAt(new it((function(rt){return rt(nt)})),rt)}else this._willSettleAt(at(nt),rt)},e.prototype._settledAt=function(nt,rt,it){var at=this.promise;at._state===Ct&&(this._remaining--,2===nt?C(at,it):this._result[rt]=it),0===this._remaining&&N(at,this._result)},e.prototype._willSettleAt=function(nt,rt){var it=this;D(nt,void 0,(function(nt){return it._settledAt(1,rt,nt)}),(function(nt){return it._settledAt(2,rt,nt)}))},e}(),Ot=function(){function t(nt){this[Lt]=Pt++,this._result=this._state=void 0,this._subscribers=[],b!==nt&&("function"!=typeof nt&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(nt,rt){try{rt((function(rt){R(nt,rt)}),(function(rt){C(nt,rt)}))}catch(rt){C(nt,rt)}}(this,nt):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(nt){return this.then(null,nt)},t.prototype.finally=function(nt){var rt=this,it=rt.constructor;return e(nt)?rt.then((function(rt){return it.resolve(nt()).then((function(){return rt}))}),(function(rt){return it.resolve(nt()).then((function(){throw rt}))})):rt.then(nt,nt)},t}();return Ot.prototype.then=_,Ot.all=function(nt){return new kt(this,nt).promise},Ot.race=function(rt){var it=this;return nt(rt)?new it((function(nt,at){for(var st=rt.length,ot=0;ot<st;ot++)it.resolve(rt[ot]).then(nt,at)})):new it((function(nt,rt){return rt(new TypeError("You must pass an array to race."))}))},Ot.resolve=T,Ot.reject=function(nt){var rt=new this(b);return C(rt,nt),rt},Ot._setScheduler=function(nt){st=nt},Ot._setAsap=function(nt){o=nt},Ot._asap=o,Ot.polyfill=function(){var nt=void 0;if(void 0!==it.g)nt=it.g;else if("undefined"!=typeof self)nt=self;else try{nt=Function("return this")()}catch(nt){throw new Error("polyfill failed because global object is unavailable in this environment")}var rt=nt.Promise;if(rt){var at=null;try{at=Object.prototype.toString.call(rt.resolve())}catch(nt){}if("[object Promise]"===at&&!rt.cast)return}nt.Promise=Ot},Ot.Promise=Ot,Ot}()},1159:function(nt){var rt,it="object"==typeof Reflect?Reflect:null,at=it&&"function"==typeof it.apply?it.apply:function(nt,rt,it){return Function.prototype.apply.call(nt,rt,it)};rt=it&&"function"==typeof it.ownKeys?it.ownKeys:Object.getOwnPropertySymbols?function(nt){return Object.getOwnPropertyNames(nt).concat(Object.getOwnPropertySymbols(nt))}:function(nt){return Object.getOwnPropertyNames(nt)};var st=Number.isNaN||function(nt){return nt!=nt};function a(){a.init.call(this)}nt.exports=a,nt.exports.once=function(nt,rt){return new Promise((function(it,at){function i(it){nt.removeListener(rt,a),at(it)}function a(){"function"==typeof nt.removeListener&&nt.removeListener("error",i),it([].slice.call(arguments))}p(nt,rt,a,{once:!0}),"error"!==rt&&function(nt,rt){"function"==typeof nt.on&&p(nt,"error",rt,{once:!0})}(nt,i)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var ot=10;function s(nt){if("function"!=typeof nt)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof nt)}function u(nt){return void 0===nt._maxListeners?a.defaultMaxListeners:nt._maxListeners}function l(nt,rt,it,at){var st,ot,lt,ut;if(s(it),void 0===(ot=nt._events)?(ot=nt._events=Object.create(null),nt._eventsCount=0):(void 0!==ot.newListener&&(nt.emit("newListener",rt,it.listener?it.listener:it),ot=nt._events),lt=ot[rt]),void 0===lt)lt=ot[rt]=it,++nt._eventsCount;else if("function"==typeof lt?lt=ot[rt]=at?[it,lt]:[lt,it]:at?lt.unshift(it):lt.push(it),(st=u(nt))>0&&lt.length>st&&!lt.warned){lt.warned=!0;var ct=new Error("Possible EventEmitter memory leak detected. "+lt.length+" "+String(rt)+" listeners added. Use emitter.setMaxListeners() to increase limit");ct.name="MaxListenersExceededWarning",ct.emitter=nt,ct.type=rt,ct.count=lt.length,ut=ct,console&&console.warn&&console.warn(ut)}return nt}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(nt,rt,it){var at={fired:!1,wrapFn:void 0,target:nt,type:rt,listener:it},st=c.bind(at);return st.listener=it,at.wrapFn=st,st}function d(nt,rt,it){var at=nt._events;if(void 0===at)return[];var st=at[rt];return void 0===st?[]:"function"==typeof st?it?[st.listener||st]:[st]:it?function(nt){for(var rt=new Array(nt.length),it=0;it<rt.length;++it)rt[it]=nt[it].listener||nt[it];return rt}(st):h(st,st.length)}function g(nt){var rt=this._events;if(void 0!==rt){var it=rt[nt];if("function"==typeof it)return 1;if(void 0!==it)return it.length}return 0}function h(nt,rt){for(var it=new Array(rt),at=0;at<rt;++at)it[at]=nt[at];return it}function p(nt,rt,it,at){if("function"==typeof nt.on)at.once?nt.once(rt,it):nt.on(rt,it);else{if("function"!=typeof nt.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof nt);nt.addEventListener(rt,(function i(st){at.once&&nt.removeEventListener(rt,i),it(st)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return ot},set:function(nt){if("number"!=typeof nt||nt<0||st(nt))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+nt+".");ot=nt}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(nt){if("number"!=typeof nt||nt<0||st(nt))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+nt+".");return this._maxListeners=nt,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(nt){for(var rt=[],it=1;it<arguments.length;it++)rt.push(arguments[it]);var st="error"===nt,ot=this._events;if(void 0!==ot)st=st&&void 0===ot.error;else if(!st)return!1;if(st){var lt;if(rt.length>0&&(lt=rt[0]),lt instanceof Error)throw lt;var ut=new Error("Unhandled error."+(lt?" ("+lt.message+")":""));throw ut.context=lt,ut}var ct=ot[nt];if(void 0===ct)return!1;if("function"==typeof ct)at(ct,this,rt);else{var dt=ct.length,ht=h(ct,dt);for(it=0;it<dt;++it)at(ht[it],this,rt)}return!0},a.prototype.addListener=function(nt,rt){return l(this,nt,rt,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(nt,rt){return l(this,nt,rt,!0)},a.prototype.once=function(nt,rt){return s(rt),this.on(nt,f(this,nt,rt)),this},a.prototype.prependOnceListener=function(nt,rt){return s(rt),this.prependListener(nt,f(this,nt,rt)),this},a.prototype.removeListener=function(nt,rt){var it,at,st,ot,lt;if(s(rt),void 0===(at=this._events))return this;if(void 0===(it=at[nt]))return this;if(it===rt||it.listener===rt)0==--this._eventsCount?this._events=Object.create(null):(delete at[nt],at.removeListener&&this.emit("removeListener",nt,it.listener||rt));else if("function"!=typeof it){for(st=-1,ot=it.length-1;ot>=0;ot--)if(it[ot]===rt||it[ot].listener===rt){lt=it[ot].listener,st=ot;break}if(st<0)return this;0===st?it.shift():function(nt,rt){for(;rt+1<nt.length;rt++)nt[rt]=nt[rt+1];nt.pop()}(it,st),1===it.length&&(at[nt]=it[0]),void 0!==at.removeListener&&this.emit("removeListener",nt,lt||rt)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(nt){var rt,it,at;if(void 0===(it=this._events))return this;if(void 0===it.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==it[nt]&&(0==--this._eventsCount?this._events=Object.create(null):delete it[nt]),this;if(0===arguments.length){var st,ot=Object.keys(it);for(at=0;at<ot.length;++at)"removeListener"!==(st=ot[at])&&this.removeAllListeners(st);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(rt=it[nt]))this.removeListener(nt,rt);else if(void 0!==rt)for(at=rt.length-1;at>=0;at--)this.removeListener(nt,rt[at]);return this},a.prototype.listeners=function(nt){return d(this,nt,!0)},a.prototype.rawListeners=function(nt){return d(this,nt,!1)},a.listenerCount=function(nt,rt){return"function"==typeof nt.listenerCount?nt.listenerCount(rt):g.call(nt,rt)},a.prototype.listenerCount=g,a.prototype.eventNames=function(){return this._eventsCount>0?rt(this._events):[]}},3101:function(nt){var rt=Array.isArray,it=Object.keys,at=Object.prototype.hasOwnProperty;nt.exports=function e(nt,st){if(nt===st)return!0;if(nt&&st&&"object"==typeof nt&&"object"==typeof st){var ot,lt,ut,ct=rt(nt),dt=rt(st);if(ct&&dt){if((lt=nt.length)!=st.length)return!1;for(ot=lt;0!=ot--;)if(!e(nt[ot],st[ot]))return!1;return!0}if(ct!=dt)return!1;var ht=nt instanceof Date,pt=st instanceof Date;if(ht!=pt)return!1;if(ht&&pt)return nt.getTime()==st.getTime();var _t=nt instanceof RegExp,Et=st instanceof RegExp;if(_t!=Et)return!1;if(_t&&Et)return nt.toString()==st.toString();var St=it(nt);if((lt=St.length)!==it(st).length)return!1;for(ot=lt;0!=ot--;)if(!at.call(st,St[ot]))return!1;for(ot=lt;0!=ot--;)if(!e(nt[ut=St[ot]],st[ut]))return!1;return!0}return nt!=nt&&st!=st}},3362:function(nt,rt,it){!function(nt,rt,it,at,st){function a(nt){if("contents"in nt)for(var rt=("styleAttrs"in nt?nt.styleAttrs[at.byName.ruby.qname]:null),it="span"===nt.kind&&("container"===rt||"textContainer"===rt||"baseContainer"===rt),st=nt.contents.length-1;st>=0;st--)!it||"styleAttrs"in nt.contents[st]&&at.byName.ruby.qname in nt.contents[st].styleAttrs?a(nt.contents[st]):delete nt.contents[st]}function o(nt,rt,it,at){var st=at&&"seq"===at.timeContainer,ot=0;at&&(ot=st&&it?it.end:at.begin),rt.begin=rt.explicit_begin?rt.explicit_begin+ot:ot;var lt=rt.begin,ut=null;if("sets"in rt)for(var ct=0;ct<rt.sets.length;ct++)o(nt,rt.sets[ct],ut,rt),lt="seq"===rt.timeContainer?rt.sets[ct].end:Math.max(lt,rt.sets[ct].end),ut=rt.sets[ct];if("contents"in rt){if("contents"in rt)for(var dt=0;dt<rt.contents.length;dt++)o(nt,rt.contents[dt],ut,rt),lt="seq"===rt.timeContainer?rt.contents[dt].end:Math.max(lt,rt.contents[dt].end),ut=rt.contents[dt]}else lt=st?rt.begin:Number.POSITIVE_INFINITY;null!==rt.explicit_end&&null!==rt.explicit_dur?rt.end=Math.min(rt.begin+rt.explicit_dur,ot+rt.explicit_end):null===rt.explicit_end&&null!==rt.explicit_dur?rt.end=rt.begin+rt.explicit_dur:null!==rt.explicit_end&&null===rt.explicit_dur?rt.end=ot+rt.explicit_end:rt.end=lt,delete rt.explicit_begin,delete rt.explicit_dur,delete rt.explicit_end,nt._registerEvent(rt)}function s(nt){this.node=nt}function u(){this.events=[],this.head=new l,this.body=null}function l(){this.styling=new c,this.layout=new g}function c(){this.styles={},this.initials={}}function f(){this.id=null,this.styleAttrs=null,this.styleRefs=null}function d(){this.styleAttrs=null}function g(){this.regions={}}function h(nt,rt){p.call(this,"image"),this.src=nt,this.type=rt}function p(nt){this.kind=nt}function m(nt){this.id=nt}function y(nt){this.regionID=nt}function E(nt){this.styleAttrs=nt}function v(nt){this.sets=nt}function _(nt){this.contents=nt}function T(nt,rt,it){this.explicit_begin=nt,this.explicit_end=rt,this.explicit_dur=it}function S(){p.call(this,"body")}function b(){p.call(this,"div")}function A(){p.call(this,"p")}function I(){p.call(this,"span")}function R(){p.call(this,"span")}function w(){p.call(this,"br")}function N(){}function C(){}function D(nt){return nt&&"xml:id"in nt.attributes&&nt.attributes["xml:id"].value||null}function O(nt){return nt&&"style"in nt.attributes?nt.attributes.style.value.split(" "):[]}function M(nt,rt){var it={};if(null!==nt)for(var st in nt.attributes){var ot=nt.attributes[st].uri+" "+nt.attributes[st].local,lt=at.byQName[ot];if(void 0!==lt){var ut=lt.parse(nt.attributes[st].value);null!==ut?(it[ot]=ut,lt===at.byName.zIndex&&U(rt,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):Z(rt,"Cannot parse styling attribute "+ot+" --\x3e "+nt.attributes[st].value)}}return it}function P(nt,rt,it){for(var at in nt.attributes)if(nt.attributes[at].uri===rt&&nt.attributes[at].local===it)return nt.attributes[at].value;return null}function L(nt,rt,it){var at,st=null;return null!==(at=/^(\d+(?:\.\d+)?)f$/.exec(it))?null!==rt&&(st=parseFloat(at[1])/rt):null!==(at=/^(\d+(?:\.\d+)?)t$/.exec(it))?null!==nt&&(st=parseFloat(at[1])/nt):null!==(at=/^(\d+(?:\.\d+)?)ms$/.exec(it))?st=parseFloat(at[1])/1e3:null!==(at=/^(\d+(?:\.\d+)?)s$/.exec(it))?st=parseFloat(at[1]):null!==(at=/^(\d+(?:\.\d+)?)h$/.exec(it))?st=3600*parseFloat(at[1]):null!==(at=/^(\d+(?:\.\d+)?)m$/.exec(it))?st=60*parseFloat(at[1]):null!==(at=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/.exec(it))?st=3600*parseInt(at[1])+60*parseInt(at[2])+parseFloat(at[3]):null!==(at=/^(\d{2,}):(\d\d):(\d\d)\:(\d{2,})$/.exec(it))&&null!==rt&&(st=3600*parseInt(at[1])+60*parseInt(at[2])+parseInt(at[3])+(null===at[4]?0:parseInt(at[4])/rt)),st}function F(nt,rt,it){for(;rt.styleRefs.length>0;){var at=rt.styleRefs.pop();at in nt.styles?(F(nt,nt.styles[at],it),k(nt.styles[at].styleAttrs,rt.styleAttrs)):Z(it,"Non-existant style id referenced")}}function x(nt,rt,it,at){for(var st=rt.length-1;st>=0;st--){var ot=rt[st];ot in nt.styles?k(nt.styles[ot].styleAttrs,it):Z(at,"Non-existant style id referenced")}}function k(nt,rt){for(var it in nt)nt.hasOwnProperty(it)&&(it in rt||(rt[it]=nt[it]))}function U(nt,rt){if(nt&&nt.warn&&nt.warn(rt))throw rt}function Z(nt,rt){if(nt&&nt.error&&nt.error(rt))throw rt}function B(nt,rt){throw nt&&nt.fatal&&nt.fatal(rt),rt}function G(nt,rt){for(var it,at=0,st=nt.length-1;at<=st;){var ot=nt[it=Math.floor((at+st)/2)];if(ot<rt)at=it+1;else{if(!(ot>rt))return{found:!0,index:it};st=it-1}}return{found:!1,index:at}}nt.fromXML=function(nt,st,ot){var lt=rt.parser(!0,{xmlns:!0}),ut=[],ct=[],dt=[],ht=0,pt=null;lt.onclosetag=function(nt){if(ut[0]instanceof N)null!==pt.head&&null!==pt.head.styling&&x(pt.head.styling,ut[0].styleRefs,ut[0].styleAttrs,st),delete ut[0].styleRefs;else if(ut[0]instanceof c)for(var rt in ut[0].styles)ut[0].styles.hasOwnProperty(rt)&&F(ut[0],ut[0].styles[rt],st);else if(ut[0]instanceof A||ut[0]instanceof I){if(ut[0].contents.length>1){var at,lt=[ut[0].contents[0]];for(at=1;at<ut[0].contents.length;at++)ut[0].contents[at]instanceof R&&lt[lt.length-1]instanceof R?lt[lt.length-1].text+=ut[0].contents[at].text:lt.push(ut[0].contents[at]);ut[0].contents=lt}ut[0]instanceof I&&1===ut[0].contents.length&&ut[0].contents[0]instanceof R&&(ut[0].text=ut[0].contents[0].text,delete ut[0].contents)}else ut[0]instanceof s&&(ut[0].node.uri===it.ns_tt&&"metadata"===ut[0].node.local?ht--:ht>0&&ot&&"onCloseTag"in ot&&ot.onCloseTag());dt.shift(),ct.shift(),ut.shift()},lt.ontext=function(nt){if(void 0===ut[0]);else if(ut[0]instanceof I||ut[0]instanceof A){if(ut[0]instanceof I){var rt=ut[0].styleAttrs[at.byName.ruby.qname];if("container"===rt||"textContainer"===rt||"baseContainer"===rt)return}var it=new R;it.initFromText(pt,ut[0],nt,ct[0],dt[0],st),ut[0].contents.push(it)}else ut[0]instanceof s&&ht>0&&ot&&"onText"in ot&&ot.onText(nt)},lt.onopentag=function(nt){var rt=nt.attributes["xml:space"];rt?dt.unshift(rt.value):0===dt.length?dt.unshift("default"):dt.unshift(dt[0]);var lt=nt.attributes["xml:lang"];if(lt?ct.unshift(lt.value):0===ct.length?ct.unshift(""):ct.unshift(ct[0]),nt.uri===it.ns_tt)if("tt"===nt.local)null!==pt&&B(st,"Two <tt> elements at ("+this.line+","+this.column+")"),(pt=new u).initFromNode(nt,ct[0],st),ut.unshift(pt);else if("head"===nt.local)ut[0]instanceof u||B(st,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),ut.unshift(pt.head);else if("styling"===nt.local)ut[0]instanceof l||B(st,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),ut.unshift(pt.head.styling);else if("style"===nt.local){var _t;ut[0]instanceof c?((_t=new f).initFromNode(nt,st),_t.id?pt.head.styling.styles[_t.id]=_t:Z(st,"<style> element missing @id attribute"),ut.unshift(_t)):ut[0]instanceof N?((_t=new f).initFromNode(nt,st),k(_t.styleAttrs,ut[0].styleAttrs),ut.unshift(_t)):B(st,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")")}else if("initial"===nt.local){var Et;if(ut[0]instanceof c){for(var St in(Et=new d).initFromNode(nt,st),Et.styleAttrs)Et.styleAttrs.hasOwnProperty(St)&&(pt.head.styling.initials[St]=Et.styleAttrs[St]);ut.unshift(Et)}else B(st,"Parent of <initial> element is not <styling> at ("+this.line+","+this.column+")")}else if("layout"===nt.local)ut[0]instanceof l||B(st,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),ut.unshift(pt.head.layout);else if("region"===nt.local){ut[0]instanceof g||B(st,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")");var wt=new N;wt.initFromNode(pt,nt,ct[0],st),!wt.id||wt.id in pt.head.layout.regions?Z(st,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):pt.head.layout.regions[wt.id]=wt,ut.unshift(wt)}else if("body"===nt.local){ut[0]instanceof u||B(st,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),null!==pt.body&&B(st,"Second <body> element at "+this.line+","+this.column+")");var Lt=new S;Lt.initFromNode(pt,nt,ct[0],st),pt.body=Lt,ut.unshift(Lt)}else if("div"===nt.local){ut[0]instanceof b||ut[0]instanceof S||B(st,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");var Ct=new b;Ct.initFromNode(pt,ut[0],nt,ct[0],st);var Pt=Ct.styleAttrs[at.byName.backgroundImage.qname];Pt&&(Ct.contents.push(new h(Pt)),delete Ct.styleAttrs[at.byName.backgroundImage.qname]),ut[0].contents.push(Ct),ut.unshift(Ct)}else if("image"===nt.local){ut[0]instanceof b||B(st,"Parent of <image> element is not <div> at "+this.line+","+this.column+")");var kt=new h;kt.initFromNode(pt,ut[0],nt,ct[0],st),ut[0].contents.push(kt),ut.unshift(kt)}else if("p"===nt.local){ut[0]instanceof b||B(st,"Parent of <p> element is not <div> at "+this.line+","+this.column+")");var Ot=new A;Ot.initFromNode(pt,ut[0],nt,ct[0],st),ut[0].contents.push(Ot),ut.unshift(Ot)}else if("span"===nt.local){ut[0]instanceof I||ut[0]instanceof A||B(st,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")");var Ft=new I;Ft.initFromNode(pt,ut[0],nt,ct[0],dt[0],st),ut[0].contents.push(Ft),ut.unshift(Ft)}else if("br"===nt.local){ut[0]instanceof I||ut[0]instanceof A||B(st,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")");var Bt=new w;Bt.initFromNode(pt,ut[0],nt,ct[0],st),ut[0].contents.push(Bt),ut.unshift(Bt)}else if("set"===nt.local){ut[0]instanceof I||ut[0]instanceof A||ut[0]instanceof b||ut[0]instanceof S||ut[0]instanceof N||ut[0]instanceof w||B(st,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")");var Ut=new C;Ut.initFromNode(pt,ut[0],nt,st),ut[0].sets.push(Ut),ut.unshift(Ut)}else ut.unshift(new s(nt));else ut.unshift(new s(nt));if(ut[0]instanceof s)if(nt.uri===it.ns_tt&&"metadata"===nt.local)ht++;else if(ht>0&&ot&&"onOpenTag"in ot){var Gt=[];for(var Ht in nt.attributes)Gt[nt.attributes[Ht].uri+" "+nt.attributes[Ht].local]={uri:nt.attributes[Ht].uri,local:nt.attributes[Ht].local,value:nt.attributes[Ht].value};ot.onOpenTag(nt.uri,nt.local,Gt)}},lt.write(nt).close(),delete pt.head.styling.styles;var _t=!1;for(var Et in pt.head.layout.regions)if(pt.head.layout.regions.hasOwnProperty(Et)){_t=!0;break}if(!_t){var St=N.prototype.createDefaultRegion(pt.lang);pt.head.layout.regions[St.id]=St}for(var wt in pt.head.layout.regions)pt.head.layout.regions.hasOwnProperty(wt)&&o(pt,pt.head.layout.regions[wt],null,null);return pt.body&&o(pt,pt.body,null,null),pt.body&&a(pt.body),pt},u.prototype.initFromNode=function(nt,rt,at){var ot=function(nt,rt){var at=P(nt,it.ns_ttp,"cellResolution"),st=15,ot=32;if(null!==at){var lt=/(\d+) (\d+)/.exec(at);null!==lt?(ot=parseInt(lt[1]),st=parseInt(lt[2])):U(rt,"Malformed cellResolution value (using initial value instead)")}return{w:ot,h:st}}(nt,at);this.cellLength={h:new st.ComputedLength(0,1/ot.h),w:new st.ComputedLength(1/ot.w,0)};var lt=function(nt,rt){var at,st=P(nt,it.ns_ttp,"frameRate"),ot=30;null!==st&&(null!==(at=/(\d+)/.exec(st))?ot=parseInt(at[1]):U(rt,"Malformed frame rate attribute (using initial value instead)"));var lt=P(nt,it.ns_ttp,"frameRateMultiplier"),ut=1;null!==lt&&(null!==(at=/(\d+) (\d+)/.exec(lt))?ut=parseInt(at[1])/parseInt(at[2]):U(rt,"Malformed frame rate multiplier attribute (using initial value instead)"));var ct=ut*ot,dt=1,ht=P(nt,it.ns_ttp,"tickRate");return null===ht?null!==st&&(dt=ct):null!==(at=/(\d+)/.exec(ht))?dt=parseInt(at[1]):U(rt,"Malformed tick rate attribute (using initial value instead)"),{effectiveFrameRate:ct,tickRate:dt}}(nt,at);this.effectiveFrameRate=lt.effectiveFrameRate,this.tickRate=lt.tickRate,this.aspectRatio=function(nt,rt){var at=P(nt,it.ns_ittp,"aspectRatio");null===at&&(at=P(nt,it.ns_ttp,"displayAspectRatio"));var st=null;if(null!==at){var ot=/(\d+)\s+(\d+)/.exec(at);if(null!==ot){var lt=parseInt(ot[1]),ut=parseInt(ot[2]);0!==lt&&0!==ut?st=lt/ut:Z(rt,"Illegal aspectRatio values (ignoring)")}else Z(rt,"Malformed aspectRatio attribute (ignoring)")}return st}(nt,at);var ut=P(nt,it.ns_ttp,"timeBase");null!==ut&&"media"!==ut&&B(at,"Unsupported time base");var ct=function(nt,rt){var at=P(nt,it.ns_tts,"extent");if(null===at)return null;var ot=at.split(" ");if(2!==ot.length)return U(rt,"Malformed extent (ignoring)"),null;var lt=st.parseLength(ot[0]),ut=st.parseLength(ot[1]);return ut&&lt?{h:ut,w:lt}:(U(rt,"Malformed extent values (ignoring)"),null)}(nt,at);null===ct?this.pxLength={h:null,w:null}:("px"===ct.h.unit&&"px"===ct.w.unit||B(at,"Extent on TT must be in px or absent"),this.pxLength={h:new st.ComputedLength(0,1/ct.h.value),w:new st.ComputedLength(1/ct.w.value,0)}),this.dimensions={h:new st.ComputedLength(0,1),w:new st.ComputedLength(1,0)},this.lang=rt},u.prototype._registerEvent=function(nt){if(!(nt.end<=nt.begin)){var rt=G(this.events,nt.begin);if(rt.found||this.events.splice(rt.index,0,nt.begin),nt.end!==Number.POSITIVE_INFINITY){var it=G(this.events,nt.end);it.found||this.events.splice(it.index,0,nt.end)}}},u.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]},u.prototype.getMediaTimeEvents=function(){return this.events},f.prototype.initFromNode=function(nt,rt){this.id=D(nt),this.styleAttrs=M(nt,rt),this.styleRefs=O(nt)},d.prototype.initFromNode=function(nt,rt){for(var at in this.styleAttrs={},nt.attributes)if(nt.attributes[at].uri===it.ns_itts||nt.attributes[at].uri===it.ns_ebutts||nt.attributes[at].uri===it.ns_tts){var st=nt.attributes[at].uri+" "+nt.attributes[at].local;this.styleAttrs[st]=nt.attributes[at].value}},h.prototype.initFromNode=function(nt,rt,it,at,st){this.src="src"in it.attributes?it.attributes.src.value:null,this.src||Z(st,"Invalid image@src attribute"),this.type="type"in it.attributes?it.attributes.type.value:null,this.type||Z(st,"Invalid image@type attribute"),E.prototype.initFromNode.call(this,nt,rt,it,st),T.prototype.initFromNode.call(this,nt,rt,it,st),v.prototype.initFromNode.call(this,nt,rt,it,st),y.prototype.initFromNode.call(this,nt,rt,it,st),this.lang=at},m.prototype.initFromNode=function(nt,rt,it,at){this.id=D(it)},y.prototype.initFromNode=function(nt,rt,it,at){this.regionID=function(nt){return nt&&"region"in nt.attributes?nt.attributes.region.value:""}(it)},E.prototype.initFromNode=function(nt,rt,it,at){this.styleAttrs=M(it,at),null!==nt.head&&null!==nt.head.styling&&x(nt.head.styling,O(it),this.styleAttrs,at)},v.prototype.initFromNode=function(nt,rt,it,at){this.sets=[]},_.prototype.initFromNode=function(nt,rt,it,at){this.contents=[]},T.prototype.initFromNode=function(nt,rt,it,at){var st=function(nt,rt,it,at){var st=null;it&&"begin"in it.attributes&&null===(st=L(nt.tickRate,nt.effectiveFrameRate,it.attributes.begin.value))&&U(at,"Malformed begin value "+it.attributes.begin.value+" (using 0)");var ot=null;it&&"dur"in it.attributes&&null===(ot=L(nt.tickRate,nt.effectiveFrameRate,it.attributes.dur.value))&&U(at,"Malformed dur value "+it.attributes.dur.value+" (ignoring)");var lt=null;return it&&"end"in it.attributes&&null===(lt=L(nt.tickRate,nt.effectiveFrameRate,it.attributes.end.value))&&U(at,"Malformed end value (ignoring)"),{explicit_begin:st,explicit_end:lt,explicit_dur:ot}}(nt,0,it,at);this.explicit_begin=st.explicit_begin,this.explicit_end=st.explicit_end,this.explicit_dur=st.explicit_dur,this.timeContainer=function(nt,rt){var it=nt&&"timeContainer"in nt.attributes?nt.attributes.timeContainer.value:null;return it&&"par"!==it?"seq"===it?"seq":(Z(rt,"Illegal value of timeContainer (assuming 'par')"),"par"):"par"}(it,at)},S.prototype.initFromNode=function(nt,rt,it,at){E.prototype.initFromNode.call(this,nt,null,rt,at),T.prototype.initFromNode.call(this,nt,null,rt,at),v.prototype.initFromNode.call(this,nt,null,rt,at),y.prototype.initFromNode.call(this,nt,null,rt,at),_.prototype.initFromNode.call(this,nt,null,rt,at),this.lang=it},b.prototype.initFromNode=function(nt,rt,it,at,st){E.prototype.initFromNode.call(this,nt,rt,it,st),T.prototype.initFromNode.call(this,nt,rt,it,st),v.prototype.initFromNode.call(this,nt,rt,it,st),y.prototype.initFromNode.call(this,nt,rt,it,st),_.prototype.initFromNode.call(this,nt,rt,it,st),this.lang=at},A.prototype.initFromNode=function(nt,rt,it,at,st){E.prototype.initFromNode.call(this,nt,rt,it,st),T.prototype.initFromNode.call(this,nt,rt,it,st),v.prototype.initFromNode.call(this,nt,rt,it,st),y.prototype.initFromNode.call(this,nt,rt,it,st),_.prototype.initFromNode.call(this,nt,rt,it,st),this.lang=at},I.prototype.initFromNode=function(nt,rt,it,at,st,ot){E.prototype.initFromNode.call(this,nt,rt,it,ot),T.prototype.initFromNode.call(this,nt,rt,it,ot),v.prototype.initFromNode.call(this,nt,rt,it,ot),y.prototype.initFromNode.call(this,nt,rt,it,ot),_.prototype.initFromNode.call(this,nt,rt,it,ot),this.space=st,this.lang=at},R.prototype.initFromText=function(nt,rt,it,at,st,ot){T.prototype.initFromNode.call(this,nt,rt,null,ot),this.text=it,this.space=st,this.lang=at},w.prototype.initFromNode=function(nt,rt,it,at,st){y.prototype.initFromNode.call(this,nt,rt,it,st),T.prototype.initFromNode.call(this,nt,rt,it,st),this.lang=at},N.prototype.createDefaultRegion=function(nt){var rt=new N;return m.call(rt,""),E.call(rt,{}),v.call(rt,[]),T.call(rt,0,Number.POSITIVE_INFINITY,null),this.lang=nt,rt},N.prototype.initFromNode=function(nt,rt,it,at){m.prototype.initFromNode.call(this,nt,null,rt,at),T.prototype.initFromNode.call(this,nt,null,rt,at),v.prototype.initFromNode.call(this,nt,null,rt,at),this.styleAttrs=M(rt,at),this.styleRefs=O(rt),this.lang=it},C.prototype.initFromNode=function(nt,rt,it,at){T.prototype.initFromNode.call(this,nt,rt,it,at);var st=M(it,at);for(var ot in this.qname=null,this.value=null,st)if(st.hasOwnProperty(ot)){if(this.qname){Z(at,"More than one style specified on set");break}this.qname=ot,this.value=st[ot]}}}(rt,"undefined"==typeof sax?it(5378):sax,"undefined"==typeof imscNames?it(210):imscNames,"undefined"==typeof imscStyles?it(6811):imscStyles,"undefined"==typeof imscUtils?it(5926):imscUtils)},506:function(nt,rt,it){var at=/firefox/i.test(navigator.userAgent);!function(nt,rt,it){function i(nt,rt,ot,lt){var dt;if("region"===ot.kind)(dt=document.createElement("div")).style.position="absolute";else if("body"===ot.kind)dt=document.createElement("div");else if("div"===ot.kind)dt=document.createElement("div");else if("image"===ot.kind){if(dt=document.createElement("img"),null!==nt.imgResolver&&null!==ot.src){var pt=nt.imgResolver(ot.src,dt);pt&&(dt.src=pt),dt.height=nt.regionH,dt.width=nt.regionW}}else if("p"===ot.kind)dt=document.createElement("p");else if("span"===ot.kind)if("container"===ot.styleAttrs[it.byName.ruby.qname])dt=document.createElement("ruby"),nt.ruby=!0;else if("base"===ot.styleAttrs[it.byName.ruby.qname])dt=document.createElement("span");else if("text"===ot.styleAttrs[it.byName.ruby.qname])dt=document.createElement("rt");else if("baseContainer"===ot.styleAttrs[it.byName.ruby.qname])dt=document.createElement("rbc");else if("textContainer"===ot.styleAttrs[it.byName.ruby.qname])dt=document.createElement("rtc");else{if("delimiter"===ot.styleAttrs[it.byName.ruby.qname])return;dt=document.createElement("span")}else"br"===ot.kind&&(dt=document.createElement("br"));if(dt){if(ot.lang&&("region"!==ot.kind&&ot.lang===lt.lang||(dt.lang=ot.lang)),rt.appendChild(dt),dt.style.margin="0","region"===ot.kind){var _t=ot.styleAttrs[it.byName.writingMode.qname];"lrtb"===_t||"lr"===_t?(nt.ipd="lr",nt.bpd="tb"):"rltb"===_t||"rl"===_t?(nt.ipd="rl",nt.bpd="tb"):"tblr"===_t?(nt.ipd="tb",nt.bpd="lr"):"tbrl"!==_t&&"tb"!==_t||(nt.ipd="tb",nt.bpd="rl")}else if("p"===ot.kind&&"tb"===nt.bpd){var Et=ot.styleAttrs[it.byName.direction.qname];nt.ipd="ltr"===Et?"lr":"rl"}for(var St=0;St<st.length;St++){var wt=st[St],Lt=ot.styleAttrs[wt.qname];void 0!==Lt&&null!==wt.map&&wt.map(nt,dt,ot,Lt)}var Ct=dt,Pt=ot.styleAttrs[it.byName.linePadding.qname];if(Pt&&!Pt.isZero()){var kt=Pt.toUsedLength(nt.w,nt.h);if(kt>0){var Ot=Math.ceil(kt)+"px";"tb"===nt.bpd?(Ct.style.paddingLeft=Ot,Ct.style.paddingRight=Ot):(Ct.style.paddingTop=Ot,Ct.style.paddingBottom=Ot),nt.lp=Pt}}var Ft=ot.styleAttrs[it.byName.multiRowAlign.qname];if(Ft&&"auto"!==Ft){var Bt=document.createElement("span");Bt.style.display="inline-block",Bt.style.textAlign=Ft,dt.appendChild(Bt),Ct=Bt,nt.mra=Ft}var Ut=ot.styleAttrs[it.byName.rubyReserve.qname];if(Ut&&"none"!==Ut[0]&&(nt.rubyReserve=Ut),ot.styleAttrs[it.byName.fillLineGap.qname]&&(nt.flg=!0),"span"===ot.kind&&ot.text){var Gt=ot.styleAttrs[it.byName.textEmphasis.qname];if(Gt&&"none"!==Gt.style&&(nt.textEmphasis=!0),it.byName.textCombine.qname in ot.styleAttrs&&"all"===ot.styleAttrs[it.byName.textCombine.qname])dt.textContent=ot.text,dt._isd_element=ot,Gt&&c(nt,dt,0,Gt);else for(var Ht="",jt=0;jt<ot.text.length;jt++){Ht+=ot.text.charAt(jt);var Kt=ot.text.charCodeAt(jt);if(Kt<55296||Kt>56319||jt===ot.text.length-1){var $t=document.createElement("span");$t.textContent=Ht,Gt&&c(nt,$t,0,Gt),dt.appendChild($t),Ht="",$t._isd_element=ot}}}if("contents"in ot)for(var Yt=0;Yt<ot.contents.length;Yt++)i(nt,Ct,ot.contents[Yt],ot);var Wt=[];if("p"===ot.kind&&(l(nt,Ct,Wt,null),nt.rubyReserve&&(function(nt,rt){for(var it=0;it<nt.length;it++){var at,st,ot=document.createElement("ruby"),lt=document.createElement("span");lt.textContent="​",ot.appendChild(lt);var dt,ht=rt.rubyReserve[1].toUsedLength(rt.w,rt.h)+"px";"both"===rt.rubyReserve[0]||"outside"===rt.rubyReserve[0]&&1==nt.length?((at=document.createElement("rtc")).style[ct]=ut?"after":"under",at.textContent="​",at.style.fontSize=ht,(st=document.createElement("rtc")).style[ct]=ut?"before":"over",st.textContent="​",st.style.fontSize=ht,ot.appendChild(at),ot.appendChild(st)):((at=document.createElement("rtc")).textContent="​",at.style.fontSize=ht,dt="after"===rt.rubyReserve[0]||"outside"===rt.rubyReserve[0]&&it>0?ut?"after":"tb"===rt.bpd||"rl"===rt.bpd?"under":"over":ut?"before":"tb"===rt.bpd||"rl"===rt.bpd?"over":"under",at.style[ct]=dt,ot.appendChild(at));for(var pt=null,_t=0;_t<nt[it].rbc.length;_t++)if("ruby"===nt[it].rbc[_t].localName){pt=nt[it].rbc[_t];for(var Et=0;Et<pt.style.length;Et++)ot.style.setProperty(pt.style.item(Et),pt.style.getPropertyValue(pt.style.item(Et)));break}(pt=pt||nt[it].elements[0].node).parentElement.insertBefore(ot,pt)}}(Wt,nt),nt.rubyReserve=null),(nt.ruby||nt.rubyReserve)&&(function(nt,rt){for(var it=0;it<nt.length;it++)for(var at=0;at<nt[it].rbc.length;at++){var st;nt[it].rbc[at].style[ct]||(st=ut?0===it?"before":"after":"tb"===rt.bpd||"rl"===rt.bpd?0===it?"over":"under":0===it?"under":"over",nt[it].rbc[at].style[ct]=st)}}(Wt,nt),nt.ruby=null),nt.textEmphasis&&(function(nt,rt){for(var it=0;it<nt.length;it++)for(var at=0;at<nt[it].te.length;at++){var st;nt[it].te[at].style[ht]&&"none"!==nt[it].te[at].style[ht]||(st="tb"===rt.bpd?0===it?"left over":"left under":"rl"===rt.bpd?0===it?"right under":"left under":0===it?"left under":"right under",nt[it].te[at].style[ht]=st)}}(Wt,nt),nt.textEmphasis=null),nt.mra&&(function(nt){for(var rt=0;rt<nt.length-1;rt++){var it=nt[rt].elements.length;if(0!==it&&!1===nt[rt].br){var at=document.createElement("br"),st=nt[rt].elements[it-1].node;st.parentElement.insertBefore(at,st.nextSibling)}}}(Wt),nt.mra=null),nt.lp&&(function(nt,rt,it){if(null!==nt)for(var st=0;st<nt.length;st++){var ot=nt[st].elements.length,lt=Math.ceil(rt)+"px",ut="-"+Math.ceil(rt)+"px";if(0!==ot){var ct=nt[st].elements[nt[st].start_elem],dt=nt[st].elements[nt[st].end_elem];if(ct===dt){var ht=ct.node.getBoundingClientRect();if(0==ht.width||0==ht.height)continue}"lr"===it.ipd?(ct.node.style.marginLeft=ut,ct.node.style.paddingLeft=lt):"rl"===it.ipd?(ct.node.style.paddingRight=lt,ct.node.style.marginRight=ut):"tb"===it.ipd&&(ct.node.style.paddingTop=lt,ct.node.style.marginTop=ut),"lr"===it.ipd?(at||(dt.node.style.marginRight=ut),dt.node.style.paddingRight=lt):"rl"===it.ipd?(dt.node.style.paddingLeft=lt,at||(dt.node.style.marginLeft=ut)):"tb"===it.ipd&&(dt.node.style.paddingBottom=lt,dt.node.style.marginBottom=ut)}}}(Wt,nt.lp.toUsedLength(nt.w,nt.h),nt),nt.lp=null),function(nt,rt){for(var it=0;it<nt.length;it++)for(var at=nt[it],st=1;st<at.elements.length;){var ot=at.elements[st-1],lt=at.elements[st];o(ot.node,lt.node,rt)?at.elements.splice(st,1):st++}for(var ut,ct,dt=[],ht=0;ht<nt.length;ht++)for(var pt=0;pt<nt[ht].elements.length;pt++)(ct=a(ut=nt[ht].elements[pt].node,dt,!1))&&(ut.style.backgroundColor=ct);for(var _t=0;_t<dt.length;_t++)dt[_t].style.backgroundColor=""}(Wt,nt),nt.flg)){var Qt=u(Ct.getBoundingClientRect(),nt);!function(nt,rt,it,at){for(var st=Math.sign(it-rt),ot=0;ot<=nt.length;ot++){var lt,ut,ct,dt;if(lt=0===ot?Math.round(rt):ot===nt.length?Math.round(it):Math.round((nt[ot-1].after+nt[ot].before)/2),ot>0&&nt[ot-1])for(ct=0;ct<nt[ot-1].elements.length;ct++)ut=st*(lt-(dt=nt[ot-1].elements[ct]).after)+"px","lr"===at.bpd?dt.node.style.paddingRight=ut:"rl"===at.bpd?dt.node.style.paddingLeft=ut:"tb"===at.bpd&&(dt.node.style.paddingBottom=ut);if(ot<nt.length)for(ct=0;ct<nt[ot].elements.length;ct++)ut=st*((dt=nt[ot].elements[ct]).before-lt)+"px","lr"===at.bpd?dt.node.style.paddingLeft=ut:"rl"===at.bpd?dt.node.style.paddingRight=ut:"tb"===at.bpd&&(dt.node.style.paddingTop=ut)}}(Wt,Qt.before,Qt.after,nt),nt.flg=null}if("region"===ot.kind&&"tb"===nt.bpd&&nt.enableRollUp&&ot.contents.length>0&&"after"===ot.styleAttrs[it.byName.displayAlign.qname]){l(nt,Ct,Wt,null);var en=new s(""===ot.id?"_":ot.id,Wt);if(nt.currentISDState[en.id]=en,nt.previousISDState&&en.id in nt.previousISDState&&nt.previousISDState[en.id].plist.length>0&&en.plist.length>1&&en.plist[en.plist.length-2].text===nt.previousISDState[en.id].plist[nt.previousISDState[en.id].plist.length-1].text){var nn=dt.firstElementChild,an=en.plist[en.plist.length-1].after-en.plist[en.plist.length-1].before;nn.style.bottom="-"+an+"px",nn.style.transition="transform 0.4s",nn.style.position="relative",nn.style.transform="translateY(-"+an+"px)"}}}else v(nt.errorHandler,"Error processing ISD element kind: "+ot.kind)}function a(nt,rt,it){return nt.style.backgroundColor?(it&&!rt.includes(nt)&&rt.push(nt),nt.style.backgroundColor):"SPAN"===nt.parentElement.nodeName||"RUBY"===nt.parentElement.nodeName||"RBC"===nt.parentElement.nodeName||"RTC"===nt.parentElement.nodeName||"RT"===nt.parentElement.nodeName?a(nt.parentElement,rt,!0):void 0}function o(nt,rt,it){if("SPAN"===nt.tagName&&"SPAN"===rt.tagName&&nt._isd_element===rt._isd_element){if(!nt._isd_element)return v(it.errorHandler,"Internal error: HTML span is not linked to a source element; cannot merge spans."),!1;nt.textContent+=rt.textContent;for(var at=0;at<rt.style.length;at++){var st=rt.style[at];(st.indexOf("border")>=0||st.indexOf("padding")>=0||st.indexOf("margin")>=0)&&(nt.style[st]=rt.style[st])}return rt.parentElement.removeChild(rt),!0}return!1}function s(nt,rt){this.id=nt,this.plist=rt}function u(nt,rt){var it={before:null,after:null,start:null,end:null};return"tb"===rt.bpd?(it.before=nt.top,it.after=nt.bottom,"lr"===rt.ipd?(it.start=nt.left,it.end=nt.right):(it.start=nt.right,it.end=nt.left)):"lr"===rt.bpd?(it.before=nt.left,it.after=nt.right,it.start=nt.top,it.end=nt.bottom):"rl"===rt.bpd&&(it.before=nt.right,it.after=nt.left,it.start=nt.top,it.end=nt.bottom),it}function l(nt,rt,it,at){if("rt"!==rt.localName&&"rtc"!==rt.localName){var st,ot,lt,ut,ct=rt.style.backgroundColor||at;if(0===rt.childElementCount)if("span"===rt.localName||"rb"===rt.localName){var ht=u(rt.getBoundingClientRect(),nt);if(0!==it.length&&(st=ht.before,ot=ht.after,lt=it[it.length-1].before,ot<(ut=it[it.length-1].after)&&st>lt||ut<=ot&&lt>=st)){var pt=Math.sign(ht.after-ht.before),_t=Math.sign(ht.end-ht.start);pt*(ht.before-it[it.length-1].before)<0&&(it[it.length-1].before=ht.before),pt*(ht.after-it[it.length-1].after)>0&&(it[it.length-1].after=ht.after),_t*(ht.start-it[it.length-1].start)<0&&(it[it.length-1].start=ht.start,it[it.length-1].start_elem=it[it.length-1].elements.length),_t*(ht.end-it[it.length-1].end)>0&&(it[it.length-1].end=ht.end,it[it.length-1].end_elem=it[it.length-1].elements.length)}else it.push({before:ht.before,after:ht.after,start:ht.start,end:ht.end,start_elem:0,end_elem:0,elements:[],rbc:[],te:[],text:"",br:!1});it[it.length-1].text+=rt.textContent,it[it.length-1].elements.push({node:rt,bgcolor:ct,before:ht.before,after:ht.after})}else"br"===rt.localName&&0!==it.length&&(it[it.length-1].br=!0);else for(var Et=rt.firstChild;Et;)Et.nodeType===Node.ELEMENT_NODE&&(l(nt,Et,it,ct),"ruby"===Et.localName||"rtc"===Et.localName?it.length>0&&it[it.length-1].rbc.push(Et):"span"===Et.localName&&Et.style[dt]&&"none"!==Et.style[dt]&&it.length>0&&it[it.length-1].te.push(Et)),Et=Et.nextSibling}}function c(nt,rt,it,at){var st;"none"!==at.style&&("auto"===at.style?rt.style[dt]="filled":rt.style[dt]=at.style+" "+at.symbol,("before"===at.position||"after"===at.position)&&(st="tb"===nt.bpd?"before"===at.position?"left over":"left under":"rl"===nt.bpd?"before"===at.position?"right under":"left under":"before"===at.position?"left under":"right under",rt.style[ht]=st))}function f(nt,rt){this.qname=nt,this.map=rt}nt.render=function(nt,rt,it,at,st,ot,lt,ut,ct){var dt=at||rt.clientHeight,ht=st||rt.clientWidth;if(null!==nt.aspectRatio){var pt=dt*nt.aspectRatio;pt>ht?dt=Math.round(ht/nt.aspectRatio):ht=pt}var _t=document.createElement("div");_t.style.position="relative",_t.style.width=ht+"px",_t.style.height=dt+"px",_t.style.margin="auto",_t.style.top=0,_t.style.bottom=0,_t.style.left=0,_t.style.right=0,_t.style.zIndex=0;var Et={h:dt,w:ht,regionH:null,regionW:null,imgResolver:it,displayForcedOnlyMode:ot||!1,isd:nt,errorHandler:lt,previousISDState:ut,enableRollUp:ct||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null,ruby:null,textEmphasis:null,rubyReserve:null};if(rt.appendChild(_t),"contents"in nt)for(var St=0;St<nt.contents.length;St++)i(Et,_t,nt.contents[St],nt);return Et.currentISDState};for(var st=[new f("http://www.w3.org/ns/ttml#styling backgroundColor",(function(nt,rt,it,at){0!==at[3]&&(rt.style.backgroundColor="rgba("+at[0].toString()+","+at[1].toString()+","+at[2].toString()+","+(at[3]/255).toString()+")")})),new f("http://www.w3.org/ns/ttml#styling color",(function(nt,rt,it,at){rt.style.color="rgba("+at[0].toString()+","+at[1].toString()+","+at[2].toString()+","+(at[3]/255).toString()+")"})),new f("http://www.w3.org/ns/ttml#styling direction",(function(nt,rt,it,at){rt.style.direction=at})),new f("http://www.w3.org/ns/ttml#styling display",(function(nt,rt,it,at){})),new f("http://www.w3.org/ns/ttml#styling displayAlign",(function(nt,rt,it,at){rt.style.display="flex",rt.style.flexDirection="column","before"===at?rt.style.justifyContent="flex-start":"center"===at?rt.style.justifyContent="center":"after"===at&&(rt.style.justifyContent="flex-end")})),new f("http://www.w3.org/ns/ttml#styling extent",(function(nt,rt,it,at){nt.regionH=at.h.toUsedLength(nt.w,nt.h),nt.regionW=at.w.toUsedLength(nt.w,nt.h);var st=0,ot=0,lt=it.styleAttrs["http://www.w3.org/ns/ttml#styling padding"];lt&&(st=lt[0].toUsedLength(nt.w,nt.h)+lt[2].toUsedLength(nt.w,nt.h),ot=lt[1].toUsedLength(nt.w,nt.h)+lt[3].toUsedLength(nt.w,nt.h)),rt.style.height=nt.regionH-st+"px",rt.style.width=nt.regionW-ot+"px"})),new f("http://www.w3.org/ns/ttml#styling fontFamily",(function(nt,rt,it,at){for(var st=[],ot=0;ot<at.length;ot++)at[ot]=at[ot].trim(),"monospaceSerif"===at[ot]?(st.push("Courier New"),st.push('"Liberation Mono"'),st.push("Courier"),st.push("monospace")):"proportionalSansSerif"===at[ot]?(st.push("Arial"),st.push("Helvetica"),st.push('"Liberation Sans"'),st.push("sans-serif")):"monospace"===at[ot]?st.push("monospace"):"sansSerif"===at[ot]?st.push("sans-serif"):"serif"===at[ot]?st.push("serif"):"monospaceSansSerif"===at[ot]?(st.push("Consolas"),st.push("monospace")):"proportionalSerif"===at[ot]?st.push("serif"):st.push(at[ot]);if(st.length>0){for(var lt=[st[0]],ut=1;ut<st.length;ut++)-1==lt.indexOf(st[ut])&&lt.push(st[ut]);st=lt}rt.style.fontFamily=st.join(",")})),new f("http://www.w3.org/ns/ttml#styling shear",(function(nt,rt,it,at){if(0!==at){var st=-.9*at;"tb"===nt.bpd?rt.style.transform="skewX("+st+"deg)":rt.style.transform="skewY("+st+"deg)"}})),new f("http://www.w3.org/ns/ttml#styling fontSize",(function(nt,rt,it,at){rt.style.fontSize=at.toUsedLength(nt.w,nt.h)+"px"})),new f("http://www.w3.org/ns/ttml#styling fontStyle",(function(nt,rt,it,at){rt.style.fontStyle=at})),new f("http://www.w3.org/ns/ttml#styling fontWeight",(function(nt,rt,it,at){rt.style.fontWeight=at})),new f("http://www.w3.org/ns/ttml#styling lineHeight",(function(nt,rt,it,at){rt.style.lineHeight="normal"===at?"normal":at.toUsedLength(nt.w,nt.h)+"px"})),new f("http://www.w3.org/ns/ttml#styling opacity",(function(nt,rt,it,at){rt.style.opacity=at})),new f("http://www.w3.org/ns/ttml#styling origin",(function(nt,rt,it,at){rt.style.top=at.h.toUsedLength(nt.w,nt.h)+"px",rt.style.left=at.w.toUsedLength(nt.w,nt.h)+"px"})),new f("http://www.w3.org/ns/ttml#styling overflow",(function(nt,rt,it,at){rt.style.overflow=at})),new f("http://www.w3.org/ns/ttml#styling padding",(function(nt,rt,it,at){var st=[];st[0]=at[0].toUsedLength(nt.w,nt.h)+"px",st[1]=at[3].toUsedLength(nt.w,nt.h)+"px",st[2]=at[2].toUsedLength(nt.w,nt.h)+"px",st[3]=at[1].toUsedLength(nt.w,nt.h)+"px",rt.style.padding=st.join(" ")})),new f("http://www.w3.org/ns/ttml#styling position",(function(nt,rt,it,at){rt.style.top=at.h.toUsedLength(nt.w,nt.h)+"px",rt.style.left=at.w.toUsedLength(nt.w,nt.h)+"px"})),new f("http://www.w3.org/ns/ttml#styling rubyAlign",(function(nt,rt,it,at){rt.style.rubyAlign="spaceAround"===at?"space-around":"center"})),new f("http://www.w3.org/ns/ttml#styling rubyPosition",(function(nt,rt,it,at){var st;"before"!==at&&"after"!==at||(st=ut?at:"tb"===nt.bpd||"rl"===nt.bpd?"before"===at?"over":"under":"before"===at?"under":"over",rt.parentElement.style[ct]=st)})),new f("http://www.w3.org/ns/ttml#styling showBackground",null),new f("http://www.w3.org/ns/ttml#styling textAlign",(function(nt,rt,it,at){var st;st="start"===at?"rl"===nt.ipd?"right":"left":"end"===at?"rl"===nt.ipd?"left":"right":at,rt.style.textAlign=st})),new f("http://www.w3.org/ns/ttml#styling textDecoration",(function(nt,rt,it,at){rt.style.textDecoration=at.join(" ").replace("lineThrough","line-through")})),new f("http://www.w3.org/ns/ttml#styling textOutline",(function(nt,rt,it,at){})),new f("http://www.w3.org/ns/ttml#styling textShadow",(function(nt,rt,at,st){var ot=at.styleAttrs[it.byName.textOutline.qname];if("none"===st&&"none"===ot)rt.style.textShadow="";else{var lt=[];if("none"!==ot){var ut="rgba("+ot.color[0].toString()+","+ot.color[1].toString()+","+ot.color[2].toString()+","+(ot.color[3]/255).toString()+")";lt.push("1px 1px 1px "+ut),lt.push("-1px 1px 1px "+ut),lt.push("1px -1px 1px "+ut),lt.push("-1px -1px 1px "+ut)}if("none"!==st)for(var ct=0;ct<st.length;ct++)lt.push(st[ct].x_off.toUsedLength(nt.w,nt.h)+"px "+st[ct].y_off.toUsedLength(nt.w,nt.h)+"px "+st[ct].b_radius.toUsedLength(nt.w,nt.h)+"px rgba("+st[ct].color[0].toString()+","+st[ct].color[1].toString()+","+st[ct].color[2].toString()+","+(st[ct].color[3]/255).toString()+")");rt.style.textShadow=lt.join(",")}})),new f("http://www.w3.org/ns/ttml#styling textCombine",(function(nt,rt,it,at){rt.style.textCombineUpright=at})),new f("http://www.w3.org/ns/ttml#styling textEmphasis",(function(nt,rt,it,at){})),new f("http://www.w3.org/ns/ttml#styling unicodeBidi",(function(nt,rt,it,at){var st;st="bidiOverride"===at?"bidi-override":at,rt.style.unicodeBidi=st})),new f("http://www.w3.org/ns/ttml#styling visibility",(function(nt,rt,it,at){rt.style.visibility=at})),new f("http://www.w3.org/ns/ttml#styling wrapOption",(function(nt,rt,it,at){"wrap"===at?"preserve"===it.space?rt.style.whiteSpace="pre-wrap":rt.style.whiteSpace="normal":"preserve"===it.space?rt.style.whiteSpace="pre":rt.style.whiteSpace="noWrap"})),new f("http://www.w3.org/ns/ttml#styling writingMode",(function(nt,rt,it,at){"lrtb"===at||"lr"===at||"rltb"===at||"rl"===at?rt.style.writingMode="horizontal-tb":"tblr"===at?rt.style.writingMode="vertical-lr":"tbrl"!==at&&"tb"!==at||(rt.style.writingMode="vertical-rl")})),new f("http://www.w3.org/ns/ttml#styling zIndex",(function(nt,rt,it,at){rt.style.zIndex=at})),new f("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",(function(nt,rt,it,at){nt.displayForcedOnlyMode&&!1===at&&(rt.style.visibility="hidden")}))],ot={},lt=0;lt<st.length;lt++)ot[st[lt].qname]=st[lt];var ut="webkitRubyPosition"in window.getComputedStyle(document.documentElement),ct=ut?"webkitRubyPosition":"rubyPosition",dt="webkitTextEmphasisStyle"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisStyle":"textEmphasisStyle",ht="webkitTextEmphasisPosition"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisPosition":"textEmphasisPosition";function v(nt,rt){if(nt&&nt.error&&nt.error(rt))throw rt}}(rt,"undefined"==typeof imscNames?it(210):imscNames,"undefined"==typeof imscStyles?it(6811):imscStyles,"undefined"==typeof imscUtils?it(5926):imscUtils)},4080:function(nt,rt,it){!function(nt,rt,it,at){nt.generateISD=function(nt,rt,at){var st,ot=new u(nt),lt={},ut={},ct=nt.head.styling.initials[it.byName.showBackground.qname],dt=nt.head.styling.initials[it.byName.backgroundColor.qname];for(var ht in nt.head.layout.regions)if(nt.head.layout.regions.hasOwnProperty(ht)){var pt=nt.head.layout.regions[ht],_t=pt.styleAttrs[it.byName.showBackground.qname]||ct,Et=pt.styleAttrs[it.byName.backgroundColor.qname]||dt;ut[pt.id]=("always"===_t||void 0===_t)&&void 0!==Et&&!(rt<pt.begin||rt>=pt.end)}for(var St in nt.body&&nt.body.regionID&&(ut[nt.body.regionID]=!0),st=null!==nt.body?function e(nt,rt){if(rt.contents){var it={};for(var at in rt)rt.hasOwnProperty(at)&&(it[at]=rt[at]);return it.contents=[],rt.contents.filter((function(rt){return!(nt<rt.begin||nt>=rt.end)})).forEach((function(rt){var at=e(nt,rt);at.regionID&&(ut[at.regionID]=!0),null!==at&&it.contents.push(at)})),it}return rt}(rt,nt.body):null,void 0!==ut[""]&&(ut[""]=!0),ut)if(ut[St]){var wt=a(nt,rt,nt.head.layout.regions[St],st,null,"",nt.head.layout.regions[St],at,lt);null!==wt&&ot.contents.push(wt.element)}return ot};var st=[it.byName.color.qname,it.byName.textCombine.qname,it.byName.textDecoration.qname,it.byName.textEmphasis.qname,it.byName.textOutline.qname,it.byName.textShadow.qname];function a(nt,rt,ot,lt,ut,ct,dt,ht,pt){if(rt<dt.begin||rt>=dt.end)return null;var _t="regionID"in dt&&""!==dt.regionID?dt.regionID:ct;if(null!==ut&&_t!==ot.id&&(!("contents"in dt)||"contents"in dt&&0===dt.contents.length||""!==_t))return null;var Et=new l(dt);if("sets"in dt)for(var St=0;St<dt.sets.length;St++)rt<dt.sets[St].begin||rt>=dt.sets[St].end||(Et.styleAttrs[dt.sets[St].qname]=dt.sets[St].value);var wt={};for(var Lt in Et.styleAttrs)if(Et.styleAttrs.hasOwnProperty(Lt)&&(wt[Lt]=!0,"region"===Et.kind&&Lt===it.byName.writingMode.qname&&!(it.byName.direction.qname in Et.styleAttrs))){var Ct=Et.styleAttrs[Lt];"lrtb"===Ct||"lr"===Ct?Et.styleAttrs[it.byName.direction.qname]="ltr":"rltb"!==Ct&&"rl"!==Ct||(Et.styleAttrs[it.byName.direction.qname]="rtl")}if(null!==ut)for(var Pt=0;Pt<it.all.length;Pt++){var kt=it.all[Pt];if(kt.qname===it.byName.textDecoration.qname){var Ot=ut.styleAttrs[kt.qname],Ft=Et.styleAttrs[kt.qname],Bt=[];void 0===Ft?Bt=Ot:-1===Ft.indexOf("none")?((-1===Ft.indexOf("noUnderline")&&-1!==Ot.indexOf("underline")||-1!==Ft.indexOf("underline"))&&Bt.push("underline"),(-1===Ft.indexOf("noLineThrough")&&-1!==Ot.indexOf("lineThrough")||-1!==Ft.indexOf("lineThrough"))&&Bt.push("lineThrough"),(-1===Ft.indexOf("noOverline")&&-1!==Ot.indexOf("overline")||-1!==Ft.indexOf("overline"))&&Bt.push("overline")):Bt.push("none"),Et.styleAttrs[kt.qname]=Bt}else if(kt.qname!==it.byName.fontSize.qname||kt.qname in Et.styleAttrs||"span"!==Et.kind||"textContainer"!==Et.styleAttrs[it.byName.ruby.qname])if(kt.qname!==it.byName.fontSize.qname||kt.qname in Et.styleAttrs||"span"!==Et.kind||"text"!==Et.styleAttrs[it.byName.ruby.qname])kt.inherit&&kt.qname in ut.styleAttrs&&!(kt.qname in Et.styleAttrs)&&(Et.styleAttrs[kt.qname]=ut.styleAttrs[kt.qname]);else{var Ut=ut.styleAttrs[it.byName.fontSize.qname];"textContainer"===ut.styleAttrs[it.byName.ruby.qname]?Et.styleAttrs[kt.qname]=Ut:Et.styleAttrs[kt.qname]=new at.ComputedLength(.5*Ut.rw,.5*Ut.rh)}else{var Gt=ut.styleAttrs[it.byName.fontSize.qname];Et.styleAttrs[kt.qname]=new at.ComputedLength(.5*Gt.rw,.5*Gt.rh)}}for(var Ht=0;Ht<it.all.length;Ht++){var jt=it.all[Ht];if(!(jt.qname in Et.styleAttrs)&&!(jt.qname===it.byName.position.qname&&it.byName.origin.qname in Et.styleAttrs||jt.qname===it.byName.origin.qname&&it.byName.position.qname in Et.styleAttrs)){var Kt=nt.head.styling.initials[jt.qname]||jt.initial;if(null!==Kt&&("region"===Et.kind||!1===jt.inherit&&null!==Kt)){var $t=jt.parse(Kt);null!==$t?(Et.styleAttrs[jt.qname]=$t,wt[jt.qname]=!0):c(ht,"Invalid initial value for '"+jt.qname+"' on element '"+Et.kind)}}}for(var Yt=0;Yt<it.all.length;Yt++){var Wt=it.all[Yt];if(Wt.qname in wt&&null!==Wt.compute){var Qt=Wt.compute(nt,ut,Et,Et.styleAttrs[Wt.qname],pt);null!==Qt?Et.styleAttrs[Wt.qname]=Qt:(Et.styleAttrs[Wt.qname]=Wt.compute(nt,ut,Et,Wt.parse(Wt.initial),pt),c(ht,"Style '"+Wt.qname+"' on element '"+Et.kind+"' cannot be computed"))}}if("none"===Et.styleAttrs[it.byName.display.qname])return null;var en=null;null===ut?en=null===lt?[]:[lt]:"contents"in dt&&(en=dt.contents);for(var nn=0;null!==en&&nn<en.length;nn++){var an=a(nt,rt,ot,lt,Et,_t,en[nn],ht,pt);null!==an&&Et.contents.push(an.element)}for(var ln in Et.styleAttrs)if(Et.styleAttrs.hasOwnProperty(ln)){var hn=!1;if("span"===Et.kind){var fn=Et.styleAttrs[it.byName.ruby.qname];(hn=("container"===fn||"textContainer"===fn||"baseContainer"===fn)&&-1!==st.indexOf(ln))||(hn="container"!==fn&&ln===it.byName.rubyAlign.qname),hn||(hn=!("textContainer"===fn||"text"===fn)&&ln===it.byName.rubyPosition.qname)}if(!hn){var pn=it.byQName[ln];"applies"in pn&&(hn=-1===pn.applies.indexOf(Et.kind))}hn&&delete Et.styleAttrs[ln]}var mn=Et.styleAttrs[it.byName.ruby.qname];if("p"===Et.kind||"span"===Et.kind&&("textContainer"===mn||"text"===mn)){var gn=[];o(Et,gn),function(nt){for(var rt,it=0;it<nt.length;)if("br"!==(rt=nt[it]).kind&&"preserve"!==rt.space){var at=rt.text.replace(/[\t\r\n ]+/g," ");/^[ ]/.test(at)&&(0===it||"br"===(st=nt[it-1]).kind||/[\r\n\t ]$/.test(st.text))&&(at=at.substring(1)),rt.text=at,0===at.length?nt.splice(it,1):it++}else it++;var st,ot;for(it=0;it<nt.length;it++)"br"!==(rt=nt[it]).kind&&"preserve"!==rt.space?/[ ]$/.test(rt.text)&&(it===nt.length-1||"br"===(ot=nt[it+1]).kind||"preserve"===ot.space&&/^[\r\n]/.test(ot.text))&&(rt.text=rt.text.slice(0,-1)):it++}(gn),s(Et)}return"div"===Et.kind&&it.byName.backgroundImage.qname in Et.styleAttrs||"br"===Et.kind||"image"===Et.kind||"contents"in Et&&Et.contents.length>0||"span"===Et.kind&&null!==Et.text||"region"===Et.kind&&"always"===Et.styleAttrs[it.byName.showBackground.qname]?{region_id:_t,element:Et}:null}function o(nt,rt){if("contents"in nt)for(var at=0;at<nt.contents.length;at++){var st=nt.contents[at],ot=st.styleAttrs[it.byName.ruby.qname];("span"!==st.kind||"textContainer"!==ot&&"text"!==ot)&&("contents"in st?o(st,rt):("span"===st.kind&&0!==st.text.length||"br"===st.kind)&&rt.push(st))}}function s(nt){if("br"===nt.kind)return!1;if("text"in nt)return 0===nt.text.length;if("contents"in nt){for(var rt=nt.contents.length;rt--;)s(nt.contents[rt])&&nt.contents.splice(rt,1);return 0===nt.contents.length}}function u(nt){this.contents=[],this.aspectRatio=nt.aspectRatio,this.lang=nt.lang}function l(nt){for(var rt in this.kind=nt.kind||"region",this.lang=nt.lang,nt.id&&(this.id=nt.id),this.styleAttrs={},nt.styleAttrs)nt.styleAttrs.hasOwnProperty(rt)&&(this.styleAttrs[rt]=nt.styleAttrs[rt]);"src"in nt&&(this.src=nt.src),"type"in nt&&(this.type=nt.type),"text"in nt?this.text=nt.text:("region"===this.kind||"contents"in nt)&&(this.contents=[]),"space"in nt&&(this.space=nt.space)}function c(nt,rt){if(nt&&nt.error&&nt.error(rt))throw rt}}(rt,"undefined"==typeof imscNames?it(210):imscNames,"undefined"==typeof imscStyles?it(6811):imscStyles,"undefined"==typeof imscUtils?it(5926):imscUtils)},4403:function(nt,rt,it){rt.generateISD=it(4080).generateISD,rt.fromXML=it(3362).fromXML,rt.renderHTML=it(506).render},210:function(nt,rt){!function(nt){nt.ns_tt="http://www.w3.org/ns/ttml",nt.ns_tts="http://www.w3.org/ns/ttml#styling",nt.ns_ttp="http://www.w3.org/ns/ttml#parameter",nt.ns_xml="http://www.w3.org/XML/1998/namespace",nt.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling",nt.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter",nt.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",nt.ns_ebutts="urn:ebu:tt:style"}(rt)},6811:function(nt,rt,it){!function(nt,rt,it){function r(nt,rt,it,at,st,ot,lt,ut){this.name=rt,this.ns=nt,this.qname=nt+" "+rt,this.inherit=st,this.animatable=ot,this.initial=it,this.applies=at,this.parse=lt,this.compute=ut}for(var at in nt.all=[new r(rt.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,it.parseColor,null),new r(rt.ns_tts,"color","white",["span"],!0,!0,it.parseColor,null),new r(rt.ns_tts,"direction","ltr",["p","span"],!0,!0,(function(nt){return nt}),null),new r(rt.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,(function(nt){return nt}),null),new r(rt.ns_tts,"displayAlign","before",["region"],!1,!0,(function(nt){return nt}),null),new r(rt.ns_tts,"extent","auto",["tt","region"],!1,!0,(function(nt){if("auto"===nt)return nt;var rt=nt.split(" ");if(2!==rt.length)return null;var at=it.parseLength(rt[0]),st=it.parseLength(rt[1]);return st&&at?{h:st,w:at}:null}),(function(nt,rt,at,st,ot){var lt,ut;if("auto"===st)lt=new it.ComputedLength(0,1);else if(null===(lt=it.toComputedLength(st.h.value,st.h.unit,null,nt.dimensions.h,null,nt.pxLength.h)))return null;if("auto"===st)ut=new it.ComputedLength(1,0);else if(null===(ut=it.toComputedLength(st.w.value,st.w.unit,null,nt.dimensions.w,null,nt.pxLength.w)))return null;return{h:lt,w:ut}})),new r(rt.ns_tts,"fontFamily","default",["span","p"],!0,!0,(function(nt){for(var rt=nt.split(","),it=[],at=0;at<rt.length;at++)rt[at]=rt[at].trim(),"'"!==rt[at].charAt(0)&&'"'!==rt[at].charAt(0)&&"default"===rt[at]?it.push("monospaceSerif"):it.push(rt[at]);return it}),null),new r(rt.ns_tts,"shear","0%",["p"],!0,!0,it.parseLength,(function(nt,rt,it,at){return"%"!==at.unit?null:Math.abs(at.value)>100?100*Math.sign(at.value):at.value})),new r(rt.ns_tts,"fontSize","1c",["span","p"],!0,!0,it.parseLength,(function(rt,at,st,ot,lt){return it.toComputedLength(ot.value,ot.unit,null!==at?at.styleAttrs[nt.byName.fontSize.qname]:rt.cellLength.h,null!==at?at.styleAttrs[nt.byName.fontSize.qname]:rt.cellLength.h,rt.cellLength.h,rt.pxLength.h)})),new r(rt.ns_tts,"fontStyle","normal",["span","p"],!0,!0,(function(nt){return nt}),null),new r(rt.ns_tts,"fontWeight","normal",["span","p"],!0,!0,(function(nt){return nt}),null),new r(rt.ns_tts,"lineHeight","normal",["p"],!0,!0,(function(nt){return"normal"===nt?nt:it.parseLength(nt)}),(function(rt,at,st,ot,lt){var ut;if("normal"===ot)ut=ot;else if(null===(ut=it.toComputedLength(ot.value,ot.unit,st.styleAttrs[nt.byName.fontSize.qname],st.styleAttrs[nt.byName.fontSize.qname],rt.cellLength.h,rt.pxLength.h)))return null;return ut})),new r(rt.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new r(rt.ns_tts,"origin","auto",["region"],!1,!0,(function(nt){if("auto"===nt)return nt;var rt=nt.split(" ");if(2!==rt.length)return null;var at=it.parseLength(rt[0]),st=it.parseLength(rt[1]);return st&&at?{h:st,w:at}:null}),(function(nt,rt,at,st,ot){var lt,ut;if("auto"===st)lt=new it.ComputedLength(0,0);else if(null===(lt=it.toComputedLength(st.h.value,st.h.unit,null,nt.dimensions.h,null,nt.pxLength.h)))return null;if("auto"===st)ut=new it.ComputedLength(0,0);else if(null===(ut=it.toComputedLength(st.w.value,st.w.unit,null,nt.dimensions.w,null,nt.pxLength.w)))return null;return{h:lt,w:ut}})),new r(rt.ns_tts,"overflow","hidden",["region"],!1,!0,(function(nt){return nt}),null),new r(rt.ns_tts,"padding","0px",["region"],!1,!0,(function(nt){var rt=nt.split(" ");if(rt.length>4)return null;for(var at=[],st=0;st<rt.length;st++){var ot=it.parseLength(rt[st]);if(!ot)return null;at.push(ot)}return at}),(function(rt,at,st,ot,lt){var ut;if(1===ot.length)ut=[ot[0],ot[0],ot[0],ot[0]];else if(2===ot.length)ut=[ot[0],ot[1],ot[0],ot[1]];else if(3===ot.length)ut=[ot[0],ot[1],ot[2],ot[1]];else{if(4!==ot.length)return null;ut=[ot[0],ot[1],ot[2],ot[3]]}var ct=st.styleAttrs[nt.byName.writingMode.qname];if("lrtb"===ct||"lr"===ct)ut=[ut[0],ut[3],ut[2],ut[1]];else if("rltb"===ct||"rl"===ct)ut=[ut[0],ut[1],ut[2],ut[3]];else if("tblr"===ct)ut=[ut[3],ut[0],ut[1],ut[2]];else{if("tbrl"!==ct&&"tb"!==ct)return null;ut=[ut[3],ut[2],ut[1],ut[0]]}for(var dt=[],ht=0;ht<ut.length;ht++)if(0===ut[ht].value)dt[ht]=new it.ComputedLength(0,0);else if(dt[ht]=it.toComputedLength(ut[ht].value,ut[ht].unit,st.styleAttrs[nt.byName.fontSize.qname],0===ht||2===ht?st.styleAttrs[nt.byName.extent.qname].h:st.styleAttrs[nt.byName.extent.qname].w,0===ht||2===ht?rt.cellLength.h:rt.cellLength.w,0===ht||2===ht?rt.pxLength.h:rt.pxLength.w),null===dt[ht])return null;return dt})),new r(rt.ns_tts,"position","top left",["region"],!1,!0,(function(nt){return it.parsePosition(nt)}),(function(rt,at,st,ot){var lt,ut;return null===(lt=it.toComputedLength(ot.v.offset.value,ot.v.offset.unit,null,new it.ComputedLength(-st.styleAttrs[nt.byName.extent.qname].h.rw,rt.dimensions.h.rh-st.styleAttrs[nt.byName.extent.qname].h.rh),null,rt.pxLength.h))?null:("bottom"===ot.v.edge&&(lt=new it.ComputedLength(-lt.rw-st.styleAttrs[nt.byName.extent.qname].h.rw,rt.dimensions.h.rh-lt.rh-st.styleAttrs[nt.byName.extent.qname].h.rh)),ut=it.toComputedLength(ot.h.offset.value,ot.h.offset.unit,null,new it.ComputedLength(rt.dimensions.w.rw-st.styleAttrs[nt.byName.extent.qname].w.rw,-st.styleAttrs[nt.byName.extent.qname].w.rh),null,rt.pxLength.w),null===lt?null:("right"===ot.h.edge&&(ut=new it.ComputedLength(rt.dimensions.w.rw-ut.rw-st.styleAttrs[nt.byName.extent.qname].w.rw,-ut.rh-st.styleAttrs[nt.byName.extent.qname].w.rh)),{h:lt,w:ut}))})),new r(rt.ns_tts,"ruby","none",["span"],!1,!0,(function(nt){return nt}),null),new r(rt.ns_tts,"rubyAlign","center",["span"],!0,!0,(function(nt){return"center"!==nt&&"spaceAround"!==nt?null:nt}),null),new r(rt.ns_tts,"rubyPosition","outside",["span"],!0,!0,(function(nt){return nt}),null),new r(rt.ns_tts,"rubyReserve","none",["p"],!0,!0,(function(nt){var rt=nt.split(" "),at=[null,null];if(0===rt.length||rt.length>2)return null;if("none"!==rt[0]&&"both"!==rt[0]&&"after"!==rt[0]&&"before"!==rt[0]&&"outside"!==rt[0])return null;if(at[0]=rt[0],2===rt.length&&"none"!==rt[0]){var st=it.parseLength(rt[1]);if(!st)return null;at[1]=st}return at}),(function(rt,at,st,ot,lt){return"none"===ot[0]?ot:null===(ut=null===ot[1]?new it.ComputedLength(.5*st.styleAttrs[nt.byName.fontSize.qname].rw,.5*st.styleAttrs[nt.byName.fontSize.qname].rh):it.toComputedLength(ot[1].value,ot[1].unit,st.styleAttrs[nt.byName.fontSize.qname],st.styleAttrs[nt.byName.fontSize.qname],rt.cellLength.h,rt.pxLength.h))?null:[ot[0],ut];var ut})),new r(rt.ns_tts,"showBackground","always",["region"],!1,!0,(function(nt){return nt}),null),new r(rt.ns_tts,"textAlign","start",["p"],!0,!0,(function(nt){return nt}),(function(nt,rt,it,at,st){return"left"===at?"start":"right"===at?"end":at})),new r(rt.ns_tts,"textCombine","none",["span"],!0,!0,(function(nt){return"none"===nt||"all"===nt?nt:null}),null),new r(rt.ns_tts,"textDecoration","none",["span"],!0,!0,(function(nt){return nt.split(" ")}),null),new r(rt.ns_tts,"textEmphasis","none",["span"],!0,!0,(function(nt){for(var rt=nt.split(" "),at={style:null,symbol:null,color:null,position:null},st=0;st<rt.length;st++)if("none"===rt[st]||"auto"===rt[st])at.style=rt[st];else if("filled"===rt[st]||"open"===rt[st])at.style=rt[st];else if("circle"===rt[st]||"dot"===rt[st]||"sesame"===rt[st])at.symbol=rt[st];else if("current"===rt[st])at.color=rt[st];else if("outside"===rt[st]||"before"===rt[st]||"after"===rt[st])at.position=rt[st];else if(at.color=it.parseColor(rt[st]),null===at.color)return null;return null==at.style&&null==at.symbol?at.style="auto":(at.symbol=at.symbol||"circle",at.style=at.style||"filled"),at.position=at.position||"outside",at.color=at.color||"current",at}),null),new r(rt.ns_tts,"textOutline","none",["span"],!0,!0,(function(nt){if("none"===nt)return nt;var rt={},at=nt.split(" ");if(0===at.length||at.length>2)return null;var st=it.parseColor(at[0]);if(rt.color=st,null!==st&&at.shift(),1!==at.length)return null;var ot=it.parseLength(at[0]);return ot?(rt.thickness=ot,rt):null}),(function(rt,at,st,ot,lt){if("none"===ot)return ot;var ut={};return null===ot.color?ut.color=st.styleAttrs[nt.byName.color.qname]:ut.color=ot.color,ut.thickness=it.toComputedLength(ot.thickness.value,ot.thickness.unit,st.styleAttrs[nt.byName.fontSize.qname],st.styleAttrs[nt.byName.fontSize.qname],rt.cellLength.h,rt.pxLength.h),null===ut.thickness?null:ut})),new r(rt.ns_tts,"textShadow","none",["span"],!0,!0,it.parseTextShadow,(function(rt,at,st,ot){if("none"===ot)return ot;for(var lt=[],ut=0;ut<ot.length;ut++){var ct={};if(ct.x_off=it.toComputedLength(ot[ut][0].value,ot[ut][0].unit,null,st.styleAttrs[nt.byName.fontSize.qname],null,rt.pxLength.w),null===ct.x_off)return null;if(ct.y_off=it.toComputedLength(ot[ut][1].value,ot[ut][1].unit,null,st.styleAttrs[nt.byName.fontSize.qname],null,rt.pxLength.h),null===ct.y_off)return null;if(null===ot[ut][2])ct.b_radius=0;else if(ct.b_radius=it.toComputedLength(ot[ut][2].value,ot[ut][2].unit,null,st.styleAttrs[nt.byName.fontSize.qname],null,rt.pxLength.h),null===ct.b_radius)return null;null===ot[ut][3]?ct.color=st.styleAttrs[nt.byName.color.qname]:ct.color=ot[ut][3],lt.push(ct)}return lt})),new r(rt.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,(function(nt){return nt}),null),new r(rt.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,(function(nt){return nt}),null),new r(rt.ns_tts,"wrapOption","wrap",["span"],!0,!0,(function(nt){return nt}),null),new r(rt.ns_tts,"writingMode","lrtb",["region"],!1,!0,(function(nt){return nt}),null),new r(rt.ns_tts,"zIndex","auto",["region"],!1,!0,(function(nt){var rt;return"auto"===nt?rt=nt:(rt=parseInt(nt),isNaN(rt)&&(rt=null)),rt}),null),new r(rt.ns_ebutts,"linePadding","0c",["p"],!0,!1,it.parseLength,(function(nt,rt,at,st,ot){return it.toComputedLength(st.value,st.unit,null,null,nt.cellLength.w,null)})),new r(rt.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,(function(nt){return nt}),null),new r(rt.ns_smpte,"backgroundImage",null,["div"],!1,!1,(function(nt){return nt}),null),new r(rt.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,(function(nt){return"true"===nt}),null),new r(rt.ns_itts,"fillLineGap","false",["p"],!0,!0,(function(nt){return"true"===nt}),null)],nt.byQName={},nt.all)nt.byQName[nt.all[at].qname]=nt.all[at];for(var st in nt.byName={},nt.all)nt.byName[nt.all[st].name]=nt.all[st]}(rt,"undefined"==typeof imscNames?it(210):imscNames,"undefined"==typeof imscUtils?it(5926):imscUtils)},5926:function(nt,rt){!function(nt){var rt=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,it=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,at=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,st={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};nt.parseColor=function(nt){var ot,lt=null,ut=st[nt.toLowerCase()];return void 0!==ut?lt=ut:null!==(ot=rt.exec(nt))?lt=[parseInt(ot[1],16),parseInt(ot[2],16),parseInt(ot[3],16),void 0!==ot[4]?parseInt(ot[4],16):255]:null!==(ot=it.exec(nt))?lt=[parseInt(ot[1]),parseInt(ot[2]),parseInt(ot[3]),255]:null!==(ot=at.exec(nt))&&(lt=[parseInt(ot[1]),parseInt(ot[2]),parseInt(ot[3]),parseInt(ot[4])]),lt};var ot=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/;nt.parseLength=function(nt){var rt,it=null;return null!==(rt=ot.exec(nt))&&(it={value:parseFloat(rt[1]),unit:rt[2]}),it},nt.parseTextShadow=function(rt){for(var it=rt.match(/([^\(,\)]|\([^\)]+\))+/g),at=[],st=0;st<it.length;st++){var ot=it[st].split(" ");if(1===ot.length&&"none"===ot[0])return"none";if(ot.length>1&&ot.length<5){var lt=[null,null,null,null],ut=nt.parseLength(ot.shift());if(null===ut)return null;if(lt[0]=ut,null===(ut=nt.parseLength(ot.shift())))return null;if(lt[1]=ut,0===ot.length){at.push(lt);continue}if(null!==(ut=nt.parseLength(ot[0]))&&(lt[2]=ut,ot.shift()),0===ot.length){at.push(lt);continue}var ct=nt.parseColor(ot[0]);if(null===ct)return null;lt[3]=ct,at.push(lt)}}return at},nt.parsePosition=function(rt){var it=rt.split(" "),r=function(nt){return"center"===nt||"left"===nt||"top"===nt||"bottom"===nt||"right"===nt};if(it.length>4)return null;for(var at=0;at<it.length;at++)if(!r(it[at])){var st=nt.parseLength(it[at]);if(null===st)return null;it[at]=st}for(var ot={h:{edge:"left",offset:{value:50,unit:"%"}},v:{edge:"top",offset:{value:50,unit:"%"}}},lt=0;lt<it.length;){var ut=it[lt++];if(r(ut)){var ct={value:0,unit:"%"};2!==it.length&&lt<it.length&&!r(it[lt])&&(ct=it[lt++]),"right"===ut?(ot.h.edge=ut,ot.h.offset=ct):"bottom"===ut?(ot.v.edge=ut,ot.v.offset=ct):"left"===ut?ot.h.offset=ct:"top"===ut&&(ot.v.offset=ct)}else{if(1!==it.length&&2!==it.length)return null;1===lt?ot.h.offset=ut:ot.v.offset=ut}}return ot},nt.ComputedLength=function(nt,rt){this.rw=nt,this.rh=rt},nt.ComputedLength.prototype.toUsedLength=function(nt,rt){return nt*this.rw+rt*this.rh},nt.ComputedLength.prototype.isZero=function(){return 0===this.rw&&0===this.rh},nt.toComputedLength=function(rt,it,at,st,ot,lt){return"%"===it&&st?new nt.ComputedLength(st.rw*rt/100,st.rh*rt/100):"em"===it&&at?new nt.ComputedLength(at.rw*rt,at.rh*rt):"c"===it&&ot?new nt.ComputedLength(rt*ot.rw,rt*ot.rh):"px"===it&&lt?new nt.ComputedLength(rt*lt.rw,rt*lt.rh):"rh"===it?new nt.ComputedLength(0,rt/100):"rw"===it?new nt.ComputedLength(rt/100,0):null}}(rt)},3516:function(nt){nt.exports=function(nt){var rt="string"==typeof nt?nt.charCodeAt(0):nt;return rt>=97&&rt<=122||rt>=65&&rt<=90}},2219:function(nt,rt,it){var at=it(3516),st=it(395);nt.exports=function(nt){return at(nt)||st(nt)}},395:function(nt){nt.exports=function(nt){var rt="string"==typeof nt?nt.charCodeAt(0):nt;return rt>=48&&rt<=57}},3875:function(nt){function t(nt){if("string"!=typeof nt)throw new TypeError("Path must be a string. Received "+JSON.stringify(nt))}function n(nt,rt){for(var it,at="",st=0,ot=-1,lt=0,ut=0;ut<=nt.length;++ut){if(ut<nt.length)it=nt.charCodeAt(ut);else{if(47===it)break;it=47}if(47===it){if(ot===ut-1||1===lt);else if(ot!==ut-1&&2===lt){if(at.length<2||2!==st||46!==at.charCodeAt(at.length-1)||46!==at.charCodeAt(at.length-2))if(at.length>2){var ct=at.lastIndexOf("/");if(ct!==at.length-1){-1===ct?(at="",st=0):st=(at=at.slice(0,ct)).length-1-at.lastIndexOf("/"),ot=ut,lt=0;continue}}else if(2===at.length||1===at.length){at="",st=0,ot=ut,lt=0;continue}rt&&(at.length>0?at+="/..":at="..",st=2)}else at.length>0?at+="/"+nt.slice(ot+1,ut):at=nt.slice(ot+1,ut),st=ut-ot-1;ot=ut,lt=0}else 46===it&&-1!==lt?++lt:lt=-1}return at}var rt={resolve:function(){for(var nt,rt="",it=!1,at=arguments.length-1;at>=-1&&!it;at--){var st;at>=0?st=arguments[at]:(void 0===nt&&(nt=process.cwd()),st=nt),t(st),0!==st.length&&(rt=st+"/"+rt,it=47===st.charCodeAt(0))}return rt=n(rt,!it),it?rt.length>0?"/"+rt:"/":rt.length>0?rt:"."},normalize:function(nt){if(t(nt),0===nt.length)return".";var rt=47===nt.charCodeAt(0),it=47===nt.charCodeAt(nt.length-1);return 0!==(nt=n(nt,!rt)).length||rt||(nt="."),nt.length>0&&it&&(nt+="/"),rt?"/"+nt:nt},isAbsolute:function(nt){return t(nt),nt.length>0&&47===nt.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var nt,it=0;it<arguments.length;++it){var at=arguments[it];t(at),at.length>0&&(void 0===nt?nt=at:nt+="/"+at)}return void 0===nt?".":rt.normalize(nt)},relative:function(nt,it){if(t(nt),t(it),nt===it)return"";if((nt=rt.resolve(nt))===(it=rt.resolve(it)))return"";for(var at=1;at<nt.length&&47===nt.charCodeAt(at);++at);for(var st=nt.length,ot=st-at,lt=1;lt<it.length&&47===it.charCodeAt(lt);++lt);for(var ut=it.length-lt,ct=ot<ut?ot:ut,dt=-1,ht=0;ht<=ct;++ht){if(ht===ct){if(ut>ct){if(47===it.charCodeAt(lt+ht))return it.slice(lt+ht+1);if(0===ht)return it.slice(lt+ht)}else ot>ct&&(47===nt.charCodeAt(at+ht)?dt=ht:0===ht&&(dt=0));break}var pt=nt.charCodeAt(at+ht);if(pt!==it.charCodeAt(lt+ht))break;47===pt&&(dt=ht)}var _t="";for(ht=at+dt+1;ht<=st;++ht)ht!==st&&47!==nt.charCodeAt(ht)||(0===_t.length?_t+="..":_t+="/..");return _t.length>0?_t+it.slice(lt+dt):(lt+=dt,47===it.charCodeAt(lt)&&++lt,it.slice(lt))},_makeLong:function(nt){return nt},dirname:function(nt){if(t(nt),0===nt.length)return".";for(var rt=nt.charCodeAt(0),it=47===rt,at=-1,st=!0,ot=nt.length-1;ot>=1;--ot)if(47===(rt=nt.charCodeAt(ot))){if(!st){at=ot;break}}else st=!1;return-1===at?it?"/":".":it&&1===at?"//":nt.slice(0,at)},basename:function(nt,rt){if(void 0!==rt&&"string"!=typeof rt)throw new TypeError('"ext" argument must be a string');t(nt);var it,at=0,st=-1,ot=!0;if(void 0!==rt&&rt.length>0&&rt.length<=nt.length){if(rt.length===nt.length&&rt===nt)return"";var lt=rt.length-1,ut=-1;for(it=nt.length-1;it>=0;--it){var ct=nt.charCodeAt(it);if(47===ct){if(!ot){at=it+1;break}}else-1===ut&&(ot=!1,ut=it+1),lt>=0&&(ct===rt.charCodeAt(lt)?-1==--lt&&(st=it):(lt=-1,st=ut))}return at===st?st=ut:-1===st&&(st=nt.length),nt.slice(at,st)}for(it=nt.length-1;it>=0;--it)if(47===nt.charCodeAt(it)){if(!ot){at=it+1;break}}else-1===st&&(ot=!1,st=it+1);return-1===st?"":nt.slice(at,st)},extname:function(nt){t(nt);for(var rt=-1,it=0,at=-1,st=!0,ot=0,lt=nt.length-1;lt>=0;--lt){var ut=nt.charCodeAt(lt);if(47!==ut)-1===at&&(st=!1,at=lt+1),46===ut?-1===rt?rt=lt:1!==ot&&(ot=1):-1!==rt&&(ot=-1);else if(!st){it=lt+1;break}}return-1===rt||-1===at||0===ot||1===ot&&rt===at-1&&rt===it+1?"":nt.slice(rt,at)},format:function(nt){if(null===nt||"object"!=typeof nt)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof nt);return function(nt,rt){var it=rt.dir||rt.root,at=rt.base||(rt.name||"")+(rt.ext||"");return it?it===rt.root?it+at:it+"/"+at:at}(0,nt)},parse:function(nt){t(nt);var rt={root:"",dir:"",base:"",ext:"",name:""};if(0===nt.length)return rt;var it,at=nt.charCodeAt(0),st=47===at;st?(rt.root="/",it=1):it=0;for(var ot=-1,lt=0,ut=-1,ct=!0,dt=nt.length-1,ht=0;dt>=it;--dt)if(47!==(at=nt.charCodeAt(dt)))-1===ut&&(ct=!1,ut=dt+1),46===at?-1===ot?ot=dt:1!==ht&&(ht=1):-1!==ot&&(ht=-1);else if(!ct){lt=dt+1;break}return-1===ot||-1===ut||0===ht||1===ht&&ot===ut-1&&ot===lt+1?-1!==ut&&(rt.base=rt.name=0===lt&&st?nt.slice(1,ut):nt.slice(lt,ut)):(0===lt&&st?(rt.name=nt.slice(1,ot),rt.base=nt.slice(1,ut)):(rt.name=nt.slice(lt,ot),rt.base=nt.slice(lt,ut)),rt.ext=nt.slice(ot,ut)),lt>0?rt.dir=nt.slice(0,lt-1):st&&(rt.dir="/"),rt},sep:"/",delimiter:":",win32:null,posix:null};rt.posix=rt,nt.exports=rt},8387:function(nt,rt,it){var at=it(1549),st=at.Buffer;function a(nt,rt){for(var it in nt)rt[it]=nt[it]}function o(nt,rt,it){return st(nt,rt,it)}st.from&&st.alloc&&st.allocUnsafe&&st.allocUnsafeSlow?nt.exports=at:(a(at,rt),rt.Buffer=o),a(st,o),o.from=function(nt,rt,it){if("number"==typeof nt)throw new TypeError("Argument must not be a number");return st(nt,rt,it)},o.alloc=function(nt,rt,it){if("number"!=typeof nt)throw new TypeError("Argument must be a number");var at=st(nt);return void 0!==rt?"string"==typeof it?at.fill(rt,it):at.fill(rt):at.fill(0),at},o.allocUnsafe=function(nt){if("number"!=typeof nt)throw new TypeError("Argument must be a number");return st(nt)},o.allocUnsafeSlow=function(nt){if("number"!=typeof nt)throw new TypeError("Argument must be a number");return at.SlowBuffer(nt)}},5378:function(nt,rt,it){!function(nt){nt.parser=function(nt,rt){return new i(nt,rt)},nt.SAXParser=i,nt.SAXStream=o,nt.createStream=function(nt,rt){return new o(nt,rt)},nt.MAX_BUFFER_LENGTH=65536;var rt,at=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function i(rt,it){if(!(this instanceof i))return new i(rt,it);var st=this;!function(nt){for(var rt=0,it=at.length;rt<it;rt++)nt[at[rt]]=""}(st),st.q=st.c="",st.bufferCheckPosition=nt.MAX_BUFFER_LENGTH,st.opt=it||{},st.opt.lowercase=st.opt.lowercase||st.opt.lowercasetags,st.looseCase=st.opt.lowercase?"toLowerCase":"toUpperCase",st.tags=[],st.closed=st.closedRoot=st.sawRoot=!1,st.tag=st.error=null,st.strict=!!rt,st.noscript=!(!rt&&!st.opt.noscript),st.state=Ot.BEGIN,st.strictEntities=st.opt.strictEntities,st.ENTITIES=st.strictEntities?Object.create(nt.XML_ENTITIES):Object.create(nt.ENTITIES),st.attribList=[],st.opt.xmlns&&(st.ns=Object.create(_t)),st.trackPosition=!1!==st.opt.position,st.trackPosition&&(st.position=st.line=st.column=0),w(st,"onready")}nt.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(nt){function t(){}return t.prototype=nt,new t}),Object.keys||(Object.keys=function(nt){var rt=[];for(var it in nt)nt.hasOwnProperty(it)&&rt.push(it);return rt}),i.prototype={end:function(){M(this)},write:function(rt){var it=this;if(this.error)throw this.error;if(it.closed)return O(it,"Cannot write after close. Assign an onready handler.");if(null===rt)return M(it);"object"==typeof rt&&(rt=rt.toString());for(var st=0,lt="";lt=G(rt,st++),it.c=lt,lt;)switch(it.trackPosition&&(it.position++,"\n"===lt?(it.line++,it.column=0):it.column++),it.state){case Ot.BEGIN:if(it.state=Ot.BEGIN_WHITESPACE,"\ufeff"===lt)continue;B(it,lt);continue;case Ot.BEGIN_WHITESPACE:B(it,lt);continue;case Ot.TEXT:if(it.sawRoot&&!it.closedRoot){for(var ut=st-1;lt&&"<"!==lt&&"&"!==lt;)(lt=G(rt,st++))&&it.trackPosition&&(it.position++,"\n"===lt?(it.line++,it.column=0):it.column++);it.textNode+=rt.substring(ut,st-1)}"<"!==lt||it.sawRoot&&it.closedRoot&&!it.strict?(!T(ot,lt)||it.sawRoot&&!it.closedRoot||P(it,"Text data outside of root node."),"&"===lt?it.state=Ot.TEXT_ENTITY:it.textNode+=lt):(it.state=Ot.OPEN_WAKA,it.startTagPosition=it.position);continue;case Ot.SCRIPT:"<"===lt?it.state=Ot.SCRIPT_ENDING:it.script+=lt;continue;case Ot.SCRIPT_ENDING:"/"===lt?it.state=Ot.CLOSE_TAG:(it.script+="<"+lt,it.state=Ot.SCRIPT);continue;case Ot.OPEN_WAKA:if("!"===lt)it.state=Ot.SGML_DECL,it.sgmlDecl="";else if(_(ot,lt));else if(_(Et,lt))it.state=Ot.OPEN_TAG,it.tagName=lt;else if("/"===lt)it.state=Ot.CLOSE_TAG,it.tagName="";else if("?"===lt)it.state=Ot.PROC_INST,it.procInstName=it.procInstBody="";else{if(P(it,"Unencoded <"),it.startTagPosition+1<it.position){var ht=it.position-it.startTagPosition;lt=new Array(ht).join(" ")+lt}it.textNode+="<"+lt,it.state=Ot.TEXT}continue;case Ot.SGML_DECL:"[CDATA["===(it.sgmlDecl+lt).toUpperCase()?(N(it,"onopencdata"),it.state=Ot.CDATA,it.sgmlDecl="",it.cdata=""):it.sgmlDecl+lt==="--"?(it.state=Ot.COMMENT,it.comment="",it.sgmlDecl=""):"DOCTYPE"===(it.sgmlDecl+lt).toUpperCase()?(it.state=Ot.DOCTYPE,(it.doctype||it.sawRoot)&&P(it,"Inappropriately located doctype declaration"),it.doctype="",it.sgmlDecl=""):">"===lt?(N(it,"onsgmldeclaration",it.sgmlDecl),it.sgmlDecl="",it.state=Ot.TEXT):_(ct,lt)?(it.state=Ot.SGML_DECL_QUOTED,it.sgmlDecl+=lt):it.sgmlDecl+=lt;continue;case Ot.SGML_DECL_QUOTED:lt===it.q&&(it.state=Ot.SGML_DECL,it.q=""),it.sgmlDecl+=lt;continue;case Ot.DOCTYPE:">"===lt?(it.state=Ot.TEXT,N(it,"ondoctype",it.doctype),it.doctype=!0):(it.doctype+=lt,"["===lt?it.state=Ot.DOCTYPE_DTD:_(ct,lt)&&(it.state=Ot.DOCTYPE_QUOTED,it.q=lt));continue;case Ot.DOCTYPE_QUOTED:it.doctype+=lt,lt===it.q&&(it.q="",it.state=Ot.DOCTYPE);continue;case Ot.DOCTYPE_DTD:it.doctype+=lt,"]"===lt?it.state=Ot.DOCTYPE:_(ct,lt)&&(it.state=Ot.DOCTYPE_DTD_QUOTED,it.q=lt);continue;case Ot.DOCTYPE_DTD_QUOTED:it.doctype+=lt,lt===it.q&&(it.state=Ot.DOCTYPE_DTD,it.q="");continue;case Ot.COMMENT:"-"===lt?it.state=Ot.COMMENT_ENDING:it.comment+=lt;continue;case Ot.COMMENT_ENDING:"-"===lt?(it.state=Ot.COMMENT_ENDED,it.comment=D(it.opt,it.comment),it.comment&&N(it,"oncomment",it.comment),it.comment=""):(it.comment+="-"+lt,it.state=Ot.COMMENT);continue;case Ot.COMMENT_ENDED:">"!==lt?(P(it,"Malformed comment"),it.comment+="--"+lt,it.state=Ot.COMMENT):it.state=Ot.TEXT;continue;case Ot.CDATA:"]"===lt?it.state=Ot.CDATA_ENDING:it.cdata+=lt;continue;case Ot.CDATA_ENDING:"]"===lt?it.state=Ot.CDATA_ENDING_2:(it.cdata+="]"+lt,it.state=Ot.CDATA);continue;case Ot.CDATA_ENDING_2:">"===lt?(it.cdata&&N(it,"oncdata",it.cdata),N(it,"onclosecdata"),it.cdata="",it.state=Ot.TEXT):"]"===lt?it.cdata+="]":(it.cdata+="]]"+lt,it.state=Ot.CDATA);continue;case Ot.PROC_INST:"?"===lt?it.state=Ot.PROC_INST_ENDING:_(ot,lt)?it.state=Ot.PROC_INST_BODY:it.procInstName+=lt;continue;case Ot.PROC_INST_BODY:if(!it.procInstBody&&_(ot,lt))continue;"?"===lt?it.state=Ot.PROC_INST_ENDING:it.procInstBody+=lt;continue;case Ot.PROC_INST_ENDING:">"===lt?(N(it,"onprocessinginstruction",{name:it.procInstName,body:it.procInstBody}),it.procInstName=it.procInstBody="",it.state=Ot.TEXT):(it.procInstBody+="?"+lt,it.state=Ot.PROC_INST_BODY);continue;case Ot.OPEN_TAG:_(St,lt)?it.tagName+=lt:(L(it),">"===lt?k(it):"/"===lt?it.state=Ot.OPEN_TAG_SLASH:(T(ot,lt)&&P(it,"Invalid character in tag name"),it.state=Ot.ATTRIB));continue;case Ot.OPEN_TAG_SLASH:">"===lt?(k(it,!0),U(it)):(P(it,"Forward-slash in opening tag not followed by >"),it.state=Ot.ATTRIB);continue;case Ot.ATTRIB:if(_(ot,lt))continue;">"===lt?k(it):"/"===lt?it.state=Ot.OPEN_TAG_SLASH:_(Et,lt)?(it.attribName=lt,it.attribValue="",it.state=Ot.ATTRIB_NAME):P(it,"Invalid attribute name");continue;case Ot.ATTRIB_NAME:"="===lt?it.state=Ot.ATTRIB_VALUE:">"===lt?(P(it,"Attribute without value"),it.attribValue=it.attribName,x(it),k(it)):_(ot,lt)?it.state=Ot.ATTRIB_NAME_SAW_WHITE:_(St,lt)?it.attribName+=lt:P(it,"Invalid attribute name");continue;case Ot.ATTRIB_NAME_SAW_WHITE:if("="===lt)it.state=Ot.ATTRIB_VALUE;else{if(_(ot,lt))continue;P(it,"Attribute without value"),it.tag.attributes[it.attribName]="",it.attribValue="",N(it,"onattribute",{name:it.attribName,value:""}),it.attribName="",">"===lt?k(it):_(Et,lt)?(it.attribName=lt,it.state=Ot.ATTRIB_NAME):(P(it,"Invalid attribute name"),it.state=Ot.ATTRIB)}continue;case Ot.ATTRIB_VALUE:if(_(ot,lt))continue;_(ct,lt)?(it.q=lt,it.state=Ot.ATTRIB_VALUE_QUOTED):(P(it,"Unquoted attribute value"),it.state=Ot.ATTRIB_VALUE_UNQUOTED,it.attribValue=lt);continue;case Ot.ATTRIB_VALUE_QUOTED:if(lt!==it.q){"&"===lt?it.state=Ot.ATTRIB_VALUE_ENTITY_Q:it.attribValue+=lt;continue}x(it),it.q="",it.state=Ot.ATTRIB_VALUE_CLOSED;continue;case Ot.ATTRIB_VALUE_CLOSED:_(ot,lt)?it.state=Ot.ATTRIB:">"===lt?k(it):"/"===lt?it.state=Ot.OPEN_TAG_SLASH:_(Et,lt)?(P(it,"No whitespace between attributes"),it.attribName=lt,it.attribValue="",it.state=Ot.ATTRIB_NAME):P(it,"Invalid attribute name");continue;case Ot.ATTRIB_VALUE_UNQUOTED:if(T(dt,lt)){"&"===lt?it.state=Ot.ATTRIB_VALUE_ENTITY_U:it.attribValue+=lt;continue}x(it),">"===lt?k(it):it.state=Ot.ATTRIB;continue;case Ot.CLOSE_TAG:if(it.tagName)">"===lt?U(it):_(St,lt)?it.tagName+=lt:it.script?(it.script+="</"+it.tagName,it.tagName="",it.state=Ot.SCRIPT):(T(ot,lt)&&P(it,"Invalid tagname in closing tag"),it.state=Ot.CLOSE_TAG_SAW_WHITE);else{if(_(ot,lt))continue;T(Et,lt)?it.script?(it.script+="</"+lt,it.state=Ot.SCRIPT):P(it,"Invalid tagname in closing tag."):it.tagName=lt}continue;case Ot.CLOSE_TAG_SAW_WHITE:if(_(ot,lt))continue;">"===lt?U(it):P(it,"Invalid characters in closing tag");continue;case Ot.TEXT_ENTITY:case Ot.ATTRIB_VALUE_ENTITY_Q:case Ot.ATTRIB_VALUE_ENTITY_U:var pt,_t;switch(it.state){case Ot.TEXT_ENTITY:pt=Ot.TEXT,_t="textNode";break;case Ot.ATTRIB_VALUE_ENTITY_Q:pt=Ot.ATTRIB_VALUE_QUOTED,_t="attribValue";break;case Ot.ATTRIB_VALUE_ENTITY_U:pt=Ot.ATTRIB_VALUE_UNQUOTED,_t="attribValue"}";"===lt?(it[_t]+=Z(it),it.entity="",it.state=pt):_(it.entity.length?Lt:wt,lt)?it.entity+=lt:(P(it,"Invalid character in entity name"),it[_t]+="&"+it.entity+lt,it.entity="",it.state=pt);continue;default:throw new Error(it,"Unknown state: "+it.state)}return it.position>=it.bufferCheckPosition&&function(rt){for(var it=Math.max(nt.MAX_BUFFER_LENGTH,10),st=0,ot=0,lt=at.length;ot<lt;ot++){var ut=rt[at[ot]].length;if(ut>it)switch(at[ot]){case"textNode":C(rt);break;case"cdata":N(rt,"oncdata",rt.cdata),rt.cdata="";break;case"script":N(rt,"onscript",rt.script),rt.script="";break;default:O(rt,"Max buffer length exceeded: "+at[ot])}st=Math.max(st,ut)}var ct=nt.MAX_BUFFER_LENGTH-st;rt.bufferCheckPosition=ct+rt.position}(it),it},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var nt;C(nt=this),""!==nt.cdata&&(N(nt,"oncdata",nt.cdata),nt.cdata=""),""!==nt.script&&(N(nt,"onscript",nt.script),nt.script="")}};try{rt=it(182).Stream}catch(nt){rt=function(){}}var st=nt.EVENTS.filter((function(nt){return"error"!==nt&&"end"!==nt}));function o(nt,it){if(!(this instanceof o))return new o(nt,it);rt.apply(this),this._parser=new i(nt,it),this.writable=!0,this.readable=!0;var at=this;this._parser.onend=function(){at.emit("end")},this._parser.onerror=function(nt){at.emit("error",nt),at._parser.error=null},this._decoder=null,st.forEach((function(nt){Object.defineProperty(at,"on"+nt,{get:function(){return at._parser["on"+nt]},set:function(rt){if(!rt)return at.removeAllListeners(nt),at._parser["on"+nt]=rt,rt;at.on(nt,rt)},enumerable:!0,configurable:!1})}))}o.prototype=Object.create(rt.prototype,{constructor:{value:o}}),o.prototype.write=function(nt){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(nt)){if(!this._decoder){var rt=it(7503).s;this._decoder=new rt("utf8")}nt=this._decoder.write(nt)}return this._parser.write(nt.toString()),this.emit("data",nt),!0},o.prototype.end=function(nt){return nt&&nt.length&&this.write(nt),this._parser.end(),!0},o.prototype.on=function(nt,it){var at=this;return at._parser["on"+nt]||-1===st.indexOf(nt)||(at._parser["on"+nt]=function(){var rt=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);rt.splice(0,0,nt),at.emit.apply(at,rt)}),rt.prototype.on.call(at,nt,it)};var ot="\r\n\t ",lt="0124356789",ut="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",ct="'\"",dt=ot+">",ht="http://www.w3.org/XML/1998/namespace",pt="http://www.w3.org/2000/xmlns/",_t={xml:ht,xmlns:pt};ot=v(ot),lt=v(lt),ut=v(ut);var Et=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,St=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/,wt=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,Lt=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;function v(nt){return nt.split("").reduce((function(nt,rt){return nt[rt]=!0,nt}),{})}function _(nt,rt){return function(nt){return"[object RegExp]"===Object.prototype.toString.call(nt)}(nt)?!!rt.match(nt):nt[rt]}function T(nt,rt){return!_(nt,rt)}ct=v(ct),dt=v(dt);var Ct,Pt,kt,Ot=0;for(var Ft in nt.STATE={BEGIN:Ot++,BEGIN_WHITESPACE:Ot++,TEXT:Ot++,TEXT_ENTITY:Ot++,OPEN_WAKA:Ot++,SGML_DECL:Ot++,SGML_DECL_QUOTED:Ot++,DOCTYPE:Ot++,DOCTYPE_QUOTED:Ot++,DOCTYPE_DTD:Ot++,DOCTYPE_DTD_QUOTED:Ot++,COMMENT_STARTING:Ot++,COMMENT:Ot++,COMMENT_ENDING:Ot++,COMMENT_ENDED:Ot++,CDATA:Ot++,CDATA_ENDING:Ot++,CDATA_ENDING_2:Ot++,PROC_INST:Ot++,PROC_INST_BODY:Ot++,PROC_INST_ENDING:Ot++,OPEN_TAG:Ot++,OPEN_TAG_SLASH:Ot++,ATTRIB:Ot++,ATTRIB_NAME:Ot++,ATTRIB_NAME_SAW_WHITE:Ot++,ATTRIB_VALUE:Ot++,ATTRIB_VALUE_QUOTED:Ot++,ATTRIB_VALUE_CLOSED:Ot++,ATTRIB_VALUE_UNQUOTED:Ot++,ATTRIB_VALUE_ENTITY_Q:Ot++,ATTRIB_VALUE_ENTITY_U:Ot++,CLOSE_TAG:Ot++,CLOSE_TAG_SAW_WHITE:Ot++,SCRIPT:Ot++,SCRIPT_ENDING:Ot++},nt.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},nt.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(nt.ENTITIES).forEach((function(rt){var it=nt.ENTITIES[rt],at="number"==typeof it?String.fromCharCode(it):it;nt.ENTITIES[rt]=at})),nt.STATE)nt.STATE[nt.STATE[Ft]]=Ft;function w(nt,rt,it){nt[rt]&&nt[rt](it)}function N(nt,rt,it){nt.textNode&&C(nt),w(nt,rt,it)}function C(nt){nt.textNode=D(nt.opt,nt.textNode),nt.textNode&&w(nt,"ontext",nt.textNode),nt.textNode=""}function D(nt,rt){return nt.trim&&(rt=rt.trim()),nt.normalize&&(rt=rt.replace(/\s+/g," ")),rt}function O(nt,rt){return C(nt),nt.trackPosition&&(rt+="\nLine: "+nt.line+"\nColumn: "+nt.column+"\nChar: "+nt.c),rt=new Error(rt),nt.error=rt,w(nt,"onerror",rt),nt}function M(nt){return nt.sawRoot&&!nt.closedRoot&&P(nt,"Unclosed root tag"),nt.state!==Ot.BEGIN&&nt.state!==Ot.BEGIN_WHITESPACE&&nt.state!==Ot.TEXT&&O(nt,"Unexpected end"),C(nt),nt.c="",nt.closed=!0,w(nt,"onend"),i.call(nt,nt.strict,nt.opt),nt}function P(nt,rt){if("object"!=typeof nt||!(nt instanceof i))throw new Error("bad call to strictFail");nt.strict&&O(nt,rt)}function L(nt){nt.strict||(nt.tagName=nt.tagName[nt.looseCase]());var rt=nt.tags[nt.tags.length-1]||nt,it=nt.tag={name:nt.tagName,attributes:{}};nt.opt.xmlns&&(it.ns=rt.ns),nt.attribList.length=0,N(nt,"onopentagstart",it)}function F(nt,rt){var it=nt.indexOf(":")<0?["",nt]:nt.split(":"),at=it[0],st=it[1];return rt&&"xmlns"===nt&&(at="xmlns",st=""),{prefix:at,local:st}}function x(nt){if(nt.strict||(nt.attribName=nt.attribName[nt.looseCase]()),-1!==nt.attribList.indexOf(nt.attribName)||nt.tag.attributes.hasOwnProperty(nt.attribName))nt.attribName=nt.attribValue="";else{if(nt.opt.xmlns){var rt=F(nt.attribName,!0),it=rt.prefix,at=rt.local;if("xmlns"===it)if("xml"===at&&nt.attribValue!==ht)P(nt,"xml: prefix must be bound to "+ht+"\nActual: "+nt.attribValue);else if("xmlns"===at&&nt.attribValue!==pt)P(nt,"xmlns: prefix must be bound to "+pt+"\nActual: "+nt.attribValue);else{var st=nt.tag,ot=nt.tags[nt.tags.length-1]||nt;st.ns===ot.ns&&(st.ns=Object.create(ot.ns)),st.ns[at]=nt.attribValue}nt.attribList.push([nt.attribName,nt.attribValue])}else nt.tag.attributes[nt.attribName]=nt.attribValue,N(nt,"onattribute",{name:nt.attribName,value:nt.attribValue});nt.attribName=nt.attribValue=""}}function k(nt,rt){if(nt.opt.xmlns){var it=nt.tag,at=F(nt.tagName);it.prefix=at.prefix,it.local=at.local,it.uri=it.ns[at.prefix]||"",it.prefix&&!it.uri&&(P(nt,"Unbound namespace prefix: "+JSON.stringify(nt.tagName)),it.uri=at.prefix);var st=nt.tags[nt.tags.length-1]||nt;it.ns&&st.ns!==it.ns&&Object.keys(it.ns).forEach((function(rt){N(nt,"onopennamespace",{prefix:rt,uri:it.ns[rt]})}));for(var ot=0,lt=nt.attribList.length;ot<lt;ot++){var ut=nt.attribList[ot],ct=ut[0],dt=ut[1],ht=F(ct,!0),pt=ht.prefix,_t=ht.local,Et=""===pt?"":it.ns[pt]||"",St={name:ct,value:dt,prefix:pt,local:_t,uri:Et};pt&&"xmlns"!==pt&&!Et&&(P(nt,"Unbound namespace prefix: "+JSON.stringify(pt)),St.uri=pt),nt.tag.attributes[ct]=St,N(nt,"onattribute",St)}nt.attribList.length=0}nt.tag.isSelfClosing=!!rt,nt.sawRoot=!0,nt.tags.push(nt.tag),N(nt,"onopentag",nt.tag),rt||(nt.noscript||"script"!==nt.tagName.toLowerCase()?nt.state=Ot.TEXT:nt.state=Ot.SCRIPT,nt.tag=null,nt.tagName=""),nt.attribName=nt.attribValue="",nt.attribList.length=0}function U(nt){if(!nt.tagName)return P(nt,"Weird empty close tag."),nt.textNode+="</>",void(nt.state=Ot.TEXT);if(nt.script){if("script"!==nt.tagName)return nt.script+="</"+nt.tagName+">",nt.tagName="",void(nt.state=Ot.SCRIPT);N(nt,"onscript",nt.script),nt.script=""}var rt=nt.tags.length,it=nt.tagName;nt.strict||(it=it[nt.looseCase]());for(var at=it;rt--&&nt.tags[rt].name!==at;)P(nt,"Unexpected close tag");if(rt<0)return P(nt,"Unmatched closing tag: "+nt.tagName),nt.textNode+="</"+nt.tagName+">",void(nt.state=Ot.TEXT);nt.tagName=it;for(var st=nt.tags.length;st-- >rt;){var ot=nt.tag=nt.tags.pop();nt.tagName=nt.tag.name,N(nt,"onclosetag",nt.tagName);var lt={};for(var ut in ot.ns)lt[ut]=ot.ns[ut];var ct=nt.tags[nt.tags.length-1]||nt;nt.opt.xmlns&&ot.ns!==ct.ns&&Object.keys(ot.ns).forEach((function(rt){var it=ot.ns[rt];N(nt,"onclosenamespace",{prefix:rt,uri:it})}))}0===rt&&(nt.closedRoot=!0),nt.tagName=nt.attribValue=nt.attribName="",nt.attribList.length=0,nt.state=Ot.TEXT}function Z(nt){var rt,it=nt.entity,at=it.toLowerCase(),st="";return nt.ENTITIES[it]?nt.ENTITIES[it]:nt.ENTITIES[at]?nt.ENTITIES[at]:("#"===(it=at).charAt(0)&&("x"===it.charAt(1)?(it=it.slice(2),st=(rt=parseInt(it,16)).toString(16)):(it=it.slice(1),st=(rt=parseInt(it,10)).toString(10))),it=it.replace(/^0+/,""),st.toLowerCase()!==it?(P(nt,"Invalid character entity"),"&"+nt.entity+";"):String.fromCodePoint(rt))}function B(nt,rt){"<"===rt?(nt.state=Ot.OPEN_WAKA,nt.startTagPosition=nt.position):T(ot,rt)&&(P(nt,"Non-whitespace before first tag."),nt.textNode=rt,nt.state=Ot.TEXT)}function G(nt,rt){var it="";return rt<nt.length&&(it=nt.charAt(rt)),it}Ot=nt.STATE,String.fromCodePoint||(Ct=String.fromCharCode,Pt=Math.floor,kt=function(){var nt,rt,it=16384,at=[],st=-1,ot=arguments.length;if(!ot)return"";for(var lt="";++st<ot;){var ut=Number(arguments[st]);if(!isFinite(ut)||ut<0||ut>1114111||Pt(ut)!==ut)throw RangeError("Invalid code point: "+ut);ut<=65535?at.push(ut):(nt=55296+((ut-=65536)>>10),rt=ut%1024+56320,at.push(nt,rt)),(st+1===ot||at.length>it)&&(lt+=Ct.apply(null,at),at.length=0)}return lt},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:kt,configurable:!0,writable:!0}):String.fromCodePoint=kt)}(rt)},182:function(nt,rt,it){nt.exports=i;var at=it(1159).EventEmitter;function i(){at.call(this)}it(1765)(i,at),i.Readable=it(2846),i.Writable=it(8318),i.Duplex=it(6138),i.Transform=it(9798),i.PassThrough=it(5472),i.finished=it(8800),i.pipeline=it(7295),i.Stream=i,i.prototype.pipe=function(nt,rt){var it=this;function i(rt){nt.writable&&!1===nt.write(rt)&&it.pause&&it.pause()}function a(){it.readable&&it.resume&&it.resume()}it.on("data",i),nt.on("drain",a),nt._isStdio||rt&&!1===rt.end||(it.on("end",s),it.on("close",u));var st=!1;function s(){st||(st=!0,nt.end())}function u(){st||(st=!0,"function"==typeof nt.destroy&&nt.destroy())}function l(nt){if(c(),0===at.listenerCount(this,"error"))throw nt}function c(){it.removeListener("data",i),nt.removeListener("drain",a),it.removeListener("end",s),it.removeListener("close",u),it.removeListener("error",l),nt.removeListener("error",l),it.removeListener("end",c),it.removeListener("close",c),nt.removeListener("close",c)}return it.on("error",l),nt.on("error",l),it.on("end",c),it.on("close",c),nt.on("close",c),nt.emit("pipe",it),nt}},1765:function(nt){"function"==typeof Object.create?nt.exports=function(nt,rt){rt&&(nt.super_=rt,nt.prototype=Object.create(rt.prototype,{constructor:{value:nt,enumerable:!1,writable:!0,configurable:!0}}))}:nt.exports=function(nt,rt){if(rt){nt.super_=rt;var n=function(){};n.prototype=rt.prototype,nt.prototype=new n,nt.prototype.constructor=nt}}},3690:function(nt){var rt={};function n(nt,it,at){at||(at=Error);var st=function(nt){var rt,at;function i(rt,at,st){return nt.call(this,function(nt,rt,at){return"string"==typeof it?it:it(nt,rt,at)}(rt,at,st))||this}return at=nt,(rt=i).prototype=Object.create(at.prototype),rt.prototype.constructor=rt,rt.__proto__=at,i}(at);st.prototype.name=at.name,st.prototype.code=nt,rt[nt]=st}function r(nt,rt){if(Array.isArray(nt)){var it=nt.length;return nt=nt.map((function(nt){return String(nt)})),it>2?"one of ".concat(rt," ").concat(nt.slice(0,it-1).join(", "),", or ")+nt[it-1]:2===it?"one of ".concat(rt," ").concat(nt[0]," or ").concat(nt[1]):"of ".concat(rt," ").concat(nt[0])}return"of ".concat(rt," ").concat(String(nt))}n("ERR_INVALID_OPT_VALUE",(function(nt,rt){return'The value "'+rt+'" is invalid for option "'+nt+'"'}),TypeError),n("ERR_INVALID_ARG_TYPE",(function(nt,rt,it){var at,st,ot,lt,ut;if("string"==typeof rt&&(st="not ",rt.substr(0,st.length)===st)?(at="must not be",rt=rt.replace(/^not /,"")):at="must be",function(nt,rt,it){return(void 0===it||it>nt.length)&&(it=nt.length),nt.substring(it-rt.length,it)===rt}(nt," argument"))ot="The ".concat(nt," ").concat(at," ").concat(r(rt,"type"));else{var ct=("number"!=typeof ut&&(ut=0),ut+1>(lt=nt).length||-1===lt.indexOf(".",ut)?"argument":"property");ot='The "'.concat(nt,'" ').concat(ct," ").concat(at," ").concat(r(rt,"type"))}return ot+". Received type ".concat(typeof it)}),TypeError),n("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),n("ERR_METHOD_NOT_IMPLEMENTED",(function(nt){return"The "+nt+" method is not implemented"})),n("ERR_STREAM_PREMATURE_CLOSE","Premature close"),n("ERR_STREAM_DESTROYED",(function(nt){return"Cannot call "+nt+" after a stream was destroyed"})),n("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),n("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),n("ERR_STREAM_WRITE_AFTER_END","write after end"),n("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),n("ERR_UNKNOWN_ENCODING",(function(nt){return"Unknown encoding: "+nt}),TypeError),n("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),nt.exports.q=rt},6138:function(nt,rt,it){var at=Object.keys||function(nt){var rt=[];for(var it in nt)rt.push(it);return rt};nt.exports=l;var st=it(2846),ot=it(8318);it(1765)(l,st);for(var lt=at(ot.prototype),ut=0;ut<lt.length;ut++){var ct=lt[ut];l.prototype[ct]||(l.prototype[ct]=ot.prototype[ct])}function l(nt){if(!(this instanceof l))return new l(nt);st.call(this,nt),ot.call(this,nt),this.allowHalfOpen=!0,nt&&(!1===nt.readable&&(this.readable=!1),!1===nt.writable&&(this.writable=!1),!1===nt.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",c)))}function c(){this._writableState.ended||process.nextTick(f,this)}function f(nt){nt.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(nt){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=nt,this._writableState.destroyed=nt)}})},5472:function(nt,rt,it){nt.exports=i;var at=it(9798);function i(nt){if(!(this instanceof i))return new i(nt);at.call(this,nt)}it(1765)(i,at),i.prototype._transform=function(nt,rt,it){it(null,nt)}},2846:function(nt,rt,it){var at;nt.exports=A,A.ReadableState=b,it(1159).EventEmitter;var st,a=function(nt,rt){return nt.listeners(rt).length},ot=it(9299),lt=it(1549).Buffer,ut=it.g.Uint8Array||function(){},ct=it(964);st=ct&&ct.debuglog?ct.debuglog("stream"):function(){};var dt,ht,pt,_t=it(8393),Et=it(6163),St=it(7269).getHighWaterMark,wt=it(3690).q,Lt=wt.ERR_INVALID_ARG_TYPE,Ct=wt.ERR_STREAM_PUSH_AFTER_EOF,Pt=wt.ERR_METHOD_NOT_IMPLEMENTED,kt=wt.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;it(1765)(A,ot);var Ot=Et.errorOrDestroy,Ft=["error","close","destroy","pause","resume"];function b(nt,rt,st){at=at||it(6138),nt=nt||{},"boolean"!=typeof st&&(st=rt instanceof at),this.objectMode=!!nt.objectMode,st&&(this.objectMode=this.objectMode||!!nt.readableObjectMode),this.highWaterMark=St(this,nt,"readableHighWaterMark",st),this.buffer=new _t,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==nt.emitClose,this.autoDestroy=!!nt.autoDestroy,this.destroyed=!1,this.defaultEncoding=nt.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,nt.encoding&&(dt||(dt=it(7503).s),this.decoder=new dt(nt.encoding),this.encoding=nt.encoding)}function A(nt){if(at=at||it(6138),!(this instanceof A))return new A(nt);var rt=this instanceof at;this._readableState=new b(nt,this,rt),this.readable=!0,nt&&("function"==typeof nt.read&&(this._read=nt.read),"function"==typeof nt.destroy&&(this._destroy=nt.destroy)),ot.call(this)}function I(nt,rt,it,at,ot){st("readableAddChunk",rt);var ct,dt=nt._readableState;if(null===rt)dt.reading=!1,function(nt,rt){if(st("onEofChunk"),!rt.ended){if(rt.decoder){var it=rt.decoder.end();it&&it.length&&(rt.buffer.push(it),rt.length+=rt.objectMode?1:it.length)}rt.ended=!0,rt.sync?C(nt):(rt.needReadable=!1,rt.emittedReadable||(rt.emittedReadable=!0,D(nt)))}}(nt,dt);else if(ot||(ct=function(nt,rt){var it,at;return at=rt,lt.isBuffer(at)||at instanceof ut||"string"==typeof rt||void 0===rt||nt.objectMode||(it=new Lt("chunk",["string","Buffer","Uint8Array"],rt)),it}(dt,rt)),ct)Ot(nt,ct);else if(dt.objectMode||rt&&rt.length>0)if("string"==typeof rt||dt.objectMode||Object.getPrototypeOf(rt)===lt.prototype||(rt=function(nt){return lt.from(nt)}(rt)),at)dt.endEmitted?Ot(nt,new kt):R(nt,dt,rt,!0);else if(dt.ended)Ot(nt,new Ct);else{if(dt.destroyed)return!1;dt.reading=!1,dt.decoder&&!it?(rt=dt.decoder.write(rt),dt.objectMode||0!==rt.length?R(nt,dt,rt,!1):O(nt,dt)):R(nt,dt,rt,!1)}else at||(dt.reading=!1,O(nt,dt));return!dt.ended&&(dt.length<dt.highWaterMark||0===dt.length)}function R(nt,rt,it,at){rt.flowing&&0===rt.length&&!rt.sync?(rt.awaitDrain=0,nt.emit("data",it)):(rt.length+=rt.objectMode?1:it.length,at?rt.buffer.unshift(it):rt.buffer.push(it),rt.needReadable&&C(nt)),O(nt,rt)}Object.defineProperty(A.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(nt){this._readableState&&(this._readableState.destroyed=nt)}}),A.prototype.destroy=Et.destroy,A.prototype._undestroy=Et.undestroy,A.prototype._destroy=function(nt,rt){rt(nt)},A.prototype.push=function(nt,rt){var it,at=this._readableState;return at.objectMode?it=!0:"string"==typeof nt&&((rt=rt||at.defaultEncoding)!==at.encoding&&(nt=lt.from(nt,rt),rt=""),it=!0),I(this,nt,rt,!1,it)},A.prototype.unshift=function(nt){return I(this,nt,null,!0,!1)},A.prototype.isPaused=function(){return!1===this._readableState.flowing},A.prototype.setEncoding=function(nt){dt||(dt=it(7503).s);var rt=new dt(nt);this._readableState.decoder=rt,this._readableState.encoding=this._readableState.decoder.encoding;for(var at=this._readableState.buffer.head,st="";null!==at;)st+=rt.write(at.data),at=at.next;return this._readableState.buffer.clear(),""!==st&&this._readableState.buffer.push(st),this._readableState.length=st.length,this};var Bt=1073741824;function N(nt,rt){return nt<=0||0===rt.length&&rt.ended?0:rt.objectMode?1:nt!=nt?rt.flowing&&rt.length?rt.buffer.head.data.length:rt.length:(nt>rt.highWaterMark&&(rt.highWaterMark=function(nt){return nt>=Bt?nt=Bt:(nt--,nt|=nt>>>1,nt|=nt>>>2,nt|=nt>>>4,nt|=nt>>>8,nt|=nt>>>16,nt++),nt}(nt)),nt<=rt.length?nt:rt.ended?rt.length:(rt.needReadable=!0,0))}function C(nt){var rt=nt._readableState;st("emitReadable",rt.needReadable,rt.emittedReadable),rt.needReadable=!1,rt.emittedReadable||(st("emitReadable",rt.flowing),rt.emittedReadable=!0,process.nextTick(D,nt))}function D(nt){var rt=nt._readableState;st("emitReadable_",rt.destroyed,rt.length,rt.ended),rt.destroyed||!rt.length&&!rt.ended||(nt.emit("readable"),rt.emittedReadable=!1),rt.needReadable=!rt.flowing&&!rt.ended&&rt.length<=rt.highWaterMark,x(nt)}function O(nt,rt){rt.readingMore||(rt.readingMore=!0,process.nextTick(M,nt,rt))}function M(nt,rt){for(;!rt.reading&&!rt.ended&&(rt.length<rt.highWaterMark||rt.flowing&&0===rt.length);){var it=rt.length;if(st("maybeReadMore read 0"),nt.read(0),it===rt.length)break}rt.readingMore=!1}function P(nt){var rt=nt._readableState;rt.readableListening=nt.listenerCount("readable")>0,rt.resumeScheduled&&!rt.paused?rt.flowing=!0:nt.listenerCount("data")>0&&nt.resume()}function L(nt){st("readable nexttick read 0"),nt.read(0)}function F(nt,rt){st("resume",rt.reading),rt.reading||nt.read(0),rt.resumeScheduled=!1,nt.emit("resume"),x(nt),rt.flowing&&!rt.reading&&nt.read(0)}function x(nt){var rt=nt._readableState;for(st("flow",rt.flowing);rt.flowing&&null!==nt.read(););}function k(nt,rt){return 0===rt.length?null:(rt.objectMode?it=rt.buffer.shift():!nt||nt>=rt.length?(it=rt.decoder?rt.buffer.join(""):1===rt.buffer.length?rt.buffer.first():rt.buffer.concat(rt.length),rt.buffer.clear()):it=rt.buffer.consume(nt,rt.decoder),it);var it}function U(nt){var rt=nt._readableState;st("endReadable",rt.endEmitted),rt.endEmitted||(rt.ended=!0,process.nextTick(Z,rt,nt))}function Z(nt,rt){if(st("endReadableNT",nt.endEmitted,nt.length),!nt.endEmitted&&0===nt.length&&(nt.endEmitted=!0,rt.readable=!1,rt.emit("end"),nt.autoDestroy)){var it=rt._writableState;(!it||it.autoDestroy&&it.finished)&&rt.destroy()}}function B(nt,rt){for(var it=0,at=nt.length;it<at;it++)if(nt[it]===rt)return it;return-1}A.prototype.read=function(nt){st("read",nt),nt=parseInt(nt,10);var rt=this._readableState,it=nt;if(0!==nt&&(rt.emittedReadable=!1),0===nt&&rt.needReadable&&((0!==rt.highWaterMark?rt.length>=rt.highWaterMark:rt.length>0)||rt.ended))return st("read: emitReadable",rt.length,rt.ended),0===rt.length&&rt.ended?U(this):C(this),null;if(0===(nt=N(nt,rt))&&rt.ended)return 0===rt.length&&U(this),null;var at,ot=rt.needReadable;return st("need readable",ot),(0===rt.length||rt.length-nt<rt.highWaterMark)&&st("length less than watermark",ot=!0),rt.ended||rt.reading?st("reading or ended",ot=!1):ot&&(st("do read"),rt.reading=!0,rt.sync=!0,0===rt.length&&(rt.needReadable=!0),this._read(rt.highWaterMark),rt.sync=!1,rt.reading||(nt=N(it,rt))),null===(at=nt>0?k(nt,rt):null)?(rt.needReadable=rt.length<=rt.highWaterMark,nt=0):(rt.length-=nt,rt.awaitDrain=0),0===rt.length&&(rt.ended||(rt.needReadable=!0),it!==nt&&rt.ended&&U(this)),null!==at&&this.emit("data",at),at},A.prototype._read=function(nt){Ot(this,new Pt("_read()"))},A.prototype.pipe=function(nt,rt){var it=this,at=this._readableState;switch(at.pipesCount){case 0:at.pipes=nt;break;case 1:at.pipes=[at.pipes,nt];break;default:at.pipes.push(nt)}at.pipesCount+=1,st("pipe count=%d opts=%j",at.pipesCount,rt);var ot=rt&&!1===rt.end||nt===process.stdout||nt===process.stderr?h:s;function s(){st("onend"),nt.end()}at.endEmitted?process.nextTick(ot):it.once("end",ot),nt.on("unpipe",(function t(rt,ot){st("onunpipe"),rt===it&&ot&&!1===ot.hasUnpiped&&(ot.hasUnpiped=!0,st("cleanup"),nt.removeListener("close",d),nt.removeListener("finish",g),nt.removeListener("drain",lt),nt.removeListener("error",f),nt.removeListener("unpipe",t),it.removeListener("end",s),it.removeListener("end",h),it.removeListener("data",c),ut=!0,!at.awaitDrain||nt._writableState&&!nt._writableState.needDrain||lt())}));var lt=function(nt){return function(){var rt=nt._readableState;st("pipeOnDrain",rt.awaitDrain),rt.awaitDrain&&rt.awaitDrain--,0===rt.awaitDrain&&a(nt,"data")&&(rt.flowing=!0,x(nt))}}(it);nt.on("drain",lt);var ut=!1;function c(rt){st("ondata");var ot=nt.write(rt);st("dest.write",ot),!1===ot&&((1===at.pipesCount&&at.pipes===nt||at.pipesCount>1&&-1!==B(at.pipes,nt))&&!ut&&(st("false write response, pause",at.awaitDrain),at.awaitDrain++),it.pause())}function f(rt){st("onerror",rt),h(),nt.removeListener("error",f),0===a(nt,"error")&&Ot(nt,rt)}function d(){nt.removeListener("finish",g),h()}function g(){st("onfinish"),nt.removeListener("close",d),h()}function h(){st("unpipe"),it.unpipe(nt)}return it.on("data",c),function(nt,rt,it){if("function"==typeof nt.prependListener)return nt.prependListener(rt,it);nt._events&&nt._events[rt]?Array.isArray(nt._events[rt])?nt._events[rt].unshift(it):nt._events[rt]=[it,nt._events[rt]]:nt.on(rt,it)}(nt,"error",f),nt.once("close",d),nt.once("finish",g),nt.emit("pipe",it),at.flowing||(st("pipe resume"),it.resume()),nt},A.prototype.unpipe=function(nt){var rt=this._readableState,it={hasUnpiped:!1};if(0===rt.pipesCount)return this;if(1===rt.pipesCount)return nt&&nt!==rt.pipes||(nt||(nt=rt.pipes),rt.pipes=null,rt.pipesCount=0,rt.flowing=!1,nt&&nt.emit("unpipe",this,it)),this;if(!nt){var at=rt.pipes,st=rt.pipesCount;rt.pipes=null,rt.pipesCount=0,rt.flowing=!1;for(var ot=0;ot<st;ot++)at[ot].emit("unpipe",this,{hasUnpiped:!1});return this}var lt=B(rt.pipes,nt);return-1===lt||(rt.pipes.splice(lt,1),rt.pipesCount-=1,1===rt.pipesCount&&(rt.pipes=rt.pipes[0]),nt.emit("unpipe",this,it)),this},A.prototype.on=function(nt,rt){var it=ot.prototype.on.call(this,nt,rt),at=this._readableState;return"data"===nt?(at.readableListening=this.listenerCount("readable")>0,!1!==at.flowing&&this.resume()):"readable"===nt&&(at.endEmitted||at.readableListening||(at.readableListening=at.needReadable=!0,at.flowing=!1,at.emittedReadable=!1,st("on readable",at.length,at.reading),at.length?C(this):at.reading||process.nextTick(L,this))),it},A.prototype.addListener=A.prototype.on,A.prototype.removeListener=function(nt,rt){var it=ot.prototype.removeListener.call(this,nt,rt);return"readable"===nt&&process.nextTick(P,this),it},A.prototype.removeAllListeners=function(nt){var rt=ot.prototype.removeAllListeners.apply(this,arguments);return"readable"!==nt&&void 0!==nt||process.nextTick(P,this),rt},A.prototype.resume=function(){var nt=this._readableState;return nt.flowing||(st("resume"),nt.flowing=!nt.readableListening,function(nt,rt){rt.resumeScheduled||(rt.resumeScheduled=!0,process.nextTick(F,nt,rt))}(this,nt)),nt.paused=!1,this},A.prototype.pause=function(){return st("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(st("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},A.prototype.wrap=function(nt){var rt=this,it=this._readableState,at=!1;for(var ot in nt.on("end",(function(){if(st("wrapped end"),it.decoder&&!it.ended){var nt=it.decoder.end();nt&&nt.length&&rt.push(nt)}rt.push(null)})),nt.on("data",(function(ot){st("wrapped data"),it.decoder&&(ot=it.decoder.write(ot)),it.objectMode&&null==ot||(it.objectMode||ot&&ot.length)&&(rt.push(ot)||(at=!0,nt.pause()))})),nt)void 0===this[ot]&&"function"==typeof nt[ot]&&(this[ot]=function(rt){return function(){return nt[rt].apply(nt,arguments)}}(ot));for(var lt=0;lt<Ft.length;lt++)nt.on(Ft[lt],this.emit.bind(this,Ft[lt]));return this._read=function(rt){st("wrapped _read",rt),at&&(at=!1,nt.resume())},this},"function"==typeof Symbol&&(A.prototype[Symbol.asyncIterator]=function(){return void 0===ht&&(ht=it(7299)),ht(this)}),Object.defineProperty(A.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(A.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(A.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(nt){this._readableState&&(this._readableState.flowing=nt)}}),A._fromList=k,Object.defineProperty(A.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(A.from=function(nt,rt){return void 0===pt&&(pt=it(6233)),pt(A,nt,rt)})},9798:function(nt,rt,it){nt.exports=c;var at=it(3690).q,st=at.ERR_METHOD_NOT_IMPLEMENTED,ot=at.ERR_MULTIPLE_CALLBACK,lt=at.ERR_TRANSFORM_ALREADY_TRANSFORMING,ut=at.ERR_TRANSFORM_WITH_LENGTH_0,ct=it(6138);function l(nt,rt){var it=this._transformState;it.transforming=!1;var at=it.writecb;if(null===at)return this.emit("error",new ot);it.writechunk=null,it.writecb=null,null!=rt&&this.push(rt),at(nt);var st=this._readableState;st.reading=!1,(st.needReadable||st.length<st.highWaterMark)&&this._read(st.highWaterMark)}function c(nt){if(!(this instanceof c))return new c(nt);ct.call(this,nt),this._transformState={afterTransform:l.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,nt&&("function"==typeof nt.transform&&(this._transform=nt.transform),"function"==typeof nt.flush&&(this._flush=nt.flush)),this.on("prefinish",f)}function f(){var nt=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush((function(rt,it){d(nt,rt,it)}))}function d(nt,rt,it){if(rt)return nt.emit("error",rt);if(null!=it&&nt.push(it),nt._writableState.length)throw new ut;if(nt._transformState.transforming)throw new lt;return nt.push(null)}it(1765)(c,ct),c.prototype.push=function(nt,rt){return this._transformState.needTransform=!1,ct.prototype.push.call(this,nt,rt)},c.prototype._transform=function(nt,rt,it){it(new st("_transform()"))},c.prototype._write=function(nt,rt,it){var at=this._transformState;if(at.writecb=it,at.writechunk=nt,at.writeencoding=rt,!at.transforming){var st=this._readableState;(at.needTransform||st.needReadable||st.length<st.highWaterMark)&&this._read(st.highWaterMark)}},c.prototype._read=function(nt){var rt=this._transformState;null===rt.writechunk||rt.transforming?rt.needTransform=!0:(rt.transforming=!0,this._transform(rt.writechunk,rt.writeencoding,rt.afterTransform))},c.prototype._destroy=function(nt,rt){ct.prototype._destroy.call(this,nt,(function(nt){rt(nt)}))}},8318:function(nt,rt,it){function r(nt){var rt=this;this.next=null,this.entry=null,this.finish=function(){!function(nt,rt){var it=nt.entry;for(nt.entry=null;it;){var at=it.callback;rt.pendingcb--,at(void 0),it=it.next}rt.corkedRequestsFree.next=nt}(rt,nt)}}var at;nt.exports=A,A.WritableState=b;var st,ot={deprecate:it(7839)},lt=it(9299),ut=it(1549).Buffer,ct=it.g.Uint8Array||function(){},dt=it(6163),ht=it(7269).getHighWaterMark,pt=it(3690).q,_t=pt.ERR_INVALID_ARG_TYPE,Et=pt.ERR_METHOD_NOT_IMPLEMENTED,St=pt.ERR_MULTIPLE_CALLBACK,wt=pt.ERR_STREAM_CANNOT_PIPE,Lt=pt.ERR_STREAM_DESTROYED,Ct=pt.ERR_STREAM_NULL_VALUES,Pt=pt.ERR_STREAM_WRITE_AFTER_END,kt=pt.ERR_UNKNOWN_ENCODING,Ot=dt.errorOrDestroy;function S(){}function b(nt,rt,st){at=at||it(6138),nt=nt||{},"boolean"!=typeof st&&(st=rt instanceof at),this.objectMode=!!nt.objectMode,st&&(this.objectMode=this.objectMode||!!nt.writableObjectMode),this.highWaterMark=ht(this,nt,"writableHighWaterMark",st),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var ot=!1===nt.decodeStrings;this.decodeStrings=!ot,this.defaultEncoding=nt.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(nt){!function(nt,rt){var it=nt._writableState,at=it.sync,st=it.writecb;if("function"!=typeof st)throw new St;if(function(nt){nt.writing=!1,nt.writecb=null,nt.length-=nt.writelen,nt.writelen=0}(it),rt)!function(nt,rt,it,at,st){--rt.pendingcb,it?(process.nextTick(st,at),process.nextTick(D,nt,rt),nt._writableState.errorEmitted=!0,Ot(nt,at)):(st(at),nt._writableState.errorEmitted=!0,Ot(nt,at),D(nt,rt))}(nt,it,at,rt,st);else{var ot=N(it)||nt.destroyed;ot||it.corked||it.bufferProcessing||!it.bufferedRequest||w(nt,it),at?process.nextTick(R,nt,it,ot,st):R(nt,it,ot,st)}}(rt,nt)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==nt.emitClose,this.autoDestroy=!!nt.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new r(this)}function A(nt){var rt=this instanceof(at=at||it(6138));if(!rt&&!st.call(A,this))return new A(nt);this._writableState=new b(nt,this,rt),this.writable=!0,nt&&("function"==typeof nt.write&&(this._write=nt.write),"function"==typeof nt.writev&&(this._writev=nt.writev),"function"==typeof nt.destroy&&(this._destroy=nt.destroy),"function"==typeof nt.final&&(this._final=nt.final)),lt.call(this)}function I(nt,rt,it,at,st,ot,lt){rt.writelen=at,rt.writecb=lt,rt.writing=!0,rt.sync=!0,rt.destroyed?rt.onwrite(new Lt("write")):it?nt._writev(st,rt.onwrite):nt._write(st,ot,rt.onwrite),rt.sync=!1}function R(nt,rt,it,at){it||function(nt,rt){0===rt.length&&rt.needDrain&&(rt.needDrain=!1,nt.emit("drain"))}(nt,rt),rt.pendingcb--,at(),D(nt,rt)}function w(nt,rt){rt.bufferProcessing=!0;var it=rt.bufferedRequest;if(nt._writev&&it&&it.next){var at=rt.bufferedRequestCount,st=new Array(at),ot=rt.corkedRequestsFree;ot.entry=it;for(var lt=0,ut=!0;it;)st[lt]=it,it.isBuf||(ut=!1),it=it.next,lt+=1;st.allBuffers=ut,I(nt,rt,!0,rt.length,st,"",ot.finish),rt.pendingcb++,rt.lastBufferedRequest=null,ot.next?(rt.corkedRequestsFree=ot.next,ot.next=null):rt.corkedRequestsFree=new r(rt),rt.bufferedRequestCount=0}else{for(;it;){var ct=it.chunk,dt=it.encoding,ht=it.callback;if(I(nt,rt,!1,rt.objectMode?1:ct.length,ct,dt,ht),it=it.next,rt.bufferedRequestCount--,rt.writing)break}null===it&&(rt.lastBufferedRequest=null)}rt.bufferedRequest=it,rt.bufferProcessing=!1}function N(nt){return nt.ending&&0===nt.length&&null===nt.bufferedRequest&&!nt.finished&&!nt.writing}function C(nt,rt){nt._final((function(it){rt.pendingcb--,it&&Ot(nt,it),rt.prefinished=!0,nt.emit("prefinish"),D(nt,rt)}))}function D(nt,rt){var it=N(rt);if(it&&(function(nt,rt){rt.prefinished||rt.finalCalled||("function"!=typeof nt._final||rt.destroyed?(rt.prefinished=!0,nt.emit("prefinish")):(rt.pendingcb++,rt.finalCalled=!0,process.nextTick(C,nt,rt)))}(nt,rt),0===rt.pendingcb&&(rt.finished=!0,nt.emit("finish"),rt.autoDestroy))){var at=nt._readableState;(!at||at.autoDestroy&&at.endEmitted)&&nt.destroy()}return it}it(1765)(A,lt),b.prototype.getBuffer=function(){for(var nt=this.bufferedRequest,rt=[];nt;)rt.push(nt),nt=nt.next;return rt},function(){try{Object.defineProperty(b.prototype,"buffer",{get:ot.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(nt){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(st=Function.prototype[Symbol.hasInstance],Object.defineProperty(A,Symbol.hasInstance,{value:function(nt){return!!st.call(this,nt)||this===A&&nt&&nt._writableState instanceof b}})):st=function(nt){return nt instanceof this},A.prototype.pipe=function(){Ot(this,new wt)},A.prototype.write=function(nt,rt,it){var at,st=this._writableState,ot=!1,lt=!st.objectMode&&(at=nt,ut.isBuffer(at)||at instanceof ct);return lt&&!ut.isBuffer(nt)&&(nt=function(nt){return ut.from(nt)}(nt)),"function"==typeof rt&&(it=rt,rt=null),lt?rt="buffer":rt||(rt=st.defaultEncoding),"function"!=typeof it&&(it=S),st.ending?function(nt,rt){var it=new Pt;Ot(nt,it),process.nextTick(rt,it)}(this,it):(lt||function(nt,rt,it,at){var st;return null===it?st=new Ct:"string"==typeof it||rt.objectMode||(st=new _t("chunk",["string","Buffer"],it)),!st||(Ot(nt,st),process.nextTick(at,st),!1)}(this,st,nt,it))&&(st.pendingcb++,ot=function(nt,rt,it,at,st,ot){if(!it){var lt=function(nt,rt,it){return nt.objectMode||!1===nt.decodeStrings||"string"!=typeof rt||(rt=ut.from(rt,it)),rt}(rt,at,st);at!==lt&&(it=!0,st="buffer",at=lt)}var ct=rt.objectMode?1:at.length;rt.length+=ct;var dt=rt.length<rt.highWaterMark;if(dt||(rt.needDrain=!0),rt.writing||rt.corked){var ht=rt.lastBufferedRequest;rt.lastBufferedRequest={chunk:at,encoding:st,isBuf:it,callback:ot,next:null},ht?ht.next=rt.lastBufferedRequest:rt.bufferedRequest=rt.lastBufferedRequest,rt.bufferedRequestCount+=1}else I(nt,rt,!1,ct,at,st,ot);return dt}(this,st,lt,nt,rt,it)),ot},A.prototype.cork=function(){this._writableState.corked++},A.prototype.uncork=function(){var nt=this._writableState;nt.corked&&(nt.corked--,nt.writing||nt.corked||nt.bufferProcessing||!nt.bufferedRequest||w(this,nt))},A.prototype.setDefaultEncoding=function(nt){if("string"==typeof nt&&(nt=nt.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((nt+"").toLowerCase())>-1))throw new kt(nt);return this._writableState.defaultEncoding=nt,this},Object.defineProperty(A.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(A.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),A.prototype._write=function(nt,rt,it){it(new Et("_write()"))},A.prototype._writev=null,A.prototype.end=function(nt,rt,it){var at=this._writableState;return"function"==typeof nt?(it=nt,nt=null,rt=null):"function"==typeof rt&&(it=rt,rt=null),null!=nt&&this.write(nt,rt),at.corked&&(at.corked=1,this.uncork()),at.ending||function(nt,rt,it){rt.ending=!0,D(nt,rt),it&&(rt.finished?process.nextTick(it):nt.once("finish",it)),rt.ended=!0,nt.writable=!1}(this,at,it),this},Object.defineProperty(A.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(A.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(nt){this._writableState&&(this._writableState.destroyed=nt)}}),A.prototype.destroy=dt.destroy,A.prototype._undestroy=dt.undestroy,A.prototype._destroy=function(nt,rt){rt(nt)}},7299:function(nt,rt,it){var at;function i(nt,rt,it){return rt in nt?Object.defineProperty(nt,rt,{value:it,enumerable:!0,configurable:!0,writable:!0}):nt[rt]=it,nt}var st=it(8800),ot=Symbol("lastResolve"),lt=Symbol("lastReject"),ut=Symbol("error"),ct=Symbol("ended"),dt=Symbol("lastPromise"),ht=Symbol("handlePromise"),pt=Symbol("stream");function g(nt,rt){return{value:nt,done:rt}}function h(nt){var rt=nt[ot];if(null!==rt){var it=nt[pt].read();null!==it&&(nt[dt]=null,nt[ot]=null,nt[lt]=null,rt(g(it,!1)))}}function p(nt){process.nextTick(h,nt)}var _t=Object.getPrototypeOf((function(){})),Et=Object.setPrototypeOf((i(at={get stream(){return this[pt]},next:function(){var nt=this,rt=this[ut];if(null!==rt)return Promise.reject(rt);if(this[ct])return Promise.resolve(g(void 0,!0));if(this[pt].destroyed)return new Promise((function(rt,it){process.nextTick((function(){nt[ut]?it(nt[ut]):rt(g(void 0,!0))}))}));var it,at=this[dt];if(at)it=new Promise(function(nt,rt){return function(it,at){nt.then((function(){rt[ct]?it(g(void 0,!0)):rt[ht](it,at)}),at)}}(at,this));else{var st=this[pt].read();if(null!==st)return Promise.resolve(g(st,!1));it=new Promise(this[ht])}return this[dt]=it,it}},Symbol.asyncIterator,(function(){return this})),i(at,"return",(function(){var nt=this;return new Promise((function(rt,it){nt[pt].destroy(null,(function(nt){nt?it(nt):rt(g(void 0,!0))}))}))})),at),_t);nt.exports=function(nt){var rt,it=Object.create(Et,(i(rt={},pt,{value:nt,writable:!0}),i(rt,ot,{value:null,writable:!0}),i(rt,lt,{value:null,writable:!0}),i(rt,ut,{value:null,writable:!0}),i(rt,ct,{value:nt._readableState.endEmitted,writable:!0}),i(rt,ht,{value:function(nt,rt){var at=it[pt].read();at?(it[dt]=null,it[ot]=null,it[lt]=null,nt(g(at,!1))):(it[ot]=nt,it[lt]=rt)},writable:!0}),rt));return it[dt]=null,st(nt,(function(nt){if(nt&&"ERR_STREAM_PREMATURE_CLOSE"!==nt.code){var rt=it[lt];return null!==rt&&(it[dt]=null,it[ot]=null,it[lt]=null,rt(nt)),void(it[ut]=nt)}var at=it[ot];null!==at&&(it[dt]=null,it[ot]=null,it[lt]=null,at(g(void 0,!0))),it[ct]=!0})),nt.on("readable",p.bind(null,it)),it}},8393:function(nt,rt,it){function r(nt,rt){var it=Object.keys(nt);if(Object.getOwnPropertySymbols){var at=Object.getOwnPropertySymbols(nt);rt&&(at=at.filter((function(rt){return Object.getOwnPropertyDescriptor(nt,rt).enumerable}))),it.push.apply(it,at)}return it}function i(nt,rt,it){return rt in nt?Object.defineProperty(nt,rt,{value:it,enumerable:!0,configurable:!0,writable:!0}):nt[rt]=it,nt}function a(nt,rt){for(var it=0;it<rt.length;it++){var at=rt[it];at.enumerable=at.enumerable||!1,at.configurable=!0,"value"in at&&(at.writable=!0),Object.defineProperty(nt,at.key,at)}}var at=it(1549).Buffer,st=it(9862).inspect,ot=st&&st.custom||"inspect";nt.exports=function(){function e(){!function(nt,rt){if(!(nt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var nt;return nt=[{key:"push",value:function(nt){var rt={data:nt,next:null};this.length>0?this.tail.next=rt:this.head=rt,this.tail=rt,++this.length}},{key:"unshift",value:function(nt){var rt={data:nt,next:this.head};0===this.length&&(this.tail=rt),this.head=rt,++this.length}},{key:"shift",value:function(){if(0!==this.length){var nt=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,nt}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(nt){if(0===this.length)return"";for(var rt=this.head,it=""+rt.data;rt=rt.next;)it+=nt+rt.data;return it}},{key:"concat",value:function(nt){if(0===this.length)return at.alloc(0);for(var rt,it,st,ot=at.allocUnsafe(nt>>>0),lt=this.head,ut=0;lt;)rt=lt.data,it=ot,st=ut,at.prototype.copy.call(rt,it,st),ut+=lt.data.length,lt=lt.next;return ot}},{key:"consume",value:function(nt,rt){var it;return nt<this.head.data.length?(it=this.head.data.slice(0,nt),this.head.data=this.head.data.slice(nt)):it=nt===this.head.data.length?this.shift():rt?this._getString(nt):this._getBuffer(nt),it}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(nt){var rt=this.head,it=1,at=rt.data;for(nt-=at.length;rt=rt.next;){var st=rt.data,ot=nt>st.length?st.length:nt;if(ot===st.length?at+=st:at+=st.slice(0,nt),0==(nt-=ot)){ot===st.length?(++it,rt.next?this.head=rt.next:this.head=this.tail=null):(this.head=rt,rt.data=st.slice(ot));break}++it}return this.length-=it,at}},{key:"_getBuffer",value:function(nt){var rt=at.allocUnsafe(nt),it=this.head,st=1;for(it.data.copy(rt),nt-=it.data.length;it=it.next;){var ot=it.data,lt=nt>ot.length?ot.length:nt;if(ot.copy(rt,rt.length-nt,0,lt),0==(nt-=lt)){lt===ot.length?(++st,it.next?this.head=it.next:this.head=this.tail=null):(this.head=it,it.data=ot.slice(lt));break}++st}return this.length-=st,rt}},{key:ot,value:function(nt,rt){return st(this,function(nt){for(var rt=1;rt<arguments.length;rt++){var it=null!=arguments[rt]?arguments[rt]:{};rt%2?r(Object(it),!0).forEach((function(rt){i(nt,rt,it[rt])})):Object.getOwnPropertyDescriptors?Object.defineProperties(nt,Object.getOwnPropertyDescriptors(it)):r(Object(it)).forEach((function(rt){Object.defineProperty(nt,rt,Object.getOwnPropertyDescriptor(it,rt))}))}return nt}({},rt,{depth:0,customInspect:!1}))}}],nt&&a(e.prototype,nt),e}()},6163:function(nt){function t(nt,rt){r(nt,rt),n(nt)}function n(nt){nt._writableState&&!nt._writableState.emitClose||nt._readableState&&!nt._readableState.emitClose||nt.emit("close")}function r(nt,rt){nt.emit("error",rt)}nt.exports={destroy:function(nt,rt){var it=this,at=this._readableState&&this._readableState.destroyed,st=this._writableState&&this._writableState.destroyed;return at||st?(rt?rt(nt):nt&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(r,this,nt)):process.nextTick(r,this,nt)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(nt||null,(function(nt){!rt&&nt?it._writableState?it._writableState.errorEmitted?process.nextTick(n,it):(it._writableState.errorEmitted=!0,process.nextTick(t,it,nt)):process.nextTick(t,it,nt):rt?(process.nextTick(n,it),rt(nt)):process.nextTick(n,it)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(nt,rt){var it=nt._readableState,at=nt._writableState;it&&it.autoDestroy||at&&at.autoDestroy?nt.destroy(rt):nt.emit("error",rt)}}},8800:function(nt,rt,it){var at=it(3690).q.ERR_STREAM_PREMATURE_CLOSE;function i(){}nt.exports=function e(nt,rt,it){if("function"==typeof rt)return e(nt,null,rt);rt||(rt={}),it=function(nt){var rt=!1;return function(){if(!rt){rt=!0;for(var it=arguments.length,at=new Array(it),st=0;st<it;st++)at[st]=arguments[st];nt.apply(this,at)}}}(it||i);var st=rt.readable||!1!==rt.readable&&nt.readable,ot=rt.writable||!1!==rt.writable&&nt.writable,u=function(){nt.writable||c()},lt=nt._writableState&&nt._writableState.finished,c=function(){ot=!1,lt=!0,st||it.call(nt)},ut=nt._readableState&&nt._readableState.endEmitted,d=function(){st=!1,ut=!0,ot||it.call(nt)},g=function(rt){it.call(nt,rt)},h=function(){var rt;return st&&!ut?(nt._readableState&&nt._readableState.ended||(rt=new at),it.call(nt,rt)):ot&&!lt?(nt._writableState&&nt._writableState.ended||(rt=new at),it.call(nt,rt)):void 0},p=function(){nt.req.on("finish",c)};return function(nt){return nt.setHeader&&"function"==typeof nt.abort}(nt)?(nt.on("complete",c),nt.on("abort",h),nt.req?p():nt.on("request",p)):ot&&!nt._writableState&&(nt.on("end",u),nt.on("close",u)),nt.on("end",d),nt.on("finish",c),!1!==rt.error&&nt.on("error",g),nt.on("close",h),function(){nt.removeListener("complete",c),nt.removeListener("abort",h),nt.removeListener("request",p),nt.req&&nt.req.removeListener("finish",c),nt.removeListener("end",u),nt.removeListener("close",u),nt.removeListener("finish",c),nt.removeListener("end",d),nt.removeListener("error",g),nt.removeListener("close",h)}}},6233:function(nt){nt.exports=function(){throw new Error("Readable.from is not available in the browser")}},7295:function(nt,rt,it){var at,st=it(3690).q,ot=st.ERR_MISSING_ARGS,lt=st.ERR_STREAM_DESTROYED;function s(nt){if(nt)throw nt}function u(nt,rt,st,ot){ot=function(nt){var rt=!1;return function(){rt||(rt=!0,nt.apply(void 0,arguments))}}(ot);var ut=!1;nt.on("close",(function(){ut=!0})),void 0===at&&(at=it(8800)),at(nt,{readable:rt,writable:st},(function(nt){if(nt)return ot(nt);ut=!0,ot()}));var ct=!1;return function(rt){if(!ut&&!ct)return ct=!0,function(nt){return nt.setHeader&&"function"==typeof nt.abort}(nt)?nt.abort():"function"==typeof nt.destroy?nt.destroy():void ot(rt||new lt("pipe"))}}function l(nt){nt()}function c(nt,rt){return nt.pipe(rt)}function f(nt){return nt.length?"function"!=typeof nt[nt.length-1]?s:nt.pop():s}nt.exports=function(){for(var nt=arguments.length,rt=new Array(nt),it=0;it<nt;it++)rt[it]=arguments[it];var at,st=f(rt);if(Array.isArray(rt[0])&&(rt=rt[0]),rt.length<2)throw new ot("streams");var lt=rt.map((function(nt,it){var ot=it<rt.length-1;return u(nt,ot,it>0,(function(nt){at||(at=nt),nt&&lt.forEach(l),ot||(lt.forEach(l),st(at))}))}));return rt.reduce(c)}},7269:function(nt,rt,it){var at=it(3690).q.ERR_INVALID_OPT_VALUE;nt.exports={getHighWaterMark:function(nt,rt,it,st){var ot=function(nt,rt,it){return null!=nt.highWaterMark?nt.highWaterMark:rt?nt[it]:null}(rt,st,it);if(null!=ot){if(!isFinite(ot)||Math.floor(ot)!==ot||ot<0)throw new at(st?it:"highWaterMark",ot);return Math.floor(ot)}return nt.objectMode?16:16384}}},9299:function(nt,rt,it){nt.exports=it(1159).EventEmitter},7503:function(nt,rt,it){var at=it(8387).Buffer,st=at.isEncoding||function(nt){switch((nt=""+nt)&&nt.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(nt){var rt;switch(this.encoding=function(nt){var rt=function(nt){if(!nt)return"utf8";for(var rt;;)switch(nt){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return nt;default:if(rt)return;nt=(""+nt).toLowerCase(),rt=!0}}(nt);if("string"!=typeof rt&&(at.isEncoding===st||!st(nt)))throw new Error("Unknown encoding: "+nt);return rt||nt}(nt),this.encoding){case"utf16le":this.text=u,this.end=l,rt=4;break;case"utf8":this.fillLast=s,rt=4;break;case"base64":this.text=c,this.end=f,rt=3;break;default:return this.write=d,void(this.end=g)}this.lastNeed=0,this.lastTotal=0,this.lastChar=at.allocUnsafe(rt)}function o(nt){return nt<=127?0:nt>>5==6?2:nt>>4==14?3:nt>>3==30?4:nt>>6==2?-1:-2}function s(nt){var rt=this.lastTotal-this.lastNeed,it=function(nt,rt){if(128!=(192&rt[0]))return nt.lastNeed=0,"�";if(nt.lastNeed>1&&rt.length>1){if(128!=(192&rt[1]))return nt.lastNeed=1,"�";if(nt.lastNeed>2&&rt.length>2&&128!=(192&rt[2]))return nt.lastNeed=2,"�"}}(this,nt);return void 0!==it?it:this.lastNeed<=nt.length?(nt.copy(this.lastChar,rt,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(nt.copy(this.lastChar,rt,0,nt.length),void(this.lastNeed-=nt.length))}function u(nt,rt){if((nt.length-rt)%2==0){var it=nt.toString("utf16le",rt);if(it){var at=it.charCodeAt(it.length-1);if(at>=55296&&at<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=nt[nt.length-2],this.lastChar[1]=nt[nt.length-1],it.slice(0,-1)}return it}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=nt[nt.length-1],nt.toString("utf16le",rt,nt.length-1)}function l(nt){var rt=nt&&nt.length?this.write(nt):"";if(this.lastNeed){var it=this.lastTotal-this.lastNeed;return rt+this.lastChar.toString("utf16le",0,it)}return rt}function c(nt,rt){var it=(nt.length-rt)%3;return 0===it?nt.toString("base64",rt):(this.lastNeed=3-it,this.lastTotal=3,1===it?this.lastChar[0]=nt[nt.length-1]:(this.lastChar[0]=nt[nt.length-2],this.lastChar[1]=nt[nt.length-1]),nt.toString("base64",rt,nt.length-it))}function f(nt){var rt=nt&&nt.length?this.write(nt):"";return this.lastNeed?rt+this.lastChar.toString("base64",0,3-this.lastNeed):rt}function d(nt){return nt.toString(this.encoding)}function g(nt){return nt&&nt.length?this.write(nt):""}rt.s=a,a.prototype.write=function(nt){if(0===nt.length)return"";var rt,it;if(this.lastNeed){if(void 0===(rt=this.fillLast(nt)))return"";it=this.lastNeed,this.lastNeed=0}else it=0;return it<nt.length?rt?rt+this.text(nt,it):this.text(nt,it):rt||""},a.prototype.end=function(nt){var rt=nt&&nt.length?this.write(nt):"";return this.lastNeed?rt+"�":rt},a.prototype.text=function(nt,rt){var it=function(nt,rt,it){var at=rt.length-1;if(at<it)return 0;var st=o(rt[at]);return st>=0?(st>0&&(nt.lastNeed=st-1),st):--at<it||-2===st?0:(st=o(rt[at]))>=0?(st>0&&(nt.lastNeed=st-2),st):--at<it||-2===st?0:(st=o(rt[at]))>=0?(st>0&&(2===st?st=0:nt.lastNeed=st-3),st):0}(this,nt,rt);if(!this.lastNeed)return nt.toString("utf8",rt);this.lastTotal=it;var at=nt.length-(it-this.lastNeed);return nt.copy(this.lastChar,0,at),nt.toString("utf8",rt,at)},a.prototype.fillLast=function(nt){if(this.lastNeed<=nt.length)return nt.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);nt.copy(this.lastChar,this.lastTotal-this.lastNeed,0,nt.length),this.lastNeed-=nt.length}},1067:function(nt,rt,it){var at;!function(st,ot){var lt="function",ut="undefined",ct="object",dt="string",ht="major",pt="model",_t="name",Et="type",St="vendor",wt="version",Lt="architecture",Ct="console",Pt="mobile",kt="tablet",Ot="smarttv",Ft="wearable",Bt="embedded",Ut="Amazon",Gt="Apple",Ht="ASUS",jt="BlackBerry",Kt="Browser",$t="Chrome",Yt="Firefox",Wt="Google",Qt="Huawei",en="LG",nn="Microsoft",an="Motorola",ln="Opera",hn="Samsung",fn="Sharp",pn="Sony",mn="Xiaomi",gn="Zebra",_n="Facebook",vn="Chromium OS",En="Mac OS",j=function(nt){for(var rt={},it=0;it<nt.length;it++)rt[nt[it].toUpperCase()]=nt[it];return rt},H=function(nt,rt){return typeof nt===dt&&-1!==V(rt).indexOf(V(nt))},V=function(nt){return nt.toLowerCase()},K=function(nt,rt){if(typeof nt===dt)return nt=nt.replace(/^\s\s*/,""),typeof rt===ut?nt:nt.substring(0,500)},z=function(nt,rt){for(var it,at,st,ut,dt,ht,pt=0;pt<rt.length&&!dt;){var _t=rt[pt],Et=rt[pt+1];for(it=at=0;it<_t.length&&!dt&&_t[it];)if(dt=_t[it++].exec(nt))for(st=0;st<Et.length;st++)ht=dt[++at],typeof(ut=Et[st])===ct&&ut.length>0?2===ut.length?typeof ut[1]==lt?this[ut[0]]=ut[1].call(this,ht):this[ut[0]]=ut[1]:3===ut.length?typeof ut[1]!==lt||ut[1].exec&&ut[1].test?this[ut[0]]=ht?ht.replace(ut[1],ut[2]):ot:this[ut[0]]=ht?ut[1].call(this,ht,ut[2]):ot:4===ut.length&&(this[ut[0]]=ht?ut[3].call(this,ht.replace(ut[1],ut[2])):ot):this[ut]=ht||ot;pt+=2}},W=function(nt,rt){for(var it in rt)if(typeof rt[it]===ct&&rt[it].length>0){for(var at=0;at<rt[it].length;at++)if(H(rt[it][at],nt))return"?"===it?ot:it}else if(H(rt[it],nt))return"?"===it?ot:it;return nt},Tn={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},bn={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[wt,[_t,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[wt,[_t,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[_t,wt],[/opios[\/ ]+([\w\.]+)/i],[wt,[_t,ln+" Mini"]],[/\bopr\/([\w\.]+)/i],[wt,[_t,ln]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[wt,[_t,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[_t,wt],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[wt,[_t,"UC"+Kt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[wt,[_t,"WeChat"]],[/konqueror\/([\w\.]+)/i],[wt,[_t,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[wt,[_t,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[wt,[_t,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[wt,[_t,"Smart Lenovo "+Kt]],[/(avast|avg)\/([\w\.]+)/i],[[_t,/(.+)/,"$1 Secure "+Kt],wt],[/\bfocus\/([\w\.]+)/i],[wt,[_t,Yt+" Focus"]],[/\bopt\/([\w\.]+)/i],[wt,[_t,ln+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[wt,[_t,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[wt,[_t,"Dolphin"]],[/coast\/([\w\.]+)/i],[wt,[_t,ln+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[wt,[_t,"MIUI "+Kt]],[/fxios\/([-\w\.]+)/i],[wt,[_t,Yt]],[/\bqihu|(qi?ho?o?|360)browser/i],[[_t,"360 "+Kt]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[_t,/(.+)/,"$1 "+Kt],wt],[/samsungbrowser\/([\w\.]+)/i],[wt,[_t,hn+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[_t,/_/g," "],wt],[/metasr[\/ ]?([\d\.]+)/i],[wt,[_t,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[_t,"Sogou Mobile"],wt],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[_t,wt],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[_t],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[_t,_n],wt],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[_t,wt],[/\bgsa\/([\w\.]+) .*safari\//i],[wt,[_t,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[wt,[_t,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[wt,[_t,$t+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[_t,$t+" WebView"],wt],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[wt,[_t,"Android "+Kt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[_t,wt],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[wt,[_t,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[wt,_t],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[_t,[wt,W,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[_t,wt],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[_t,"Netscape"],wt],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[wt,[_t,Yt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[_t,wt],[/(cobalt)\/([\w\.]+)/i],[_t,[wt,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[Lt,"amd64"]],[/(ia32(?=;))/i],[[Lt,V]],[/((?:i[346]|x)86)[;\)]/i],[[Lt,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[Lt,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[Lt,"armhf"]],[/windows (ce|mobile); ppc;/i],[[Lt,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[Lt,/ower/,"",V]],[/(sun4\w)[;\)]/i],[[Lt,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[Lt,V]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[pt,[St,hn],[Et,kt]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[pt,[St,hn],[Et,Pt]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[pt,[St,Gt],[Et,Pt]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[pt,[St,Gt],[Et,kt]],[/(macintosh);/i],[pt,[St,Gt]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[pt,[St,fn],[Et,Pt]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[pt,[St,Qt],[Et,kt]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[pt,[St,Qt],[Et,Pt]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[pt,/_/g," "],[St,mn],[Et,Pt]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[pt,/_/g," "],[St,mn],[Et,kt]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[pt,[St,"OPPO"],[Et,Pt]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[pt,[St,"Vivo"],[Et,Pt]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[pt,[St,"Realme"],[Et,Pt]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[pt,[St,an],[Et,Pt]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[pt,[St,an],[Et,kt]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[pt,[St,en],[Et,kt]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[pt,[St,en],[Et,Pt]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[pt,[St,"Lenovo"],[Et,kt]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[pt,/_/g," "],[St,"Nokia"],[Et,Pt]],[/(pixel c)\b/i],[pt,[St,Wt],[Et,kt]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[pt,[St,Wt],[Et,Pt]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[pt,[St,pn],[Et,Pt]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[pt,"Xperia Tablet"],[St,pn],[Et,kt]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[pt,[St,"OnePlus"],[Et,Pt]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[pt,[St,Ut],[Et,kt]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[pt,/(.+)/g,"Fire Phone $1"],[St,Ut],[Et,Pt]],[/(playbook);[-\w\),; ]+(rim)/i],[pt,St,[Et,kt]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[pt,[St,jt],[Et,Pt]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[pt,[St,Ht],[Et,kt]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[pt,[St,Ht],[Et,Pt]],[/(nexus 9)/i],[pt,[St,"HTC"],[Et,kt]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[St,[pt,/_/g," "],[Et,Pt]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[pt,[St,"Acer"],[Et,kt]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[pt,[St,"Meizu"],[Et,Pt]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[pt,[St,"Ulefone"],[Et,Pt]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[St,pt,[Et,Pt]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[St,pt,[Et,kt]],[/(surface duo)/i],[pt,[St,nn],[Et,kt]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[pt,[St,"Fairphone"],[Et,Pt]],[/(u304aa)/i],[pt,[St,"AT&T"],[Et,Pt]],[/\bsie-(\w*)/i],[pt,[St,"Siemens"],[Et,Pt]],[/\b(rct\w+) b/i],[pt,[St,"RCA"],[Et,kt]],[/\b(venue[\d ]{2,7}) b/i],[pt,[St,"Dell"],[Et,kt]],[/\b(q(?:mv|ta)\w+) b/i],[pt,[St,"Verizon"],[Et,kt]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[pt,[St,"Barnes & Noble"],[Et,kt]],[/\b(tm\d{3}\w+) b/i],[pt,[St,"NuVision"],[Et,kt]],[/\b(k88) b/i],[pt,[St,"ZTE"],[Et,kt]],[/\b(nx\d{3}j) b/i],[pt,[St,"ZTE"],[Et,Pt]],[/\b(gen\d{3}) b.+49h/i],[pt,[St,"Swiss"],[Et,Pt]],[/\b(zur\d{3}) b/i],[pt,[St,"Swiss"],[Et,kt]],[/\b((zeki)?tb.*\b) b/i],[pt,[St,"Zeki"],[Et,kt]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[St,"Dragon Touch"],pt,[Et,kt]],[/\b(ns-?\w{0,9}) b/i],[pt,[St,"Insignia"],[Et,kt]],[/\b((nxa|next)-?\w{0,9}) b/i],[pt,[St,"NextBook"],[Et,kt]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[St,"Voice"],pt,[Et,Pt]],[/\b(lvtel\-)?(v1[12]) b/i],[[St,"LvTel"],pt,[Et,Pt]],[/\b(ph-1) /i],[pt,[St,"Essential"],[Et,Pt]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[pt,[St,"Envizen"],[Et,kt]],[/\b(trio[-\w\. ]+) b/i],[pt,[St,"MachSpeed"],[Et,kt]],[/\btu_(1491) b/i],[pt,[St,"Rotor"],[Et,kt]],[/(shield[\w ]+) b/i],[pt,[St,"Nvidia"],[Et,kt]],[/(sprint) (\w+)/i],[St,pt,[Et,Pt]],[/(kin\.[onetw]{3})/i],[[pt,/\./g," "],[St,nn],[Et,Pt]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[pt,[St,gn],[Et,kt]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[pt,[St,gn],[Et,Pt]],[/smart-tv.+(samsung)/i],[St,[Et,Ot]],[/hbbtv.+maple;(\d+)/i],[[pt,/^/,"SmartTV"],[St,hn],[Et,Ot]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[St,en],[Et,Ot]],[/(apple) ?tv/i],[St,[pt,Gt+" TV"],[Et,Ot]],[/crkey/i],[[pt,$t+"cast"],[St,Wt],[Et,Ot]],[/droid.+aft(\w+)( bui|\))/i],[pt,[St,Ut],[Et,Ot]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[pt,[St,fn],[Et,Ot]],[/(bravia[\w ]+)( bui|\))/i],[pt,[St,pn],[Et,Ot]],[/(mitv-\w{5}) bui/i],[pt,[St,mn],[Et,Ot]],[/Hbbtv.*(technisat) (.*);/i],[St,pt,[Et,Ot]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[St,K],[pt,K],[Et,Ot]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[Et,Ot]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[St,pt,[Et,Ct]],[/droid.+; (shield) bui/i],[pt,[St,"Nvidia"],[Et,Ct]],[/(playstation [345portablevi]+)/i],[pt,[St,pn],[Et,Ct]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[pt,[St,nn],[Et,Ct]],[/((pebble))app/i],[St,pt,[Et,Ft]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[pt,[St,Gt],[Et,Ft]],[/droid.+; (glass) \d/i],[pt,[St,Wt],[Et,Ft]],[/droid.+; (wt63?0{2,3})\)/i],[pt,[St,gn],[Et,Ft]],[/(quest( 2| pro)?)/i],[pt,[St,_n],[Et,Ft]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[St,[Et,Bt]],[/(aeobc)\b/i],[pt,[St,Ut],[Et,Bt]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[pt,[Et,Pt]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[pt,[Et,kt]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[Et,kt]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[Et,Pt]],[/(android[-\w\. ]{0,9});.+buil/i],[pt,[St,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[wt,[_t,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[wt,[_t,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[_t,wt],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[wt,_t]],os:[[/microsoft (windows) (vista|xp)/i],[_t,wt],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[_t,[wt,W,Tn]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[wt,W,Tn],[_t,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[wt,/_/g,"."],[_t,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[_t,En],[wt,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[wt,_t],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[_t,wt],[/\(bb(10);/i],[wt,[_t,jt]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[wt,[_t,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[wt,[_t,Yt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[wt,[_t,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[wt,[_t,"watchOS"]],[/crkey\/([\d\.]+)/i],[wt,[_t,$t+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[_t,vn],wt],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[_t,wt],[/(sunos) ?([\w\.\d]*)/i],[[_t,"Solaris"],wt],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[_t,wt]]},J=function(nt,rt){if(typeof nt===ct&&(rt=nt,nt=ot),!(this instanceof J))return new J(nt,rt).getResult();var it=typeof st!==ut&&st.navigator?st.navigator:ot,at=nt||(it&&it.userAgent?it.userAgent:""),Ct=it&&it.userAgentData?it.userAgentData:ot,Ot=rt?function(nt,rt){var it={};for(var at in nt)rt[at]&&rt[at].length%2==0?it[at]=rt[at].concat(nt[at]):it[at]=nt[at];return it}(bn,rt):bn,Ft=it&&it.userAgent==at;return this.getBrowser=function(){var nt,rt={};return rt[_t]=ot,rt[wt]=ot,z.call(rt,at,Ot.browser),rt[ht]=typeof(nt=rt[wt])===dt?nt.replace(/[^\d\.]/g,"").split(".")[0]:ot,Ft&&it&&it.brave&&typeof it.brave.isBrave==lt&&(rt[_t]="Brave"),rt},this.getCPU=function(){var nt={};return nt[Lt]=ot,z.call(nt,at,Ot.cpu),nt},this.getDevice=function(){var nt={};return nt[St]=ot,nt[pt]=ot,nt[Et]=ot,z.call(nt,at,Ot.device),Ft&&!nt[Et]&&Ct&&Ct.mobile&&(nt[Et]=Pt),Ft&&"Macintosh"==nt[pt]&&it&&typeof it.standalone!==ut&&it.maxTouchPoints&&it.maxTouchPoints>2&&(nt[pt]="iPad",nt[Et]=kt),nt},this.getEngine=function(){var nt={};return nt[_t]=ot,nt[wt]=ot,z.call(nt,at,Ot.engine),nt},this.getOS=function(){var nt={};return nt[_t]=ot,nt[wt]=ot,z.call(nt,at,Ot.os),Ft&&!nt[_t]&&Ct&&"Unknown"!=Ct.platform&&(nt[_t]=Ct.platform.replace(/chrome os/i,vn).replace(/macos/i,En)),nt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return at},this.setUA=function(nt){return at=typeof nt===dt&&nt.length>500?K(nt,500):nt,this},this.setUA(at),this};J.VERSION="1.0.37",J.BROWSER=j([_t,wt,ht]),J.CPU=j([Lt]),J.DEVICE=j([pt,St,Et,Ct,Pt,Ot,kt,Ft,Bt]),J.ENGINE=J.OS=j([_t,wt]),typeof rt!==ut?(nt.exports&&(rt=nt.exports=J),rt.UAParser=J):it.amdO?(at=function(){return J}.call(rt,it,rt,nt))===ot||(nt.exports=at):typeof st!==ut&&(st.UAParser=J);var An=typeof st!==ut&&(st.jQuery||st.Zepto);if(An&&!An.ua){var Rn=new J;An.ua=Rn.getResult(),An.ua.get=function(){return Rn.getUA()},An.ua.set=function(nt){Rn.setUA(nt);var rt=Rn.getResult();for(var it in rt)An.ua[it]=rt[it]}}}("object"==typeof window?window:this)},7839:function(nt,rt,it){function r(nt){try{if(!it.g.localStorage)return!1}catch(nt){return!1}var rt=it.g.localStorage[nt];return null!=rt&&"true"===String(rt).toLowerCase()}nt.exports=function(nt,rt){if(r("noDeprecation"))return nt;var it=!1;return function(){if(!it){if(r("throwDeprecation"))throw new Error(rt);r("traceDeprecation")?console.trace(rt):console.warn(rt),it=!0}return nt.apply(this,arguments)}}},9862:function(){},964:function(){},3165:function(nt){nt.exports=JSON.parse('["mni-beng-in","mni-mtei-in","sat-deva-in","sat-olck-in","shi-latn-ma","shi-tfng-ma","vai-latn-lr","vai-vaii-lr","yue-hans-cn","yue-hant-hk","az-arab-ir","az-cyrl-az","az-latn-az","bm-nkoo-ml","bs-cyrl-ba","bs-latn-ba","en-dsrt-us","ff-adlm-gn","ff-latn-sn","ha-arab-ng","hi-latn-in","iu-latn-ca","ks-arab-in","ks-deva-in","mn-mong-cn","ms-arab-my","pa-arab-pk","pa-guru-in","sd-arab-pk","sd-deva-in","sr-cyrl-rs","sr-latn-rs","su-latn-id","uz-arab-af","uz-cyrl-uz","uz-latn-uz","zh-hans-cn","zh-hant-tw","mni-beng","sat-olck","shi-tfng","vai-vaii","yue-hant","az-latn","bs-latn","ff-latn","jbo-001","ks-arab","pa-guru","prg-001","sd-arab","sr-cyrl","su-latn","uz-latn","zh-hans","agq-cm","ar-001","arn-cl","asa-tz","ast-es","bas-cm","bem-zm","bez-tz","bgn-pk","blt-vn","brx-in","bss-cm","byn-er","cad-us","cch-ng","ccp-bd","ceb-ph","cgg-ug","chr-us","cic-us","ckb-iq","dav-ke","dje-ne","doi-in","dsb-de","dua-cm","dyo-sn","ebu-ke","eo-001","ewo-cm","fil-ph","fur-it","gaa-gh","gez-et","gsw-ch","guz-ke","haw-us","hsb-de","ia-001","ife-tg","io-001","jgo-cm","jmc-tz","kab-dz","kaj-ng","kam-ke","kcg-ng","kde-tz","kea-cv","ken-cm","khq-ml","kkj-cm","kln-ke","kok-in","kpe-lr","ksb-tz","ksf-cm","ksh-de","lag-tz","lkt-us","lrc-ir","luo-ke","luy-ke","mai-in","mas-ke","mer-ke","mfe-mu","mgh-mz","mgo-cm","moh-ca","mua-cm","mus-us","myv-ru","mzn-ir","naq-na","nds-de","nmg-cm","nnh-cm","nqo-gn","nso-za","nus-ss","nyn-ug","osa-us","pcm-ng","quc-gt","rof-tz","rwk-tz","sah-ru","saq-ke","sbp-tz","scn-it","sdh-ir","seh-mz","ses-ml","sid-et","sma-se","smj-se","smn-fi","sms-fi","ssy-er","syr-iq","szl-pl","teo-ug","tig-er","trv-tw","trw-pk","twq-ne","tzm-ma","vo-001","vun-tz","wae-ch","wal-et","wbp-au","xog-ug","yav-cm","yi-001","zgh-ma","aa-et","af-za","ak-gh","am-et","an-es","as-in","ba-ru","be-by","bg-bg","bm-ml","bn-bd","bo-cn","br-fr","ca-es","ce-ru","co-fr","cs-cz","cu-ru","cv-ru","cy-gb","da-dk","de-de","dv-mv","dz-bt","ee-gh","el-gr","en-us","es-es","et-ee","eu-es","fa-ir","fi-fi","fo-fo","fr-fr","fy-nl","ga-ie","gd-gb","gl-es","gn-py","gu-in","gv-im","ha-ng","he-il","hi-in","hr-hr","hu-hu","hy-am","id-id","ig-ng","ii-cn","is-is","it-it","iu-ca","ja-jp","jv-id","ka-ge","ki-ke","kk-kz","kl-gl","km-kh","kn-in","ko-kr","ku-tr","kw-gb","ky-kg","lb-lu","lg-ug","ln-cd","lo-la","lt-lt","lu-cd","lv-lv","mg-mg","mi-nz","mk-mk","ml-in","mn-mn","mr-in","ms-my","mt-mt","my-mm","nb-no","nd-zw","ne-np","nl-nl","nn-no","nr-za","nv-us","ny-mw","oc-fr","om-et","or-in","os-ge","pl-pl","ps-af","pt-br","qu-pe","rm-ch","rn-bi","ro-ro","ru-ru","rw-rw","sa-in","sc-it","se-no","sg-cf","si-lk","sk-sk","sl-si","sn-zw","so-so","sq-al","ss-za","st-za","sv-se","sw-tz","ta-in","te-in","tg-tj","th-th","ti-et","tk-tm","tn-za","to-to","tr-tr","ts-za","tt-ru","ug-cn","uk-ua","ur-pk","ve-za","vi-vn","wa-be","wo-sn","xh-za","yo-ng","zu-za"]')},5813:function(nt){nt.exports=JSON.parse('[{"from":{"field":"script","value":"qaai"},"to":{"field":"script","value":"zinh"}},{"from":{"field":"region","value":"bu"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"ct"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"dd"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"dy"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"fx"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"hv"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"jt"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"mi"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"nh"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"nq"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"pu"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"pz"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"qu"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"rh"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"tp"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"uk"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"vd"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"wk"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"yd"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"zr"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"230"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"280"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"736"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"886"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"958"},"to":{"field":"region","value":"aa"}},{"from":{"field":"region","value":"020"},"to":{"field":"region","value":"ad"}},{"from":{"field":"region","value":"784"},"to":{"field":"region","value":"ae"}},{"from":{"field":"region","value":"004"},"to":{"field":"region","value":"af"}},{"from":{"field":"region","value":"028"},"to":{"field":"region","value":"ag"}},{"from":{"field":"region","value":"660"},"to":{"field":"region","value":"ai"}},{"from":{"field":"region","value":"008"},"to":{"field":"region","value":"al"}},{"from":{"field":"region","value":"051"},"to":{"field":"region","value":"am"}},{"from":{"field":"region","value":"024"},"to":{"field":"region","value":"ao"}},{"from":{"field":"region","value":"010"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"032"},"to":{"field":"region","value":"ar"}},{"from":{"field":"region","value":"016"},"to":{"field":"region","value":"as"}},{"from":{"field":"region","value":"040"},"to":{"field":"region","value":"at"}},{"from":{"field":"region","value":"036"},"to":{"field":"region","value":"au"}},{"from":{"field":"region","value":"533"},"to":{"field":"region","value":"aw"}},{"from":{"field":"region","value":"248"},"to":{"field":"region","value":"ax"}},{"from":{"field":"region","value":"031"},"to":{"field":"region","value":"az"}},{"from":{"field":"region","value":"070"},"to":{"field":"region","value":"ba"}},{"from":{"field":"region","value":"052"},"to":{"field":"region","value":"bb"}},{"from":{"field":"region","value":"050"},"to":{"field":"region","value":"bd"}},{"from":{"field":"region","value":"056"},"to":{"field":"region","value":"be"}},{"from":{"field":"region","value":"854"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"100"},"to":{"field":"region","value":"bg"}},{"from":{"field":"region","value":"048"},"to":{"field":"region","value":"bh"}},{"from":{"field":"region","value":"108"},"to":{"field":"region","value":"bi"}},{"from":{"field":"region","value":"204"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"652"},"to":{"field":"region","value":"bl"}},{"from":{"field":"region","value":"060"},"to":{"field":"region","value":"bm"}},{"from":{"field":"region","value":"096"},"to":{"field":"region","value":"bn"}},{"from":{"field":"region","value":"068"},"to":{"field":"region","value":"bo"}},{"from":{"field":"region","value":"535"},"to":{"field":"region","value":"bq"}},{"from":{"field":"region","value":"076"},"to":{"field":"region","value":"br"}},{"from":{"field":"region","value":"044"},"to":{"field":"region","value":"bs"}},{"from":{"field":"region","value":"064"},"to":{"field":"region","value":"bt"}},{"from":{"field":"region","value":"104"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"074"},"to":{"field":"region","value":"bv"}},{"from":{"field":"region","value":"072"},"to":{"field":"region","value":"bw"}},{"from":{"field":"region","value":"112"},"to":{"field":"region","value":"by"}},{"from":{"field":"region","value":"084"},"to":{"field":"region","value":"bz"}},{"from":{"field":"region","value":"124"},"to":{"field":"region","value":"ca"}},{"from":{"field":"region","value":"166"},"to":{"field":"region","value":"cc"}},{"from":{"field":"region","value":"180"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"140"},"to":{"field":"region","value":"cf"}},{"from":{"field":"region","value":"178"},"to":{"field":"region","value":"cg"}},{"from":{"field":"region","value":"756"},"to":{"field":"region","value":"ch"}},{"from":{"field":"region","value":"384"},"to":{"field":"region","value":"ci"}},{"from":{"field":"region","value":"184"},"to":{"field":"region","value":"ck"}},{"from":{"field":"region","value":"152"},"to":{"field":"region","value":"cl"}},{"from":{"field":"region","value":"120"},"to":{"field":"region","value":"cm"}},{"from":{"field":"region","value":"156"},"to":{"field":"region","value":"cn"}},{"from":{"field":"region","value":"170"},"to":{"field":"region","value":"co"}},{"from":{"field":"region","value":"188"},"to":{"field":"region","value":"cr"}},{"from":{"field":"region","value":"192"},"to":{"field":"region","value":"cu"}},{"from":{"field":"region","value":"132"},"to":{"field":"region","value":"cv"}},{"from":{"field":"region","value":"531"},"to":{"field":"region","value":"cw"}},{"from":{"field":"region","value":"162"},"to":{"field":"region","value":"cx"}},{"from":{"field":"region","value":"196"},"to":{"field":"region","value":"cy"}},{"from":{"field":"region","value":"203"},"to":{"field":"region","value":"cz"}},{"from":{"field":"region","value":"278"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"276"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"262"},"to":{"field":"region","value":"dj"}},{"from":{"field":"region","value":"208"},"to":{"field":"region","value":"dk"}},{"from":{"field":"region","value":"212"},"to":{"field":"region","value":"dm"}},{"from":{"field":"region","value":"214"},"to":{"field":"region","value":"do"}},{"from":{"field":"region","value":"012"},"to":{"field":"region","value":"dz"}},{"from":{"field":"region","value":"218"},"to":{"field":"region","value":"ec"}},{"from":{"field":"region","value":"233"},"to":{"field":"region","value":"ee"}},{"from":{"field":"region","value":"818"},"to":{"field":"region","value":"eg"}},{"from":{"field":"region","value":"732"},"to":{"field":"region","value":"eh"}},{"from":{"field":"region","value":"232"},"to":{"field":"region","value":"er"}},{"from":{"field":"region","value":"724"},"to":{"field":"region","value":"es"}},{"from":{"field":"region","value":"231"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"246"},"to":{"field":"region","value":"fi"}},{"from":{"field":"region","value":"242"},"to":{"field":"region","value":"fj"}},{"from":{"field":"region","value":"238"},"to":{"field":"region","value":"fk"}},{"from":{"field":"region","value":"583"},"to":{"field":"region","value":"fm"}},{"from":{"field":"region","value":"234"},"to":{"field":"region","value":"fo"}},{"from":{"field":"region","value":"250"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"249"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"266"},"to":{"field":"region","value":"ga"}},{"from":{"field":"region","value":"826"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"308"},"to":{"field":"region","value":"gd"}},{"from":{"field":"region","value":"268"},"to":{"field":"region","value":"ge"}},{"from":{"field":"region","value":"254"},"to":{"field":"region","value":"gf"}},{"from":{"field":"region","value":"831"},"to":{"field":"region","value":"gg"}},{"from":{"field":"region","value":"288"},"to":{"field":"region","value":"gh"}},{"from":{"field":"region","value":"292"},"to":{"field":"region","value":"gi"}},{"from":{"field":"region","value":"304"},"to":{"field":"region","value":"gl"}},{"from":{"field":"region","value":"270"},"to":{"field":"region","value":"gm"}},{"from":{"field":"region","value":"324"},"to":{"field":"region","value":"gn"}},{"from":{"field":"region","value":"312"},"to":{"field":"region","value":"gp"}},{"from":{"field":"region","value":"226"},"to":{"field":"region","value":"gq"}},{"from":{"field":"region","value":"300"},"to":{"field":"region","value":"gr"}},{"from":{"field":"region","value":"239"},"to":{"field":"region","value":"gs"}},{"from":{"field":"region","value":"320"},"to":{"field":"region","value":"gt"}},{"from":{"field":"region","value":"316"},"to":{"field":"region","value":"gu"}},{"from":{"field":"region","value":"624"},"to":{"field":"region","value":"gw"}},{"from":{"field":"region","value":"328"},"to":{"field":"region","value":"gy"}},{"from":{"field":"region","value":"344"},"to":{"field":"region","value":"hk"}},{"from":{"field":"region","value":"334"},"to":{"field":"region","value":"hm"}},{"from":{"field":"region","value":"340"},"to":{"field":"region","value":"hn"}},{"from":{"field":"region","value":"191"},"to":{"field":"region","value":"hr"}},{"from":{"field":"region","value":"332"},"to":{"field":"region","value":"ht"}},{"from":{"field":"region","value":"348"},"to":{"field":"region","value":"hu"}},{"from":{"field":"region","value":"360"},"to":{"field":"region","value":"id"}},{"from":{"field":"region","value":"372"},"to":{"field":"region","value":"ie"}},{"from":{"field":"region","value":"376"},"to":{"field":"region","value":"il"}},{"from":{"field":"region","value":"833"},"to":{"field":"region","value":"im"}},{"from":{"field":"region","value":"356"},"to":{"field":"region","value":"in"}},{"from":{"field":"region","value":"086"},"to":{"field":"region","value":"io"}},{"from":{"field":"region","value":"368"},"to":{"field":"region","value":"iq"}},{"from":{"field":"region","value":"364"},"to":{"field":"region","value":"ir"}},{"from":{"field":"region","value":"352"},"to":{"field":"region","value":"is"}},{"from":{"field":"region","value":"380"},"to":{"field":"region","value":"it"}},{"from":{"field":"region","value":"832"},"to":{"field":"region","value":"je"}},{"from":{"field":"region","value":"388"},"to":{"field":"region","value":"jm"}},{"from":{"field":"region","value":"400"},"to":{"field":"region","value":"jo"}},{"from":{"field":"region","value":"392"},"to":{"field":"region","value":"jp"}},{"from":{"field":"region","value":"404"},"to":{"field":"region","value":"ke"}},{"from":{"field":"region","value":"417"},"to":{"field":"region","value":"kg"}},{"from":{"field":"region","value":"116"},"to":{"field":"region","value":"kh"}},{"from":{"field":"region","value":"296"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"174"},"to":{"field":"region","value":"km"}},{"from":{"field":"region","value":"659"},"to":{"field":"region","value":"kn"}},{"from":{"field":"region","value":"408"},"to":{"field":"region","value":"kp"}},{"from":{"field":"region","value":"410"},"to":{"field":"region","value":"kr"}},{"from":{"field":"region","value":"414"},"to":{"field":"region","value":"kw"}},{"from":{"field":"region","value":"136"},"to":{"field":"region","value":"ky"}},{"from":{"field":"region","value":"398"},"to":{"field":"region","value":"kz"}},{"from":{"field":"region","value":"418"},"to":{"field":"region","value":"la"}},{"from":{"field":"region","value":"422"},"to":{"field":"region","value":"lb"}},{"from":{"field":"region","value":"662"},"to":{"field":"region","value":"lc"}},{"from":{"field":"region","value":"438"},"to":{"field":"region","value":"li"}},{"from":{"field":"region","value":"144"},"to":{"field":"region","value":"lk"}},{"from":{"field":"region","value":"430"},"to":{"field":"region","value":"lr"}},{"from":{"field":"region","value":"426"},"to":{"field":"region","value":"ls"}},{"from":{"field":"region","value":"440"},"to":{"field":"region","value":"lt"}},{"from":{"field":"region","value":"442"},"to":{"field":"region","value":"lu"}},{"from":{"field":"region","value":"428"},"to":{"field":"region","value":"lv"}},{"from":{"field":"region","value":"434"},"to":{"field":"region","value":"ly"}},{"from":{"field":"region","value":"504"},"to":{"field":"region","value":"ma"}},{"from":{"field":"region","value":"492"},"to":{"field":"region","value":"mc"}},{"from":{"field":"region","value":"498"},"to":{"field":"region","value":"md"}},{"from":{"field":"region","value":"499"},"to":{"field":"region","value":"me"}},{"from":{"field":"region","value":"663"},"to":{"field":"region","value":"mf"}},{"from":{"field":"region","value":"450"},"to":{"field":"region","value":"mg"}},{"from":{"field":"region","value":"584"},"to":{"field":"region","value":"mh"}},{"from":{"field":"region","value":"807"},"to":{"field":"region","value":"mk"}},{"from":{"field":"region","value":"466"},"to":{"field":"region","value":"ml"}},{"from":{"field":"region","value":"496"},"to":{"field":"region","value":"mn"}},{"from":{"field":"region","value":"446"},"to":{"field":"region","value":"mo"}},{"from":{"field":"region","value":"580"},"to":{"field":"region","value":"mp"}},{"from":{"field":"region","value":"474"},"to":{"field":"region","value":"mq"}},{"from":{"field":"region","value":"478"},"to":{"field":"region","value":"mr"}},{"from":{"field":"region","value":"500"},"to":{"field":"region","value":"ms"}},{"from":{"field":"region","value":"470"},"to":{"field":"region","value":"mt"}},{"from":{"field":"region","value":"480"},"to":{"field":"region","value":"mu"}},{"from":{"field":"region","value":"462"},"to":{"field":"region","value":"mv"}},{"from":{"field":"region","value":"454"},"to":{"field":"region","value":"mw"}},{"from":{"field":"region","value":"484"},"to":{"field":"region","value":"mx"}},{"from":{"field":"region","value":"458"},"to":{"field":"region","value":"my"}},{"from":{"field":"region","value":"508"},"to":{"field":"region","value":"mz"}},{"from":{"field":"region","value":"516"},"to":{"field":"region","value":"na"}},{"from":{"field":"region","value":"540"},"to":{"field":"region","value":"nc"}},{"from":{"field":"region","value":"562"},"to":{"field":"region","value":"ne"}},{"from":{"field":"region","value":"574"},"to":{"field":"region","value":"nf"}},{"from":{"field":"region","value":"566"},"to":{"field":"region","value":"ng"}},{"from":{"field":"region","value":"558"},"to":{"field":"region","value":"ni"}},{"from":{"field":"region","value":"528"},"to":{"field":"region","value":"nl"}},{"from":{"field":"region","value":"578"},"to":{"field":"region","value":"no"}},{"from":{"field":"region","value":"524"},"to":{"field":"region","value":"np"}},{"from":{"field":"region","value":"520"},"to":{"field":"region","value":"nr"}},{"from":{"field":"region","value":"570"},"to":{"field":"region","value":"nu"}},{"from":{"field":"region","value":"554"},"to":{"field":"region","value":"nz"}},{"from":{"field":"region","value":"512"},"to":{"field":"region","value":"om"}},{"from":{"field":"region","value":"591"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"604"},"to":{"field":"region","value":"pe"}},{"from":{"field":"region","value":"258"},"to":{"field":"region","value":"pf"}},{"from":{"field":"region","value":"598"},"to":{"field":"region","value":"pg"}},{"from":{"field":"region","value":"608"},"to":{"field":"region","value":"ph"}},{"from":{"field":"region","value":"586"},"to":{"field":"region","value":"pk"}},{"from":{"field":"region","value":"616"},"to":{"field":"region","value":"pl"}},{"from":{"field":"region","value":"666"},"to":{"field":"region","value":"pm"}},{"from":{"field":"region","value":"612"},"to":{"field":"region","value":"pn"}},{"from":{"field":"region","value":"630"},"to":{"field":"region","value":"pr"}},{"from":{"field":"region","value":"275"},"to":{"field":"region","value":"ps"}},{"from":{"field":"region","value":"620"},"to":{"field":"region","value":"pt"}},{"from":{"field":"region","value":"585"},"to":{"field":"region","value":"pw"}},{"from":{"field":"region","value":"600"},"to":{"field":"region","value":"py"}},{"from":{"field":"region","value":"634"},"to":{"field":"region","value":"qa"}},{"from":{"field":"region","value":"959"},"to":{"field":"region","value":"qm"}},{"from":{"field":"region","value":"960"},"to":{"field":"region","value":"qn"}},{"from":{"field":"region","value":"962"},"to":{"field":"region","value":"qp"}},{"from":{"field":"region","value":"963"},"to":{"field":"region","value":"qq"}},{"from":{"field":"region","value":"964"},"to":{"field":"region","value":"qr"}},{"from":{"field":"region","value":"965"},"to":{"field":"region","value":"qs"}},{"from":{"field":"region","value":"966"},"to":{"field":"region","value":"qt"}},{"from":{"field":"region","value":"967"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"968"},"to":{"field":"region","value":"qv"}},{"from":{"field":"region","value":"969"},"to":{"field":"region","value":"qw"}},{"from":{"field":"region","value":"970"},"to":{"field":"region","value":"qx"}},{"from":{"field":"region","value":"971"},"to":{"field":"region","value":"qy"}},{"from":{"field":"region","value":"972"},"to":{"field":"region","value":"qz"}},{"from":{"field":"region","value":"638"},"to":{"field":"region","value":"re"}},{"from":{"field":"region","value":"642"},"to":{"field":"region","value":"ro"}},{"from":{"field":"region","value":"688"},"to":{"field":"region","value":"rs"}},{"from":{"field":"region","value":"643"},"to":{"field":"region","value":"ru"}},{"from":{"field":"region","value":"646"},"to":{"field":"region","value":"rw"}},{"from":{"field":"region","value":"682"},"to":{"field":"region","value":"sa"}},{"from":{"field":"region","value":"090"},"to":{"field":"region","value":"sb"}},{"from":{"field":"region","value":"690"},"to":{"field":"region","value":"sc"}},{"from":{"field":"region","value":"729"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"752"},"to":{"field":"region","value":"se"}},{"from":{"field":"region","value":"702"},"to":{"field":"region","value":"sg"}},{"from":{"field":"region","value":"654"},"to":{"field":"region","value":"sh"}},{"from":{"field":"region","value":"705"},"to":{"field":"region","value":"si"}},{"from":{"field":"region","value":"744"},"to":{"field":"region","value":"sj"}},{"from":{"field":"region","value":"703"},"to":{"field":"region","value":"sk"}},{"from":{"field":"region","value":"694"},"to":{"field":"region","value":"sl"}},{"from":{"field":"region","value":"674"},"to":{"field":"region","value":"sm"}},{"from":{"field":"region","value":"686"},"to":{"field":"region","value":"sn"}},{"from":{"field":"region","value":"706"},"to":{"field":"region","value":"so"}},{"from":{"field":"region","value":"740"},"to":{"field":"region","value":"sr"}},{"from":{"field":"region","value":"728"},"to":{"field":"region","value":"ss"}},{"from":{"field":"region","value":"678"},"to":{"field":"region","value":"st"}},{"from":{"field":"region","value":"222"},"to":{"field":"region","value":"sv"}},{"from":{"field":"region","value":"534"},"to":{"field":"region","value":"sx"}},{"from":{"field":"region","value":"760"},"to":{"field":"region","value":"sy"}},{"from":{"field":"region","value":"748"},"to":{"field":"region","value":"sz"}},{"from":{"field":"region","value":"796"},"to":{"field":"region","value":"tc"}},{"from":{"field":"region","value":"148"},"to":{"field":"region","value":"td"}},{"from":{"field":"region","value":"260"},"to":{"field":"region","value":"tf"}},{"from":{"field":"region","value":"768"},"to":{"field":"region","value":"tg"}},{"from":{"field":"region","value":"764"},"to":{"field":"region","value":"th"}},{"from":{"field":"region","value":"762"},"to":{"field":"region","value":"tj"}},{"from":{"field":"region","value":"772"},"to":{"field":"region","value":"tk"}},{"from":{"field":"region","value":"626"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"795"},"to":{"field":"region","value":"tm"}},{"from":{"field":"region","value":"788"},"to":{"field":"region","value":"tn"}},{"from":{"field":"region","value":"776"},"to":{"field":"region","value":"to"}},{"from":{"field":"region","value":"792"},"to":{"field":"region","value":"tr"}},{"from":{"field":"region","value":"780"},"to":{"field":"region","value":"tt"}},{"from":{"field":"region","value":"798"},"to":{"field":"region","value":"tv"}},{"from":{"field":"region","value":"158"},"to":{"field":"region","value":"tw"}},{"from":{"field":"region","value":"834"},"to":{"field":"region","value":"tz"}},{"from":{"field":"region","value":"804"},"to":{"field":"region","value":"ua"}},{"from":{"field":"region","value":"800"},"to":{"field":"region","value":"ug"}},{"from":{"field":"region","value":"581"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"840"},"to":{"field":"region","value":"us"}},{"from":{"field":"region","value":"858"},"to":{"field":"region","value":"uy"}},{"from":{"field":"region","value":"860"},"to":{"field":"region","value":"uz"}},{"from":{"field":"region","value":"336"},"to":{"field":"region","value":"va"}},{"from":{"field":"region","value":"670"},"to":{"field":"region","value":"vc"}},{"from":{"field":"region","value":"862"},"to":{"field":"region","value":"ve"}},{"from":{"field":"region","value":"092"},"to":{"field":"region","value":"vg"}},{"from":{"field":"region","value":"850"},"to":{"field":"region","value":"vi"}},{"from":{"field":"region","value":"704"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"548"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"876"},"to":{"field":"region","value":"wf"}},{"from":{"field":"region","value":"882"},"to":{"field":"region","value":"ws"}},{"from":{"field":"region","value":"973"},"to":{"field":"region","value":"xa"}},{"from":{"field":"region","value":"974"},"to":{"field":"region","value":"xb"}},{"from":{"field":"region","value":"975"},"to":{"field":"region","value":"xc"}},{"from":{"field":"region","value":"976"},"to":{"field":"region","value":"xd"}},{"from":{"field":"region","value":"977"},"to":{"field":"region","value":"xe"}},{"from":{"field":"region","value":"978"},"to":{"field":"region","value":"xf"}},{"from":{"field":"region","value":"979"},"to":{"field":"region","value":"xg"}},{"from":{"field":"region","value":"980"},"to":{"field":"region","value":"xh"}},{"from":{"field":"region","value":"981"},"to":{"field":"region","value":"xi"}},{"from":{"field":"region","value":"982"},"to":{"field":"region","value":"xj"}},{"from":{"field":"region","value":"983"},"to":{"field":"region","value":"xk"}},{"from":{"field":"region","value":"984"},"to":{"field":"region","value":"xl"}},{"from":{"field":"region","value":"985"},"to":{"field":"region","value":"xm"}},{"from":{"field":"region","value":"986"},"to":{"field":"region","value":"xn"}},{"from":{"field":"region","value":"987"},"to":{"field":"region","value":"xo"}},{"from":{"field":"region","value":"988"},"to":{"field":"region","value":"xp"}},{"from":{"field":"region","value":"989"},"to":{"field":"region","value":"xq"}},{"from":{"field":"region","value":"990"},"to":{"field":"region","value":"xr"}},{"from":{"field":"region","value":"991"},"to":{"field":"region","value":"xs"}},{"from":{"field":"region","value":"992"},"to":{"field":"region","value":"xt"}},{"from":{"field":"region","value":"993"},"to":{"field":"region","value":"xu"}},{"from":{"field":"region","value":"994"},"to":{"field":"region","value":"xv"}},{"from":{"field":"region","value":"995"},"to":{"field":"region","value":"xw"}},{"from":{"field":"region","value":"996"},"to":{"field":"region","value":"xx"}},{"from":{"field":"region","value":"997"},"to":{"field":"region","value":"xy"}},{"from":{"field":"region","value":"998"},"to":{"field":"region","value":"xz"}},{"from":{"field":"region","value":"720"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"887"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"175"},"to":{"field":"region","value":"yt"}},{"from":{"field":"region","value":"710"},"to":{"field":"region","value":"za"}},{"from":{"field":"region","value":"894"},"to":{"field":"region","value":"zm"}},{"from":{"field":"region","value":"716"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"999"},"to":{"field":"region","value":"zz"}},{"from":{"field":"variants","value":"aaland"},"to":{"field":"region","value":"ax"}},{"from":{"field":"variants","value":"polytoni"},"to":{"field":"variants","value":"polyton"}},{"from":{"field":"variants","value":"heploc"},"to":{"field":"variants","value":"alalc97"}},{"from":{"field":"variants","value":"arevela"},"to":{"field":"language","value":"hy"}},{"from":{"field":"variants","value":"arevmda"},"to":{"field":"language","value":"hyw"}}]')},9460:function(nt){nt.exports=JSON.parse('{"region":{"172":["ru","am","az","by","ge","kg","kz","md","tj","tm","ua","uz"],"200":["cz","sk"],"530":["cw","sx","bq"],"532":["cw","sx","bq"],"536":["sa","iq"],"582":["fm","mh","mp","pw"],"810":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"830":["je","gg"],"890":["rs","me","si","hr","mk","ba"],"891":["rs","me"],"an":["cw","sx","bq"],"cs":["rs","me"],"fq":["aq","tf"],"nt":["sa","iq"],"pc":["fm","mh","mp","pw"],"su":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yu":["rs","me"],"062":["034","143"],"ant":["cw","sx","bq"],"scg":["rs","me"],"ntz":["sa","iq"],"sun":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yug":["rs","me"]}}')},7778:function(nt){nt.exports=JSON.parse('[{"from":"in","to":"id"},{"from":"iw","to":"he"},{"from":"ji","to":"yi"},{"from":"jw","to":"jv"},{"from":"mo","to":"ro"},{"from":"scc","to":"sr"},{"from":"scr","to":"hr"},{"from":"aam","to":"aas"},{"from":"adp","to":"dz"},{"from":"aue","to":"ktz"},{"from":"ayx","to":"nun"},{"from":"bgm","to":"bcg"},{"from":"bjd","to":"drl"},{"from":"ccq","to":"rki"},{"from":"cjr","to":"mom"},{"from":"cka","to":"cmr"},{"from":"cmk","to":"xch"},{"from":"coy","to":"pij"},{"from":"cqu","to":"quh"},{"from":"drh","to":"mn"},{"from":"drw","to":"fa-af"},{"from":"gav","to":"dev"},{"from":"gfx","to":"vaj"},{"from":"ggn","to":"gvr"},{"from":"gti","to":"nyc"},{"from":"guv","to":"duz"},{"from":"hrr","to":"jal"},{"from":"ibi","to":"opa"},{"from":"ilw","to":"gal"},{"from":"jeg","to":"oyb"},{"from":"kgc","to":"tdf"},{"from":"kgh","to":"kml"},{"from":"koj","to":"kwv"},{"from":"krm","to":"bmf"},{"from":"ktr","to":"dtp"},{"from":"kvs","to":"gdj"},{"from":"kwq","to":"yam"},{"from":"kxe","to":"tvd"},{"from":"kzj","to":"dtp"},{"from":"kzt","to":"dtp"},{"from":"lii","to":"raq"},{"from":"lmm","to":"rmx"},{"from":"meg","to":"cir"},{"from":"mst","to":"mry"},{"from":"mwj","to":"vaj"},{"from":"myt","to":"mry"},{"from":"nad","to":"xny"},{"from":"ncp","to":"kdz"},{"from":"nnx","to":"ngv"},{"from":"nts","to":"pij"},{"from":"oun","to":"vaj"},{"from":"pcr","to":"adx"},{"from":"pmc","to":"huw"},{"from":"pmu","to":"phr"},{"from":"ppa","to":"bfy"},{"from":"ppr","to":"lcq"},{"from":"pry","to":"prt"},{"from":"puz","to":"pub"},{"from":"sca","to":"hle"},{"from":"skk","to":"oyb"},{"from":"tdu","to":"dtp"},{"from":"thc","to":"tpo"},{"from":"thx","to":"oyb"},{"from":"tie","to":"ras"},{"from":"tkk","to":"twm"},{"from":"tlw","to":"weo"},{"from":"tmp","to":"tyj"},{"from":"tne","to":"kak"},{"from":"tnf","to":"fa-af"},{"from":"tsf","to":"taj"},{"from":"uok","to":"ema"},{"from":"xba","to":"cax"},{"from":"xia","to":"acn"},{"from":"xkh","to":"waw"},{"from":"xsj","to":"suj"},{"from":"ybd","to":"rki"},{"from":"yma","to":"lrr"},{"from":"ymt","to":"mtm"},{"from":"yos","to":"zom"},{"from":"yuu","to":"yug"},{"from":"asd","to":"snz"},{"from":"dit","to":"dif"},{"from":"llo","to":"ngt"},{"from":"myd","to":"aog"},{"from":"nns","to":"nbr"},{"from":"sgn-br","to":"bzs"},{"from":"sgn-co","to":"csn"},{"from":"sgn-de","to":"gsg"},{"from":"sgn-dk","to":"dsl"},{"from":"sgn-fr","to":"fsl"},{"from":"sgn-gb","to":"bfi"},{"from":"sgn-gr","to":"gss"},{"from":"sgn-ie","to":"isg"},{"from":"sgn-it","to":"ise"},{"from":"sgn-jp","to":"jsl"},{"from":"sgn-mx","to":"mfs"},{"from":"sgn-ni","to":"ncs"},{"from":"sgn-nl","to":"dse"},{"from":"sgn-no","to":"nsi"},{"from":"sgn-pt","to":"psr"},{"from":"sgn-se","to":"swl"},{"from":"sgn-us","to":"ase"},{"from":"sgn-za","to":"sfs"},{"from":"no-bokmal","to":"nb"},{"from":"no-nynorsk","to":"nn"},{"from":"aa-saaho","to":"ssy"},{"from":"sh","to":"sr-latn"},{"from":"cnr","to":"sr-me"},{"from":"no","to":"nb"},{"from":"tl","to":"fil"},{"from":"az-az","to":"az-latn-az"},{"from":"bs-ba","to":"bs-latn-ba"},{"from":"ha-latn-gh","to":"ha-gh"},{"from":"ha-latn-ne","to":"ha-ne"},{"from":"ha-latn-ng","to":"ha-ng"},{"from":"kk-cyrl-kz","to":"kk-kz"},{"from":"ky-cyrl-kg","to":"ky-kg"},{"from":"ks-arab-in","to":"ks-in"},{"from":"mn-cyrl-mn","to":"mn-mn"},{"from":"ms-latn-bn","to":"ms-bn"},{"from":"ms-latn-my","to":"ms-my"},{"from":"ms-latn-sg","to":"ms-sg"},{"from":"pa-in","to":"pa-guru-in"},{"from":"pa-pk","to":"pa-arab-pk"},{"from":"shi-ma","to":"shi-tfng-ma"},{"from":"sr-ba","to":"sr-cyrl-ba"},{"from":"sr-me","to":"sr-latn-me"},{"from":"sr-rs","to":"sr-cyrl-rs"},{"from":"sr-xk","to":"sr-cyrl-xk"},{"from":"tzm-latn-ma","to":"tzm-ma"},{"from":"ug-arab-cn","to":"ug-cn"},{"from":"uz-af","to":"uz-arab-af"},{"from":"uz-uz","to":"uz-latn-uz"},{"from":"vai-lr","to":"vai-vaii-lr"},{"from":"yue-cn","to":"yue-hans-cn"},{"from":"yue-hk","to":"yue-hant-hk"},{"from":"zh-cn","to":"zh-hans-cn"},{"from":"zh-hk","to":"zh-hant-hk"},{"from":"zh-mo","to":"zh-hant-mo"},{"from":"zh-sg","to":"zh-hans-sg"},{"from":"zh-tw","to":"zh-hant-tw"},{"from":"aju","to":"jrb"},{"from":"als","to":"sq"},{"from":"arb","to":"ar"},{"from":"ayr","to":"ay"},{"from":"azj","to":"az"},{"from":"bcc","to":"bal"},{"from":"bcl","to":"bik"},{"from":"bxk","to":"luy"},{"from":"bxr","to":"bua"},{"from":"cld","to":"syr"},{"from":"cmn","to":"zh"},{"from":"cwd","to":"cr"},{"from":"dgo","to":"doi"},{"from":"dhd","to":"mwr"},{"from":"dik","to":"din"},{"from":"diq","to":"zza"},{"from":"lbk","to":"bnc"},{"from":"ekk","to":"et"},{"from":"emk","to":"man"},{"from":"esk","to":"ik"},{"from":"fat","to":"ak"},{"from":"fuc","to":"ff"},{"from":"gaz","to":"om"},{"from":"gbo","to":"grb"},{"from":"gno","to":"gon"},{"from":"gug","to":"gn"},{"from":"gya","to":"gba"},{"from":"hdn","to":"hai"},{"from":"hea","to":"hmn"},{"from":"ike","to":"iu"},{"from":"kmr","to":"ku"},{"from":"knc","to":"kr"},{"from":"kng","to":"kg"},{"from":"knn","to":"kok"},{"from":"kpv","to":"kv"},{"from":"lvs","to":"lv"},{"from":"mhr","to":"chm"},{"from":"mup","to":"raj"},{"from":"khk","to":"mn"},{"from":"npi","to":"ne"},{"from":"ojg","to":"oj"},{"from":"ory","to":"or"},{"from":"pbu","to":"ps"},{"from":"pes","to":"fa"},{"from":"plt","to":"mg"},{"from":"pnb","to":"lah"},{"from":"quz","to":"qu"},{"from":"rmy","to":"rom"},{"from":"spy","to":"kln"},{"from":"src","to":"sc"},{"from":"swh","to":"sw"},{"from":"ttq","to":"tmh"},{"from":"tw","to":"ak"},{"from":"umu","to":"del"},{"from":"uzn","to":"uz"},{"from":"xpe","to":"kpe"},{"from":"xsl","to":"den"},{"from":"ydd","to":"yi"},{"from":"zai","to":"zap"},{"from":"zsm","to":"ms"},{"from":"zyb","to":"za"},{"from":"him","to":"srx"},{"from":"mnk","to":"man"},{"from":"bh","to":"bho"},{"from":"prs","to":"fa-af"},{"from":"swc","to":"sw-cd"},{"from":"aar","to":"aa"},{"from":"abk","to":"ab"},{"from":"ave","to":"ae"},{"from":"afr","to":"af"},{"from":"aka","to":"ak"},{"from":"amh","to":"am"},{"from":"arg","to":"an"},{"from":"ara","to":"ar"},{"from":"asm","to":"as"},{"from":"ava","to":"av"},{"from":"aym","to":"ay"},{"from":"aze","to":"az"},{"from":"bak","to":"ba"},{"from":"bel","to":"be"},{"from":"bul","to":"bg"},{"from":"bih","to":"bho"},{"from":"bis","to":"bi"},{"from":"bam","to":"bm"},{"from":"ben","to":"bn"},{"from":"bod","to":"bo"},{"from":"bre","to":"br"},{"from":"bos","to":"bs"},{"from":"cat","to":"ca"},{"from":"che","to":"ce"},{"from":"cha","to":"ch"},{"from":"cos","to":"co"},{"from":"cre","to":"cr"},{"from":"ces","to":"cs"},{"from":"chu","to":"cu"},{"from":"chv","to":"cv"},{"from":"cym","to":"cy"},{"from":"dan","to":"da"},{"from":"deu","to":"de"},{"from":"div","to":"dv"},{"from":"dzo","to":"dz"},{"from":"ewe","to":"ee"},{"from":"ell","to":"el"},{"from":"eng","to":"en"},{"from":"epo","to":"eo"},{"from":"spa","to":"es"},{"from":"est","to":"et"},{"from":"eus","to":"eu"},{"from":"fas","to":"fa"},{"from":"ful","to":"ff"},{"from":"fin","to":"fi"},{"from":"fij","to":"fj"},{"from":"fao","to":"fo"},{"from":"fra","to":"fr"},{"from":"fry","to":"fy"},{"from":"gle","to":"ga"},{"from":"gla","to":"gd"},{"from":"glg","to":"gl"},{"from":"grn","to":"gn"},{"from":"guj","to":"gu"},{"from":"glv","to":"gv"},{"from":"hau","to":"ha"},{"from":"heb","to":"he"},{"from":"hin","to":"hi"},{"from":"hmo","to":"ho"},{"from":"hrv","to":"hr"},{"from":"hat","to":"ht"},{"from":"hun","to":"hu"},{"from":"hye","to":"hy"},{"from":"her","to":"hz"},{"from":"ina","to":"ia"},{"from":"ind","to":"id"},{"from":"ile","to":"ie"},{"from":"ibo","to":"ig"},{"from":"iii","to":"ii"},{"from":"ipk","to":"ik"},{"from":"ido","to":"io"},{"from":"isl","to":"is"},{"from":"ita","to":"it"},{"from":"iku","to":"iu"},{"from":"jpn","to":"ja"},{"from":"jav","to":"jv"},{"from":"kat","to":"ka"},{"from":"kon","to":"kg"},{"from":"kik","to":"ki"},{"from":"kua","to":"kj"},{"from":"kaz","to":"kk"},{"from":"kal","to":"kl"},{"from":"khm","to":"km"},{"from":"kan","to":"kn"},{"from":"kor","to":"ko"},{"from":"kau","to":"kr"},{"from":"kas","to":"ks"},{"from":"kur","to":"ku"},{"from":"kom","to":"kv"},{"from":"cor","to":"kw"},{"from":"kir","to":"ky"},{"from":"lat","to":"la"},{"from":"ltz","to":"lb"},{"from":"lug","to":"lg"},{"from":"lim","to":"li"},{"from":"lin","to":"ln"},{"from":"lao","to":"lo"},{"from":"lit","to":"lt"},{"from":"lub","to":"lu"},{"from":"lav","to":"lv"},{"from":"mlg","to":"mg"},{"from":"mah","to":"mh"},{"from":"mri","to":"mi"},{"from":"mkd","to":"mk"},{"from":"mal","to":"ml"},{"from":"mon","to":"mn"},{"from":"mol","to":"ro"},{"from":"mar","to":"mr"},{"from":"msa","to":"ms"},{"from":"mlt","to":"mt"},{"from":"mya","to":"my"},{"from":"nau","to":"na"},{"from":"nob","to":"nb"},{"from":"nde","to":"nd"},{"from":"nep","to":"ne"},{"from":"ndo","to":"ng"},{"from":"nld","to":"nl"},{"from":"nno","to":"nn"},{"from":"nor","to":"nb"},{"from":"nbl","to":"nr"},{"from":"nav","to":"nv"},{"from":"nya","to":"ny"},{"from":"oci","to":"oc"},{"from":"oji","to":"oj"},{"from":"orm","to":"om"},{"from":"ori","to":"or"},{"from":"oss","to":"os"},{"from":"pan","to":"pa"},{"from":"pli","to":"pi"},{"from":"pol","to":"pl"},{"from":"pus","to":"ps"},{"from":"por","to":"pt"},{"from":"que","to":"qu"},{"from":"roh","to":"rm"},{"from":"run","to":"rn"},{"from":"ron","to":"ro"},{"from":"rus","to":"ru"},{"from":"kin","to":"rw"},{"from":"san","to":"sa"},{"from":"srd","to":"sc"},{"from":"snd","to":"sd"},{"from":"sme","to":"se"},{"from":"sag","to":"sg"},{"from":"hbs","to":"sr-latn"},{"from":"sin","to":"si"},{"from":"slk","to":"sk"},{"from":"slv","to":"sl"},{"from":"smo","to":"sm"},{"from":"sna","to":"sn"},{"from":"som","to":"so"},{"from":"sqi","to":"sq"},{"from":"srp","to":"sr"},{"from":"ssw","to":"ss"},{"from":"sot","to":"st"},{"from":"sun","to":"su"},{"from":"swe","to":"sv"},{"from":"swa","to":"sw"},{"from":"tam","to":"ta"},{"from":"tel","to":"te"},{"from":"tgk","to":"tg"},{"from":"tha","to":"th"},{"from":"tir","to":"ti"},{"from":"tuk","to":"tk"},{"from":"tgl","to":"fil"},{"from":"tsn","to":"tn"},{"from":"ton","to":"to"},{"from":"tur","to":"tr"},{"from":"tso","to":"ts"},{"from":"tat","to":"tt"},{"from":"twi","to":"ak"},{"from":"tah","to":"ty"},{"from":"uig","to":"ug"},{"from":"ukr","to":"uk"},{"from":"urd","to":"ur"},{"from":"uzb","to":"uz"},{"from":"ven","to":"ve"},{"from":"vie","to":"vi"},{"from":"vol","to":"vo"},{"from":"wln","to":"wa"},{"from":"wol","to":"wo"},{"from":"xho","to":"xh"},{"from":"yid","to":"yi"},{"from":"yor","to":"yo"},{"from":"zha","to":"za"},{"from":"zho","to":"zh"},{"from":"zul","to":"zu"},{"from":"alb","to":"sq"},{"from":"arm","to":"hy"},{"from":"baq","to":"eu"},{"from":"bur","to":"my"},{"from":"chi","to":"zh"},{"from":"cze","to":"cs"},{"from":"dut","to":"nl"},{"from":"fre","to":"fr"},{"from":"geo","to":"ka"},{"from":"ger","to":"de"},{"from":"gre","to":"el"},{"from":"ice","to":"is"},{"from":"mac","to":"mk"},{"from":"mao","to":"mi"},{"from":"may","to":"ms"},{"from":"per","to":"fa"},{"from":"rum","to":"ro"},{"from":"slo","to":"sk"},{"from":"tib","to":"bo"},{"from":"wel","to":"cy"}]')},8589:function(nt){nt.exports=JSON.parse('{"en-gb-oed":"en-GB-oxendict","i-ami":"ami","i-bnn":"bnn","i-default":null,"i-enochian":null,"i-hak":"hak","i-klingon":"tlh","i-lux":"lb","i-mingo":null,"i-navajo":"nv","i-pwn":"pwn","i-tao":"tao","i-tay":"tay","i-tsu":"tsu","sgn-be-fr":"sfb","sgn-be-nl":"vgt","sgn-ch-de":"sgg","art-lojban":"jbo","cel-gaulish":null,"no-bok":"nb","no-nyn":"nn","zh-guoyu":"cmn","zh-hakka":"hak","zh-min":null,"zh-min-nan":"nan","zh-xiang":"hsn"}')},858:function(nt){nt.exports=JSON.parse('["art-lojban","cel-gaulish","no-bok","no-nyn","zh-guoyu","zh-hakka","zh-min","zh-min-nan","zh-xiang"]')}},rt={};function n(it){var at=rt[it];if(void 0!==at)return at.exports;var st=rt[it]={exports:{}};return nt[it].call(st.exports,st,st.exports,n),st.exports}n.amdO={},n.n=function(nt){var rt=nt&&nt.__esModule?function(){return nt.default}:function(){return nt};return n.d(rt,{a:rt}),rt},n.d=function(nt,rt){for(var it in rt)n.o(rt,it)&&!n.o(nt,it)&&Object.defineProperty(nt,it,{enumerable:!0,get:rt[it]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(nt){if("object"==typeof window)return window}}(),n.o=function(nt,rt){return Object.prototype.hasOwnProperty.call(nt,rt)};var it={};return function(){n.d(it,{default:function(){return dt}}),n(8416);var nt,rt=n(1715),at=n(8080),st=n(1737),ot=n(1139),lt=function(){var nt,rt="application/dash+xml";function n(it,at,st){if(!it||!/^VIDEO$/i.test(it.nodeName))return null;if(it._dashjs_player)return it._dashjs_player;var lt,ut=it.id||it.name||"video element";if(!(at=at||[].slice.call(it.querySelectorAll("source")).filter((function(nt){return nt.type==rt}))[0])&&it.src)(at=document.createElement("source")).src=it.src;else if(!at&&!it.src)return null;return st=st||{},(lt=(0,ot.Z)(st).create()).initialize(it,at.src,it.autoplay),nt||(nt=lt.getDebug().getLogger()),nt.debug("Converted "+ut+" to dash.js player and added content: "+at.src),it._dashjs_player=lt,lt}function r(nt){return/^VIDEO$/i.test(nt.nodeName)?nt:r(nt.parentNode)}return{create:n,createAll:function(nt,it){var at=[];nt=nt||"[data-dashjs-player]";for(var st=(it=it||document).querySelectorAll(nt),ot=0;ot<st.length;ot++){var lt=n(st[ot],null);at.push(lt)}for(var ut=it.querySelectorAll('source[type="'+rt+'"]'),ct=0;ct<ut.length;ct++){var dt=n(r(ut[ct]),null);at.push(dt)}return at}}}();!("undefined"!=typeof window&&window&&window.dashjs&&window.dashjs.skipAutoCreate)&&"undefined"!=typeof window&&window&&window.addEventListener&&("complete"===window.document.readyState?window.dashjs?lt.createAll():nt=window.setInterval((function(){window.dashjs&&(window.clearInterval(nt),lt.createAll())}),500):window.addEventListener("load",(function e(){window.removeEventListener("load",e),lt.createAll()})));var ut=lt,ct=n(6398);dashjs.Protection=st.default,dashjs.MetricsReporting=at.default,dashjs.MediaPlayerFactory=ut,dashjs.Debug=ct.Z,dashjs.supportsMediaSource=rt.B;var dt=dashjs}(),it.default}();var St=getDefaultExportFromCjs$1(Et.exports);class MediaPlayerAdapterHTML5DASH extends MediaPlayerAdapterHTML5Video{constructor(nt){super(nt),this.currentSrc="",this.setup("video")}load(nt,rt,it,at,st){nt?(this.active=!0,this.setVars(nt,rt,it,at,st),this.currentSrc!==nt&&(this.currentSrc=nt,this.currentMimetype=rt),this.dashPlayer=St.MediaPlayer().create(),this.dashPlayer.initialize(this.object,this.currentSrc,!0),this.dashPlayer.on("error",(nt=>{console.error("DASH ERROR",nt),this.emit("error",String(nt.error),!0),this.state="",this.emit("state","")})),this.connect()):console.error("Bad source",nt,rt)}unload(){console.log("unload dash"),this.dashPlayer&&(console.log("unload dash disconnect"),this.disconnect(),this.dashPlayer.reset(),this.dashPlayer=null,this.object.src="",console.log("unload dash super.unload"),super.unload(),console.log("unload dash OK"))}destroy(){console.log("dash destroy"),this.unload(),super.destroy()}}const wt=Number.isFinite||function(nt){return"number"==typeof nt&&isFinite(nt)},Lt=Number.isSafeInteger||function(nt){return"number"==typeof nt&&Math.abs(nt)<=Ct},Ct=Number.MAX_SAFE_INTEGER||9007199254740991;let Pt=function(nt){return nt.NETWORK_ERROR="networkError",nt.MEDIA_ERROR="mediaError",nt.KEY_SYSTEM_ERROR="keySystemError",nt.MUX_ERROR="muxError",nt.OTHER_ERROR="otherError",nt}({}),kt=function(nt){return nt.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",nt.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",nt.KEY_SYSTEM_NO_SESSION="keySystemNoSession",nt.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",nt.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",nt.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",nt.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",nt.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",nt.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",nt.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",nt.MANIFEST_LOAD_ERROR="manifestLoadError",nt.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",nt.MANIFEST_PARSING_ERROR="manifestParsingError",nt.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",nt.LEVEL_EMPTY_ERROR="levelEmptyError",nt.LEVEL_LOAD_ERROR="levelLoadError",nt.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",nt.LEVEL_PARSING_ERROR="levelParsingError",nt.LEVEL_SWITCH_ERROR="levelSwitchError",nt.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",nt.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",nt.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",nt.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",nt.FRAG_LOAD_ERROR="fragLoadError",nt.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",nt.FRAG_DECRYPT_ERROR="fragDecryptError",nt.FRAG_PARSING_ERROR="fragParsingError",nt.FRAG_GAP="fragGap",nt.REMUX_ALLOC_ERROR="remuxAllocError",nt.KEY_LOAD_ERROR="keyLoadError",nt.KEY_LOAD_TIMEOUT="keyLoadTimeOut",nt.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",nt.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",nt.BUFFER_APPEND_ERROR="bufferAppendError",nt.BUFFER_APPENDING_ERROR="bufferAppendingError",nt.BUFFER_STALLED_ERROR="bufferStalledError",nt.BUFFER_FULL_ERROR="bufferFullError",nt.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",nt.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",nt.ASSET_LIST_LOAD_ERROR="assetListLoadError",nt.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",nt.ASSET_LIST_PARSING_ERROR="assetListParsingError",nt.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",nt.INTERNAL_EXCEPTION="internalException",nt.INTERNAL_ABORTED="aborted",nt.ATTACH_MEDIA_ERROR="attachMediaError",nt.UNKNOWN="unknown",nt}({}),Ot=function(nt){return nt.MEDIA_ATTACHING="hlsMediaAttaching",nt.MEDIA_ATTACHED="hlsMediaAttached",nt.MEDIA_DETACHING="hlsMediaDetaching",nt.MEDIA_DETACHED="hlsMediaDetached",nt.MEDIA_ENDED="hlsMediaEnded",nt.BUFFER_RESET="hlsBufferReset",nt.BUFFER_CODECS="hlsBufferCodecs",nt.BUFFER_CREATED="hlsBufferCreated",nt.BUFFER_APPENDING="hlsBufferAppending",nt.BUFFER_APPENDED="hlsBufferAppended",nt.BUFFER_EOS="hlsBufferEos",nt.BUFFERED_TO_END="hlsBufferedToEnd",nt.BUFFER_FLUSHING="hlsBufferFlushing",nt.BUFFER_FLUSHED="hlsBufferFlushed",nt.MANIFEST_LOADING="hlsManifestLoading",nt.MANIFEST_LOADED="hlsManifestLoaded",nt.MANIFEST_PARSED="hlsManifestParsed",nt.LEVEL_SWITCHING="hlsLevelSwitching",nt.LEVEL_SWITCHED="hlsLevelSwitched",nt.LEVEL_LOADING="hlsLevelLoading",nt.LEVEL_LOADED="hlsLevelLoaded",nt.LEVEL_UPDATED="hlsLevelUpdated",nt.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",nt.LEVELS_UPDATED="hlsLevelsUpdated",nt.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",nt.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",nt.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",nt.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",nt.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",nt.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",nt.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",nt.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",nt.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",nt.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",nt.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",nt.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",nt.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",nt.CUES_PARSED="hlsCuesParsed",nt.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",nt.INIT_PTS_FOUND="hlsInitPtsFound",nt.FRAG_LOADING="hlsFragLoading",nt.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",nt.FRAG_LOADED="hlsFragLoaded",nt.FRAG_DECRYPTED="hlsFragDecrypted",nt.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",nt.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",nt.FRAG_PARSING_METADATA="hlsFragParsingMetadata",nt.FRAG_PARSED="hlsFragParsed",nt.FRAG_BUFFERED="hlsFragBuffered",nt.FRAG_CHANGED="hlsFragChanged",nt.FPS_DROP="hlsFpsDrop",nt.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",nt.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",nt.ERROR="hlsError",nt.DESTROYING="hlsDestroying",nt.KEY_LOADING="hlsKeyLoading",nt.KEY_LOADED="hlsKeyLoaded",nt.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",nt.BACK_BUFFER_REACHED="hlsBackBufferReached",nt.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",nt.ASSET_LIST_LOADING="hlsAssetListLoading",nt.ASSET_LIST_LOADED="hlsAssetListLoaded",nt.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",nt.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",nt.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",nt.INTERSTITIAL_STARTED="hlsInterstitialStarted",nt.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",nt.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",nt.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",nt.INTERSTITIAL_ENDED="hlsInterstitialEnded",nt.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",nt.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",nt}({});var Ft="manifest",Bt="level",Ut="audioTrack",Gt="subtitleTrack",Ht="main",jt="audio",Kt="subtitle";class EWMA{constructor(nt,rt=0,it=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=nt,this.alpha_=nt?Math.exp(Math.log(.5)/nt):0,this.estimate_=rt,this.totalWeight_=it}sample(nt,rt){const it=Math.pow(this.alpha_,nt);this.estimate_=rt*(1-it)+it*this.estimate_,this.totalWeight_+=nt}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const nt=1-Math.pow(this.alpha_,this.totalWeight_);if(nt)return this.estimate_/nt}return this.estimate_}}class EwmaBandWidthEstimator{constructor(nt,rt,it,at=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=it,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new EWMA(nt),this.fast_=new EWMA(rt),this.defaultTTFB_=at,this.ttfb_=new EWMA(nt)}update(nt,rt){const{slow_:it,fast_:at,ttfb_:st}=this;it.halfLife!==nt&&(this.slow_=new EWMA(nt,it.getEstimate(),it.getTotalWeight())),at.halfLife!==rt&&(this.fast_=new EWMA(rt,at.getEstimate(),at.getTotalWeight())),st.halfLife!==nt&&(this.ttfb_=new EWMA(nt,st.getEstimate(),st.getTotalWeight()))}sample(nt,rt){const it=(nt=Math.max(nt,this.minDelayMs_))/1e3,at=8*rt/it;this.fast_.sample(it,at),this.slow_.sample(it,at)}sampleTTFB(nt){const rt=nt/1e3,it=Math.sqrt(2)*Math.exp(-Math.pow(rt,2)/2);this.ttfb_.sample(it,Math.max(nt,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function _defineProperty(nt,rt,it){return(rt=function _toPropertyKey(nt){var rt=function _toPrimitive(nt,rt){if("object"!=typeof nt||!nt)return nt;var it=nt[Symbol.toPrimitive];if(void 0!==it){var at=it.call(nt,rt||"default");if("object"!=typeof at)return at;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===rt?String:Number)(nt)}(nt,"string");return"symbol"==typeof rt?rt:rt+""}(rt))in nt?Object.defineProperty(nt,rt,{value:it,enumerable:!0,configurable:!0,writable:!0}):nt[rt]=it,nt}function _extends(){return _extends=Object.assign?Object.assign.bind():function(nt){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt];for(var at in it)({}).hasOwnProperty.call(it,at)&&(nt[at]=it[at])}return nt},_extends.apply(null,arguments)}function ownKeys(nt,rt){var it=Object.keys(nt);if(Object.getOwnPropertySymbols){var at=Object.getOwnPropertySymbols(nt);rt&&(at=at.filter((function(rt){return Object.getOwnPropertyDescriptor(nt,rt).enumerable}))),it.push.apply(it,at)}return it}function _objectSpread2(nt){for(var rt=1;rt<arguments.length;rt++){var it=null!=arguments[rt]?arguments[rt]:{};rt%2?ownKeys(Object(it),!0).forEach((function(rt){_defineProperty(nt,rt,it[rt])})):Object.getOwnPropertyDescriptors?Object.defineProperties(nt,Object.getOwnPropertyDescriptors(it)):ownKeys(Object(it)).forEach((function(rt){Object.defineProperty(nt,rt,Object.getOwnPropertyDescriptor(it,rt))}))}return nt}class Logger{constructor(nt,rt){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const it=`[${nt}]:`;this.trace=$t,this.debug=rt.debug.bind(null,it),this.log=rt.log.bind(null,it),this.warn=rt.warn.bind(null,it),this.info=rt.info.bind(null,it),this.error=rt.error.bind(null,it)}}const $t=function noop(){},Yt={trace:$t,debug:$t,log:$t,warn:$t,info:$t,error:$t};function createLogger(){return _extends({},Yt)}function getLoggerFn(nt,rt,it){return rt[nt]?rt[nt].bind(rt):function consolePrintFn(nt,rt){const it=self.console[nt];return it?it.bind(self.console,`${rt?"["+rt+"] ":""}[${nt}] >`):$t}(nt,it)}const Wt=createLogger();const Qt=Wt;function getMediaSource(nt=!0){if("undefined"==typeof self)return;return(nt||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function isCompatibleTrackChange(nt,rt){const it=Object.keys(nt),at=Object.keys(rt),st=it.length,ot=at.length;return!st||!ot||st===ot&&!it.some((nt=>-1===at.indexOf(nt)))}const en={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function areCodecsMediaSourceSupported(nt,rt,it=!0){return!nt.split(",").some((nt=>!isCodecMediaSourceSupported(nt,rt,it)))}function isCodecMediaSourceSupported(nt,rt,it=!0){var at;const st=getMediaSource(it);return null!=(at=null==st?void 0:st.isTypeSupported(mimeTypeForCodec(nt,rt)))&&at}function mimeTypeForCodec(nt,rt){return`${rt}/mp4;codecs=${nt}`}function videoCodecPreferenceValue(nt){if(nt){const rt=nt.substring(0,4);return en.video[rt]}return 2}function codecsSetSelectionPreferenceValue(nt){return nt.split(",").reduce(((nt,rt)=>{const it=en.video[rt];return it?(2*it+nt)/(nt?3:2):(en.audio[rt]+nt)/(nt?2:1)}),0)}const nn={};const an=/flac|opus|mp4a\.40\.34/i;function getCodecCompatibleName(nt,rt=!0){return nt.replace(an,(nt=>function getCodecCompatibleNameLower(nt,rt=!0){if(nn[nt])return nn[nt];const it={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[nt];for(let st=0;st<it.length;st++){var at;if(isCodecMediaSourceSupported(it[st],"audio",rt))return nn[nt]=it[st],it[st];if("mp3"===it[st]&&null!=(at=getMediaSource(rt))&&at.isTypeSupported("audio/mpeg"))return""}return nt}(nt.toLowerCase(),rt)))}function pickMostCompleteCodecName(nt,rt){if(nt&&(nt.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(nt)))return nt;if(rt){const it=rt.split(",");if(it.length>1){if(nt)for(let rt=it.length;rt--;)if(it[rt].substring(0,4)===nt.substring(0,4))return it[rt];return it[0]}}return rt||nt}function fillInMissingAV01Params(nt){if(nt.startsWith("av01.")){const rt=nt.split("."),it=["0","111","01","01","01","0"];for(let nt=rt.length;nt>4&&nt<10;nt++)rt[nt]=it[nt-4];return rt.join(".")}return nt}function getM2TSSupportedAudioTypes(nt){const rt=getMediaSource(nt)||{isTypeSupported:()=>!1};return{mpeg:rt.isTypeSupported("audio/mpeg"),mp3:rt.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:rt.isTypeSupported('audio/mp4; codecs="ac-3"')}}const ln={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},hn={};function requiresMediaCapabilitiesDecodingInfo(nt,rt,it,at,st,ot){const lt=nt.audioCodec?nt.audioGroups:null,ut=null==ot?void 0:ot.audioCodec,ct=null==ot?void 0:ot.channels,dt=ct?parseInt(ct):ut?1/0:2;let ht=null;if(null!=lt&&lt.length)try{ht=1===lt.length&&lt[0]?rt.groups[lt[0]].channels:lt.reduce(((nt,it)=>{if(it){const at=rt.groups[it];if(!at)throw new Error(`Audio track group ${it} not found`);Object.keys(at.channels).forEach((rt=>{nt[rt]=(nt[rt]||0)+at.channels[rt]}))}return nt}),{2:0})}catch(nt){return!0}return void 0!==nt.videoCodec&&(nt.width>1920&&nt.height>1088||nt.height>1920&&nt.width>1088||nt.frameRate>Math.max(at,30)||"SDR"!==nt.videoRange&&nt.videoRange!==it||nt.bitrate>Math.max(st,8e6))||!!ht&&wt(dt)&&Object.keys(ht).some((nt=>parseInt(nt)>dt))}function getMediaDecodingInfoPromise(nt,rt,it){const at=nt.videoCodec,st=nt.audioCodec;if(!at&&!st||!it)return Promise.resolve(ln);const ot=[];if(at){const rt={width:nt.width,height:nt.height,bitrate:Math.ceil(Math.max(.9*nt.bitrate,nt.averageBitrate)),framerate:nt.frameRate||30},it=nt.videoRange;"SDR"!==it&&(rt.transferFunction=it.toLowerCase()),ot.push.apply(ot,at.split(",").map((nt=>({type:"media-source",video:_objectSpread2(_objectSpread2({},rt),{},{contentType:mimeTypeForCodec(fillInMissingAV01Params(nt),"video")})}))))}return st&&nt.audioGroups&&nt.audioGroups.forEach((nt=>{var it;nt&&(null==(it=rt.groups[nt])||it.tracks.forEach((rt=>{if(rt.groupId===nt){const nt=rt.channels||"",it=parseFloat(nt);wt(it)&&it>2&&ot.push.apply(ot,st.split(",").map((nt=>({type:"media-source",audio:{contentType:mimeTypeForCodec(nt,"audio"),channels:""+it}}))))}})))})),Promise.all(ot.map((nt=>{const rt=function getMediaDecodingInfoKey(nt){const{audio:rt,video:it}=nt,at=it||rt;if(at){const nt=at.contentType.split('"')[1];if(it)return`r${it.height}x${it.width}f${Math.ceil(it.framerate)}${it.transferFunction||"sd"}_${nt}_${Math.ceil(it.bitrate/1e5)}`;if(rt)return`c${rt.channels}${rt.spatialRendering?"s":"n"}_${nt}`}return""}(nt);return hn[rt]||(hn[rt]=it.decodingInfo(nt))}))).then((nt=>({supported:!nt.some((nt=>!nt.supported)),configurations:ot,decodingInfoResults:nt}))).catch((nt=>({supported:!1,configurations:ot,decodingInfoResults:[],error:nt})))}const fn=["NONE","TYPE-0","TYPE-1",null];const pn=["SDR","PQ","HLG"];var mn="",gn="YES",_n="v2";function getSkipValue(nt){const{canSkipUntil:rt,canSkipDateRanges:it,age:at}=nt;return rt&&at<rt/2?it?_n:gn:mn}class HlsUrlParameters{constructor(nt,rt,it){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=nt,this.part=rt,this.skip=it}addDirectives(nt){const rt=new self.URL(nt);return void 0!==this.msn&&rt.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&rt.searchParams.set("_HLS_part",this.part.toString()),this.skip&&rt.searchParams.set("_HLS_skip",this.skip),rt.href}}class Level{constructor(nt){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[nt.url],this._attrs=[nt.attrs],this.bitrate=nt.bitrate,nt.details&&(this.details=nt.details),this.id=nt.id||0,this.name=nt.name,this.width=nt.width||0,this.height=nt.height||0,this.frameRate=nt.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=nt.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=nt.audioCodec,this.videoCodec=nt.videoCodec,this.codecSet=[nt.videoCodec,nt.audioCodec].filter((nt=>!!nt)).map((nt=>nt.substring(0,4))).join(","),this.addGroupId("audio",nt.attrs.AUDIO),this.addGroupId("text",nt.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(nt){return hasGroup(this._audioGroups,nt)}hasSubtitleGroup(nt){return hasGroup(this._subtitleGroups,nt)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(nt,rt){if(rt)if("audio"===nt){let nt=this._audioGroups;nt||(nt=this._audioGroups=[]),-1===nt.indexOf(rt)&&nt.push(rt)}else if("text"===nt){let nt=this._subtitleGroups;nt||(nt=this._subtitleGroups=[]),-1===nt.indexOf(rt)&&nt.push(rt)}}get urlId(){return 0}set urlId(nt){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var nt;return null==(nt=this.audioGroups)?void 0:nt[0]}get textGroupId(){var nt;return null==(nt=this.subtitleGroups)?void 0:nt[0]}addFallback(){}}function hasGroup(nt,rt){return!(!rt||!nt)&&-1!==nt.indexOf(rt)}function getVideoSelectionOptions(nt,rt){let it=!1,at=[];if(nt&&(it="SDR"!==nt,at=[nt]),rt){at=rt.allowedVideoRanges||pn.slice(0);const nt="SDR"!==at.join("")&&!rt.videoCodec;it=void 0!==rt.preferHDR?rt.preferHDR:nt&&function isHdrSupported(){if("function"==typeof matchMedia){const nt=matchMedia("(dynamic-range: high)"),rt=matchMedia("bad query");if(nt.media!==rt.media)return!0===nt.matches}return!1}(),it||(at=["SDR"])}return{preferHDR:it,allowedVideoRanges:at}}function logStartCodecCandidateIgnored(nt,rt){Qt.log(`[abr] start candidates with "${nt}" ignored because ${rt}`)}function getAudioTracksByGroup(nt){return nt.reduce(((nt,rt)=>{let it=nt.groups[rt.groupId];it||(it=nt.groups[rt.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),it.tracks.push(rt);const at=rt.channels||"2";return it.channels[at]=(it.channels[at]||0)+1,it.hasDefault=it.hasDefault||rt.default,it.hasAutoSelect=it.hasAutoSelect||rt.autoselect,it.hasDefault&&(nt.hasDefaultAudio=!0),it.hasAutoSelect&&(nt.hasAutoSelectAudio=!0),nt}),{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function getBasicSelectionOption(nt){if(!nt)return nt;const{lang:rt,assocLang:it,characteristics:at,channels:st,audioCodec:ot}=nt;return{lang:rt,assocLang:it,characteristics:at,channels:st,audioCodec:ot}}function findMatchingOption(nt,rt,it){if("attrs"in nt){const it=rt.indexOf(nt);if(-1!==it)return it}for(let at=0;at<rt.length;at++){if(matchesOption(nt,rt[at],it))return at}return-1}function matchesOption(nt,rt,it){const{groupId:at,name:st,lang:ot,assocLang:lt,characteristics:ut,default:ct}=nt,dt=nt.forced;return(void 0===at||rt.groupId===at)&&(void 0===st||rt.name===st)&&(void 0===ot||function languagesMatch(nt,rt="--"){if(nt.length===rt.length)return nt===rt;return nt.startsWith(rt)||rt.startsWith(nt)}(ot,rt.lang))&&(void 0===ot||rt.assocLang===lt)&&(void 0===ct||rt.default===ct)&&(void 0===dt||rt.forced===dt)&&(void 0===ut||function characteristicsMatch(nt,rt=""){const it=nt.split(","),at=rt.split(",");return it.length===at.length&&!it.some((nt=>-1===at.indexOf(nt)))}(ut,rt.characteristics))&&(void 0===it||it(nt,rt))}function audioMatchPredicate(nt,rt){const{audioCodec:it,channels:at}=nt;return!(void 0!==it&&(rt.audioCodec||"").substring(0,4)!==it.substring(0,4)||void 0!==at&&at!==(rt.channels||"2"))}function searchDownAndUpList(nt,rt,it){for(let at=rt;at;at--)if(it(nt[at]))return at;for(let at=rt+1;at<nt.length;at++)if(it(nt[at]))return at;return-1}const BinarySearch_search=function(nt,rt){let it=0,at=nt.length-1,st=null,ot=null;for(;it<=at;){st=(it+at)/2|0,ot=nt[st];const lt=rt(ot);if(lt>0)it=st+1;else{if(!(lt<0))return ot;at=st-1}}return null};function findFragmentByPTS(nt,rt,it=0,at=0,st=.005){let ot=null;if(nt){ot=rt[1+nt.sn-rt[0].sn]||null;const at=nt.endDTS-it;at>0&&at<15e-7&&(it+=15e-7),ot&&nt.level!==ot.level&&ot.end<=nt.end&&(ot=rt[2+nt.sn-rt[0].sn]||null)}else 0===it&&0===rt[0].start&&(ot=rt[0]);if(ot&&((!nt||nt.level===ot.level)&&0===fragmentWithinToleranceTest(it,at,ot)||function fragmentWithinFastStartSwitch(nt,rt,it){if(rt&&0===rt.start&&rt.level<nt.level&&(rt.endPTS||0)>0){const at=rt.tagList.reduce(((nt,rt)=>("INF"===rt[0]&&(nt+=parseFloat(rt[1])),nt)),it);return nt.start<=at}return!1}(ot,nt,Math.min(st,at))))return ot;const lt=BinarySearch_search(rt,fragmentWithinToleranceTest.bind(null,it,at));return!lt||lt===nt&&ot?ot:lt}function fragmentWithinToleranceTest(nt=0,rt=0,it){if(it.start<=nt&&it.start+it.duration>nt)return 0;const at=Math.min(rt,it.duration+(it.deltaPTS?it.deltaPTS:0));return it.start+it.duration-at<=nt?1:it.start-at>nt&&it.start?-1:0}function pdtWithinToleranceTest(nt,rt,it){const at=1e3*Math.min(rt,it.duration+(it.deltaPTS?it.deltaPTS:0));return(it.endProgramDateTime||0)-at>nt}function findFragWithCC(nt,rt){return BinarySearch_search(nt,(nt=>nt.cc<rt?1:nt.cc>rt?-1:0))}function isTimeoutError(nt){switch(nt.details){case kt.FRAG_LOAD_TIMEOUT:case kt.KEY_LOAD_TIMEOUT:case kt.LEVEL_LOAD_TIMEOUT:case kt.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function getRetryConfig(nt,rt){const it=isTimeoutError(rt);return nt.default[(it?"timeout":"error")+"Retry"]}function getRetryDelay(nt,rt){const it="linear"===nt.backoff?1:Math.pow(2,rt);return Math.min(it*nt.retryDelayMs,nt.maxRetryDelayMs)}function getLoaderConfigWithoutReties(nt){return _objectSpread2(_objectSpread2({},nt),{errorRetry:null,timeoutRetry:null})}function shouldRetry(nt,rt,it,at){if(!nt)return!1;const st=null==at?void 0:at.code,ot=rt<nt.maxNumRetry&&(function retryForHttpStatus(nt){return 0===nt&&!1===navigator.onLine||!!nt&&(nt<400||nt>499)}(st)||!!it);return nt.shouldRetry?nt.shouldRetry(nt,rt,it,at,ot):ot}var vn=0,En=2,Tn=3,bn=5,An=0,Rn=1,In=2;function createDoNothingErrorAction(nt){const rt={action:vn,flags:An};return nt&&(rt.resolved=!0),rt}var Ln="NOT_LOADED",Dn="APPENDING",Mn="PARTIAL",Nn="OK";class FragmentTracker{constructor(nt){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=nt,this._registerListeners()}_registerListeners(){const{hls:nt}=this;nt.on(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.on(Ot.BUFFER_APPENDED,this.onBufferAppended,this),nt.on(Ot.FRAG_BUFFERED,this.onFragBuffered,this),nt.on(Ot.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:nt}=this;nt.off(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.off(Ot.BUFFER_APPENDED,this.onBufferAppended,this),nt.off(Ot.FRAG_BUFFERED,this.onFragBuffered,this),nt.off(Ot.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(nt,rt){const it=this.activePartLists[rt];if(it)for(let rt=it.length;rt--;){const at=it[rt];if(!at)break;const st=at.end;if(at.start<=nt&&null!==st&&nt<=st)return at}return this.getBufferedFrag(nt,rt)}getBufferedFrag(nt,rt){return this.getFragAtPos(nt,rt,!0)}getFragAtPos(nt,rt,it){const{fragments:at}=this,st=Object.keys(at);for(let ot=st.length;ot--;){const lt=at[st[ot]];if((null==lt?void 0:lt.body.type)===rt&&(!it||lt.buffered)){const rt=lt.body;if(rt.start<=nt&&nt<=rt.end)return rt}}return null}detectEvictedFragments(nt,rt,it,at,st){this.timeRanges&&(this.timeRanges[nt]=rt);const ot=(null==at?void 0:at.fragment.sn)||-1;Object.keys(this.fragments).forEach((at=>{const lt=this.fragments[at];if(!lt)return;if(ot>=lt.body.sn)return;if(!lt.buffered&&(!lt.loaded||st))return void(lt.body.type===it&&this.removeFragment(lt.body));const ut=lt.range[nt];ut&&(0!==ut.time.length?ut.time.some((nt=>{const it=!this.isTimeBuffered(nt.startPTS,nt.endPTS,rt);return it&&this.removeFragment(lt.body),it})):this.removeFragment(lt.body))}))}detectPartialFragments(nt){const rt=this.timeRanges;if(!rt||"initSegment"===nt.frag.sn)return;const it=nt.frag,at=getFragmentKey(it),st=this.fragments[at];if(!st||st.buffered&&it.gap)return;const ot=!it.relurl;if(Object.keys(rt).forEach((at=>{const lt=it.elementaryStreams[at];if(!lt)return;const ut=rt[at],ct=ot||!0===lt.partial;st.range[at]=this.getBufferedTimes(it,nt.part,ct,ut)})),st.loaded=null,Object.keys(st.range).length){st.buffered=!0;(st.body.endList=it.endList||st.body.endList)&&(this.endListFragments[st.body.type]=st),isPartial(st)||this.removeParts(it.sn-1,it.type)}else this.removeFragment(st.body)}removeParts(nt,rt){const it=this.activePartLists[rt];it&&(this.activePartLists[rt]=it.filter((rt=>rt.fragment.sn>=nt)))}fragBuffered(nt,rt){const it=getFragmentKey(nt);let at=this.fragments[it];!at&&rt&&(at=this.fragments[it]={body:nt,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},nt.gap&&(this.hasGaps=!0)),at&&(at.loaded=null,at.buffered=!0)}getBufferedTimes(nt,rt,it,at){const st={time:[],partial:it},ot=nt.start,lt=nt.end,ut=nt.minEndPTS||lt,ct=nt.maxStartPTS||ot;for(let nt=0;nt<at.length;nt++){const rt=at.start(nt)-this.bufferPadding,it=at.end(nt)+this.bufferPadding;if(ct>=rt&&ut<=it){st.time.push({startPTS:Math.max(ot,at.start(nt)),endPTS:Math.min(lt,at.end(nt))});break}if(ot<it&&lt>rt){const rt=Math.max(ot,at.start(nt)),it=Math.min(lt,at.end(nt));it>rt&&(st.partial=!0,st.time.push({startPTS:rt,endPTS:it}))}else if(lt<=rt)break}return st}getPartialFragment(nt){let rt,it,at,st=null,ot=0;const{bufferPadding:lt,fragments:ut}=this;return Object.keys(ut).forEach((ct=>{const dt=ut[ct];dt&&isPartial(dt)&&(it=dt.body.start-lt,at=dt.body.end+lt,nt>=it&&nt<=at&&(rt=Math.min(nt-it,at-nt),ot<=rt&&(st=dt.body,ot=rt)))})),st}isEndListAppended(nt){const rt=this.endListFragments[nt];return void 0!==rt&&(rt.buffered||isPartial(rt))}getState(nt){const rt=getFragmentKey(nt),it=this.fragments[rt];return it?it.buffered?isPartial(it)?Mn:Nn:Dn:Ln}isTimeBuffered(nt,rt,it){let at,st;for(let ot=0;ot<it.length;ot++){if(at=it.start(ot)-this.bufferPadding,st=it.end(ot)+this.bufferPadding,nt>=at&&rt<=st)return!0;if(rt<=at)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(nt,rt){if("initSegment"===rt.frag.sn||rt.frag.bitrateTest)return;const it=rt.frag,at=rt.part?null:rt,st=getFragmentKey(it);this.fragments[st]={body:it,appendedPTS:null,loaded:at,buffered:!1,range:Object.create(null)}}onBufferAppended(nt,rt){const{frag:it,part:at,timeRanges:st,type:ot}=rt;if("initSegment"===it.sn)return;const lt=it.type;if(at){let nt=this.activePartLists[lt];nt||(this.activePartLists[lt]=nt=[]),nt.push(at)}this.timeRanges=st;const ut=st[ot];this.detectEvictedFragments(ot,ut,lt,at)}onFragBuffered(nt,rt){this.detectPartialFragments(rt)}hasFragment(nt){const rt=getFragmentKey(nt);return!!this.fragments[rt]}hasFragments(nt){const{fragments:rt}=this,it=Object.keys(rt);if(!nt)return it.length>0;for(let at=it.length;at--;){const st=rt[it[at]];if((null==st?void 0:st.body.type)===nt)return!0}return!1}hasParts(nt){var rt;return!(null==(rt=this.activePartLists[nt])||!rt.length)}removeFragmentsInRange(nt,rt,it,at,st){at&&!this.hasGaps||Object.keys(this.fragments).forEach((ot=>{const lt=this.fragments[ot];if(!lt)return;const ut=lt.body;ut.type!==it||at&&!ut.gap||ut.start<rt&&ut.end>nt&&(lt.buffered||st)&&this.removeFragment(ut)}))}removeFragment(nt){const rt=getFragmentKey(nt);nt.stats.loaded=0,nt.clearElementaryStreamInfo();const it=this.activePartLists[nt.type];if(it){const rt=nt.sn;this.activePartLists[nt.type]=it.filter((nt=>nt.fragment.sn!==rt))}delete this.fragments[rt],nt.endList&&delete this.endListFragments[nt.type]}removeAllFragments(){var nt,rt;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const it=null==(nt=this.hls)||null==(rt=nt.latestLevelDetails)?void 0:rt.partList;it&&it.forEach((nt=>nt.clearElementaryStreamInfo()))}}function isPartial(nt){var rt,it,at;return nt.buffered&&(nt.body.gap||(null==(rt=nt.range.video)?void 0:rt.partial)||(null==(it=nt.range.audio)?void 0:it.partial)||(null==(at=nt.range.audiovideo)?void 0:at.partial))}function getFragmentKey(nt){return`${nt.type}_${nt.level}_${nt.sn}`}var xn=0,Un=1;class AESCrypto{constructor(nt,rt,it){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=nt,this.aesIV=rt,this.aesMode=it}decrypt(nt,rt){switch(this.aesMode){case xn:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},rt,nt);case Un:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},rt,nt);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function sliceUint8(nt,rt,it){return Uint8Array.prototype.slice?nt.slice(rt,it):new Uint8Array(Array.prototype.slice.call(nt,rt,it))}class AESDecryptor{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(nt){const rt=new DataView(nt),it=new Uint32Array(4);for(let nt=0;nt<4;nt++)it[nt]=rt.getUint32(4*nt);return it}initTable(){const nt=this.sBox,rt=this.invSBox,it=this.subMix,at=it[0],st=it[1],ot=it[2],lt=it[3],ut=this.invSubMix,ct=ut[0],dt=ut[1],ht=ut[2],pt=ut[3],_t=new Uint32Array(256);let Et=0,St=0,wt=0;for(wt=0;wt<256;wt++)_t[wt]=wt<128?wt<<1:wt<<1^283;for(wt=0;wt<256;wt++){let it=St^St<<1^St<<2^St<<3^St<<4;it=it>>>8^255&it^99,nt[Et]=it,rt[it]=Et;const ut=_t[Et],wt=_t[ut],Lt=_t[wt];let Ct=257*_t[it]^16843008*it;at[Et]=Ct<<24|Ct>>>8,st[Et]=Ct<<16|Ct>>>16,ot[Et]=Ct<<8|Ct>>>24,lt[Et]=Ct,Ct=16843009*Lt^65537*wt^257*ut^16843008*Et,ct[it]=Ct<<24|Ct>>>8,dt[it]=Ct<<16|Ct>>>16,ht[it]=Ct<<8|Ct>>>24,pt[it]=Ct,Et?(Et=ut^_t[_t[_t[Lt^ut]]],St^=_t[_t[St]]):Et=St=1}}expandKey(nt){const rt=this.uint8ArrayToUint32Array_(nt);let it=!0,at=0;for(;at<rt.length&&it;)it=rt[at]===this.key[at],at++;if(it)return;this.key=rt;const st=this.keySize=rt.length;if(4!==st&&6!==st&&8!==st)throw new Error("Invalid aes key size="+st);const ot=this.ksRows=4*(st+6+1);let lt,ut;const ct=this.keySchedule=new Uint32Array(ot),dt=this.invKeySchedule=new Uint32Array(ot),ht=this.sBox,pt=this.rcon,_t=this.invSubMix,Et=_t[0],St=_t[1],wt=_t[2],Lt=_t[3];let Ct,Pt;for(lt=0;lt<ot;lt++)lt<st?Ct=ct[lt]=rt[lt]:(Pt=Ct,lt%st==0?(Pt=Pt<<8|Pt>>>24,Pt=ht[Pt>>>24]<<24|ht[Pt>>>16&255]<<16|ht[Pt>>>8&255]<<8|ht[255&Pt],Pt^=pt[lt/st|0]<<24):st>6&&lt%st==4&&(Pt=ht[Pt>>>24]<<24|ht[Pt>>>16&255]<<16|ht[Pt>>>8&255]<<8|ht[255&Pt]),ct[lt]=Ct=(ct[lt-st]^Pt)>>>0);for(ut=0;ut<ot;ut++)lt=ot-ut,Pt=3&ut?ct[lt]:ct[lt-4],dt[ut]=ut<4||lt<=4?Pt:Et[ht[Pt>>>24]]^St[ht[Pt>>>16&255]]^wt[ht[Pt>>>8&255]]^Lt[ht[255&Pt]],dt[ut]=dt[ut]>>>0}networkToHostOrderSwap(nt){return nt<<24|(65280&nt)<<8|(16711680&nt)>>8|nt>>>24}decrypt(nt,rt,it){const at=this.keySize+6,st=this.invKeySchedule,ot=this.invSBox,lt=this.invSubMix,ut=lt[0],ct=lt[1],dt=lt[2],ht=lt[3],pt=this.uint8ArrayToUint32Array_(it);let _t=pt[0],Et=pt[1],St=pt[2],wt=pt[3];const Lt=new Int32Array(nt),Ct=new Int32Array(Lt.length);let Pt,kt,Ot,Ft,Bt,Ut,Gt,Ht,jt,Kt,$t,Yt,Wt,Qt;const en=this.networkToHostOrderSwap;for(;rt<Lt.length;){for(jt=en(Lt[rt]),Kt=en(Lt[rt+1]),$t=en(Lt[rt+2]),Yt=en(Lt[rt+3]),Bt=jt^st[0],Ut=Yt^st[1],Gt=$t^st[2],Ht=Kt^st[3],Wt=4,Qt=1;Qt<at;Qt++)Pt=ut[Bt>>>24]^ct[Ut>>16&255]^dt[Gt>>8&255]^ht[255&Ht]^st[Wt],kt=ut[Ut>>>24]^ct[Gt>>16&255]^dt[Ht>>8&255]^ht[255&Bt]^st[Wt+1],Ot=ut[Gt>>>24]^ct[Ht>>16&255]^dt[Bt>>8&255]^ht[255&Ut]^st[Wt+2],Ft=ut[Ht>>>24]^ct[Bt>>16&255]^dt[Ut>>8&255]^ht[255&Gt]^st[Wt+3],Bt=Pt,Ut=kt,Gt=Ot,Ht=Ft,Wt+=4;Pt=ot[Bt>>>24]<<24^ot[Ut>>16&255]<<16^ot[Gt>>8&255]<<8^ot[255&Ht]^st[Wt],kt=ot[Ut>>>24]<<24^ot[Gt>>16&255]<<16^ot[Ht>>8&255]<<8^ot[255&Bt]^st[Wt+1],Ot=ot[Gt>>>24]<<24^ot[Ht>>16&255]<<16^ot[Bt>>8&255]<<8^ot[255&Ut]^st[Wt+2],Ft=ot[Ht>>>24]<<24^ot[Bt>>16&255]<<16^ot[Ut>>8&255]<<8^ot[255&Gt]^st[Wt+3],Ct[rt]=en(Pt^_t),Ct[rt+1]=en(Ft^Et),Ct[rt+2]=en(Ot^St),Ct[rt+3]=en(kt^wt),_t=jt,Et=Kt,St=$t,wt=Yt,rt+=4}return Ct.buffer}}class FastAESKey{constructor(nt,rt,it){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=nt,this.key=rt,this.aesMode=it}expandKey(){const nt=function getSubtleAlgoName(nt){switch(nt){case xn:return"AES-CBC";case Un:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${nt}`)}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:nt},!1,["encrypt","decrypt"])}}function utf8ArrayToStr(nt,rt=!1){if("undefined"!=typeof TextDecoder){const it=new TextDecoder("utf-8").decode(nt);if(rt){const nt=it.indexOf("\0");return-1!==nt?it.substring(0,nt):it}return it.replace(/\0/g,"")}const it=nt.length;let at,st,ot,lt="",ut=0;for(;ut<it;){if(at=nt[ut++],0===at&&rt)return lt;if(0!==at&&3!==at)switch(at>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:lt+=String.fromCharCode(at);break;case 12:case 13:st=nt[ut++],lt+=String.fromCharCode((31&at)<<6|63&st);break;case 14:st=nt[ut++],ot=nt[ut++],lt+=String.fromCharCode((15&at)<<12|(63&st)<<6|63&ot)}}return lt}const Hn={hexDump:function(nt){let rt="";for(let it=0;it<nt.length;it++){let at=nt[it].toString(16);at.length<2&&(at="0"+at),rt+=at}return rt}};function getDefaultExportFromCjs(nt){return nt&&nt.__esModule&&Object.prototype.hasOwnProperty.call(nt,"default")?nt.default:nt}var Kn={exports:{}};!function(nt){var rt,it,at,st,ot;rt=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,it=/^(?=([^\/?#]*))\1([^]*)$/,at=/(?:\/|^)\.(?=\/)/g,st=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,ot={buildAbsoluteURL:function(nt,rt,at){if(at=at||{},nt=nt.trim(),!(rt=rt.trim())){if(!at.alwaysNormalize)return nt;var st=ot.parseURL(nt);if(!st)throw new Error("Error trying to parse base URL.");return st.path=ot.normalizePath(st.path),ot.buildURLFromParts(st)}var lt=ot.parseURL(rt);if(!lt)throw new Error("Error trying to parse relative URL.");if(lt.scheme)return at.alwaysNormalize?(lt.path=ot.normalizePath(lt.path),ot.buildURLFromParts(lt)):rt;var ut=ot.parseURL(nt);if(!ut)throw new Error("Error trying to parse base URL.");if(!ut.netLoc&&ut.path&&"/"!==ut.path[0]){var ct=it.exec(ut.path);ut.netLoc=ct[1],ut.path=ct[2]}ut.netLoc&&!ut.path&&(ut.path="/");var dt={scheme:ut.scheme,netLoc:lt.netLoc,path:null,params:lt.params,query:lt.query,fragment:lt.fragment};if(!lt.netLoc&&(dt.netLoc=ut.netLoc,"/"!==lt.path[0]))if(lt.path){var ht=ut.path,pt=ht.substring(0,ht.lastIndexOf("/")+1)+lt.path;dt.path=ot.normalizePath(pt)}else dt.path=ut.path,lt.params||(dt.params=ut.params,lt.query||(dt.query=ut.query));return null===dt.path&&(dt.path=at.alwaysNormalize?ot.normalizePath(lt.path):lt.path),ot.buildURLFromParts(dt)},parseURL:function(nt){var it=rt.exec(nt);return it?{scheme:it[1]||"",netLoc:it[2]||"",path:it[3]||"",params:it[4]||"",query:it[5]||"",fragment:it[6]||""}:null},normalizePath:function(nt){for(nt=nt.split("").reverse().join("").replace(at,"");nt.length!==(nt=nt.replace(st,"")).length;);return nt.split("").reverse().join("")},buildURLFromParts:function(nt){return nt.scheme+nt.netLoc+nt.path+nt.params+nt.query+nt.fragment}},nt.exports=ot}(Kn);var Yn=Kn.exports;class LoadStats{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Wn="audio",Jn="video",er="audiovideo";class BaseSegment{constructor(nt){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[Wn]:null,[Jn]:null,[er]:null},this.baseurl=nt}setByteRange(nt,rt){const it=nt.split("@",2);let at;at=1===it.length?(null==rt?void 0:rt.byteRangeEndOffset)||0:parseInt(it[1]),this._byteRange=[at,parseInt(it[0])+at]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Yn.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(nt){this._url=nt}clearElementaryStreamInfo(){const{elementaryStreams:nt}=this;nt[Wn]=null,nt[Jn]=null,nt[er]=null}}class Fragment extends BaseSegment{constructor(nt,rt){super(rt),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new LoadStats,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=nt}get decryptdata(){const{levelkeys:nt}=this;if(!nt&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const nt=this.levelkeys.identity;if(nt)this._decryptdata=nt.getDecryptData(this.sn);else{const nt=Object.keys(this.levelkeys);if(1===nt.length)return this._decryptdata=this.levelkeys[nt[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;if(!wt(this.programDateTime))return null;const nt=wt(this.duration)?this.duration:0;return this.programDateTime+1e3*nt}get encrypted(){var nt;if(null!=(nt=this._decryptdata)&&nt.encrypted)return!0;if(this.levelkeys){const nt=Object.keys(this.levelkeys),rt=nt.length;if(rt>1||1===rt&&this.levelkeys[nt[0]].encrypted)return!0}return!1}setKeyFormat(nt){if(this.levelkeys){const rt=this.levelkeys[nt];rt&&!this._decryptdata&&(this._decryptdata=rt.getDecryptData(this.sn))}}abortRequests(){var nt,rt;null==(nt=this.loader)||nt.abort(),null==(rt=this.keyLoader)||rt.abort()}setElementaryStreamInfo(nt,rt,it,at,st,ot=!1){const{elementaryStreams:lt}=this,ut=lt[nt];ut?(ut.startPTS=Math.min(ut.startPTS,rt),ut.endPTS=Math.max(ut.endPTS,it),ut.startDTS=Math.min(ut.startDTS,at),ut.endDTS=Math.max(ut.endDTS,st)):lt[nt]={startPTS:rt,endPTS:it,startDTS:at,endDTS:st,partial:ot}}}class Part extends BaseSegment{constructor(nt,rt,it,at,st){super(it),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new LoadStats,this.duration=nt.decimalFloatingPoint("DURATION"),this.gap=nt.bool("GAP"),this.independent=nt.bool("INDEPENDENT"),this.relurl=nt.enumeratedString("URI"),this.fragment=rt,this.index=at;const ot=nt.enumeratedString("BYTERANGE");ot&&this.setByteRange(ot,st),st&&(this.fragOffset=st.fragOffset+st.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:nt}=this;return!!(nt.audio||nt.video||nt.audiovideo)}}const or=Math.pow(2,32)-1,dr=[].push,fr={video:1,audio:2,id3:3,text:4};function bin2str(nt){return String.fromCharCode.apply(null,nt)}function readUint16(nt,rt){const it=nt[rt]<<8|nt[rt+1];return it<0?65536+it:it}function readUint32(nt,rt){const it=readSint32(nt,rt);return it<0?4294967296+it:it}function readUint64(nt,rt){let it=readUint32(nt,rt);return it*=Math.pow(2,32),it+=readUint32(nt,rt+4),it}function readSint32(nt,rt){return nt[rt]<<24|nt[rt+1]<<16|nt[rt+2]<<8|nt[rt+3]}function writeUint32(nt,rt,it){nt[rt]=it>>24,nt[rt+1]=it>>16&255,nt[rt+2]=it>>8&255,nt[rt+3]=255&it}function findBox(nt,rt){const it=[];if(!rt.length)return it;const at=nt.byteLength;for(let st=0;st<at;){const ot=readUint32(nt,st),lt=ot>1?st+ot:at;if(bin2str(nt.subarray(st+4,st+8))===rt[0])if(1===rt.length)it.push(nt.subarray(st+8,lt));else{const at=findBox(nt.subarray(st+8,lt),rt.slice(1));at.length&&dr.apply(it,at)}st=lt}return it}function parseSegmentIndex(nt){const rt=[],it=nt[0];let at=8;const st=readUint32(nt,at);at+=4;let ot=0,lt=0;0===it?(ot=readUint32(nt,at),lt=readUint32(nt,at+4),at+=8):(ot=readUint64(nt,at),lt=readUint64(nt,at+8),at+=16),at+=2;let ut=nt.length+lt;const ct=readUint16(nt,at);at+=2;for(let it=0;it<ct;it++){let it=at;const ot=readUint32(nt,it);it+=4;const lt=2147483647&ot;if(1===(2147483648&ot)>>>31)return Qt.warn("SIDX has hierarchical references (not supported)"),null;const ct=readUint32(nt,it);it+=4,rt.push({referenceSize:lt,subsegmentDuration:ct,info:{duration:ct/st,start:ut,end:ut+lt-1}}),ut+=lt,it+=4,at=it}return{earliestPresentationTime:ot,timescale:st,version:it,referencesCount:ct,references:rt}}function parseInitSegment(nt){const rt=[],it=findBox(nt,["moov","trak"]);for(let nt=0;nt<it.length;nt++){const at=it[nt],st=findBox(at,["tkhd"])[0];if(st){let nt=st[0];const it=readUint32(st,0===nt?12:20),ot=findBox(at,["mdia","mdhd"])[0];if(ot){nt=ot[0];const st=readUint32(ot,0===nt?12:20),lt=findBox(at,["mdia","hdlr"])[0];if(lt){const nt=bin2str(lt.subarray(8,12)),ot={soun:Wn,vide:Jn}[nt];if(ot){const nt=parseStsd(findBox(at,["mdia","minf","stbl","stsd"])[0]);rt[it]={timescale:st,type:ot},rt[ot]=_objectSpread2({timescale:st,id:it},nt)}}}}}return findBox(nt,["moov","mvex","trex"]).forEach((nt=>{const it=readUint32(nt,4),at=rt[it];at&&(at.default={duration:readUint32(nt,12),flags:readUint32(nt,20)})})),rt}function parseStsd(nt){const rt=nt.subarray(8),it=rt.subarray(86),at=bin2str(rt.subarray(4,8));let st=at;const ot="enca"===at||"encv"===at;if(ot){const nt=findBox(rt,[at])[0];findBox(nt.subarray("enca"===at?28:78),["sinf"]).forEach((nt=>{const rt=findBox(nt,["schm"])[0];if(rt){const it=bin2str(rt.subarray(4,8));if("cbcs"===it||"cenc"===it){const rt=findBox(nt,["frma"])[0];rt&&(st=bin2str(rt))}}}))}switch(st){case"avc1":case"avc2":case"avc3":case"avc4":{const nt=findBox(it,["avcC"])[0];st+="."+toHex(nt[1])+toHex(nt[2])+toHex(nt[3]);break}case"mp4a":{const nt=findBox(rt,[at])[0],it=findBox(nt.subarray(28),["esds"])[0];if(it&&it.length>7){let nt=4;if(3!==it[nt++])break;nt=skipBERInteger(it,nt),nt+=2;const rt=it[nt++];if(128&rt&&(nt+=2),64&rt&&(nt+=it[nt++]),4!==it[nt++])break;nt=skipBERInteger(it,nt);const at=it[nt++];if(64!==at)break;if(st+="."+toHex(at),nt+=12,5!==it[nt++])break;nt=skipBERInteger(it,nt);const ot=it[nt++];let lt=(248&ot)>>3;31===lt&&(lt+=1+((7&ot)<<3)+((224&it[nt])>>5)),st+="."+lt}break}case"hvc1":case"hev1":{const nt=findBox(it,["hvcC"])[0],rt=nt[1],at=["","A","B","C"][rt>>6],ot=31&rt,lt=readUint32(nt,2),ut=(32&rt)>>5?"H":"L",ct=nt[12],dt=nt.subarray(6,12);st+="."+at+ot,st+="."+lt.toString(16).toUpperCase(),st+="."+ut+ct;let ht="";for(let nt=dt.length;nt--;){const rt=dt[nt];if(rt||ht){ht="."+rt.toString(16).toUpperCase()+ht}}st+=ht;break}case"dvh1":case"dvhe":{const nt=findBox(it,["dvcC"])[0],rt=nt[2]>>1&127,at=nt[2]<<5&32|nt[3]>>3&31;st+="."+addLeadingZero(rt)+"."+addLeadingZero(at);break}case"vp09":{const nt=findBox(it,["vpcC"])[0],rt=nt[4],at=nt[5],ot=nt[6]>>4&15;st+="."+addLeadingZero(rt)+"."+addLeadingZero(at)+"."+addLeadingZero(ot);break}case"av01":{const nt=findBox(it,["av1C"])[0],rt=nt[1]>>>5,at=31&nt[1],ot=nt[2]>>>7?"H":"M",lt=(64&nt[2])>>6,ut=(32&nt[2])>>5,ct=2===rt&&lt?ut?12:10:lt?10:8,dt=(16&nt[2])>>4,ht=(8&nt[2])>>3,pt=(4&nt[2])>>2,_t=3&nt[2],Et=1,St=1,wt=1,Lt=0;st+="."+rt+"."+addLeadingZero(at)+ot+"."+addLeadingZero(ct)+"."+dt+"."+ht+pt+_t+"."+addLeadingZero(Et)+"."+addLeadingZero(St)+"."+addLeadingZero(wt)+"."+Lt;break}}return{codec:st,encrypted:ot}}function skipBERInteger(nt,rt){const it=rt+5;for(;128&nt[rt++]&&rt<it;);return rt}function toHex(nt){return("0"+nt.toString(16).toUpperCase()).slice(-2)}function addLeadingZero(nt){return(nt<10?"0":"")+nt}function parseSinf(nt){const rt=findBox(nt,["schm"])[0];if(rt){const it=bin2str(rt.subarray(4,8));if("cbcs"===it||"cenc"===it)return findBox(nt,["schi","tenc"])[0]}return null}function computeRawDurationFromSamples(nt){const rt=readUint32(nt,0);let it=8;1&rt&&(it+=4),4&rt&&(it+=4);let at=0;const st=readUint32(nt,4);for(let ot=0;ot<st;ot++){if(256&rt){at+=readUint32(nt,it),it+=4}512&rt&&(it+=4),1024&rt&&(it+=4),2048&rt&&(it+=4)}return at}function appendUint8Array(nt,rt){const it=new Uint8Array(nt.length+rt.length);return it.set(nt),it.set(rt,nt.length),it}function parseSamples(nt,rt){const it=[],at=rt.samples,st=rt.timescale,ot=rt.id;let lt=!1;return findBox(at,["moof"]).map((ut=>{const ct=ut.byteOffset-8;findBox(ut,["traf"]).map((ut=>{const dt=findBox(ut,["tfdt"]).map((nt=>{const rt=nt[0];let it=readUint32(nt,4);return 1===rt&&(it*=Math.pow(2,32),it+=readUint32(nt,8)),it/st}))[0];return void 0!==dt&&(nt=dt),findBox(ut,["tfhd"]).map((dt=>{const ht=readUint32(dt,4),pt=16777215&readUint32(dt,0);let _t=0;const Et=!!(16&pt);let St=0;const wt=!!(32&pt);let Lt=8;ht===ot&&(!!(1&pt)&&(Lt+=8),!!(2&pt)&&(Lt+=4),!!(8&pt)&&(_t=readUint32(dt,Lt),Lt+=4),Et&&(St=readUint32(dt,Lt),Lt+=4),wt&&(Lt+=4),"video"===rt.type&&(lt=function isHEVC(nt){if(!nt)return!1;const rt=nt.indexOf("."),it=rt<0?nt:nt.substring(0,rt);return"hvc1"===it||"hev1"===it||"dvh1"===it||"dvhe"===it}(rt.codec)),findBox(ut,["trun"]).map((ot=>{const ut=ot[0],dt=16777215&readUint32(ot,0),ht=!!(1&dt);let pt=0;const Et=!!(4&dt),wt=!!(256&dt);let Lt=0;const Ct=!!(512&dt);let Pt=0;const kt=!!(1024&dt),Ot=!!(2048&dt);let Ft=0;const Bt=readUint32(ot,4);let Ut=8;ht&&(pt=readUint32(ot,Ut),Ut+=4),Et&&(Ut+=4);let Gt=pt+ct;for(let ct=0;ct<Bt;ct++){if(wt?(Lt=readUint32(ot,Ut),Ut+=4):Lt=_t,Ct?(Pt=readUint32(ot,Ut),Ut+=4):Pt=St,kt&&(Ut+=4),Ot&&(Ft=0===ut?readUint32(ot,Ut):readSint32(ot,Ut),Ut+=4),rt.type===Jn){let rt=0;for(;rt<Pt;){const ot=readUint32(at,Gt);if(Gt+=4,isSEIMessage(lt,at[Gt])){parseSEIMessageFromNALu(at.subarray(Gt,Gt+ot),lt?2:1,nt+Ft/st,it)}Gt+=ot,rt+=ot+4}}nt+=Lt/st}})))}))}))})),it}function isSEIMessage(nt,rt){if(nt){const nt=rt>>1&63;return 39===nt||40===nt}return 6===(31&rt)}function parseSEIMessageFromNALu(nt,rt,it,at){const st=discardEPB(nt);let ot=0;ot+=rt;let lt=0,ut=0,ct=0;for(;ot<st.length;){lt=0;do{if(ot>=st.length)break;ct=st[ot++],lt+=ct}while(255===ct);ut=0;do{if(ot>=st.length)break;ct=st[ot++],ut+=ct}while(255===ct);const nt=st.length-ot;let rt=ot;if(ut<nt)ot+=ut;else if(ut>nt){Qt.error(`Malformed SEI payload. ${ut} is too small, only ${nt} bytes left to parse.`);break}if(4===lt){if(181===st[rt++]){const nt=readUint16(st,rt);if(rt+=2,49===nt){const nt=readUint32(st,rt);if(rt+=4,1195456820===nt){const nt=st[rt++];if(3===nt){const ot=st[rt++],ut=64&ot,ct=ut?2+3*(31&ot):0,dt=new Uint8Array(ct);if(ut){dt[0]=ot;for(let nt=1;nt<ct;nt++)dt[nt]=st[rt++]}at.push({type:nt,payloadType:lt,pts:it,bytes:dt})}}}}}else if(5===lt&&ut>16){const nt=[];for(let it=0;it<16;it++){const at=st[rt++].toString(16);nt.push(1==at.length?"0"+at:at),3!==it&&5!==it&&7!==it&&9!==it||nt.push("-")}const ot=ut-16,ct=new Uint8Array(ot);for(let nt=0;nt<ot;nt++)ct[nt]=st[rt++];at.push({payloadType:lt,pts:it,uuid:nt.join(""),userData:utf8ArrayToStr(ct),userDataBytes:ct})}}}function discardEPB(nt){const rt=nt.byteLength,it=[];let at=1;for(;at<rt-2;)0===nt[at]&&0===nt[at+1]&&3===nt[at+2]?(it.push(at+2),at+=2):at++;if(0===it.length)return nt;const st=rt-it.length,ot=new Uint8Array(st);let lt=0;for(at=0;at<st;lt++,at++)lt===it[0]&&(lt++,it.shift()),ot[at]=nt[lt];return ot}function mp4pssh(nt,rt,it){if(16!==nt.byteLength)throw new RangeError("Invalid system id");let at,st,ot;at=0,st=new Uint8Array,ot=new Uint8Array;const lt=new Uint8Array(4);return it&&it.byteLength>0&&new DataView(lt.buffer).setUint32(0,it.byteLength,!1),function mp4Box(nt,...rt){const it=rt.length;let at=8,st=it;for(;st--;)at+=rt[st].byteLength;const ot=new Uint8Array(at);for(ot[0]=at>>24&255,ot[1]=at>>16&255,ot[2]=at>>8&255,ot[3]=255&at,ot.set(nt,4),st=0,at=8;st<it;st++)ot.set(rt[st],at),at+=rt[st].byteLength;return ot}([112,115,115,104],new Uint8Array([0,0,0,0]),nt,ot,st,lt,it||new Uint8Array)}function parsePssh(nt){const rt=nt.getUint32(0),it=nt.byteOffset,at=nt.byteLength;if(at<rt)return{offset:it,size:at};if(1886614376!==nt.getUint32(4))return{offset:it,size:rt};const st=nt.getUint32(8)>>>24;if(0!==st&&1!==st)return{offset:it,size:rt};const ot=nt.buffer,lt=Hn.hexDump(new Uint8Array(ot,it+12,16)),ut=nt.getUint32(28);let ct=null,dt=null;if(0===st){if(rt-32<ut||ut<22)return{offset:it,size:rt};dt=new Uint8Array(ot,it+32,ut)}else if(1===st){if(!ut||at<it+32+16*ut+16)return{offset:it,size:rt};ct=[];for(let nt=0;nt<ut;nt++)ct.push(new Uint8Array(ot,it+32+16*nt,16))}return{version:st,systemId:lt,kids:ct,data:dt,offset:it,size:rt}}class Decrypter{constructor(nt,{removePKCS7Padding:rt=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=nt.enableSoftwareAES,this.removePKCS7Padding=rt,rt)try{const nt=self.crypto;nt&&(this.subtle=nt.subtle||nt.webkitSubtle)}catch(nt){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:nt,remainderData:rt}=this;if(!nt||rt)return this.reset(),null;const it=new Uint8Array(nt);return this.reset(),this.removePKCS7Padding?function removePadding(nt){const rt=nt.byteLength,it=rt&&new DataView(nt.buffer).getUint8(rt-1);return it?sliceUint8(nt,0,rt-it):nt}(it):it}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(nt,rt,it,at){return this.useSoftware?new Promise(((st,ot)=>{this.softwareDecrypt(new Uint8Array(nt),rt,it,at);const lt=this.flush();lt?st(lt.buffer):ot(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(nt),rt,it,at)}softwareDecrypt(nt,rt,it,at){const{currentIV:st,currentResult:ot,remainderData:lt}=this;if(at!==xn||16!==rt.byteLength)return Qt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),lt&&(nt=appendUint8Array(lt,nt),this.remainderData=null);const ut=this.getValidChunk(nt);if(!ut.length)return null;st&&(it=st);let ct=this.softwareDecrypter;ct||(ct=this.softwareDecrypter=new AESDecryptor),ct.expandKey(rt);const dt=ot;return this.currentResult=ct.decrypt(ut.buffer,0,it),this.currentIV=sliceUint8(ut,-16).buffer,dt||null}webCryptoDecrypt(nt,rt,it,at){if(this.key!==rt||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(nt,rt,it,at));this.key=rt,this.fastAesKey=new FastAESKey(this.subtle,rt,at)}return this.fastAesKey.expandKey().then((rt=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new AESCrypto(this.subtle,new Uint8Array(it),at).decrypt(nt.buffer,rt)})).catch((st=>(Qt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${st.name}: ${st.message}`),this.onWebCryptoError(nt,rt,it,at))))}onWebCryptoError(nt,rt,it,at){const st=this.enableSoftwareAES;if(st){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(nt,rt,it,at);const st=this.flush();if(st)return st.buffer}throw new Error("WebCrypto"+(st?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(nt){let rt=nt;const it=nt.length-nt.length%16;return it!==nt.length&&(rt=sliceUint8(nt,0,it),this.remainderData=sliceUint8(nt,it)),rt}logOnce(nt){this.logEnabled&&(Qt.log(`[decrypter]: ${nt}`),this.logEnabled=!1)}}const yr=Math.pow(2,17);class FragmentLoader{constructor(nt){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=nt}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(nt,rt){const it=nt.url;if(!it)return Promise.reject(new LoadError({type:Pt.NETWORK_ERROR,details:kt.FRAG_LOAD_ERROR,fatal:!1,frag:nt,error:new Error("Fragment does not have a "+(it?"part list":"url")),networkDetails:null}));this.abort();const at=this.config,st=at.fLoader,ot=at.loader;return new Promise(((lt,ut)=>{if(this.loader&&this.loader.destroy(),nt.gap){if(nt.tagList.some((nt=>"GAP"===nt[0])))return void ut(createGapLoadError(nt));nt.gap=!1}const ct=this.loader=st?new st(at):new ot(at),dt=createLoaderContext(nt);nt.loader=ct;const ht=getLoaderConfigWithoutReties(at.fragLoadPolicy.default),pt={loadPolicy:ht,timeout:ht.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===nt.sn?1/0:yr};nt.stats=ct.stats;const _t={onSuccess:(rt,it,at,st)=>{this.resetLoader(nt,ct);let ot=rt.data;at.resetIV&&nt.decryptdata&&(nt.decryptdata.iv=new Uint8Array(ot.slice(0,16)),ot=ot.slice(16)),lt({frag:nt,part:null,payload:ot,networkDetails:st})},onError:(rt,at,st,ot)=>{this.resetLoader(nt,ct),ut(new LoadError({type:Pt.NETWORK_ERROR,details:kt.FRAG_LOAD_ERROR,fatal:!1,frag:nt,response:_objectSpread2({url:it,data:void 0},rt),error:new Error(`HTTP Error ${rt.code} ${rt.text}`),networkDetails:st,stats:ot}))},onAbort:(rt,it,at)=>{this.resetLoader(nt,ct),ut(new LoadError({type:Pt.NETWORK_ERROR,details:kt.INTERNAL_ABORTED,fatal:!1,frag:nt,error:new Error("Aborted"),networkDetails:at,stats:rt}))},onTimeout:(rt,it,at)=>{this.resetLoader(nt,ct),ut(new LoadError({type:Pt.NETWORK_ERROR,details:kt.FRAG_LOAD_TIMEOUT,fatal:!1,frag:nt,error:new Error(`Timeout after ${pt.timeout}ms`),networkDetails:at,stats:rt}))}};rt&&(_t.onProgress=(it,at,st,ot)=>rt({frag:nt,part:null,payload:st,networkDetails:ot})),ct.load(dt,pt,_t)}))}loadPart(nt,rt,it){this.abort();const at=this.config,st=at.fLoader,ot=at.loader;return new Promise(((lt,ut)=>{if(this.loader&&this.loader.destroy(),nt.gap||rt.gap)return void ut(createGapLoadError(nt,rt));const ct=this.loader=st?new st(at):new ot(at),dt=createLoaderContext(nt,rt);nt.loader=ct;const ht=getLoaderConfigWithoutReties(at.fragLoadPolicy.default),pt={loadPolicy:ht,timeout:ht.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:yr};rt.stats=ct.stats,ct.load(dt,pt,{onSuccess:(at,st,ot,ut)=>{this.resetLoader(nt,ct),this.updateStatsFromPart(nt,rt);const dt={frag:nt,part:rt,payload:at.data,networkDetails:ut};it(dt),lt(dt)},onError:(it,at,st,ot)=>{this.resetLoader(nt,ct),ut(new LoadError({type:Pt.NETWORK_ERROR,details:kt.FRAG_LOAD_ERROR,fatal:!1,frag:nt,part:rt,response:_objectSpread2({url:dt.url,data:void 0},it),error:new Error(`HTTP Error ${it.code} ${it.text}`),networkDetails:st,stats:ot}))},onAbort:(it,at,st)=>{nt.stats.aborted=rt.stats.aborted,this.resetLoader(nt,ct),ut(new LoadError({type:Pt.NETWORK_ERROR,details:kt.INTERNAL_ABORTED,fatal:!1,frag:nt,part:rt,error:new Error("Aborted"),networkDetails:st,stats:it}))},onTimeout:(it,at,st)=>{this.resetLoader(nt,ct),ut(new LoadError({type:Pt.NETWORK_ERROR,details:kt.FRAG_LOAD_TIMEOUT,fatal:!1,frag:nt,part:rt,error:new Error(`Timeout after ${pt.timeout}ms`),networkDetails:st,stats:it}))}})}))}updateStatsFromPart(nt,rt){const it=nt.stats,at=rt.stats,st=at.total;if(it.loaded+=at.loaded,st){const at=Math.round(nt.duration/rt.duration),ot=Math.min(Math.round(it.loaded/st),at),lt=(at-ot)*Math.round(it.loaded/ot);it.total=it.loaded+lt}else it.total=Math.max(it.loaded,it.total);const ot=it.loading,lt=at.loading;ot.start?ot.first+=lt.first-lt.start:(ot.start=lt.start,ot.first=lt.first),ot.end=lt.end}resetLoader(nt,rt){nt.loader=null,this.loader===rt&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),rt.destroy()}}function createLoaderContext(nt,rt=null){const it=rt||nt,at={frag:nt,part:rt,responseType:"arraybuffer",url:it.url,headers:{},rangeStart:0,rangeEnd:0},st=it.byteRangeStartOffset,ot=it.byteRangeEndOffset;if(wt(st)&&wt(ot)){var lt;let rt=st,it=ot;if("initSegment"===nt.sn&&function isMethodFullSegmentAesCbc(nt){return"AES-128"===nt||"AES-256"===nt}(null==(lt=nt.decryptdata)?void 0:lt.method)){const nt=ot-st;nt%16&&(it=ot+(16-nt%16)),0!==st&&(at.resetIV=!0,rt=st-16)}at.rangeStart=rt,at.rangeEnd=it}return at}function createGapLoadError(nt,rt){const it=new Error(`GAP ${nt.gap?"tag":"attribute"} found`),at={type:Pt.MEDIA_ERROR,details:kt.FRAG_GAP,fatal:!1,frag:nt,error:it,networkDetails:null};return rt&&(at.part=rt),(rt||nt).stats.aborted=!0,new LoadError(at)}class LoadError extends Error{constructor(nt){super(nt.error.message),this.data=void 0,this.data=nt}}class TaskLoop extends Logger{constructor(nt,rt){super(nt,rt),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(nt){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,nt),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class ChunkMetadata{constructor(nt,rt,it,at=0,st=-1,ot=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=nt,this.sn=rt,this.id=it,this.size=at,this.part=st,this.partial=ot}}const Er={length:0,start:()=>0,end:()=>0};class BufferHelper{static isBuffered(nt,rt){if(nt){const it=BufferHelper.getBuffered(nt);for(let nt=it.length;nt--;)if(rt>=it.start(nt)&&rt<=it.end(nt))return!0}return!1}static bufferInfo(nt,rt,it){if(nt){const at=BufferHelper.getBuffered(nt);if(at.length){const nt=[];for(let rt=0;rt<at.length;rt++)nt.push({start:at.start(rt),end:at.end(rt)});return BufferHelper.bufferedInfo(nt,rt,it)}}return{len:0,start:rt,end:rt,nextStart:void 0}}static bufferedInfo(nt,rt,it){rt=Math.max(0,rt),nt.sort(((nt,rt)=>nt.start-rt.start||rt.end-nt.end));let at=[];if(it)for(let rt=0;rt<nt.length;rt++){const st=at.length;if(st){const ot=at[st-1].end;nt[rt].start-ot<it?nt[rt].end>ot&&(at[st-1].end=nt[rt].end):at.push(nt[rt])}else at.push(nt[rt])}else at=nt;let st,ot=0,lt=rt,ut=rt;for(let nt=0;nt<at.length;nt++){const ct=at[nt].start,dt=at[nt].end;if(rt+it>=ct&&rt<dt)lt=ct,ut=dt,ot=ut-rt;else if(rt+it<ct){st=ct;break}}return{len:ot,start:lt||0,end:ut||0,nextStart:st}}static getBuffered(nt){try{return nt.buffered||Er}catch(nt){return Qt.log("failed to get media.buffered",nt),Er}}}const br=/\{\$([a-zA-Z0-9-_]+)\}/g;function hasVariableReferences(nt){return br.test(nt)}function substituteVariables(nt,rt){if(null!==nt.variableList||nt.hasVariableRefs){const it=nt.variableList;return rt.replace(br,(rt=>{const at=rt.substring(2,rt.length-1),st=null==it?void 0:it[at];return void 0===st?(nt.playlistParsingError||(nt.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${at}"`)),rt):st}))}return rt}function addVariableDefinition(nt,rt,it){let at,st,ot=nt.variableList;if(ot||(nt.variableList=ot={}),"QUERYPARAM"in rt){at=rt.QUERYPARAM;try{const nt=new self.URL(it).searchParams;if(!nt.has(at))throw new Error(`"${at}" does not match any query parameter in URI: "${it}"`);st=nt.get(at)}catch(rt){nt.playlistParsingError||(nt.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${rt.message}`))}}else at=rt.NAME,st=rt.VALUE;at in ot?nt.playlistParsingError||(nt.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${at}"`)):ot[at]=st||""}function importVariableDefinition(nt,rt,it){const at=rt.IMPORT;if(it&&at in it){let rt=nt.variableList;rt||(nt.variableList=rt={}),rt[at]=it[at]}else nt.playlistParsingError||(nt.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${at}"`))}const Ar=/^(\d+)x(\d+)$/,Lr=/(.+?)=(".*?"|.*?)(?:,|$)/g;class AttrList{constructor(nt,rt){"string"==typeof nt&&(nt=AttrList.parseAttrList(nt,rt)),_extends(this,nt)}get clientAttrs(){return Object.keys(this).filter((nt=>"X-"===nt.substring(0,2)))}decimalInteger(nt){const rt=parseInt(this[nt],10);return rt>Number.MAX_SAFE_INTEGER?1/0:rt}hexadecimalInteger(nt){if(this[nt]){let rt=(this[nt]||"0x").slice(2);rt=(1&rt.length?"0":"")+rt;const it=new Uint8Array(rt.length/2);for(let nt=0;nt<rt.length/2;nt++)it[nt]=parseInt(rt.slice(2*nt,2*nt+2),16);return it}return null}hexadecimalIntegerAsNumber(nt){const rt=parseInt(this[nt],16);return rt>Number.MAX_SAFE_INTEGER?1/0:rt}decimalFloatingPoint(nt){return parseFloat(this[nt])}optionalFloat(nt,rt){const it=this[nt];return it?parseFloat(it):rt}enumeratedString(nt){return this[nt]}enumeratedStringList(nt,rt){const it=this[nt];return(it?it.split(/[ ,]+/):[]).reduce(((nt,rt)=>(nt[rt.toLowerCase()]=!0,nt)),rt)}bool(nt){return"YES"===this[nt]}decimalResolution(nt){const rt=Ar.exec(this[nt]);if(null!==rt)return{width:parseInt(rt[1],10),height:parseInt(rt[2],10)}}static parseAttrList(nt,rt){let it;const at={};for(Lr.lastIndex=0;null!==(it=Lr.exec(nt));){const st=it[1].trim();let ot=it[2];const lt=0===ot.indexOf('"')&&ot.lastIndexOf('"')===ot.length-1;let ut=!1;if(lt)ot=ot.slice(1,-1);else switch(st){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":ut=!0}if(rt&&(lt||ut))ot=substituteVariables(rt,ot);else if(!ut&&!lt)switch(st){case"CLOSED-CAPTIONS":if("NONE"===ot)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Qt.warn(`${nt}: attribute ${st} is missing quotes`)}at[st]=ot}return at}}function isSCTE35Attribute(nt){return"SCTE35-OUT"===nt||"SCTE35-IN"===nt||"SCTE35-CMD"===nt}class DateRange{constructor(nt,rt,it=0){var at;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==rt?void 0:rt.tagAnchor)||null,this.tagOrder=null!=(at=null==rt?void 0:rt.tagOrder)?at:it,rt){const it=rt.attr;for(const rt in it)if(Object.prototype.hasOwnProperty.call(nt,rt)&&nt[rt]!==it[rt]){Qt.warn(`DATERANGE tag attribute: "${rt}" does not match for tags with ID: "${nt.ID}"`),this._badValueForSameId=rt;break}nt=_extends(new AttrList({}),it,nt)}if(this.attr=nt,rt?(this._startDate=rt._startDate,this._cue=rt._cue,this._endDate=rt._endDate,this._dateAtEnd=rt._dateAtEnd):this._startDate=new Date(nt["START-DATE"]),"END-DATE"in this.attr){const nt=(null==rt?void 0:rt.endDate)||new Date(this.attr["END-DATE"]);wt(nt.getTime())&&(this._endDate=nt)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const nt=this._cue;return void 0===nt?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):nt}get startTime(){const{tagAnchor:nt}=this;return null===nt||null===nt.programDateTime?(Qt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${nt}`),NaN):nt.start+(this.startDate.getTime()-nt.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const nt=this._endDate||this._dateAtEnd;if(nt)return nt;const rt=this.duration;return null!==rt?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*rt):null}get duration(){if("DURATION"in this.attr){const nt=this.attr.decimalFloatingPoint("DURATION");if(wt(nt))return nt}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&wt(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class LevelDetails{constructor(nt){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=nt}reloaded(nt){if(!nt)return this.advanced=!0,void(this.updated=!0);const rt=this.lastPartSn-nt.lastPartSn,it=this.lastPartIndex-nt.lastPartIndex;this.updated=this.endSN!==nt.endSN||!!it||!!rt||!this.live,this.advanced=this.endSN>nt.endSN||rt>0||0===rt&&it>0,this.updated||this.advanced?this.misses=Math.floor(.6*nt.misses):this.misses=nt.misses+1,this.availabilityDelay=nt.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&wt(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const nt=this.driftEndTime-this.driftStartTime;if(nt>0){return 1e3*(this.driftEnd-this.driftStart)/nt}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var nt;return null!=(nt=this.partList)&&nt.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var nt;return null!=(nt=this.fragments)&&nt.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var nt;return null!=(nt=this.fragments)&&nt.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var nt;return null!=(nt=this.partList)&&nt.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var nt;return null!=(nt=this.partList)&&nt.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function isFullSegmentEncryption(nt){return"AES-128"===nt||"AES-256"===nt||"AES-256-CTR"===nt}function getAesModeFromFullSegmentMethod(nt){switch(nt){case"AES-128":case"AES-256":return xn;case"AES-256-CTR":return Un;default:throw new Error(`invalid full segment method ${nt}`)}}function base64Decode(nt){return Uint8Array.from(atob(nt),(nt=>nt.charCodeAt(0)))}function strToUtf8array(nt){return Uint8Array.from(unescape(encodeURIComponent(nt)),(nt=>nt.charCodeAt(0)))}function convertDataUriToArrayBytes(nt){const rt=nt.split(":");let it=null;if("data"===rt[0]&&2===rt.length){const nt=rt[1].split(";"),at=nt[nt.length-1].split(",");if(2===at.length){const rt="base64"===at[0],st=at[1];rt?(nt.splice(-1,1),it=base64Decode(st)):it=function getKeyIdBytes(nt){const rt=strToUtf8array(nt).subarray(0,16),it=new Uint8Array(16);return it.set(rt,16-rt.length),it}(st)}}return it}const Dr="undefined"!=typeof self?self:void 0;var Mr={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Zr="org.w3.clearkey",Vr="com.apple.streamingkeydelivery",jr="com.microsoft.playready",$r="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function keySystemFormatToKeySystemDomain(nt){switch(nt){case Vr:return Mr.FAIRPLAY;case jr:return Mr.PLAYREADY;case $r:return Mr.WIDEVINE;case Zr:return Mr.CLEARKEY}}var zr="1077efecc0b24d02ace33c1e52e2fb4b",Xr="e2719d58a985b3c9781ab030af78d30e",Qr="9a04f07998404286ab92e65be0885f95",ei="edef8ba979d64acea3c827dcd51d21ed";function keySystemIdToKeySystemDomain(nt){return nt===ei?Mr.WIDEVINE:nt===Qr?Mr.PLAYREADY:nt===zr||nt===Xr?Mr.CLEARKEY:void 0}function keySystemDomainToKeySystemFormat(nt){switch(nt){case Mr.FAIRPLAY:return Vr;case Mr.PLAYREADY:return jr;case Mr.WIDEVINE:return $r;case Mr.CLEARKEY:return Zr}}function getKeySystemsForConfig(nt){const{drmSystems:rt,widevineLicenseUrl:it}=nt,at=rt?[Mr.FAIRPLAY,Mr.WIDEVINE,Mr.PLAYREADY,Mr.CLEARKEY].filter((nt=>!!rt[nt])):[];return!at[Mr.WIDEVINE]&&it&&at.push(Mr.WIDEVINE),at}const ni=null!=Dr&&null!=(ii=Dr.navigator)&&ii.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var ii;function parsePlayReadyWRM(nt){const rt=new Uint16Array(nt.buffer,nt.byteOffset,nt.byteLength/2),it=String.fromCharCode.apply(null,Array.from(rt)),at=it.substring(it.indexOf("<"),it.length),st=(new DOMParser).parseFromString(at,"text/xml").getElementsByTagName("KID")[0];if(st){const nt=st.childNodes[0]?st.childNodes[0].nodeValue:st.getAttribute("VALUE");if(nt){const rt=base64Decode(nt).subarray(0,16);return function changeEndianness(nt){const rt=function swap(nt,rt,it){const at=nt[rt];nt[rt]=nt[it],nt[it]=at};rt(nt,0,3),rt(nt,1,2),rt(nt,4,5),rt(nt,6,7)}(rt),rt}}return null}let ai={};class LevelKey{static clearKeyUriToKeyIdMap(){ai={}}constructor(nt,rt,it,at=[1],st=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=nt,this.uri=rt,this.keyFormat=it,this.keyFormatVersions=at,this.iv=st,this.encrypted=!!nt&&"NONE"!==nt,this.isCommonEncryption=this.encrypted&&!isFullSegmentEncryption(nt)}isSupported(){if(this.method){if(isFullSegmentEncryption(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case Vr:case $r:case jr:case Zr:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(nt){if(!this.encrypted||!this.uri)return null;if(isFullSegmentEncryption(this.method)&&this.uri&&!this.iv){"number"!=typeof nt&&(Qt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),nt=0);const rt=function createInitializationVector(nt){const rt=new Uint8Array(16);for(let it=12;it<16;it++)rt[it]=nt>>8*(15-it)&255;return rt}(nt);return new LevelKey(this.method,this.uri,"identity",this.keyFormatVersions,rt)}const rt=convertDataUriToArrayBytes(this.uri);if(rt)switch(this.keyFormat){case $r:this.pssh=rt,rt.length>=22&&(this.keyId=rt.subarray(rt.length-22,rt.length-6));break;case jr:{const nt=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=mp4pssh(nt,0,rt),this.keyId=parsePlayReadyWRM(rt);break}default:{let nt=rt.subarray(0,16);if(16!==nt.length){const rt=new Uint8Array(16);rt.set(nt,16-nt.length),nt=rt}this.keyId=nt;break}}if(!this.keyId||16!==this.keyId.byteLength){let nt=ai[this.uri];if(!nt){const rt=Object.keys(ai).length%Number.MAX_SAFE_INTEGER;nt=new Uint8Array(16);new DataView(nt.buffer,12,4).setUint32(0,rt),ai[this.uri]=nt}this.keyId=nt}return this}}const si=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,ui=/#EXT-X-MEDIA:(.*)/g,ci=/^#EXT(?:INF|-X-TARGETDURATION):/m,fi=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),pi=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class M3U8Parser{static findGroup(nt,rt){for(let it=0;it<nt.length;it++){const at=nt[it];if(at.id===rt)return at}}static resolve(nt,rt){return Yn.buildAbsoluteURL(rt,nt,{alwaysNormalize:!0})}static isMediaPlaylist(nt){return ci.test(nt)}static parseMasterPlaylist(nt,rt){const it={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:hasVariableReferences(nt)},at=[];let st;for(si.lastIndex=0;null!=(st=si.exec(nt));)if(st[1]){var ot;const nt=new AttrList(st[1],it),lt=substituteVariables(it,st[2]),ut={attrs:nt,bitrate:nt.decimalInteger("BANDWIDTH")||nt.decimalInteger("AVERAGE-BANDWIDTH"),name:nt.NAME,url:M3U8Parser.resolve(lt,rt)},ct=nt.decimalResolution("RESOLUTION");ct&&(ut.width=ct.width,ut.height=ct.height),setCodecs(nt.CODECS,ut),null!=(ot=ut.unknownCodecs)&&ot.length||at.push(ut),it.levels.push(ut)}else if(st[3]){const nt=st[3],at=st[4];switch(nt){case"SESSION-DATA":{const nt=new AttrList(at,it),rt=nt["DATA-ID"];rt&&(null===it.sessionData&&(it.sessionData={}),it.sessionData[rt]=nt);break}case"SESSION-KEY":{const nt=parseKey(at,rt,it);nt.encrypted&&nt.isSupported()?(null===it.sessionKeys&&(it.sessionKeys=[]),it.sessionKeys.push(nt)):Qt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${at}"`);break}case"DEFINE":addVariableDefinition(it,new AttrList(at,it),rt);break;case"CONTENT-STEERING":{const nt=new AttrList(at,it);it.contentSteering={uri:M3U8Parser.resolve(nt["SERVER-URI"],rt),pathwayId:nt["PATHWAY-ID"]||"."};break}case"START":it.startTimeOffset=parseStartTimeOffset(at)}}const lt=at.length>0&&at.length<it.levels.length;return it.levels=lt?at:it.levels,0===it.levels.length&&(it.playlistParsingError=new Error("no levels found in manifest")),it}static parseMasterPlaylistMedia(nt,rt,it){let at;const st={},ot=it.levels,lt={AUDIO:ot.map((nt=>({id:nt.attrs.AUDIO,audioCodec:nt.audioCodec}))),SUBTITLES:ot.map((nt=>({id:nt.attrs.SUBTITLES,textCodec:nt.textCodec}))),"CLOSED-CAPTIONS":[]};let ut=0;for(ui.lastIndex=0;null!==(at=ui.exec(nt));){const nt=new AttrList(at[1],it),ot=nt.TYPE;if(ot){const it=lt[ot],at=st[ot]||[];st[ot]=at;const ct=nt.LANGUAGE,dt=nt["ASSOC-LANGUAGE"],ht=nt.CHANNELS,pt=nt.CHARACTERISTICS,_t=nt["INSTREAM-ID"],Et={attrs:nt,bitrate:0,id:ut++,groupId:nt["GROUP-ID"]||"",name:nt.NAME||ct||"",type:ot,default:nt.bool("DEFAULT"),autoselect:nt.bool("AUTOSELECT"),forced:nt.bool("FORCED"),lang:ct,url:nt.URI?M3U8Parser.resolve(nt.URI,rt):""};if(dt&&(Et.assocLang=dt),ht&&(Et.channels=ht),pt&&(Et.characteristics=pt),_t&&(Et.instreamId=_t),null!=it&&it.length){const nt=M3U8Parser.findGroup(it,Et.groupId)||it[0];assignCodec(Et,nt,"audioCodec"),assignCodec(Et,nt,"textCodec")}at.push(Et)}}return st}static parseLevelPlaylist(nt,rt,it,at,st,ot){const lt=new LevelDetails(rt),ut=lt.fragments,ct=[];let dt,ht,pt,_t=null,Et=0,St=0,Lt=0,Ct=0,Pt=null,kt=new Fragment(at,rt),Ot=-1,Ft=!1,Bt=null;for(fi.lastIndex=0,lt.m3u8=nt,lt.hasVariableRefs=hasVariableReferences(nt);null!==(dt=fi.exec(nt));){Ft&&(Ft=!1,kt=new Fragment(at,rt),kt.playlistOffset=Lt,kt.start=Lt,kt.sn=Et,kt.cc=Ct,kt.level=it,_t&&(kt.initSegment=_t,kt.rawProgramDateTime=_t.rawProgramDateTime,_t.rawProgramDateTime=null,Bt&&(kt.setByteRange(Bt),Bt=null)));const nt=dt[1];if(nt){kt.duration=parseFloat(nt);const rt=(" "+dt[2]).slice(1);kt.title=rt||null,kt.tagList.push(rt?["INF",nt,rt]:["INF",nt])}else if(dt[3]){if(wt(kt.duration)){kt.playlistOffset=Lt,kt.start=Lt,pt&&setFragLevelKeys(kt,pt,lt),kt.sn=Et,kt.level=it,kt.cc=Ct,ut.push(kt);const nt=(" "+dt[3]).slice(1);kt.relurl=substituteVariables(lt,nt),assignProgramDateTime(kt,Pt,ct),Pt=kt,Lt+=kt.duration,Et++,St=0,Ft=!0}}else if(dt[4]){const nt=(" "+dt[4]).slice(1);Pt?kt.setByteRange(nt,Pt):kt.setByteRange(nt)}else if(dt[5])kt.rawProgramDateTime=(" "+dt[5]).slice(1),kt.tagList.push(["PROGRAM-DATE-TIME",kt.rawProgramDateTime]),-1===Ot&&(Ot=ut.length);else{if(dt=dt[0].match(pi),!dt){Qt.warn("No matches on slow regex match for level playlist!");continue}for(ht=1;ht<dt.length&&void 0===dt[ht];ht++);const nt=(" "+dt[ht]).slice(1),st=(" "+dt[ht+1]).slice(1),ct=dt[ht+2]?(" "+dt[ht+2]).slice(1):"";switch(nt){case"PLAYLIST-TYPE":lt.type=st.toUpperCase();break;case"MEDIA-SEQUENCE":Et=lt.startSN=parseInt(st);break;case"SKIP":{lt.skippedSegments&&(lt.playlistParsingError=new Error("#EXT-X-SKIP MUST NOT appear more than once in a Playlist"));const nt=new AttrList(st,lt),rt=nt.decimalInteger("SKIPPED-SEGMENTS");if(wt(rt)){lt.skippedSegments+=rt;for(let nt=rt;nt--;)ut.push(null);Et+=rt}const it=nt.enumeratedString("RECENTLY-REMOVED-DATERANGES");it&&(lt.recentlyRemovedDateranges=(lt.recentlyRemovedDateranges||[]).concat(it.split("\t")));break}case"TARGETDURATION":lt.targetduration=Math.max(parseInt(st),1);break;case"VERSION":lt.version=parseInt(st);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":lt.live=!1;break;case"#":(st||ct)&&kt.tagList.push(ct?[st,ct]:[st]);break;case"DISCONTINUITY":Ct++,kt.tagList.push(["DIS"]);break;case"GAP":kt.gap=!0,kt.tagList.push([nt]);break;case"BITRATE":kt.tagList.push([nt,st]);break;case"DATERANGE":{const nt=new AttrList(st,lt),rt=new DateRange(nt,lt.dateRanges[nt.ID],lt.dateRangeTagCount);lt.dateRangeTagCount++,rt.isValid||lt.skippedSegments?lt.dateRanges[rt.id]=rt:Qt.warn(`Ignoring invalid DATERANGE tag: "${st}"`),kt.tagList.push(["EXT-X-DATERANGE",st]);break}case"DEFINE":{const nt=new AttrList(st,lt);"IMPORT"in nt?importVariableDefinition(lt,nt,ot):addVariableDefinition(lt,nt,rt)}break;case"DISCONTINUITY-SEQUENCE":Ct=parseInt(st);break;case"KEY":{const nt=parseKey(st,rt,lt);if(nt.isSupported()){if("NONE"===nt.method){pt=void 0;break}pt||(pt={}),pt[nt.keyFormat]&&(pt=_extends({},pt)),pt[nt.keyFormat]=nt}else Qt.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${st}"`);break}case"START":lt.startTimeOffset=parseStartTimeOffset(st);break;case"MAP":{const nt=new AttrList(st,lt);if(kt.duration){const st=new Fragment(at,rt);setInitSegment(st,nt,it,pt),_t=st,kt.initSegment=_t,_t.rawProgramDateTime&&!kt.rawProgramDateTime&&(kt.rawProgramDateTime=_t.rawProgramDateTime)}else{const rt=kt.byteRangeEndOffset;if(rt){const nt=kt.byteRangeStartOffset;Bt=`${rt-nt}@${nt}`}else Bt=null;setInitSegment(kt,nt,it,pt),_t=kt,Ft=!0}_t.cc=Ct;break}case"SERVER-CONTROL":{const nt=new AttrList(st);lt.canBlockReload=nt.bool("CAN-BLOCK-RELOAD"),lt.canSkipUntil=nt.optionalFloat("CAN-SKIP-UNTIL",0),lt.canSkipDateRanges=lt.canSkipUntil>0&&nt.bool("CAN-SKIP-DATERANGES"),lt.partHoldBack=nt.optionalFloat("PART-HOLD-BACK",0),lt.holdBack=nt.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const nt=new AttrList(st);lt.partTarget=nt.decimalFloatingPoint("PART-TARGET");break}case"PART":{let nt=lt.partList;nt||(nt=lt.partList=[]);const it=St>0?nt[nt.length-1]:void 0,at=St++,ot=new AttrList(st,lt),ut=new Part(ot,kt,rt,at,it);nt.push(ut),kt.duration+=ut.duration;break}case"PRELOAD-HINT":{const nt=new AttrList(st,lt);lt.preloadHint=nt;break}case"RENDITION-REPORT":{const nt=new AttrList(st,lt);lt.renditionReports=lt.renditionReports||[],lt.renditionReports.push(nt);break}default:Qt.warn(`line parsed but not handled: ${dt}`)}}}Pt&&!Pt.relurl?(ut.pop(),Lt-=Pt.duration,lt.partList&&(lt.fragmentHint=Pt)):lt.partList&&(assignProgramDateTime(kt,Pt,ct),kt.cc=Ct,lt.fragmentHint=kt,pt&&setFragLevelKeys(kt,pt,lt));const Ut=ut.length,Gt=ut[0],Ht=ut[Ut-1];if(Lt+=lt.skippedSegments*lt.targetduration,Lt>0&&Ut&&Ht){lt.averagetargetduration=Lt/Ut;const nt=Ht.sn;lt.endSN="initSegment"!==nt?nt:0,lt.live||(Ht.endList=!0),Gt&&(lt.startCC=Gt.cc),Ot>0&&(!function backfillProgramDateTimes(nt,rt){let it=nt[rt];for(let at=rt;at--;){const rt=nt[at];if(!rt)return;rt.programDateTime=it.programDateTime-1e3*rt.duration,it=rt}}(ut,Ot),Gt&&ct.unshift(Gt))}else lt.endSN=0,lt.startCC=0;return lt.fragmentHint&&(Lt+=lt.fragmentHint.duration),lt.totalduration=Lt,ct.length&&lt.dateRangeTagCount&&Gt&&mapDateRanges(ct,lt),lt.endCC=Ct,lt}}function mapDateRanges(nt,rt){const it=nt.length,at=nt[it-1],st=rt.live?1/0:rt.totalduration,ot=Object.keys(rt.dateRanges);for(let lt=ot.length;lt--;){const ut=rt.dateRanges[ot[lt]],ct=ut.startDate.getTime();ut.tagAnchor=at;for(let at=it;at--;){const it=findFragmentWithStartDate(rt,ct,nt,at,st);if(-1!==it){ut.tagAnchor=rt.fragments[it];break}}}}function findFragmentWithStartDate(nt,rt,it,at,st){const ot=it[at];if(ot){var lt;const ut=((null==(lt=it[at+1])?void 0:lt.start)||st)-ot.start,ct=ot.programDateTime;if((rt>=ct||0===at)&&rt<=ct+1e3*ut){const st=it[at].sn-nt.startSN,ot=nt.fragments;if(ot.length>it.length){for(let lt=(it[at+1]||ot[ot.length-1]).sn-nt.startSN;lt>st;lt--){const nt=ot[lt].programDateTime;if(rt>=nt&&rt<nt+1e3*ot[lt].duration)return lt}}return st}}return-1}function parseKey(nt,rt,it){var at,st;const ot=new AttrList(nt,it),lt=null!=(at=ot.METHOD)?at:"",ut=ot.URI,ct=ot.hexadecimalInteger("IV"),dt=ot.KEYFORMATVERSIONS,ht=null!=(st=ot.KEYFORMAT)?st:"identity";ut&&ot.IV&&!ct&&Qt.error(`Invalid IV: ${ot.IV}`);const pt=ut?M3U8Parser.resolve(ut,rt):"",_t=(dt||"1").split("/").map(Number).filter(Number.isFinite);return new LevelKey(lt,pt,ht,_t,ct)}function parseStartTimeOffset(nt){const rt=new AttrList(nt).decimalFloatingPoint("TIME-OFFSET");return wt(rt)?rt:null}function setCodecs(nt,rt){let it=(nt||"").split(/[ ,]+/).filter((nt=>nt));["video","audio","text"].forEach((nt=>{const at=it.filter((rt=>function isCodecType(nt,rt){const it=en[rt];return!!it&&!!it[nt.slice(0,4)]}(rt,nt)));at.length&&(rt[`${nt}Codec`]=at.join(","),it=it.filter((nt=>-1===at.indexOf(nt))))})),rt.unknownCodecs=it}function assignCodec(nt,rt,it){const at=rt[it];at&&(nt[it]=at)}function assignProgramDateTime(nt,rt,it){if(nt.rawProgramDateTime){if(nt.programDateTime=Date.parse(nt.rawProgramDateTime),!wt(nt.programDateTime))return nt.programDateTime=null,void(nt.rawProgramDateTime=null);it.push(nt)}else null!=rt&&rt.programDateTime&&(nt.programDateTime=rt.endProgramDateTime)}function setInitSegment(nt,rt,it,at){nt.relurl=rt.URI,rt.BYTERANGE&&nt.setByteRange(rt.BYTERANGE),nt.level=it,nt.sn="initSegment",at&&(nt.levelkeys=at),nt.initSegment=null}function setFragLevelKeys(nt,rt,it){nt.levelkeys=rt;const{encryptedFragments:at}=it;at.length&&at[at.length-1].levelkeys===rt||!Object.keys(rt).some((nt=>rt[nt].isCommonEncryption))||at.push(nt)}function updateFromToPTS(nt,rt){const it=rt.startPTS;if(wt(it)){let at,st=0;rt.sn>nt.sn?(st=it-nt.start,at=nt):(st=nt.start-it,at=rt),at.duration!==st&&(at.duration=st)}else if(rt.sn>nt.sn){nt.cc===rt.cc&&nt.minEndPTS?rt.start=nt.start+(nt.minEndPTS-nt.start):rt.start=nt.start+nt.duration}else rt.start=Math.max(nt.start-rt.duration,0)}function updateFragPTSDTS(nt,rt,it,at,st,ot){at-it<=0&&(Qt.warn("Fragment should have a positive duration",rt),at=it+rt.duration,ot=st+rt.duration);let lt=it,ut=at;const ct=rt.startPTS,dt=rt.endPTS;if(wt(ct)){const nt=Math.abs(ct-it);wt(rt.deltaPTS)?rt.deltaPTS=Math.max(nt,rt.deltaPTS):rt.deltaPTS=nt,lt=Math.max(it,ct),it=Math.min(it,ct),st=Math.min(st,rt.startDTS),ut=Math.min(at,dt),at=Math.max(at,dt),ot=Math.max(ot,rt.endDTS)}const ht=it-rt.start;0!==rt.start&&(rt.start=it),rt.duration=at-rt.start,rt.startPTS=it,rt.maxStartPTS=lt,rt.startDTS=st,rt.endPTS=at,rt.minEndPTS=ut,rt.endDTS=ot;const pt=rt.sn;if(!nt||pt<nt.startSN||pt>nt.endSN)return 0;let _t;const Et=pt-nt.startSN,St=nt.fragments;for(St[Et]=rt,_t=Et;_t>0;_t--)updateFromToPTS(St[_t],St[_t-1]);for(_t=Et;_t<St.length-1;_t++)updateFromToPTS(St[_t],St[_t+1]);return nt.fragmentHint&&updateFromToPTS(St[St.length-1],nt.fragmentHint),nt.PTSKnown=nt.alignedSliding=!0,ht}function mergeDetails(nt,rt){let it=null;const at=nt.fragments;for(let nt=at.length-1;nt>=0;nt--){const rt=at[nt].initSegment;if(rt){it=rt;break}}nt.fragmentHint&&delete nt.fragmentHint.endPTS;let st,ot=0;!function mapFragmentIntersection(nt,rt,it){const at=rt.skippedSegments,st=Math.max(nt.startSN,rt.startSN)-rt.startSN,ot=(nt.fragmentHint?1:0)+(at?rt.endSN:Math.min(nt.endSN,rt.endSN))-rt.startSN,lt=rt.startSN-nt.startSN,ut=rt.fragmentHint?rt.fragments.concat(rt.fragmentHint):rt.fragments,ct=nt.fragmentHint?nt.fragments.concat(nt.fragmentHint):nt.fragments;for(let nt=st;nt<=ot;nt++){const st=ct[lt+nt];let ot=ut[nt];at&&!ot&&st&&(ot=rt.fragments[nt]=st),st&&ot&&it(st,ot)}}(nt,rt,((nt,at)=>{nt.relurl&&(ot=nt.cc-at.cc),wt(nt.startPTS)&&wt(nt.endPTS)&&(at.start=at.startPTS=nt.startPTS,at.startDTS=nt.startDTS,at.maxStartPTS=nt.maxStartPTS,at.endPTS=nt.endPTS,at.endDTS=nt.endDTS,at.minEndPTS=nt.minEndPTS,at.duration=nt.endPTS-nt.startPTS,at.duration&&(st=at),rt.PTSKnown=rt.alignedSliding=!0),at.elementaryStreams=nt.elementaryStreams,at.loader=nt.loader,at.stats=nt.stats,nt.initSegment&&(at.initSegment=nt.initSegment,it=nt.initSegment)}));const lt=rt.fragmentHint?rt.fragments.concat(rt.fragmentHint):rt.fragments;if(it&&lt.forEach((nt=>{var rt;!nt||nt.initSegment&&nt.initSegment.relurl!==(null==(rt=it)?void 0:rt.relurl)||(nt.initSegment=it)})),rt.skippedSegments)if(rt.deltaUpdateFailed=rt.fragments.some((nt=>!nt)),rt.deltaUpdateFailed){Qt.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let nt=rt.skippedSegments;nt--;)rt.fragments.shift();rt.startSN=rt.fragments[0].sn,rt.startCC=rt.fragments[0].cc}else{rt.canSkipDateRanges&&(rt.dateRanges=function mergeDateRanges(nt,rt){const{dateRanges:it,recentlyRemovedDateranges:at}=rt,st=_extends({},nt);at&&at.forEach((nt=>{delete st[nt]}));const ot=Object.keys(st).length;ot&&Object.keys(it).forEach((nt=>{const rt=st[nt],at=new DateRange(it[nt].attr,rt);at.isValid?(st[nt]=at,rt||(at.tagOrder+=ot)):Qt.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(it[nt].attr)}"`)}));return st}(nt.dateRanges,rt));const it=nt.fragments.filter((nt=>nt.rawProgramDateTime));if(nt.hasProgramDateTime&&!rt.hasProgramDateTime)for(let nt=1;nt<lt.length;nt++)null===lt[nt].programDateTime&&assignProgramDateTime(lt[nt],lt[nt-1],it);mapDateRanges(it,rt)}const ut=rt.fragments;if(ot){Qt.warn("discontinuity sliding from playlist, take drift into account");for(let nt=0;nt<ut.length;nt++)ut[nt].cc+=ot}rt.skippedSegments&&(rt.startCC=rt.fragments[0].cc),function mapPartIntersection(nt,rt,it){if(nt&&rt){let at=0;for(let st=0,ot=nt.length;st<=ot;st++){const ot=nt[st],lt=rt[st+at];ot&&lt&&ot.index===lt.index&&ot.fragment.sn===lt.fragment.sn?it(ot,lt):at--}}}(nt.partList,rt.partList,((nt,rt)=>{rt.elementaryStreams=nt.elementaryStreams,rt.stats=nt.stats})),st?updateFragPTSDTS(rt,st,st.startPTS,st.endPTS,st.startDTS,st.endDTS):adjustSliding(nt,rt),ut.length&&(rt.totalduration=rt.edge-ut[0].start),rt.driftStartTime=nt.driftStartTime,rt.driftStart=nt.driftStart;const ct=rt.advancedDateTime;if(rt.advanced&&ct){const nt=rt.edge;rt.driftStart||(rt.driftStartTime=ct,rt.driftStart=nt),rt.driftEndTime=ct,rt.driftEnd=nt}else rt.driftEndTime=nt.driftEndTime,rt.driftEnd=nt.driftEnd,rt.advancedDateTime=nt.advancedDateTime}function adjustSliding(nt,rt,it=!0){const at=rt.startSN+rt.skippedSegments-nt.startSN,st=nt.fragments,ot=at>=0;let lt=0;if(ot&&at<st.length)lt=st[at].start;else if(ot&&it)lt=nt.edge;else{if(rt.skippedSegments||0!==rt.fragments[0].start)return;lt=nt.fragments[0].start}addSliding(rt,lt)}function addSliding(nt,rt){if(rt){const it=nt.fragments;for(let at=nt.skippedSegments;at<it.length;at++)it[at].start+=rt;nt.fragmentHint&&(nt.fragmentHint.start+=rt)}}function getPartWith(nt,rt,it){return nt?findPart(nt.partList,rt,it):null}function findPart(nt,rt,it){if(nt)for(let at=nt.length;at--;){const st=nt[at];if(st.index===it&&st.fragment.sn===rt)return st}return null}function reassignFragmentLevelIndexes(nt){nt.forEach(((nt,rt)=>{const{details:it}=nt;null!=it&&it.fragments&&it.fragments.forEach((nt=>{nt.level=rt}))}))}function findFirstFragWithCC(nt,rt){for(let at=0,st=nt.length;at<st;at++){var it;if((null==(it=nt[at])?void 0:it.cc)===rt)return nt[at]}return null}function adjustFragmentStart(nt,rt){if(nt){const it=nt.start+rt;nt.start=nt.startPTS=it,nt.endPTS=it+nt.duration}}function adjustSlidingStart(nt,rt){const it=rt.fragments;for(let rt=0,at=it.length;rt<at;rt++)adjustFragmentStart(it[rt],nt);rt.fragmentHint&&adjustFragmentStart(rt.fragmentHint,nt),rt.alignedSliding=!0}function alignStream(nt,rt,it){rt&&(!function alignDiscontinuities(nt,rt){if(!function shouldAlignOnDiscontinuities(nt,rt){return!!(nt&&rt.startCC<nt.endCC&&rt.endCC>nt.startCC)}(rt,nt))return;const it=Math.min(rt.endCC,nt.endCC),at=findFirstFragWithCC(rt.fragments,it),st=findFirstFragWithCC(nt.fragments,it);if(!at||!st)return;Qt.log(`Aligning playlist at start of dicontinuity sequence ${it}`);adjustSlidingStart(at.start-st.start,nt)}(it,rt),!it.alignedSliding&&rt&&alignMediaPlaylistByPDT(it,rt),it.alignedSliding||!rt||it.skippedSegments||adjustSliding(rt,it,!1))}function alignMediaPlaylistByPDT(nt,rt){if(!nt.hasProgramDateTime||!rt.hasProgramDateTime)return;const it=nt.fragments,at=rt.fragments;if(!it.length||!at.length)return;let st,ot;const lt=Math.min(rt.endCC,nt.endCC);rt.startCC<lt&&nt.startCC<lt&&(st=findFirstFragWithCC(at,lt),ot=findFirstFragWithCC(it,lt)),st&&ot||(st=at[Math.floor(at.length/2)],ot=findFirstFragWithCC(it,st.cc)||it[Math.floor(it.length/2)]);const ut=st.programDateTime,ct=ot.programDateTime;if(!ut||!ct)return;adjustSlidingStart((ct-ut)/1e3-(ot.start-st.start),nt)}const TimeRanges_toString=function(nt){let rt="";const it=nt.length;for(let at=0;at<it;at++)rt+=`[${nt.start(at).toFixed(3)}-${nt.end(at).toFixed(3)}]`;return rt},gi="STOPPED",_i="IDLE",yi="KEY_LOADING",vi="FRAG_LOADING",Ti="FRAG_LOADING_WAITING_RETRY",bi="WAITING_TRACK",Ai="PARSING",Ri="PARSED",Ii="ENDED",wi="ERROR",Ci="WAITING_INIT_PTS",Mi="WAITING_LEVEL";class BaseStreamController extends TaskLoop{constructor(nt,rt,it,at,st){super(at,nt.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=gi,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:nt,fragCurrent:rt,media:it,mediaBuffer:at,state:st}=this,ot=it?it.currentTime:0,lt=BufferHelper.bufferInfo(at||it,ot,nt.maxBufferHole);if(this.log(`media seeking to ${wt(ot)?ot.toFixed(3):ot}, state: ${st}`),this.state===Ii)this.resetLoadingState();else if(rt){const it=nt.maxFragLookUpTolerance,at=rt.start-it,st=rt.start+rt.duration+it;if(!lt.len||st<lt.start||at>lt.end){const nt=ot>st;(ot<at||nt)&&(nt&&rt.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),rt.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(it){this.fragmentTracker.removeFragmentsInRange(ot,1/0,this.playlistType,!0);if(ot>this.lastCurrentTime&&(this.lastCurrentTime=ot),!this.loadingParts){const nt=Math.max(lt.end,ot),rt=this.shouldLoadParts(this.getLevelDetails(),nt);rt&&(this.log(`LL-Part loading ON after seeking to ${ot.toFixed(2)} with buffer @${nt.toFixed(2)}`),this.loadingParts=rt)}}this.hls.hasEnoughToStart||lt.len||(this.log(`setting startPosition to ${ot} because of seek before start`),this.nextLoadPosition=this.startPosition=ot),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0,this.triggerEnded()},this.playlistType=st,this.hls=nt,this.fragmentLoader=new FragmentLoader(nt.config),this.keyLoader=it,this.fragmentTracker=rt,this.config=nt.config,this.decrypter=new Decrypter(nt.config)}registerListeners(){const{hls:nt}=this;nt.on(Ot.MEDIA_ATTACHED,this.onMediaAttached,this),nt.on(Ot.MEDIA_DETACHING,this.onMediaDetaching,this),nt.on(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.on(Ot.MANIFEST_LOADED,this.onManifestLoaded,this),nt.on(Ot.ERROR,this.onError,this)}unregisterListeners(){const{hls:nt}=this;nt.off(Ot.MEDIA_ATTACHED,this.onMediaAttached,this),nt.off(Ot.MEDIA_DETACHING,this.onMediaDetaching,this),nt.off(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.off(Ot.MANIFEST_LOADED,this.onManifestLoaded,this),nt.off(Ot.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(nt){}stopLoad(){if(this.state===gi)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const nt=this.fragCurrent;null!=nt&&nt.loader&&(nt.abortRequests(),this.fragmentTracker.removeFragment(nt)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=gi}get startPositionValue(){const{nextLoadPosition:nt,startPosition:rt}=this;return-1===rt&&nt?nt:rt}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}_streamEnded(nt,rt){const it=void 0!==this.config.timelineOffset,at=nt.nextStart,st=at&&(!it||at<rt.edge);if(rt.live||st||!nt.end||!this.media)return!1;const ot=rt.partList;if(null!=ot&&ot.length){const nt=ot[ot.length-1];return BufferHelper.isBuffered(this.media,nt.start+nt.duration/2)}const lt=rt.fragments[rt.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(lt)}getLevelDetails(){var nt;if(this.levels&&null!==this.levelLastLoaded)return null==(nt=this.levelLastLoaded)?void 0:nt.details}onMediaAttached(nt,rt){const it=this.media=this.mediaBuffer=rt.media;it.removeEventListener("seeking",this.onMediaSeeking),it.removeEventListener("ended",this.onMediaEnded),it.addEventListener("seeking",this.onMediaSeeking),it.addEventListener("ended",this.onMediaEnded);const at=this.config;this.levels&&at.autoStartLoad&&this.state===gi&&this.startLoad(at.startPosition)}onMediaDetaching(nt,rt){const it=!!rt.transferMedia,at=this.media;null!==at&&(at.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),at.removeEventListener("seeking",this.onMediaSeeking),at.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!it&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,it?this.resetTransmuxer():(this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()))}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(nt,rt){}triggerEnded(){}onManifestLoaded(nt,rt){this.startTimeOffset=rt.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=gi,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(nt,rt,it){const at=this.hls.config;if(at.interstitialsController&&!1!==at.enableInterstitialPlayback){const it=this.hls.interstitialsManager,at=null==it?void 0:it.bufferingItem;if(at){const it=at.event;if(it){if(it.appendInPlace||Math.abs(nt.start-at.start)>1||0===at.start)return}else{var st;if(nt.end<=at.start&&!1===(null==(st=rt.details)?void 0:st.live))return;if(nt.start>at.end&&at.nextEvent)return}}}this.startFragRequested=!0,this._loadFragForPlayback(nt,rt,it)}_loadFragForPlayback(nt,rt,it){this._doFragLoad(nt,rt,it,(rt=>{if(this.fragContextChanged(nt))return this.warn(`Fragment ${nt.sn}${rt.part?" p: "+rt.part.index:""} of level ${nt.level} was dropped during download.`),void this.fragmentTracker.removeFragment(nt);nt.stats.chunkCount++,this._handleFragmentLoadProgress(rt)})).then((rt=>{if(!rt)return;const it=this.state;this.fragContextChanged(nt)?(it===vi||!this.fragCurrent&&it===Ai)&&(this.fragmentTracker.removeFragment(nt),this.state=_i):("payload"in rt&&(this.log(`Loaded ${nt.type} sn: ${nt.sn} of ${this.playlistLabel()} ${nt.level}`),this.hls.trigger(Ot.FRAG_LOADED,rt)),this._handleFragmentLoadComplete(rt))})).catch((rt=>{this.state!==gi&&this.state!==wi&&(this.warn(`Frag error: ${(null==rt?void 0:rt.message)||rt}`),this.resetFragmentLoading(nt))}))}clearTrackerIfNeeded(nt){var rt;const{fragmentTracker:it}=this;if(it.getState(nt)===Dn){const rt=nt.type,at=this.getFwdBufferInfo(this.mediaBuffer,rt),st=Math.max(nt.duration,at?at.len:this.config.maxBufferLength),ot=this.backtrackFragment;(1===(ot?nt.sn-ot.sn:0)||this.reduceMaxBufferLength(st,nt.duration))&&it.removeFragment(nt)}else 0===(null==(rt=this.mediaBuffer)?void 0:rt.buffered.length)?it.removeAllFragments():it.hasParts(nt.type)&&(it.detectPartialFragments({frag:nt,part:null,stats:nt.stats,id:nt.type}),it.getState(nt)===Mn&&it.removeFragment(nt))}checkLiveUpdate(nt){if(nt.updated&&!nt.live){const rt=nt.fragments[nt.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:rt,part:null,stats:rt.stats,id:rt.type})}nt.fragments[0]||(nt.deltaUpdateFailed=!0)}flushMainBuffer(nt,rt,it=null){if(!(nt-rt))return;const at={startOffset:nt,endOffset:rt,type:it};this.hls.trigger(Ot.BUFFER_FLUSHING,at)}_loadInitSegment(nt,rt){this._doFragLoad(nt,rt).then((rt=>{if(!rt||this.fragContextChanged(nt)||!this.levels)throw new Error("init load aborted");return rt})).then((rt=>{const{hls:it}=this,{payload:at}=rt,st=nt.decryptdata;if(at&&at.byteLength>0&&null!=st&&st.key&&st.iv&&isFullSegmentEncryption(st.method)){const ot=self.performance.now();return this.decrypter.decrypt(new Uint8Array(at),st.key.buffer,st.iv.buffer,getAesModeFromFullSegmentMethod(st.method)).catch((rt=>{throw it.trigger(Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.FRAG_DECRYPT_ERROR,fatal:!1,error:rt,reason:rt.message,frag:nt}),rt})).then((at=>{const st=self.performance.now();return it.trigger(Ot.FRAG_DECRYPTED,{frag:nt,payload:at,stats:{tstart:ot,tdecrypt:st}}),rt.payload=at,this.completeInitSegmentLoad(rt)}))}return this.completeInitSegmentLoad(rt)})).catch((rt=>{this.state!==gi&&this.state!==wi&&(this.warn(rt),this.resetFragmentLoading(nt))}))}completeInitSegmentLoad(nt){const{levels:rt}=this;if(!rt)throw new Error("init load aborted, missing levels");const it=nt.frag.stats;this.state!==gi&&(this.state=_i),nt.frag.data=new Uint8Array(nt.payload),it.parsing.start=it.buffering.start=self.performance.now(),it.parsing.end=it.buffering.end=self.performance.now(),this.tick()}fragContextChanged(nt){const{fragCurrent:rt}=this;return!nt||!rt||nt.sn!==rt.sn||nt.level!==rt.level}fragBufferedComplete(nt,rt){const it=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${nt.type} sn: ${nt.sn}${rt?" part: "+rt.index:""} of ${this.fragInfo(nt)} > buffer:${it?TimeRanges_toString(BufferHelper.getBuffered(it)):"(detached)"})`),"initSegment"!==nt.sn){var at;if(nt.type!==Kt){const rt=nt.elementaryStreams;if(!Object.keys(rt).some((nt=>!!rt[nt])))return void(this.state=_i)}const rt=null==(at=this.levels)?void 0:at[nt.level];null!=rt&&rt.fragmentError&&(this.log(`Resetting level fragment error count of ${rt.fragmentError} on frag buffered`),rt.fragmentError=0)}this.state=_i}_handleFragmentLoadComplete(nt){const{transmuxer:rt}=this;if(!rt)return;const{frag:it,part:at,partsLoaded:st}=nt,ot=!st||0===st.length||st.some((nt=>!nt)),lt=new ChunkMetadata(it.level,it.sn,it.stats.chunkCount+1,0,at?at.index:-1,!ot);rt.flush(lt)}_handleFragmentLoadProgress(nt){}_doFragLoad(nt,rt,it=null,at){var st;this.fragCurrent=nt;const ot=null==rt?void 0:rt.details;if(!this.levels||!ot)throw new Error(`frag load aborted, missing level${ot?"":" detail"}s`);let lt=null;!nt.encrypted||null!=(st=nt.decryptdata)&&st.key?!nt.encrypted&&ot.encryptedFragments.length&&this.keyLoader.loadClear(nt,ot.encryptedFragments):(this.log(`Loading key for ${nt.sn} of [${ot.startSN}-${ot.endSN}], ${this.playlistLabel()} ${nt.level}`),this.state=yi,this.fragCurrent=nt,lt=this.keyLoader.load(nt).then((nt=>{if(!this.fragContextChanged(nt.frag))return this.hls.trigger(Ot.KEY_LOADED,nt),this.state===yi&&(this.state=_i),nt})),this.hls.trigger(Ot.KEY_LOADING,{frag:nt}),null===this.fragCurrent&&(lt=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING"))));const ut=this.fragPrevious;if("initSegment"!==nt.sn&&(!ut||nt.sn!==ut.sn)){const it=this.shouldLoadParts(rt.details,nt.end);it!==this.loadingParts&&(this.log(`LL-Part loading ${it?"ON":"OFF"} loading sn ${null==ut?void 0:ut.sn}->${nt.sn}`),this.loadingParts=it)}if(it=Math.max(nt.start,it||0),this.loadingParts&&"initSegment"!==nt.sn){const st=ot.partList;if(st&&at){it>nt.end&&ot.fragmentHint&&(nt=ot.fragmentHint);const ut=this.getNextPart(st,nt,it);if(ut>-1){const ct=st[ut];let dt;return this.log(`Loading part sn: ${nt.sn} p: ${ct.index} cc: ${nt.cc} of playlist [${ot.startSN}-${ot.endSN}] parts [0-${ut}-${st.length-1}] ${this.playlistLabel()}: ${nt.level}, target: ${parseFloat(it.toFixed(3))}`),this.nextLoadPosition=ct.start+ct.duration,this.state=vi,dt=lt?lt.then((it=>!it||this.fragContextChanged(it.frag)?null:this.doFragPartsLoad(nt,ct,rt,at))).catch((nt=>this.handleFragLoadError(nt))):this.doFragPartsLoad(nt,ct,rt,at).catch((nt=>this.handleFragLoadError(nt))),this.hls.trigger(Ot.FRAG_LOADING,{frag:nt,part:ct,targetBufferTime:it}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):dt}if(!nt.url||this.loadedEndOfParts(st,it))return Promise.resolve(null)}}if("initSegment"!==nt.sn&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${it.toFixed(2)}`),this.loadingParts=!1;else if(!nt.url)return Promise.resolve(null);this.log(`Loading ${nt.type} sn: ${nt.sn} of ${this.fragInfo(nt,!1)}) cc: ${nt.cc} ${ot?"["+ot.startSN+"-"+ot.endSN+"]":""}, target: ${parseFloat(it.toFixed(3))}`),wt(nt.sn)&&!this.bitrateTest&&(this.nextLoadPosition=nt.start+nt.duration),this.state=vi;const ct=this.config.progressive;let dt;return dt=ct&&lt?lt.then((rt=>!rt||this.fragContextChanged(null==rt?void 0:rt.frag)?null:this.fragmentLoader.load(nt,at))).catch((nt=>this.handleFragLoadError(nt))):Promise.all([this.fragmentLoader.load(nt,ct?at:void 0),lt]).then((([nt])=>(!ct&&nt&&at&&at(nt),nt))).catch((nt=>this.handleFragLoadError(nt))),this.hls.trigger(Ot.FRAG_LOADING,{frag:nt,targetBufferTime:it}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):dt}doFragPartsLoad(nt,rt,it,at){return new Promise(((st,ot)=>{var lt;const ut=[],ct=null==(lt=it.details)?void 0:lt.partList,loadPart=rt=>{this.fragmentLoader.loadPart(nt,rt,at).then((at=>{ut[rt.index]=at;const ot=at.part;this.hls.trigger(Ot.FRAG_LOADED,at);const lt=getPartWith(it.details,nt.sn,rt.index+1)||findPart(ct,nt.sn,rt.index+1);if(!lt)return st({frag:nt,part:ot,partsLoaded:ut});loadPart(lt)})).catch(ot)};loadPart(rt)}))}handleFragLoadError(nt){if("data"in nt){const rt=nt.data;nt.data&&rt.details===kt.INTERNAL_ABORTED?this.handleFragLoadAborted(rt.frag,rt.part):this.hls.trigger(Ot.ERROR,rt)}else this.hls.trigger(Ot.ERROR,{type:Pt.OTHER_ERROR,details:kt.INTERNAL_EXCEPTION,err:nt,error:nt,fatal:!0});return null}_handleTransmuxerFlush(nt){const rt=this.getCurrentContext(nt);if(!rt||this.state!==Ai)return void(this.fragCurrent||this.state===gi||this.state===wi||(this.state=_i));const{frag:it,part:at,level:st}=rt,ot=self.performance.now();it.stats.parsing.end=ot,at&&(at.stats.parsing.end=ot);const lt=this.getLevelDetails(),ut=lt&&it.sn>lt.endSN||this.shouldLoadParts(lt,it.end);ut!==this.loadingParts&&(this.log(`LL-Part loading ${ut?"ON":"OFF"} after parsing segment ending @${it.end.toFixed(2)}`),this.loadingParts=ut),this.updateLevelTiming(it,at,st,nt.partial)}shouldLoadParts(nt,rt){if(this.config.lowLatencyMode){if(!nt)return this.loadingParts;if(null!=nt&&nt.partList){var it;const st=nt.partList[0];if(rt>=st.end+((null==(it=nt.fragmentHint)?void 0:it.duration)||0)){var at;if((this.hls.hasEnoughToStart?(null==(at=this.media)?void 0:at.currentTime)||this.lastCurrentTime:this.getLoadPosition())>st.start-st.fragment.duration)return!0}}}return!1}getCurrentContext(nt){const{levels:rt,fragCurrent:it}=this,{level:at,sn:st,part:ot}=nt;if(null==rt||!rt[at])return this.warn(`Levels object was unset while buffering fragment ${st} of level ${at}. The current chunk will not be buffered.`),null;const lt=rt[at],ut=lt.details,ct=ot>-1?getPartWith(ut,st,ot):null,dt=ct?ct.fragment:function getFragmentWithSN(nt,rt,it){if(!nt)return null;let at=nt.fragments[rt-nt.startSN];return at||(at=nt.fragmentHint,at&&at.sn===rt?at:rt<nt.startSN&&it&&it.sn===rt?it:null)}(ut,st,it);return dt?(it&&it!==dt&&(dt.stats=it.stats),{frag:dt,part:ct,level:lt}):null}bufferFragmentData(nt,rt,it,at,st){var ot;if(!nt||this.state!==Ai)return;const{data1:lt,data2:ut}=nt;let ct=lt;if(lt&&ut&&(ct=appendUint8Array(lt,ut)),null==(ot=ct)||!ot.length)return;const dt={type:nt.type,frag:rt,part:it,chunkMeta:at,parent:rt.type,data:ct};if(this.hls.trigger(Ot.BUFFER_APPENDING,dt),nt.dropped&&nt.independent&&!it){if(st)return;this.flushBufferGap(rt)}}flushBufferGap(nt){const rt=this.media;if(!rt)return;if(!BufferHelper.isBuffered(rt,rt.currentTime))return void this.flushMainBuffer(0,nt.start);const it=rt.currentTime,at=BufferHelper.bufferInfo(rt,it,0),st=nt.duration,ot=Math.min(2*this.config.maxFragLookUpTolerance,.25*st),lt=Math.max(Math.min(nt.start-ot,at.end-ot),it+ot);nt.start-lt>ot&&this.flushMainBuffer(lt,nt.start)}getFwdBufferInfo(nt,rt){var it;const at=this.getLoadPosition();if(!wt(at))return null;const st=this.lastCurrentTime>at||null!=(it=this.media)&&it.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(nt,at,rt,st)}getFwdBufferInfoAtPos(nt,rt,it,at){const st=BufferHelper.bufferInfo(nt,rt,at);if(0===st.len&&void 0!==st.nextStart){const ot=this.fragmentTracker.getBufferedFrag(rt,it);if(ot&&(st.nextStart<=ot.end||ot.gap))return BufferHelper.bufferInfo(nt,rt,Math.max(st.nextStart,at))}return st}getMaxBufferLength(nt){const{config:rt}=this;let it;return it=nt?Math.max(8*rt.maxBufferSize/nt,rt.maxBufferLength):rt.maxBufferLength,Math.min(it,rt.maxMaxBufferLength)}reduceMaxBufferLength(nt,rt){const it=this.config,at=Math.max(Math.min(nt-rt,it.maxBufferLength),rt),st=Math.max(nt-3*rt,it.maxMaxBufferLength/2,at);return st>=at&&(it.maxMaxBufferLength=st,this.warn(`Reduce max buffer length to ${st}s`),!0)}getAppendedFrag(nt,rt=Ht){var it;const at=null==(it=this.fragmentTracker)?void 0:it.getAppendedFrag(nt,rt);return at&&"fragment"in at?at.fragment:at}getNextFragment(nt,rt){const it=rt.fragments,at=it.length;if(!at)return null;const{config:st}=this,ot=it[0].start,lt=st.lowLatencyMode&&!!rt.partList;let ut=null;if(rt.live){const dt=st.initialLiveManifestSize;if(at<dt)return this.warn(`Not enough fragments to start playback (have: ${at}, need: ${dt})`),null;if(!rt.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||nt<ot){var ct;lt&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),ut=this.getInitialLiveFragment(rt,it);const at=this.hls.startPosition,st=this.hls.liveSyncPosition,ot=ut?(-1!==at?at:st)||ut.start:nt;this.log(`Setting startPosition to ${ot} to match initial live edge. mainStart: ${at} liveSyncPosition: ${st} frag.start: ${null==(ct=ut)?void 0:ct.start}`),this.startPosition=this.nextLoadPosition=ot}}else nt<=ot&&(ut=it[0]);if(!ut){const it=this.loadingParts?rt.partEnd:rt.fragmentEnd;ut=this.getFragmentAtPosition(nt,it,rt)}return this.mapToInitFragWhenRequired(ut)}isLoopLoading(nt,rt){const it=this.fragmentTracker.getState(nt);return(it===Nn||it===Mn&&!!nt.gap)&&this.nextLoadPosition>rt}getNextFragmentLoopLoading(nt,rt,it,at,st){let ot=null;if(nt.gap&&(ot=this.getNextFragment(this.nextLoadPosition,rt),ot&&!ot.gap&&it.nextStart)){const nt=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,it.nextStart,at,0);if(null!==nt&&it.len+nt.len>=st){const nt=ot.sn;return this.loopSn!==nt&&(this.log(`buffer full after gaps in "${at}" playlist starting at sn: ${nt}`),this.loopSn=nt),null}}return this.loopSn=void 0,ot}mapToInitFragWhenRequired(nt){return null==nt||!nt.initSegment||null!=nt&&nt.initSegment.data||this.bitrateTest?nt:nt.initSegment}getNextPart(nt,rt,it){let at=-1,st=!1,ot=!0;for(let lt=0,ut=nt.length;lt<ut;lt++){const ut=nt[lt];if(ot=ot&&!ut.independent,at>-1&&it<ut.start)break;const ct=ut.loaded;ct?at=-1:(st||ut.independent||ot)&&ut.fragment===rt&&(at=lt),st=ct}return at}loadedEndOfParts(nt,rt){const it=nt[nt.length-1];return it&&rt>it.start&&it.loaded}getInitialLiveFragment(nt,rt){const it=this.fragPrevious;let at=null;if(it){if(nt.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${it.programDateTime}`),at=function findFragmentByPDT(nt,rt,it){if(null===rt||!Array.isArray(nt)||!nt.length||!wt(rt))return null;if(rt<(nt[0].programDateTime||0))return null;if(rt>=(nt[nt.length-1].endProgramDateTime||0))return null;it=it||0;for(let at=0;at<nt.length;++at){const st=nt[at];if(pdtWithinToleranceTest(rt,it,st))return st}return null}(rt,it.endProgramDateTime,this.config.maxFragLookUpTolerance)),!at){const st=it.sn+1;if(st>=nt.startSN&&st<=nt.endSN){const ot=rt[st-nt.startSN];it.cc===ot.cc&&(at=ot,this.log(`Live playlist, switching playlist, load frag with next SN: ${at.sn}`))}at||(at=findFragWithCC(rt,it.cc),at&&this.log(`Live playlist, switching playlist, load frag with same CC: ${at.sn}`))}}else{const rt=this.hls.liveSyncPosition;null!==rt&&(at=this.getFragmentAtPosition(rt,this.bitrateTest?nt.fragmentEnd:nt.edge,nt))}return at}getFragmentAtPosition(nt,rt,it){const{config:at}=this;let{fragPrevious:st}=this,{fragments:ot,endSN:lt}=it;const{fragmentHint:ut}=it,{maxFragLookUpTolerance:ct}=at,dt=it.partList,ht=!!(this.loadingParts&&null!=dt&&dt.length&&ut);let pt;if(ht&&ut&&!this.bitrateTest&&dt[dt.length-1].fragment.sn===ut.sn&&(ot=ot.concat(ut),lt=ut.sn),nt<rt){var _t;pt=findFragmentByPTS(st,ot,nt,nt<this.lastCurrentTime||nt>rt-ct||null!=(_t=this.media)&&_t.paused||!this.startFragRequested?0:ct)}else pt=ot[ot.length-1];if(pt){const nt=pt.sn-it.startSN,rt=this.fragmentTracker.getState(pt);if((rt===Nn||rt===Mn&&pt.gap)&&(st=pt),st&&pt.sn===st.sn&&(!ht||dt[0].fragment.sn>pt.sn||!it.live&&!ht)){if(st&&pt.level===st.level){const rt=ot[nt+1];pt=pt.sn<lt&&this.fragmentTracker.getState(rt)!==Nn?rt:null}}}return pt}alignPlaylists(nt,rt,it){const at=nt.fragments.length;if(!at)return this.warn("No fragments in live playlist"),0;const st=nt.fragmentStart,ot=!rt,lt=nt.alignedSliding&&wt(st);if(ot||!lt&&!st){const{fragPrevious:st}=this;alignStream(0,it,nt);const ot=nt.fragmentStart;return this.log(`Live playlist sliding: ${ot.toFixed(2)} start-sn: ${rt?rt.startSN:"na"}->${nt.startSN} prev-sn: ${st?st.sn:"na"} fragments: ${at}`),ot}return st}waitForCdnTuneIn(nt){return nt.live&&nt.canBlockReload&&nt.partTarget&&nt.tuneInGoal>Math.max(nt.partHoldBack,3*nt.partTarget)}setStartPosition(nt,rt){let it=this.startPosition;if(it<rt&&(it=-1),-1===it){const at=null!==this.startTimeOffset,st=at?this.startTimeOffset:nt.startTimeOffset;null!==st&&wt(st)?(it=rt+st,st<0&&(it+=nt.edge),it=Math.min(Math.max(rt,it),rt+nt.totalduration),this.log(`Setting startPosition to ${it} for start time offset ${st} found in ${at?"multivariant":"media"} playlist`),this.startPosition=it):nt.live?it=this.hls.liveSyncPosition||rt:(this.log("setting startPosition to 0 by default"),this.startPosition=it=0),this.lastCurrentTime=it}this.nextLoadPosition=it}getLoadPosition(){const{media:nt}=this;let rt=0;return this.hls.hasEnoughToStart&&nt?rt=nt.currentTime:this.nextLoadPosition>=0&&(rt=this.nextLoadPosition),rt}handleFragLoadAborted(nt,rt){this.transmuxer&&"initSegment"!==nt.sn&&nt.stats.aborted&&(this.warn(`Fragment ${nt.sn}${rt?" part "+rt.index:""} of level ${nt.level} was aborted`),this.resetFragmentLoading(nt))}resetFragmentLoading(nt){this.fragCurrent&&(this.fragContextChanged(nt)||this.state===Ti)||(this.state=_i)}onFragmentOrKeyLoadError(nt,rt){if(rt.chunkMeta&&!rt.frag){const nt=this.getCurrentContext(rt.chunkMeta);nt&&(rt.frag=nt.frag)}const it=rt.frag;if(!it||it.type!==nt||!this.levels)return;var at;if(this.fragContextChanged(it))return void this.warn(`Frag load error must match current frag to retry ${it.url} > ${null==(at=this.fragCurrent)?void 0:at.url}`);const st=rt.details===kt.FRAG_GAP;st&&this.fragmentTracker.fragBuffered(it,!0);const ot=rt.errorAction,{action:lt,retryCount:ut=0,retryConfig:ct}=ot||{};if(ot&&lt===bn&&ct){this.resetStartWhenNotLoaded(this.levelLastLoaded);const at=getRetryDelay(ct,ut);this.warn(`Fragment ${it.sn} of ${nt} ${it.level} errored with ${rt.details}, retrying loading ${ut+1}/${ct.maxNumRetry} in ${at}ms`),ot.resolved=!0,this.retryDate=self.performance.now()+at,this.state=Ti}else if(ct&&ot){if(this.resetFragmentErrors(nt),!(ut<ct.maxNumRetry))return void this.warn(`${rt.details} reached or exceeded max retry (${ut})`);st||lt===Tn||(ot.resolved=!0)}else(null==ot?void 0:ot.action)===En?this.state=Mi:this.state=wi;this.tickImmediate()}reduceLengthAndFlushBuffer(nt){if(this.state===Ai||this.state===Ri){const rt=nt.frag,it=nt.parent,at=this.getFwdBufferInfo(this.mediaBuffer,it),st=at&&at.len>.5;st&&this.reduceMaxBufferLength(at.len,(null==rt?void 0:rt.duration)||10);const ot=!st;return ot&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${it} buffer`),rt&&(this.fragmentTracker.removeFragment(rt),this.nextLoadPosition=rt.start),this.resetLoadingState(),ot}return!1}resetFragmentErrors(nt){nt===jt&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==gi&&(this.state=_i)}afterBufferFlushed(nt,rt,it){if(!nt)return;const at=BufferHelper.getBuffered(nt);this.fragmentTracker.detectEvictedFragments(rt,at,it),this.state===Ii&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==gi&&(this.state=_i)}resetStartWhenNotLoaded(nt){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const rt=nt?nt.details:null;null!=rt&&rt.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(rt,rt.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(nt){this.warn(`The loading context changed while buffering fragment ${nt.sn} of level ${nt.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(nt=0){this.fragmentTracker.removeFragmentsInRange(nt,1/0,this.playlistType,!1,!0)}updateLevelTiming(nt,rt,it,at){var st;const ot=it.details;if(!ot)return void this.warn("level.details undefined");if(!Object.keys(nt.elementaryStreams).reduce(((rt,st)=>{const lt=nt.elementaryStreams[st];if(lt){const ut=lt.endPTS-lt.startPTS;if(ut<=0)return this.warn(`Could not parse fragment ${nt.sn} ${st} duration reliably (${ut})`),rt||!1;const ct=at?0:updateFragPTSDTS(ot,nt,lt.startPTS,lt.endPTS,lt.startDTS,lt.endDTS);return this.hls.trigger(Ot.LEVEL_PTS_UPDATED,{details:ot,level:it,drift:ct,type:st,frag:nt,start:lt.startPTS,end:lt.endPTS}),!0}return rt}),!1)&&null===(null==(st=this.transmuxer)?void 0:st.error)){const rt=new Error(`Found no media in fragment ${nt.sn} of level ${nt.level} resetting transmuxer to fallback to playlist timing`);if(0===it.fragmentError&&(it.fragmentError++,nt.gap=!0,this.fragmentTracker.removeFragment(nt),this.fragmentTracker.fragBuffered(nt,!0)),this.warn(rt.message),this.hls.trigger(Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.FRAG_PARSING_ERROR,fatal:!1,error:rt,frag:nt,reason:`Found no media in msn ${nt.sn} of level "${it.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=Ri,this.log(`Parsed ${nt.type} sn: ${nt.sn}${rt?" part: "+rt.index:""} of ${this.fragInfo(nt)})`),this.hls.trigger(Ot.FRAG_PARSED,{frag:nt,part:rt})}playlistLabel(){return this.playlistType===Ht?"level":"track"}fragInfo(nt,rt=!0){var it,at;return`${this.playlistLabel()} ${nt.level} (frag:[${(null!=(it=rt?nt.startPTS:nt.start)?it:NaN).toFixed(3)}-${(null!=(at=rt?nt.endPTS:nt.end)?at:NaN).toFixed(3)}]`}resetTransmuxer(){var nt;null==(nt=this.transmuxer)||nt.reset()}recoverWorkerError(nt){"demuxerWorker"===nt.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(nt){const rt=this._state;rt!==nt&&(this._state=nt,this.log(`${rt}->${nt}`))}get state(){return this._state}}class ChunkCache{constructor(){this.chunks=[],this.dataLength=0}push(nt){this.chunks.push(nt),this.dataLength+=nt.length}flush(){const{chunks:nt,dataLength:rt}=this;let it;return nt.length?(it=1===nt.length?nt[0]:function concatUint8Arrays(nt,rt){const it=new Uint8Array(rt);let at=0;for(let rt=0;rt<nt.length;rt++){const st=nt[rt];it.set(st,at),at+=st.length}return it}(nt,rt),this.reset(),it):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var Pi={exports:{}};!function(nt){var rt=Object.prototype.hasOwnProperty,it="~";function Events(){}function EE(nt,rt,it){this.fn=nt,this.context=rt,this.once=it||!1}function addListener(nt,rt,at,st,ot){if("function"!=typeof at)throw new TypeError("The listener must be a function");var lt=new EE(at,st||nt,ot),ut=it?it+rt:rt;return nt._events[ut]?nt._events[ut].fn?nt._events[ut]=[nt._events[ut],lt]:nt._events[ut].push(lt):(nt._events[ut]=lt,nt._eventsCount++),nt}function clearEvent(nt,rt){0==--nt._eventsCount?nt._events=new Events:delete nt._events[rt]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(it=!1)),EventEmitter.prototype.eventNames=function eventNames(){var nt,at,st=[];if(0===this._eventsCount)return st;for(at in nt=this._events)rt.call(nt,at)&&st.push(it?at.slice(1):at);return Object.getOwnPropertySymbols?st.concat(Object.getOwnPropertySymbols(nt)):st},EventEmitter.prototype.listeners=function listeners(nt){var rt=it?it+nt:nt,at=this._events[rt];if(!at)return[];if(at.fn)return[at.fn];for(var st=0,ot=at.length,lt=new Array(ot);st<ot;st++)lt[st]=at[st].fn;return lt},EventEmitter.prototype.listenerCount=function listenerCount(nt){var rt=it?it+nt:nt,at=this._events[rt];return at?at.fn?1:at.length:0},EventEmitter.prototype.emit=function emit(nt,rt,at,st,ot,lt){var ut=it?it+nt:nt;if(!this._events[ut])return!1;var ct,dt,ht=this._events[ut],pt=arguments.length;if(ht.fn){switch(ht.once&&this.removeListener(nt,ht.fn,void 0,!0),pt){case 1:return ht.fn.call(ht.context),!0;case 2:return ht.fn.call(ht.context,rt),!0;case 3:return ht.fn.call(ht.context,rt,at),!0;case 4:return ht.fn.call(ht.context,rt,at,st),!0;case 5:return ht.fn.call(ht.context,rt,at,st,ot),!0;case 6:return ht.fn.call(ht.context,rt,at,st,ot,lt),!0}for(dt=1,ct=new Array(pt-1);dt<pt;dt++)ct[dt-1]=arguments[dt];ht.fn.apply(ht.context,ct)}else{var _t,Et=ht.length;for(dt=0;dt<Et;dt++)switch(ht[dt].once&&this.removeListener(nt,ht[dt].fn,void 0,!0),pt){case 1:ht[dt].fn.call(ht[dt].context);break;case 2:ht[dt].fn.call(ht[dt].context,rt);break;case 3:ht[dt].fn.call(ht[dt].context,rt,at);break;case 4:ht[dt].fn.call(ht[dt].context,rt,at,st);break;default:if(!ct)for(_t=1,ct=new Array(pt-1);_t<pt;_t++)ct[_t-1]=arguments[_t];ht[dt].fn.apply(ht[dt].context,ct)}}return!0},EventEmitter.prototype.on=function on(nt,rt,it){return addListener(this,nt,rt,it,!1)},EventEmitter.prototype.once=function once(nt,rt,it){return addListener(this,nt,rt,it,!0)},EventEmitter.prototype.removeListener=function removeListener(nt,rt,at,st){var ot=it?it+nt:nt;if(!this._events[ot])return this;if(!rt)return clearEvent(this,ot),this;var lt=this._events[ot];if(lt.fn)lt.fn!==rt||st&&!lt.once||at&&lt.context!==at||clearEvent(this,ot);else{for(var ut=0,ct=[],dt=lt.length;ut<dt;ut++)(lt[ut].fn!==rt||st&&!lt[ut].once||at&&lt[ut].context!==at)&&ct.push(lt[ut]);ct.length?this._events[ot]=1===ct.length?ct[0]:ct:clearEvent(this,ot)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(nt){var rt;return nt?(rt=it?it+nt:nt,this._events[rt]&&clearEvent(this,rt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=it,EventEmitter.EventEmitter=EventEmitter,nt.exports=EventEmitter}(Pi);var ki=getDefaultExportFromCjs(Pi.exports);const Ni=void 0,Oi={};function isId3Footer(nt,rt){return rt+10<=nt.length&&51===nt[rt]&&68===nt[rt+1]&&73===nt[rt+2]&&nt[rt+3]<255&&nt[rt+4]<255&&nt[rt+6]<128&&nt[rt+7]<128&&nt[rt+8]<128&&nt[rt+9]<128}function isId3Header(nt,rt){return rt+10<=nt.length&&73===nt[rt]&&68===nt[rt+1]&&51===nt[rt+2]&&nt[rt+3]<255&&nt[rt+4]<255&&nt[rt+6]<128&&nt[rt+7]<128&&nt[rt+8]<128&&nt[rt+9]<128}function readId3Size(nt,rt){let it=0;return it=(127&nt[rt])<<21,it|=(127&nt[rt+1])<<14,it|=(127&nt[rt+2])<<7,it|=127&nt[rt+3],it}function getId3Data(nt,rt){const it=rt;let at=0;for(;isId3Header(nt,rt);){at+=10;at+=readId3Size(nt,rt+6),isId3Footer(nt,rt+10)&&(at+=10),rt+=at}if(at>0)return nt.subarray(it,it+at)}function isHeaderPattern$1(nt,rt){return 255===nt[rt]&&240==(246&nt[rt+1])}function getHeaderLength(nt,rt){return 1&nt[rt+1]?7:9}function getFullFrameLength(nt,rt){return(3&nt[rt+3])<<11|nt[rt+4]<<3|(224&nt[rt+5])>>>5}function isHeader$1(nt,rt){return rt+1<nt.length&&isHeaderPattern$1(nt,rt)}function probe$1(nt,rt){if(isHeader$1(nt,rt)){const it=getHeaderLength(nt,rt);if(rt+it>=nt.length)return!1;const at=getFullFrameLength(nt,rt);if(at<=it)return!1;const st=rt+at;return st===nt.length||isHeader$1(nt,st)}return!1}function initTrackConfig(nt,rt,it,at,st){if(!nt.samplerate){const ot=function getAudioConfig(nt,rt,it,at){const st=rt[it+2],ot=st>>2&15;if(ot>12){const rt=new Error(`invalid ADTS sampling index:${ot}`);return void nt.emit(Ot.ERROR,Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.FRAG_PARSING_ERROR,fatal:!0,error:rt,reason:rt.message})}const lt=1+(st>>6&3),ut=rt[it+3]>>6&3|(1&st)<<2,ct="mp4a.40."+lt,dt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][ot];let ht=ot;5!==lt&&29!==lt||(ht-=3);const pt=[lt<<3|(14&ht)>>1,(1&ht)<<7|ut<<3];return Qt.log(`manifest codec:${at}, parsed codec:${ct}, channels:${ut}, rate:${dt} (ADTS object type:${lt} sampling index:${ot})`),{config:pt,samplerate:dt,channelCount:ut,codec:ct,parsedCodec:ct,manifestCodec:at}}(rt,it,at,st);if(!ot)return;_extends(nt,ot)}}function getFrameDuration(nt){return 9216e4/nt}function appendFrame$2(nt,rt,it,at,st){const ot=at+st*getFrameDuration(nt.samplerate),lt=function parseFrameHeader(nt,rt){const it=getHeaderLength(nt,rt);if(rt+it<=nt.length){const at=getFullFrameLength(nt,rt)-it;if(at>0)return{headerLength:it,frameLength:at}}}(rt,it);let ut;if(lt){const{frameLength:at,headerLength:st}=lt,ct=st+at,dt=Math.max(0,it+ct-rt.length);dt?(ut=new Uint8Array(ct-st),ut.set(rt.subarray(it+st,rt.length),0)):ut=rt.subarray(it+st,it+ct);const ht={unit:ut,pts:ot};return dt||nt.samples.push(ht),{sample:ht,length:ct,missing:dt}}const ct=rt.length-it;ut=new Uint8Array(ct),ut.set(rt.subarray(it,rt.length),0);return{sample:{unit:ut,pts:ot},length:ct,missing:-1}}function canParseId3(nt,rt){return isId3Header(nt,rt)&&readId3Size(nt,rt+6)+10<=nt.length-rt}function toUint8(nt,rt=0,it=1/0){return function view(nt,rt,it,at){const st=function unsafeGetArrayBuffer(nt){return nt instanceof ArrayBuffer?nt:nt.buffer}(nt);let ot=1;"BYTES_PER_ELEMENT"in at&&(ot=at.BYTES_PER_ELEMENT);const lt=function isArrayBufferView(nt){return nt&&nt.buffer instanceof ArrayBuffer&&void 0!==nt.byteLength&&void 0!==nt.byteOffset}(nt)?nt.byteOffset:0,ut=(lt+nt.byteLength)/ot,ct=(lt+rt)/ot,dt=Math.floor(Math.max(0,Math.min(ct,ut))),ht=Math.floor(Math.min(dt+Math.max(it,0),ut));return new at(st,dt,ht-dt)}(nt,rt,it,Uint8Array)}function roundToEven(nt,rt){if(nt<0)return-roundToEven(-nt,rt);const it=Math.pow(10,rt);if(Math.abs(nt*it%1-.5)<Number.EPSILON){const rt=Math.floor(nt*it);return(rt%2==0?rt:rt+1)/it}return Math.round(nt*it)/it}function decodeId3ImageFrame(nt){const rt={key:nt.type,description:"",data:"",mimeType:null,pictureType:null};if(nt.size<2)return;if(3!==nt.data[0])return void console.log("Ignore frame with unrecognized character encoding");const it=nt.data.subarray(1).indexOf(0);if(-1===it)return;const at=utf8ArrayToStr(toUint8(nt.data,1,it)),st=nt.data[2+it],ot=nt.data.subarray(3+it).indexOf(0);if(-1===ot)return;const lt=utf8ArrayToStr(toUint8(nt.data,3+it,ot));let ut;return ut="--\x3e"===at?utf8ArrayToStr(toUint8(nt.data,4+it+ot)):function toArrayBuffer(nt){return nt instanceof ArrayBuffer?nt:0==nt.byteOffset&&nt.byteLength==nt.buffer.byteLength?nt.buffer:new Uint8Array(nt).buffer}(nt.data.subarray(4+it+ot)),rt.mimeType=at,rt.pictureType=st,rt.description=lt,rt.data=ut,rt}function decodeId3Frame(nt){return"PRIV"===nt.type?function decodeId3PrivFrame(nt){if(nt.size<2)return;const rt=utf8ArrayToStr(nt.data,!0),it=new Uint8Array(nt.data.subarray(rt.length+1));return{key:nt.type,info:rt,data:it.buffer}}(nt):"W"===nt.type[0]?function decodeId3UrlFrame(nt){if("WXXX"===nt.type){if(nt.size<2)return;let rt=1;const it=utf8ArrayToStr(nt.data.subarray(rt),!0);rt+=it.length+1;const at=utf8ArrayToStr(nt.data.subarray(rt));return{key:nt.type,info:it,data:at}}const rt=utf8ArrayToStr(nt.data);return{key:nt.type,info:"",data:rt}}(nt):"APIC"===nt.type?decodeId3ImageFrame(nt):function decodeId3TextFrame(nt){if(nt.size<2)return;if("TXXX"===nt.type){let rt=1;const it=utf8ArrayToStr(nt.data.subarray(rt),!0);rt+=it.length+1;const at=utf8ArrayToStr(nt.data.subarray(rt));return{key:nt.type,info:it,data:at}}const rt=utf8ArrayToStr(nt.data.subarray(1));return{key:nt.type,info:"",data:rt}}(nt)}function getId3FrameData(nt){const rt=String.fromCharCode(nt[0],nt[1],nt[2],nt[3]),it=readId3Size(nt,4);return{type:rt,size:it,data:nt.subarray(10,10+it)}}const Fi=10,Gi=10;function getId3Frames(nt){let rt=0;const it=[];for(;isId3Header(nt,rt);){const at=readId3Size(nt,rt+6);nt[rt+5]>>6&1&&(rt+=Fi),rt+=Fi;const st=rt+at;for(;rt+Gi<st;){const at=getId3FrameData(nt.subarray(rt)),st=decodeId3Frame(at);st&&it.push(st),rt+=at.size+Fi}isId3Footer(nt,rt)&&(rt+=Fi)}return it}function isId3TimestampFrame(nt){return nt&&"PRIV"===nt.key&&"com.apple.streaming.transportStreamTimestamp"===nt.info}function readId3Timestamp(nt){if(8===nt.data.byteLength){const rt=new Uint8Array(nt.data),it=1&rt[3];let at=(rt[4]<<23)+(rt[5]<<15)+(rt[6]<<7)+rt[7];return at/=45,it&&(at+=47721858.84),Math.round(at)}}function getId3Timestamp(nt){const rt=getId3Frames(nt);for(let nt=0;nt<rt.length;nt++){const it=rt[nt];if(isId3TimestampFrame(it))return readId3Timestamp(it)}}let Zi=function(nt){return nt.audioId3="org.id3",nt.dateRange="com.apple.quicktime.HLS",nt.emsg="https://aomedia.org/emsg/ID3",nt.misbklv="urn:misb:KLV:bin:1910.1",nt}({});function dummyTrack(nt="",rt=9e4){return{type:nt,id:-1,pid:-1,inputTimeScale:rt,sequenceNumber:-1,samples:[],dropped:0}}class BaseAudioDemuxer{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(nt,rt,it,at){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(nt){this.initPTS=nt,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(nt,rt){return!1}appendFrame(nt,rt,it){}demux(nt,rt){this.cachedData&&(nt=appendUint8Array(this.cachedData,nt),this.cachedData=null);let it,at=getId3Data(nt,0),st=at?at.length:0;const ot=this._audioTrack,lt=this._id3Track,ut=at?getId3Timestamp(at):void 0,ct=nt.length;for((null===this.basePTS||0===this.frameIndex&&wt(ut))&&(this.basePTS=initPTSFn(ut,rt,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),at&&at.length>0&&lt.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:at,type:Zi.audioId3,duration:Number.POSITIVE_INFINITY});st<ct;){if(this.canParse(nt,st)){const rt=this.appendFrame(ot,nt,st);rt?(this.frameIndex++,this.lastPTS=rt.sample.pts,st+=rt.length,it=st):st=ct}else canParseId3(nt,st)?(at=getId3Data(nt,st),lt.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:at,type:Zi.audioId3,duration:Number.POSITIVE_INFINITY}),st+=at.length,it=st):st++;if(st===ct&&it!==ct){const rt=sliceUint8(nt,it);this.cachedData?this.cachedData=appendUint8Array(this.cachedData,rt):this.cachedData=rt}}return{audioTrack:ot,videoTrack:dummyTrack(),id3Track:lt,textTrack:dummyTrack()}}demuxSampleAes(nt,rt,it){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(nt){const rt=this.cachedData;return rt&&(this.cachedData=null,this.demux(rt,0)),{audioTrack:this._audioTrack,videoTrack:dummyTrack(),id3Track:this._id3Track,textTrack:dummyTrack()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const initPTSFn=(nt,rt,it)=>{if(wt(nt))return 90*nt;return 9e4*rt+(it?9e4*it.baseTime/it.timescale:0)};let Hi=null;const ji=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],qi=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Ki=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],$i=[0,1,1,4];function appendFrame$1(nt,rt,it,at,st){if(it+24>rt.length)return;const ot=parseHeader(rt,it);if(ot&&it+ot.frameLength<=rt.length){const lt=at+st*(9e4*ot.samplesPerFrame/ot.sampleRate),ut={unit:rt.subarray(it,it+ot.frameLength),pts:lt,dts:lt};return nt.config=[],nt.channelCount=ot.channelCount,nt.samplerate=ot.sampleRate,nt.samples.push(ut),{sample:ut,length:ot.frameLength,missing:0}}}function parseHeader(nt,rt){const it=nt[rt+1]>>3&3,at=nt[rt+1]>>1&3,st=nt[rt+2]>>4&15,ot=nt[rt+2]>>2&3;if(1!==it&&0!==st&&15!==st&&3!==ot){const lt=nt[rt+2]>>1&1,ut=nt[rt+3]>>6,ct=1e3*ji[14*(3===it?3-at:3===at?3:4)+st-1],dt=qi[3*(3===it?0:2===it?1:2)+ot],ht=3===ut?1:2,pt=Ki[it][at],_t=$i[at],Et=8*pt*_t,St=Math.floor(pt*ct/dt+lt)*_t;if(null===Hi){const nt=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Hi=nt?parseInt(nt[1]):0}return!!Hi&&Hi<=87&&2===at&&ct>=224e3&&0===ut&&(nt[rt+3]=128|nt[rt+3]),{sampleRate:dt,channelCount:ht,frameLength:St,samplesPerFrame:Et}}}function isHeaderPattern(nt,rt){return!(255!==nt[rt]||224&~nt[rt+1]||!(6&nt[rt+1]))}function isHeader(nt,rt){return rt+1<nt.length&&isHeaderPattern(nt,rt)}function probe(nt,rt){if(rt+1<nt.length&&isHeaderPattern(nt,rt)){const it=4,at=parseHeader(nt,rt);let st=it;null!=at&&at.frameLength&&(st=at.frameLength);const ot=rt+st;return ot===nt.length||isHeader(nt,ot)}return!1}const getAudioBSID=(nt,rt)=>{let it=0,at=5;rt+=at;const st=new Uint32Array(1),ot=new Uint32Array(1),lt=new Uint8Array(1);for(;at>0;){lt[0]=nt[rt];const ut=Math.min(at,8),ct=8-ut;ot[0]=4278190080>>>24+ct<<ct,st[0]=(lt[0]&ot[0])>>ct,it=it?it<<ut|st[0]:st[0],rt+=1,at-=ut}return it};class AC3Demuxer extends BaseAudioDemuxer{constructor(nt){super(),this.observer=void 0,this.observer=nt}resetInitSegment(nt,rt,it,at){super.resetInitSegment(nt,rt,it,at),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:rt,duration:at,inputTimeScale:9e4,dropped:0}}canParse(nt,rt){return rt+64<nt.length}appendFrame(nt,rt,it){const at=appendFrame(nt,rt,it,this.basePTS,this.frameIndex);if(-1!==at){return{sample:nt.samples[nt.samples.length-1],length:at,missing:0}}}static probe(nt){if(!nt)return!1;const rt=getId3Data(nt,0);if(!rt)return!1;const it=rt.length;return 11===nt[it]&&119===nt[it+1]&&void 0!==getId3Timestamp(rt)&&getAudioBSID(nt,it)<16}}function appendFrame(nt,rt,it,at,st){if(it+8>rt.length)return-1;if(11!==rt[it]||119!==rt[it+1])return-1;const ot=rt[it+4]>>6;if(ot>=3)return-1;const lt=[48e3,44100,32e3][ot],ut=63&rt[it+4],ct=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*ut+ot];if(it+ct>rt.length)return-1;const dt=rt[it+6]>>5;let ht=0;2===dt?ht+=2:(1&dt&&1!==dt&&(ht+=2),4&dt&&(ht+=2));const pt=(rt[it+6]<<8|rt[it+7])>>12-ht&1,_t=[2,1,2,3,3,4,4,5][dt]+pt,Et=rt[it+5]>>3,St=7&rt[it+5],wt=new Uint8Array([ot<<6|Et<<1|St>>2,(3&St)<<6|dt<<3|pt<<2|ut>>4,ut<<4&224]),Lt=at+st*(1536/lt*9e4),Ct=rt.subarray(it,it+ct);return nt.config=wt,nt.channelCount=_t,nt.samplerate=lt,nt.samples.push({unit:Ct,pts:Lt}),ct}const Yi=/\/emsg[-/]ID3/i;function getEmsgStartTime(nt,rt){return wt(nt.presentationTime)?nt.presentationTime/nt.timeScale:rt+nt.presentationTimeDelta/nt.timeScale}class SampleAesDecrypter{constructor(nt,rt,it){this.keyData=void 0,this.decrypter=void 0,this.keyData=it,this.decrypter=new Decrypter(rt,{removePKCS7Padding:!1})}decryptBuffer(nt){return this.decrypter.decrypt(nt,this.keyData.key.buffer,this.keyData.iv.buffer,xn)}decryptAacSample(nt,rt,it){const at=nt[rt].unit;if(at.length<=16)return;const st=at.subarray(16,at.length-at.length%16),ot=st.buffer.slice(st.byteOffset,st.byteOffset+st.length);this.decryptBuffer(ot).then((st=>{const ot=new Uint8Array(st);at.set(ot,16),this.decrypter.isSync()||this.decryptAacSamples(nt,rt+1,it)}))}decryptAacSamples(nt,rt,it){for(;;rt++){if(rt>=nt.length)return void it();if(!(nt[rt].unit.length<32)&&(this.decryptAacSample(nt,rt,it),!this.decrypter.isSync()))return}}getAvcEncryptedData(nt){const rt=16*Math.floor((nt.length-48)/160)+16,it=new Int8Array(rt);let at=0;for(let rt=32;rt<nt.length-16;rt+=160,at+=16)it.set(nt.subarray(rt,rt+16),at);return it}getAvcDecryptedUnit(nt,rt){const it=new Uint8Array(rt);let at=0;for(let rt=32;rt<nt.length-16;rt+=160,at+=16)nt.set(it.subarray(at,at+16),rt);return nt}decryptAvcSample(nt,rt,it,at,st){const ot=discardEPB(st.data),lt=this.getAvcEncryptedData(ot);this.decryptBuffer(lt.buffer).then((lt=>{st.data=this.getAvcDecryptedUnit(ot,lt),this.decrypter.isSync()||this.decryptAvcSamples(nt,rt,it+1,at)}))}decryptAvcSamples(nt,rt,it,at){if(nt instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;rt++,it=0){if(rt>=nt.length)return void at();const st=nt[rt].units;for(;!(it>=st.length);it++){const ot=st[it];if(!(ot.data.length<=48||1!==ot.type&&5!==ot.type||(this.decryptAvcSample(nt,rt,it,at,ot),this.decrypter.isSync())))return}}}}class BaseVideoParser{constructor(){this.VideoSample=null}createVideoSample(nt,rt,it){return{key:nt,frame:!1,pts:rt,dts:it,units:[],length:0}}getLastNalUnit(nt){var rt;let it,at=this.VideoSample;if(at&&0!==at.units.length||(at=nt[nt.length-1]),null!=(rt=at)&&rt.units){const nt=at.units;it=nt[nt.length-1]}return it}pushAccessUnit(nt,rt){if(nt.units.length&&nt.frame){if(void 0===nt.pts){const it=rt.samples,at=it.length;if(!at)return void rt.dropped++;{const rt=it[at-1];nt.pts=rt.pts,nt.dts=rt.dts}}rt.samples.push(nt)}}parseNALu(nt,rt,it){const at=rt.byteLength;let st=nt.naluState||0;const ot=st,lt=[];let ut,ct,dt,ht=0,pt=-1,_t=0;for(-1===st&&(pt=0,_t=this.getNALuType(rt,0),st=0,ht=1);ht<at;)if(ut=rt[ht++],st)if(1!==st)if(ut)if(1===ut){if(ct=ht-st-1,pt>=0){const nt={data:rt.subarray(pt,ct),type:_t};lt.push(nt)}else{const it=this.getLastNalUnit(nt.samples);it&&(ot&&ht<=4-ot&&it.state&&(it.data=it.data.subarray(0,it.data.byteLength-ot)),ct>0&&(it.data=appendUint8Array(it.data,rt.subarray(0,ct)),it.state=0))}ht<at?(dt=this.getNALuType(rt,ht),pt=ht,_t=dt,st=0):st=-1}else st=0;else st=3;else st=ut?0:2;else st=ut?0:1;if(pt>=0&&st>=0){const nt={data:rt.subarray(pt,at),type:_t,state:st};lt.push(nt)}if(0===lt.length){const it=this.getLastNalUnit(nt.samples);it&&(it.data=appendUint8Array(it.data,rt))}return nt.naluState=st,lt}}class ExpGolomb{constructor(nt){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=nt,this.bytesAvailable=nt.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const nt=this.data,rt=this.bytesAvailable,it=nt.byteLength-rt,at=new Uint8Array(4),st=Math.min(4,rt);if(0===st)throw new Error("no bytes available");at.set(nt.subarray(it,it+st)),this.word=new DataView(at.buffer).getUint32(0),this.bitsAvailable=8*st,this.bytesAvailable-=st}skipBits(nt){let rt;nt=Math.min(nt,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>nt?(this.word<<=nt,this.bitsAvailable-=nt):(rt=(nt-=this.bitsAvailable)>>3,nt-=rt<<3,this.bytesAvailable-=rt,this.loadWord(),this.word<<=nt,this.bitsAvailable-=nt)}readBits(nt){let rt=Math.min(this.bitsAvailable,nt);const it=this.word>>>32-rt;if(nt>32&&Qt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=rt,this.bitsAvailable>0)this.word<<=rt;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return rt=nt-rt,rt>0&&this.bitsAvailable?it<<rt|this.readBits(rt):it}skipLZ(){let nt;for(nt=0;nt<this.bitsAvailable;++nt)if(this.word&2147483648>>>nt)return this.word<<=nt,this.bitsAvailable-=nt,nt;return this.loadWord(),nt+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const nt=this.skipLZ();return this.readBits(nt+1)-1}readEG(){const nt=this.readUEG();return 1&nt?1+nt>>>1:-1*(nt>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class AvcVideoParser extends BaseVideoParser{parsePES(nt,rt,it,at){const st=this.parseNALu(nt,it.data,at);let ot,lt=this.VideoSample,ut=!1;it.data=null,lt&&st.length&&!nt.audFound&&(this.pushAccessUnit(lt,nt),lt=this.VideoSample=this.createVideoSample(!1,it.pts,it.dts)),st.forEach((at=>{var st,ct;switch(at.type){case 1:{let rt=!1;ot=!0;const st=at.data;if(ut&&st.length>4){const nt=this.readSliceType(st);2!==nt&&4!==nt&&7!==nt&&9!==nt||(rt=!0)}var dt;if(rt)null!=(dt=lt)&&dt.frame&&!lt.key&&(this.pushAccessUnit(lt,nt),lt=this.VideoSample=null);lt||(lt=this.VideoSample=this.createVideoSample(!0,it.pts,it.dts)),lt.frame=!0,lt.key=rt;break}case 5:ot=!0,null!=(st=lt)&&st.frame&&!lt.key&&(this.pushAccessUnit(lt,nt),lt=this.VideoSample=null),lt||(lt=this.VideoSample=this.createVideoSample(!0,it.pts,it.dts)),lt.key=!0,lt.frame=!0;break;case 6:ot=!0,parseSEIMessageFromNALu(at.data,1,it.pts,rt.samples);break;case 7:{var ht,pt;ot=!0,ut=!0;const rt=at.data,it=this.readSPS(rt);if(!nt.sps||nt.width!==it.width||nt.height!==it.height||(null==(ht=nt.pixelRatio)?void 0:ht[0])!==it.pixelRatio[0]||(null==(pt=nt.pixelRatio)?void 0:pt[1])!==it.pixelRatio[1]){nt.width=it.width,nt.height=it.height,nt.pixelRatio=it.pixelRatio,nt.sps=[rt];const at=rt.subarray(1,4);let st="avc1.";for(let nt=0;nt<3;nt++){let rt=at[nt].toString(16);rt.length<2&&(rt="0"+rt),st+=rt}nt.codec=st}break}case 8:ot=!0,nt.pps=[at.data];break;case 9:ot=!0,nt.audFound=!0,null!=(ct=lt)&&ct.frame&&(this.pushAccessUnit(lt,nt),lt=null),lt||(lt=this.VideoSample=this.createVideoSample(!1,it.pts,it.dts));break;case 12:ot=!0;break;default:ot=!1}if(lt&&ot){lt.units.push(at)}})),at&&lt&&(this.pushAccessUnit(lt,nt),this.VideoSample=null)}getNALuType(nt,rt){return 31&nt[rt]}readSliceType(nt){const rt=new ExpGolomb(nt);return rt.readUByte(),rt.readUEG(),rt.readUEG()}skipScalingList(nt,rt){let it,at=8,st=8;for(let ot=0;ot<nt;ot++)0!==st&&(it=rt.readEG(),st=(at+it+256)%256),at=0===st?at:st}readSPS(nt){const rt=new ExpGolomb(nt);let it,at,st,ot=0,lt=0,ut=0,ct=0;const dt=rt.readUByte.bind(rt),ht=rt.readBits.bind(rt),pt=rt.readUEG.bind(rt),_t=rt.readBoolean.bind(rt),Et=rt.skipBits.bind(rt),St=rt.skipEG.bind(rt),wt=rt.skipUEG.bind(rt),Lt=this.skipScalingList.bind(this);dt();const Ct=dt();if(ht(5),Et(3),dt(),wt(),100===Ct||110===Ct||122===Ct||244===Ct||44===Ct||83===Ct||86===Ct||118===Ct||128===Ct){const nt=pt();if(3===nt&&Et(1),wt(),wt(),Et(1),_t())for(at=3!==nt?8:12,st=0;st<at;st++)_t()&&Lt(st<6?16:64,rt)}wt();const Pt=pt();if(0===Pt)pt();else if(1===Pt)for(Et(1),St(),St(),it=pt(),st=0;st<it;st++)St();wt(),Et(1);const kt=pt(),Ot=pt(),Ft=ht(1);0===Ft&&Et(1),Et(1),_t()&&(ot=pt(),lt=pt(),ut=pt(),ct=pt());let Bt=[1,1];if(_t()&&_t()){switch(dt()){case 1:Bt=[1,1];break;case 2:Bt=[12,11];break;case 3:Bt=[10,11];break;case 4:Bt=[16,11];break;case 5:Bt=[40,33];break;case 6:Bt=[24,11];break;case 7:Bt=[20,11];break;case 8:Bt=[32,11];break;case 9:Bt=[80,33];break;case 10:Bt=[18,11];break;case 11:Bt=[15,11];break;case 12:Bt=[64,33];break;case 13:Bt=[160,99];break;case 14:Bt=[4,3];break;case 15:Bt=[3,2];break;case 16:Bt=[2,1];break;case 255:Bt=[dt()<<8|dt(),dt()<<8|dt()]}}return{width:Math.ceil(16*(kt+1)-2*ot-2*lt),height:(2-Ft)*(Ot+1)*16-(Ft?2:4)*(ut+ct),pixelRatio:Bt}}}class HevcVideoParser extends BaseVideoParser{constructor(...nt){super(...nt),this.initVPS=null}parsePES(nt,rt,it,at){const st=this.parseNALu(nt,it.data,at);let ot,lt=this.VideoSample,ut=!1;it.data=null,lt&&st.length&&!nt.audFound&&(this.pushAccessUnit(lt,nt),lt=this.VideoSample=this.createVideoSample(!1,it.pts,it.dts)),st.forEach((at=>{var st,ct;switch(at.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:lt||(lt=this.VideoSample=this.createVideoSample(!1,it.pts,it.dts)),lt.frame=!0,ot=!0;break;case 16:case 17:case 18:case 21:var dt;if(ot=!0,ut)null!=(dt=lt)&&dt.frame&&!lt.key&&(this.pushAccessUnit(lt,nt),lt=this.VideoSample=null);lt||(lt=this.VideoSample=this.createVideoSample(!0,it.pts,it.dts)),lt.key=!0,lt.frame=!0;break;case 19:case 20:ot=!0,null!=(st=lt)&&st.frame&&!lt.key&&(this.pushAccessUnit(lt,nt),lt=this.VideoSample=null),lt||(lt=this.VideoSample=this.createVideoSample(!0,it.pts,it.dts)),lt.key=!0,lt.frame=!0;break;case 39:ot=!0,parseSEIMessageFromNALu(at.data,2,it.pts,rt.samples);break;case 32:if(ot=!0,!nt.vps){const rt=this.readVPS(at.data);nt.params=_objectSpread2({},rt),this.initVPS=at.data}nt.vps=[at.data];break;case 33:if(ot=!0,ut=!0,"object"==typeof nt.params){if(void 0===nt.vps||nt.vps[0]===this.initVPS||void 0===nt.sps||this.matchSPS(nt.sps[0],at.data)||(this.initVPS=nt.vps[0],nt.sps=nt.pps=void 0),!nt.sps){const rt=this.readSPS(at.data);nt.width=rt.width,nt.height=rt.height,nt.pixelRatio=rt.pixelRatio,nt.codec=rt.codecString,nt.sps=[];for(const it in rt.params)nt.params[it]=rt.params[it]}void 0!==nt.vps&&nt.vps[0]===this.initVPS&&nt.sps.push(at.data)}lt||(lt=this.VideoSample=this.createVideoSample(!0,it.pts,it.dts)),lt.key=!0;break;case 34:if(ot=!0,"object"==typeof nt.params){if(!nt.pps){nt.pps=[];const rt=this.readPPS(at.data);for(const it in rt)nt.params[it]=rt[it]}void 0!==nt.vps&&nt.vps[0]===this.initVPS&&nt.pps.push(at.data)}break;case 35:ot=!0,nt.audFound=!0,null!=(ct=lt)&&ct.frame&&(this.pushAccessUnit(lt,nt),lt=null),lt||(lt=this.VideoSample=this.createVideoSample(!1,it.pts,it.dts));break;default:ot=!1}if(lt&&ot){lt.units.push(at)}})),at&&lt&&(this.pushAccessUnit(lt,nt),this.VideoSample=null)}getNALuType(nt,rt){return(126&nt[rt])>>>1}ebsp2rbsp(nt){const rt=new Uint8Array(nt.byteLength);let it=0;for(let at=0;at<nt.byteLength;at++)at>=2&&3===nt[at]&&0===nt[at-1]&&0===nt[at-2]||(rt[it]=nt[at],it++);return new Uint8Array(rt.buffer,0,it)}pushAccessUnit(nt,rt){super.pushAccessUnit(nt,rt),this.initVPS&&(this.initVPS=null)}readVPS(nt){const rt=new ExpGolomb(nt);rt.readUByte(),rt.readUByte(),rt.readBits(4),rt.skipBits(2),rt.readBits(6);return{numTemporalLayers:rt.readBits(3)+1,temporalIdNested:rt.readBoolean()}}readSPS(nt){const rt=new ExpGolomb(this.ebsp2rbsp(nt));rt.readUByte(),rt.readUByte(),rt.readBits(4);const it=rt.readBits(3);rt.readBoolean();const at=rt.readBits(2),st=rt.readBoolean(),ot=rt.readBits(5),lt=rt.readUByte(),ut=rt.readUByte(),ct=rt.readUByte(),dt=rt.readUByte(),ht=rt.readUByte(),pt=rt.readUByte(),_t=rt.readUByte(),Et=rt.readUByte(),St=rt.readUByte(),wt=rt.readUByte(),Lt=rt.readUByte(),Ct=[],Pt=[];for(let nt=0;nt<it;nt++)Ct.push(rt.readBoolean()),Pt.push(rt.readBoolean());if(it>0)for(let nt=it;nt<8;nt++)rt.readBits(2);for(let nt=0;nt<it;nt++)Ct[nt]&&(rt.readUByte(),rt.readUByte(),rt.readUByte(),rt.readUByte(),rt.readUByte(),rt.readUByte(),rt.readUByte(),rt.readUByte(),rt.readUByte(),rt.readUByte(),rt.readUByte()),Pt[nt]&&rt.readUByte();rt.readUEG();const kt=rt.readUEG();3==kt&&rt.skipBits(1);const Ot=rt.readUEG(),Ft=rt.readUEG(),Bt=rt.readBoolean();let Ut=0,Gt=0,Ht=0,jt=0;Bt&&(Ut+=rt.readUEG(),Gt+=rt.readUEG(),Ht+=rt.readUEG(),jt+=rt.readUEG());const Kt=rt.readUEG(),$t=rt.readUEG(),Yt=rt.readUEG();for(let nt=rt.readBoolean()?0:it;nt<=it;nt++)rt.skipUEG(),rt.skipUEG(),rt.skipUEG();rt.skipUEG(),rt.skipUEG(),rt.skipUEG(),rt.skipUEG(),rt.skipUEG(),rt.skipUEG();if(rt.readBoolean()){if(rt.readBoolean())for(let nt=0;nt<4;nt++)for(let it=0;it<(3===nt?2:6);it++){if(rt.readBoolean()){const it=Math.min(64,1<<4+(nt<<1));nt>1&&rt.readEG();for(let nt=0;nt<it;nt++)rt.readEG()}else rt.readUEG()}}rt.readBoolean(),rt.readBoolean();rt.readBoolean()&&(rt.readUByte(),rt.skipUEG(),rt.skipUEG(),rt.readBoolean());const Wt=rt.readUEG();let Qt=0;for(let nt=0;nt<Wt;nt++){let it=!1;if(0!==nt&&(it=rt.readBoolean()),it){nt===Wt&&rt.readUEG(),rt.readBoolean(),rt.readUEG();let it=0;for(let nt=0;nt<=Qt;nt++){const nt=rt.readBoolean();let at=!1;nt||(at=rt.readBoolean()),(nt||at)&&it++}Qt=it}else{const nt=rt.readUEG(),it=rt.readUEG();Qt=nt+it;for(let it=0;it<nt;it++)rt.readUEG(),rt.readBoolean();for(let nt=0;nt<it;nt++)rt.readUEG(),rt.readBoolean()}}if(rt.readBoolean()){const nt=rt.readUEG();for(let it=0;it<nt;it++){for(let nt=0;nt<Yt+4;nt++)rt.readBits(1);rt.readBits(1)}}let en=0,nn=1,an=1,ln=!0,hn=1,fn=0;rt.readBoolean(),rt.readBoolean();let pn=!1;if(rt.readBoolean()){if(rt.readBoolean()){const nt=rt.readUByte();nt>0&&nt<16?(nn=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][nt-1],an=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][nt-1]):255===nt&&(nn=rt.readBits(16),an=rt.readBits(16))}rt.readBoolean()&&rt.readBoolean();if(rt.readBoolean()){rt.readBits(3),rt.readBoolean();rt.readBoolean()&&(rt.readUByte(),rt.readUByte(),rt.readUByte())}rt.readBoolean()&&(rt.readUEG(),rt.readUEG()),rt.readBoolean(),rt.readBoolean(),rt.readBoolean(),pn=rt.readBoolean(),pn&&(Ut+=rt.readUEG(),Gt+=rt.readUEG(),Ht+=rt.readUEG(),jt+=rt.readUEG());if(rt.readBoolean()){hn=rt.readBits(32),fn=rt.readBits(32);rt.readBoolean()&&rt.readUEG();if(rt.readBoolean()){const nt=rt.readBoolean(),at=rt.readBoolean();let st=!1;(nt||at)&&(st=rt.readBoolean(),st&&(rt.readUByte(),rt.readBits(5),rt.readBoolean(),rt.readBits(5)),rt.readBits(4),rt.readBits(4),st&&rt.readBits(4),rt.readBits(5),rt.readBits(5),rt.readBits(5));for(let ot=0;ot<=it;ot++){ln=rt.readBoolean();let it=!1;ln||rt.readBoolean()?rt.readEG():it=rt.readBoolean();const ot=it?1:rt.readUEG()+1;if(nt)for(let nt=0;nt<ot;nt++)rt.readUEG(),rt.readUEG(),st&&(rt.readUEG(),rt.readUEG()),rt.skipBits(1);if(at)for(let nt=0;nt<ot;nt++)rt.readUEG(),rt.readUEG(),st&&(rt.readUEG(),rt.readUEG()),rt.skipBits(1)}}}rt.readBoolean()&&(rt.readBoolean(),rt.readBoolean(),rt.readBoolean(),en=rt.readUEG())}let mn=Ot,gn=Ft;if(Bt||pn){let nt=1,rt=1;1===kt?nt=rt=2:2==kt&&(nt=2),mn=Ot-nt*Gt-nt*Ut,gn=Ft-rt*jt-rt*Ht}const _n=at?["A","B","C"][at]:"",vn=lt<<24|ut<<16|ct<<8|dt;let En=0;for(let nt=0;nt<32;nt++)En=(En|(vn>>nt&1)<<31-nt)>>>0;let Tn=En.toString(16);1===ot&&"2"===Tn&&(Tn="6");return{codecString:`hvc1.${_n}${ot}.${Tn}.${st?"H":"L"}${Lt}.B0`,params:{general_tier_flag:st,general_profile_idc:ot,general_profile_space:at,general_profile_compatibility_flags:[lt,ut,ct,dt],general_constraint_indicator_flags:[ht,pt,_t,Et,St,wt],general_level_idc:Lt,bit_depth:Kt+8,bit_depth_luma_minus8:Kt,bit_depth_chroma_minus8:$t,min_spatial_segmentation_idc:en,chroma_format_idc:kt,frame_rate:{fixed:ln,fps:fn/hn}},width:mn,height:gn,pixelRatio:[nn,an]}}readPPS(nt){const rt=new ExpGolomb(this.ebsp2rbsp(nt));rt.readUByte(),rt.readUByte(),rt.skipUEG(),rt.skipUEG(),rt.skipBits(2),rt.skipBits(3),rt.skipBits(2),rt.skipUEG(),rt.skipUEG(),rt.skipEG(),rt.skipBits(2);rt.readBoolean()&&rt.skipUEG(),rt.skipEG(),rt.skipEG(),rt.skipBits(4);const it=rt.readBoolean(),at=rt.readBoolean();let st=1;return at&&it?st=0:at?st=3:it&&(st=2),{parallelismType:st}}matchSPS(nt,rt){return String.fromCharCode.apply(null,nt).substr(3)===String.fromCharCode.apply(null,rt).substr(3)}}const Wi=188;class TSDemuxer{constructor(nt,rt,it,at){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=nt,this.config=rt,this.typeSupported=it,this.logger=at,this.videoParser=null}static probe(nt,rt){const it=TSDemuxer.syncOffset(nt);return it>0&&rt.warn(`MPEG2-TS detected but first sync word found @ offset ${it}`),-1!==it}static syncOffset(nt){const rt=nt.length;let it=Math.min(940,rt-Wi)+1,at=0;for(;at<it;){let st=!1,ot=-1,lt=0;for(let ut=at;ut<rt;ut+=Wi){if(71!==nt[ut]||rt-ut!==Wi&&71!==nt[ut+Wi]){if(lt)return-1;break}if(lt++,-1===ot&&(ot=ut,0!==ot&&(it=Math.min(ot+18612,nt.length-Wi)+1)),st||(st=0===parsePID(nt,ut)),st&&lt>1&&(0===ot&&lt>2||ut+Wi>it))return ot}at++}return-1}static createTrack(nt,rt){return{container:"video"===nt||"audio"===nt?"video/mp2t":void 0,type:nt,id:fr[nt],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===nt?rt:void 0}}resetInitSegment(nt,rt,it,at){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=TSDemuxer.createTrack("video"),this._videoTrack.duration=at,this._audioTrack=TSDemuxer.createTrack("audio",at),this._id3Track=TSDemuxer.createTrack("id3"),this._txtTrack=TSDemuxer.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=rt,this.videoCodec=it}resetTimeStamp(){}resetContiguity(){const{_audioTrack:nt,_videoTrack:rt,_id3Track:it}=this;nt&&(nt.pesData=null),rt&&(rt.pesData=null),it&&(it.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(nt,rt,it=!1,at=!1){let st;it||(this.sampleAes=null);const ot=this._videoTrack,lt=this._audioTrack,ut=this._id3Track,ct=this._txtTrack;let dt=ot.pid,ht=ot.pesData,pt=lt.pid,_t=ut.pid,Et=lt.pesData,St=ut.pesData,wt=null,Lt=this.pmtParsed,Ct=this._pmtId,Pt=nt.length;if(this.remainderData&&(Pt=(nt=appendUint8Array(this.remainderData,nt)).length,this.remainderData=null),Pt<Wi&&!at)return this.remainderData=nt,{audioTrack:lt,videoTrack:ot,id3Track:ut,textTrack:ct};const kt=Math.max(0,TSDemuxer.syncOffset(nt));Pt-=(Pt-kt)%Wi,Pt<nt.byteLength&&!at&&(this.remainderData=new Uint8Array(nt.buffer,Pt,nt.buffer.byteLength-Pt));let Ot=0;for(let rt=kt;rt<Pt;rt+=Wi)if(71===nt[rt]){const at=!!(64&nt[rt+1]),Pt=parsePID(nt,rt);let Ot;if((48&nt[rt+3])>>4>1){if(Ot=rt+5+nt[rt+4],Ot===rt+Wi)continue}else Ot=rt+4;switch(Pt){case dt:if(at){if(ht&&(st=parsePES(ht,this.logger))){if(null===this.videoParser)switch(ot.segmentCodec){case"avc":this.videoParser=new AvcVideoParser;break;case"hevc":this.videoParser=new HevcVideoParser}null!==this.videoParser&&this.videoParser.parsePES(ot,ct,st,!1)}ht={data:[],size:0}}ht&&(ht.data.push(nt.subarray(Ot,rt+Wi)),ht.size+=rt+Wi-Ot);break;case pt:if(at){if(Et&&(st=parsePES(Et,this.logger)))switch(lt.segmentCodec){case"aac":this.parseAACPES(lt,st);break;case"mp3":this.parseMPEGPES(lt,st);break;case"ac3":this.parseAC3PES(lt,st)}Et={data:[],size:0}}Et&&(Et.data.push(nt.subarray(Ot,rt+Wi)),Et.size+=rt+Wi-Ot);break;case _t:at&&(St&&(st=parsePES(St,this.logger))&&this.parseID3PES(ut,st),St={data:[],size:0}),St&&(St.data.push(nt.subarray(Ot,rt+Wi)),St.size+=rt+Wi-Ot);break;case 0:at&&(Ot+=nt[Ot]+1),Ct=this._pmtId=parsePAT(nt,Ot);break;case Ct:{at&&(Ot+=nt[Ot]+1);const st=parsePMT(nt,Ot,this.typeSupported,it,this.observer,this.logger);dt=st.videoPid,dt>0&&(ot.pid=dt,ot.segmentCodec=st.segmentVideoCodec),pt=st.audioPid,pt>0&&(lt.pid=pt,lt.segmentCodec=st.segmentAudioCodec),_t=st.id3Pid,_t>0&&(ut.pid=_t),null===wt||Lt||(this.logger.warn(`MPEG-TS PMT found at ${rt} after unknown PID '${wt}'. Backtracking to sync byte @${kt} to parse all TS packets.`),wt=null,rt=kt-188),Lt=this.pmtParsed=!0;break}case 17:case 8191:break;default:wt=Pt}}else Ot++;Ot>0&&emitParsingError(this.observer,new Error(`Found ${Ot} TS packet/s that do not start with 0x47`),void 0,this.logger),ot.pesData=ht,lt.pesData=Et,ut.pesData=St;const Ft={audioTrack:lt,videoTrack:ot,id3Track:ut,textTrack:ct};return at&&this.extractRemainingSamples(Ft),Ft}flush(){const{remainderData:nt}=this;let rt;return this.remainderData=null,rt=nt?this.demux(nt,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(rt),this.sampleAes?this.decrypt(rt,this.sampleAes):rt}extractRemainingSamples(nt){const{audioTrack:rt,videoTrack:it,id3Track:at,textTrack:st}=nt,ot=it.pesData,lt=rt.pesData,ut=at.pesData;let ct;if(ot&&(ct=parsePES(ot,this.logger))){if(null===this.videoParser)switch(it.segmentCodec){case"avc":this.videoParser=new AvcVideoParser;break;case"hevc":this.videoParser=new HevcVideoParser}null!==this.videoParser&&(this.videoParser.parsePES(it,st,ct,!0),it.pesData=null)}else it.pesData=ot;if(lt&&(ct=parsePES(lt,this.logger))){switch(rt.segmentCodec){case"aac":this.parseAACPES(rt,ct);break;case"mp3":this.parseMPEGPES(rt,ct);break;case"ac3":this.parseAC3PES(rt,ct)}rt.pesData=null}else null!=lt&&lt.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),rt.pesData=lt;ut&&(ct=parsePES(ut,this.logger))?(this.parseID3PES(at,ct),at.pesData=null):at.pesData=ut}demuxSampleAes(nt,rt,it){const at=this.demux(nt,it,!0,!this.config.progressive),st=this.sampleAes=new SampleAesDecrypter(this.observer,this.config,rt);return this.decrypt(at,st)}decrypt(nt,rt){return new Promise((it=>{const{audioTrack:at,videoTrack:st}=nt;at.samples&&"aac"===at.segmentCodec?rt.decryptAacSamples(at.samples,0,(()=>{st.samples?rt.decryptAvcSamples(st.samples,0,0,(()=>{it(nt)})):it(nt)})):st.samples&&rt.decryptAvcSamples(st.samples,0,0,(()=>{it(nt)}))}))}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(nt,rt){let it=0;const at=this.aacOverFlow;let st,ot,lt,ut=rt.data;if(at){this.aacOverFlow=null;const rt=at.missing,st=at.sample.unit.byteLength;if(-1===rt)ut=appendUint8Array(at.sample.unit,ut);else{const ot=st-rt;at.sample.unit.set(ut.subarray(0,rt),ot),nt.samples.push(at.sample),it=at.missing}}for(st=it,ot=ut.length;st<ot-1&&!isHeader$1(ut,st);st++);if(st!==it){let nt;const rt=st<ot-1;if(nt=rt?`AAC PES did not start with ADTS header,offset:${st}`:"No ADTS header found in AAC PES",emitParsingError(this.observer,new Error(nt),rt,this.logger),!rt)return}if(initTrackConfig(nt,this.observer,ut,st,this.audioCodec),void 0!==rt.pts)lt=rt.pts;else{if(!at)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const rt=getFrameDuration(nt.samplerate);lt=at.sample.pts+rt}}let ct,dt=0;for(;st<ot;){if(ct=appendFrame$2(nt,ut,st,lt,dt),st+=ct.length,ct.missing){this.aacOverFlow=ct;break}for(dt++;st<ot-1&&!isHeader$1(ut,st);st++);}}parseMPEGPES(nt,rt){const it=rt.data,at=it.length;let st=0,ot=0;const lt=rt.pts;if(void 0!==lt)for(;ot<at;)if(isHeader(it,ot)){const rt=appendFrame$1(nt,it,ot,lt,st);if(!rt)break;ot+=rt.length,st++}else ot++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(nt,rt){{const it=rt.data,at=rt.pts;if(void 0===at)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const st=it.length;let ot,lt=0,ut=0;for(;ut<st&&(ot=appendFrame(nt,it,ut,at,lt++))>0;)ut+=ot}}parseID3PES(nt,rt){if(void 0===rt.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const it=_extends({},rt,{type:this._videoTrack?Zi.emsg:Zi.audioId3,duration:Number.POSITIVE_INFINITY});nt.samples.push(it)}}function parsePID(nt,rt){return((31&nt[rt+1])<<8)+nt[rt+2]}function parsePAT(nt,rt){return(31&nt[rt+10])<<8|nt[rt+11]}function parsePMT(nt,rt,it,at,st,ot){const lt={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},ut=rt+3+((15&nt[rt+1])<<8|nt[rt+2])-4;for(rt+=12+((15&nt[rt+10])<<8|nt[rt+11]);rt<ut;){const ut=parsePID(nt,rt),ct=(15&nt[rt+3])<<8|nt[rt+4];switch(nt[rt]){case 207:if(!at){logEncryptedSamplesFoundInUnencryptedStream("ADTS AAC",ot);break}case 15:-1===lt.audioPid&&(lt.audioPid=ut);break;case 21:-1===lt.id3Pid&&(lt.id3Pid=ut);break;case 219:if(!at){logEncryptedSamplesFoundInUnencryptedStream("H.264",ot);break}case 27:-1===lt.videoPid&&(lt.videoPid=ut,lt.segmentVideoCodec="avc");break;case 3:case 4:it.mpeg||it.mp3?-1===lt.audioPid&&(lt.audioPid=ut,lt.segmentAudioCodec="mp3"):ot.log("MPEG audio found, not supported in this browser");break;case 193:if(!at){logEncryptedSamplesFoundInUnencryptedStream("AC-3",ot);break}case 129:it.ac3?-1===lt.audioPid&&(lt.audioPid=ut,lt.segmentAudioCodec="ac3"):ot.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===lt.audioPid&&ct>0){let at=rt+5,st=ct;for(;st>2;){if(106===nt[at])!0!==it.ac3?ot.log("AC-3 audio found, not supported in this browser for now"):(lt.audioPid=ut,lt.segmentAudioCodec="ac3");const rt=nt[at+1]+2;at+=rt,st-=rt}}break;case 194:case 135:return emitParsingError(st,new Error("Unsupported EC-3 in M2TS found"),void 0,ot),lt;case 36:-1===lt.videoPid&&(lt.videoPid=ut,lt.segmentVideoCodec="hevc",ot.log("HEVC in M2TS found"))}rt+=ct+5}return lt}function emitParsingError(nt,rt,it,at){at.warn(`parsing error: ${rt.message}`),nt.emit(Ot.ERROR,Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.FRAG_PARSING_ERROR,fatal:!1,levelRetry:it,error:rt,reason:rt.message})}function logEncryptedSamplesFoundInUnencryptedStream(nt,rt){rt.log(`${nt} with AES-128-CBC encryption found in unencrypted stream`)}function parsePES(nt,rt){let it,at,st,ot,lt,ut=0;const ct=nt.data;if(!nt||0===nt.size)return null;for(;ct[0].length<19&&ct.length>1;)ct[0]=appendUint8Array(ct[0],ct[1]),ct.splice(1,1);it=ct[0];if(1===(it[0]<<16)+(it[1]<<8)+it[2]){if(at=(it[4]<<8)+it[5],at&&at>nt.size-6)return null;const dt=it[7];192&dt&&(ot=536870912*(14&it[9])+4194304*(255&it[10])+16384*(254&it[11])+128*(255&it[12])+(254&it[13])/2,64&dt?(lt=536870912*(14&it[14])+4194304*(255&it[15])+16384*(254&it[16])+128*(255&it[17])+(254&it[18])/2,ot-lt>54e5&&(rt.warn(`${Math.round((ot-lt)/9e4)}s delta between PTS and DTS, align them`),ot=lt)):lt=ot),st=it[8];let ht=st+9;if(nt.size<=ht)return null;nt.size-=ht;const pt=new Uint8Array(nt.size);for(let nt=0,rt=ct.length;nt<rt;nt++){it=ct[nt];let rt=it.byteLength;if(ht){if(ht>rt){ht-=rt;continue}it=it.subarray(ht),rt-=ht,ht=0}pt.set(it,ut),ut+=rt}return at&&(at-=st+3),{data:pt,pts:ot,dts:lt,len:at}}return null}class AAC{static getSilentFrame(nt,rt){if("mp4a.40.2"===nt){if(1===rt)return new Uint8Array([0,200,0,128,35,128]);if(2===rt)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===rt)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===rt)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===rt)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===rt)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===rt)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===rt)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===rt)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const Qi=Math.pow(2,32)-1;class MP4{static init(){let nt;for(nt in MP4.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},MP4.types)MP4.types.hasOwnProperty(nt)&&(MP4.types[nt]=[nt.charCodeAt(0),nt.charCodeAt(1),nt.charCodeAt(2),nt.charCodeAt(3)]);const rt=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),it=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:rt,audio:it};const at=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),st=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=st,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const ot=new Uint8Array([105,115,111,109]),lt=new Uint8Array([97,118,99,49]),ut=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,ot,ut,ot,lt),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,at))}static box(nt,...rt){let it=8,at=rt.length;const st=at;for(;at--;)it+=rt[at].byteLength;const ot=new Uint8Array(it);for(ot[0]=it>>24&255,ot[1]=it>>16&255,ot[2]=it>>8&255,ot[3]=255&it,ot.set(nt,4),at=0,it=8;at<st;at++)ot.set(rt[at],it),it+=rt[at].byteLength;return ot}static hdlr(nt){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[nt])}static mdat(nt){return MP4.box(MP4.types.mdat,nt)}static mdhd(nt,rt){rt*=nt;const it=Math.floor(rt/(Qi+1)),at=Math.floor(rt%(Qi+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,nt>>24&255,nt>>16&255,nt>>8&255,255&nt,it>>24,it>>16&255,it>>8&255,255&it,at>>24,at>>16&255,at>>8&255,255&at,85,196,0,0]))}static mdia(nt){return MP4.box(MP4.types.mdia,MP4.mdhd(nt.timescale,nt.duration),MP4.hdlr(nt.type),MP4.minf(nt))}static mfhd(nt){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,nt>>24,nt>>16&255,nt>>8&255,255&nt]))}static minf(nt){return"audio"===nt.type?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(nt)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(nt))}static moof(nt,rt,it){return MP4.box(MP4.types.moof,MP4.mfhd(nt),MP4.traf(it,rt))}static moov(nt){let rt=nt.length;const it=[];for(;rt--;)it[rt]=MP4.trak(nt[rt]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(nt[0].timescale,nt[0].duration)].concat(it).concat(MP4.mvex(nt)))}static mvex(nt){let rt=nt.length;const it=[];for(;rt--;)it[rt]=MP4.trex(nt[rt]);return MP4.box.apply(null,[MP4.types.mvex,...it])}static mvhd(nt,rt){rt*=nt;const it=Math.floor(rt/(Qi+1)),at=Math.floor(rt%(Qi+1)),st=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,nt>>24&255,nt>>16&255,nt>>8&255,255&nt,it>>24,it>>16&255,it>>8&255,255&it,at>>24,at>>16&255,at>>8&255,255&at,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,st)}static sdtp(nt){const rt=nt.samples||[],it=new Uint8Array(4+rt.length);let at,st;for(at=0;at<rt.length;at++)st=rt[at].flags,it[at+4]=st.dependsOn<<4|st.isDependedOn<<2|st.hasRedundancy;return MP4.box(MP4.types.sdtp,it)}static stbl(nt){return MP4.box(MP4.types.stbl,MP4.stsd(nt),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))}static avc1(nt){let rt,it,at,st=[],ot=[];for(rt=0;rt<nt.sps.length;rt++)it=nt.sps[rt],at=it.byteLength,st.push(at>>>8&255),st.push(255&at),st=st.concat(Array.prototype.slice.call(it));for(rt=0;rt<nt.pps.length;rt++)it=nt.pps[rt],at=it.byteLength,ot.push(at>>>8&255),ot.push(255&at),ot=ot.concat(Array.prototype.slice.call(it));const lt=MP4.box(MP4.types.avcC,new Uint8Array([1,st[3],st[4],st[5],255,224|nt.sps.length].concat(st).concat([nt.pps.length]).concat(ot))),ut=nt.width,ct=nt.height,dt=nt.pixelRatio[0],ht=nt.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,ut>>8&255,255&ut,ct>>8&255,255&ct,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),lt,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([dt>>24,dt>>16&255,dt>>8&255,255&dt,ht>>24,ht>>16&255,ht>>8&255,255&ht])))}static esds(nt){const rt=nt.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...rt,6,1,2])}static audioStsd(nt){const rt=nt.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,nt.channelCount,0,16,0,0,0,0,rt>>8&255,255&rt,0,0])}static mp4a(nt){return MP4.box(MP4.types.mp4a,MP4.audioStsd(nt),MP4.box(MP4.types.esds,MP4.esds(nt)))}static mp3(nt){return MP4.box(MP4.types[".mp3"],MP4.audioStsd(nt))}static ac3(nt){return MP4.box(MP4.types["ac-3"],MP4.audioStsd(nt),MP4.box(MP4.types.dac3,nt.config))}static stsd(nt){return"audio"===nt.type?"mp3"===nt.segmentCodec&&"mp3"===nt.codec?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(nt)):"ac3"===nt.segmentCodec?MP4.box(MP4.types.stsd,MP4.STSD,MP4.ac3(nt)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(nt)):"avc"===nt.segmentCodec?MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(nt)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.hvc1(nt))}static tkhd(nt){const rt=nt.id,it=nt.duration*nt.timescale,at=nt.width,st=nt.height,ot=Math.floor(it/(Qi+1)),lt=Math.floor(it%(Qi+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,rt>>24&255,rt>>16&255,rt>>8&255,255&rt,0,0,0,0,ot>>24,ot>>16&255,ot>>8&255,255&ot,lt>>24,lt>>16&255,lt>>8&255,255&lt,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,at>>8&255,255&at,0,0,st>>8&255,255&st,0,0]))}static traf(nt,rt){const it=MP4.sdtp(nt),at=nt.id,st=Math.floor(rt/(Qi+1)),ot=Math.floor(rt%(Qi+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,at>>24,at>>16&255,at>>8&255,255&at])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,st>>24,st>>16&255,st>>8&255,255&st,ot>>24,ot>>16&255,ot>>8&255,255&ot])),MP4.trun(nt,it.length+16+20+8+16+8+8),it)}static trak(nt){return nt.duration=nt.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(nt),MP4.mdia(nt))}static trex(nt){const rt=nt.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,rt>>24,rt>>16&255,rt>>8&255,255&rt,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(nt,rt){const it=nt.samples||[],at=it.length,st=12+16*at,ot=new Uint8Array(st);let lt,ut,ct,dt,ht,pt;for(rt+=8+st,ot.set(["video"===nt.type?1:0,0,15,1,at>>>24&255,at>>>16&255,at>>>8&255,255&at,rt>>>24&255,rt>>>16&255,rt>>>8&255,255&rt],0),lt=0;lt<at;lt++)ut=it[lt],ct=ut.duration,dt=ut.size,ht=ut.flags,pt=ut.cts,ot.set([ct>>>24&255,ct>>>16&255,ct>>>8&255,255&ct,dt>>>24&255,dt>>>16&255,dt>>>8&255,255&dt,ht.isLeading<<2|ht.dependsOn,ht.isDependedOn<<6|ht.hasRedundancy<<4|ht.paddingValue<<1|ht.isNonSync,61440&ht.degradPrio,15&ht.degradPrio,pt>>>24&255,pt>>>16&255,pt>>>8&255,255&pt],12+16*lt);return MP4.box(MP4.types.trun,ot)}static initSegment(nt){MP4.types||MP4.init();const rt=MP4.moov(nt);return appendUint8Array(MP4.FTYP,rt)}static hvc1(nt){const rt=nt.params,it=[nt.vps,nt.sps,nt.pps],at=new Uint8Array([1,rt.general_profile_space<<6|(rt.general_tier_flag?32:0)|rt.general_profile_idc,rt.general_profile_compatibility_flags[0],rt.general_profile_compatibility_flags[1],rt.general_profile_compatibility_flags[2],rt.general_profile_compatibility_flags[3],rt.general_constraint_indicator_flags[0],rt.general_constraint_indicator_flags[1],rt.general_constraint_indicator_flags[2],rt.general_constraint_indicator_flags[3],rt.general_constraint_indicator_flags[4],rt.general_constraint_indicator_flags[5],rt.general_level_idc,240|rt.min_spatial_segmentation_idc>>8,255&rt.min_spatial_segmentation_idc,252|rt.parallelismType,252|rt.chroma_format_idc,248|rt.bit_depth_luma_minus8,248|rt.bit_depth_chroma_minus8,0,parseInt(rt.frame_rate.fps),3|rt.temporal_id_nested<<2|rt.num_temporal_layers<<3|(rt.frame_rate.fixed?64:0),it.length]);let st=at.length;for(let nt=0;nt<it.length;nt+=1){st+=3;for(let rt=0;rt<it[nt].length;rt+=1)st+=2+it[nt][rt].length}const ot=new Uint8Array(st);ot.set(at,0),st=at.length;const lt=it.length-1;for(let nt=0;nt<it.length;nt+=1){ot.set(new Uint8Array([32+nt|(nt===lt?128:0),0,it[nt].length]),st),st+=3;for(let rt=0;rt<it[nt].length;rt+=1)ot.set(new Uint8Array([it[nt][rt].length>>8,255&it[nt][rt].length]),st),st+=2,ot.set(it[nt][rt],st),st+=it[nt][rt].length}const ut=MP4.box(MP4.types.hvcC,ot),ct=nt.width,dt=nt.height,ht=nt.pixelRatio[0],pt=nt.pixelRatio[1];return MP4.box(MP4.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,ct>>8&255,255&ct,dt>>8&255,255&dt,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),ut,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([ht>>24,ht>>16&255,ht>>8&255,255&ht,pt>>24,pt>>16&255,pt>>8&255,255&pt])))}}MP4.types=void 0,MP4.HDLR_TYPES=void 0,MP4.STTS=void 0,MP4.STSC=void 0,MP4.STCO=void 0,MP4.STSZ=void 0,MP4.VMHD=void 0,MP4.SMHD=void 0,MP4.STSD=void 0,MP4.FTYP=void 0,MP4.DINF=void 0;const ta=9e4;function toTimescaleFromBase(nt,rt,it=1,at=!1){const st=nt*rt*it;return at?Math.round(st):st}function toMsFromMpegTsClock(nt,rt=!1){return toTimescaleFromBase(nt,1e3,1/ta,rt)}let na,ra=null,ia=null;class MP4Remuxer{constructor(nt,rt,it,at){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=nt,this.config=rt,this.typeSupported=it,this.logger=at,this.ISGenerated=!1,null===ra){const nt=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ra=nt?parseInt(nt[1]):0}if(null===ia){const nt=navigator.userAgent.match(/Safari\/(\d+)/i);ia=nt?parseInt(nt[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(nt){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=nt}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(nt){let rt=!1;const it=nt.reduce(((nt,it)=>{const at=it.pts-nt;return at<-4294967296?(rt=!0,normalizePts(nt,it.pts)):at>0?nt:it.pts}),nt[0].pts);return rt&&this.logger.debug("PTS rollover detected"),it}remux(nt,rt,it,at,st,ot,lt,ut){let ct,dt,ht,pt,_t,Et,St=st,wt=st;const Lt=nt.pid>-1,Ct=rt.pid>-1,Pt=rt.samples.length,kt=nt.samples.length>0,Ot=lt&&Pt>0||Pt>1;if((!Lt||kt)&&(!Ct||Ot)||this.ISGenerated||lt){if(this.ISGenerated){var Ft,Bt,Ut,Gt;const nt=this.videoTrackConfig;(nt&&(rt.width!==nt.width||rt.height!==nt.height||(null==(Ft=rt.pixelRatio)?void 0:Ft[0])!==(null==(Bt=nt.pixelRatio)?void 0:Bt[0])||(null==(Ut=rt.pixelRatio)?void 0:Ut[1])!==(null==(Gt=nt.pixelRatio)?void 0:Gt[1]))||!nt&&Ot||null===this.nextAudioPts&&kt)&&this.resetInitSegment()}this.ISGenerated||(ht=this.generateIS(nt,rt,st,ot));const it=this.isVideoContiguous;let at,lt=-1;if(Ot&&(lt=function findKeyframeIndex(nt){for(let rt=0;rt<nt.length;rt++)if(nt[rt].key)return rt;return-1}(rt.samples),!it&&this.config.forceKeyFrameOnDiscontinuity))if(Et=!0,lt>0){this.logger.warn(`[mp4-remuxer]: Dropped ${lt} out of ${Pt} video samples due to a missing keyframe`);const nt=this.getVideoStartPts(rt.samples);rt.samples=rt.samples.slice(lt),rt.dropped+=lt,wt+=(rt.samples[0].pts-nt)/rt.inputTimeScale,at=wt}else-1===lt&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${Pt} video samples`),Et=!1);if(this.ISGenerated){if(kt&&Ot){const it=this.getVideoStartPts(rt.samples),at=(normalizePts(nt.samples[0].pts,it)-it)/rt.inputTimeScale;St+=Math.max(0,at),wt+=Math.max(0,-at)}if(kt){if(nt.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),ht=this.generateIS(nt,rt,st,ot)),dt=this.remuxAudio(nt,St,this.isAudioContiguous,ot,Ct||Ot||ut===jt?wt:void 0),Ot){const at=dt?dt.endPTS-dt.startPTS:0;rt.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),ht=this.generateIS(nt,rt,st,ot)),ct=this.remuxVideo(rt,wt,it,at)}}else Ot&&(ct=this.remuxVideo(rt,wt,it,0));ct&&(ct.firstKeyFrame=lt,ct.independent=-1!==lt,ct.firstKeyFramePTS=at)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(it.samples.length&&(_t=flushTextTrackMetadataCueSamples(it,st,this._initPTS,this._initDTS)),at.samples.length&&(pt=flushTextTrackUserdataCueSamples(at,st,this._initPTS))),{audio:dt,video:ct,initSegment:ht,independent:Et,text:pt,id3:_t}}generateIS(nt,rt,it,at){const st=nt.samples,ot=rt.samples,lt=this.typeSupported,ut={},ct=this._initPTS;let dt,ht,pt,_t=!ct||at,Et="audio/mp4";if(_t&&(dt=ht=1/0),nt.config&&st.length){switch(nt.timescale=nt.samplerate,nt.segmentCodec){case"mp3":lt.mpeg?(Et="audio/mpeg",nt.codec=""):lt.mp3&&(nt.codec="mp3");break;case"ac3":nt.codec="ac-3"}ut.audio={id:"audio",container:Et,codec:nt.codec,initSegment:"mp3"===nt.segmentCodec&&lt.mpeg?new Uint8Array(0):MP4.initSegment([nt]),metadata:{channelCount:nt.channelCount}},_t&&(pt=nt.inputTimeScale,ct&&pt===ct.timescale?_t=!1:dt=ht=st[0].pts-Math.round(pt*it))}if(rt.sps&&rt.pps&&ot.length){if(rt.timescale=rt.inputTimeScale,ut.video={id:"main",container:"video/mp4",codec:rt.codec,initSegment:MP4.initSegment([rt]),metadata:{width:rt.width,height:rt.height}},_t)if(pt=rt.inputTimeScale,ct&&pt===ct.timescale)_t=!1;else{const nt=this.getVideoStartPts(ot),rt=Math.round(pt*it);ht=Math.min(ht,normalizePts(ot[0].dts,nt)-rt),dt=Math.min(dt,nt-rt)}this.videoTrackConfig={width:rt.width,height:rt.height,pixelRatio:rt.pixelRatio}}if(Object.keys(ut).length)return this.ISGenerated=!0,_t?(this._initPTS={baseTime:dt,timescale:pt},this._initDTS={baseTime:ht,timescale:pt}):dt=pt=void 0,{tracks:ut,initPTS:dt,timescale:pt}}remuxVideo(nt,rt,it,at){const st=nt.inputTimeScale,ot=nt.samples,lt=[],ut=ot.length,ct=this._initPTS;let dt,ht,pt=this.nextAvcDts,_t=8,Et=this.videoSampleDuration,St=Number.POSITIVE_INFINITY,wt=Number.NEGATIVE_INFINITY,Lt=!1;if(!it||null===pt){const nt=rt*st,at=ot[0].pts-normalizePts(ot[0].dts,ot[0].pts);ra&&null!==pt&&Math.abs(nt-at-pt)<15e3?it=!0:pt=nt-at}const Ct=ct.baseTime*st/ct.timescale;for(let nt=0;nt<ut;nt++){const rt=ot[nt];rt.pts=normalizePts(rt.pts-Ct,pt),rt.dts=normalizePts(rt.dts-Ct,pt),rt.dts<ot[nt>0?nt-1:nt].dts&&(Lt=!0)}Lt&&ot.sort((function(nt,rt){const it=nt.dts-rt.dts,at=nt.pts-rt.pts;return it||at})),dt=ot[0].dts,ht=ot[ot.length-1].dts;const Ft=ht-dt,Bt=Ft?Math.round(Ft/(ut-1)):Et||nt.inputTimeScale/30;if(it){const it=dt-pt,at=it>Bt,st=it<-1;if((at||st)&&(at?this.logger.warn(`${(nt.segmentCodec||"").toUpperCase()}: ${toMsFromMpegTsClock(it,!0)} ms (${it}dts) hole between fragments detected at ${rt.toFixed(3)}`):this.logger.warn(`${(nt.segmentCodec||"").toUpperCase()}: ${toMsFromMpegTsClock(-it,!0)} ms (${it}dts) overlapping between fragments detected at ${rt.toFixed(3)}`),!st||pt>=ot[0].pts||ra)){dt=pt;const nt=ot[0].pts-it;if(at)ot[0].dts=dt,ot[0].pts=nt;else{let rt=!0;for(let at=0;at<ot.length&&!(ot[at].dts>nt&&rt);at++){const nt=ot[at].pts;if(ot[at].dts-=it,ot[at].pts-=it,at<ot.length-1){const it=ot[at+1].pts;rt=it<=ot[at].pts==it<=nt}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${toMsFromMpegTsClock(nt,!0)}/${toMsFromMpegTsClock(dt,!0)}, delta: ${toMsFromMpegTsClock(it,!0)} ms`)}}dt=Math.max(0,dt);let Ut=0,Gt=0,Ht=dt;for(let nt=0;nt<ut;nt++){const rt=ot[nt],it=rt.units,at=it.length;let st=0;for(let nt=0;nt<at;nt++)st+=it[nt].data.length;Gt+=st,Ut+=at,rt.length=st,rt.dts<Ht?(rt.dts=Ht,Ht+=Bt/4|0||1):Ht=rt.dts,St=Math.min(rt.pts,St),wt=Math.max(rt.pts,wt)}ht=ot[ut-1].dts;const jt=Gt+4*Ut+8;let Kt;try{Kt=new Uint8Array(jt)}catch(nt){return void this.observer.emit(Ot.ERROR,Ot.ERROR,{type:Pt.MUX_ERROR,details:kt.REMUX_ALLOC_ERROR,fatal:!1,error:nt,bytes:jt,reason:`fail allocating video mdat ${jt}`})}const $t=new DataView(Kt.buffer);$t.setUint32(0,jt),Kt.set(MP4.types.mdat,4);let Yt=!1,Wt=Number.POSITIVE_INFINITY,Qt=Number.POSITIVE_INFINITY,en=Number.NEGATIVE_INFINITY,nn=Number.NEGATIVE_INFINITY;for(let nt=0;nt<ut;nt++){const rt=ot[nt],it=rt.units;let ct,dt=0;for(let nt=0,rt=it.length;nt<rt;nt++){const rt=it[nt],at=rt.data,st=rt.data.byteLength;$t.setUint32(_t,st),_t+=4,Kt.set(at,_t),_t+=st,dt+=4+st}if(nt<ut-1)Et=ot[nt+1].dts-rt.dts,ct=ot[nt+1].pts-rt.pts;else{const it=this.config,lt=nt>0?rt.dts-ot[nt-1].dts:Bt;if(ct=nt>0?rt.pts-ot[nt-1].pts:Bt,it.stretchShortVideoTrack&&null!==this.nextAudioPts){const nt=Math.floor(it.maxBufferHole*st),ot=(at?St+at*st:this.nextAudioPts)-rt.pts;ot>nt?(Et=ot-lt,Et<0?Et=lt:Yt=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${ot/90} ms to the next segment; using duration ${Et/90} ms for the last video frame.`)):Et=lt}else Et=lt}const ht=Math.round(rt.pts-rt.dts);Wt=Math.min(Wt,Et),en=Math.max(en,Et),Qt=Math.min(Qt,ct),nn=Math.max(nn,ct),lt.push(new Mp4Sample(rt.key,Et,dt,ht))}if(lt.length)if(ra){if(ra<70){const nt=lt[0].flags;nt.dependsOn=2,nt.isNonSync=0}}else if(ia&&nn-Qt<en-Wt&&Bt/en<.025&&0===lt[0].cts){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let nt=dt;for(let rt=0,it=lt.length;rt<it;rt++){const at=nt+lt[rt].duration,st=nt+lt[rt].cts;if(rt<it-1){const nt=at+lt[rt+1].cts;lt[rt].duration=nt-st}else lt[rt].duration=rt?lt[rt-1].duration:Bt;lt[rt].cts=0,nt=at}}Et=Yt||!Et?Bt:Et,this.nextAvcDts=pt=ht+Et,this.videoSampleDuration=Et,this.isVideoContiguous=!0;const an={data1:MP4.moof(nt.sequenceNumber++,dt,_extends({},nt,{samples:lt})),data2:Kt,startPTS:St/st,endPTS:(wt+Et)/st,startDTS:dt/st,endDTS:pt/st,type:"video",hasAudio:!1,hasVideo:!0,nb:lt.length,dropped:nt.dropped};return nt.samples=[],nt.dropped=0,an}getSamplesPerFrame(nt){switch(nt.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(nt,rt,it,at,st){const ot=nt.inputTimeScale,lt=ot/(nt.samplerate?nt.samplerate:ot),ut=this.getSamplesPerFrame(nt),ct=ut*lt,dt=this._initPTS,ht="mp3"===nt.segmentCodec&&this.typeSupported.mpeg,pt=[],_t=void 0!==st;let Et=nt.samples,St=ht?0:8,wt=this.nextAudioPts||-1;const Lt=rt*ot,Ct=dt.baseTime*ot/dt.timescale;if(this.isAudioContiguous=it=it||Et.length&&wt>0&&(at&&Math.abs(Lt-wt)<9e3||Math.abs(normalizePts(Et[0].pts-Ct,Lt)-wt)<20*ct),Et.forEach((function(nt){nt.pts=normalizePts(nt.pts-Ct,Lt)})),!it||wt<0){if(Et=Et.filter((nt=>nt.pts>=0)),!Et.length)return;wt=0===st?0:at&&!_t?Math.max(0,Lt):Et[0].pts}if("aac"===nt.segmentCodec){const rt=this.config.maxAudioFramesDrift;for(let it=0,at=wt;it<Et.length;it++){const st=Et[it],lt=st.pts,ut=lt-at,dt=Math.abs(1e3*ut/ot);if(ut<=-rt*ct&&_t)0===it&&(this.logger.warn(`Audio frame @ ${(lt/ot).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*ut/ot)} ms.`),this.nextAudioPts=wt=at=lt);else if(ut>=rt*ct&&dt<1e4&&_t){let rt=Math.round(ut/ct);at=lt-rt*ct,at<0&&(rt--,at+=ct),0===it&&(this.nextAudioPts=wt=at),this.logger.warn(`[mp4-remuxer]: Injecting ${rt} audio frame @ ${(at/ot).toFixed(3)}s due to ${Math.round(1e3*ut/ot)} ms gap.`);for(let ot=0;ot<rt;ot++){const rt=Math.max(at,0);let ot=AAC.getSilentFrame(nt.parsedCodec||nt.manifestCodec||nt.codec,nt.channelCount);ot||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ot=st.unit.subarray()),Et.splice(it,0,{unit:ot,pts:rt}),at+=ct,it++}}st.pts=at,at+=ct}}let Ft,Bt=null,Ut=null,Gt=0,Ht=Et.length;for(;Ht--;)Gt+=Et[Ht].unit.byteLength;for(let rt=0,at=Et.length;rt<at;rt++){const at=Et[rt],st=at.unit;let ot=at.pts;if(null!==Ut){pt[rt-1].duration=Math.round((ot-Ut)/lt)}else{if(it&&"aac"===nt.segmentCodec&&(ot=wt),Bt=ot,!(Gt>0))return;Gt+=St;try{Ft=new Uint8Array(Gt)}catch(nt){return void this.observer.emit(Ot.ERROR,Ot.ERROR,{type:Pt.MUX_ERROR,details:kt.REMUX_ALLOC_ERROR,fatal:!1,error:nt,bytes:Gt,reason:`fail allocating audio mdat ${Gt}`})}if(!ht){new DataView(Ft.buffer).setUint32(0,Gt),Ft.set(MP4.types.mdat,4)}}Ft.set(st,St);const ct=st.byteLength;St+=ct,pt.push(new Mp4Sample(!0,ut,ct,0)),Ut=ot}const jt=pt.length;if(!jt)return;const Kt=pt[pt.length-1];this.nextAudioPts=wt=Ut+lt*Kt.duration;const $t=ht?new Uint8Array(0):MP4.moof(nt.sequenceNumber++,Bt/lt,_extends({},nt,{samples:pt}));nt.samples=[];const Yt=Bt/ot,Wt=wt/ot,Qt={data1:$t,data2:Ft,startPTS:Yt,endPTS:Wt,startDTS:Yt,endDTS:Wt,type:"audio",hasAudio:!0,hasVideo:!1,nb:jt};return this.isAudioContiguous=!0,Qt}}function normalizePts(nt,rt){let it;if(null===rt)return nt;for(it=rt<nt?-8589934592:8589934592;Math.abs(nt-rt)>4294967296;)nt+=it;return nt}function flushTextTrackMetadataCueSamples(nt,rt,it,at){const st=nt.samples.length;if(!st)return;const ot=nt.inputTimeScale;for(let lt=0;lt<st;lt++){const st=nt.samples[lt];st.pts=normalizePts(st.pts-it.baseTime*ot/it.timescale,rt*ot)/ot,st.dts=normalizePts(st.dts-at.baseTime*ot/at.timescale,rt*ot)/ot}const lt=nt.samples;return nt.samples=[],{samples:lt}}function flushTextTrackUserdataCueSamples(nt,rt,it){const at=nt.samples.length;if(!at)return;const st=nt.inputTimeScale;for(let ot=0;ot<at;ot++){const at=nt.samples[ot];at.pts=normalizePts(at.pts-it.baseTime*st/it.timescale,rt*st)/st}nt.samples.sort(((nt,rt)=>nt.pts-rt.pts));const ot=nt.samples;return nt.samples=[],{samples:ot}}class Mp4Sample{constructor(nt,rt,it,at){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=rt,this.size=it,this.cts=at,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:nt?2:1,isNonSync:nt?0:1}}}function getParsedTrackCodec(nt,rt){const it=null==nt?void 0:nt.codec;if(it&&it.length>4)return it;if(rt===Wn){if("ec-3"===it||"ac-3"===it||"alac"===it)return it;if("fLaC"===it||"Opus"===it){return getCodecCompatibleName(it,!1)}return Qt.warn(`Unhandled audio codec "${it}" in mp4 MAP`),it||"mp4a"}return Qt.warn(`Unhandled video codec "${it}" in mp4 MAP`),it||"avc1"}try{na=self.performance.now.bind(self.performance)}catch(Ms){na=Date.now}const aa=[{demux:class MP4Demuxer{constructor(nt,rt){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=rt}resetTimeStamp(){}resetInitSegment(nt,rt,it,at){const st=this.videoTrack=dummyTrack("video",1),ot=this.audioTrack=dummyTrack("audio",1),lt=this.txtTrack=dummyTrack("text",1);if(this.id3Track=dummyTrack("id3",1),this.timeOffset=0,null==nt||!nt.byteLength)return;const ut=parseInitSegment(nt);if(ut.video){const{id:nt,timescale:rt,codec:it}=ut.video;st.id=nt,st.timescale=lt.timescale=rt,st.codec=it}if(ut.audio){const{id:nt,timescale:rt,codec:it}=ut.audio;ot.id=nt,ot.timescale=rt,ot.codec=it}lt.id=fr.text,st.sampleDuration=0,st.duration=ot.duration=at}resetContiguity(){this.remainderData=null}static probe(nt){return function hasMoofData(nt){const rt=nt.byteLength;for(let it=0;it<rt;){const at=readUint32(nt,it);if(at>8&&109===nt[it+4]&&111===nt[it+5]&&111===nt[it+6]&&102===nt[it+7])return!0;it=at>1?it+at:rt}return!1}(nt)}demux(nt,rt){this.timeOffset=rt;let it=nt;const at=this.videoTrack,st=this.txtTrack;if(this.config.progressive){this.remainderData&&(it=appendUint8Array(this.remainderData,nt));const rt=function segmentValidRange(nt){const rt={valid:null,remainder:null},it=findBox(nt,["moof"]);if(it.length<2)return rt.remainder=nt,rt;const at=it[it.length-1];return rt.valid=sliceUint8(nt,0,at.byteOffset-8),rt.remainder=sliceUint8(nt,at.byteOffset-8),rt}(it);this.remainderData=rt.remainder,at.samples=rt.valid||new Uint8Array}else at.samples=it;const ot=this.extractID3Track(at,rt);return st.samples=parseSamples(rt,at),{videoTrack:at,audioTrack:this.audioTrack,id3Track:ot,textTrack:this.txtTrack}}flush(){const nt=this.timeOffset,rt=this.videoTrack,it=this.txtTrack;rt.samples=this.remainderData||new Uint8Array,this.remainderData=null;const at=this.extractID3Track(rt,this.timeOffset);return it.samples=parseSamples(nt,rt),{videoTrack:rt,audioTrack:dummyTrack(),id3Track:at,textTrack:dummyTrack()}}extractID3Track(nt,rt){const it=this.id3Track;if(nt.samples.length){const at=findBox(nt.samples,["emsg"]);at&&at.forEach((nt=>{const at=function parseEmsg(nt){const rt=nt[0];let it="",at="",st=0,ot=0,lt=0,ut=0,ct=0,dt=0;if(0===rt){for(;"\0"!==bin2str(nt.subarray(dt,dt+1));)it+=bin2str(nt.subarray(dt,dt+1)),dt+=1;for(it+=bin2str(nt.subarray(dt,dt+1)),dt+=1;"\0"!==bin2str(nt.subarray(dt,dt+1));)at+=bin2str(nt.subarray(dt,dt+1)),dt+=1;at+=bin2str(nt.subarray(dt,dt+1)),dt+=1,st=readUint32(nt,12),ot=readUint32(nt,16),ut=readUint32(nt,20),ct=readUint32(nt,24),dt=28}else if(1===rt){dt+=4,st=readUint32(nt,dt),dt+=4;const rt=readUint32(nt,dt);dt+=4;const ot=readUint32(nt,dt);for(dt+=4,lt=2**32*rt+ot,Lt(lt)||(lt=Number.MAX_SAFE_INTEGER,Qt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),ut=readUint32(nt,dt),dt+=4,ct=readUint32(nt,dt),dt+=4;"\0"!==bin2str(nt.subarray(dt,dt+1));)it+=bin2str(nt.subarray(dt,dt+1)),dt+=1;for(it+=bin2str(nt.subarray(dt,dt+1)),dt+=1;"\0"!==bin2str(nt.subarray(dt,dt+1));)at+=bin2str(nt.subarray(dt,dt+1)),dt+=1;at+=bin2str(nt.subarray(dt,dt+1)),dt+=1}return{schemeIdUri:it,value:at,timeScale:st,presentationTime:lt,presentationTimeDelta:ot,eventDuration:ut,id:ct,payload:nt.subarray(dt,nt.byteLength)}}(nt);if(Yi.test(at.schemeIdUri)){const nt=getEmsgStartTime(at,rt);let st=4294967295===at.eventDuration?Number.POSITIVE_INFINITY:at.eventDuration/at.timeScale;st<=.001&&(st=Number.POSITIVE_INFINITY);const ot=at.payload;it.samples.push({data:ot,len:ot.byteLength,dts:nt,pts:nt,type:Zi.emsg,duration:st})}else if(this.config.enableEmsgKLVMetadata&&at.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const nt=getEmsgStartTime(at,rt);it.samples.push({data:at.payload,len:at.payload.byteLength,dts:nt,pts:nt,type:Zi.misbklv,duration:Number.POSITIVE_INFINITY})}}))}return it}demuxSampleAes(nt,rt,it){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class PassThroughRemuxer{constructor(nt,rt,it,at){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=at}destroy(){}resetTimeStamp(nt){this.initPTS=nt,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(nt,rt,it,at){this.audioCodec=rt,this.videoCodec=it,this.generateInitSegment(function patchEncyptionData(nt,rt){if(!nt||!rt)return nt;const it=rt.keyId;it&&rt.isCommonEncryption&&findBox(nt,["moov","trak"]).forEach((nt=>{const rt=findBox(nt,["mdia","minf","stbl","stsd"])[0].subarray(8);let at=findBox(rt,["enca"]);const st=at.length>0;st||(at=findBox(rt,["encv"])),at.forEach((nt=>{findBox(st?nt.subarray(28):nt.subarray(78),["sinf"]).forEach((nt=>{const rt=parseSinf(nt);if(rt){const nt=rt.subarray(8,24);nt.some((nt=>0!==nt))||(Qt.log(`[eme] Patching keyId in 'enc${st?"a":"v"}>sinf>>tenc' box: ${Hn.hexDump(nt)} -> ${Hn.hexDump(it)}`),rt.set(it,8))}}))}))}));return nt}(nt,at)),this.emitInitSegment=!0}generateInitSegment(nt){let{audioCodec:rt,videoCodec:it}=this;if(null==nt||!nt.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const at=this.initData=parseInitSegment(nt);at.audio&&(rt=getParsedTrackCodec(at.audio,Wn)),at.video&&(it=getParsedTrackCodec(at.video,Jn));const st={};at.audio&&at.video?st.audiovideo={container:"video/mp4",codec:rt+","+it,initSegment:nt,id:"main"}:at.audio?st.audio={container:"audio/mp4",codec:rt,initSegment:nt,id:"audio"}:at.video?st.video={container:"video/mp4",codec:it,initSegment:nt,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=st}remux(nt,rt,it,at,st,ot){var lt,ut;let{initPTS:ct,lastEndTime:dt}=this;const ht={audio:void 0,video:void 0,text:at,id3:it,initSegment:void 0};wt(dt)||(dt=this.lastEndTime=st||0);const pt=rt.samples;if(null==pt||!pt.length)return ht;const _t={initPTS:void 0,timescale:1};let Et=this.initData;if(null!=(lt=Et)&&lt.length||(this.generateInitSegment(pt),Et=this.initData),null==(ut=Et)||!ut.length)return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),ht;this.emitInitSegment&&(_t.tracks=this.initTracks,this.emitInitSegment=!1);const St=function getDuration(nt,rt){let it=0,at=0,st=0;const ot=findBox(nt,["moof","traf"]);for(let nt=0;nt<ot.length;nt++){const lt=ot[nt],ut=findBox(lt,["tfhd"])[0],ct=rt[readUint32(ut,4)];if(!ct)continue;const dt=ct.default,ht=readUint32(ut,0)|(null==dt?void 0:dt.flags);let pt=null==dt?void 0:dt.duration;8&ht&&(pt=readUint32(ut,2&ht?12:8));const _t=ct.timescale||9e4,Et=findBox(lt,["trun"]);for(let nt=0;nt<Et.length;nt++)it=computeRawDurationFromSamples(Et[nt]),!it&&pt&&(it=pt*readUint32(Et[nt],4)),ct.type===Jn?at+=it/_t:ct.type===Wn&&(st+=it/_t)}if(0===at&&0===st){let rt=1/0,it=0,at=0;const st=findBox(nt,["sidx"]);for(let nt=0;nt<st.length;nt++){const ot=parseSegmentIndex(st[nt]);if(null!=ot&&ot.references){rt=Math.min(rt,ot.earliestPresentationTime/ot.timescale);const nt=ot.references.reduce(((nt,rt)=>nt+rt.info.duration||0),0);it=Math.max(it,nt+ot.earliestPresentationTime/ot.timescale),at=it-rt}}if(at&&wt(at))return at}return at||st}(pt,Et),Lt=function getStartDTS(nt,rt){return findBox(rt,["moof","traf"]).reduce(((rt,it)=>{const at=findBox(it,["tfdt"])[0],st=at[0],ot=findBox(it,["tfhd"]).reduce(((rt,it)=>{const ot=readUint32(it,4),lt=nt[ot];if(lt){let nt=readUint32(at,4);if(1===st){if(nt===or)return Qt.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),rt;nt*=or+1,nt+=readUint32(at,8)}const it=nt/(lt.timescale||9e4);if(wt(it)&&(null===rt||it<rt))return it}return rt}),null);return null!==ot&&wt(ot)&&(null===rt||ot<rt)?ot:rt}),null)}(Et,pt),Ct=null===Lt?st:Lt;(function isInvalidInitPts(nt,rt,it,at){if(null===nt)return!0;const st=Math.max(at,1),ot=rt-nt.baseTime/nt.timescale;return Math.abs(ot-it)>st}(ct,Ct,st,St)||_t.timescale!==ct.timescale&&ot)&&(_t.initPTS=Ct-st,ct&&1===ct.timescale&&this.logger.warn(`Adjusting initPTS @${st} from ${ct.baseTime/ct.timescale} to ${_t.initPTS}`),this.initPTS=ct={baseTime:_t.initPTS,timescale:1});const Pt=nt?Ct-ct.baseTime/ct.timescale:dt,kt=Pt+St;!function offsetStartDTS(nt,rt,it){findBox(rt,["moof","traf"]).forEach((rt=>{findBox(rt,["tfhd"]).forEach((at=>{const st=readUint32(at,4),ot=nt[st];if(!ot)return;const lt=ot.timescale||9e4;findBox(rt,["tfdt"]).forEach((nt=>{const rt=nt[0],at=it*lt;if(at){let it=readUint32(nt,4);if(0===rt)it-=at,it=Math.max(it,0),writeUint32(nt,4,it);else{it*=Math.pow(2,32),it+=readUint32(nt,8),it-=at,it=Math.max(it,0);const rt=Math.floor(it/(or+1)),st=Math.floor(it%(or+1));writeUint32(nt,4,rt),writeUint32(nt,8,st)}}}))}))}))}(Et,pt,ct.baseTime/ct.timescale),St>0?this.lastEndTime=kt:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const Ot=!!Et.audio,Ft=!!Et.video;let Bt="";Ot&&(Bt+="audio"),Ft&&(Bt+="video");const Ut={data1:pt,startPTS:Pt,startDTS:Pt,endPTS:kt,endDTS:kt,type:Bt,hasAudio:Ot,hasVideo:Ft,nb:1,dropped:0};return ht.audio="audio"===Ut.type?Ut:void 0,ht.video="audio"!==Ut.type?Ut:void 0,ht.initSegment=_t,ht.id3=flushTextTrackMetadataCueSamples(it,st,ct,ct),at.samples.length&&(ht.text=flushTextTrackUserdataCueSamples(at,st,ct)),ht}}},{demux:TSDemuxer,remux:MP4Remuxer},{demux:class AACDemuxer extends BaseAudioDemuxer{constructor(nt,rt){super(),this.observer=void 0,this.config=void 0,this.observer=nt,this.config=rt}resetInitSegment(nt,rt,it,at){super.resetInitSegment(nt,rt,it,at),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:rt,duration:at,inputTimeScale:9e4,dropped:0}}static probe(nt,rt){if(!nt)return!1;const it=getId3Data(nt,0);let at=(null==it?void 0:it.length)||0;if(probe(nt,at))return!1;for(let it=nt.length;at<it;at++)if(probe$1(nt,at))return rt.log("ADTS sync word found !"),!0;return!1}canParse(nt,rt){return function canParse$1(nt,rt){return function canGetFrameLength(nt,rt){return rt+5<nt.length}(nt,rt)&&isHeaderPattern$1(nt,rt)&&getFullFrameLength(nt,rt)<=nt.length-rt}(nt,rt)}appendFrame(nt,rt,it){initTrackConfig(nt,this.observer,rt,it,nt.manifestCodec);const at=appendFrame$2(nt,rt,it,this.basePTS,this.frameIndex);if(at&&0===at.missing)return at}},remux:MP4Remuxer},{demux:class MP3Demuxer extends BaseAudioDemuxer{resetInitSegment(nt,rt,it,at){super.resetInitSegment(nt,rt,it,at),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:rt,duration:at,inputTimeScale:9e4,dropped:0}}static probe(nt){if(!nt)return!1;const rt=getId3Data(nt,0);let it=(null==rt?void 0:rt.length)||0;if(rt&&11===nt[it]&&119===nt[it+1]&&void 0!==getId3Timestamp(rt)&&getAudioBSID(nt,it)<=16)return!1;for(let rt=nt.length;it<rt;it++)if(probe(nt,it))return Qt.log("MPEG Audio sync word found !"),!0;return!1}canParse(nt,rt){return function canParse(nt,rt){return isHeaderPattern(nt,rt)&&4<=nt.length-rt}(nt,rt)}appendFrame(nt,rt,it){if(null!==this.basePTS)return appendFrame$1(nt,rt,it,this.basePTS,this.frameIndex)}},remux:MP4Remuxer}];aa.splice(2,0,{demux:AC3Demuxer,remux:MP4Remuxer});class Transmuxer{constructor(nt,rt,it,at,st,ot){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=nt,this.typeSupported=rt,this.config=it,this.id=st,this.logger=ot}configure(nt){this.transmuxConfig=nt,this.decrypter&&this.decrypter.reset()}push(nt,rt,it,at){const st=it.transmuxing;st.executeStart=na();let ot=new Uint8Array(nt);const{currentTransmuxState:lt,transmuxConfig:ut}=this;at&&(this.currentTransmuxState=at);const{contiguous:ct,discontinuity:dt,trackSwitch:ht,accurateTimeOffset:pt,timeOffset:_t,initSegmentChange:Et}=at||lt,{audioCodec:St,videoCodec:wt,defaultInitPts:Lt,duration:Ct,initSegmentData:Ft}=ut,Bt=function getEncryptionType(nt,rt){let it=null;nt.byteLength>0&&null!=(null==rt?void 0:rt.key)&&null!==rt.iv&&null!=rt.method&&(it=rt);return it}(ot,rt);if(Bt&&isFullSegmentEncryption(Bt.method)){const nt=this.getDecrypter(),rt=getAesModeFromFullSegmentMethod(Bt.method);if(!nt.isSync())return this.asyncResult=!0,this.decryptionPromise=nt.webCryptoDecrypt(ot,Bt.key.buffer,Bt.iv.buffer,rt).then((nt=>{const rt=this.push(nt,null,it);return this.decryptionPromise=null,rt})),this.decryptionPromise;{let at=nt.softwareDecrypt(ot,Bt.key.buffer,Bt.iv.buffer,rt);if(it.part>-1&&(at=nt.flush()),!at)return st.executeEnd=na(),emptyResult(it);ot=new Uint8Array(at)}}const Ut=this.needsProbing(dt,ht);if(Ut){const nt=this.configureTransmuxer(ot);if(nt)return this.logger.warn(`[transmuxer] ${nt.message}`),this.observer.emit(Ot.ERROR,Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.FRAG_PARSING_ERROR,fatal:!1,error:nt,reason:nt.message}),st.executeEnd=na(),emptyResult(it)}(dt||ht||Et||Ut)&&this.resetInitSegment(Ft,St,wt,Ct,rt),(dt||Et||Ut)&&this.resetInitialTimestamp(Lt),ct||this.resetContiguity();const Gt=this.transmux(ot,Bt,_t,pt,it);this.asyncResult=isPromise(Gt);const Ht=this.currentTransmuxState;return Ht.contiguous=!0,Ht.discontinuity=!1,Ht.trackSwitch=!1,st.executeEnd=na(),Gt}flush(nt){const rt=nt.transmuxing;rt.executeStart=na();const{decrypter:it,currentTransmuxState:at,decryptionPromise:st}=this;if(st)return this.asyncResult=!0,st.then((()=>this.flush(nt)));const ot=[],{timeOffset:lt}=at;if(it){const rt=it.flush();rt&&ot.push(this.push(rt,null,nt))}const{demuxer:ut,remuxer:ct}=this;if(!ut||!ct){rt.executeEnd=na();const it=[emptyResult(nt)];return this.asyncResult?Promise.resolve(it):it}const dt=ut.flush(lt);return isPromise(dt)?(this.asyncResult=!0,dt.then((rt=>(this.flushRemux(ot,rt,nt),ot)))):(this.flushRemux(ot,dt,nt),this.asyncResult?Promise.resolve(ot):ot)}flushRemux(nt,rt,it){const{audioTrack:at,videoTrack:st,id3Track:ot,textTrack:lt}=rt,{accurateTimeOffset:ut,timeOffset:ct}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${it.sn}${it.part>-1?" p: "+it.part:""} of ${this.id===Ht?"level":"track"} ${it.level}`);const dt=this.remuxer.remux(at,st,ot,lt,ct,ut,!0,this.id);nt.push({remuxResult:dt,chunkMeta:it}),it.transmuxing.executeEnd=na()}resetInitialTimestamp(nt){const{demuxer:rt,remuxer:it}=this;rt&&it&&(rt.resetTimeStamp(nt),it.resetTimeStamp(nt))}resetContiguity(){const{demuxer:nt,remuxer:rt}=this;nt&&rt&&(nt.resetContiguity(),rt.resetNextTimestamp())}resetInitSegment(nt,rt,it,at,st){const{demuxer:ot,remuxer:lt}=this;ot&&lt&&(ot.resetInitSegment(nt,rt,it,at),lt.resetInitSegment(nt,rt,it,st))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(nt,rt,it,at,st){let ot;return ot=rt&&"SAMPLE-AES"===rt.method?this.transmuxSampleAes(nt,rt,it,at,st):this.transmuxUnencrypted(nt,it,at,st),ot}transmuxUnencrypted(nt,rt,it,at){const{audioTrack:st,videoTrack:ot,id3Track:lt,textTrack:ut}=this.demuxer.demux(nt,rt,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(st,ot,lt,ut,rt,it,!1,this.id),chunkMeta:at}}transmuxSampleAes(nt,rt,it,at,st){return this.demuxer.demuxSampleAes(nt,rt,it).then((nt=>({remuxResult:this.remuxer.remux(nt.audioTrack,nt.videoTrack,nt.id3Track,nt.textTrack,it,at,!1,this.id),chunkMeta:st})))}configureTransmuxer(nt){const{config:rt,observer:it,typeSupported:at}=this;let st;for(let rt=0,it=aa.length;rt<it;rt++){var ot;if(null!=(ot=aa[rt].demux)&&ot.probe(nt,this.logger)){st=aa[rt];break}}if(!st)return new Error("Failed to find demuxer by probing fragment data");const lt=this.demuxer,ut=this.remuxer,ct=st.remux,dt=st.demux;ut&&ut instanceof ct||(this.remuxer=new ct(it,rt,at,this.logger)),lt&&lt instanceof dt||(this.demuxer=new dt(it,rt,at,this.logger),this.probe=dt.probe)}needsProbing(nt,rt){return!this.demuxer||!this.remuxer||nt||rt}getDecrypter(){let nt=this.decrypter;return nt||(nt=this.decrypter=new Decrypter(this.config)),nt}}const emptyResult=nt=>({remuxResult:{},chunkMeta:nt});function isPromise(nt){return"then"in nt&&nt.then instanceof Function}class TransmuxConfig{constructor(nt,rt,it,at,st){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=nt,this.videoCodec=rt,this.initSegmentData=it,this.duration=at,this.defaultInitPts=st||null}}class TransmuxState{constructor(nt,rt,it,at,st,ot){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=nt,this.contiguous=rt,this.accurateTimeOffset=it,this.trackSwitch=at,this.timeOffset=st,this.initSegmentChange=ot}}let sa=0;class TransmuxerInterface{constructor(nt,rt,it,at){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=sa++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=nt=>{const rt=nt.data,it=this.hls;if(it&&null!=rt&&rt.event&&rt.instanceNo===this.instanceNo)switch(rt.event){case"init":{var at;const nt=null==(at=this.workerContext)?void 0:at.objectURL;nt&&self.URL.revokeObjectURL(nt);break}case"transmuxComplete":this.handleTransmuxComplete(rt.data);break;case"flush":this.onFlush(rt.data);break;case"workerLog":it.logger[rt.data.logType]&&it.logger[rt.data.logType](rt.data.message);break;default:rt.data=rt.data||{},rt.data.frag=this.frag,rt.data.part=this.part,rt.data.id=this.id,it.trigger(rt.event,rt.data)}},this.onWorkerError=nt=>{if(!this.hls)return;const rt=new Error(`${nt.message}  (${nt.filename}:${nt.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(Ot.ERROR,{type:Pt.OTHER_ERROR,details:kt.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:rt})};const st=nt.config;this.hls=nt,this.id=rt,this.useWorker=!!st.enableWorker,this.onTransmuxComplete=it,this.onFlush=at;const forwardMessage=(nt,rt)=>{(rt=rt||{}).frag=this.frag||void 0,nt===Ot.ERROR&&(rt.parent=this.id,rt.part=this.part,this.error=rt.error),this.hls.trigger(nt,rt)};this.observer=new ki,this.observer.on(Ot.FRAG_DECRYPTED,forwardMessage),this.observer.on(Ot.ERROR,forwardMessage);const ot=getM2TSSupportedAudioTypes(st.preferManagedMediaSource);if(this.useWorker&&"undefined"!=typeof Worker){const it=this.hls.logger;if(st.workerPath||function hasUMDWorker(){return"function"==typeof __HLS_WORKER_BUNDLE__}()){try{st.workerPath?(it.log(`loading Web Worker ${st.workerPath} for "${rt}"`),this.workerContext=function loadWorker(nt){const rt=Oi[nt];if(rt)return rt.clientCount++,rt;const it=new self.URL(nt,self.location.href).href,at={worker:new self.Worker(it),scriptURL:it,clientCount:1};return Oi[nt]=at,at}(st.workerPath)):(it.log(`injecting Web Worker for "${rt}"`),this.workerContext=function injectWorker(){const nt=Oi[void 0];if(nt)return nt.clientCount++,nt;const rt=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),it=self.URL.createObjectURL(rt),at={worker:new self.Worker(it),objectURL:it,clientCount:1};return Oi[void 0]=at,at}());const{worker:nt}=this.workerContext;nt.addEventListener("message",this.onWorkerMessage),nt.addEventListener("error",this.onWorkerError),nt.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:ot,id:rt,config:JSON.stringify(st)})}catch(at){it.warn(`Error setting up "${rt}" Web Worker, fallback to inline`,at),this.terminateWorker(),this.error=null,this.transmuxer=new Transmuxer(this.observer,ot,st,"",rt,nt.logger)}return}}this.transmuxer=new Transmuxer(this.observer,ot,st,"",rt,nt.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const nt=this.instanceNo;this.instanceNo=sa++;const rt=this.hls.config,it=getM2TSSupportedAudioTypes(rt.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:nt,typeSupported:it,id:this.id,config:JSON.stringify(rt)})}}terminateWorker(){if(this.workerContext){const{worker:nt}=this.workerContext;this.workerContext=null,nt.removeEventListener("message",this.onWorkerMessage),nt.removeEventListener("error",this.onWorkerError),function removeWorkerFromStore(nt){const rt=Oi[nt||Ni];if(rt&&1==rt.clientCount--){const{worker:it,objectURL:at}=rt;delete Oi[nt||Ni],at&&self.URL.revokeObjectURL(at),it.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const nt=this.transmuxer;nt&&(nt.destroy(),this.transmuxer=null)}const nt=this.observer;nt&&nt.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(nt,rt,it,at,st,ot,lt,ut,ct,dt){var ht,pt;ct.transmuxing.start=self.performance.now();const{instanceNo:_t,transmuxer:Et}=this,St=ot?ot.start:st.start,wt=st.decryptdata,Lt=this.frag,Ct=!(Lt&&st.cc===Lt.cc),Pt=!(Lt&&ct.level===Lt.level),kt=Lt?ct.sn-Lt.sn:-1,Ot=this.part?ct.part-this.part.index:-1,Ft=0===kt&&ct.id>1&&ct.id===(null==Lt?void 0:Lt.stats.chunkCount),Bt=!Pt&&(1===kt||0===kt&&(1===Ot||Ft&&Ot<=0)),Ut=self.performance.now();(Pt||kt||0===st.stats.parsing.start)&&(st.stats.parsing.start=Ut),!ot||!Ot&&Bt||(ot.stats.parsing.start=Ut);const Gt=!(Lt&&(null==(ht=st.initSegment)?void 0:ht.url)===(null==(pt=Lt.initSegment)?void 0:pt.url)),Ht=new TransmuxState(Ct,Bt,ut,Pt,St,Gt);if(!Bt||Ct||Gt){this.hls.logger.log(`[transmuxer-interface, ${st.type}]: Starting new transmux session for sn: ${ct.sn} p: ${ct.part} level: ${ct.level} id: ${ct.id}\n        discontinuity: ${Ct}\n        trackSwitch: ${Pt}\n        contiguous: ${Bt}\n        accurateTimeOffset: ${ut}\n        timeOffset: ${St}\n        initSegmentChange: ${Gt}`);const nt=new TransmuxConfig(it,at,rt,lt,dt);this.configureTransmuxer(nt)}if(this.frag=st,this.part=ot,this.workerContext)this.workerContext.worker.postMessage({instanceNo:_t,cmd:"demux",data:nt,decryptdata:wt,chunkMeta:ct,state:Ht},nt instanceof ArrayBuffer?[nt]:[]);else if(Et){const rt=Et.push(nt,wt,ct,Ht);isPromise(rt)?rt.then((nt=>{this.handleTransmuxComplete(nt)})).catch((nt=>{this.transmuxerError(nt,ct,"transmuxer-interface push error")})):this.handleTransmuxComplete(rt)}}flush(nt){nt.transmuxing.start=self.performance.now();const{instanceNo:rt,transmuxer:it}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:rt,cmd:"flush",chunkMeta:nt});else if(it){const rt=it.flush(nt);isPromise(rt)?rt.then((rt=>{this.handleFlushResult(rt,nt)})).catch((rt=>{this.transmuxerError(rt,nt,"transmuxer-interface flush error")})):this.handleFlushResult(rt,nt)}}transmuxerError(nt,rt,it){this.hls&&(this.error=nt,this.hls.trigger(Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.FRAG_PARSING_ERROR,chunkMeta:rt,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:nt,err:nt,reason:it}))}handleFlushResult(nt,rt){nt.forEach((nt=>{this.handleTransmuxComplete(nt)})),this.onFlush(rt)}configureTransmuxer(nt){const{instanceNo:rt,transmuxer:it}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:rt,cmd:"configure",config:nt}):it&&it.configure(nt)}handleTransmuxComplete(nt){nt.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(nt)}}function subtitleOptionsIdentical(nt,rt){if(nt.length!==rt.length)return!1;for(let it=0;it<nt.length;it++)if(!mediaAttributesIdentical(nt[it].attrs,rt[it].attrs))return!1;return!0}function mediaAttributesIdentical(nt,rt,it){const at=nt["STABLE-RENDITION-ID"];return at&&!it?at===rt["STABLE-RENDITION-ID"]:!(it||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some((it=>nt[it]!==rt[it]))}function subtitleTrackMatchesTextTrack(nt,rt){return rt.label.toLowerCase()===nt.name.toLowerCase()&&(!rt.language||rt.language.toLowerCase()===(nt.lang||"").toLowerCase())}class BasePlaylistController extends Logger{constructor(nt,rt){super(rt,nt.logger),this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.hls=nt}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(nt,rt,it){const at=null==rt?void 0:rt.renditionReports;if(at){let st=-1;for(let it=0;it<at.length;it++){const ot=at[it];let lt;try{lt=new self.URL(ot.URI,rt.url).href}catch(nt){this.warn(`Could not construct new URL for Rendition Report: ${nt}`),lt=ot.URI||""}if(lt===nt){st=it;break}lt===nt.substring(0,lt.length)&&(st=it)}if(-1!==st){const nt=at[st],ot=parseInt(nt["LAST-MSN"])||(null==rt?void 0:rt.lastPartSn);let lt=parseInt(nt["LAST-PART"])||(null==rt?void 0:rt.lastPartIndex);if(this.hls.config.lowLatencyMode){const nt=Math.min(rt.age-rt.partTarget,rt.targetduration);lt>=0&&nt>rt.partTarget&&(lt+=1)}const ut=it&&getSkipValue(it);return new HlsUrlParameters(ot,lt>=0?lt:void 0,ut)}}}loadPlaylist(nt){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(nt){return this.canLoad&&!!nt&&!!nt.url&&(!nt.details||nt.details.live)}shouldReloadPlaylist(nt){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(nt)}playlistLoaded(nt,rt,it){const{details:at,stats:st}=rt,ot=self.performance.now(),lt=st.loading.first?Math.max(0,ot-st.loading.first):0;at.advancedDateTime=Date.now()-lt;const ut=this.hls.config.timelineOffset;if(ut!==at.appliedTimelineOffset){const nt=Math.max(ut||0,0);at.appliedTimelineOffset=nt,at.fragments.forEach((rt=>{rt.start=rt.playlistOffset+nt}))}if(at.live||null!=it&&it.live){if(at.reloaded(it),it&&this.log(`live playlist ${nt} ${at.advanced?"REFRESHED "+at.lastPartSn+"-"+at.lastPartIndex:at.updated?"UPDATED":"MISSED"}`),it&&at.fragments.length>0&&mergeDetails(it,at),!this.canLoad||!at.live)return;let lt,ut,ct;if(at.canBlockReload&&at.endSN&&at.advanced){const nt=this.hls.config.lowLatencyMode,st=at.lastPartSn,ot=at.endSN,dt=at.lastPartIndex,ht=st===ot;-1!==dt?(ut=ht?ot+1:st,ct=ht?nt?0:dt:dt+1):ut=ot+1;const pt=at.age,_t=pt+at.ageHeader;let Et=Math.min(_t-at.partTarget,1.5*at.targetduration);if(Et>0){if(_t>3*at.targetduration)this.log(`Playlist last advanced ${pt.toFixed(2)}s ago. Omitting segment and part directives.`),ut=void 0,ct=void 0;else if(null!=it&&it.tuneInGoal&&_t-at.partTarget>it.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${it.tuneInGoal} to: ${Et} with playlist age: ${at.age}`),Et=0;else{const nt=Math.floor(Et/at.targetduration);if(ut+=nt,void 0!==ct){ct+=Math.round(Et%at.targetduration/at.partTarget)}this.log(`CDN Tune-in age: ${at.ageHeader}s last advanced ${pt.toFixed(2)}s goal: ${Et} skip sn ${nt} to part ${ct}`)}at.tuneInGoal=Et}if(lt=this.getDeliveryDirectives(at,rt.deliveryDirectives,ut,ct),nt||!ht)return void this.loadPlaylist(lt)}else(at.canBlockReload||at.canSkipUntil)&&(lt=this.getDeliveryDirectives(at,rt.deliveryDirectives,ut,ct));const dt=this.hls.mainForwardBufferInfo,ht=dt?dt.end-dt.len:0,pt=function computeReloadInterval(nt,rt=1/0){let it=1e3*nt.targetduration;if(nt.updated){const at=nt.fragments,st=4;if(at.length&&it*st>rt){const nt=1e3*at[at.length-1].duration;nt<it&&(it=nt)}}else it/=2;return Math.round(it)}(at,1e3*(at.edge-ht));at.updated&&ot>this.requestScheduled+pt&&(this.requestScheduled=st.loading.start),void 0!==ut&&at.canBlockReload?this.requestScheduled=st.loading.first+pt-(1e3*at.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+pt<ot?this.requestScheduled=ot:this.requestScheduled-ot<=0&&(this.requestScheduled+=pt);let _t=this.requestScheduled-ot;_t=Math.max(0,_t),this.log(`reload live playlist ${nt} in ${Math.round(_t)} ms`),this.timer=self.setTimeout((()=>this.loadPlaylist(lt)),_t)}else this.clearTimer()}getDeliveryDirectives(nt,rt,it,at){let st=getSkipValue(nt);return null!=rt&&rt.skip&&nt.deltaUpdateFailed&&(it=rt.msn,at=rt.part,st=mn),new HlsUrlParameters(it,at,st)}checkRetry(nt){const rt=nt.details,it=isTimeoutError(nt),at=nt.errorAction,{action:st,retryCount:ot=0,retryConfig:lt}=at||{},ut=!!at&&!!lt&&(st===bn||!at.resolved&&st===En);if(ut){var ct;if(this.requestScheduled=-1,ot>=lt.maxNumRetry)return!1;if(it&&null!=(ct=nt.context)&&ct.deliveryDirectives)this.warn(`Retrying playlist loading ${ot+1}/${lt.maxNumRetry} after "${rt}" without delivery-directives`),this.loadPlaylist();else{const nt=getRetryDelay(lt,ot);this.timer=self.setTimeout((()=>this.loadPlaylist()),nt),this.warn(`Retrying playlist loading ${ot+1}/${lt.maxNumRetry} after "${rt}" in ${nt}ms`)}nt.levelRetry=!0,at.resolved=!0}return ut}}class BufferOperationQueue{constructor(nt){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=nt}destroy(){this.tracks=this.queues=null}append(nt,rt,it){if(null===this.queues||null===this.tracks)return;const at=this.queues[rt];at.push(nt),1!==at.length||it||this.executeNext(rt)}appendBlocker(nt){return new Promise((rt=>{const it={label:"async-blocker",execute:rt,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(it,nt)}))}prependBlocker(nt){return new Promise((rt=>{if(this.queues){const it={label:"async-blocker-prepend",execute:rt,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[nt].unshift(it)}}))}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach((nt=>{var rt;const it=null==(rt=nt[0])?void 0:rt.label;"async-blocker"!==it&&"async-blocker-prepend"!==it||(nt[0].execute(),nt.splice(0,1))}))}unblockAudio(nt){if(null===this.queues)return;this.queues.audio[0]===nt&&this.shiftAndExecuteNext("audio")}executeNext(nt){if(null===this.queues||null===this.tracks)return;const rt=this.queues[nt];if(rt.length){const at=rt[0];try{at.execute()}catch(rt){var it;if(at.onError(rt),null===this.queues||null===this.tracks)return;const st=null==(it=this.tracks[nt])?void 0:it.buffer;null!=st&&st.updating||this.shiftAndExecuteNext(nt)}}}shiftAndExecuteNext(nt){null!==this.queues&&(this.queues[nt].shift(),this.executeNext(nt))}current(nt){var rt;return(null==(rt=this.queues)?void 0:rt[nt][0])||null}toString(){const{queues:nt,tracks:rt}=this;return null===nt||null===rt?"<destroyed>":`\n${this.list("video")}\n${this.list("audio")}\n${this.list("audiovideo")}}`}list(nt){var rt,it;return null!=(rt=this.queues)&&rt[nt]||null!=(it=this.tracks)&&it[nt]?`${nt}: (${this.listSbInfo(nt)}) ${this.listOps(nt)}`:""}listSbInfo(nt){var rt;const it=null==(rt=this.tracks)?void 0:rt[nt],at=null==it?void 0:it.buffer;return at?`SourceBuffer${at.updating?" updating":""}${it.ended?" ended":""}${it.ending?" ending":""}`:"none"}listOps(nt){var rt;return(null==(rt=this.queues)?void 0:rt[nt].map((nt=>nt.label)).join(", "))||""}}const oa=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,la="HlsJsTrackRemovedError";class HlsJsTrackRemovedError extends Error{constructor(nt){super(nt),this.name=la}}function removeSourceChildren(nt){const rt=nt.querySelectorAll("source");[].slice.call(rt).forEach((rt=>{nt.removeChild(rt)}))}function sourceBufferNameToIndex(nt){return"audio"===nt?1:0}class CapLevelController{constructor(nt){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=nt,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(nt){this.streamController=nt}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:nt}=this;nt.on(Ot.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),nt.on(Ot.MEDIA_ATTACHING,this.onMediaAttaching,this),nt.on(Ot.MANIFEST_PARSED,this.onManifestParsed,this),nt.on(Ot.LEVELS_UPDATED,this.onLevelsUpdated,this),nt.on(Ot.BUFFER_CODECS,this.onBufferCodecs,this),nt.on(Ot.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:nt}=this;nt.off(Ot.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),nt.off(Ot.MEDIA_ATTACHING,this.onMediaAttaching,this),nt.off(Ot.MANIFEST_PARSED,this.onManifestParsed,this),nt.off(Ot.LEVELS_UPDATED,this.onLevelsUpdated,this),nt.off(Ot.BUFFER_CODECS,this.onBufferCodecs,this),nt.off(Ot.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(nt,rt){const it=this.hls.levels[rt.droppedLevel];this.isLevelAllowed(it)&&this.restrictedLevels.push({bitrate:it.bitrate,height:it.height,width:it.width})}onMediaAttaching(nt,rt){this.media=rt.media instanceof HTMLVideoElement?rt.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(nt,rt){const it=this.hls;this.restrictedLevels=[],this.firstLevel=rt.firstLevel,it.config.capLevelToPlayerSize&&rt.video&&this.startCapping()}onLevelsUpdated(nt,rt){this.timer&&wt(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(nt,rt){this.hls.config.capLevelToPlayerSize&&rt.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const nt=this.hls.levels;if(nt.length){const rt=this.hls,it=this.getMaxLevel(nt.length-1);it!==this.autoLevelCapping&&rt.logger.log(`Setting autoLevelCapping to ${it}: ${nt[it].height}p@${nt[it].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),rt.autoLevelCapping=it,rt.autoLevelEnabled&&rt.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=rt.autoLevelCapping}}}getMaxLevel(nt){const rt=this.hls.levels;if(!rt.length)return-1;const it=rt.filter(((rt,it)=>this.isLevelAllowed(rt)&&it<=nt));return this.clientRect=null,CapLevelController.getMaxLevelByMediaSize(it,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const nt=this.media,rt={width:0,height:0};if(nt){const it=nt.getBoundingClientRect();rt.width=it.width,rt.height=it.height,rt.width||rt.height||(rt.width=it.right-it.left||nt.width||0,rt.height=it.bottom-it.top||nt.height||0)}return this.clientRect=rt,rt}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let nt=1;if(!this.hls.config.ignoreDevicePixelRatio)try{nt=self.devicePixelRatio}catch(nt){}return nt}isLevelAllowed(nt){return!this.restrictedLevels.some((rt=>nt.bitrate===rt.bitrate&&nt.width===rt.width&&nt.height===rt.height))}static getMaxLevelByMediaSize(nt,rt,it){if(null==nt||!nt.length)return-1;let at=nt.length-1;const st=Math.max(rt,it);for(let rt=0;rt<nt.length;rt+=1){const it=nt[rt];if((it.width>=st||it.height>=st)&&(ot=it,!(lt=nt[rt+1])||ot.width!==lt.width||ot.height!==lt.height)){at=rt;break}}var ot,lt;return at}}var ca,da,fa;!function(nt){nt.MANIFEST="m",nt.AUDIO="a",nt.VIDEO="v",nt.MUXED="av",nt.INIT="i",nt.CAPTION="c",nt.TIMED_TEXT="tt",nt.KEY="k",nt.OTHER="o"}(ca||(ca={})),function(nt){nt.DASH="d",nt.HLS="h",nt.SMOOTH="s",nt.OTHER="o"}(da||(da={})),function(nt){nt.OBJECT="CMCD-Object",nt.REQUEST="CMCD-Request",nt.SESSION="CMCD-Session",nt.STATUS="CMCD-Status"}(fa||(fa={}));const pa={[fa.OBJECT]:["br","d","ot","tb"],[fa.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[fa.SESSION]:["cid","pr","sf","sid","st","v"],[fa.STATUS]:["bs","rtp"]};class SfItem{constructor(nt,rt){Array.isArray(nt)&&(nt=nt.map((nt=>nt instanceof SfItem?nt:new SfItem(nt)))),this.value=nt,this.params=rt}}const ga="Dict";function throwError(nt,rt,it,at){return new Error(`failed to ${nt} "${function format(nt){return Array.isArray(nt)?JSON.stringify(nt):nt instanceof Map?"Map{}":nt instanceof Set?"Set{}":"object"==typeof nt?JSON.stringify(nt):String(nt)}(rt)}" as ${it}`,{cause:at})}function serializeError(nt,rt,it){return throwError("serialize",nt,rt,it)}class SfToken{constructor(nt){this.description=nt}}const _a="Bare Item",ya="Boolean";const va="Byte Sequence";function serializeByteSequence(nt){if(!1===ArrayBuffer.isView(nt))throw serializeError(nt,va);return`:${function base64encode(nt){return btoa(String.fromCharCode(...nt))}(nt)}:`}const Ta="Integer";function serializeInteger(nt){if(function isInvalidInt(nt){return nt<-999999999999999||999999999999999<nt}(nt))throw serializeError(nt,Ta);return nt.toString()}const Ra="Decimal";function serializeDecimal(nt){const rt=roundToEven(nt,3);if(Math.floor(Math.abs(rt)).toString().length>12)throw serializeError(nt,Ra);const it=rt.toString();return it.includes(".")?it:`${it}.0`}const wa="String",La=/[\x00-\x1f\x7f]+/;const Ca="Token";function serializeToken(nt){const rt=function symbolToStr(nt){return nt.description||nt.toString().slice(7,-1)}(nt);if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(rt))throw serializeError(rt,Ca);return rt}function serializeBareItem(nt){switch(typeof nt){case"number":if(!wt(nt))throw serializeError(nt,_a);return Number.isInteger(nt)?serializeInteger(nt):serializeDecimal(nt);case"string":return function serializeString(nt){if(La.test(nt))throw serializeError(nt,wa);return`"${nt.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(nt);case"symbol":return serializeToken(nt);case"boolean":return function serializeBoolean(nt){if("boolean"!=typeof nt)throw serializeError(nt,ya);return nt?"?1":"?0"}(nt);case"object":if(nt instanceof Date)return function serializeDate(nt){return`@${serializeInteger(nt.getTime()/1e3)}`}(nt);if(nt instanceof Uint8Array)return serializeByteSequence(nt);if(nt instanceof SfToken)return serializeToken(nt);default:throw serializeError(nt,_a)}}const Ma="Key";function serializeKey(nt){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(nt))throw serializeError(nt,Ma);return nt}function serializeParams(nt){return null==nt?"":Object.entries(nt).map((([nt,rt])=>!0===rt?`;${serializeKey(nt)}`:`;${serializeKey(nt)}=${serializeBareItem(rt)}`)).join("")}function serializeItem(nt){return nt instanceof SfItem?`${serializeBareItem(nt.value)}${serializeParams(nt.params)}`:serializeBareItem(nt)}function serializeDict(nt,rt={whitespace:!0}){if("object"!=typeof nt)throw serializeError(nt,ga);const it=nt instanceof Map?nt.entries():Object.entries(nt),at=(null==rt?void 0:rt.whitespace)?" ":"";return Array.from(it).map((([nt,rt])=>{rt instanceof SfItem==!1&&(rt=new SfItem(rt));let it=serializeKey(nt);return!0===rt.value?it+=serializeParams(rt.params):(it+="=",Array.isArray(rt.value)?it+=function serializeInnerList(nt){return`(${nt.value.map(serializeItem).join(" ")})${serializeParams(nt.params)}`}(rt):it+=serializeItem(rt)),it})).join(`,${at}`)}const toRounded=nt=>Math.round(nt),toHundred=nt=>100*toRounded(nt/100),Oa={br:toRounded,d:toRounded,bl:toHundred,dl:toHundred,mtp:toHundred,nor:(nt,rt)=>((null==rt?void 0:rt.baseUrl)&&(nt=function urlToRelativePath(nt,rt){const it=new URL(nt),at=new URL(rt);if(it.origin!==at.origin)return nt;const st=it.pathname.split("/").slice(1),ot=at.pathname.split("/").slice(1,-1);for(;st[0]===ot[0];)st.shift(),ot.shift();for(;ot.length;)ot.shift(),st.unshift("..");return st.join("/")}(nt,rt.baseUrl)),encodeURIComponent(nt)),rtp:toHundred,tb:toRounded};function processCmcd(nt,rt){const it={};if(null==nt||"object"!=typeof nt)return it;const at=Object.keys(nt).sort(),st=_extends({},Oa,null==rt?void 0:rt.formatters),ot=null==rt?void 0:rt.filter;return at.forEach((at=>{if(null==ot?void 0:ot(at))return;let lt=nt[at];const ut=st[at];ut&&(lt=ut(lt,rt)),"v"===at&&1===lt||"pr"==at&&1===lt||function isValid(nt){return"number"==typeof nt?wt(nt):null!=nt&&""!==nt&&!1!==nt}(lt)&&(function isTokenField(nt){return"ot"===nt||"sf"===nt||"st"===nt}(at)&&"string"==typeof lt&&(lt=new SfToken(lt)),it[at]=lt)})),it}function encodeCmcd(nt,rt={}){return nt?function encodeSfDict(nt,rt){return serializeDict(nt,rt)}(processCmcd(nt,rt),_extends({whitespace:!1},rt)):""}function appendCmcdHeaders(nt,rt,it){return _extends(nt,function toCmcdHeaders(nt,rt={}){const it={};if(!nt)return it;const at=Object.entries(nt),st=Object.entries(pa).concat(Object.entries((null==rt?void 0:rt.customHeaderMap)||{})),ot=at.reduce(((nt,rt)=>{var it,at;const[ot,lt]=rt,ut=(null===(it=st.find((nt=>nt[1].includes(ot))))||void 0===it?void 0:it[0])||fa.REQUEST;return null!==(at=nt[ut])&&void 0!==at||(nt[ut]={}),nt[ut][ot]=lt,nt}),{});return Object.entries(ot).reduce(((nt,[it,at])=>(nt[it]=encodeCmcd(at,rt),nt)),it)}(rt,it))}const xa="CMCD";const Ba=/CMCD=[^&#]+/;function appendCmcdQuery(nt,rt,it){const at=function toCmcdQuery(nt,rt={}){if(!nt)return"";const it=encodeCmcd(nt,rt);return`${xa}=${encodeURIComponent(it)}`}(rt,it);if(!at)return nt;if(Ba.test(nt))return nt.replace(Ba,at);const st=nt.includes("?")?"&":"?";return`${nt}${st}${at}`}function cloneRenditionGroups(nt,rt,it,at){nt&&Object.keys(rt).forEach((st=>{const ot=nt.filter((nt=>nt.groupId===st)).map((nt=>{const ot=_extends({},nt);return ot.details=void 0,ot.attrs=new AttrList(ot.attrs),ot.url=ot.attrs.URI=performUriReplacement(nt.url,nt.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",it),ot.groupId=ot.attrs["GROUP-ID"]=rt[st],ot.attrs["PATHWAY-ID"]=at,ot}));nt.push(...ot)}))}function performUriReplacement(nt,rt,it,at){const{HOST:st,PARAMS:ot,[it]:lt}=at;let ut;rt&&(ut=null==lt?void 0:lt[rt],ut&&(nt=ut));const ct=new self.URL(nt);return st&&!ut&&(ct.host=st),ot&&Object.keys(ot).sort().forEach((nt=>{nt&&ct.searchParams.set(nt,ot[nt])})),ct.href}class EMEController extends Logger{constructor(nt){super("eme",nt.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=EMEController.CDMCleanupPromise?[EMEController.CDMCleanupPromise]:[],this.onMediaEncrypted=nt=>{const{initDataType:rt,initData:it}=nt,at=`"${nt.type}" event: init data type: "${rt}"`;if(this.debug(at),null===it)return;let st,ot;if("sinf"===rt&&this.getLicenseServerUrl(Mr.FAIRPLAY)){const nt=bin2str(new Uint8Array(it));try{const rt=base64Decode(JSON.parse(nt).sinf),it=parseSinf(new Uint8Array(rt));if(!it)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");st=it.subarray(8,24),ot=Mr.FAIRPLAY}catch(nt){return void this.warn(`${at} Failed to parse sinf: ${nt}`)}}else if(this.getLicenseServerUrl(Mr.WIDEVINE)){const nt=function parseMultiPssh(nt){const rt=[];if(nt instanceof ArrayBuffer){const it=nt.byteLength;let at=0;for(;at+32<it;){const it=parsePssh(new DataView(nt,at));rt.push(it),at+=it.size}}return rt}(it);let rt=Object.keys(this.keySystemAccessPromises);rt.length||(rt=getKeySystemsForConfig(this.config));const lt=nt.filter((nt=>{const it=nt.systemId?keySystemIdToKeySystemDomain(nt.systemId):null;return!!it&&rt.indexOf(it)>-1}))[0];if(!lt)return void(0===nt.length||nt.some((nt=>!nt.systemId))?this.warn(`${at} contains incomplete or invalid pssh data`):this.log(`ignoring ${at} for ${nt.map((nt=>keySystemIdToKeySystemDomain(nt.systemId))).join(",")} pssh data in favor of playlist keys`));if(ot=keySystemIdToKeySystemDomain(lt.systemId),0===lt.version&&lt.data)if(ot===Mr.WIDEVINE){const nt=lt.data.length-22;st=lt.data.subarray(nt,nt+16)}else ot===Mr.PLAYREADY&&(st=parsePlayReadyWRM(lt.data))}if(!ot||!st)return;const lt=Hn.hexDump(st),{keyIdToKeySessionPromise:ut,mediaKeySessions:ct}=this;let dt=ut[lt];for(let nt=0;nt<ct.length;nt++){const at=ct[nt],ot=at.decryptdata;if(!ot.keyId)continue;const ht=Hn.hexDump(ot.keyId);if(lt===ht||-1!==ot.uri.replace(/-/g,"").indexOf(lt)){if(dt=ut[ht],ot.pssh)break;delete ut[ht],ot.pssh=new Uint8Array(it),ot.keyId=st,dt=ut[lt]=dt.then((()=>this.generateRequestWithPreferredKeySession(at,rt,it,"encrypted-event-key-match"))),dt.catch((nt=>this.handleError(nt)));break}}dt||(dt=ut[lt]=this.getKeySystemSelectionPromise([ot]).then((({keySystem:nt,mediaKeys:at})=>{var ot;this.throwIfDestroyed();const ut=new LevelKey("ISO-23001-7",lt,null!=(ot=keySystemDomainToKeySystemFormat(nt))?ot:"");return ut.pssh=new Uint8Array(it),ut.keyId=st,this.attemptSetMediaKeys(nt,at).then((()=>{this.throwIfDestroyed();const st=this.createMediaKeySessionContext({decryptdata:ut,keySystem:nt,mediaKeys:at});return this.generateRequestWithPreferredKeySession(st,rt,it,"encrypted-event-no-match")}))})),dt.catch((nt=>this.handleError(nt))))},this.onWaitingForKey=nt=>{this.log(`"${nt.type}" event`)},this.hls=nt,this.config=nt.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const nt=this.config;nt.requestMediaKeySystemAccessFunc=null,nt.licenseXhrSetup=nt.licenseResponseCallback=void 0,nt.drmSystems=nt.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(Ot.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Ot.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Ot.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Ot.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(Ot.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Ot.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Ot.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Ot.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(nt){const{drmSystems:rt,widevineLicenseUrl:it}=this.config,at=rt[nt];return at?at.licenseUrl:nt===Mr.WIDEVINE&&it?it:void 0}getLicenseServerUrlOrThrow(nt){const rt=this.getLicenseServerUrl(nt);if(void 0===rt)throw new Error(`no license server URL configured for key-system "${nt}"`);return rt}getServerCertificateUrl(nt){const{drmSystems:rt}=this.config,it=rt[nt];if(it)return it.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${nt}"]`)}attemptKeySystemAccess(nt){const rt=this.hls.levels,uniqueCodec=(nt,rt,it)=>!!nt&&it.indexOf(nt)===rt,it=rt.map((nt=>nt.audioCodec)).filter(uniqueCodec),at=rt.map((nt=>nt.videoCodec)).filter(uniqueCodec);return it.length+at.length===0&&at.push("avc1.42e01e"),new Promise(((rt,st)=>{const attempt=nt=>{const ot=nt.shift();this.getMediaKeysPromise(ot,it,at).then((nt=>rt({keySystem:ot,mediaKeys:nt}))).catch((rt=>{nt.length?attempt(nt):st(rt instanceof EMEKeyError?rt:new EMEKeyError({type:Pt.KEY_SYSTEM_ERROR,details:kt.KEY_SYSTEM_NO_ACCESS,error:rt,fatal:!0},rt.message))}))};attempt(nt)}))}requestMediaKeySystemAccess(nt,rt){const{requestMediaKeySystemAccessFunc:it}=this.config;if("function"!=typeof it){let nt=`Configured requestMediaKeySystemAccess is not a function ${it}`;return null===ni&&"http:"===self.location.protocol&&(nt=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(nt))}return it(nt,rt)}getMediaKeysPromise(nt,rt,it){const at=function getSupportedMediaKeySystemConfigurations(nt,rt,it,at){let st;switch(nt){case Mr.FAIRPLAY:st=["cenc","sinf"];break;case Mr.WIDEVINE:case Mr.PLAYREADY:st=["cenc"];break;case Mr.CLEARKEY:st=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${nt}`)}return function createMediaKeySystemConfigurations(nt,rt,it,at){return[{initDataTypes:nt,persistentState:at.persistentState||"optional",distinctiveIdentifier:at.distinctiveIdentifier||"optional",sessionTypes:at.sessionTypes||[at.sessionType||"temporary"],audioCapabilities:rt.map((nt=>({contentType:`audio/mp4; codecs=${nt}`,robustness:at.audioRobustness||"",encryptionScheme:at.audioEncryptionScheme||null}))),videoCapabilities:it.map((nt=>({contentType:`video/mp4; codecs=${nt}`,robustness:at.videoRobustness||"",encryptionScheme:at.videoEncryptionScheme||null})))}]}(st,rt,it,at)}(nt,rt,it,this.config.drmSystemOptions),st=this.keySystemAccessPromises[nt];let ot=null==st?void 0:st.keySystemAccess;if(!ot){this.log(`Requesting encrypted media "${nt}" key-system access with config: ${JSON.stringify(at)}`),ot=this.requestMediaKeySystemAccess(nt,at);const rt=this.keySystemAccessPromises[nt]={keySystemAccess:ot};return ot.catch((rt=>{this.log(`Failed to obtain access to key-system "${nt}": ${rt}`)})),ot.then((it=>{this.log(`Access for key-system "${it.keySystem}" obtained`);const at=this.fetchServerCertificate(nt);return this.log(`Create media-keys for "${nt}"`),rt.mediaKeys=it.createMediaKeys().then((rt=>(this.log(`Media-keys created for "${nt}"`),at.then((it=>it?this.setMediaKeysServerCertificate(rt,nt,it):rt))))),rt.mediaKeys.catch((rt=>{this.error(`Failed to create media-keys for "${nt}"}: ${rt}`)})),rt.mediaKeys}))}return ot.then((()=>st.mediaKeys))}createMediaKeySessionContext({decryptdata:nt,keySystem:rt,mediaKeys:it}){this.log(`Creating key-system session "${rt}" keyId: ${Hn.hexDump(nt.keyId||[])}`);const at=it.createSession(),st={decryptdata:nt,keySystem:rt,mediaKeys:it,mediaKeysSession:at,keyStatus:"status-pending"};return this.mediaKeySessions.push(st),st}renewKeySession(nt){const rt=nt.decryptdata;if(rt.pssh){const it=this.createMediaKeySessionContext(nt),at=this.getKeyIdString(rt),st="cenc";this.keyIdToKeySessionPromise[at]=this.generateRequestWithPreferredKeySession(it,st,rt.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(nt)}getKeyIdString(nt){if(!nt)throw new Error("Could not read keyId of undefined decryptdata");if(null===nt.keyId)throw new Error("keyId is null");return Hn.hexDump(nt.keyId)}updateKeySession(nt,rt){var it;const at=nt.mediaKeysSession;return this.log(`Updating key-session "${at.sessionId}" for keyID ${Hn.hexDump((null==(it=nt.decryptdata)?void 0:it.keyId)||[])}\n      } (data length: ${rt?rt.byteLength:rt})`),at.update(rt)}selectKeySystemFormat(nt){const rt=Object.keys(nt.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${nt.sn} ${nt.type}: ${nt.level}) key formats ${rt.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(rt)),this.keyFormatPromise}getKeyFormatPromise(nt){return new Promise(((rt,it)=>{const at=getKeySystemsForConfig(this.config),st=nt.map(keySystemFormatToKeySystemDomain).filter((nt=>!!nt&&-1!==at.indexOf(nt)));return this.getKeySystemSelectionPromise(st).then((({keySystem:nt})=>{const at=keySystemDomainToKeySystemFormat(nt);at?rt(at):it(new Error(`Unable to find format for key-system "${nt}"`))})).catch(it)}))}loadKey(nt){const rt=nt.keyInfo.decryptdata,it=this.getKeyIdString(rt),at=`(keyId: ${it} format: "${rt.keyFormat}" method: ${rt.method} uri: ${rt.uri})`;this.log(`Starting session for key ${at}`);let st=this.keyIdToKeySessionPromise[it];if(!st){st=this.getKeySystemForKeyPromise(rt).then((({keySystem:it,mediaKeys:st})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${nt.frag.sn} ${nt.frag.type}: ${nt.frag.level} using key ${at}`),this.attemptSetMediaKeys(it,st).then((()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:it,mediaKeys:st,decryptdata:rt})))))));(this.keyIdToKeySessionPromise[it]=st.then((nt=>this.generateRequestWithPreferredKeySession(nt,"cenc",rt.pssh,"playlist-key")))).catch((nt=>this.handleError(nt)))}return st}throwIfDestroyed(nt="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(nt){this.hls&&(this.error(nt.message),nt instanceof EMEKeyError?this.hls.trigger(Ot.ERROR,nt.data):this.hls.trigger(Ot.ERROR,{type:Pt.KEY_SYSTEM_ERROR,details:kt.KEY_SYSTEM_NO_KEYS,error:nt,fatal:!0}))}getKeySystemForKeyPromise(nt){const rt=this.getKeyIdString(nt),it=this.keyIdToKeySessionPromise[rt];if(!it){const rt=keySystemFormatToKeySystemDomain(nt.keyFormat),it=rt?[rt]:getKeySystemsForConfig(this.config);return this.attemptKeySystemAccess(it)}return it}getKeySystemSelectionPromise(nt){if(nt.length||(nt=getKeySystemsForConfig(this.config)),0===nt.length)throw new EMEKeyError({type:Pt.KEY_SYSTEM_ERROR,details:kt.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(nt)}attemptSetMediaKeys(nt,rt){const it=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${nt}"`);const at=Promise.all(it).then((()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(rt)}));return this.setMediaKeysQueue.push(at),at.then((()=>{this.log(`Media-keys set for "${nt}"`),it.push(at),this.setMediaKeysQueue=this.setMediaKeysQueue.filter((nt=>-1===it.indexOf(nt)))}))}generateRequestWithPreferredKeySession(nt,rt,it,at){var st,ot;const lt=null==(st=this.config.drmSystems)||null==(ot=st[nt.keySystem])?void 0:ot.generateRequest;if(lt)try{const at=lt.call(this.hls,rt,it,nt);if(!at)throw new Error("Invalid response from configured generateRequest filter");rt=at.initDataType,it=nt.decryptdata.pssh=at.initData?new Uint8Array(at.initData):null}catch(nt){var ut;if(this.warn(nt.message),null!=(ut=this.hls)&&ut.config.debug)throw nt}if(null===it)return this.log(`Skipping key-session request for "${at}" (no initData)`),Promise.resolve(nt);const ct=this.getKeyIdString(nt.decryptdata);this.log(`Generating key-session request for "${at}": ${ct} (init data type: ${rt} length: ${it?it.byteLength:null})`);const dt=new ki,ht=nt._onmessage=rt=>{const it=nt.mediaKeysSession;if(!it)return void dt.emit("error",new Error("invalid state"));const{messageType:at,message:st}=rt;this.log(`"${at}" message event for session "${it.sessionId}" message size: ${st.byteLength}`),"license-request"===at||"license-renewal"===at?this.renewLicense(nt,st).catch((nt=>{dt.eventNames().length?dt.emit("error",nt):this.handleError(nt)})):"license-release"===at?nt.keySystem===Mr.FAIRPLAY&&(this.updateKeySession(nt,strToUtf8array("acknowledged")),this.removeSession(nt)):this.warn(`unhandled media key message type "${at}"`)},pt=nt._onkeystatuseschange=rt=>{if(!nt.mediaKeysSession)return void dt.emit("error",new Error("invalid state"));this.onKeyStatusChange(nt);const it=nt.keyStatus;dt.emit("keyStatus",it),"expired"===it&&(this.warn(`${nt.keySystem} expired for key ${ct}`),this.renewKeySession(nt))};nt.mediaKeysSession.addEventListener("message",ht),nt.mediaKeysSession.addEventListener("keystatuseschange",pt);const _t=new Promise(((nt,rt)=>{dt.on("error",rt),dt.on("keyStatus",(it=>{it.startsWith("usable")?nt():"output-restricted"===it?rt(new EMEKeyError({type:Pt.KEY_SYSTEM_ERROR,details:kt.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===it?rt(new EMEKeyError({type:Pt.KEY_SYSTEM_ERROR,details:kt.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${it}"`)):"expired"===it?rt(new Error("key expired while generating request")):this.warn(`unhandled key status change "${it}"`)}))}));return nt.mediaKeysSession.generateRequest(rt,it).then((()=>{var rt;this.log(`Request generated for key-session "${null==(rt=nt.mediaKeysSession)?void 0:rt.sessionId}" keyId: ${ct}`)})).catch((nt=>{throw new EMEKeyError({type:Pt.KEY_SYSTEM_ERROR,details:kt.KEY_SYSTEM_NO_SESSION,error:nt,fatal:!1},`Error generating key-session request: ${nt}`)})).then((()=>_t)).catch((rt=>{throw dt.removeAllListeners(),this.removeSession(nt),rt})).then((()=>(dt.removeAllListeners(),nt)))}onKeyStatusChange(nt){nt.mediaKeysSession.keyStatuses.forEach(((rt,it)=>{this.log(`key status change "${rt}" for keyStatuses keyId: ${Hn.hexDump("buffer"in it?new Uint8Array(it.buffer,it.byteOffset,it.byteLength):new Uint8Array(it))} session keyId: ${Hn.hexDump(new Uint8Array(nt.decryptdata.keyId||[]))} uri: ${nt.decryptdata.uri}`),nt.keyStatus=rt}))}fetchServerCertificate(nt){const rt=this.config,it=new(0,rt.loader)(rt),at=this.getServerCertificateUrl(nt);return at?(this.log(`Fetching server certificate for "${nt}"`),new Promise(((st,ot)=>{const lt={responseType:"arraybuffer",url:at},ut=rt.certLoadPolicy.default,ct={loadPolicy:ut,timeout:ut.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},dt={onSuccess:(nt,rt,it,at)=>{st(nt.data)},onError:(rt,it,st,ut)=>{ot(new EMEKeyError({type:Pt.KEY_SYSTEM_ERROR,details:kt.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:st,response:_objectSpread2({url:lt.url,data:void 0},rt)},`"${nt}" certificate request failed (${at}). Status: ${rt.code} (${rt.text})`))},onTimeout:(rt,it,st)=>{ot(new EMEKeyError({type:Pt.KEY_SYSTEM_ERROR,details:kt.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:st,response:{url:lt.url,data:void 0}},`"${nt}" certificate request timed out (${at})`))},onAbort:(nt,rt,it)=>{ot(new Error("aborted"))}};it.load(lt,ct,dt)}))):Promise.resolve()}setMediaKeysServerCertificate(nt,rt,it){return new Promise(((at,st)=>{nt.setServerCertificate(it).then((st=>{this.log(`setServerCertificate ${st?"success":"not supported by CDM"} (${null==it?void 0:it.byteLength}) on "${rt}"`),at(nt)})).catch((nt=>{st(new EMEKeyError({type:Pt.KEY_SYSTEM_ERROR,details:kt.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:nt,fatal:!0},nt.message))}))}))}renewLicense(nt,rt){return this.requestLicense(nt,new Uint8Array(rt)).then((rt=>this.updateKeySession(nt,new Uint8Array(rt)).catch((nt=>{throw new EMEKeyError({type:Pt.KEY_SYSTEM_ERROR,details:kt.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:nt,fatal:!0},nt.message)}))))}unpackPlayReadyKeyMessage(nt,rt){const it=String.fromCharCode.apply(null,new Uint16Array(rt.buffer));if(!it.includes("PlayReadyKeyMessage"))return nt.setRequestHeader("Content-Type","text/xml; charset=utf-8"),rt;const at=(new DOMParser).parseFromString(it,"application/xml"),st=at.querySelectorAll("HttpHeader");if(st.length>0){let rt;for(let it=0,at=st.length;it<at;it++){var ot,lt;rt=st[it];const at=null==(ot=rt.querySelector("name"))?void 0:ot.textContent,ut=null==(lt=rt.querySelector("value"))?void 0:lt.textContent;at&&ut&&nt.setRequestHeader(at,ut)}}const ut=at.querySelector("Challenge"),ct=null==ut?void 0:ut.textContent;if(!ct)throw new Error("Cannot find <Challenge> in key message");return strToUtf8array(atob(ct))}setupLicenseXHR(nt,rt,it,at){const st=this.config.licenseXhrSetup;return st?Promise.resolve().then((()=>{if(!it.decryptdata)throw new Error("Key removed");return st.call(this.hls,nt,rt,it,at)})).catch((ot=>{if(!it.decryptdata)throw ot;return nt.open("POST",rt,!0),st.call(this.hls,nt,rt,it,at)})).then((it=>{nt.readyState||nt.open("POST",rt,!0);return{xhr:nt,licenseChallenge:it||at}})):(nt.open("POST",rt,!0),Promise.resolve({xhr:nt,licenseChallenge:at}))}requestLicense(nt,rt){const it=this.config.keyLoadPolicy.default;return new Promise(((at,st)=>{const ot=this.getLicenseServerUrlOrThrow(nt.keySystem);this.log(`Sending license request to URL: ${ot}`);const lt=new XMLHttpRequest;lt.responseType="arraybuffer",lt.onreadystatechange=()=>{if(!this.hls||!nt.mediaKeysSession)return st(new Error("invalid state"));if(4===lt.readyState)if(200===lt.status){this._requestLicenseFailureCount=0;let rt=lt.response;this.log(`License received ${rt instanceof ArrayBuffer?rt.byteLength:rt}`);const it=this.config.licenseResponseCallback;if(it)try{rt=it.call(this.hls,lt,ot,nt)}catch(nt){this.error(nt)}at(rt)}else{const ut=it.errorRetry,ct=ut?ut.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>ct||lt.status>=400&&lt.status<500)st(new EMEKeyError({type:Pt.KEY_SYSTEM_ERROR,details:kt.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:lt,response:{url:ot,data:void 0,code:lt.status,text:lt.statusText}},`License Request XHR failed (${ot}). Status: ${lt.status} (${lt.statusText})`));else{const it=ct-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${it} attempts left`),this.requestLicense(nt,rt).then(at,st)}}},nt.licenseXhr&&nt.licenseXhr.readyState!==XMLHttpRequest.DONE&&nt.licenseXhr.abort(),nt.licenseXhr=lt,this.setupLicenseXHR(lt,ot,nt,rt).then((({xhr:rt,licenseChallenge:it})=>{nt.keySystem==Mr.PLAYREADY&&(it=this.unpackPlayReadyKeyMessage(rt,it)),rt.send(it)}))}))}onMediaAttached(nt,rt){if(!this.config.emeEnabled)return;const it=rt.media;this.media=it,it.removeEventListener("encrypted",this.onMediaEncrypted),it.removeEventListener("waitingforkey",this.onWaitingForKey),it.addEventListener("encrypted",this.onMediaEncrypted),it.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){var nt;const rt=this.media,it=this.mediaKeySessions;rt&&(rt.removeEventListener("encrypted",this.onMediaEncrypted),rt.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},LevelKey.clearKeyUriToKeyIdMap();const at=it.length;EMEController.CDMCleanupPromise=Promise.all(it.map((nt=>this.removeSession(nt))).concat(null==rt||null==(nt=rt.setMediaKeys(null))?void 0:nt.catch((nt=>{this.log(`Could not clear media keys: ${nt}`)})))).then((()=>{at&&(this.log("finished closing key sessions and clearing media keys"),it.length=0)})).catch((nt=>{this.log(`Could not close sessions and clear media keys: ${nt}`)}))}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(nt,{sessionKeys:rt}){if(rt&&this.config.emeEnabled&&!this.keyFormatPromise){const nt=rt.reduce(((nt,rt)=>(-1===nt.indexOf(rt.keyFormat)&&nt.push(rt.keyFormat),nt)),[]);this.log(`Selecting key-system from session-keys ${nt.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(nt)}}removeSession(nt){const{mediaKeysSession:rt,licenseXhr:it}=nt;if(rt){this.log(`Remove licenses and keys and close session ${rt.sessionId}`),nt._onmessage&&(rt.removeEventListener("message",nt._onmessage),nt._onmessage=void 0),nt._onkeystatuseschange&&(rt.removeEventListener("keystatuseschange",nt._onkeystatuseschange),nt._onkeystatuseschange=void 0),it&&it.readyState!==XMLHttpRequest.DONE&&it.abort(),nt.mediaKeysSession=nt.decryptdata=nt.licenseXhr=void 0;const at=this.mediaKeySessions.indexOf(nt);return at>-1&&this.mediaKeySessions.splice(at,1),rt.remove().catch((nt=>{this.log(`Could not remove session: ${nt}`)})).then((()=>rt.close())).catch((nt=>{this.log(`Could not close session: ${nt}`)}))}}}EMEController.CDMCleanupPromise=void 0;class EMEKeyError extends Error{constructor(nt,rt){super(rt),this.data=void 0,nt.error||(nt.error=new Error(rt)),this.data=nt,nt.err=nt.error}}function sendAddTrackEvent(nt,rt){let it;try{it=new Event("addtrack")}catch(nt){it=document.createEvent("Event"),it.initEvent("addtrack",!1,!1)}it.track=nt,rt.dispatchEvent(it)}function addCueToTrack(nt,rt){const it=nt.mode;if("disabled"===it&&(nt.mode="hidden"),nt.cues&&!nt.cues.getCueById(rt.id))try{if(nt.addCue(rt),!nt.cues.getCueById(rt.id))throw new Error(`addCue is failed for: ${rt}`)}catch(it){Qt.debug(`[texttrack-utils]: ${it}`);try{const it=new self.TextTrackCue(rt.startTime,rt.endTime,rt.text);it.id=rt.id,nt.addCue(it)}catch(nt){Qt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${nt}`)}}"disabled"===it&&(nt.mode=it)}function clearCurrentCues(nt){const rt=nt.mode;if("disabled"===rt&&(nt.mode="hidden"),nt.cues)for(let rt=nt.cues.length;rt--;)nt.removeCue(nt.cues[rt]);"disabled"===rt&&(nt.mode=rt)}function removeCuesInRange(nt,rt,it,at){const st=nt.mode;if("disabled"===st&&(nt.mode="hidden"),nt.cues&&nt.cues.length>0){const st=function getCuesInRange(nt,rt,it){const at=[],st=function getFirstCueIndexAfterTime(nt,rt){if(rt<nt[0].startTime)return 0;const it=nt.length-1;if(rt>nt[it].endTime)return-1;let at=0,st=it;for(;at<=st;){const ot=Math.floor((st+at)/2);if(rt<nt[ot].startTime)st=ot-1;else{if(!(rt>nt[ot].startTime&&at<it))return ot;at=ot+1}}return nt[at].startTime-rt<rt-nt[st].startTime?at:st}(nt,rt);if(st>-1)for(let ot=st,lt=nt.length;ot<lt;ot++){const st=nt[ot];if(st.startTime>=rt&&st.endTime<=it)at.push(st);else if(st.startTime>it)return at}return at}(nt.cues,rt,it);for(let rt=0;rt<st.length;rt++)at&&!at(st[rt])||nt.removeCue(st[rt])}"disabled"===st&&(nt.mode=st)}function filterSubtitleTracks(nt){const rt=[];for(let it=0;it<nt.length;it++){const at=nt[it];"subtitles"!==at.kind&&"captions"!==at.kind||!at.label||rt.push(nt[it])}return rt}function hash(nt){let rt=5381,it=nt.length;for(;it;)rt=33*rt^nt.charCodeAt(--it);return(rt>>>0).toString()}const Ua=.02;let qa=function(nt){return nt[nt.Point=0]="Point",nt[nt.Range=1]="Range",nt}({});function generateAssetIdentifier(nt,rt,it){return`${nt.identifier}-${it+1}-${hash(rt)}`}class InterstitialEvent{constructor(nt,rt){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.base=rt,this.dateRange=nt,this.setDateRange(nt)}setDateRange(nt){this.dateRange=nt,this.resumeOffset=nt.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=nt.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=nt.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=nt.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var nt;null==(nt=this.assetListLoader)||nt.destroy(),this.assetListLoader=this.error=void 0}isAssetPastPlayoutLimit(nt){if(nt>=this.assetList.length)return!0;const rt=this.playoutLimit;if(nt<=0||isNaN(rt))return!1;return this.assetList[nt].startOffset>rt}findAssetIndex(nt){return this.assetList.indexOf(nt)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const nt=this.dateRange.startTime;if(this.snapOptions.out){const rt=this.dateRange.tagAnchor;if(rt)return getSnapToFragmentTime(nt,rt)}return nt}get startOffset(){return this.cue.pre?0:this.startTime}get resumptionOffset(){const nt=this.resumeOffset,rt=wt(nt)?nt:this.duration;return this.cumulativeDuration+rt}get resumeTime(){const nt=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const rt=this.resumeAnchor;if(rt)return getSnapToFragmentTime(nt,rt)}return nt}get appendInPlace(){return!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||0!==this.startTime&&!this.snapOptions.out||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Ua))}set appendInPlace(nt){this.appendInPlaceStarted||(this.appendInPlaceDisabled=!nt)}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(nt){this._timelineStart=nt}get duration(){const nt=this.playoutLimit;let rt;return rt=this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(nt)&&nt<rt&&(rt=nt),rt}set duration(nt){this._duration=nt}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?qa.Range:qa.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}toString(){return function eventToString(nt){return`["${nt.identifier}" ${nt.cue.pre?"<pre>":nt.cue.post?"<post>":""}${nt.timelineStart.toFixed(2)}-${nt.resumeTime.toFixed(2)}]`}(this)}}function getSnapToFragmentTime(nt,rt){return nt-rt.start<rt.duration/2&&!(Math.abs(nt-rt.end)<Ua)?rt.start:rt.end}function getInterstitialUrl(nt,rt,it){const at=new self.URL(nt,it);return"data:"!==at.protocol&&at.searchParams.set("_HLS_primary_id",rt),at}function eventAssetToString(nt){const rt=nt.timelineStart,it=nt.duration||0;return`["${nt.identifier}" ${rt.toFixed(2)}-${(rt+it).toFixed(2)}]`}class HlsAssetPlayer{constructor(nt,rt,it,at){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this.playoutOffset=0,this.checkPlayout=()=>{const nt=this.interstitial.playoutLimit;this.playoutOffset+this.currentTime>=nt&&this.hls.trigger(Ot.PLAYOUT_LIMIT_REACHED,{})};const st=this.hls=new nt(rt);this.interstitial=it,this.assetItem=at;let ot=at.uri;try{ot=getInterstitialUrl(ot,st.sessionId).href}catch(nt){}st.loadSource(ot);const detailsLoaded=()=>{this.hasDetails=!0};st.once(Ot.LEVEL_LOADED,detailsLoaded),st.once(Ot.AUDIO_TRACK_LOADED,detailsLoaded),st.once(Ot.SUBTITLE_TRACK_LOADED,detailsLoaded),st.on(Ot.MEDIA_ATTACHING,((nt,{media:rt})=>{this.removeMediaListeners(),this.mediaAttached=rt;const it=this.interstitial;var st;it.playoutLimit&&(this.playoutOffset=(null==(st=it.assetList[it.assetList.indexOf(at)])?void 0:st.startOffset)||0,rt.addEventListener("timeupdate",this.checkPlayout))}))}get destroyed(){var nt;return!(null!=(nt=this.hls)&&nt.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){return this.hls.media}get bufferedEnd(){const nt=this.media||this.mediaAttached;if(!nt)return 0;const rt=BufferHelper.bufferInfo(nt,nt.currentTime,.001);return this.getAssetTime(rt.end)}get currentTime(){const nt=this.media||this.mediaAttached;return nt?this.getAssetTime(nt.currentTime):0}get duration(){var nt;const rt=null==(nt=this.assetItem)?void 0:nt.duration;return rt||0}get remaining(){const nt=this.duration;return nt?Math.max(0,nt-this.currentTime):0}get timelineOffset(){return this.hls.config.timelineOffset||0}set timelineOffset(nt){const rt=this.timelineOffset;if(nt!==rt){const it=nt-rt;if(Math.abs(it)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=nt}}}getAssetTime(nt){const rt=this.timelineOffset,it=this.duration;return Math.min(Math.max(0,nt-rt),it)}removeMediaListeners(){const nt=this.mediaAttached;nt&&nt.removeEventListener("timeupdate",this.checkPlayout)}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(nt){this.hls.attachMedia(nt)}detachMedia(){this.removeMediaListeners(),this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.hls.transferMedia()}on(nt,rt,it){this.hls.on(nt,rt)}once(nt,rt,it){this.hls.once(nt,rt)}off(nt,rt,it){this.hls.off(nt,rt)}toString(){return`HlsAssetPlayer: ${eventAssetToString(this.assetItem)} ${this.hls.sessionId} ${this.interstitial.appendInPlace?"append-in-place":""}`}}class InterstitialsSchedule{constructor(nt){this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=nt}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach((nt=>nt.reset())),this.events=this.items=null}get duration(){const nt=this.items;return nt?nt[nt.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(nt){return nt&&this.eventMap[nt]||null}hasEvent(nt){return nt in this.eventMap}findItemIndex(nt,rt){if(nt.event)return this.findEventIndex(nt.event.identifier);let it=-1;nt.nextEvent?it=this.findEventIndex(nt.nextEvent.identifier)-1:nt.previousEvent&&(it=this.findEventIndex(nt.previousEvent.identifier)+1);const at=this.items;if(at)for(at[it]||(void 0===rt&&(rt=nt.start),it=this.findItemIndexAtTime(rt));it>=0&&null!=(st=at[it])&&st.event;){var st;it--}return it}findItemIndexAtTime(nt,rt){const it=this.items;if(it)for(let at=0;at<it.length;at++){let st=it[at];if(rt&&"primary"!==rt&&(st=st[rt]),nt===st.start||nt>st.start&&nt<st.end)return at}return-1}findJumpRestrictedIndex(nt,rt){const it=this.items;if(it)for(let at=nt;at<=rt&&it[at];at++){const nt=it[at].event;if(null!=nt&&nt.restrictions.jump&&!nt.appendInPlace)return at}return-1}findEventIndex(nt){const rt=this.items;if(rt)for(let at=rt.length;at--;){var it;if((null==(it=rt[at].event)?void 0:it.identifier)===nt)return at}return-1}findAssetIndex(nt,rt){const it=nt.assetList,at=it.length;if(at>1)for(let nt=0;nt<at;nt++){const at=it[nt];if(!at.error){const it=at.timelineStart;if(rt===it||rt>it&&rt<it+(at.duration||0))return nt}}return 0}get assetIdAtEnd(){var nt,rt;const it=null==(nt=this.items)||null==(rt=nt[this.length-1])?void 0:rt.event;if(it){const nt=it.assetList,rt=nt[nt.length-1];if(rt)return rt.identifier}return null}parseInterstitialDateRanges(nt){const rt=nt.main.details,{dateRanges:it}=rt,at=this.events,st=this.parseDateRanges(it,{url:rt.url}),ot=Object.keys(it),lt=at?at.filter((nt=>!ot.includes(nt.identifier))):[];st.length&&st.sort(((nt,rt)=>{const it=nt.cue.pre,at=nt.cue.post,st=rt.cue.pre,ot=rt.cue.post;if(it&&!st)return-1;if(st&&!it)return 1;if(at&&!ot)return 1;if(ot&&!at)return-1;if(!(it||st||at||ot)){const it=nt.startTime,at=rt.startTime;if(it!==at)return it-at}return nt.dateRange.tagOrder-rt.dateRange.tagOrder})),this.events=st,lt.forEach((nt=>{this.removeEvent(nt)})),this.updateSchedule(nt,lt)}updateSchedule(nt,rt=[]){const it=this.events||[];if(it.length||rt.length||this.length<2){const at=this.items,st=this.parseSchedule(it,nt);(rt.length||(null==at?void 0:at.length)!==st.length||st.some(((nt,rt)=>Math.abs(nt.playout.start-at[rt].playout.start)>.005||Math.abs(nt.playout.end-at[rt].playout.end)>.005)))&&(this.items=st,this.onScheduleUpdate(rt,at))}}parseDateRanges(nt,rt){const it=[],at=Object.keys(nt);for(let st=0;st<at.length;st++){const ot=at[st],lt=nt[ot];if(lt.isInterstitial){let nt=this.eventMap[ot];nt?nt.setDateRange(lt):(nt=new InterstitialEvent(lt,rt),this.eventMap[ot]=nt),it.push(nt)}}return it}parseSchedule(nt,rt){const it=[],at=rt.main.details,st=at.live?1/0:at.edge;let ot=0;if((nt=nt.filter((nt=>!(nt.error||nt.cue.once&&nt.hasPlayed)))).length){this.resolveOffsets(nt,rt);let at=0,ut=0;if(nt.forEach(((rt,lt)=>{const ct=rt.cue.pre,dt=rt.cue.post,ht=nt[lt-1]||null,pt=rt.appendInPlace,_t=dt?st:rt.startOffset,Et=rt.duration,St=rt.timelineOccupancy===qa.Range?Et:0,wt=rt.resumptionOffset,Lt=(null==ht?void 0:ht.startTime)===_t,Ct=_t+rt.cumulativeDuration;let Pt=pt?Ct+Et:_t+wt;if(ct||!dt&&_t<=0){const nt=ut;ut+=St,rt.timelineStart=Ct;const at=ot;ot+=Et,it.push({event:rt,start:Ct,end:Pt,playout:{start:at,end:ot},integrated:{start:nt,end:ut}})}else{if(!(_t<=st))return;{if(!Lt){const st=_t-at;if(st>.033){const ct=at,dt=ut;ut+=st;const ht=ot;ot+=st;const pt={previousEvent:nt[lt-1]||null,nextEvent:rt,start:ct,end:ct+st,playout:{start:ht,end:ot},integrated:{start:dt,end:ut}};it.push(pt)}else st>0&&ht&&(ht.cumulativeDuration+=st,it[it.length-1].end=_t)}dt&&(Pt=Ct),rt.timelineStart=Ct;const st=ut;ut+=St;const ct=ot;ot+=Et,it.push({event:rt,start:Ct,end:Pt,playout:{start:ct,end:ot},integrated:{start:st,end:ut}})}}const kt=rt.resumeTime;at=dt||kt>st?st:kt})),at<st){var lt;const nt=at,rt=ut,ct=st-at;ut+=ct;const dt=ot;ot+=ct,it.push({previousEvent:(null==(lt=it[it.length-1])?void 0:lt.event)||null,nextEvent:null,start:at,end:nt+ct,playout:{start:dt,end:ot},integrated:{start:rt,end:ut}})}this.setDurations(st,ot,ut)}else{const nt=0;it.push({previousEvent:null,nextEvent:null,start:nt,end:st,playout:{start:nt,end:st},integrated:{start:nt,end:st}}),this.setDurations(st,st,st)}return it}setDurations(nt,rt,it){this.durations={primary:nt,playout:rt,integrated:it}}resolveOffsets(nt,rt){const it=rt.main.details,at=it.live?1/0:it.edge;let st=0,ot=-1;nt.forEach(((lt,ut)=>{const ct=lt.cue.pre,dt=lt.cue.post,ht=ct?0:dt?at:lt.startTime;this.updateAssetDurations(lt);if(ot===ht?lt.cumulativeDuration=st:(st=0,ot=ht),!dt&&lt.snapOptions.in&&(lt.resumeAnchor=findFragmentByPTS(null,it.fragments,lt.startOffset+lt.resumptionOffset,0,0)||void 0),lt.appendInPlace&&!lt.appendInPlaceStarted){this.primaryCanResumeInPlaceAt(lt,rt)||(lt.appendInPlace=!1)}if(!lt.appendInPlace)for(let rt=ut-1;ut--;){nt[rt+1].startTime-nt[rt].resumeTime<.033&&(nt[rt].appendInPlace=!1)}const pt=wt(lt.resumeOffset)?lt.resumeOffset:lt.duration;st+=pt}))}primaryCanResumeInPlaceAt(nt,rt){const it=nt.resumeTime,at=nt.startTime+nt.resumptionOffset;return Math.abs(it-at)>Ua?(Qt.log(`Interstitial resumption ${it} not aligned with estimated timeline end ${at}`),!1):rt?!Object.keys(rt).some((nt=>{const at=rt[nt].details,st=at.edge;if(it>st)return Qt.log(`Interstitial resumption ${it} past ${nt} playlist end ${st}`),!0;const ot=findFragmentByPTS(null,at.fragments,it);if(!ot)return Qt.log(`Interstitial resumption ${it} does not overlap with any fragments in ${nt} playlist`),!0;return!(Math.abs(ot.start-it)<Ua||Math.abs(ot.end-it)<Ua)&&(Qt.log(`Interstitial resumption ${it} does not overlap with fragment in ${nt} playlist (${ot.start}-${ot.end})`),!0)})):(Qt.log(`Interstitial resumption ${it} can not be aligned with media (none selected)`),!1)}updateAssetDurations(nt){const rt=nt.timelineStart;let it=0,at=!1,st=!1;nt.assetList.forEach(((nt,ot)=>{const lt=rt+it;nt.startOffset=it,nt.timelineStart=lt,at||(at=null===nt.duration),st||(st=!!nt.error);const ut=nt.error?0:nt.duration||0;it+=ut})),nt.duration=at&&!st?Math.max(it,nt.duration):it}removeEvent(nt){nt.reset(),delete this.eventMap[nt.identifier]}}function segmentToString(nt){return`[${nt.event?'"'+nt.event.identifier+'"':"primary"}: ${nt.start.toFixed(2)}-${nt.end.toFixed(2)}]`}class AssetListLoader{constructor(nt){this.hls=void 0,this.hls=nt}destroy(){this.hls=null}loadAssetList(nt,rt){const it=nt.assetListUrl;let at;try{at=getInterstitialUrl(it,this.hls.sessionId,nt.baseUrl)}catch(rt){const at=this.assignAssetListError(nt,kt.ASSET_LIST_LOAD_ERROR,rt,it);return void this.hls.trigger(Ot.ERROR,at)}if(rt&&!nt.cue.pre&&!nt.cue.post&&"data:"!==at.protocol){const it=rt-nt.startTime;it>0&&at.searchParams.set("_HLS_start_offset",""+Math.round(1e3*it)/1e3)}const st=this.hls.config,ot=new(0,st.loader)(st),lt={responseType:"json",url:at.href},ut=st.interstitialAssetListLoadPolicy.default,ct={loadPolicy:ut,timeout:ut.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},dt={onSuccess:(rt,it,at,st)=>{const ot=rt.data,lt=null==ot?void 0:ot.ASSETS;if(Array.isArray(lt))nt.assetListResponse=ot,this.hls.trigger(Ot.ASSET_LIST_LOADED,{event:nt,assetListResponse:ot,networkDetails:st});else{const rt=this.assignAssetListError(nt,kt.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),at.url,it,st);this.hls.trigger(Ot.ERROR,rt)}},onError:(rt,it,at,st)=>{const ot=this.assignAssetListError(nt,kt.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${rt.code} ${rt.text} (${it.url})`),it.url,st,at);this.hls.trigger(Ot.ERROR,ot)},onTimeout:(rt,it,at)=>{const st=this.assignAssetListError(nt,kt.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${it.url})`),it.url,rt,at);this.hls.trigger(Ot.ERROR,st)}};return ot.load(lt,ct,dt),this.hls.trigger(Ot.ASSET_LIST_LOADING,{event:nt}),ot}assignAssetListError(nt,rt,it,at,st,ot){return nt.error=it,{type:Pt.NETWORK_ERROR,details:rt,fatal:!1,interstitial:nt,url:at,error:it,networkDetails:ot,stats:st}}}class BufferableInstance{constructor(nt){this.buffered=void 0;const getRange=(rt,it,at)=>{if((it>>>=0)>at-1)throw new DOMException(`Failed to execute '${rt}' on 'TimeRanges': The index provided (${it}) is greater than the maximum bound (${at})`);return nt[it][rt]};this.buffered={get length(){return nt.length},end:rt=>getRange("end",rt,nt.length),start:rt=>getRange("start",rt,nt.length)}}}const $a={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=nt=>String.fromCharCode($a[nt]||nt),za=15,Xa=100,Ja={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},es={17:2,18:4,21:6,22:8,23:10,19:13,20:15},ts={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ns={25:2,26:4,29:6,30:8,31:10,27:13,28:15},rs=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class CaptionsLogger{constructor(){this.time=null,this.verboseLevel=0}log(nt,rt){if(this.verboseLevel>=nt){const it="function"==typeof rt?rt():rt;Qt.log(`${this.time} [${nt}] ${it}`)}}}const is=function numArrayToHexArray(nt){const rt=[];for(let it=0;it<nt.length;it++)rt.push(nt[it].toString(16));return rt};class PenState{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(nt){const rt=["foreground","underline","italics","background","flash"];for(let it=0;it<rt.length;it++){const at=rt[it];nt.hasOwnProperty(at)&&(this[at]=nt[at])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(nt){return this.foreground===nt.foreground&&this.underline===nt.underline&&this.italics===nt.italics&&this.background===nt.background&&this.flash===nt.flash}copy(nt){this.foreground=nt.foreground,this.underline=nt.underline,this.italics=nt.italics,this.background=nt.background,this.flash=nt.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class StyledUnicodeChar{constructor(){this.uchar=" ",this.penState=new PenState}reset(){this.uchar=" ",this.penState.reset()}setChar(nt,rt){this.uchar=nt,this.penState.copy(rt)}setPenState(nt){this.penState.copy(nt)}equals(nt){return this.uchar===nt.uchar&&this.penState.equals(nt.penState)}copy(nt){this.uchar=nt.uchar,this.penState.copy(nt.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class Row{constructor(nt){this.chars=[],this.pos=0,this.currPenState=new PenState,this.cueStartTime=null,this.logger=void 0;for(let nt=0;nt<Xa;nt++)this.chars.push(new StyledUnicodeChar);this.logger=nt}equals(nt){for(let rt=0;rt<Xa;rt++)if(!this.chars[rt].equals(nt.chars[rt]))return!1;return!0}copy(nt){for(let rt=0;rt<Xa;rt++)this.chars[rt].copy(nt.chars[rt])}isEmpty(){let nt=!0;for(let rt=0;rt<Xa;rt++)if(!this.chars[rt].isEmpty()){nt=!1;break}return nt}setCursor(nt){this.pos!==nt&&(this.pos=nt),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Xa&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Xa)}moveCursor(nt){const rt=this.pos+nt;if(nt>1)for(let nt=this.pos+1;nt<rt+1;nt++)this.chars[nt].setPenState(this.currPenState);this.setCursor(rt)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(nt){nt>=144&&this.backSpace();const rt=getCharForByte(nt);this.pos>=Xa?this.logger.log(0,(()=>"Cannot insert "+nt.toString(16)+" ("+rt+") at position "+this.pos+". Skipping it!")):(this.chars[this.pos].setChar(rt,this.currPenState),this.moveCursor(1))}clearFromPos(nt){let rt;for(rt=nt;rt<Xa;rt++)this.chars[rt].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const nt=[];let rt=!0;for(let it=0;it<Xa;it++){const at=this.chars[it].uchar;" "!==at&&(rt=!1),nt.push(at)}return rt?"":nt.join("")}setPenStyles(nt){this.currPenState.setStyles(nt);this.chars[this.pos].setPenState(this.currPenState)}}class CaptionScreen{constructor(nt){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let rt=0;rt<za;rt++)this.rows.push(new Row(nt));this.logger=nt}reset(){for(let nt=0;nt<za;nt++)this.rows[nt].clear();this.currRow=14}equals(nt){let rt=!0;for(let it=0;it<za;it++)if(!this.rows[it].equals(nt.rows[it])){rt=!1;break}return rt}copy(nt){for(let rt=0;rt<za;rt++)this.rows[rt].copy(nt.rows[rt])}isEmpty(){let nt=!0;for(let rt=0;rt<za;rt++)if(!this.rows[rt].isEmpty()){nt=!1;break}return nt}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(nt){this.rows[this.currRow].insertChar(nt)}setPen(nt){this.rows[this.currRow].setPenStyles(nt)}moveCursor(nt){this.rows[this.currRow].moveCursor(nt)}setCursor(nt){this.logger.log(2,"setCursor: "+nt);this.rows[this.currRow].setCursor(nt)}setPAC(nt){this.logger.log(2,(()=>"pacData = "+JSON.stringify(nt)));let rt=nt.row-1;if(this.nrRollUpRows&&rt<this.nrRollUpRows-1&&(rt=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==rt){for(let nt=0;nt<za;nt++)this.rows[nt].clear();const nt=this.currRow+1-this.nrRollUpRows,it=this.lastOutputScreen;if(it){const at=it.rows[nt].cueStartTime,st=this.logger.time;if(null!==at&&null!==st&&at<st)for(let at=0;at<this.nrRollUpRows;at++)this.rows[rt-this.nrRollUpRows+at+1].copy(it.rows[nt+at])}}this.currRow=rt;const it=this.rows[this.currRow];if(null!==nt.indent){const rt=nt.indent,at=Math.max(rt-1,0);it.setCursor(nt.indent),nt.color=it.chars[at].penState.foreground}const at={foreground:nt.color,underline:nt.underline,italics:nt.italics,background:"black",flash:!1};this.setPen(at)}setBkgData(nt){this.logger.log(2,(()=>"bkgData = "+JSON.stringify(nt))),this.backSpace(),this.setPen(nt),this.insertChar(32)}setRollUpRows(nt){this.nrRollUpRows=nt}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,(()=>this.getDisplayText()));const nt=this.currRow+1-this.nrRollUpRows,rt=this.rows.splice(nt,1)[0];rt.clear(),this.rows.splice(this.currRow,0,rt),this.logger.log(2,"Rolling up")}getDisplayText(nt){nt=nt||!1;const rt=[];let it="",at=-1;for(let it=0;it<za;it++){const st=this.rows[it].getTextString();st&&(at=it+1,nt?rt.push("Row "+at+": '"+st+"'"):rt.push(st.trim()))}return rt.length>0&&(it=nt?"["+rt.join(" | ")+"]":rt.join("\n")),it}getTextAndFormat(){return this.rows}}class Cea608Channel{constructor(nt,rt,it){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=nt,this.outputFilter=rt,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen(it),this.nonDisplayedMemory=new CaptionScreen(it),this.lastOutputScreen=new CaptionScreen(it),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=it}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(nt){this.outputFilter=nt}setPAC(nt){this.writeScreen.setPAC(nt)}setBkgData(nt){this.writeScreen.setBkgData(nt)}setMode(nt){nt!==this.mode&&(this.mode=nt,this.logger.log(2,(()=>"MODE="+nt)),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=nt)}insertChars(nt){for(let rt=0;rt<nt.length;rt++)this.writeScreen.insertChar(nt[rt]);const rt=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(()=>rt+": "+this.writeScreen.getDisplayText(!0))),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0))),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(nt){this.logger.log(2,"RU("+nt+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(nt)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const nt=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=nt,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(()=>"DISP: "+this.displayedMemory.getDisplayText()))}this.outputDataUpdate(!0)}ccTO(nt){this.logger.log(2,"TO("+nt+") - Tab Offset"),this.writeScreen.moveCursor(nt)}ccMIDROW(nt){const rt={flash:!1};if(rt.underline=nt%2==1,rt.italics=nt>=46,rt.italics)rt.foreground="white";else{const it=Math.floor(nt/2)-16,at=["white","green","blue","cyan","red","yellow","magenta"];rt.foreground=at[it]}this.logger.log(2,"MIDROW: "+JSON.stringify(rt)),this.writeScreen.setPen(rt)}outputDataUpdate(nt=!1){const rt=this.logger.time;null!==rt&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,rt,this.lastOutputScreen),nt&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:rt):this.cueStartTime=rt,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(nt){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,nt,this.displayedMemory),this.cueStartTime=nt))}}class Cea608Parser{constructor(nt,rt,it){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const at=this.logger=new CaptionsLogger;this.channels=[null,new Cea608Channel(nt,rt,at),new Cea608Channel(nt+1,it,at)]}getHandler(nt){return this.channels[nt].getHandler()}setHandler(nt,rt){this.channels[nt].setHandler(rt)}addData(nt,rt){this.logger.time=nt;for(let nt=0;nt<rt.length;nt+=2){const it=127&rt[nt],at=127&rt[nt+1];let st=!1,ot=null;if(0===it&&0===at)continue;this.logger.log(3,(()=>"["+is([rt[nt],rt[nt+1]])+"] -> ("+is([it,at])+")"));const lt=this.cmdHistory;if(it>=16&&it<=31){if(hasCmdRepeated(it,at,lt)){setLastCmd(null,null,lt),this.logger.log(3,(()=>"Repeated command ("+is([it,at])+") is dropped"));continue}setLastCmd(it,at,this.cmdHistory),st=this.parseCmd(it,at),st||(st=this.parseMidrow(it,at)),st||(st=this.parsePAC(it,at)),st||(st=this.parseBackgroundAttributes(it,at))}else setLastCmd(null,null,lt);if(!st&&(ot=this.parseChars(it,at),ot)){const nt=this.currentChannel;if(nt&&nt>0){this.channels[nt].insertChars(ot)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}st||ot||this.logger.log(2,(()=>"Couldn't parse cleaned data "+is([it,at])+" orig: "+is([rt[nt],rt[nt+1]])))}}parseCmd(nt,rt){if(!((20===nt||28===nt||21===nt||29===nt)&&rt>=32&&rt<=47)&&!((23===nt||31===nt)&&rt>=33&&rt<=35))return!1;const it=20===nt||21===nt||23===nt?1:2,at=this.channels[it];return 20===nt||21===nt||28===nt||29===nt?32===rt?at.ccRCL():33===rt?at.ccBS():34===rt?at.ccAOF():35===rt?at.ccAON():36===rt?at.ccDER():37===rt?at.ccRU(2):38===rt?at.ccRU(3):39===rt?at.ccRU(4):40===rt?at.ccFON():41===rt?at.ccRDC():42===rt?at.ccTR():43===rt?at.ccRTD():44===rt?at.ccEDM():45===rt?at.ccCR():46===rt?at.ccENM():47===rt&&at.ccEOC():at.ccTO(rt-32),this.currentChannel=it,!0}parseMidrow(nt,rt){let it=0;if((17===nt||25===nt)&&rt>=32&&rt<=47){if(it=17===nt?1:2,it!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const at=this.channels[it];return!!at&&(at.ccMIDROW(rt),this.logger.log(3,(()=>"MIDROW ("+is([nt,rt])+")")),!0)}return!1}parsePAC(nt,rt){let it;if(!((nt>=17&&nt<=23||nt>=25&&nt<=31)&&rt>=64&&rt<=127)&&!((16===nt||24===nt)&&rt>=64&&rt<=95))return!1;const at=nt<=23?1:2;it=rt>=64&&rt<=95?1===at?Ja[nt]:ts[nt]:1===at?es[nt]:ns[nt];const st=this.channels[at];return!!st&&(st.setPAC(this.interpretPAC(it,rt)),this.currentChannel=at,!0)}interpretPAC(nt,rt){let it;const at={color:null,italics:!1,indent:null,underline:!1,row:nt};return it=rt>95?rt-96:rt-64,at.underline=!(1&~it),it<=13?at.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(it/2)]:it<=15?(at.italics=!0,at.color="white"):at.indent=4*Math.floor((it-16)/2),at}parseChars(nt,rt){let it,at=null,st=null;if(nt>=25?(it=2,st=nt-8):(it=1,st=nt),st>=17&&st<=19){let nt;nt=17===st?rt+80:18===st?rt+112:rt+144,this.logger.log(2,(()=>"Special char '"+getCharForByte(nt)+"' in channel "+it)),at=[nt]}else nt>=32&&nt<=127&&(at=0===rt?[nt]:[nt,rt]);return at&&this.logger.log(3,(()=>"Char codes =  "+is(at).join(","))),at}parseBackgroundAttributes(nt,rt){if(!((16===nt||24===nt)&&rt>=32&&rt<=47)&&!((23===nt||31===nt)&&rt>=45&&rt<=47))return!1;let it;const at={};16===nt||24===nt?(it=Math.floor((rt-32)/2),at.background=rs[it],rt%2==1&&(at.background=at.background+"_semi")):45===rt?at.background="transparent":(at.foreground="black",47===rt&&(at.underline=!0));const st=nt<=23?1:2;return this.channels[st].setBkgData(at),!0}reset(){for(let nt=0;nt<Object.keys(this.channels).length;nt++){const rt=this.channels[nt];rt&&rt.reset()}setLastCmd(null,null,this.cmdHistory)}cueSplitAtTime(nt){for(let rt=0;rt<this.channels.length;rt++){const it=this.channels[rt];it&&it.cueSplitAtTime(nt)}}}function setLastCmd(nt,rt,it){it.a=nt,it.b=rt}function hasCmdRepeated(nt,rt,it){return it.a===nt&&it.b===rt}var as=function(){if(null!=Dr&&Dr.VTTCue)return self.VTTCue;const nt=["","lr","rl"],rt=["start","middle","end","left","right"];function isAllowedValue(nt,rt){if("string"!=typeof rt)return!1;if(!Array.isArray(nt))return!1;const it=rt.toLowerCase();return!!~nt.indexOf(it)&&it}function findAlignSetting(nt){return isAllowedValue(rt,nt)}function extend(nt,...rt){let it=1;for(;it<arguments.length;it++){const rt=arguments[it];for(const it in rt)nt[it]=rt[it]}return nt}function VTTCue(rt,it,at){const st=this,ot={enumerable:!0};st.hasBeenReset=!1;let lt="",ut=!1,ct=rt,dt=it,ht=at,pt=null,_t="",Et=!0,St="auto",wt="start",Lt=50,Ct="middle",Pt=50,kt="middle";Object.defineProperty(st,"id",extend({},ot,{get:function(){return lt},set:function(nt){lt=""+nt}})),Object.defineProperty(st,"pauseOnExit",extend({},ot,{get:function(){return ut},set:function(nt){ut=!!nt}})),Object.defineProperty(st,"startTime",extend({},ot,{get:function(){return ct},set:function(nt){if("number"!=typeof nt)throw new TypeError("Start time must be set to a number.");ct=nt,this.hasBeenReset=!0}})),Object.defineProperty(st,"endTime",extend({},ot,{get:function(){return dt},set:function(nt){if("number"!=typeof nt)throw new TypeError("End time must be set to a number.");dt=nt,this.hasBeenReset=!0}})),Object.defineProperty(st,"text",extend({},ot,{get:function(){return ht},set:function(nt){ht=""+nt,this.hasBeenReset=!0}})),Object.defineProperty(st,"region",extend({},ot,{get:function(){return pt},set:function(nt){pt=nt,this.hasBeenReset=!0}})),Object.defineProperty(st,"vertical",extend({},ot,{get:function(){return _t},set:function(rt){const it=function findDirectionSetting(rt){return isAllowedValue(nt,rt)}(rt);if(!1===it)throw new SyntaxError("An invalid or illegal string was specified.");_t=it,this.hasBeenReset=!0}})),Object.defineProperty(st,"snapToLines",extend({},ot,{get:function(){return Et},set:function(nt){Et=!!nt,this.hasBeenReset=!0}})),Object.defineProperty(st,"line",extend({},ot,{get:function(){return St},set:function(nt){if("number"!=typeof nt&&"auto"!==nt)throw new SyntaxError("An invalid number or illegal string was specified.");St=nt,this.hasBeenReset=!0}})),Object.defineProperty(st,"lineAlign",extend({},ot,{get:function(){return wt},set:function(nt){const rt=findAlignSetting(nt);if(!rt)throw new SyntaxError("An invalid or illegal string was specified.");wt=rt,this.hasBeenReset=!0}})),Object.defineProperty(st,"position",extend({},ot,{get:function(){return Lt},set:function(nt){if(nt<0||nt>100)throw new Error("Position must be between 0 and 100.");Lt=nt,this.hasBeenReset=!0}})),Object.defineProperty(st,"positionAlign",extend({},ot,{get:function(){return Ct},set:function(nt){const rt=findAlignSetting(nt);if(!rt)throw new SyntaxError("An invalid or illegal string was specified.");Ct=rt,this.hasBeenReset=!0}})),Object.defineProperty(st,"size",extend({},ot,{get:function(){return Pt},set:function(nt){if(nt<0||nt>100)throw new Error("Size must be between 0 and 100.");Pt=nt,this.hasBeenReset=!0}})),Object.defineProperty(st,"align",extend({},ot,{get:function(){return kt},set:function(nt){const rt=findAlignSetting(nt);if(!rt)throw new SyntaxError("An invalid or illegal string was specified.");kt=rt,this.hasBeenReset=!0}})),st.displayState=void 0}return VTTCue.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},VTTCue}();class StringDecoder{decode(nt,rt){if(!nt)return"";if("string"!=typeof nt)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(nt))}}function parseTimeStamp(nt){function computeSeconds(nt,rt,it,at){return 3600*(0|nt)+60*(0|rt)+(0|it)+parseFloat(at||0)}const rt=nt.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return rt?parseFloat(rt[2])>59?computeSeconds(rt[2],rt[3],0,rt[4]):computeSeconds(rt[1],rt[2],rt[3],rt[4]):null}class Settings{constructor(){this.values=Object.create(null)}set(nt,rt){this.get(nt)||""===rt||(this.values[nt]=rt)}get(nt,rt,it){return it?this.has(nt)?this.values[nt]:rt[it]:this.has(nt)?this.values[nt]:rt}has(nt){return nt in this.values}alt(nt,rt,it){for(let at=0;at<it.length;++at)if(rt===it[at]){this.set(nt,rt);break}}integer(nt,rt){/^-?\d+$/.test(rt)&&this.set(nt,parseInt(rt,10))}percent(nt,rt){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(rt)){const it=parseFloat(rt);if(it>=0&&it<=100)return this.set(nt,it),!0}return!1}}function parseOptions(nt,rt,it,at){const st=at?nt.split(at):[nt];for(const nt in st){if("string"!=typeof st[nt])continue;const at=st[nt].split(it);if(2!==at.length)continue;rt(at[0],at[1])}}const ss=new as(0,0,""),os="middle"===ss.align?"middle":"center";function parseCue(nt,rt,it){const at=nt;function consumeTimeStamp(){const rt=parseTimeStamp(nt);if(null===rt)throw new Error("Malformed timestamp: "+at);return nt=nt.replace(/^[^\sa-zA-Z-]+/,""),rt}function skipWhitespace(){nt=nt.replace(/^\s+/,"")}if(skipWhitespace(),rt.startTime=consumeTimeStamp(),skipWhitespace(),"--\x3e"!==nt.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+at);nt=nt.slice(3),skipWhitespace(),rt.endTime=consumeTimeStamp(),skipWhitespace(),function consumeCueSettings(nt,rt){const at=new Settings;parseOptions(nt,(function(nt,rt){let st;switch(nt){case"region":for(let st=it.length-1;st>=0;st--)if(it[st].id===rt){at.set(nt,it[st].region);break}break;case"vertical":at.alt(nt,rt,["rl","lr"]);break;case"line":st=rt.split(","),at.integer(nt,st[0]),at.percent(nt,st[0])&&at.set("snapToLines",!1),at.alt(nt,st[0],["auto"]),2===st.length&&at.alt("lineAlign",st[1],["start",os,"end"]);break;case"position":st=rt.split(","),at.percent(nt,st[0]),2===st.length&&at.alt("positionAlign",st[1],["start",os,"end","line-left","line-right","auto"]);break;case"size":at.percent(nt,rt);break;case"align":at.alt(nt,rt,["start",os,"end","left","right"])}}),/:/,/\s/),rt.region=at.get("region",null),rt.vertical=at.get("vertical","");let st=at.get("line","auto");"auto"===st&&-1===ss.line&&(st=-1),rt.line=st,rt.lineAlign=at.get("lineAlign","start"),rt.snapToLines=at.get("snapToLines",!0),rt.size=at.get("size",100),rt.align=at.get("align",os);let ot=at.get("position","auto");"auto"===ot&&50===ss.position&&(ot="start"===rt.align||"left"===rt.align?0:"end"===rt.align||"right"===rt.align?100:50),rt.position=ot}(nt,rt)}function fixLineBreaks(nt){return nt.replace(/<br(?: \/)?>/gi,"\n")}class VTTParser{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(nt){const rt=this;function collectNextLine(){let nt=rt.buffer,it=0;for(nt=fixLineBreaks(nt);it<nt.length&&"\r"!==nt[it]&&"\n"!==nt[it];)++it;const at=nt.slice(0,it);return"\r"===nt[it]&&++it,"\n"===nt[it]&&++it,rt.buffer=nt.slice(it),at}nt&&(rt.buffer+=rt.decoder.decode(nt,{stream:!0}));try{let nt="";if("INITIAL"===rt.state){if(!/\r\n|\n/.test(rt.buffer))return this;nt=collectNextLine();const it=nt.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==it||!it[0])throw new Error("Malformed WebVTT signature.");rt.state="HEADER"}let it=!1;for(;rt.buffer;){if(!/\r\n|\n/.test(rt.buffer))return this;switch(it?it=!1:nt=collectNextLine(),rt.state){case"HEADER":/:/.test(nt)?parseOptions(nt,(function(nt,rt){}),/:/):nt||(rt.state="ID");continue;case"NOTE":nt||(rt.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(nt)){rt.state="NOTE";break}if(!nt)continue;if(rt.cue=new as(0,0,""),rt.state="CUE",-1===nt.indexOf("--\x3e")){rt.cue.id=nt;continue}case"CUE":if(!rt.cue){rt.state="BADCUE";continue}try{parseCue(nt,rt.cue,rt.regionList)}catch(nt){rt.cue=null,rt.state="BADCUE";continue}rt.state="CUETEXT";continue;case"CUETEXT":{const at=-1!==nt.indexOf("--\x3e");if(!nt||at&&(it=!0)){rt.oncue&&rt.cue&&rt.oncue(rt.cue),rt.cue=null,rt.state="ID";continue}if(null===rt.cue)continue;rt.cue.text&&(rt.cue.text+="\n"),rt.cue.text+=nt}continue;case"BADCUE":nt||(rt.state="ID")}}}catch(nt){"CUETEXT"===rt.state&&rt.cue&&rt.oncue&&rt.oncue(rt.cue),rt.cue=null,rt.state="INITIAL"===rt.state?"BADWEBVTT":"BADCUE"}return this}flush(){const nt=this;try{if((nt.cue||"HEADER"===nt.state)&&(nt.buffer+="\n\n",nt.parse()),"INITIAL"===nt.state||"BADWEBVTT"===nt.state)throw new Error("Malformed WebVTT signature.")}catch(rt){nt.onparsingerror&&nt.onparsingerror(rt)}return nt.onflush&&nt.onflush(),this}}const ls=/\r\n|\n\r|\n|\r/g,us=function startsWith(nt,rt,it=0){return nt.slice(it,it+rt.length)===rt};function generateCueId(nt,rt,it){return hash(nt.toString())+hash(rt.toString())+hash(it)}function parseWebVTT(nt,rt,it,at,st,ot,lt){const ut=new VTTParser,ct=utf8ArrayToStr(new Uint8Array(nt)).trim().replace(ls,"\n").split("\n"),dt=[],ht=rt?function toMpegTsClockFromTimescale(nt,rt=1){return toTimescaleFromBase(nt,ta,1/rt)}(rt.baseTime,rt.timescale):0;let pt,_t="00:00.000",Et=0,St=0,Lt=!0;ut.oncue=function(nt){const ot=it[at];let lt=it.ccOffset;const ut=(Et-ht)/9e4;if(null!=ot&&ot.new&&(void 0!==St?lt=it.ccOffset=ot.start:function calculateOffset(nt,rt,it){let at=nt[rt],st=nt[at.prevCC];if(!st||!st.new&&at.new)return nt.ccOffset=nt.presentationOffset=at.start,void(at.new=!1);for(;null!=(ot=st)&&ot.new;){var ot;nt.ccOffset+=at.start-st.start,at.new=!1,at=st,st=nt[at.prevCC]}nt.presentationOffset=it}(it,at,ut)),ut){if(!rt)return void(pt=new Error("Missing initPTS for VTT MPEGTS"));lt=ut-it.presentationOffset}const ct=nt.endTime-nt.startTime,_t=normalizePts(9e4*(nt.startTime+lt-St),9e4*st)/9e4;nt.startTime=Math.max(_t,0),nt.endTime=Math.max(_t+ct,0);const wt=nt.text.trim();nt.text=decodeURIComponent(encodeURIComponent(wt)),nt.id||(nt.id=generateCueId(nt.startTime,nt.endTime,wt)),nt.endTime>0&&dt.push(nt)},ut.onparsingerror=function(nt){pt=nt},ut.onflush=function(){pt?lt(pt):ot(dt)},ct.forEach((nt=>{if(Lt){if(us(nt,"X-TIMESTAMP-MAP=")){Lt=!1,nt.slice(16).split(",").forEach((nt=>{us(nt,"LOCAL:")?_t=nt.slice(6):us(nt,"MPEGTS:")&&(Et=parseInt(nt.slice(7)))}));try{St=function cueString2millis(nt){let rt=parseInt(nt.slice(-3));const it=parseInt(nt.slice(-6,-4)),at=parseInt(nt.slice(-9,-7)),st=nt.length>9?parseInt(nt.substring(0,nt.indexOf(":"))):0;if(!(wt(rt)&&wt(it)&&wt(at)&&wt(st)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${nt}`);return rt+=1e3*it,rt+=6e4*at,rt+=36e5*st,rt}(_t)/1e3}catch(nt){pt=nt}return}""===nt&&(Lt=!1)}ut.parse(nt+"\n")})),ut.flush()}const cs="stpp.ttml.im1t",ds=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,hs=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,fs={left:"start",center:"center",right:"end",start:"start",end:"end"};function parseIMSC1(nt,rt,it,at){const st=findBox(new Uint8Array(nt),["mdat"]);if(0===st.length)return void at(new Error("Could not parse IMSC1 mdat"));const ot=st.map((nt=>utf8ArrayToStr(nt))),lt=function toTimescaleFromScale(nt,rt,it=1,at=!1){return toTimescaleFromBase(nt,rt,1/it,at)}(rt.baseTime,1,rt.timescale);try{ot.forEach((nt=>it(function parseTTML(nt,rt){const it=(new DOMParser).parseFromString(nt,"text/xml"),at=it.getElementsByTagName("tt")[0];if(!at)throw new Error("Invalid ttml");const st={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},ot=Object.keys(st).reduce(((nt,rt)=>(nt[rt]=at.getAttribute(`ttp:${rt}`)||st[rt],nt)),{}),lt="preserve"!==at.getAttribute("xml:space"),ut=collectionToDictionary(getElementCollection(at,"styling","style")),ct=collectionToDictionary(getElementCollection(at,"layout","region")),dt=getElementCollection(at,"body","[begin]");return[].map.call(dt,(nt=>{const it=getTextContent(nt,lt);if(!it||!nt.hasAttribute("begin"))return null;const at=parseTtmlTime(nt.getAttribute("begin"),ot),st=parseTtmlTime(nt.getAttribute("dur"),ot);let dt=parseTtmlTime(nt.getAttribute("end"),ot);if(null===at)throw timestampParsingError(nt);if(null===dt){if(null===st)throw timestampParsingError(nt);dt=at+st}const ht=new as(at-rt,dt-rt,it);ht.id=generateCueId(ht.startTime,ht.endTime,ht.text);const pt=function getTtmlStyles(nt,rt,it){const at="http://www.w3.org/ns/ttml#styling";let st=null;const ot=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],lt=null!=nt&&nt.hasAttribute("style")?nt.getAttribute("style"):null;lt&&it.hasOwnProperty(lt)&&(st=it[lt]);return ot.reduce(((it,ot)=>{const lt=getAttributeNS(rt,at,ot)||getAttributeNS(nt,at,ot)||getAttributeNS(st,at,ot);return lt&&(it[ot]=lt),it}),{})}(ct[nt.getAttribute("region")],ut[nt.getAttribute("style")],ut),{textAlign:_t}=pt;if(_t){const nt=fs[_t];nt&&(ht.lineAlign=nt),ht.align=_t}return _extends(ht,pt),ht})).filter((nt=>null!==nt))}(nt,lt))))}catch(nt){at(nt)}}function getElementCollection(nt,rt,it){const at=nt.getElementsByTagName(rt)[0];return at?[].slice.call(at.querySelectorAll(it)):[]}function collectionToDictionary(nt){return nt.reduce(((nt,rt)=>{const it=rt.getAttribute("xml:id");return it&&(nt[it]=rt),nt}),{})}function getTextContent(nt,rt){return[].slice.call(nt.childNodes).reduce(((nt,it,at)=>{var st;return"br"===it.nodeName&&at?nt+"\n":null!=(st=it.childNodes)&&st.length?getTextContent(it,rt):rt?nt+it.textContent.trim().replace(/\s+/g," "):nt+it.textContent}),"")}function getAttributeNS(nt,rt,it){return nt&&nt.hasAttributeNS(rt,it)?nt.getAttributeNS(rt,it):null}function timestampParsingError(nt){return new Error(`Could not parse ttml timestamp ${nt}`)}function parseTtmlTime(nt,rt){if(!nt)return null;let it=parseTimeStamp(nt);return null===it&&(ds.test(nt)?it=function parseHoursMinutesSecondsFrames(nt,rt){const it=ds.exec(nt),at=(0|it[4])+(0|it[5])/rt.subFrameRate;return 3600*(0|it[1])+60*(0|it[2])+(0|it[3])+at/rt.frameRate}(nt,rt):hs.test(nt)&&(it=function parseTimeUnits(nt,rt){const it=hs.exec(nt),at=Number(it[1]);switch(it[2]){case"h":return 3600*at;case"m":return 60*at;case"ms":return 1e3*at;case"f":return at/rt.frameRate;case"t":return at/rt.tickRate}return at}(nt,rt))),it}class OutputFilter{constructor(nt,rt){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=nt,this.trackName=rt}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(nt,rt,it){(null===this.startTime||this.startTime>nt)&&(this.startTime=nt),this.endTime=rt,this.screen=it,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}function captionsOrSubtitlesFromCharacteristics(nt){return nt.characteristics&&/transcribes-spoken-dialog/gi.test(nt.characteristics)&&/describes-music-and-sound/gi.test(nt.characteristics)?"captions":"subtitles"}function canReuseVttTextTrack(nt,rt){return!!nt&&nt.kind===captionsOrSubtitlesFromCharacteristics(rt)&&subtitleTrackMatchesTextTrack(rt,nt)}const ps=/\s/,ms={newCue(nt,rt,it,at){const st=[];let ot,lt,ut,ct,dt;const ht=self.VTTCue||self.TextTrackCue;for(let _t=0;_t<at.rows.length;_t++)if(ot=at.rows[_t],ut=!0,ct=0,dt="",!ot.isEmpty()){var pt;for(let nt=0;nt<ot.chars.length;nt++)ps.test(ot.chars[nt].uchar)&&ut?ct++:(dt+=ot.chars[nt].uchar,ut=!1);ot.cueStartTime=rt,rt===it&&(it+=1e-4),ct>=16?ct--:ct++;const at=fixLineBreaks(dt.trim()),Et=generateCueId(rt,it,at);null!=nt&&null!=(pt=nt.cues)&&pt.getCueById(Et)||(lt=new ht(rt,it,at),lt.id=Et,lt.line=_t+1,lt.align="left",lt.position=10+Math.min(80,10*Math.floor(8*ct/32)),st.push(lt))}return nt&&st.length&&(st.sort(((nt,rt)=>"auto"===nt.line||"auto"===rt.line?0:nt.line>8&&rt.line>8?rt.line-nt.line:nt.line-rt.line)),st.forEach((rt=>addCueToTrack(nt,rt)))),st}};const gs=/(\d+)-(\d+)\/(\d+)/;class FetchLoader{constructor(nt){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=nt.fetchSetup||getRequest,this.controller=new self.AbortController,this.stats=new LoadStats}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var nt;this.abortInternal(),null!=(nt=this.callbacks)&&nt.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(nt,rt,it){const at=this.stats;if(at.loading.start)throw new Error("Loader can only be used once.");at.loading.start=self.performance.now();const st=function getRequestParameters(nt,rt){const it={method:"GET",mode:"cors",credentials:"same-origin",signal:rt,headers:new self.Headers(_extends({},nt.headers))};nt.rangeEnd&&it.headers.set("Range","bytes="+nt.rangeStart+"-"+String(nt.rangeEnd-1));return it}(nt,this.controller.signal),ot=it.onProgress,lt="arraybuffer"===nt.responseType,ut=lt?"byteLength":"length",{maxTimeToFirstByteMs:ct,maxLoadTimeMs:dt}=rt.loadPolicy;this.context=nt,this.config=rt,this.callbacks=it,this.request=this.fetchSetup(nt,st),self.clearTimeout(this.requestTimeout),rt.timeout=ct&&wt(ct)?ct:dt,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),it.onTimeout(at,nt,this.response)}),rt.timeout);(isPromise(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then((st=>{this.response=this.loader=st;const ut=Math.max(self.performance.now(),at.loading.start);if(self.clearTimeout(this.requestTimeout),rt.timeout=dt,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),it.onTimeout(at,nt,this.response)}),dt-(ut-at.loading.start)),!st.ok){const{status:nt,statusText:rt}=st;throw new FetchError(rt||"fetch, bad network response",nt,st)}return at.loading.first=ut,at.total=function getContentLength(nt){const rt=nt.get("Content-Range");if(rt){const nt=function getByteRangeLength(nt){const rt=gs.exec(nt);if(rt)return parseInt(rt[2])-parseInt(rt[1])+1}(rt);if(wt(nt))return nt}const it=nt.get("Content-Length");if(it)return parseInt(it)}(st.headers)||at.total,ot&&wt(rt.highWaterMark)?this.loadProgressively(st,at,nt,rt.highWaterMark,ot):lt?st.arrayBuffer():"json"===nt.responseType?st.json():st.text()})).then((st=>{const lt=this.response;if(!lt)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),at.loading.end=Math.max(self.performance.now(),at.loading.first);const ct=st[ut];ct&&(at.loaded=at.total=ct);const dt={url:lt.url,data:st,code:lt.status};ot&&!wt(rt.highWaterMark)&&ot(at,nt,st,lt),it.onSuccess(dt,at,nt,lt)})).catch((rt=>{if(self.clearTimeout(this.requestTimeout),at.aborted)return;const st=rt&&rt.code||0,ot=rt?rt.message:null;it.onError({code:st,text:ot},nt,rt?rt.details:null,at)}))}getCacheAge(){let nt=null;if(this.response){const rt=this.response.headers.get("age");nt=rt?parseFloat(rt):null}return nt}getResponseHeader(nt){return this.response?this.response.headers.get(nt):null}loadProgressively(nt,rt,it,at=0,st){const ot=new ChunkCache,lt=nt.body.getReader(),pump=()=>lt.read().then((lt=>{if(lt.done)return ot.dataLength&&st(rt,it,ot.flush(),nt),Promise.resolve(new ArrayBuffer(0));const ut=lt.value,ct=ut.length;return rt.loaded+=ct,ct<at||ot.dataLength?(ot.push(ut),ot.dataLength>=at&&st(rt,it,ot.flush(),nt)):st(rt,it,ut,nt),pump()})).catch((()=>Promise.reject()));return pump()}}function getRequest(nt,rt){return new self.Request(nt.url,rt)}class FetchError extends Error{constructor(nt,rt,it){super(nt),this.code=void 0,this.details=void 0,this.code=rt,this.details=it}}const _s=/^age:\s*[\d.]+\s*$/im;class XhrLoader{constructor(nt){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=nt&&nt.xhrSetup||null,this.stats=new LoadStats,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const nt=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),nt&&(nt.onreadystatechange=null,nt.onprogress=null,4!==nt.readyState&&(this.stats.aborted=!0,nt.abort()))}abort(){var nt;this.abortInternal(),null!=(nt=this.callbacks)&&nt.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(nt,rt,it){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=nt,this.config=rt,this.callbacks=it,this.loadInternal()}loadInternal(){const{config:nt,context:rt}=this;if(!nt||!rt)return;const it=this.loader=new self.XMLHttpRequest,at=this.stats;at.loading.first=0,at.loaded=0,at.aborted=!1;const st=this.xhrSetup;st?Promise.resolve().then((()=>{if(this.loader===it&&!this.stats.aborted)return st(it,rt.url)})).catch((nt=>{if(this.loader===it&&!this.stats.aborted)return it.open("GET",rt.url,!0),st(it,rt.url)})).then((()=>{this.loader!==it||this.stats.aborted||this.openAndSendXhr(it,rt,nt)})).catch((nt=>{this.callbacks.onError({code:it.status,text:nt.message},rt,it,at)})):this.openAndSendXhr(it,rt,nt)}openAndSendXhr(nt,rt,it){nt.readyState||nt.open("GET",rt.url,!0);const at=rt.headers,{maxTimeToFirstByteMs:st,maxLoadTimeMs:ot}=it.loadPolicy;if(at)for(const rt in at)nt.setRequestHeader(rt,at[rt]);rt.rangeEnd&&nt.setRequestHeader("Range","bytes="+rt.rangeStart+"-"+(rt.rangeEnd-1)),nt.onreadystatechange=this.readystatechange.bind(this),nt.onprogress=this.loadprogress.bind(this),nt.responseType=rt.responseType,self.clearTimeout(this.requestTimeout),it.timeout=st&&wt(st)?st:ot,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),it.timeout),nt.send()}readystatechange(){const{context:nt,loader:rt,stats:it}=this;if(!nt||!rt)return;const at=rt.readyState,st=this.config;if(!it.aborted&&at>=2&&(0===it.loading.first&&(it.loading.first=Math.max(self.performance.now(),it.loading.start),st.timeout!==st.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),st.timeout=st.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),st.loadPolicy.maxLoadTimeMs-(it.loading.first-it.loading.start)))),4===at)){self.clearTimeout(this.requestTimeout),rt.onreadystatechange=null,rt.onprogress=null;const at=rt.status,ot="text"!==rt.responseType;if(at>=200&&at<300&&(ot&&rt.response||null!==rt.responseText)){it.loading.end=Math.max(self.performance.now(),it.loading.first);const st=ot?rt.response:rt.responseText,lt="arraybuffer"===rt.responseType?st.byteLength:st.length;if(it.loaded=it.total=lt,it.bwEstimate=8e3*it.total/(it.loading.end-it.loading.first),!this.callbacks)return;const ut=this.callbacks.onProgress;if(ut&&ut(it,nt,st,rt),!this.callbacks)return;const ct={url:rt.responseURL,data:st,code:at};this.callbacks.onSuccess(ct,it,nt,rt)}else{const ot=st.loadPolicy.errorRetry;shouldRetry(ot,it.retry,!1,{url:nt.url,data:void 0,code:at})?this.retry(ot):(Qt.error(`${at} while loading ${nt.url}`),this.callbacks.onError({code:at,text:rt.statusText},nt,rt,it))}}}loadtimeout(){if(!this.config)return;const nt=this.config.loadPolicy.timeoutRetry;if(shouldRetry(nt,this.stats.retry,!0))this.retry(nt);else{var rt;Qt.warn(`timeout while loading ${null==(rt=this.context)?void 0:rt.url}`);const nt=this.callbacks;nt&&(this.abortInternal(),nt.onTimeout(this.stats,this.context,this.loader))}}retry(nt){const{context:rt,stats:it}=this;this.retryDelay=getRetryDelay(nt,it.retry),it.retry++,Qt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==rt?void 0:rt.url}, retrying ${it.retry}/${nt.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(nt){const rt=this.stats;rt.loaded=nt.loaded,nt.lengthComputable&&(rt.total=nt.total)}getCacheAge(){let nt=null;if(this.loader&&_s.test(this.loader.getAllResponseHeaders())){const rt=this.loader.getResponseHeader("age");nt=rt?parseFloat(rt):null}return nt}getResponseHeader(nt){return this.loader&&new RegExp(`^${nt}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(nt):null}}const ys=_objectSpread2(_objectSpread2({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:XhrLoader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class AbrController extends Logger{constructor(nt){super("abr",nt.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{var nt;const{fragCurrent:rt,partCurrent:it,hls:at}=this,{autoLevelEnabled:st,media:ot}=at;if(!rt||!ot)return;const lt=performance.now(),ut=it?it.stats:rt.stats,ct=it?it.duration:rt.duration,dt=lt-ut.loading.start,ht=at.minAutoLevel;if(ut.aborted||ut.loaded&&ut.loaded===ut.total||rt.level<=ht)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!st||ot.paused||!ot.playbackRate||!ot.readyState)return;const pt=at.mainForwardBufferInfo;if(null===pt)return;const _t=this.bwEstimator.getEstimateTTFB(),Et=Math.abs(ot.playbackRate);if(dt<=Math.max(_t,ct/(2*Et)*1e3))return;const St=pt.len/Et,Lt=ut.loading.first?ut.loading.first-ut.loading.start:-1,Ct=ut.loaded&&Lt>-1,Pt=this.getBwEstimate(),kt=at.levels,Ft=kt[rt.level],Bt=ut.total||Math.max(ut.loaded,Math.round(ct*Ft.averageBitrate/8));let Ut=Ct?dt-Lt:dt;Ut<1&&Ct&&(Ut=Math.min(dt,8*ut.loaded/Pt));const Gt=Ct?1e3*ut.loaded/Ut:0,Ht=_t/1e3,jt=Gt?(Bt-ut.loaded)/Gt:8*Bt/Pt+Ht;if(jt<=St)return;const Kt=Gt?8*Gt:Pt,$t=!0===(null==(nt=this.hls.latestLevelDetails)?void 0:nt.live),Yt=this.hls.config.abrBandWidthUpFactor;let Wt,Qt=Number.POSITIVE_INFINITY;for(Wt=rt.level-1;Wt>ht;Wt--){const nt=kt[Wt].maxBitrate,rt=!kt[Wt].details||$t;if(Qt=this.getTimeToLoadFrag(Ht,Kt,ct*nt,rt),Qt<Math.min(St,ct+Ht))break}if(Qt>=jt)return;if(Qt>10*ct)return;Ct?this.bwEstimator.sample(dt-Math.min(_t,Lt),ut.loaded):this.bwEstimator.sampleTTFB(dt);const en=kt[Wt].maxBitrate;this.getBwEstimate()*Yt>en&&this.resetEstimator(en);const nn=this.findBestLevel(en,ht,Wt,0,St,1,1);nn>-1&&(Wt=nn),this.warn(`Fragment ${rt.sn}${it?" part "+it.index:""} of level ${rt.level} is loading too slowly;\n      Fragment duration: ${rt.duration.toFixed(3)}\n      Time to underbuffer: ${St.toFixed(3)} s\n      Estimated load time for current fragment: ${jt.toFixed(3)} s\n      Estimated load time for down switch fragment: ${Qt.toFixed(3)} s\n      TTFB estimate: ${0|Lt} ms\n      Current BW estimate: ${wt(Pt)?0|Pt:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${Wt} @ ${0|en} bps`),at.nextLoadLevel=at.nextAutoLevel=Wt,this.clearTimer(),this.timer=self.setInterval((()=>{if(this.clearTimer(),this.fragCurrent===rt&&this.hls.loadLevel===Wt&&Wt>0){const nt=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${Wt>0?"and switching down":""}\n      Fragment duration: ${rt.duration.toFixed(3)} s\n      Time to underbuffer: ${nt.toFixed(3)} s`),rt.abortRequests(),this.fragCurrent=this.partCurrent=null,Wt>ht){let rt=this.findBestLevel(this.hls.levels[ht].bitrate,ht,Wt,0,nt,1,1);-1===rt&&(rt=ht),this.hls.nextLoadLevel=this.hls.nextAutoLevel=rt,this.resetEstimator(this.hls.levels[rt].bitrate)}}}),1e3*Qt),at.trigger(Ot.FRAG_LOAD_EMERGENCY_ABORTED,{frag:rt,part:it,stats:ut})},this.hls=nt,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(nt){nt&&(this.log(`setting initial bwe to ${nt}`),this.hls.config.abrEwmaDefaultEstimate=nt),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const nt=this.hls.config;return new EwmaBandWidthEstimator(nt.abrEwmaSlowVoD,nt.abrEwmaFastVoD,nt.abrEwmaDefaultEstimate)}registerListeners(){const{hls:nt}=this;nt.on(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.on(Ot.FRAG_LOADING,this.onFragLoading,this),nt.on(Ot.FRAG_LOADED,this.onFragLoaded,this),nt.on(Ot.FRAG_BUFFERED,this.onFragBuffered,this),nt.on(Ot.LEVEL_SWITCHING,this.onLevelSwitching,this),nt.on(Ot.LEVEL_LOADED,this.onLevelLoaded,this),nt.on(Ot.LEVELS_UPDATED,this.onLevelsUpdated,this),nt.on(Ot.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),nt.on(Ot.ERROR,this.onError,this)}unregisterListeners(){const{hls:nt}=this;nt&&(nt.off(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.off(Ot.FRAG_LOADING,this.onFragLoading,this),nt.off(Ot.FRAG_LOADED,this.onFragLoaded,this),nt.off(Ot.FRAG_BUFFERED,this.onFragBuffered,this),nt.off(Ot.LEVEL_SWITCHING,this.onLevelSwitching,this),nt.off(Ot.LEVEL_LOADED,this.onLevelLoaded,this),nt.off(Ot.LEVELS_UPDATED,this.onLevelsUpdated,this),nt.off(Ot.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),nt.off(Ot.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(nt,rt){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(nt,rt){const it=rt.frag;if(!this.ignoreFragment(it)){var at;if(!it.bitrateTest)this.fragCurrent=it,this.partCurrent=null!=(at=rt.part)?at:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(nt,rt){this.clearTimer()}onError(nt,rt){if(!rt.fatal)switch(rt.details){case kt.BUFFER_ADD_CODEC_ERROR:case kt.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case kt.FRAG_LOAD_TIMEOUT:{const nt=rt.frag,{fragCurrent:it,partCurrent:at}=this;if(nt&&it&&nt.sn===it.sn&&nt.level===it.level){const rt=performance.now(),it=at?at.stats:nt.stats,st=rt-it.loading.start,ot=it.loading.first?it.loading.first-it.loading.start:-1;if(it.loaded&&ot>-1){const nt=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(st-Math.min(nt,ot),it.loaded)}else this.bwEstimator.sampleTTFB(st)}break}}}getTimeToLoadFrag(nt,rt,it,at){return nt+it/rt+(at?this.lastLevelLoadSec:0)}onLevelLoaded(nt,rt){const it=this.hls.config,{loading:at}=rt.stats,st=at.end-at.start;wt(st)&&(this.lastLevelLoadSec=st/1e3),rt.details.live?this.bwEstimator.update(it.abrEwmaSlowLive,it.abrEwmaFastLive):this.bwEstimator.update(it.abrEwmaSlowVoD,it.abrEwmaFastVoD)}onFragLoaded(nt,{frag:rt,part:it}){const at=it?it.stats:rt.stats;if(rt.type===Ht&&this.bwEstimator.sampleTTFB(at.loading.first-at.loading.start),!this.ignoreFragment(rt)){if(this.clearTimer(),rt.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const nt=it?it.duration:rt.duration,st=this.hls.levels[rt.level],ot=(st.loaded?st.loaded.bytes:0)+at.loaded,lt=(st.loaded?st.loaded.duration:0)+nt;st.loaded={bytes:ot,duration:lt},st.realBitrate=Math.round(8*ot/lt)}if(rt.bitrateTest){const nt={stats:at,frag:rt,part:it,id:rt.type};this.onFragBuffered(Ot.FRAG_BUFFERED,nt),rt.bitrateTest=!1}else this.lastLoadedFragLevel=rt.level}}onFragBuffered(nt,rt){const{frag:it,part:at}=rt,st=null!=at&&at.stats.loaded?at.stats:it.stats;if(st.aborted)return;if(this.ignoreFragment(it))return;const ot=st.parsing.end-st.loading.start-Math.min(st.loading.first-st.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(ot,st.loaded),st.bwEstimate=this.getBwEstimate(),it.bitrateTest?this.bitrateTestDelay=ot/1e3:this.bitrateTestDelay=0}ignoreFragment(nt){return nt.type!==Ht||"initSegment"===nt.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:nt,minAutoLevel:rt}=this.hls,it=this.getBwEstimate(),at=this.hls.config.maxStarvationDelay,st=this.findBestLevel(it,rt,nt,0,at,1,1);if(st>-1)return st;const ot=this.hls.firstLevel,lt=Math.min(Math.max(ot,rt),nt);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${ot} clamped to ${lt}`),lt}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const nt=this.forcedAutoLevel,rt=this.bwEstimator.canEstimate(),it=this.lastLoadedFragLevel>-1;if(!(-1===nt||rt&&it&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return nt;const at=rt&&it?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==nt){const rt=this.hls.levels;if(rt.length>Math.max(nt,at)&&rt[nt].loadError<=rt[at].loadError)return nt}return this._nextAutoLevel=at,this.nextAutoLevelKey=this.getAutoLevelKey(),at}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:nt,partCurrent:rt,hls:it}=this;if(it.levels.length<=1)return it.loadLevel;const{maxAutoLevel:at,config:st,minAutoLevel:ot}=it,lt=rt?rt.duration:nt?nt.duration:0,ut=this.getBwEstimate(),ct=this.getStarvationDelay();let dt=st.abrBandWidthFactor,ht=st.abrBandWidthUpFactor;if(ct){const nt=this.findBestLevel(ut,ot,at,ct,0,dt,ht);if(nt>=0)return nt}let pt=lt?Math.min(lt,st.maxStarvationDelay):st.maxStarvationDelay;if(!ct){const nt=this.bitrateTestDelay;if(nt){pt=(lt?Math.min(lt,st.maxLoadingDelay):st.maxLoadingDelay)-nt,this.info(`bitrate test took ${Math.round(1e3*nt)}ms, set first fragment max fetchDuration to ${Math.round(1e3*pt)} ms`),dt=ht=1}}const _t=this.findBestLevel(ut,ot,at,ct,pt,dt,ht);if(this.info(`${ct?"rebuffering expected":"buffer is empty"}, optimal quality level ${_t}`),_t>-1)return _t;const Et=it.levels[ot],St=it.levels[it.loadLevel];return(null==Et?void 0:Et.bitrate)<(null==St?void 0:St.bitrate)?ot:it.loadLevel}getStarvationDelay(){const nt=this.hls,rt=nt.media;if(!rt)return 1/0;const it=rt&&0!==rt.playbackRate?Math.abs(rt.playbackRate):1,at=nt.mainForwardBufferInfo;return(at?at.len:0)/it}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(nt,rt,it,at,st,ot,lt){var ut;const ct=at+st,dt=this.lastLoadedFragLevel,ht=-1===dt?this.hls.firstLevel:dt,{fragCurrent:pt,partCurrent:_t}=this,{levels:Et,allAudioTracks:St,loadLevel:Lt,config:Ct}=this.hls;if(1===Et.length)return 0;const Pt=Et[ht],kt=!(null==(ut=this.hls.latestLevelDetails)||!ut.live),Ot=-1===Lt||-1===dt;let Ft,Bt="SDR",Ut=(null==Pt?void 0:Pt.frameRate)||0;const{audioPreference:Gt,videoPreference:Ht}=Ct,jt=this.audioTracksByGroup||(this.audioTracksByGroup=getAudioTracksByGroup(St));let Kt=-1;if(Ot){if(-1!==this.firstSelection)return this.firstSelection;const at=this.codecTiers||(this.codecTiers=function getCodecTiers(nt,rt,it,at){return nt.slice(it,at+1).reduce(((nt,it,at)=>{if(!it.codecSet)return nt;const st=it.audioGroups;let ot=nt[it.codecSet];ot||(nt[it.codecSet]=ot={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:at,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!st,fragmentError:0}),ot.minBitrate=Math.min(ot.minBitrate,it.bitrate);const lt=Math.min(it.height,it.width);return ot.minHeight=Math.min(ot.minHeight,lt),ot.minFramerate=Math.min(ot.minFramerate,it.frameRate),ot.minIndex=Math.min(ot.minIndex,at),ot.maxScore=Math.max(ot.maxScore,it.score),ot.fragmentError+=it.fragmentError,ot.videoRanges[it.videoRange]=(ot.videoRanges[it.videoRange]||0)+1,st&&st.forEach((nt=>{if(!nt)return;const it=rt.groups[nt];it&&(ot.hasDefaultAudio=ot.hasDefaultAudio||rt.hasDefaultAudio?it.hasDefault:it.hasAutoSelect||!rt.hasDefaultAudio&&!rt.hasAutoSelectAudio,Object.keys(it.channels).forEach((nt=>{ot.channels[nt]=(ot.channels[nt]||0)+it.channels[nt]})))})),nt}),{})}(Et,jt,rt,it)),st=function getStartCodecTier(nt,rt,it,at,st){const ot=Object.keys(nt),lt=null==at?void 0:at.channels,ut=null==at?void 0:at.audioCodec,ct=null==st?void 0:st.videoCodec,dt=lt&&2===parseInt(lt);let ht=!1,pt=!1,_t=1/0,Et=1/0,St=1/0,Lt=1/0,Ct=0,Pt=[];const{preferHDR:kt,allowedVideoRanges:Ot}=getVideoSelectionOptions(rt,st);for(let rt=ot.length;rt--;){const it=nt[ot[rt]];ht||(ht=it.channels[2]>0),_t=Math.min(_t,it.minHeight),Et=Math.min(Et,it.minFramerate),St=Math.min(St,it.minBitrate),Ot.filter((nt=>it.videoRanges[nt]>0)).length>0&&(pt=!0)}_t=wt(_t)?_t:0,Et=wt(Et)?Et:0;const Ft=Math.max(1080,_t),Bt=Math.max(30,Et);St=wt(St)?St:it,it=Math.max(St,it),pt||(rt=void 0);const Ut=ot.length>1;return{codecSet:ot.reduce(((rt,at)=>{const st=nt[at];if(at===rt)return rt;if(Pt=pt?Ot.filter((nt=>st.videoRanges[nt]>0)):[],Ut){if(st.minBitrate>it)return logStartCodecCandidateIgnored(at,`min bitrate of ${st.minBitrate} > current estimate of ${it}`),rt;if(!st.hasDefaultAudio)return logStartCodecCandidateIgnored(at,"no renditions with default or auto-select sound found"),rt;if(ut&&at.indexOf(ut.substring(0,4))%5!=0)return logStartCodecCandidateIgnored(at,`audio codec preference "${ut}" not found`),rt;if(lt&&!dt){if(!st.channels[lt])return logStartCodecCandidateIgnored(at,`no renditions with ${lt} channel sound found (channels options: ${Object.keys(st.channels)})`),rt}else if((!ut||dt)&&ht&&0===st.channels[2])return logStartCodecCandidateIgnored(at,"no renditions with stereo sound found"),rt;if(st.minHeight>Ft)return logStartCodecCandidateIgnored(at,`min resolution of ${st.minHeight} > maximum of ${Ft}`),rt;if(st.minFramerate>Bt)return logStartCodecCandidateIgnored(at,`min framerate of ${st.minFramerate} > maximum of ${Bt}`),rt;if(!Pt.some((nt=>st.videoRanges[nt]>0)))return logStartCodecCandidateIgnored(at,`no variants with VIDEO-RANGE of ${JSON.stringify(Pt)} found`),rt;if(ct&&at.indexOf(ct.substring(0,4))%5!=0)return logStartCodecCandidateIgnored(at,`video codec preference "${ct}" not found`),rt;if(st.maxScore<Ct)return logStartCodecCandidateIgnored(at,`max score of ${st.maxScore} < selected max of ${Ct}`),rt}return rt&&(codecsSetSelectionPreferenceValue(at)>=codecsSetSelectionPreferenceValue(rt)||st.fragmentError>nt[rt].fragmentError)?rt:(Lt=st.minIndex,Ct=st.maxScore,at)}),void 0),videoRanges:Pt,preferHDR:kt,minFramerate:Et,minBitrate:St,minIndex:Lt}}(at,Bt,nt,Gt,Ht),{codecSet:ot,videoRanges:lt,minFramerate:ut,minBitrate:ct,minIndex:dt,preferHDR:ht}=st;Kt=dt,Ft=ot,Bt=ht?lt[lt.length-1]:lt[0],Ut=ut,nt=Math.max(nt,ct),this.log(`picked start tier ${JSON.stringify(st)}`)}else Ft=null==Pt?void 0:Pt.codecSet,Bt=null==Pt?void 0:Pt.videoRange;const $t=_t?_t.duration:pt?pt.duration:0,Yt=this.bwEstimator.getEstimateTTFB()/1e3,Wt=[];for(let ut=it;ut>=rt;ut--){var Qt;const rt=Et[ut],pt=ut>ht;if(!rt)continue;if(Ct.useMediaCapabilities&&!rt.supportedResult&&!rt.supportedPromise){const it=navigator.mediaCapabilities;"function"==typeof(null==it?void 0:it.decodingInfo)&&requiresMediaCapabilitiesDecodingInfo(rt,jt,Bt,Ut,nt,Gt)?(rt.supportedPromise=getMediaDecodingInfoPromise(rt,jt,it),rt.supportedPromise.then((nt=>{if(!this.hls)return;rt.supportedResult=nt;const it=this.hls.levels,at=it.indexOf(rt);nt.error?this.warn(`MediaCapabilities decodingInfo error: "${nt.error}" for level ${at} ${JSON.stringify(nt)}`):nt.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${at} ${JSON.stringify(nt)}`),at>-1&&it.length>1&&(this.log(`Removing unsupported level ${at}`),this.hls.removeLevel(at)))}))):rt.supportedResult=ln}if((Ft&&rt.codecSet!==Ft||Bt&&rt.videoRange!==Bt||pt&&Ut>rt.frameRate||!pt&&Ut>0&&Ut<rt.frameRate||rt.supportedResult&&(null==(Qt=rt.supportedResult.decodingInfoResults)||!Qt[0].smooth))&&(!Ot||ut!==Kt)){Wt.push(ut);continue}const St=rt.details,Ht=(_t?null==St?void 0:St.partTarget:null==St?void 0:St.averagetargetduration)||$t;let en;en=pt?lt*nt:ot*nt;const nn=$t&&at>=2*$t&&0===st?Et[ut].averageBitrate:Et[ut].maxBitrate,an=this.getTimeToLoadFrag(Yt,en,nn*Ht,void 0===St);if(en>=nn&&(ut===dt||0===rt.loadError&&0===rt.fragmentError)&&(an<=Yt||!wt(an)||kt&&!this.bitrateTestDelay||an<ct)){const nt=this.forcedAutoLevel;return ut===Lt||-1!==nt&&nt===Lt||(Wt.length&&this.trace(`Skipped level(s) ${Wt.join(",")} of ${it} max with CODECS and VIDEO-RANGE:"${Et[Wt[0]].codecs}" ${Et[Wt[0]].videoRange}; not compatible with "${Pt.codecs}" ${Bt}`),this.info(`switch candidate:${ht}->${ut} adjustedbw(${Math.round(en)})-bitrate=${Math.round(en-nn)} ttfb:${Yt.toFixed(1)} avgDuration:${Ht.toFixed(1)} maxFetchDuration:${ct.toFixed(1)} fetchDuration:${an.toFixed(1)} firstSelection:${Ot} codecSet:${rt.codecSet} videoRange:${rt.videoRange} hls.loadLevel:${Lt}`)),Ot&&(this.firstSelection=ut),ut}}return-1}set nextAutoLevel(nt){const{maxAutoLevel:rt,minAutoLevel:it}=this.hls,at=Math.min(Math.max(nt,it),rt);this._nextAutoLevel!==at&&(this.nextAutoLevelKey="",this._nextAutoLevel=at)}},bufferController:class BufferController extends Logger{constructor(nt,rt){super("buffer-controller",nt.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=nt=>{var rt;this.hls&&"open"===(null==(rt=this.mediaSource)?void 0:rt.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=nt=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=nt=>{const{media:rt,mediaSource:it}=this;nt&&this.log("Media source opened"),rt&&it&&(rt.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(Ot.MEDIA_ATTACHED,{media:rt,mediaSource:it}),it.removeEventListener("sourceopen",this._onMediaSourceOpen),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:nt,_objectUrl:rt}=this;nt!==rt&&this.error(`Media element src was set while attaching MediaSource (${rt} > ${nt})`)},this.hls=nt,this.fragmentTracker=rt,this.appendSource=function isManagedMediaSource(nt){return"undefined"!=typeof self&&nt===self.ManagedMediaSource}(getMediaSource(nt.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:nt}=this;nt.on(Ot.MEDIA_ATTACHING,this.onMediaAttaching,this),nt.on(Ot.MEDIA_DETACHING,this.onMediaDetaching,this),nt.on(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.on(Ot.MANIFEST_PARSED,this.onManifestParsed,this),nt.on(Ot.BUFFER_RESET,this.onBufferReset,this),nt.on(Ot.BUFFER_APPENDING,this.onBufferAppending,this),nt.on(Ot.BUFFER_CODECS,this.onBufferCodecs,this),nt.on(Ot.BUFFER_EOS,this.onBufferEos,this),nt.on(Ot.BUFFER_FLUSHING,this.onBufferFlushing,this),nt.on(Ot.LEVEL_UPDATED,this.onLevelUpdated,this),nt.on(Ot.FRAG_PARSED,this.onFragParsed,this),nt.on(Ot.FRAG_CHANGED,this.onFragChanged,this),nt.on(Ot.ERROR,this.onError,this)}unregisterListeners(){const{hls:nt}=this;nt.off(Ot.MEDIA_ATTACHING,this.onMediaAttaching,this),nt.off(Ot.MEDIA_DETACHING,this.onMediaDetaching,this),nt.off(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.off(Ot.MANIFEST_PARSED,this.onManifestParsed,this),nt.off(Ot.BUFFER_RESET,this.onBufferReset,this),nt.off(Ot.BUFFER_APPENDING,this.onBufferAppending,this),nt.off(Ot.BUFFER_CODECS,this.onBufferCodecs,this),nt.off(Ot.BUFFER_EOS,this.onBufferEos,this),nt.off(Ot.BUFFER_FLUSHING,this.onBufferFlushing,this),nt.off(Ot.LEVEL_UPDATED,this.onLevelUpdated,this),nt.off(Ot.FRAG_PARSED,this.onFragParsed,this),nt.off(Ot.FRAG_CHANGED,this.onFragChanged,this),nt.off(Ot.ERROR,this.onError,this)}transferMedia(){const{media:nt,mediaSource:rt}=this;if(!nt)return null;const it={};if(this.operationQueue){const nt=this.isUpdating();nt||this.operationQueue.removeBlockers();const rt=this.isQueued();(nt||rt)&&this.warn(`Transfering MediaSource with${rt?" operations in queue":""}${nt?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const at=this.transferData;return!this.sourceBufferCount&&at&&at.mediaSource===rt?_extends(it,at.tracks):this.sourceBuffers.forEach((nt=>{const[rt]=nt;rt&&(it[rt]=_extends({},this.tracks[rt]),this.removeBuffer(rt)),nt[0]=nt[1]=null})),{media:nt,mediaSource:rt,tracks:it}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(nt,rt){var it;let at=2;(rt.audio&&!rt.video||!rt.altAudio)&&(at=1),this.bufferCodecEventsTotal=at,this.log(`${at} bufferCodec event(s) expected.`),null!=(it=this.transferData)&&it.mediaSource&&this.sourceBufferCount&&at&&this.bufferCreated()}onMediaAttaching(nt,rt){const it=this.media=rt.media,at=getMediaSource(this.appendSource);if(this.transferData=this.overrides=void 0,it&&at){const nt=!!rt.mediaSource;(nt||rt.overrides)&&(this.transferData=rt,this.overrides=rt.overrides);const st=this.mediaSource=rt.mediaSource||new at;if(this.assignMediaSource(st),nt)this._objectUrl=it.src,this.attachTransferred();else{const nt=this._objectUrl=self.URL.createObjectURL(st);if(this.appendSource)try{it.removeAttribute("src");const rt=self.ManagedMediaSource;it.disableRemotePlayback=it.disableRemotePlayback||rt&&st instanceof rt,removeSourceChildren(it),function addSource(nt,rt){const it=self.document.createElement("source");it.type="video/mp4",it.src=rt,nt.appendChild(it)}(it,nt),it.load()}catch(rt){it.src=nt}else it.src=nt}it.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(nt){var rt,it;this.log(`${(null==(rt=this.transferData)?void 0:rt.mediaSource)===nt?"transferred":"created"} media source: ${null==(it=nt.constructor)?void 0:it.name}`),nt.addEventListener("sourceopen",this._onMediaSourceOpen),nt.addEventListener("sourceended",this._onMediaSourceEnded),nt.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(nt.addEventListener("startstreaming",this._onStartStreaming),nt.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const nt=this.media,rt=this.transferData;if(!rt||!nt)return;const it=this.tracks,at=rt.tracks,st=at?Object.keys(at):null,ot=st?st.length:0,mediaSourceOpenCallback=()=>{if(this.media){var nt;const rt=null==(nt=this.mediaSource)?void 0:nt.readyState;"open"!==rt&&"ended"!==rt||this._onMediaSourceOpen()}};if(at&&st&&ot){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})\nrequired tracks: ${JSON.stringify(it,((nt,rt)=>"initSegment"===nt?void 0:rt))};\ntransfer tracks: ${JSON.stringify(at,((nt,rt)=>"initSegment"===nt?void 0:rt))}}`),!isCompatibleTrackChange(at,it)){rt.mediaSource=null,rt.tracks=void 0;const st=nt.currentTime,ot=this.details,lt=Math.max(st,(null==ot?void 0:ot.fragments[0].start)||0);return lt-st>1?void this.log(`attachTransferred: waiting for playback to reach new tracks start time ${st} -> ${lt}`):(this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(at)}"->"${Object.keys(it)}") start time: ${lt} currentTime: ${st}`),this.onMediaDetaching(Ot.MEDIA_DETACHING,{}),this.onMediaAttaching(Ot.MEDIA_ATTACHING,rt),void(nt.currentTime=lt))}this.transferData=void 0,st.forEach((nt=>{const rt=nt,it=at[rt];if(it){const nt=it.buffer;if(nt){const at=this.fragmentTracker,st=it.id;if(at.hasFragments(st)||at.hasParts(st)){const it=BufferHelper.getBuffered(nt);at.detectEvictedFragments(rt,it,st,null,!0)}const ot=sourceBufferNameToIndex(rt),lt=[rt,nt];this.sourceBuffers[ot]=lt,nt.updating&&this.operationQueue&&this.operationQueue.prependBlocker(rt),this.trackSourceBuffer(rt,it)}}})),mediaSourceOpenCallback(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),mediaSourceOpenCallback()}onMediaDetaching(nt,rt){const it=!!rt.transferMedia;this.transferData=this.overrides=void 0;const{media:at,mediaSource:st,_objectUrl:ot}=this;if(st){if(this.log("media source "+(it?"transferring":"detaching")),it)this.sourceBuffers.forEach((([nt])=>{nt&&this.removeBuffer(nt)})),this.resetQueue();else{if("open"===st.readyState)try{const nt=st.sourceBuffers;for(let rt=nt.length;rt--;)nt[rt].abort(),st.removeSourceBuffer(nt[rt]);st.endOfStream()}catch(nt){this.warn(`onMediaDetaching: ${nt.message} while calling endOfStream`)}this.sourceBufferCount&&this.onBufferReset()}st.removeEventListener("sourceopen",this._onMediaSourceOpen),st.removeEventListener("sourceended",this._onMediaSourceEnded),st.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(st.removeEventListener("startstreaming",this._onStartStreaming),st.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}at&&(at.removeEventListener("emptied",this._onMediaEmptied),it||(ot&&self.URL.revokeObjectURL(ot),this.mediaSrc===ot?(at.removeAttribute("src"),this.appendSource&&removeSourceChildren(at),at.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(Ot.MEDIA_DETACHED,rt)}onBufferReset(){this.sourceBuffers.forEach((([nt])=>{nt&&this.resetBuffer(nt)})),this.initTracks()}resetBuffer(nt){var rt;const it=null==(rt=this.tracks[nt])?void 0:rt.buffer;if(this.removeBuffer(nt),it)try{var at;null!=(at=this.mediaSource)&&at.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(it)}catch(rt){this.warn(`onBufferReset ${nt}`,rt)}delete this.tracks[nt]}removeBuffer(nt){this.removeBufferListeners(nt),this.sourceBuffers[sourceBufferNameToIndex(nt)]=[null,null];const rt=this.tracks[nt];rt&&(rt.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new BufferOperationQueue(this.tracks)}onBufferCodecs(nt,rt){const it=this.tracks,at=Object.keys(rt);this.log(`BUFFER_CODECS: "${at}" (current SB count ${this.sourceBufferCount})`);const st="audiovideo"in rt&&(it.audio||it.video)||it.audiovideo&&("audio"in rt||"video"in rt),ot=!st&&this.sourceBufferCount&&this.media&&at.some((nt=>!it[nt]));st||ot?this.warn(`Unsupported transition between "${Object.keys(it)}" and "${at}" SourceBuffers`):(at.forEach((nt=>{var at,st,ot;const lt=rt[nt],{id:ut,codec:ct,levelCodec:dt,container:ht,metadata:pt}=lt;let _t=it[nt];const Et=null==(at=this.transferData)||null==(st=at.tracks)?void 0:st[nt],St=null!=Et&&Et.buffer?Et:_t,wt=(null==St?void 0:St.pendingCodec)||(null==St?void 0:St.codec),Lt=null==St?void 0:St.levelCodec,Ct=!St||!!this.hls.config.assetPlayerId;_t||(_t=it[nt]={buffer:void 0,listeners:[],codec:ct,container:ht,levelCodec:dt,metadata:pt,id:ut});const Pt=pickMostCompleteCodecName(wt,Lt),kt=null==Pt?void 0:Pt.replace(oa,"$1");let Ot=pickMostCompleteCodecName(ct,dt);const Ft=null==(ot=Ot)?void 0:ot.replace(oa,"$1");Ot&&(kt!==Ft||Ct)&&("audio"===nt.slice(0,5)&&(Ot=getCodecCompatibleName(Ot,this.appendSource)),this.log(`switching codec ${wt} to ${Ot}`),Ot!==(_t.pendingCodec||_t.codec)&&(_t.pendingCodec=Ot),_t.container=ht,this.appendChangeType(nt,ht,Ot))})),(this.tracksReady||this.sourceBufferCount)&&(rt.tracks=this.sourceBufferTracks),this.sourceBufferCount||null!==this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce(((nt,rt)=>{const it=this.tracks[rt];return nt[rt]={id:it.id,container:it.container,codec:it.codec,levelCodec:it.levelCodec},nt}),{})}appendChangeType(nt,rt,it){const at=`${rt};codecs=${it}`,st={label:`change-type=${at}`,execute:()=>{const st=this.tracks[nt];if(st){const ot=st.buffer;null!=ot&&ot.changeType&&(this.log(`changing ${nt} sourceBuffer type to ${at}`),ot.changeType(at),st.codec=it,st.container=rt)}this.shiftAndExecuteNext(nt)},onStart:()=>{},onComplete:()=>{},onError:rt=>{this.warn(`Failed to change ${nt} SourceBuffer type`,rt)}};this.append(st,nt,this.isPending(this.tracks[nt]))}blockAudio(nt){var rt;const it=nt.start,at=it+.05*nt.duration;if(!0===(null==(rt=this.fragmentTracker.getAppendedFrag(it,Ht))?void 0:rt.gap))return;const st={label:"block-audio",execute:()=>{var nt;const rt=this.tracks.video;(this.lastVideoAppendEnd>at||null!=rt&&rt.buffer&&BufferHelper.isBuffered(rt.buffer,at)||!0===(null==(nt=this.fragmentTracker.getAppendedFrag(at,Ht))?void 0:nt.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:nt=>{this.warn("Error executing block-audio operation",nt)}};this.blockedAudioAppend={op:st,frag:nt},this.append(st,"audio",!0)}unblockAudio(){const{blockedAudioAppend:nt,operationQueue:rt}=this;nt&&rt&&(this.blockedAudioAppend=null,rt.unblockAudio(nt.op))}onBufferAppending(nt,rt){const{tracks:it}=this,{data:at,type:st,parent:ot,frag:lt,part:ut,chunkMeta:ct}=rt,dt=ct.buffering[st],ht=lt.sn,pt=self.performance.now();dt.start=pt;const _t=lt.stats.buffering,Et=ut?ut.stats.buffering:null;0===_t.start&&(_t.start=pt),Et&&0===Et.start&&(Et.start=pt);const St=it.audio;let wt=!1;"audio"===st&&"audio/mpeg"===(null==St?void 0:St.container)&&(wt=!this.lastMpegAudioChunk||1===ct.id||this.lastMpegAudioChunk.sn!==ct.sn,this.lastMpegAudioChunk=ct);const Lt=this.tracks.video,Ct=null==Lt?void 0:Lt.buffer;if(Ct&&"initSegment"!==ht){const nt=ut||lt,rt=this.blockedAudioAppend;if("audio"!==st||"main"===ot||this.blockedAudioAppend){if("video"===st){const it=nt.end;if(rt){const nt=rt.frag.start;(it>nt||it<this.lastVideoAppendEnd||BufferHelper.isBuffered(Ct,nt))&&this.unblockAudio()}this.lastVideoAppendEnd=it}}else{const rt=nt.start+.05*nt.duration,it=Ct.buffered,at=this.currentOp("video");it.length||at?!at&&!BufferHelper.isBuffered(Ct,rt)&&this.lastVideoAppendEnd<rt&&this.blockAudio(nt):this.blockAudio(nt)}}const Ft=(ut||lt).start,Bt={label:`append-${st}`,execute:()=>{if(dt.executeStart=self.performance.now(),wt){const nt=this.tracks[st];if(nt){const rt=nt.buffer;if(rt){const nt=Ft-rt.timestampOffset;Math.abs(nt)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${Ft} (delta: ${nt}) sn: ${ht})`),rt.timestampOffset=Ft)}}}this.appendExecutor(at,st)},onStart:()=>{},onComplete:()=>{const nt=self.performance.now();dt.executeEnd=dt.end=nt,0===_t.first&&(_t.first=nt),Et&&0===Et.first&&(Et.first=nt);const rt={};this.sourceBuffers.forEach((([nt,it])=>{nt&&(rt[nt]=BufferHelper.getBuffered(it))})),this.appendErrors[st]=0,"audio"===st||"video"===st?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(Ot.BUFFER_APPENDED,{type:st,frag:lt,part:ut,chunkMeta:ct,parent:lt.type,timeRanges:rt})},onError:nt=>{var rt,it;const at={type:Pt.MEDIA_ERROR,parent:lt.type,details:kt.BUFFER_APPEND_ERROR,sourceBufferName:st,frag:lt,part:ut,chunkMeta:ct,error:nt,err:nt,fatal:!1};if(nt.code===DOMException.QUOTA_EXCEEDED_ERR)at.details=kt.BUFFER_FULL_ERROR;else if(nt.code!==DOMException.INVALID_STATE_ERR||"open"!==(null==(rt=this.mediaSource)?void 0:rt.readyState)||null!=(it=this.media)&&it.error)if(nt.name===la)0===this.sourceBufferCount?at.errorAction=createDoNothingErrorAction(!0):++this.appendErrors[st];else{const nt=++this.appendErrors[st];this.warn(`Failed ${nt}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${st}" sourceBuffer`),nt>=this.hls.config.appendErrorMaxRetry&&(at.fatal=!0)}else at.errorAction=createDoNothingErrorAction(!0);this.hls.trigger(Ot.ERROR,at)}};this.append(Bt,st,this.isPending(this.tracks[st]))}getFlushOp(nt,rt,it){return this.log(`queuing "${nt}" remove ${rt}-${it}`),{label:"remove",execute:()=>{this.removeExecutor(nt,rt,it)},onStart:()=>{},onComplete:()=>{this.hls.trigger(Ot.BUFFER_FLUSHED,{type:nt})},onError:at=>{this.warn(`Failed to remove ${rt}-${it} from "${nt}" SourceBuffer`,at)}}}onBufferFlushing(nt,rt){const{type:it,startOffset:at,endOffset:st}=rt;it?this.append(this.getFlushOp(it,at,st),it):this.sourceBuffers.forEach((([nt])=>{nt&&this.append(this.getFlushOp(nt,at,st),nt)}))}onFragParsed(nt,rt){const{frag:it,part:at}=rt,st=[],ot=at?at.elementaryStreams:it.elementaryStreams;ot[er]?st.push("audiovideo"):(ot[Wn]&&st.push("audio"),ot[Jn]&&st.push("video"));0===st.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${it.type} level: ${it.level} sn: ${it.sn}`),this.blockBuffers((()=>{const nt=self.performance.now();it.stats.buffering.end=nt,at&&(at.stats.buffering.end=nt);const rt=at?at.stats:it.stats;this.hls.trigger(Ot.FRAG_BUFFERED,{frag:it,part:at,stats:rt,id:it.type})}),st)}onFragChanged(nt,rt){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some((([nt])=>{var rt,it;return nt&&(!(null!=(rt=this.tracks[nt])&&rt.ended)||(null==(it=this.tracks[nt])?void 0:it.ending))}))}onBufferEos(nt,rt){var it;this.sourceBuffers.forEach((([nt])=>{if(nt){const it=this.tracks[nt];rt.type&&rt.type!==nt||(it.ending=!0,it.ended||(it.ended=!0,this.log(`${nt} buffer reached EOS`)))}}));const at=!1!==(null==(it=this.overrides)?void 0:it.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some((([nt])=>{var rt;return nt&&!(null!=(rt=this.tracks[nt])&&rt.ended)}))&&(this.log("Queueing EOS"),this.blockUntilOpen((()=>{if(this.sourceBuffers.forEach((([nt])=>{if(null!==nt){const rt=this.tracks[nt];rt&&(rt.ending=!1)}})),at){const{mediaSource:nt}=this;if(!nt||"open"!==nt.readyState)return void(nt&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${nt.readyState}`));this.log("Calling mediaSource.endOfStream()"),nt.endOfStream()}this.hls.trigger(Ot.BUFFERED_TO_END,void 0)})))}onLevelUpdated(nt,{details:rt}){rt.fragments.length&&(this.details=rt,this.updateDuration())}updateDuration(){const nt=this.getDurationAndRange();nt&&this.blockUntilOpen((()=>this.updateMediaSource(nt)))}onError(nt,rt){if(rt.details===kt.BUFFER_APPEND_ERROR&&rt.frag){var it;const nt=null==(it=rt.errorAction)?void 0:it.nextAutoLevel;wt(nt)&&nt!==rt.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:nt,details:rt,media:it}=this;if(!it||null===rt)return;if(!this.sourceBufferCount)return;const at=nt.config,st=it.currentTime,ot=rt.levelTargetDuration,lt=rt.live&&null!==at.liveBackBufferLength?at.liveBackBufferLength:at.backBufferLength;if(wt(lt)&&lt>0){const nt=Math.max(lt,ot),rt=Math.floor(st/ot)*ot-nt;this.flushBackBuffer(st,ot,rt)}if(wt(at.frontBufferFlushThreshold)&&at.frontBufferFlushThreshold>0){const nt=Math.max(at.maxBufferLength,at.frontBufferFlushThreshold),rt=Math.max(nt,ot),it=Math.floor(st/ot)*ot+rt;this.flushFrontBuffer(st,ot,it)}}flushBackBuffer(nt,rt,it){this.sourceBuffers.forEach((([at,st])=>{if(st){const lt=BufferHelper.getBuffered(st);if(lt.length>0&&it>lt.start(0)){var ot;this.hls.trigger(Ot.BACK_BUFFER_REACHED,{bufferEnd:it});const st=this.tracks[at];if(null!=(ot=this.details)&&ot.live)this.hls.trigger(Ot.LIVE_BACK_BUFFER_REACHED,{bufferEnd:it});else if(null!=st&&st.ended&&lt.end(lt.length-1)-nt<2*rt)return void this.log(`Cannot flush ${at} back buffer while SourceBuffer is in ended state`);this.hls.trigger(Ot.BUFFER_FLUSHING,{startOffset:0,endOffset:it,type:at})}}}))}flushFrontBuffer(nt,rt,it){this.sourceBuffers.forEach((([at,st])=>{if(st){const ot=BufferHelper.getBuffered(st),lt=ot.length;if(lt<2)return;const ut=ot.start(lt-1),ct=ot.end(lt-1),dt=this.tracks[at];if(it>ut||nt>=ut&&nt<=ct)return;if(null!=dt&&dt.ended&&nt-ct<2*rt)return void this.log(`Cannot flush ${at} front buffer while SourceBuffer is in ended state`);this.hls.trigger(Ot.BUFFER_FLUSHING,{startOffset:ut,endOffset:1/0,type:at})}}))}getDurationAndRange(){var nt;const{details:rt,mediaSource:it}=this;if(!rt||!this.media||"open"!==(null==it?void 0:it.readyState))return null;const at=rt.edge;if(rt.live&&this.hls.config.liveDurationInfinity){it.duration=1/0;if(rt.fragments.length&&rt.live&&it.setLiveSeekableRange){const nt=Math.max(0,rt.fragmentStart);return{duration:1/0,start:nt,end:Math.max(nt,at)}}return{duration:1/0}}const st=null==(nt=this.overrides)?void 0:nt.duration;if(st)return{duration:st};const ot=this.media.duration;return at>(wt(it.duration)?it.duration:0)&&at>ot||!wt(ot)?{duration:at}:null}updateMediaSource({duration:nt,start:rt,end:it}){const at=this.mediaSource;this.media&&at&&"open"===at.readyState&&(at.duration!==nt&&(wt(nt)&&this.log(`Updating MediaSource duration to ${nt.toFixed(3)}`),at.duration=nt),void 0!==rt&&void 0!==it&&(this.log(`MediaSource duration is set to ${at.duration}. Setting seekable range to ${rt}-${it}.`),at.setLiveSeekableRange(rt,it)))}get tracksReady(){const nt=this.pendingTrackCount;return nt>0&&(nt>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:nt,pendingTrackCount:rt,tracks:it}=this;if(this.log(`checkPendingTracks (pending: ${rt} codec events expected: ${nt}) ${JSON.stringify(it)}`),this.tracksReady){var at;const nt=null==(at=this.transferData)?void 0:at.tracks;nt&&Object.keys(nt).length?this.attachTransferred():(this.createSourceBuffers(),this.bufferCreated())}}bufferCreated(){if(this.sourceBufferCount){const nt={};this.sourceBuffers.forEach((([rt,it])=>{if(rt){const at=this.tracks[rt];nt[rt]={buffer:it,container:at.container,codec:at.codec,levelCodec:at.levelCodec,id:at.id,metadata:at.metadata}}})),this.hls.trigger(Ot.BUFFER_CREATED,{tracks:nt}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach((([nt])=>{this.executeNext(nt)}))}else{const nt=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:nt,reason:nt.message})}}createSourceBuffers(){const{tracks:nt,sourceBuffers:rt,mediaSource:it}=this;if(!it)throw new Error("createSourceBuffers called when mediaSource was null");for(const at in nt){const st=at,ot=nt[st];if(this.isPending(ot)){const nt=this.getTrackCodec(ot,st),at=`${ot.container};codecs=${nt}`;ot.codec=nt,this.log(`creating sourceBuffer(${at})${this.currentOp(st)?" Queued":""} ${JSON.stringify(ot)}`);try{const nt=it.addSourceBuffer(at),lt=sourceBufferNameToIndex(st),ut=[st,nt];rt[lt]=ut,ot.buffer=nt}catch(nt){this.error(`error while trying to add sourceBuffer: ${nt.message}`),this.hls.trigger(Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:nt,sourceBufferName:st,mimeType:at});break}this.trackSourceBuffer(st,ot)}}}getTrackCodec(nt,rt){const it=pickMostCompleteCodecName(nt.codec,nt.levelCodec);return it?"audio"===rt.slice(0,5)?getCodecCompatibleName(it,this.appendSource):it:""}trackSourceBuffer(nt,rt){const it=rt.buffer;if(!it)return;const at=this.getTrackCodec(rt,nt);this.tracks[nt]={buffer:it,codec:at,container:rt.container,levelCodec:rt.levelCodec,metadata:rt.metadata,id:rt.id,listeners:[]},this.addBufferListener(nt,"updatestart",this.onSBUpdateStart),this.addBufferListener(nt,"updateend",this.onSBUpdateEnd),this.addBufferListener(nt,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(nt,"bufferedchange",((nt,rt)=>{const it=rt.removedRanges;null!=it&&it.length&&this.hls.trigger(Ot.BUFFER_FLUSHED,{type:nt})}))}get mediaSrc(){var nt,rt;const it=(null==(nt=this.media)||null==(rt=nt.querySelector)?void 0:rt.call(nt,"source"))||this.media;return null==it?void 0:it.src}onSBUpdateStart(nt){const rt=this.currentOp(nt);rt&&rt.onStart()}onSBUpdateEnd(nt){var rt;if("closed"===(null==(rt=this.mediaSource)?void 0:rt.readyState))return void this.resetBuffer(nt);const it=this.currentOp(nt);it&&(it.onComplete(),this.shiftAndExecuteNext(nt))}onSBUpdateError(nt,rt){var it;const at=new Error(`${nt} SourceBuffer error. MediaSource readyState: ${null==(it=this.mediaSource)?void 0:it.readyState}`);this.error(`${at}`,rt),this.hls.trigger(Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.BUFFER_APPENDING_ERROR,sourceBufferName:nt,error:at,fatal:!1});const st=this.currentOp(nt);st&&st.onError(at)}removeExecutor(nt,rt,it){const{media:at,mediaSource:st}=this,ot=this.tracks[nt],lt=null==ot?void 0:ot.buffer;if(!at||!st||!lt)return this.warn(`Attempting to remove from the ${nt} SourceBuffer, but it does not exist`),void this.shiftAndExecuteNext(nt);const ut=wt(at.duration)?at.duration:1/0,ct=wt(st.duration)?st.duration:1/0,dt=Math.max(0,rt),ht=Math.min(it,ut,ct);ht>dt&&(!ot.ending||ot.ended)?(ot.ended=!1,this.log(`Removing [${dt},${ht}] from the ${nt} SourceBuffer`),lt.remove(dt,ht)):this.shiftAndExecuteNext(nt)}appendExecutor(nt,rt){const it=this.tracks[rt],at=null==it?void 0:it.buffer;if(!at)throw new HlsJsTrackRemovedError(`Attempting to append to the ${rt} SourceBuffer, but it does not exist`);it.ending=!1,it.ended=!1,at.appendBuffer(nt)}blockUntilOpen(nt){this.isUpdating()||this.isQueued()?this.blockBuffers(nt):nt()}isUpdating(){return this.sourceBuffers.some((([nt,rt])=>nt&&rt.updating))}isQueued(){return this.sourceBuffers.some((([nt])=>nt&&!!this.currentOp(nt)))}isPending(nt){return!!nt&&!nt.buffer}blockBuffers(nt,rt=this.sourceBufferTypes){if(!rt.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(nt);const{operationQueue:it}=this,at=rt.map((nt=>this.appendBlocker(nt)));rt.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(at).then((at=>{it===this.operationQueue&&(nt(),this.stepOperationQueue(rt))}))}stepOperationQueue(nt){nt.forEach((nt=>{var rt;const it=null==(rt=this.tracks[nt])?void 0:rt.buffer;it&&!it.updating&&this.shiftAndExecuteNext(nt)}))}append(nt,rt,it){this.operationQueue&&this.operationQueue.append(nt,rt,it)}appendBlocker(nt){if(this.operationQueue)return this.operationQueue.appendBlocker(nt)}currentOp(nt){return this.operationQueue?this.operationQueue.current(nt):null}executeNext(nt){nt&&this.operationQueue&&this.operationQueue.executeNext(nt)}shiftAndExecuteNext(nt){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(nt)}get pendingTrackCount(){return Object.keys(this.tracks).reduce(((nt,rt)=>nt+(this.isPending(this.tracks[rt])?1:0)),0)}get sourceBufferCount(){return this.sourceBuffers.reduce(((nt,[rt])=>nt+(rt?1:0)),0)}get sourceBufferTypes(){return this.sourceBuffers.map((([nt])=>nt)).filter((nt=>!!nt))}addBufferListener(nt,rt,it){const at=this.tracks[nt];if(!at)return;const st=at.buffer;if(!st)return;const ot=it.bind(this,nt);at.listeners.push({event:rt,listener:ot}),st.addEventListener(rt,ot)}removeBufferListeners(nt){const rt=this.tracks[nt];if(!rt)return;const it=rt.buffer;it&&(rt.listeners.forEach((nt=>{it.removeEventListener(nt.event,nt.listener)})),rt.listeners.length=0)}},capLevelController:CapLevelController,errorController:class ErrorController extends Logger{constructor(nt){super("error-controller",nt.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=nt,this.registerListeners()}registerListeners(){const nt=this.hls;nt.on(Ot.ERROR,this.onError,this),nt.on(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.on(Ot.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const nt=this.hls;nt&&(nt.off(Ot.ERROR,this.onError,this),nt.off(Ot.ERROR,this.onErrorOut,this),nt.off(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.off(Ot.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(nt){}stopLoad(){this.playlistError=0}getVariantLevelIndex(nt){return(null==nt?void 0:nt.type)===Ht?nt.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(nt,rt){var it;if(rt.fatal)return;const at=this.hls,st=rt.context;switch(rt.details){case kt.FRAG_LOAD_ERROR:case kt.FRAG_LOAD_TIMEOUT:case kt.KEY_LOAD_ERROR:case kt.KEY_LOAD_TIMEOUT:return void(rt.errorAction=this.getFragRetryOrSwitchAction(rt));case kt.FRAG_PARSING_ERROR:if(null!=(it=rt.frag)&&it.gap)return void(rt.errorAction=createDoNothingErrorAction());case kt.FRAG_GAP:case kt.FRAG_DECRYPT_ERROR:return rt.errorAction=this.getFragRetryOrSwitchAction(rt),void(rt.errorAction.action=En);case kt.LEVEL_EMPTY_ERROR:case kt.LEVEL_PARSING_ERROR:{var ot,lt;const nt=rt.parent===Ht?rt.level:at.loadLevel;rt.details===kt.LEVEL_EMPTY_ERROR&&null!=(ot=rt.context)&&null!=(lt=ot.levelDetails)&&lt.live?rt.errorAction=this.getPlaylistRetryOrSwitchAction(rt,nt):(rt.levelRetry=!1,rt.errorAction=this.getLevelSwitchAction(rt,nt))}return;case kt.LEVEL_LOAD_ERROR:case kt.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==st?void 0:st.level)&&(rt.errorAction=this.getPlaylistRetryOrSwitchAction(rt,st.level)));case kt.AUDIO_TRACK_LOAD_ERROR:case kt.AUDIO_TRACK_LOAD_TIMEOUT:case kt.SUBTITLE_LOAD_ERROR:case kt.SUBTITLE_TRACK_LOAD_TIMEOUT:if(st){const nt=at.levels[at.loadLevel];if(nt&&(st.type===Ut&&nt.hasAudioGroup(st.groupId)||st.type===Gt&&nt.hasSubtitleGroup(st.groupId)))return rt.errorAction=this.getPlaylistRetryOrSwitchAction(rt,at.loadLevel),rt.errorAction.action=En,void(rt.errorAction.flags=Rn)}return;case kt.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const nt=at.levels[at.loadLevel],it=null==nt?void 0:nt.attrs["HDCP-LEVEL"];it?rt.errorAction={action:En,flags:In,hdcpLevel:it}:this.keySystemError(rt)}return;case kt.BUFFER_ADD_CODEC_ERROR:case kt.REMUX_ALLOC_ERROR:case kt.BUFFER_APPEND_ERROR:var ut;if(!rt.errorAction)rt.errorAction=this.getLevelSwitchAction(rt,null!=(ut=rt.level)?ut:at.loadLevel);return;case kt.INTERNAL_EXCEPTION:case kt.BUFFER_APPENDING_ERROR:case kt.BUFFER_FULL_ERROR:case kt.LEVEL_SWITCH_ERROR:case kt.BUFFER_STALLED_ERROR:case kt.BUFFER_SEEK_OVER_HOLE:case kt.BUFFER_NUDGE_ON_STALL:return void(rt.errorAction=createDoNothingErrorAction())}rt.type===Pt.KEY_SYSTEM_ERROR&&this.keySystemError(rt)}keySystemError(nt){const rt=this.getVariantLevelIndex(nt.frag);nt.levelRetry=!1,nt.errorAction=this.getLevelSwitchAction(nt,rt)}getPlaylistRetryOrSwitchAction(nt,rt){const it=getRetryConfig(this.hls.config.playlistLoadPolicy,nt),at=this.playlistError++;if(shouldRetry(it,at,isTimeoutError(nt),nt.response))return{action:bn,flags:An,retryConfig:it,retryCount:at};const st=this.getLevelSwitchAction(nt,rt);return it&&(st.retryConfig=it,st.retryCount=at),st}getFragRetryOrSwitchAction(nt){const rt=this.hls,it=this.getVariantLevelIndex(nt.frag),at=rt.levels[it],{fragLoadPolicy:st,keyLoadPolicy:ot}=rt.config,lt=getRetryConfig(nt.details.startsWith("key")?ot:st,nt),ut=rt.levels.reduce(((nt,rt)=>nt+rt.fragmentError),0);if(at){nt.details!==kt.FRAG_GAP&&at.fragmentError++;if(shouldRetry(lt,ut,isTimeoutError(nt),nt.response))return{action:bn,flags:An,retryConfig:lt,retryCount:ut}}const ct=this.getLevelSwitchAction(nt,it);return lt&&(ct.retryConfig=lt,ct.retryCount=ut),ct}getLevelSwitchAction(nt,rt){const it=this.hls;null==rt&&(rt=it.loadLevel);const at=this.hls.levels[rt];if(at){var st,ot;const rt=nt.details;at.loadError++,rt===kt.BUFFER_APPEND_ERROR&&at.fragmentError++;let ct=-1;const{levels:dt,loadLevel:ht,minAutoLevel:pt,maxAutoLevel:_t}=it;it.autoLevelEnabled||(it.loadLevel=-1);const Et=null==(st=nt.frag)?void 0:st.type,St=(Et===jt&&rt===kt.FRAG_PARSING_ERROR||"audio"===nt.sourceBufferName&&(rt===kt.BUFFER_ADD_CODEC_ERROR||rt===kt.BUFFER_APPEND_ERROR))&&dt.some((({audioCodec:nt})=>at.audioCodec!==nt)),wt="video"===nt.sourceBufferName&&(rt===kt.BUFFER_ADD_CODEC_ERROR||rt===kt.BUFFER_APPEND_ERROR)&&dt.some((({codecSet:nt,audioCodec:rt})=>at.codecSet!==nt&&at.audioCodec===rt)),{type:Lt,groupId:Ct}=null!=(ot=nt.context)?ot:{};for(let it=dt.length;it--;){const st=(it+ht)%dt.length;if(st!==ht&&st>=pt&&st<=_t&&0===dt[st].loadError){var lt,ut;const it=dt[st];if(rt===kt.FRAG_GAP&&Et===Ht&&nt.frag){const rt=dt[st].details;if(rt){const it=findFragmentByPTS(nt.frag,rt.fragments,nt.frag.start);if(null!=it&&it.gap)continue}}else{if(Lt===Ut&&it.hasAudioGroup(Ct)||Lt===Gt&&it.hasSubtitleGroup(Ct))continue;if(Et===jt&&null!=(lt=at.audioGroups)&&lt.some((nt=>it.hasAudioGroup(nt)))||Et===Kt&&null!=(ut=at.subtitleGroups)&&ut.some((nt=>it.hasSubtitleGroup(nt)))||St&&at.audioCodec===it.audioCodec||!St&&at.audioCodec!==it.audioCodec||wt&&at.codecSet===it.codecSet)continue}ct=st;break}}if(ct>-1&&it.loadLevel!==ct)return nt.levelRetry=!0,this.playlistError=0,{action:En,flags:An,nextAutoLevel:ct}}return{action:En,flags:Rn}}onErrorOut(nt,rt){var it;switch(null==(it=rt.errorAction)?void 0:it.action){case vn:break;case En:this.sendAlternateToPenaltyBox(rt),rt.errorAction.resolved||rt.details===kt.FRAG_GAP?/MediaSource readyState: ended/.test(rt.error.message)&&(this.warn(`MediaSource ended after "${rt.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):rt.fatal=!0}rt.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(nt){const rt=this.hls,it=nt.errorAction;if(!it)return;const{flags:at,hdcpLevel:st,nextAutoLevel:ot}=it;switch(at){case An:this.switchLevel(nt,ot);break;case In:st&&(rt.maxHdcpLevel=fn[fn.indexOf(st)-1],it.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${rt.maxHdcpLevel}" or lower`)}it.resolved||this.switchLevel(nt,ot)}switchLevel(nt,rt){void 0!==rt&&nt.errorAction&&(this.warn(`switching to level ${rt} after ${nt.details}`),this.hls.nextAutoLevel=rt,nt.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}},fpsController:class FPSController{constructor(nt){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=nt,this.registerListeners()}setStreamController(nt){this.streamController=nt}registerListeners(){this.hls.on(Ot.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(Ot.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(Ot.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(Ot.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(nt,rt){const it=this.hls.config;if(it.capLevelOnFPSDrop){const nt=rt.media instanceof self.HTMLVideoElement?rt.media:null;this.media=nt,nt&&"function"==typeof nt.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),it.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(nt,rt,it){const at=performance.now();if(rt){if(this.lastTime){const nt=at-this.lastTime,st=it-this.lastDroppedFrames,ot=rt-this.lastDecodedFrames,lt=1e3*st/nt,ut=this.hls;if(ut.trigger(Ot.FPS_DROP,{currentDropped:st,currentDecoded:ot,totalDroppedFrames:it}),lt>0&&st>ut.config.fpsDroppedMonitoringThreshold*ot){let nt=ut.currentLevel;ut.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+nt),nt>0&&(-1===ut.autoLevelCapping||ut.autoLevelCapping>=nt)&&(nt-=1,ut.trigger(Ot.FPS_DROP_LEVEL_CAPPING,{level:nt,droppedLevel:ut.currentLevel}),ut.autoLevelCapping=nt,this.streamController.nextLevelSwitch())}}this.lastTime=at,this.lastDroppedFrames=it,this.lastDecodedFrames=rt}}checkFPSInterval(){const nt=this.media;if(nt)if(this.isVideoPlaybackQualityAvailable){const rt=nt.getVideoPlaybackQuality();this.checkFPS(nt,rt.totalVideoFrames,rt.droppedVideoFrames)}else this.checkFPS(nt,nt.webkitDecodedFrameCount,nt.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ni,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},function timelineConfig(){return{cueHandler:ms,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}()),{},{subtitleStreamController:class SubtitleStreamController extends BaseStreamController{constructor(nt,rt,it){super(nt,rt,it,"subtitle-stream-controller",Kt),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:nt}=this;nt.on(Ot.LEVEL_LOADED,this.onLevelLoaded,this),nt.on(Ot.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),nt.on(Ot.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),nt.on(Ot.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),nt.on(Ot.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),nt.on(Ot.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:nt}=this;nt.off(Ot.LEVEL_LOADED,this.onLevelLoaded,this),nt.off(Ot.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),nt.off(Ot.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),nt.off(Ot.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),nt.off(Ot.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),nt.off(Ot.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(nt){this.stopLoad(),this.state=_i,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=nt,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(nt,rt){this.tracksBuffered=[],super.onMediaDetaching(nt,rt)}onLevelLoaded(nt,rt){this.mainDetails=rt.details}onSubtitleFragProcessed(nt,rt){const{frag:it,success:at}=rt;if("initSegment"!==it.sn&&(this.fragPrevious=it),this.state=_i,!at)return;const st=this.tracksBuffered[this.currentTrackId];if(!st)return;let ot;const lt=it.start;for(let nt=0;nt<st.length;nt++)if(lt>=st[nt].start&&lt<=st[nt].end){ot=st[nt];break}const ut=it.start+it.duration;ot?ot.end=ut:(ot={start:lt,end:ut},st.push(ot)),this.fragmentTracker.fragBuffered(it),this.fragBufferedComplete(it,null),this.media&&this.tick()}onBufferFlushing(nt,rt){const{startOffset:it,endOffset:at}=rt;if(0===it&&at!==Number.POSITIVE_INFINITY){const nt=at-1;if(nt<=0)return;rt.endOffsetSubtitles=Math.max(0,nt),this.tracksBuffered.forEach((rt=>{for(let it=0;it<rt.length;)if(rt[it].end<=nt)rt.shift();else{if(!(rt[it].start<nt))break;rt[it].start=nt,it++}})),this.fragmentTracker.removeFragmentsInRange(it,nt,Kt)}}onError(nt,rt){const it=rt.frag;(null==it?void 0:it.type)===Kt&&(rt.details===kt.FRAG_GAP&&this.fragmentTracker.fragBuffered(it,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==gi&&(this.state=_i))}onSubtitleTracksUpdated(nt,{subtitleTracks:rt}){this.levels&&subtitleOptionsIdentical(this.levels,rt)?this.levels=rt.map((nt=>new Level(nt))):(this.tracksBuffered=[],this.levels=rt.map((nt=>{const rt=new Level(nt);return this.tracksBuffered[rt.id]=[],rt})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Kt),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(nt,rt){var it;if(this.currentTrackId=rt.id,null==(it=this.levels)||!it.length||-1===this.currentTrackId)return void this.clearInterval();const at=this.levels[this.currentTrackId];null!=at&&at.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,at&&this.state!==gi&&this.setInterval(500)}onSubtitleTrackLoaded(nt,rt){var it;const{currentTrackId:at,levels:st}=this,{details:ot,id:lt}=rt;if(!st)return void this.warn(`Subtitle tracks were reset while loading level ${lt}`);const ut=st[lt];if(lt>=st.length||!ut)return;this.log(`Subtitle track ${lt} loaded [${ot.startSN},${ot.endSN}]${ot.lastPartSn?`[part-${ot.lastPartSn}-${ot.lastPartIndex}]`:""},duration:${ot.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let ct=0;if(ot.live||null!=(it=ut.details)&&it.live){const nt=this.mainDetails;if(ot.deltaUpdateFailed||!nt)return;const rt=nt.fragments[0];var dt;if(ut.details)ct=this.alignPlaylists(ot,ut.details,null==(dt=this.levelLastLoaded)?void 0:dt.details),0===ct&&rt&&(ct=rt.start,addSliding(ot,ct));else ot.hasProgramDateTime&&nt.hasProgramDateTime?(alignMediaPlaylistByPDT(ot,nt),ct=ot.fragmentStart):rt&&(ct=rt.start,addSliding(ot,ct))}if(ut.details=ot,this.levelLastLoaded=ut,lt===at&&(this.hls.trigger(Ot.SUBTITLE_TRACK_UPDATED,{details:ot,id:lt,groupId:rt.groupId}),this.tick(),ot.live&&!this.fragCurrent&&this.media&&this.state===_i)){findFragmentByPTS(null,ot.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),ut.details=void 0)}}_handleFragmentLoadComplete(nt){const{frag:rt,payload:it}=nt,at=rt.decryptdata,st=this.hls;if(!this.fragContextChanged(rt)&&it&&it.byteLength>0&&null!=at&&at.key&&at.iv&&isFullSegmentEncryption(at.method)){const nt=performance.now();this.decrypter.decrypt(new Uint8Array(it),at.key.buffer,at.iv.buffer,getAesModeFromFullSegmentMethod(at.method)).catch((nt=>{throw st.trigger(Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.FRAG_DECRYPT_ERROR,fatal:!1,error:nt,reason:nt.message,frag:rt}),nt})).then((it=>{const at=performance.now();st.trigger(Ot.FRAG_DECRYPTED,{frag:rt,payload:it,stats:{tstart:nt,tdecrypt:at}})})).catch((nt=>{this.warn(`${nt.name}: ${nt.message}`),this.state=_i}))}}doTick(){if(this.media){if(this.state===_i){const{currentTrackId:nt,levels:rt}=this,it=null==rt?void 0:rt[nt];if(!it||!rt.length||!it.details)return;const{config:at}=this,st=this.getLoadPosition(),ot=BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],st,at.maxBufferHole),{end:lt,len:ut}=ot,ct=it.details;if(ut>this.hls.maxBufferLength+ct.levelTargetDuration)return;const dt=ct.fragments,ht=dt.length,pt=ct.edge;let _t=null;const Et=this.fragPrevious;if(lt<pt){const nt=at.maxFragLookUpTolerance,rt=lt>pt-nt?0:nt;_t=findFragmentByPTS(Et,dt,Math.max(dt[0].start,lt),rt),!_t&&Et&&Et.start<dt[0].start&&(_t=dt[0])}else _t=dt[ht-1];if(!_t)return;if(_t=this.mapToInitFragWhenRequired(_t),"initSegment"!==_t.sn){const nt=dt[_t.sn-ct.startSN-1];nt&&nt.cc===_t.cc&&this.fragmentTracker.getState(nt)===Ln&&(_t=nt)}this.fragmentTracker.getState(_t)===Ln&&this.loadFragment(_t,it,lt)}}else this.state=_i}loadFragment(nt,rt,it){"initSegment"===nt.sn?this._loadInitSegment(nt,rt):super.loadFragment(nt,rt,it)}get mediaBufferTimeRanges(){return new BufferableInstance(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class SubtitleTrackController extends BasePlaylistController{constructor(nt){super(nt,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let nt=null;const rt=filterSubtitleTracks(this.media.textTracks);for(let it=0;it<rt.length;it++)if("hidden"===rt[it].mode)nt=rt[it];else if("showing"===rt[it].mode){nt=rt[it];break}const it=this.findTrackForTextTrack(nt);this.subtitleTrack!==it&&this.setSubtitleTrack(it)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(nt){this._subtitleDisplay=nt,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:nt}=this;nt.on(Ot.MEDIA_ATTACHED,this.onMediaAttached,this),nt.on(Ot.MEDIA_DETACHING,this.onMediaDetaching,this),nt.on(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.on(Ot.MANIFEST_PARSED,this.onManifestParsed,this),nt.on(Ot.LEVEL_LOADING,this.onLevelLoading,this),nt.on(Ot.LEVEL_SWITCHING,this.onLevelSwitching,this),nt.on(Ot.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),nt.on(Ot.ERROR,this.onError,this)}unregisterListeners(){const{hls:nt}=this;nt.off(Ot.MEDIA_ATTACHED,this.onMediaAttached,this),nt.off(Ot.MEDIA_DETACHING,this.onMediaDetaching,this),nt.off(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.off(Ot.MANIFEST_PARSED,this.onManifestParsed,this),nt.off(Ot.LEVEL_LOADING,this.onLevelLoading,this),nt.off(Ot.LEVEL_SWITCHING,this.onLevelSwitching,this),nt.off(Ot.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),nt.off(Ot.ERROR,this.onError,this)}onMediaAttached(nt,rt){this.media=rt.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(nt){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,nt)}onMediaDetaching(nt,rt){const it=this.media;if(!it)return;const at=!!rt.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||it.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,at)return;filterSubtitleTracks(it.textTracks).forEach((nt=>{clearCurrentCues(nt)}))}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(nt,rt){this.tracks=rt.subtitleTracks}onSubtitleTrackLoaded(nt,rt){const{id:it,groupId:at,details:st}=rt,ot=this.tracksInGroup[it];if(!ot||ot.groupId!==at)return void this.warn(`Subtitle track with id:${it} and group:${at} not found in active group ${null==ot?void 0:ot.groupId}`);const lt=ot.details;ot.details=rt.details,this.log(`Subtitle track ${it} "${ot.name}" lang:${ot.lang} group:${at} loaded [${st.startSN}-${st.endSN}]`),it===this.trackId&&this.playlistLoaded(it,rt,lt)}onLevelLoading(nt,rt){this.switchLevel(rt.level)}onLevelSwitching(nt,rt){this.switchLevel(rt.level)}switchLevel(nt){const rt=this.hls.levels[nt];if(!rt)return;const it=rt.subtitleGroups||null,at=this.groupIds;let st=this.currentTrack;if(!it||(null==at?void 0:at.length)!==(null==it?void 0:it.length)||null!=it&&it.some((nt=>-1===(null==at?void 0:at.indexOf(nt))))){this.groupIds=it,this.trackId=-1,this.currentTrack=null;const nt=this.tracks.filter((nt=>!it||-1!==it.indexOf(nt.groupId)));if(nt.length)this.selectDefaultTrack&&!nt.some((nt=>nt.default))&&(this.selectDefaultTrack=!1),nt.forEach(((nt,rt)=>{nt.id=rt}));else if(!st&&!this.tracksInGroup.length)return;this.tracksInGroup=nt;const rt=this.hls.config.subtitlePreference;if(!st&&rt){this.selectDefaultTrack=!1;const it=findMatchingOption(rt,nt);if(it>-1)st=nt[it];else{const nt=findMatchingOption(rt,this.tracks);st=this.tracks[nt]}}let at=this.findTrackId(st);-1===at&&st&&(at=this.findTrackId(null));const ot={subtitleTracks:nt};this.log(`Updating subtitle tracks, ${nt.length} track(s) found in "${null==it?void 0:it.join(",")}" group-id`),this.hls.trigger(Ot.SUBTITLE_TRACKS_UPDATED,ot),-1!==at&&-1===this.trackId&&this.setSubtitleTrack(at)}else this.shouldReloadPlaylist(st)&&this.setSubtitleTrack(this.trackId)}findTrackId(nt){const rt=this.tracksInGroup,it=this.selectDefaultTrack;for(let at=0;at<rt.length;at++){const st=rt[at];if((!it||st.default)&&(it||nt)&&(!nt||matchesOption(st,nt)))return at}if(nt){for(let it=0;it<rt.length;it++){const at=rt[it];if(mediaAttributesIdentical(nt.attrs,at.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return it}for(let it=0;it<rt.length;it++){const at=rt[it];if(mediaAttributesIdentical(nt.attrs,at.attrs,["LANGUAGE"]))return it}}return-1}findTrackForTextTrack(nt){if(nt){const rt=this.tracksInGroup;for(let it=0;it<rt.length;it++){if(subtitleTrackMatchesTextTrack(rt[it],nt))return it}}return-1}onError(nt,rt){!rt.fatal&&rt.context&&(rt.context.type!==Gt||rt.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(rt.context.groupId)||this.checkRetry(rt))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(nt){this.selectDefaultTrack=!1,this.setSubtitleTrack(nt)}setSubtitleOption(nt){if(this.hls.config.subtitlePreference=nt,nt){if(-1===nt.id)return this.setSubtitleTrack(-1),null;const rt=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,rt.length){const it=this.currentTrack;if(it&&matchesOption(nt,it))return it;const at=findMatchingOption(nt,this.tracksInGroup);if(at>-1){const nt=this.tracksInGroup[at];return this.setSubtitleTrack(at),nt}if(it)return null;{const it=findMatchingOption(nt,rt);if(it>-1)return rt[it]}}}return null}loadPlaylist(nt){super.loadPlaylist();const rt=this.currentTrack;if(this.shouldLoadPlaylist(rt)&&rt){const it=rt.id,at=rt.groupId;let st=rt.url;if(nt)try{st=nt.addDirectives(st)}catch(nt){this.warn(`Could not construct new URL with HLS Delivery Directives: ${nt}`)}this.log(`Loading subtitle playlist for id ${it}`),this.hls.trigger(Ot.SUBTITLE_TRACK_LOADING,{url:st,id:it,groupId:at,deliveryDirectives:nt||null})}}toggleTrackModes(){const{media:nt}=this;if(!nt)return;const rt=filterSubtitleTracks(nt.textTracks),it=this.currentTrack;let at;if(it&&(at=rt.filter((nt=>subtitleTrackMatchesTextTrack(it,nt)))[0],at||this.warn(`Unable to find subtitle TextTrack with name "${it.name}" and language "${it.lang}"`)),[].slice.call(rt).forEach((nt=>{"disabled"!==nt.mode&&nt!==at&&(nt.mode="disabled")})),at){const nt=this.subtitleDisplay?"showing":"hidden";at.mode!==nt&&(at.mode=nt)}}setSubtitleTrack(nt){const rt=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=nt);if(nt<-1||nt>=rt.length||!wt(nt))return void this.warn(`Invalid subtitle track id: ${nt}`);this.clearTimer(),this.selectDefaultTrack=!1;const it=this.currentTrack,at=rt[nt]||null;if(this.trackId=nt,this.currentTrack=at,this.toggleTrackModes(),!at)return void this.hls.trigger(Ot.SUBTITLE_TRACK_SWITCH,{id:nt});const st=!!at.details&&!at.details.live;if(nt===this.trackId&&at===it&&st)return;this.log(`Switching to subtitle-track ${nt}`+(at?` "${at.name}" lang:${at.lang} group:${at.groupId}`:""));const{id:ot,groupId:lt="",name:ut,type:ct,url:dt}=at;this.hls.trigger(Ot.SUBTITLE_TRACK_SWITCH,{id:ot,groupId:lt,name:ut,type:ct,url:dt});const ht=this.switchParams(at.url,null==it?void 0:it.details,at.details);this.loadPlaylist(ht)}},timelineController:class TimelineController{constructor(nt){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=nt,this.config=nt.config,this.Cues=nt.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},nt.on(Ot.MEDIA_ATTACHING,this.onMediaAttaching,this),nt.on(Ot.MEDIA_DETACHING,this.onMediaDetaching,this),nt.on(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.on(Ot.MANIFEST_LOADED,this.onManifestLoaded,this),nt.on(Ot.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),nt.on(Ot.FRAG_LOADING,this.onFragLoading,this),nt.on(Ot.FRAG_LOADED,this.onFragLoaded,this),nt.on(Ot.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),nt.on(Ot.FRAG_DECRYPTED,this.onFragDecrypted,this),nt.on(Ot.INIT_PTS_FOUND,this.onInitPtsFound,this),nt.on(Ot.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),nt.on(Ot.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:nt}=this;nt.off(Ot.MEDIA_ATTACHING,this.onMediaAttaching,this),nt.off(Ot.MEDIA_DETACHING,this.onMediaDetaching,this),nt.off(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.off(Ot.MANIFEST_LOADED,this.onManifestLoaded,this),nt.off(Ot.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),nt.off(Ot.FRAG_LOADING,this.onFragLoading,this),nt.off(Ot.FRAG_LOADED,this.onFragLoaded,this),nt.off(Ot.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),nt.off(Ot.FRAG_DECRYPTED,this.onFragDecrypted,this),nt.off(Ot.INIT_PTS_FOUND,this.onInitPtsFound,this),nt.off(Ot.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),nt.off(Ot.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const nt=new OutputFilter(this,"textTrack1"),rt=new OutputFilter(this,"textTrack2"),it=new OutputFilter(this,"textTrack3"),at=new OutputFilter(this,"textTrack4");this.cea608Parser1=new Cea608Parser(1,nt,rt),this.cea608Parser2=new Cea608Parser(3,it,at)}addCues(nt,rt,it,at,st){let ot=!1;for(let nt=st.length;nt--;){const at=st[nt],ht=(lt=at[0],ut=at[1],ct=rt,dt=it,Math.min(ut,dt)-Math.max(lt,ct));if(ht>=0&&(at[0]=Math.min(at[0],rt),at[1]=Math.max(at[1],it),ot=!0,ht/(it-rt)>.5))return}var lt,ut,ct,dt;if(ot||st.push([rt,it]),this.config.renderTextTracksNatively){const st=this.captionsTracks[nt];this.Cues.newCue(st,rt,it,at)}else{const st=this.Cues.newCue(null,rt,it,at);this.hls.trigger(Ot.CUES_PARSED,{type:"captions",cues:st,track:nt})}}onInitPtsFound(nt,{frag:rt,id:it,initPTS:at,timescale:st}){const{unparsedVttFrags:ot}=this;it===Ht&&(this.initPTS[rt.cc]={baseTime:at,timescale:st}),ot.length&&(this.unparsedVttFrags=[],ot.forEach((nt=>{this.onFragLoaded(Ot.FRAG_LOADED,nt)})))}getExistingTrack(nt,rt){const{media:it}=this;if(it)for(let at=0;at<it.textTracks.length;at++){const st=it.textTracks[at];if(canReuseVttTextTrack(st,{name:nt,lang:rt,characteristics:"transcribes-spoken-dialog,describes-music-and-sound",attrs:{}}))return st}return null}createCaptionsTrack(nt){this.config.renderTextTracksNatively?this.createNativeTrack(nt):this.createNonNativeTrack(nt)}createNativeTrack(nt){if(this.captionsTracks[nt])return;const{captionsProperties:rt,captionsTracks:it,media:at}=this,{label:st,languageCode:ot}=rt[nt],lt=this.getExistingTrack(st,ot);if(lt)it[nt]=lt,clearCurrentCues(it[nt]),sendAddTrackEvent(it[nt],at);else{const rt=this.createTextTrack("captions",st,ot);rt&&(rt[nt]=!0,it[nt]=rt)}}createNonNativeTrack(nt){if(this.nonNativeCaptionsTracks[nt])return;const rt=this.captionsProperties[nt];if(!rt)return;const it={_id:nt,label:rt.label,kind:"captions",default:!!rt.media&&!!rt.media.default,closedCaptions:rt.media};this.nonNativeCaptionsTracks[nt]=it,this.hls.trigger(Ot.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[it]})}createTextTrack(nt,rt,it){const at=this.media;if(at)return at.addTextTrack(nt,rt,it)}onMediaAttaching(nt,rt){this.media=rt.media,rt.mediaSource||this._cleanTracks()}onMediaDetaching(nt,rt){const it=!!rt.transferMedia;if(this.media=null,it)return;const{captionsTracks:at}=this;Object.keys(at).forEach((nt=>{clearCurrentCues(at[nt]),delete at[nt]})),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:nt}=this;if(!nt)return;const rt=nt.textTracks;if(rt)for(let nt=0;nt<rt.length;nt++)clearCurrentCues(rt[nt])}onSubtitleTracksUpdated(nt,rt){const it=rt.subtitleTracks||[],at=it.some((nt=>nt.textCodec===cs));if(this.config.enableWebVTT||at&&this.config.enableIMSC1){if(subtitleOptionsIdentical(this.tracks,it))return void(this.tracks=it);if(this.textTracks=[],this.tracks=it,this.config.renderTextTracksNatively){const nt=this.media,rt=nt?filterSubtitleTracks(nt.textTracks):null;if(this.tracks.forEach(((nt,it)=>{let at;if(rt){let it=null;for(let at=0;at<rt.length;at++)if(rt[at]&&canReuseVttTextTrack(rt[at],nt)){it=rt[at],rt[at]=null;break}it&&(at=it)}if(at)clearCurrentCues(at);else{const rt=captionsOrSubtitlesFromCharacteristics(nt);at=this.createTextTrack(rt,nt.name,nt.lang),at&&(at.mode="disabled")}at&&this.textTracks.push(at)})),null!=rt&&rt.length){const nt=rt.filter((nt=>null!==nt)).map((nt=>nt.label));nt.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${nt.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const nt=this.tracks.map((nt=>({label:nt.name,kind:nt.type.toLowerCase(),default:nt.default,subtitleTrack:nt})));this.hls.trigger(Ot.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:nt})}}}onManifestLoaded(nt,rt){this.config.enableCEA708Captions&&rt.captions&&rt.captions.forEach((nt=>{const rt=/(?:CC|SERVICE)([1-4])/.exec(nt.instreamId);if(!rt)return;const it=`textTrack${rt[1]}`,at=this.captionsProperties[it];at&&(at.label=nt.name,nt.lang&&(at.languageCode=nt.lang),at.media=nt)}))}closedCaptionsForLevel(nt){const rt=this.hls.levels[nt.level];return null==rt?void 0:rt.attrs["CLOSED-CAPTIONS"]}onFragLoading(nt,rt){if(this.enabled&&rt.frag.type===Ht){var it,at;const{cea608Parser1:nt,cea608Parser2:st,lastSn:ot}=this,{cc:lt,sn:ut}=rt.frag,ct=null!=(it=null==(at=rt.part)?void 0:at.index)?it:-1;nt&&st&&(ut!==ot+1||ut===ot&&ct!==this.lastPartIndex+1||lt!==this.lastCc)&&(nt.reset(),st.reset()),this.lastCc=lt,this.lastSn=ut,this.lastPartIndex=ct}}onFragLoaded(nt,rt){const{frag:it,payload:at}=rt;if(it.type===Kt)if(at.byteLength){const nt=it.decryptdata,st="stats"in rt;if(null==nt||!nt.encrypted||st){const nt=this.tracks[it.level],st=this.vttCCs;st[it.cc]||(st[it.cc]={start:it.start,prevCC:this.prevCC,new:!0},this.prevCC=it.cc),nt&&nt.textCodec===cs?this._parseIMSC1(it,at):this._parseVTTs(rt)}}else this.hls.trigger(Ot.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:it,error:new Error("Empty subtitle payload")})}_parseIMSC1(nt,rt){const it=this.hls;parseIMSC1(rt,this.initPTS[nt.cc],(rt=>{this._appendCues(rt,nt.level),it.trigger(Ot.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:nt})}),(rt=>{it.logger.log(`Failed to parse IMSC1: ${rt}`),it.trigger(Ot.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:nt,error:rt})}))}_parseVTTs(nt){var rt;const{frag:it,payload:at}=nt,{initPTS:st,unparsedVttFrags:ot}=this,lt=st.length-1;if(!st[it.cc]&&-1===lt)return void ot.push(nt);const ut=this.hls;parseWebVTT(null!=(rt=it.initSegment)&&rt.data?appendUint8Array(it.initSegment.data,new Uint8Array(at)):at,this.initPTS[it.cc],this.vttCCs,it.cc,it.start,(nt=>{this._appendCues(nt,it.level),ut.trigger(Ot.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:it})}),(rt=>{const st="Missing initPTS for VTT MPEGTS"===rt.message;st?ot.push(nt):this._fallbackToIMSC1(it,at),ut.logger.log(`Failed to parse VTT cue: ${rt}`),st&&lt>it.cc||ut.trigger(Ot.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:it,error:rt})}))}_fallbackToIMSC1(nt,rt){const it=this.tracks[nt.level];it.textCodec||parseIMSC1(rt,this.initPTS[nt.cc],(()=>{it.textCodec=cs,this._parseIMSC1(nt,rt)}),(()=>{it.textCodec="wvtt"}))}_appendCues(nt,rt){const it=this.hls;if(this.config.renderTextTracksNatively){const it=this.textTracks[rt];if(!it||"disabled"===it.mode)return;nt.forEach((nt=>addCueToTrack(it,nt)))}else{const at=this.tracks[rt];if(!at)return;const st=at.default?"default":"subtitles"+rt;it.trigger(Ot.CUES_PARSED,{type:"subtitles",cues:nt,track:st})}}onFragDecrypted(nt,rt){const{frag:it}=rt;it.type===Kt&&this.onFragLoaded(Ot.FRAG_LOADED,rt)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(nt,rt){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:it,samples:at}=rt;if(it.type!==Ht||"NONE"!==this.closedCaptionsForLevel(it))for(let nt=0;nt<at.length;nt++){const rt=at[nt].bytes;if(rt){this.cea608Parser1||this.initCea608Parsers();const it=this.extractCea608Data(rt);this.cea608Parser1.addData(at[nt].pts,it[0]),this.cea608Parser2.addData(at[nt].pts,it[1])}}}onBufferFlushing(nt,{startOffset:rt,endOffset:it,endOffsetSubtitles:at,type:st}){const{media:ot}=this;if(ot&&!(ot.currentTime<it)){if(!st||"video"===st){const{captionsTracks:nt}=this;Object.keys(nt).forEach((at=>removeCuesInRange(nt[at],rt,it)))}if(this.config.renderTextTracksNatively&&0===rt&&void 0!==at){const{textTracks:nt}=this;Object.keys(nt).forEach((it=>removeCuesInRange(nt[it],rt,at)))}}}extractCea608Data(nt){const rt=[[],[]],it=31&nt[0];let at=2;for(let st=0;st<it;st++){const it=nt[at++],st=127&nt[at++],ot=127&nt[at++];if(0===st&&0===ot)continue;if(!!(4&it)){const nt=3&it;0!==nt&&1!==nt||(rt[nt].push(st),rt[nt].push(ot))}}return rt}},audioStreamController:class AudioStreamController extends BaseStreamController{constructor(nt,rt,it){super(nt,rt,it,"audio-stream-controller",jt),this.videoAnchor=null,this.mainFragLoading=null,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}registerListeners(){super.registerListeners();const{hls:nt}=this;nt.on(Ot.LEVEL_LOADED,this.onLevelLoaded,this),nt.on(Ot.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),nt.on(Ot.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),nt.on(Ot.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),nt.on(Ot.BUFFER_RESET,this.onBufferReset,this),nt.on(Ot.BUFFER_CREATED,this.onBufferCreated,this),nt.on(Ot.BUFFER_FLUSHING,this.onBufferFlushing,this),nt.on(Ot.BUFFER_FLUSHED,this.onBufferFlushed,this),nt.on(Ot.INIT_PTS_FOUND,this.onInitPtsFound,this),nt.on(Ot.FRAG_LOADING,this.onFragLoading,this),nt.on(Ot.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:nt}=this;nt&&(super.unregisterListeners(),nt.off(Ot.LEVEL_LOADED,this.onLevelLoaded,this),nt.off(Ot.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),nt.off(Ot.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),nt.off(Ot.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),nt.off(Ot.BUFFER_RESET,this.onBufferReset,this),nt.off(Ot.BUFFER_CREATED,this.onBufferCreated,this),nt.off(Ot.BUFFER_FLUSHING,this.onBufferFlushing,this),nt.off(Ot.BUFFER_FLUSHED,this.onBufferFlushed,this),nt.off(Ot.INIT_PTS_FOUND,this.onInitPtsFound,this),nt.on(Ot.FRAG_LOADING,this.onFragLoading,this),nt.off(Ot.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(nt,{frag:rt,id:it,initPTS:at,timescale:st}){if(it===Ht){const nt=rt.cc,it=this.fragCurrent;if(this.initPTS[nt]={baseTime:at,timescale:st},this.log(`InitPTS for cc: ${nt} found from main: ${at}/${st}`),this.videoAnchor=rt,this.state===Ci){const it=this.waitingData;(!it&&!this.loadingParts||it&&it.frag.cc!==nt)&&(this.nextLoadPosition=this.findSyncFrag(rt).start),this.tick()}else!this.hls.hasEnoughToStart&&it&&it.cc!==nt?(this.startFragRequested=!1,this.nextLoadPosition=this.findSyncFrag(rt).start,it.abortRequests(),this.resetLoadingState()):this.state===_i&&this.tick()}}findSyncFrag(nt){const rt=this.getLevelDetails(),it=nt.cc;return function findNearestWithCC(nt,rt,it){if(nt&&nt.startCC<=rt&&nt.endCC>=rt){const at=it.start,st=it.end;let ot=nt.fragments;if(!it.relurl){const{fragmentHint:rt}=nt;rt&&(ot=ot.concat(rt))}return BinarySearch_search(ot,(nt=>nt.cc<rt||nt.end<=at?1:nt.cc>rt||nt.start>=st?-1:0))}return null}(rt,it,nt)||rt&&findFragWithCC(rt.fragments,it)||nt}startLoad(nt){if(!this.levels)return this.startPosition=nt,void(this.state=gi);const rt=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),rt>0&&-1===nt?(this.log(`Override startPosition with lastCurrentTime @${rt.toFixed(3)}`),nt=rt,this.state=_i):this.state=bi,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=nt,this.tick()}doTick(){switch(this.state){case _i:this.doTickIdle();break;case bi:{var nt;const{levels:rt,trackId:it}=this,at=null==rt||null==(nt=rt[it])?void 0:nt.details;if(at){if(this.waitForCdnTuneIn(at))break;this.state=Ci}break}case Ti:{var rt;const nt=performance.now(),it=this.retryDate;if(!it||nt>=it||null!=(rt=this.media)&&rt.seeking){const{levels:nt,trackId:rt}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==nt?void 0:nt[rt])||null),this.state=_i}break}case Ci:{const nt=this.waitingData;if(nt){const{frag:rt,part:it,cache:at,complete:st}=nt,ot=this.videoAnchor;if(void 0!==this.initPTS[rt.cc]){this.waitingData=null,this.state=vi;const nt={frag:rt,part:it,payload:at.flush(),networkDetails:null};this._handleFragmentLoadProgress(nt),st&&super._handleFragmentLoadComplete(nt)}else ot&&ot.cc!==nt.frag.cc&&(this.log(`Waiting fragment cc (${rt.cc}) cancelled because video is at cc ${ot.cc}`),this.nextLoadPosition=this.findSyncFrag(ot).start,this.clearWaitingFragment())}else this.state!==gi&&(this.state=_i)}}this.onTickEnd()}clearWaitingFragment(){const nt=this.waitingData;nt&&(this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.fragmentTracker.removeFragment(nt.frag),this.waitingData=null,this.state!==gi&&(this.state=_i))}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:nt}=this;null!=nt&&nt.readyState&&(this.lastCurrentTime=nt.currentTime)}doTickIdle(){var nt;const{hls:rt,levels:it,media:at,trackId:st}=this,ot=rt.config;if(!this.buffering||!at&&(this.startFragRequested||!ot.startFragPrefetch)||null==it||!it[st])return;const lt=it[st],ut=lt.details;if(!ut||ut.live&&this.levelLastLoaded!==lt||this.waitForCdnTuneIn(ut))return void(this.state=bi);const ct=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&ct&&(this.bufferFlushed=!1,this.afterBufferFlushed(ct,Wn,jt));const dt=this.getFwdBufferInfo(ct,jt);if(null===dt)return;const{bufferedTrack:ht,switchingTrack:pt}=this;if(!pt&&this._streamEnded(dt,ut))return rt.trigger(Ot.BUFFER_EOS,{type:"audio"}),void(this.state=Ii);const _t=dt.len,Et=rt.maxBufferLength,St=ut.fragments,wt=St[0].start,Lt=this.getLoadPosition();let Ct=this.flushing?Lt:dt.end;if(pt&&at){const nt=Lt;ht&&!mediaAttributesIdentical(pt.attrs,ht.attrs)&&(Ct=nt),ut.PTSKnown&&nt<wt&&(dt.end>wt||dt.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),at.currentTime=wt+.05)}if(_t>=Et&&!pt&&Ct<St[St.length-1].start)return;let Pt=this.getNextFragment(Ct,ut);if(Pt&&this.isLoopLoading(Pt,Ct)&&(Pt=this.getNextFragmentLoopLoading(Pt,ut,dt,Ht,Et)),!Pt)return void(this.bufferFlushed=!0);const kt=null==(nt=this.mainFragLoading)?void 0:nt.frag;if(this.startFragRequested&&kt&&"initSegment"!==kt.sn&&"initSegment"!==Pt.sn&&!Pt.endList&&(!ut.live||!this.loadingParts&&Ct<this.hls.liveSyncPosition)){let nt=kt;if(Pt.start>nt.end){const rt=this.fragmentTracker.getFragAtPos(Ct,Ht);rt&&rt.end>kt.end&&(nt=rt,this.mainFragLoading={frag:rt,targetBufferTime:null})}if(Pt.start>nt.end)return}this.loadFragment(Pt,lt,Ct)}onMediaDetaching(nt,rt){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(nt,rt)}onAudioTracksUpdated(nt,{audioTracks:rt}){this.resetTransmuxer(),this.levels=rt.map((nt=>new Level(nt)))}onAudioTrackSwitching(nt,rt){const it=!!rt.url;this.trackId=rt.id;const{fragCurrent:at}=this;at&&(at.abortRequests(),this.removeUnbufferedFrags(at.start)),this.resetLoadingState(),it?(this.switchingTrack=rt,this.flushAudioIfNeeded(rt),this.state!==gi&&(this.setInterval(100),this.state=_i,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=rt,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=!1,this.mainDetails=this.waitingData=this.videoAnchor=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.trackId=-1}onLevelLoaded(nt,rt){this.mainDetails=rt.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(Ot.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(nt,rt){var it;if(null==this.mainDetails)return void(this.cachedTrackLoadedData=rt);const{levels:at}=this,{details:st,id:ot}=rt;if(!at)return void this.warn(`Audio tracks were reset while loading level ${ot}`);this.log(`Audio track ${ot} loaded [${st.startSN},${st.endSN}]${st.lastPartSn?`[part-${st.lastPartSn}-${st.lastPartIndex}]`:""},duration:${st.totalduration}`);const lt=at[ot];let ut=0;if(st.live||null!=(it=lt.details)&&it.live){this.checkLiveUpdate(st);const nt=this.mainDetails;if(st.deltaUpdateFailed||!nt)return;var ct;if(!lt.details&&st.hasProgramDateTime&&nt.hasProgramDateTime)alignMediaPlaylistByPDT(st,nt),ut=st.fragmentStart;else ut=this.alignPlaylists(st,lt.details,null==(ct=this.levelLastLoaded)?void 0:ct.details)}lt.details=st,this.levelLastLoaded=lt,this.startFragRequested||!this.mainDetails&&st.live||this.setStartPosition(this.mainDetails||st,ut),this.hls.trigger(Ot.AUDIO_TRACK_UPDATED,{details:st,id:ot,groupId:rt.groupId}),this.state!==bi||this.waitForCdnTuneIn(st)||(this.state=_i),this.tick()}_handleFragmentLoadProgress(nt){var rt;const it=nt.frag,{part:at,payload:st}=nt,{config:ot,trackId:lt,levels:ut}=this;if(!ut)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${it.sn} of level ${it.level} will not be buffered`);const ct=ut[lt];if(!ct)return void this.warn("Audio track is undefined on fragment load progress");const dt=ct.details;if(!dt)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(it.start);const ht=ot.defaultAudioCodec||ct.audioCodec||"mp4a.40.2";let pt=this.transmuxer;pt||(pt=this.transmuxer=new TransmuxerInterface(this.hls,jt,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const _t=this.initPTS[it.cc],Et=null==(rt=it.initSegment)?void 0:rt.data;if(void 0!==_t){const nt=!1,rt=at?at.index:-1,ot=-1!==rt,lt=new ChunkMetadata(it.level,it.sn,it.stats.chunkCount,st.byteLength,rt,ot);pt.push(st,Et,ht,"",it,at,dt.totalduration,nt,lt,_t)}else{this.log(`Unknown video PTS for cc ${it.cc}, waiting for video PTS before demuxing audio frag ${it.sn} of [${dt.startSN} ,${dt.endSN}],track ${lt}`);const{cache:nt}=this.waitingData=this.waitingData||{frag:it,part:at,cache:new ChunkCache,complete:!1};nt.push(new Uint8Array(st)),this.state=Ci}}_handleFragmentLoadComplete(nt){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(nt)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(nt,rt){this.bufferFlushed=this.flushing=!1;const it=rt.tracks.audio;it&&(this.mediaBuffer=it.buffer||null)}onFragLoading(nt,rt){rt.frag.type===Ht&&"initSegment"!==rt.frag.sn&&(this.mainFragLoading=rt,this.state===_i&&this.tick())}onFragBuffered(nt,rt){const{frag:it,part:at}=rt;if(it.type===jt)if(this.fragContextChanged(it))this.warn(`Fragment ${it.sn}${at?" p: "+at.index:""} of level ${it.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if("initSegment"!==it.sn){this.fragPrevious=it;const nt=this.switchingTrack;nt&&(this.bufferedTrack=nt,this.switchingTrack=null,this.hls.trigger(Ot.AUDIO_TRACK_SWITCHED,_objectSpread2({},nt)))}this.fragBufferedComplete(it,at),this.media&&this.tick()}}onError(nt,rt){var it;if(rt.fatal)this.state=wi;else switch(rt.details){case kt.FRAG_GAP:case kt.FRAG_PARSING_ERROR:case kt.FRAG_DECRYPT_ERROR:case kt.FRAG_LOAD_ERROR:case kt.FRAG_LOAD_TIMEOUT:case kt.KEY_LOAD_ERROR:case kt.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(jt,rt);break;case kt.AUDIO_TRACK_LOAD_ERROR:case kt.AUDIO_TRACK_LOAD_TIMEOUT:case kt.LEVEL_PARSING_ERROR:rt.levelRetry||this.state!==bi||(null==(it=rt.context)?void 0:it.type)!==Ut||(this.state=_i);break;case kt.BUFFER_APPEND_ERROR:case kt.BUFFER_FULL_ERROR:if(!rt.parent||"audio"!==rt.parent)return;if(rt.details===kt.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(rt)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case kt.INTERNAL_EXCEPTION:this.recoverWorkerError(rt)}}onBufferFlushing(nt,{type:rt}){rt!==Jn&&(this.flushing=!0)}onBufferFlushed(nt,{type:rt}){if(rt!==Jn){this.flushing=!1,this.bufferFlushed=!0,this.state===Ii&&(this.state=_i);const nt=this.mediaBuffer||this.media;nt&&(this.afterBufferFlushed(nt,rt,jt),this.tick())}}_handleTransmuxComplete(nt){var rt;const it="audio",{hls:at}=this,{remuxResult:st,chunkMeta:ot}=nt,lt=this.getCurrentContext(ot);if(!lt)return void this.resetWhenMissingContext(ot);const{frag:ut,part:ct,level:dt}=lt,{details:ht}=dt,{audio:pt,text:_t,id3:Et,initSegment:St}=st;if(!this.fragContextChanged(ut)&&ht){if(this.state=Ai,this.switchingTrack&&pt&&this.completeAudioSwitch(this.switchingTrack),null!=St&&St.tracks){const nt=ut.initSegment||ut;this._bufferInitSegment(dt,St.tracks,nt,ot),at.trigger(Ot.FRAG_PARSING_INIT_SEGMENT,{frag:nt,id:it,tracks:St.tracks})}if(pt){const{startPTS:nt,endPTS:rt,startDTS:it,endDTS:at}=pt;ct&&(ct.elementaryStreams[Wn]={startPTS:nt,endPTS:rt,startDTS:it,endDTS:at}),ut.setElementaryStreamInfo(Wn,nt,rt,it,at),this.bufferFragmentData(pt,ut,ct,ot)}if(null!=Et&&null!=(rt=Et.samples)&&rt.length){const nt=_extends({id:it,frag:ut,details:ht},Et);at.trigger(Ot.FRAG_PARSING_METADATA,nt)}if(_t){const nt=_extends({id:it,frag:ut,details:ht},_t);at.trigger(Ot.FRAG_PARSING_USERDATA,nt)}}else this.fragmentTracker.removeFragment(ut)}_bufferInitSegment(nt,rt,it,at){if(this.state!==Ai)return;if(rt.video&&delete rt.video,rt.audiovideo&&delete rt.audiovideo,!rt.audio)return;const st=rt.audio;st.id="audio";const ot=nt.audioCodec;this.log(`Init audio buffer, container:${st.container}, codecs[level/parsed]=[${ot}/${st.codec}]`),ot&&1===ot.split(",").length&&(st.levelCodec=ot),this.hls.trigger(Ot.BUFFER_CODECS,rt);const lt=st.initSegment;if(null!=lt&&lt.byteLength){const nt={type:"audio",frag:it,part:null,chunkMeta:at,parent:it.type,data:lt};this.hls.trigger(Ot.BUFFER_APPENDING,nt)}this.tickImmediate()}loadFragment(nt,rt,it){const at=this.fragmentTracker.getState(nt);var st;if(this.switchingTrack||at===Ln||at===Mn)if("initSegment"===nt.sn)this._loadInitSegment(nt,rt);else if(null!=(st=rt.details)&&st.live&&!this.initPTS[nt.cc]){this.log(`Waiting for video PTS in continuity counter ${nt.cc} of live stream before loading audio fragment ${nt.sn} of level ${this.trackId}`),this.state=Ci;const it=this.mainDetails;it&&it.fragmentStart!==rt.details.fragmentStart&&alignMediaPlaylistByPDT(rt.details,it)}else super.loadFragment(nt,rt,it);else this.clearTrackerIfNeeded(nt)}flushAudioIfNeeded(nt){const{media:rt,bufferedTrack:it}=this,at=null==it?void 0:it.attrs,st=nt.attrs;rt&&at&&(at.CHANNELS!==st.CHANNELS||it.name!==nt.name||it.lang!==nt.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(nt){const{hls:rt}=this;this.flushAudioIfNeeded(nt),this.bufferedTrack=nt,this.switchingTrack=null,rt.trigger(Ot.AUDIO_TRACK_SWITCHED,_objectSpread2({},nt))}},audioTrackController:class AudioTrackController extends BasePlaylistController{constructor(nt){super(nt,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:nt}=this;nt.on(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.on(Ot.MANIFEST_PARSED,this.onManifestParsed,this),nt.on(Ot.LEVEL_LOADING,this.onLevelLoading,this),nt.on(Ot.LEVEL_SWITCHING,this.onLevelSwitching,this),nt.on(Ot.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),nt.on(Ot.ERROR,this.onError,this)}unregisterListeners(){const{hls:nt}=this;nt.off(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.off(Ot.MANIFEST_PARSED,this.onManifestParsed,this),nt.off(Ot.LEVEL_LOADING,this.onLevelLoading,this),nt.off(Ot.LEVEL_SWITCHING,this.onLevelSwitching,this),nt.off(Ot.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),nt.off(Ot.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(nt,rt){this.tracks=rt.audioTracks||[]}onAudioTrackLoaded(nt,rt){const{id:it,groupId:at,details:st}=rt,ot=this.tracksInGroup[it];if(!ot||ot.groupId!==at)return void this.warn(`Audio track with id:${it} and group:${at} not found in active group ${null==ot?void 0:ot.groupId}`);const lt=ot.details;ot.details=rt.details,this.log(`Audio track ${it} "${ot.name}" lang:${ot.lang} group:${at} loaded [${st.startSN}-${st.endSN}]`),it===this.trackId&&this.playlistLoaded(it,rt,lt)}onLevelLoading(nt,rt){this.switchLevel(rt.level)}onLevelSwitching(nt,rt){this.switchLevel(rt.level)}switchLevel(nt){const rt=this.hls.levels[nt];if(!rt)return;const it=rt.audioGroups||null,at=this.groupIds;let st=this.currentTrack;if(!it||(null==at?void 0:at.length)!==(null==it?void 0:it.length)||null!=it&&it.some((nt=>-1===(null==at?void 0:at.indexOf(nt))))){this.groupIds=it,this.trackId=-1,this.currentTrack=null;const nt=this.tracks.filter((nt=>!it||-1!==it.indexOf(nt.groupId)));if(nt.length)this.selectDefaultTrack&&!nt.some((nt=>nt.default))&&(this.selectDefaultTrack=!1),nt.forEach(((nt,rt)=>{nt.id=rt}));else if(!st&&!this.tracksInGroup.length)return;this.tracksInGroup=nt;const rt=this.hls.config.audioPreference;if(!st&&rt){const it=findMatchingOption(rt,nt,audioMatchPredicate);if(it>-1)st=nt[it];else{const nt=findMatchingOption(rt,this.tracks);st=this.tracks[nt]}}let at=this.findTrackId(st);-1===at&&st&&(at=this.findTrackId(null));const lt={audioTracks:nt};this.log(`Updating audio tracks, ${nt.length} track(s) found in group(s): ${null==it?void 0:it.join(",")}`),this.hls.trigger(Ot.AUDIO_TRACKS_UPDATED,lt);const ut=this.trackId;if(-1!==at&&-1===ut)this.setAudioTrack(at);else if(nt.length&&-1===ut){var ot;const rt=new Error(`No audio track selected for current audio group-ID(s): ${null==(ot=this.groupIds)?void 0:ot.join(",")} track count: ${nt.length}`);this.warn(rt.message),this.hls.trigger(Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:rt})}}else this.shouldReloadPlaylist(st)&&this.setAudioTrack(this.trackId)}onError(nt,rt){!rt.fatal&&rt.context&&(rt.context.type!==Ut||rt.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(rt.context.groupId)||(this.requestScheduled=-1,this.checkRetry(rt)))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(nt){this.selectDefaultTrack=!1,this.setAudioTrack(nt)}setAudioOption(nt){const rt=this.hls;if(rt.config.audioPreference=nt,nt){const it=this.allAudioTracks;if(this.selectDefaultTrack=!1,it.length){const at=this.currentTrack;if(at&&matchesOption(nt,at,audioMatchPredicate))return at;const st=findMatchingOption(nt,this.tracksInGroup,audioMatchPredicate);if(st>-1){const nt=this.tracksInGroup[st];return this.setAudioTrack(st),nt}if(at){let at=rt.loadLevel;-1===at&&(at=rt.firstAutoLevel);const st=function findClosestLevelWithAudioGroup(nt,rt,it,at,st){const ot=rt[at],lt=rt.reduce(((nt,rt,it)=>{const at=rt.uri;return(nt[at]||(nt[at]=[])).push(it),nt}),{})[ot.uri];lt.length>1&&(at=Math.max.apply(Math,lt));const ut=ot.videoRange,ct=ot.frameRate,dt=ot.codecSet.substring(0,4),ht=searchDownAndUpList(rt,at,(rt=>{if(rt.videoRange!==ut||rt.frameRate!==ct||rt.codecSet.substring(0,4)!==dt)return!1;const at=rt.audioGroups,ot=it.filter((nt=>!at||-1!==at.indexOf(nt.groupId)));return findMatchingOption(nt,ot,st)>-1}));return ht>-1?ht:searchDownAndUpList(rt,at,(rt=>{const at=rt.audioGroups,ot=it.filter((nt=>!at||-1!==at.indexOf(nt.groupId)));return findMatchingOption(nt,ot,st)>-1}))}(nt,rt.levels,it,at,audioMatchPredicate);if(-1===st)return null;rt.nextLoadLevel=st}if(nt.channels||nt.audioCodec){const rt=findMatchingOption(nt,it);if(rt>-1)return it[rt]}}}return null}setAudioTrack(nt){const rt=this.tracksInGroup;if(nt<0||nt>=rt.length)return void this.warn(`Invalid audio track id: ${nt}`);this.clearTimer(),this.selectDefaultTrack=!1;const it=this.currentTrack,at=rt[nt],st=at.details&&!at.details.live;if(nt===this.trackId&&at===it&&st)return;if(this.log(`Switching to audio-track ${nt} "${at.name}" lang:${at.lang} group:${at.groupId} channels:${at.channels}`),this.trackId=nt,this.currentTrack=at,this.hls.trigger(Ot.AUDIO_TRACK_SWITCHING,_objectSpread2({},at)),st)return;const ot=this.switchParams(at.url,null==it?void 0:it.details,at.details);this.loadPlaylist(ot)}findTrackId(nt){const rt=this.tracksInGroup;for(let it=0;it<rt.length;it++){const at=rt[it];if((!this.selectDefaultTrack||at.default)&&(!nt||matchesOption(nt,at,audioMatchPredicate)))return it}if(nt){const{name:it,lang:at,assocLang:st,characteristics:ot,audioCodec:lt,channels:ut}=nt;for(let nt=0;nt<rt.length;nt++){if(matchesOption({name:it,lang:at,assocLang:st,characteristics:ot,audioCodec:lt,channels:ut},rt[nt],audioMatchPredicate))return nt}for(let it=0;it<rt.length;it++){const at=rt[it];if(mediaAttributesIdentical(nt.attrs,at.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return it}for(let it=0;it<rt.length;it++){const at=rt[it];if(mediaAttributesIdentical(nt.attrs,at.attrs,["LANGUAGE"]))return it}}return-1}loadPlaylist(nt){const rt=this.currentTrack;if(this.shouldLoadPlaylist(rt)&&rt){super.loadPlaylist();const it=rt.id,at=rt.groupId;let st=rt.url;if(nt)try{st=nt.addDirectives(st)}catch(nt){this.warn(`Could not construct new URL with HLS Delivery Directives: ${nt}`)}this.log(`loading audio-track playlist ${it} "${rt.name}" lang:${rt.lang} group:${at}`),this.clearTimer(),this.hls.trigger(Ot.AUDIO_TRACK_LOADING,{url:st,id:it,groupId:at,deliveryDirectives:nt||null})}}},emeController:EMEController,cmcdController:class CMCDController{constructor(nt){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=nt=>{try{this.apply(nt,{ot:ca.MANIFEST,su:!this.initialized})}catch(nt){this.hls.logger.warn("Could not generate manifest CMCD data.",nt)}},this.applyFragmentData=nt=>{try{const{frag:rt,part:it}=nt,at=this.hls.levels[rt.level],st=this.getObjectType(rt),ot={d:1e3*(it||rt).duration,ot:st};st!==ca.VIDEO&&st!==ca.AUDIO&&st!=ca.MUXED||(ot.br=at.bitrate/1e3,ot.tb=this.getTopBandwidth(st)/1e3,ot.bl=this.getBufferLength(st));const lt=it?this.getNextPart(it):this.getNextFrag(rt);null!=lt&&lt.url&&lt.url!==rt.url&&(ot.nor=lt.url),this.apply(nt,ot)}catch(nt){this.hls.logger.warn("Could not generate segment CMCD data.",nt)}},this.hls=nt;const rt=this.config=nt.config,{cmcd:it}=rt;null!=it&&(rt.pLoader=this.createPlaylistLoader(),rt.fLoader=this.createFragmentLoader(),this.sid=it.sessionId||nt.sessionId,this.cid=it.contentId,this.useHeaders=!0===it.useHeaders,this.includeKeys=it.includeKeys,this.registerListeners())}registerListeners(){const nt=this.hls;nt.on(Ot.MEDIA_ATTACHED,this.onMediaAttached,this),nt.on(Ot.MEDIA_DETACHED,this.onMediaDetached,this),nt.on(Ot.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const nt=this.hls;nt.off(Ot.MEDIA_ATTACHED,this.onMediaAttached,this),nt.off(Ot.MEDIA_DETACHED,this.onMediaDetached,this),nt.off(Ot.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(nt,rt){this.media=rt.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(nt,rt){var it,at;this.audioBuffer=null==(it=rt.tracks.audio)?void 0:it.buffer,this.videoBuffer=null==(at=rt.tracks.video)?void 0:at.buffer}createData(){var nt;return{v:1,sf:da.HLS,sid:this.sid,cid:this.cid,pr:null==(nt=this.media)?void 0:nt.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(nt,rt={}){_extends(rt,this.createData());const it=rt.ot===ca.INIT||rt.ot===ca.VIDEO||rt.ot===ca.MUXED;this.starved&&it&&(rt.bs=!0,rt.su=!0,this.starved=!1),null==rt.su&&(rt.su=this.buffering);const{includeKeys:at}=this;at&&(rt=Object.keys(rt).reduce(((nt,it)=>(at.includes(it)&&(nt[it]=rt[it]),nt)),{}));const st={baseUrl:nt.url};this.useHeaders?(nt.headers||(nt.headers={}),appendCmcdHeaders(nt.headers,rt,st)):nt.url=appendCmcdQuery(nt.url,rt,st)}getNextFrag(nt){var rt;const it=null==(rt=this.hls.levels[nt.level])?void 0:rt.details;if(it){const rt=nt.sn-it.startSN;return it.fragments[rt+1]}}getNextPart(nt){var rt,it;const{index:at,fragment:st}=nt,ot=null==(rt=this.hls.levels[st.level])||null==(it=rt.details)?void 0:it.partList;if(ot){const{sn:nt}=st;for(let rt=ot.length-1;rt>=0;rt--){const it=ot[rt];if(it.index===at&&it.fragment.sn===nt)return ot[rt+1]}}}getObjectType(nt){const{type:rt}=nt;return"subtitle"===rt?ca.TIMED_TEXT:"initSegment"===nt.sn?ca.INIT:"audio"===rt?ca.AUDIO:"main"===rt?this.hls.audioTracks.length?ca.VIDEO:ca.MUXED:void 0}getTopBandwidth(nt){let rt,it=0;const at=this.hls;if(nt===ca.AUDIO)rt=at.audioTracks;else{const nt=at.maxAutoLevel,it=nt>-1?nt+1:at.levels.length;rt=at.levels.slice(0,it)}for(const nt of rt)nt.bitrate>it&&(it=nt.bitrate);return it>0?it:NaN}getBufferLength(nt){const rt=this.media,it=nt===ca.AUDIO?this.audioBuffer:this.videoBuffer;if(!it||!rt)return NaN;return 1e3*BufferHelper.bufferInfo(it,rt.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:nt}=this.config,rt=this.applyPlaylistData,it=nt||this.config.loader;return class CmcdPlaylistLoader{constructor(nt){this.loader=void 0,this.loader=new it(nt)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(nt,it,at){rt(nt),this.loader.load(nt,it,at)}}}createFragmentLoader(){const{fLoader:nt}=this.config,rt=this.applyFragmentData,it=nt||this.config.loader;return class CmcdFragmentLoader{constructor(nt){this.loader=void 0,this.loader=new it(nt)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(nt,it,at){rt(nt),this.loader.load(nt,it,at)}}}},contentSteeringController:class ContentSteeringController extends Logger{constructor(nt){super("content-steering",nt.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=nt,this.registerListeners()}registerListeners(){const nt=this.hls;nt.on(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.on(Ot.MANIFEST_LOADED,this.onManifestLoaded,this),nt.on(Ot.MANIFEST_PARSED,this.onManifestParsed,this),nt.on(Ot.ERROR,this.onError,this)}unregisterListeners(){const nt=this.hls;nt&&(nt.off(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.off(Ot.MANIFEST_LOADED,this.onManifestLoaded,this),nt.off(Ot.MANIFEST_PARSED,this.onManifestParsed,this),nt.off(Ot.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce(((nt,rt)=>(-1===nt.indexOf(rt.pathwayId)&&nt.push(rt.pathwayId),nt)),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(nt){this.updatePathwayPriority(nt)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const nt=1e3*this.timeToLoad-(performance.now()-this.updated);if(nt>0)return void this.scheduleRefresh(this.uri,nt)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(nt){const rt=this.levels;rt&&(this.levels=rt.filter((rt=>rt!==nt)))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(nt,rt){const{contentSteering:it}=rt;null!==it&&(this.pathwayId=it.pathwayId,this.uri=it.uri,this.started&&this.startLoad())}onManifestParsed(nt,rt){this.audioTracks=rt.audioTracks,this.subtitleTracks=rt.subtitleTracks}onError(nt,rt){const{errorAction:it}=rt;if((null==it?void 0:it.action)===En&&it.flags===Rn){const nt=this.levels;let at=this._pathwayPriority,st=this.pathwayId;if(rt.context){const{groupId:it,pathwayId:at,type:ot}=rt.context;it&&nt?st=this.getPathwayForGroupId(it,ot,st):at&&(st=at)}st in this.penalizedPathways||(this.penalizedPathways[st]=performance.now()),!at&&nt&&(at=this.pathways()),at&&at.length>1&&(this.updatePathwayPriority(at),it.resolved=this.pathwayId!==st),it.resolved||this.warn(`Could not resolve ${rt.details} ("${rt.error.message}") with content-steering for Pathway: ${st} levels: ${nt?nt.length:nt} priorities: ${JSON.stringify(at)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(nt){this.levels=nt;let rt=this.getLevelsForPathway(this.pathwayId);if(0===rt.length){const it=nt[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${it}"`),rt=this.getLevelsForPathway(it),this.pathwayId=it}return rt.length!==nt.length&&this.log(`Found ${rt.length}/${nt.length} levels in Pathway "${this.pathwayId}"`),rt}getLevelsForPathway(nt){return null===this.levels?[]:this.levels.filter((rt=>nt===rt.pathwayId))}updatePathwayPriority(nt){let rt;this._pathwayPriority=nt;const it=this.penalizedPathways,at=performance.now();Object.keys(it).forEach((nt=>{at-it[nt]>3e5&&delete it[nt]}));for(let at=0;at<nt.length;at++){const st=nt[at];if(st in it)continue;if(st===this.pathwayId)return;const ot=this.hls.nextLoadLevel,lt=this.hls.levels[ot];if(rt=this.getLevelsForPathway(st),rt.length>0){this.log(`Setting Pathway to "${st}"`),this.pathwayId=st,reassignFragmentLevelIndexes(rt),this.hls.trigger(Ot.LEVELS_UPDATED,{levels:rt});const nt=this.hls.levels[ot];lt&&nt&&this.levels&&(nt.attrs["STABLE-VARIANT-ID"]!==lt.attrs["STABLE-VARIANT-ID"]&&nt.bitrate!==lt.bitrate&&this.log(`Unstable Pathways change from bitrate ${lt.bitrate} to ${nt.bitrate}`),this.hls.nextLoadLevel=ot);break}}}getPathwayForGroupId(nt,rt,it){const at=this.getLevelsForPathway(it).concat(this.levels||[]);for(let it=0;it<at.length;it++)if(rt===Ut&&at[it].hasAudioGroup(nt)||rt===Gt&&at[it].hasSubtitleGroup(nt))return at[it].pathwayId;return it}clonePathways(nt){const rt=this.levels;if(!rt)return;const it={},at={};nt.forEach((nt=>{const{ID:st,"BASE-ID":ot,"URI-REPLACEMENT":lt}=nt;if(rt.some((nt=>nt.pathwayId===st)))return;const ut=this.getLevelsForPathway(ot).map((nt=>{const rt=new AttrList(nt.attrs);rt["PATHWAY-ID"]=st;const ot=rt.AUDIO&&`${rt.AUDIO}_clone_${st}`,ut=rt.SUBTITLES&&`${rt.SUBTITLES}_clone_${st}`;ot&&(it[rt.AUDIO]=ot,rt.AUDIO=ot),ut&&(at[rt.SUBTITLES]=ut,rt.SUBTITLES=ut);const ct=performUriReplacement(nt.uri,rt["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",lt),dt=new Level({attrs:rt,audioCodec:nt.audioCodec,bitrate:nt.bitrate,height:nt.height,name:nt.name,url:ct,videoCodec:nt.videoCodec,width:nt.width});if(nt.audioGroups)for(let rt=1;rt<nt.audioGroups.length;rt++)dt.addGroupId("audio",`${nt.audioGroups[rt]}_clone_${st}`);if(nt.subtitleGroups)for(let rt=1;rt<nt.subtitleGroups.length;rt++)dt.addGroupId("text",`${nt.subtitleGroups[rt]}_clone_${st}`);return dt}));rt.push(...ut),cloneRenditionGroups(this.audioTracks,it,lt,st),cloneRenditionGroups(this.subtitleTracks,at,lt,st)}))}loadSteeringManifest(nt){const rt=this.hls.config,it=rt.loader;let at;this.loader&&this.loader.destroy(),this.loader=new it(rt);try{at=new self.URL(nt)}catch(rt){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${nt}`)}if("data:"!==at.protocol){const nt=0|(this.hls.bandwidthEstimate||rt.abrEwmaDefaultEstimate);at.searchParams.set("_HLS_pathway",this.pathwayId),at.searchParams.set("_HLS_throughput",""+nt)}const st={responseType:"json",url:at.href},ot=rt.steeringManifestLoadPolicy.default,lt=ot.errorRetry||ot.timeoutRetry||{},ut={loadPolicy:ot,timeout:ot.maxLoadTimeMs,maxRetry:lt.maxNumRetry||0,retryDelay:lt.retryDelayMs||0,maxRetryDelay:lt.maxRetryDelayMs||0},ct={onSuccess:(nt,rt,it,st)=>{this.log(`Loaded steering manifest: "${at}"`);const ot=nt.data;if(1!==(null==ot?void 0:ot.VERSION))return void this.log(`Steering VERSION ${ot.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=ot.TTL;const{"RELOAD-URI":lt,"PATHWAY-CLONES":ut,"PATHWAY-PRIORITY":ct}=ot;if(lt)try{this.uri=new self.URL(lt,at).href}catch(nt){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${lt}`)}this.scheduleRefresh(this.uri||it.url),ut&&this.clonePathways(ut);const dt={steeringManifest:ot,url:at.toString()};this.hls.trigger(Ot.STEERING_MANIFEST_LOADED,dt),ct&&this.updatePathwayPriority(ct)},onError:(nt,rt,it,at)=>{if(this.log(`Error loading steering manifest: ${nt.code} ${nt.text} (${rt.url})`),this.stopLoad(),410===nt.code)return this.enabled=!1,void this.log(`Steering manifest ${rt.url} no longer available`);let st=1e3*this.timeToLoad;if(429!==nt.code)this.scheduleRefresh(this.uri||rt.url,st);else{const nt=this.loader;if("function"==typeof(null==nt?void 0:nt.getResponseHeader)){const rt=nt.getResponseHeader("Retry-After");rt&&(st=1e3*parseFloat(rt))}this.log(`Steering manifest ${rt.url} rate limited`)}},onTimeout:(nt,rt,it)=>{this.log(`Timeout loading steering manifest (${rt.url})`),this.scheduleRefresh(this.uri||rt.url)}};this.log(`Requesting steering manifest: ${at}`),this.loader.load(st,ut,ct)}scheduleRefresh(nt,rt=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout((()=>{var rt;const it=null==(rt=this.hls)?void 0:rt.media;!it||it.ended?this.scheduleRefresh(nt,1e3*this.timeToLoad):this.loadSteeringManifest(nt)}),rt)}},interstitialsController:class InterstitialsController extends Logger{constructor(nt,rt){super("interstitials",nt.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.playingAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onSeeking=()=>{const nt=this.currentTime;if(void 0===nt||this.playbackDisabled)return;const rt=nt-this.timelinePos;if(Math.abs(rt)<1/7056e5)return;const it=rt<=-.01;this.timelinePos=nt,this.bufferedPos=nt,this.checkBuffer();const at=this.playingItem;if(!at)return;if(it&&nt<at.start||nt>=at.end){var st;const nt=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(at)&&null!=(st=this.media)&&st.paused&&(this.shouldPlay=!1),!it){const rt=this.findItemIndex(at);if(nt>rt){const it=this.schedule.findJumpRestrictedIndex(rt+1,nt);if(it>rt)return void this.setSchedulePosition(it)}}return void this.setSchedulePosition(nt)}const ot=this.playingAsset;if(!ot){if(this.playingLastItem&&this.isInterstitial(at)){const rt=at.event.assetList[0];rt&&(this.playingItem=null,this.setScheduleToAssetAtTime(nt,rt))}return}const lt=ot.timelineStart,ut=ot.duration||0;(it&&nt<lt||nt>=lt+ut)&&this.setScheduleToAssetAtTime(nt,ot)},this.onTimeupdate=()=>{const nt=this.currentTime;if(void 0===nt||this.playbackDisabled)return;if(!(nt>this.timelinePos))return;nt>this.bufferedPos&&this.checkBuffer(),this.timelinePos=nt;const rt=this.playingItem;if(!rt||this.playingLastItem)return;if(nt>=rt.end){this.timelinePos=rt.end;const nt=this.findItemIndex(rt);this.setSchedulePosition(nt+1)}const it=this.playingAsset;if(!it)return;nt>=it.timelineStart+(it.duration||0)&&this.setScheduleToAssetAtTime(nt,it)},this.onScheduleUpdate=(nt,rt)=>{const it=this.schedule,at=this.playingItem,st=it.events||[],ot=it.items||[],lt=it.durations,ut=nt.map((nt=>nt.identifier)),ct=!(!st.length&&!ut.length);ct&&(!1===this.hls.config.interstitialAppendInPlace&&st.forEach((nt=>nt.appendInPlace=!1)),this.log(`INTERSTITIALS_UPDATED (${st.length}): ${st}\nSchedule: ${ot.map((nt=>segmentToString(nt)))}`)),ut.length&&this.log(`Removed events ${ut}`),this.isInterstitial(at)&&ut.includes(at.event.identifier)&&this.warn(`Interstitial "${at.event.identifier}" removed while playing`),this.playerQueue.forEach((nt=>{if(nt.interstitial.appendInPlace){const rt=nt.assetItem.timelineStart,it=nt.timelineOffset-rt;if(it)try{nt.timelineOffset=rt}catch(at){Math.abs(it)>Ua&&this.warn(`${at} ("${nt.assetId}" ${nt.timelineOffset}->${rt})`)}}})),at&&!at.event&&(this.playingItem=this.updateItem(at,this.timelinePos));const dt=this.bufferingItem;dt&&(dt.event?this.updateItem(dt)||(this.bufferingItem=null,this.clearInterstitial(dt.event)):this.bufferingItem=this.updateItem(dt,this.bufferedPos)),this.waitingItem=this.updateItem(this.waitingItem),nt.forEach((nt=>{nt.assetList.forEach((nt=>{this.clearAssetPlayer(nt.identifier)}))})),(ct||rt)&&(this.hls.trigger(Ot.INTERSTITIALS_UPDATED,{events:st.slice(0),schedule:ot.slice(0),durations:lt,removedIds:ut}),this.checkBuffer())},this.hls=nt,this.HlsPlayerClass=rt,this.assetListLoader=new AssetListLoader(nt),this.schedule=new InterstitialsSchedule(this.onScheduleUpdate),this.registerListeners()}registerListeners(){const nt=this.hls;nt.on(Ot.MEDIA_ATTACHING,this.onMediaAttaching,this),nt.on(Ot.MEDIA_ATTACHED,this.onMediaAttached,this),nt.on(Ot.MEDIA_DETACHING,this.onMediaDetaching,this),nt.on(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.on(Ot.LEVEL_UPDATED,this.onLevelUpdated,this),nt.on(Ot.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),nt.on(Ot.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),nt.on(Ot.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),nt.on(Ot.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),nt.on(Ot.ASSET_LIST_LOADED,this.onAssetListLoaded,this),nt.on(Ot.BUFFER_APPENDED,this.onBufferAppended,this),nt.on(Ot.BUFFER_FLUSHED,this.onBufferFlushed,this),nt.on(Ot.BUFFERED_TO_END,this.onBufferedToEnd,this),nt.on(Ot.MEDIA_ENDED,this.onMediaEnded,this),nt.on(Ot.ERROR,this.onError,this),nt.on(Ot.DESTROYING,this.onDestroying,this)}unregisterListeners(){const nt=this.hls;nt&&(nt.off(Ot.MEDIA_ATTACHING,this.onMediaAttaching,this),nt.off(Ot.MEDIA_ATTACHED,this.onMediaAttached,this),nt.off(Ot.MEDIA_DETACHING,this.onMediaDetaching,this),nt.off(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.off(Ot.LEVEL_UPDATED,this.onLevelUpdated,this),nt.off(Ot.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),nt.off(Ot.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),nt.off(Ot.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),nt.off(Ot.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),nt.off(Ot.ASSET_LIST_LOADED,this.onAssetListLoaded,this),nt.off(Ot.BUFFER_CODECS,this.onBufferCodecs,this),nt.off(Ot.BUFFER_APPENDED,this.onBufferAppended,this),nt.off(Ot.BUFFER_FLUSHED,this.onBufferFlushed,this),nt.off(Ot.BUFFERED_TO_END,this.onBufferedToEnd,this),nt.off(Ot.MEDIA_ENDED,this.onMediaEnded,this),nt.off(Ot.ERROR,this.onError,this),nt.off(Ot.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){this.playerQueue.forEach((nt=>nt.resumeBuffering()))}pauseBuffering(){this.playerQueue.forEach((nt=>nt.pauseBuffering()))}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const nt=this.primaryMedia;nt&&this.removeMediaListeners(nt)}removeMediaListeners(nt){nt.removeEventListener("play",this.onPlay),nt.removeEventListener("seeking",this.onSeeking),nt.removeEventListener("timeupdate",this.onTimeupdate)}onMediaAttaching(nt,rt){const it=this.media=rt.media;this.removeMediaListeners(it),it.addEventListener("seeking",this.onSeeking),it.addEventListener("timeupdate",this.onTimeupdate),it.addEventListener("play",this.onPlay)}onMediaAttached(nt,rt){const it=this.playingItem,at=this.detachedData;if(this.detachedData=null,null===it)this.checkStart();else if(!at){this.clearScheduleState();const nt=this.findItemIndex(it);this.setSchedulePosition(nt)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.playingAsset=this.bufferingAsset=null}onMediaDetaching(nt,rt){const it=!!rt.transferMedia,at=this.media;if(this.media=null,!it&&(at&&this.removeMediaListeners(at),this.detachedData)){const nt=this.getBufferingPlayer();nt&&(this.playingAsset=null,this.bufferingAsset=null,this.bufferingItem=null,this.waitingItem=null,this.detachedData=null,nt.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls||!this.schedule.events)return null;const nt=this,effectiveBufferingItem=()=>nt.bufferingItem||nt.waitingItem,effectivePlayingItem=()=>nt.playingItem||nt.waitingItem,getAssetPlayer=rt=>rt?nt.getAssetPlayer(rt.identifier):rt,getMappedTime=(rt,it,at,st,ot)=>{if(rt){let lt=rt[it].start;const ut=rt.event;if(ut){if("playout"===it||ut.timelineOccupancy!==qa.Point){const nt=getAssetPlayer(at);(null==nt?void 0:nt.interstitial)===ut&&(lt+=nt.assetItem.startOffset+nt[ot])}}else{lt+=("bufferedPos"===st?getBufferedEnd():nt[st])-rt.start}return lt}return 0},findMappedTime=(rt,it)=>{if(0!==rt&&"primary"!==it&&nt.schedule.length){var at;const st=nt.schedule.findItemIndexAtTime(rt),ot=null==(at=nt.schedule.items)?void 0:at[st];if(ot){return rt+(ot[it].start-ot.start)}}return rt},getBufferedEnd=()=>{const rt=nt.bufferedPos;return rt===Number.MAX_VALUE?getMappedDuration("primary"):rt},getMappedDuration=rt=>{var it;return null!=(it=nt.primaryDetails)&&it.live?nt.primaryDetails.edge:nt.schedule.durations[rt]},seekTo=(rt,it)=>{var at,st;const ot=effectivePlayingItem();if(null!=ot&&null!=(at=ot.event)&&at.restrictions.skip)return;nt.log(`seek to ${rt} "${it}"`);const lt=effectivePlayingItem(),ut=nt.schedule.findItemIndexAtTime(rt,it),ct=null==(st=nt.schedule.items)?void 0:st[ut],dt=null==lt?void 0:lt.event,ht=null==dt?void 0:dt.appendInPlace,pt=lt&&nt.itemsMatch(lt,ct);if(lt&&(ht||pt)){const at=getAssetPlayer(nt.playingAsset),st=(null==at?void 0:at.media)||nt.hls.media;if(st){const ot=rt-("primary"===it?st.currentTime:getMappedTime(lt,it,nt.playingAsset,"timelinePos","currentTime")),ut=st.currentTime+ot;if(ut>=0&&(!at||ht||ut<=at.duration))return void(st.currentTime=ut)}}if(ct){let at=rt;if("primary"!==it){const nt=rt-ct[it].start;at=ct.start+nt}const st=!nt.isInterstitial(ct);if(nt.isInterstitial(lt)||!st&&!ct.event.appendInPlace){if(lt){const ot=nt.findItemIndex(lt);if(ut>ot){const rt=nt.schedule.findJumpRestrictedIndex(ot+1,ut);if(rt>ot)return void nt.setSchedulePosition(rt)}let dt=0;if(st)nt.timelinePos=at;else{var _t;const nt=null==ct||null==(_t=ct.event)?void 0:_t.assetList;if(nt){const at=rt-(ct[it]||ct).start;for(let rt=nt.length;rt--;){const it=nt[rt];if(it.duration&&at>=it.startOffset&&at<it.startOffset+it.duration){dt=rt;break}}}}nt.setSchedulePosition(ut,dt)}}else{const rt=nt.hls.media;rt&&(rt.currentTime=at)}}};this.manager={get events(){var rt,it;return(null==(rt=nt.schedule)||null==(it=rt.events)?void 0:it.slice(0))||[]},get schedule(){var rt,it;return(null==(rt=nt.schedule)||null==(it=rt.items)?void 0:it.slice(0))||[]},get playerQueue(){return nt.playerQueue.slice(0)},get bufferingPlayer(){return nt.getBufferingPlayer()},get bufferingAsset(){return nt.bufferingAsset},get bufferingItem(){return nt.bufferingItem},get playingAsset(){return nt.playingAsset},get playingItem(){return nt.playingItem},get bufferingIndex(){const rt=effectiveBufferingItem();return nt.findItemIndex(rt)},get playingIndex(){const rt=effectivePlayingItem();return nt.findItemIndex(rt)},get waitingIndex(){return nt.findItemIndex(nt.waitingItem)},primary:{get bufferedEnd(){return getBufferedEnd()},get currentTime(){const rt=nt.timelinePos;return rt>0?rt:0},get duration(){return getMappedDuration("primary")},get seekableStart(){var rt;return(null==(rt=nt.primaryDetails)?void 0:rt.fragmentStart)||0},seekTo:nt=>seekTo(nt,"primary")},playout:{get bufferedEnd(){return getMappedTime(effectiveBufferingItem(),"playout",nt.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return getMappedTime(effectivePlayingItem(),"playout",nt.playingAsset,"timelinePos","currentTime")},get duration(){return getMappedDuration("playout")},get seekableStart(){var rt;return findMappedTime((null==(rt=nt.primaryDetails)?void 0:rt.fragmentStart)||0,"playout")},seekTo:nt=>seekTo(nt,"playout")},integrated:{get bufferedEnd(){return getMappedTime(effectiveBufferingItem(),"integrated",nt.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return getMappedTime(effectivePlayingItem(),"integrated",nt.playingAsset,"timelinePos","currentTime")},get duration(){return getMappedDuration("integrated")},get seekableStart(){var rt;return findMappedTime((null==(rt=nt.primaryDetails)?void 0:rt.fragmentStart)||0,"integrated")},seekTo:nt=>seekTo(nt,"integrated")},skip:()=>{const rt=effectivePlayingItem(),it=null==rt?void 0:rt.event;if(it&&!it.restrictions.skip){const at=nt.findItemIndex(rt);if(it.appendInPlace){const nt=rt.playout.start+rt.event.duration;seekTo(nt+.001,"playout")}else nt.advanceAfterAssetEnded(it,at,1/0)}}}}return this.manager}get playingLastItem(){var nt;const rt=this.playingItem;if(!this.playbackStarted||!rt)return!1;const it=null==(nt=this.schedule)?void 0:nt.items;return this.itemsMatch(rt,it?it[it.length-1]:null)}get playbackStarted(){return null!==this.playingItem}get currentTime(){var nt,rt,it;if(null===this.mediaSelection)return;const at=this.waitingItem||this.playingItem;if(this.isInterstitial(at)&&!at.event.appendInPlace)return;let st=this.media;!st&&null!=(nt=this.bufferingItem)&&null!=(rt=nt.event)&&rt.appendInPlace&&(st=this.primaryMedia);const ot=null==(it=st)?void 0:it.currentTime;return void 0!==ot&&wt(ot)?ot:void 0}get primaryMedia(){var nt;return this.media||(null==(nt=this.detachedData)?void 0:nt.media)||null}isInterstitial(nt){return!(null==nt||!nt.event)}retreiveMediaSource(nt,rt){const it=this.getAssetPlayer(nt);it&&this.transferMediaFromPlayer(it,rt)}transferMediaFromPlayer(nt,rt){const it=nt.interstitial.appendInPlace,at=nt.media;if(it&&at===this.primaryMedia){if(!rt||this.isInterstitial(rt)&&!rt.event.appendInPlace)return void(rt&&at&&(this.detachedData={media:at}));const it=nt.transferMedia();this.log(`transfer MediaSource from ${nt} ${JSON.stringify(it)}`),this.bufferingAsset=null,this.detachedData=it}else rt&&at&&(this.shouldPlay||(this.shouldPlay=!at.paused))}transferMediaTo(nt,rt){var it,at;let st=null;const ot=this.hls,lt=nt!==ot,ut=lt&&nt.interstitial.appendInPlace,ct=null==(it=this.detachedData)?void 0:it.mediaSource;let dt;if(ot.media&&ut)st=ot.transferMedia(),this.detachedData=st,dt="Primary";else if(ct){const nt=this.getBufferingPlayer();nt&&(st=nt.transferMedia()),dt=`${nt}`}else dt="<unknown>";this.log(`transferring to ${lt?nt:"Primary"}\nMediaSource ${JSON.stringify(st)} from ${dt}`),st||(ct?(st=this.detachedData,this.log(`using detachedData: MediaSource ${JSON.stringify(st)}`)):this.detachedData||(this.warn("missing MediaSource (detachedData)!"),this.hls.detachMedia(),this.detachedData={media:rt}));const ht=st&&"mediaSource"in st&&"closed"!==(null==(at=st.mediaSource)?void 0:at.readyState),pt=ht&&st?st:rt;if(this.log(`${ht?"transfering MediaSource":"attaching media"} to ${lt?nt:"Primary"}`),pt===st){const rt=lt&&nt.assetId===this.schedule.assetIdAtEnd;pt.overrides={duration:this.schedule.duration,endOfStream:!lt||rt,cueRemoval:!1}}nt.attachMedia(pt)}checkStart(){const nt=this.schedule,rt=nt.events;if(!rt||this.playbackDisabled)return;-1===this.bufferedPos&&(this.bufferedPos=0);const it=this.timelinePos,at=this.waitingItem;if(-1===it){const it=this.hls.startPosition;if(this.timelinePos=it,rt.length&&rt[0].cue.pre){const it=nt.findEventIndex(rt[0].identifier);this.setSchedulePosition(it)}else if(it>=0||!this.primaryLive){const rt=this.timelinePos=it>0?it:0,at=nt.findItemIndexAtTime(rt);this.setSchedulePosition(at)}}else if(at&&!this.playingItem){const rt=nt.findItemIndex(at);this.setSchedulePosition(rt)}}advanceAfterAssetEnded(nt,rt,it){const at=it+1;if(nt.isAssetPastPlayoutLimit(at)||nt.assetList[at].error){const nt=this.schedule.items;if(nt){const it=rt+1;if(it>=nt.length)return void this.setSchedulePosition(-1);this.setSchedulePosition(it)}}else this.setSchedulePosition(rt,at)}setScheduleToAssetAtTime(nt,rt){const it=this.schedule,at=rt.parentIdentifier,st=it.getEvent(at);if(st){const rt=it.findEventIndex(at),ot=it.findAssetIndex(st,nt);this.setSchedulePosition(rt,ot)}}setSchedulePosition(nt,rt){const it=this.schedule.items;if(!it||this.playbackDisabled)return;this.log(`setSchedulePosition ${nt}, ${rt}`);const at=nt>=0?it[nt]:null,st=this.primaryMedia,ot=this.playingItem,lt=this.playingLastItem;if(this.isInterstitial(ot)){var ut;const st=ot.event,lt=this.playingAsset,ct=null==lt?void 0:lt.identifier,dt=ct?this.getAssetPlayer(ct):null;if(dt&&ct&&(!this.eventItemsMatch(ot,at)||void 0!==rt&&ct!==(null==(ut=st.assetList)?void 0:ut[rt].identifier))){this.playingAsset=null;const rt=st.findAssetIndex(lt);this.log(`INTERSTITIAL_ASSET_ENDED ${rt+1}/${st.assetList.length} ${eventAssetToString(lt)}`),this.hls.trigger(Ot.INTERSTITIAL_ASSET_ENDED,{asset:lt,assetListIndex:rt,event:st,schedule:it.slice(0),scheduleIndex:nt,player:dt}),this.retreiveMediaSource(ct,at),dt.media&&!this.detachedData&&dt.detachMedia(),this.clearAssetPlayer(ct,at)}if(!this.eventItemsMatch(ot,at)&&(this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${st} ${segmentToString(ot)}`),st.hasPlayed=!0,this.hls.trigger(Ot.INTERSTITIAL_ENDED,{event:st,schedule:it.slice(0),scheduleIndex:nt}),this.clearInterstitial(st,at),st.cue.once)){if(this.updateSchedule(),at){const nt=this.schedule.findItemIndex(at);this.setSchedulePosition(nt,rt)}return}}const ct=this.playerQueue;if(ct.length&&ct.forEach((rt=>{const it=rt.interstitial,st=this.schedule.findEventIndex(it.identifier);(st<nt||st>nt+1)&&this.clearInterstitial(it,at)})),this.isInterstitial(at)){this.timelinePos=Math.min(Math.max(this.timelinePos,at.start),at.end);const lt=at.event;void 0===rt&&(rt=this.schedule.findAssetIndex(lt,this.timelinePos));const ut=this.waitingItem;let ct=this.preloadAssets(lt,rt);ct||this.setBufferingItem(at),this.eventItemsMatch(at,ot||ut)||(this.waitingItem=at,this.log(`INTERSTITIAL_STARTED ${segmentToString(at)} ${lt.appendInPlace?"append in place":""}`),this.hls.trigger(Ot.INTERSTITIAL_STARTED,{event:lt,schedule:it.slice(0),scheduleIndex:nt}));const ht=lt.assetList.length;if(0===ht&&!lt.assetListResponse)return void this.log(`Waiting for ASSET-LIST to complete loading ${lt}`);if(lt.assetListLoader&&(lt.assetListLoader.destroy(),lt.assetListLoader=void 0),!st)return void this.log(`Waiting for attachMedia to start Interstitial ${lt}`);this.waitingItem=null,this.playingItem=at;const pt=lt.assetList[rt];if(!pt){const at=it[nt+1],st=this.media;return at&&st&&!this.isInterstitial(at)&&st.currentTime<at.start&&(st.currentTime=this.timelinePos=at.start),void this.advanceAfterAssetEnded(lt,nt,rt||0)}if(ct||(ct=this.getAssetPlayer(pt.identifier)),(null===ct||ct.destroyed)&&(this.warn(`asset ${rt+1}/${ht} player destroyed ${lt}`),ct=this.createAssetPlayer(lt,pt,rt)),!this.eventItemsMatch(at,this.bufferingItem)&&lt.appendInPlace&&this.isAssetBuffered(pt))return;var dt;if(this.startAssetPlayer(ct,rt,it,nt,st),this.shouldPlay)null==(dt=ct.media)||dt.play()}else if(null!==at){var ht;if(this.resumePrimary(at,nt),this.shouldPlay)null==(ht=this.hls.media)||ht.play()}else lt&&this.isInterstitial(ot)&&(this.playingItem=ot,ot.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var nt,rt;return null==(nt=this.mediaSelection)||null==(rt=nt.main)?void 0:rt.details}get primaryLive(){var nt;return!(null==(nt=this.primaryDetails)||!nt.live)}resumePrimary(nt,rt){var it;if(this.playingItem=nt,this.playingAsset=null,this.waitingItem=null,this.bufferedToItem(nt),this.log(`resuming ${segmentToString(nt)}`),null==(it=this.detachedData)||!it.mediaSource){let it=this.timelinePos;(it<nt.start||it>=nt.end)&&(it=this.getPrimaryResumption(nt,rt),this.timelinePos=it),this.attachPrimary(it,nt)}const at=this.schedule.items;at&&(this.log(`resumed ${segmentToString(nt)}`),this.hls.trigger(Ot.INTERSTITIALS_PRIMARY_RESUMED,{schedule:at.slice(0),scheduleIndex:rt}),this.checkBuffer())}getPrimaryResumption(nt,rt){const it=nt.start;if(this.primaryLive){const nt=this.primaryDetails;if(0===rt)return this.hls.startPosition;if(nt&&(it<nt.fragmentStart||it>nt.edge))return this.hls.liveSyncPosition||-1}return it}isAssetBuffered(nt){const rt=this.getAssetPlayer(nt.identifier);if(null!=rt&&rt.hls)return rt.hls.bufferedToEnd;return BufferHelper.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=nt.timelineStart+(nt.duration||0)}attachPrimary(nt,rt,it){rt?this.setBufferingItem(rt):this.bufferingItem=null,this.bufferingAsset=null;const at=this.primaryMedia;if(!at)return;const st=this.hls;st.media?this.checkBuffer():(this.transferMediaTo(st,at),it&&st.startLoad(nt,it)),it||(this.timelinePos=nt,st.startLoad(nt,it))}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(Ot.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(Ot.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(nt,rt){const it=this.hls.levels[rt.level],at=_objectSpread2(_objectSpread2({},this.mediaSelection||this.altSelection),{},{main:it});this.mediaSelection=at,this.schedule.parseInterstitialDateRanges(at),!this.playingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(nt,rt){const it=this.hls.audioTracks[rt.id],at=this.mediaSelection;if(!at)return void(this.altSelection=_objectSpread2(_objectSpread2({},this.altSelection),{},{audio:it}));const st=_objectSpread2(_objectSpread2({},at),{},{audio:it});this.mediaSelection=st}onSubtitleTrackUpdated(nt,rt){const it=this.hls.subtitleTracks[rt.id],at=this.mediaSelection;if(!at)return void(this.altSelection=_objectSpread2(_objectSpread2({},this.altSelection),{},{subtitles:it}));const st=_objectSpread2(_objectSpread2({},at),{},{subtitles:it});this.mediaSelection=st}onAudioTrackSwitching(nt,rt){const it=getBasicSelectionOption(rt);this.playerQueue.forEach((nt=>nt.hls.setAudioOption(rt)||nt.hls.setAudioOption(it)))}onSubtitleTrackSwitch(nt,rt){const it=getBasicSelectionOption(rt);this.playerQueue.forEach((nt=>nt.hls.setSubtitleOption(rt)||-1!==rt.id&&nt.hls.setSubtitleOption(it)))}onBufferCodecs(nt,rt){const it=rt.tracks;it&&(this.requiredTracks=it)}onBufferAppended(nt,rt){this.checkBuffer()}onBufferFlushed(nt,rt){const{playingItem:it}=this;if(it&&it!==this.bufferingItem&&!this.isInterstitial(it)){const nt=this.timelinePos;this.bufferedPos=nt,this.setBufferingItem(it)}}onBufferedToEnd(nt){const rt=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&rt){for(let nt=0;nt<rt.length;nt++){const at=rt[nt];if(at.cue.post){var it;const nt=this.schedule.findEventIndex(at.identifier),rt=null==(it=this.schedule.items)?void 0:it[nt];this.isInterstitial(rt)&&this.eventItemsMatch(rt,this.bufferingItem)&&this.bufferedToItem(rt,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(nt){const rt=this.playingItem;if(!this.playingLastItem&&rt){const nt=this.findItemIndex(rt);this.setSchedulePosition(nt+1)}}updateItem(nt,rt){const it=this.schedule.items;if(nt&&it){return it[this.findItemIndex(nt,rt)]||null}return null}itemsMatch(nt,rt){var it,at;return!!rt&&(nt===rt||nt.event&&rt.event&&this.eventItemsMatch(nt,rt)||!nt.event&&!rt.event&&(null==(it=nt.nextEvent)?void 0:it.identifier)===(null==(at=rt.nextEvent)?void 0:at.identifier))}eventItemsMatch(nt,rt){var it;return!!rt&&(nt===rt||nt.event.identifier===(null==(it=rt.event)?void 0:it.identifier))}findItemIndex(nt,rt){return nt?this.schedule.findItemIndex(nt,rt):-1}updateSchedule(){const nt=this.mediaSelection;nt&&this.schedule.updateSchedule(nt,[])}checkBuffer(){const nt=this.schedule.items;if(!nt)return;const rt=BufferHelper.bufferInfo(this.primaryMedia,this.timelinePos,0);this.updateBufferedPos(rt.end,nt,0===rt.len)}updateBufferedPos(nt,rt,it){const at=this.schedule,st=this.bufferingItem;if(this.bufferedPos>nt)return;if(1===rt.length&&this.itemsMatch(rt[0],st))return void(this.bufferedPos=nt);const ot=this.playingItem,lt=this.findItemIndex(ot);let ut=at.findItemIndexAtTime(nt);if(this.bufferedPos<nt){var ct;const it=this.findItemIndex(st),at=Math.min(it+1,rt.length-1),ot=rt[at];if(-1===ut&&st&&nt>=st.end&&(ut=at),at-lt>1&&!1===(null==st||null==(ct=st.event)?void 0:ct.appendInPlace))return;if(this.bufferedPos=nt,ut>it&&ut>lt)this.bufferedToItem(ot);else{const rt=this.primaryDetails;this.primaryLive&&rt&&nt>rt.edge-rt.targetduration&&ot.start<rt.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(ot)&&this.preloadAssets(ot.event,0)}}else it&&ot&&st!==ot&&ut===lt&&this.bufferedToItem(ot)}setBufferingItem(nt){const rt=this.bufferingItem,it=this.schedule,{items:at,events:st}=it;if(at&&st&&(!rt||it.findItemIndex(rt)!==it.findItemIndex(nt))){const it=this.isInterstitial(nt),ot=this.getBufferingPlayer(),lt=ot?ot.remaining:rt?rt.end-this.timelinePos:0;this.log(`buffered to boundary ${segmentToString(nt)}`+(rt?` (${lt.toFixed(2)} remaining)`:"")),this.bufferingItem=nt,this.bufferedPos=nt.start,this.playbackDisabled||(it?this.playerQueue.forEach((nt=>nt.resumeBuffering())):(this.hls.resumeBuffering(),this.playerQueue.forEach((nt=>nt.pauseBuffering())))),this.hls.trigger(Ot.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:st.slice(0),schedule:at.slice(0),bufferingIndex:this.findItemIndex(nt),playingIndex:this.findItemIndex(this.playingItem)})}return rt}bufferedToItem(nt,rt=0){const it=this.setBufferingItem(nt);if(!this.playbackDisabled)if(this.isInterstitial(nt))this.bufferedToEvent(nt,rt);else if(null!==it){this.bufferingAsset=null;const rt=this.detachedData;if(rt)if(rt.mediaSource){const rt=!0;this.attachPrimary(nt.start,nt,rt)}else this.preloadPrimary(nt);else this.preloadPrimary(nt)}}preloadPrimary(nt){const rt=this.findItemIndex(nt),it=this.getPrimaryResumption(nt,rt);this.hls.startLoad(it)}bufferedToEvent(nt,rt){const it=nt.event,at=0===it.assetList.length&&!it.assetListLoader,st=it.cue.once;if(at||!st){const nt=this.preloadAssets(it,rt);if(null!=nt&&nt.interstitial.appendInPlace){const at=it.assetList[rt],st=this.primaryMedia;at&&st&&this.bufferAssetPlayer(nt,st)}}}preloadAssets(nt,rt){const it=nt.assetList.length,at=0===it&&!nt.assetListLoader,st=nt.cue.once;if(at){this.log(`Load interstitial asset ${rt+1}/${it} ${nt}`);const at=nt.timelineStart;nt.appendInPlace&&this.flushFrontBuffer(at);const st=nt.assetUrl;if(st)return this.createAsset(nt,0,0,at,nt.duration,st);let ot=0;!this.playingItem&&this.primaryLive&&(ot=this.hls.startPosition,-1===ot&&(ot=this.hls.liveSyncPosition||0));const lt=this.assetListLoader.loadAssetList(nt,ot);lt&&(nt.assetListLoader=lt)}else if(!st&&it){for(let at=rt;at<it;at++){const rt=nt.assetList[at],it=this.getAssetPlayerQueueIndex(rt.identifier);-1!==it&&!this.playerQueue[it].destroyed||rt.error||this.createAssetPlayer(nt,rt,at)}return this.getAssetPlayer(nt.assetList[rt].identifier)}return null}flushFrontBuffer(nt){const rt=this.requiredTracks;if(!rt)return;Object.keys(rt).forEach((rt=>{this.hls.trigger(Ot.BUFFER_FLUSHING,{startOffset:nt,endOffset:1/0,type:rt})}))}getAssetPlayerQueueIndex(nt){const rt=this.playerQueue;for(let it=0;it<rt.length;it++)if(nt===rt[it].assetId)return it;return-1}getAssetPlayer(nt){const rt=this.getAssetPlayerQueueIndex(nt);return this.playerQueue[rt]||null}getBufferingPlayer(){const{playerQueue:nt,primaryMedia:rt}=this;if(rt)for(let it=0;it<nt.length;it++)if(nt[it].media===rt)return nt[it];return null}createAsset(nt,rt,it,at,st,ot){const lt={parentIdentifier:nt.identifier,identifier:generateAssetIdentifier(nt,ot,rt),duration:st,startOffset:it,timelineStart:at,uri:ot};return this.createAssetPlayer(nt,lt,rt)}createAssetPlayer(nt,rt,it){this.log(`create HLSAssetPlayer for ${eventAssetToString(rt)}`);const at=this.hls,st=at.userConfig;let ot=st.videoPreference;const lt=at.levels[at.loadLevel]||at.levels[at.currentLevel];(ot||lt)&&(ot=_extends({},ot),lt.videoCodec&&(ot.videoCodec=lt.videoCodec),lt.videoRange&&(ot.allowedVideoRanges=[lt.videoRange]));const ut=at.audioTracks[at.audioTrack],ct=at.subtitleTracks[at.subtitleTrack];let dt=0;if(this.primaryLive){const nt=this.timelinePos-rt.timelineStart;if(nt>1){const it=rt.duration;it&&nt<it&&(dt=nt)}}const ht=_objectSpread2(_objectSpread2({},st),{},{startFragPrefetch:!0,primarySessionId:at.sessionId,assetPlayerId:rt.identifier,abrEwmaDefaultEstimate:at.bandwidthEstimate,interstitialsController:void 0,startPosition:dt,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:ot,audioPreference:ut||st.audioPreference,subtitlePreference:ct||st.subtitlePreference});nt.appendInPlace&&(nt.appendInPlaceStarted=!0,rt.timelineStart&&(ht.timelineOffset=rt.timelineStart));const pt=ht.cmcd;null!=pt&&pt.sessionId&&pt.contentId&&(ht.cmcd=_extends({},pt,{contentId:hash(rt.uri)}));const _t=new HlsAssetPlayer(this.HlsPlayerClass,ht,nt,rt);this.playerQueue.push(_t),nt.assetList[it]=rt;const Et=rt.identifier,updateAssetPlayerDetails=at=>{if(at.live){const rt=new Error(`Interstitials MUST be VOD assets ${nt}`),at={fatal:!0,type:Pt.OTHER_ERROR,details:kt.INTERSTITIAL_ASSET_ITEM_ERROR,error:rt};return void this.handleAssetItemError(at,nt,this.schedule.findEventIndex(nt.identifier),it,rt.message)}const st=at.edge-at.fragmentStart,ot=rt.duration;(null===ot||st>ot)&&(this.log(`Interstitial asset "${Et}" duration change ${ot} > ${st}`),rt.duration=st,this.updateSchedule())};_t.on(Ot.LEVEL_UPDATED,((nt,{details:rt})=>updateAssetPlayerDetails(rt))),_t.on(Ot.LEVEL_PTS_UPDATED,((nt,{details:rt})=>updateAssetPlayerDetails(rt)));const onBufferCodecs=(nt,rt)=>{const it=this.getAssetPlayer(Et);if(it&&rt.tracks){it.off(Ot.BUFFER_CODECS,onBufferCodecs),it.tracks=rt.tracks;const nt=this.primaryMedia;this.bufferingAsset===it.assetItem&&nt&&!it.media&&this.bufferAssetPlayer(it,nt)}};_t.on(Ot.BUFFER_CODECS,onBufferCodecs);const bufferedToEnd=it=>{var at;const st=this.getAssetPlayer(Et);if(this.log(`buffered to end of asset ${st}`),!st)return;st.off(Ot.BUFFERED_TO_END,bufferedToEnd);const ot=this.schedule.findEventIndex(nt.identifier),lt=nt.findAssetIndex(rt),ut=lt+1,ct=null==(at=this.schedule.items)?void 0:at[ot];if(this.isInterstitial(ct))if(-1===lt||nt.isAssetPastPlayoutLimit(ut)||nt.assetList[ut].error){var dt;const nt=null==(dt=this.schedule.items)?void 0:dt[ot+1];nt&&this.bufferedToItem(nt)}else this.bufferedToItem(ct,lt+1)};_t.on(Ot.BUFFERED_TO_END,bufferedToEnd);const endedWithAssetIndex=rt=>()=>{if(!this.getAssetPlayer(Et))return;this.shouldPlay=!0;const it=this.schedule.findEventIndex(nt.identifier);this.advanceAfterAssetEnded(nt,it,rt)};return _t.once(Ot.MEDIA_ENDED,endedWithAssetIndex(it)),_t.once(Ot.PLAYOUT_LIMIT_REACHED,endedWithAssetIndex(1/0)),_t.on(Ot.ERROR,((rt,at)=>{this.handleAssetItemError(at,nt,this.schedule.findEventIndex(nt.identifier),it,`Asset player error ${at.error} ${nt}`)})),_t.on(Ot.DESTROYING,(()=>{if(!this.getAssetPlayer(Et))return;const rt=new Error(`Asset player destroyed unexpectedly ${Et}`),at={fatal:!0,type:Pt.OTHER_ERROR,details:kt.INTERSTITIAL_ASSET_ITEM_ERROR,error:rt};this.handleAssetItemError(at,nt,this.schedule.findEventIndex(nt.identifier),it,rt.message)})),this.hls.trigger(Ot.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:rt,assetListIndex:it,event:nt,player:_t}),_t}clearInterstitial(nt,rt){nt.assetList.forEach((nt=>{this.clearAssetPlayer(nt.identifier,rt)})),nt.appendInPlaceStarted=!1}clearAssetPlayer(nt,rt){if(null===rt)return;const it=this.getAssetPlayerQueueIndex(nt);if(-1!==it){this.log(`clearAssetPlayer "${nt}" toSegment: ${rt?segmentToString(rt):rt}`);const at=this.playerQueue[it];this.transferMediaFromPlayer(at,rt),this.playerQueue.splice(it,1),at.destroy()}}emptyPlayerQueue(){let nt;for(;nt=this.playerQueue.pop();)nt.destroy();this.playerQueue=[]}startAssetPlayer(nt,rt,it,at,st){const{interstitial:ot,assetItem:lt,assetId:ut}=nt,ct=ot.assetList.length,dt=this.playingAsset;this.playingAsset=lt,dt&&dt.identifier===ut||(dt&&(this.clearAssetPlayer(dt.identifier,it[at]),delete dt.error),this.log(`INTERSTITIAL_ASSET_STARTED ${rt+1}/${ct} ${nt}`),this.hls.trigger(Ot.INTERSTITIAL_ASSET_STARTED,{asset:lt,assetListIndex:rt,event:ot,schedule:it.slice(0),scheduleIndex:at,player:nt})),nt.media||this.bufferAssetPlayer(nt,st)}bufferAssetPlayer(nt,rt){var it,at;const{interstitial:st,assetItem:ot,assetId:lt}=nt,ut=this.schedule.findEventIndex(st.identifier),ct=null==(it=this.schedule.items)?void 0:it[ut];if(!ct)return;this.setBufferingItem(ct),this.bufferingAsset=ot;const dt=this.getBufferingPlayer();if(dt===nt)return;const ht=(null==dt?void 0:dt.tracks)||(null==(at=this.detachedData)?void 0:at.tracks)||this.requiredTracks;if(st.appendInPlace&&ot!==this.playingAsset){if(!nt.tracks)return;if(ht&&!isCompatibleTrackChange(ht,nt.tracks)){const rt=new Error(`Asset "${lt}" SourceBuffer tracks ('${Object.keys(nt.tracks)}') are not compatible with primary content tracks ('${Object.keys(ht)}')`),it={fatal:!0,type:Pt.OTHER_ERROR,details:kt.INTERSTITIAL_ASSET_ITEM_ERROR,error:rt},at=st.findAssetIndex(ot);return void this.handleAssetItemError(it,st,ut,at,rt.message)}}this.transferMediaTo(nt,rt)}handleAssetItemError(nt,rt,it,at,st){if(nt.details===kt.BUFFER_STALLED_ERROR)return;const ot=rt.assetList[at]||null;let lt=null;if(ot){const nt=this.getAssetPlayerQueueIndex(ot.identifier);lt=this.playerQueue[nt]||null}const ut=this.schedule.items,ct=_extends({},nt,{fatal:!1,errorAction:createDoNothingErrorAction(!0),asset:ot,assetListIndex:at,event:rt,schedule:ut,scheduleIndex:it,player:lt});if(this.warn(`Asset item error: ${nt.error}`),this.hls.trigger(Ot.INTERSTITIAL_ASSET_ERROR,ct),!nt.fatal)return;const dt=new Error(st);ot&&(this.playingAsset!==ot&&this.clearAssetPlayer(ot.identifier),ot.error=dt),rt.assetList.some((nt=>!nt.error))?rt.appendInPlace&&(rt.error=dt):rt.error=dt,this.primaryFallback(rt)}primaryFallback(nt){const rt=nt.timelineStart,it=this.playingItem||this.waitingItem;if(this.updateSchedule(),it){nt.appendInPlace&&(nt.appendInPlace=!1,this.attachPrimary(rt,null),this.flushFrontBuffer(rt));let at=this.timelinePos;-1===at&&(at=this.hls.startPosition);const st=this.updateItem(it,at);if(!this.itemsMatch(it,st)){const nt=this.schedule.findItemIndexAtTime(at);this.setSchedulePosition(nt)}}else this.checkStart()}onAssetListLoaded(nt,rt){var it;const at=rt.event,st=at.identifier,ot=rt.assetListResponse.ASSETS;if(!this.schedule.hasEvent(st))return;const lt=at.timelineStart;let ut=0;ot.forEach(((nt,rt)=>{const it=parseFloat(nt.DURATION);this.createAsset(at,rt,ut,lt+ut,it,nt.URI),ut+=it})),at.duration=ut;const ct=this.waitingItem,dt=(null==ct?void 0:ct.event.identifier)===st;this.updateSchedule();const ht=null==(it=this.bufferingItem)?void 0:it.event;if(dt){var pt;const nt=this.schedule.findEventIndex(st),rt=null==(pt=this.schedule.items)?void 0:pt[nt];rt&&this.setBufferingItem(rt),this.setSchedulePosition(nt)}else if((null==ht?void 0:ht.identifier)===st&&ht.appendInPlace){const nt=at.assetList[0],rt=this.getAssetPlayer(nt.identifier),it=this.primaryMedia;nt&&rt&&it&&this.bufferAssetPlayer(rt,it)}}onError(nt,rt){switch(rt.details){case kt.ASSET_LIST_PARSING_ERROR:case kt.ASSET_LIST_LOAD_ERROR:case kt.ASSET_LIST_LOAD_TIMEOUT:{const nt=rt.interstitial;nt&&this.primaryFallback(nt)}}}}});function deepCpy(nt){return nt&&"object"==typeof nt?Array.isArray(nt)?nt.map(deepCpy):Object.keys(nt).reduce(((rt,it)=>(rt[it]=deepCpy(nt[it]),rt)),{}):nt}function enableStreamingMode(nt,rt){const it=nt.loader;if(it!==FetchLoader&&it!==XhrLoader)rt.log("[config]: Custom loader detected, cannot enable progressive streaming"),nt.progressive=!1;else{(function fetchSupported(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(nt){}return!1})()&&(nt.loader=FetchLoader,nt.progressive=!0,nt.enableSoftwareAES=!0,rt.log("[config]: Progressive streaming enabled, using FetchLoader"))}}function getCueClass(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function createCueWithDataFields(nt,rt,it,at,st){let ot=new nt(rt,it,"");try{ot.value=at,st&&(ot.type=st)}catch(lt){ot=new nt(rt,it,JSON.stringify(st?_objectSpread2({type:st},at):at))}return ot}const vs=(()=>{const nt=getCueClass();try{nt&&new nt(0,Number.POSITIVE_INFINITY,"")}catch(nt){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class ID3TrackController{constructor(nt){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.hls=nt,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:nt}=this;nt.on(Ot.MEDIA_ATTACHING,this.onMediaAttaching,this),nt.on(Ot.MEDIA_DETACHING,this.onMediaDetaching,this),nt.on(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.on(Ot.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),nt.on(Ot.BUFFER_FLUSHING,this.onBufferFlushing,this),nt.on(Ot.LEVEL_UPDATED,this.onLevelUpdated,this),nt.on(Ot.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:nt}=this;nt.off(Ot.MEDIA_ATTACHING,this.onMediaAttaching,this),nt.off(Ot.MEDIA_DETACHING,this.onMediaDetaching,this),nt.off(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.off(Ot.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),nt.off(Ot.BUFFER_FLUSHING,this.onBufferFlushing,this),nt.off(Ot.LEVEL_UPDATED,this.onLevelUpdated,this),nt.off(Ot.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(nt,rt){var it;this.media=rt.media,!1===(null==(it=rt.overrides)?void 0:it.cueRemoval)&&(this.removeCues=!1)}onMediaDetaching(nt,rt){this.media=null;!!rt.transferMedia||(this.id3Track&&(this.removeCues&&clearCurrentCues(this.id3Track),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(nt){const rt=this.getID3Track(nt.textTracks);return rt.mode="hidden",rt}getID3Track(nt){if(this.media){for(let rt=0;rt<nt.length;rt++){const it=nt[rt];if("metadata"===it.kind&&"id3"===it.label)return sendAddTrackEvent(it,this.media),it}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(nt,rt){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:it,enableID3MetadataCues:at}}}=this;if(!it&&!at)return;const{samples:st}=rt;this.id3Track||(this.id3Track=this.createTrack(this.media));const ot=getCueClass();if(ot)for(let nt=0;nt<st.length;nt++){const rt=st[nt].type;if(rt===Zi.emsg&&!it||!at)continue;const lt=getId3Frames(st[nt].data);if(lt){const it=st[nt].pts;let at=it+st[nt].duration;at>vs&&(at=vs);at-it<=0&&(at=it+.25);for(let nt=0;nt<lt.length;nt++){const st=lt[nt];if(!isId3TimestampFrame(st)){this.updateId3CueEnds(it,rt);const nt=createCueWithDataFields(ot,it,at,st,rt);nt&&this.id3Track.addCue(nt)}}}}}updateId3CueEnds(nt,rt){var it;const at=null==(it=this.id3Track)?void 0:it.cues;if(at)for(let it=at.length;it--;){const st=at[it];st.type===rt&&st.startTime<nt&&st.endTime===vs&&(st.endTime=nt)}}onBufferFlushing(nt,{startOffset:rt,endOffset:it,type:at}){const{id3Track:st,hls:ot}=this;if(!ot)return;const{config:{enableEmsgMetadataCues:lt,enableID3MetadataCues:ut}}=ot;if(st&&(lt||ut)){let nt;nt="audio"===at?nt=>nt.type===Zi.audioId3&&ut:"video"===at?nt=>nt.type===Zi.emsg&&lt:nt=>nt.type===Zi.audioId3&&ut||nt.type===Zi.emsg&&lt,removeCuesInRange(st,rt,it,nt)}}onLevelUpdated(nt,{details:rt}){this.updateDateRangeCues(rt,!0)}onLevelPtsUpdated(nt,rt){Math.abs(rt.drift)>.01&&this.updateDateRangeCues(rt.details)}updateDateRangeCues(nt,rt){if(!this.media||!nt.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:it}=this,{dateRanges:at}=nt,st=Object.keys(at);let ot=this.dateRangeCuesAppended;var lt;if(it&&rt)if(null!=(lt=it.cues)&&lt.length){const nt=Object.keys(ot).filter((nt=>!st.includes(nt)));for(let rt=nt.length;rt--;){const at=nt[rt],st=ot[at].cues;delete ot[at],Object.keys(st).forEach((nt=>{try{it.removeCue(st[nt])}catch(nt){}}))}}else ot=this.dateRangeCuesAppended={};const ut=nt.fragments[nt.fragments.length-1];if(0===st.length||!wt(null==ut?void 0:ut.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const ct=getCueClass();for(let nt=0;nt<st.length;nt++){const rt=st[nt],it=at[rt],lt=it.startTime,ut=ot[rt],pt=(null==ut?void 0:ut.cues)||{};let _t=(null==ut?void 0:ut.durationKnown)||!1,Et=vs;const{duration:St,endDate:wt}=it;if(wt&&null!==St)Et=lt+St,_t=!0;else if(it.endOnNext&&!_t){const nt=st.reduce(((nt,rt)=>{if(rt!==it.id){const st=at[rt];if(st.class===it.class&&st.startDate>it.startDate&&(!nt||it.startDate<nt.startDate))return st}return nt}),null);nt&&(Et=nt.startTime,_t=!0)}const Lt=Object.keys(it.attr);for(let nt=0;nt<Lt.length;nt++){const at=Lt[nt];if("ID"===(ht=at)||"CLASS"===ht||"CUE"===ht||"START-DATE"===ht||"DURATION"===ht||"END-DATE"===ht||"END-ON-NEXT"===ht)continue;const st=pt[at];if(st)_t&&!ut.durationKnown?st.endTime=Et:Math.abs(st.startTime-lt)>.01&&(st.startTime=lt,st.endTime=Et);else if(ct){let nt=it.attr[at];isSCTE35Attribute(at)&&(dt=nt,nt=Uint8Array.from(dt.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer);const st=createCueWithDataFields(ct,lt,Et,{key:at,data:nt},Zi.dateRange);st&&(st.id=rt,this.id3Track.addCue(st),pt[at]=st)}}ot[rt]={cues:pt,dateRange:it,durationKnown:_t}}var dt,ht}}class LatencyController{constructor(nt){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:nt}=this,rt=this.hls.latestLevelDetails;if(!nt||!rt)return;this.currentTime=nt.currentTime;const it=this.computeLatency();if(null===it)return;this._latency=it;const{lowLatencyMode:at,maxLiveSyncPlaybackRate:st}=this.config;if(!at||1===st||!rt.live)return;const ot=this.targetLatency;if(null===ot)return;const lt=it-ot;if(lt<Math.min(this.maxLatency,ot+rt.targetduration)&&lt>.05&&this.forwardBufferLength>1){const rt=Math.min(2,Math.max(1,st)),it=Math.round(2/(1+Math.exp(-.75*lt-this.edgeStalled))*20)/20;nt.playbackRate=Math.min(rt,Math.max(1,it))}else 1!==nt.playbackRate&&0!==nt.playbackRate&&(nt.playbackRate=1)},this.hls=nt,this.config=nt.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:nt}=this;if(void 0!==nt.liveMaxLatencyDuration)return nt.liveMaxLatencyDuration;const rt=this.hls.latestLevelDetails;return rt?nt.liveMaxLatencyDurationCount*rt.targetduration:0}get targetLatency(){const nt=this.hls.latestLevelDetails;if(null===nt)return null;const{holdBack:rt,partHoldBack:it,targetduration:at}=nt,{liveSyncDuration:st,liveSyncDurationCount:ot,lowLatencyMode:lt}=this.config,ut=this.hls.userConfig;let ct=lt&&it||rt;(this._targetLatencyUpdated||ut.liveSyncDuration||ut.liveSyncDurationCount||0===ct)&&(ct=void 0!==st?st:ot*at);const dt=at;return ct+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,dt)}set targetLatency(nt){this.stallCount=0,this.config.liveSyncDuration=nt,this._targetLatencyUpdated=!0}get liveSyncPosition(){const nt=this.estimateLiveEdge(),rt=this.targetLatency;if(null===nt||null===rt)return null;const it=this.hls.latestLevelDetails;if(null===it)return null;const at=it.edge,st=nt-rt-this.edgeStalled,ot=at-it.totalduration,lt=at-(this.config.lowLatencyMode&&it.partTarget||it.targetduration);return Math.min(Math.max(ot,st),lt)}get drift(){const nt=this.hls.latestLevelDetails;return null===nt?1:nt.drift}get edgeStalled(){const nt=this.hls.latestLevelDetails;if(null===nt)return 0;const rt=3*(this.config.lowLatencyMode&&nt.partTarget||nt.targetduration);return Math.max(nt.age-rt,0)}get forwardBufferLength(){const{media:nt}=this,rt=this.hls.latestLevelDetails;if(!nt||!rt)return 0;const it=nt.buffered.length;return(it?nt.buffered.end(it-1):rt.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){this.hls.on(Ot.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Ot.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(Ot.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Ot.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(Ot.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(Ot.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Ot.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(Ot.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Ot.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(Ot.ERROR,this.onError,this)}onMediaAttached(nt,rt){this.media=rt.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(nt,{details:rt}){rt.advanced&&this.onTimeupdate(),!rt.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(nt,rt){var it;rt.details===kt.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(it=this.hls.latestLevelDetails)&&it.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}estimateLiveEdge(){const nt=this.hls.latestLevelDetails;return null===nt?null:nt.edge+nt.age}computeLatency(){const nt=this.estimateLiveEdge();return null===nt?null:nt-this.currentTime}}class LevelController extends BasePlaylistController{constructor(nt,rt){super(nt,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=rt,this._registerListeners()}_registerListeners(){const{hls:nt}=this;nt.on(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.on(Ot.MANIFEST_LOADED,this.onManifestLoaded,this),nt.on(Ot.LEVEL_LOADED,this.onLevelLoaded,this),nt.on(Ot.LEVELS_UPDATED,this.onLevelsUpdated,this),nt.on(Ot.FRAG_BUFFERED,this.onFragBuffered,this),nt.on(Ot.ERROR,this.onError,this)}_unregisterListeners(){const{hls:nt}=this;nt.off(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.off(Ot.MANIFEST_LOADED,this.onManifestLoaded,this),nt.off(Ot.LEVEL_LOADED,this.onLevelLoaded,this),nt.off(Ot.LEVELS_UPDATED,this.onLevelsUpdated,this),nt.off(Ot.FRAG_BUFFERED,this.onFragBuffered,this),nt.off(Ot.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach((nt=>{nt.loadError=0,nt.fragmentError=0})),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(nt,rt){this.resetLevels()}onManifestLoaded(nt,rt){const it=this.hls.config.preferManagedMediaSource,at=[],st={},ot={};let lt=!1,ut=!1,ct=!1;rt.levels.forEach((nt=>{var rt;const dt=nt.attrs;let{audioCodec:ht,videoCodec:pt}=nt;ht&&(nt.audioCodec=ht=getCodecCompatibleName(ht,it)||void 0),0===(null==(rt=pt)?void 0:rt.indexOf("avc1"))&&(pt=nt.videoCodec=function convertAVC1ToAVCOTI(nt){const rt=nt.split(",");for(let nt=0;nt<rt.length;nt++){const it=rt[nt].split(".");if(it.length>2){let at=it.shift()+".";at+=parseInt(it.shift()).toString(16),at+=("000"+parseInt(it.shift()).toString(16)).slice(-4),rt[nt]=at}}return rt.join(",")}(pt));const{width:_t,height:Et,unknownCodecs:St}=nt;let wt=St?St.length:0;if(St)for(let rt=wt;rt--;){const it=St[rt];this.isAudioSupported(it)?(nt.audioCodec=ht=ht?`${ht},${it}`:it,wt--,en.audio[ht.substring(0,4)]=2):this.isVideoSupported(it)&&(nt.videoCodec=pt=pt?`${pt},${it}`:it,wt--,en.video[pt.substring(0,4)]=2)}if(lt||(lt=!(!_t||!Et)),ut||(ut=!!pt),ct||(ct=!!ht),wt||ht&&!this.isAudioSupported(ht)||pt&&!this.isVideoSupported(pt))return;const{CODECS:Lt,"FRAME-RATE":Ct,"HDCP-LEVEL":Pt,"PATHWAY-ID":kt,RESOLUTION:Ot,"VIDEO-RANGE":Ft}=dt,Bt=`${`${kt||"."}-`}${nt.bitrate}-${Ot}-${Ct}-${Lt}-${Ft}-${Pt}`;if(st[Bt])if(st[Bt].uri===nt.url||nt.attrs["PATHWAY-ID"])st[Bt].addGroupId("audio",dt.AUDIO),st[Bt].addGroupId("text",dt.SUBTITLES);else{const rt=ot[Bt]+=1;nt.attrs["PATHWAY-ID"]=new Array(rt+1).join(".");const it=new Level(nt);st[Bt]=it,at.push(it)}else{const rt=new Level(nt);st[Bt]=rt,ot[Bt]=1,at.push(rt)}})),this.filterAndSortMediaOptions(at,rt,lt,ut,ct)}isAudioSupported(nt){return areCodecsMediaSourceSupported(nt,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(nt){return areCodecsMediaSourceSupported(nt,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(nt,rt,it,at,st){let ot=[],lt=[],ut=nt;if((it||at)&&st&&(ut=ut.filter((({videoCodec:nt,videoRange:rt,width:it,height:at})=>(!!nt||!(!it||!at))&&function isVideoRange(nt){return!!nt&&pn.indexOf(nt)>-1}(rt)))),0===ut.length)return void Promise.resolve().then((()=>{if(this.hls){rt.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(rt.levels[0].attrs)}`);const nt=new Error("no level with compatible codecs found in manifest");this.hls.trigger(Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:rt.url,error:nt,reason:nt.message})}}));rt.audioTracks&&(ot=rt.audioTracks.filter((nt=>!nt.audioCodec||this.isAudioSupported(nt.audioCodec))),assignTrackIdsByGroup(ot)),rt.subtitles&&(lt=rt.subtitles,assignTrackIdsByGroup(lt));const ct=ut.slice(0);ut.sort(((nt,rt)=>{if(nt.attrs["HDCP-LEVEL"]!==rt.attrs["HDCP-LEVEL"])return(nt.attrs["HDCP-LEVEL"]||"")>(rt.attrs["HDCP-LEVEL"]||"")?1:-1;if(it&&nt.height!==rt.height)return nt.height-rt.height;if(nt.frameRate!==rt.frameRate)return nt.frameRate-rt.frameRate;if(nt.videoRange!==rt.videoRange)return pn.indexOf(nt.videoRange)-pn.indexOf(rt.videoRange);if(nt.videoCodec!==rt.videoCodec){const it=videoCodecPreferenceValue(nt.videoCodec),at=videoCodecPreferenceValue(rt.videoCodec);if(it!==at)return at-it}if(nt.uri===rt.uri&&nt.codecSet!==rt.codecSet){const it=codecsSetSelectionPreferenceValue(nt.codecSet),at=codecsSetSelectionPreferenceValue(rt.codecSet);if(it!==at)return at-it}return nt.averageBitrate!==rt.averageBitrate?nt.averageBitrate-rt.averageBitrate:0}));let dt=ct[0];if(this.steering&&(ut=this.steering.filterParsedLevels(ut),ut.length!==ct.length))for(let nt=0;nt<ct.length;nt++)if(ct[nt].pathwayId===ut[0].pathwayId){dt=ct[nt];break}this._levels=ut;for(let nt=0;nt<ut.length;nt++)if(ut[nt]===dt){var ht;this._firstLevel=nt;const rt=dt.bitrate,it=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${ut.length} level(s) found, first bitrate: ${rt}`),void 0===(null==(ht=this.hls.userConfig)?void 0:ht.abrEwmaDefaultEstimate)){const nt=Math.min(rt,this.hls.config.abrEwmaDefaultEstimateMax);nt>it&&it===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=nt)}break}const pt=st&&!at,_t={levels:ut,audioTracks:ot,subtitleTracks:lt,sessionData:rt.sessionData,sessionKeys:rt.sessionKeys,firstLevel:this._firstLevel,stats:rt.stats,audio:st,video:at,altAudio:!pt&&ot.some((nt=>!!nt.url))};this.hls.trigger(Ot.MANIFEST_PARSED,_t);const{config:{autoStartLoad:Et,startPosition:St},forceStartLoad:wt}=this.hls;(Et||wt)&&(this.log(`${Et?"auto":"force"} startLoad with configured startPosition ${St}`),this.hls.startLoad(St))}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(nt){const rt=this._levels;if(0===rt.length)return;if(nt<0||nt>=rt.length){const it=new Error("invalid level idx"),at=nt<0;if(this.hls.trigger(Ot.ERROR,{type:Pt.OTHER_ERROR,details:kt.LEVEL_SWITCH_ERROR,level:nt,fatal:at,error:it,reason:it.message}),at)return;nt=Math.min(nt,rt.length-1)}const it=this.currentLevelIndex,at=this.currentLevel,st=at?at.attrs["PATHWAY-ID"]:void 0,ot=rt[nt],lt=ot.attrs["PATHWAY-ID"];if(this.currentLevelIndex=nt,this.currentLevel=ot,it===nt&&at&&st===lt&&(ot.details||-1!==this.requestScheduled))return;this.log(`Switching to level ${nt} (${ot.height?ot.height+"p ":""}${ot.videoRange?ot.videoRange+" ":""}${ot.codecSet?ot.codecSet+" ":""}@${ot.bitrate})${lt?" with Pathway "+lt:""} from level ${it}${st?" with Pathway "+st:""}`);const ut={level:nt,attrs:ot.attrs,details:ot.details,bitrate:ot.bitrate,averageBitrate:ot.averageBitrate,maxBitrate:ot.maxBitrate,realBitrate:ot.realBitrate,width:ot.width,height:ot.height,codecSet:ot.codecSet,audioCodec:ot.audioCodec,videoCodec:ot.videoCodec,audioGroups:ot.audioGroups,subtitleGroups:ot.subtitleGroups,loaded:ot.loaded,loadError:ot.loadError,fragmentError:ot.fragmentError,name:ot.name,id:ot.id,uri:ot.uri,url:ot.url,urlId:0,audioGroupIds:ot.audioGroupIds,textGroupIds:ot.textGroupIds};this.hls.trigger(Ot.LEVEL_SWITCHING,ut);const ct=ot.details;if(!ct||ct.live){const nt=this.switchParams(ot.uri,null==at?void 0:at.details,ct);this.loadPlaylist(nt)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(nt){this.manualLevelIndex=nt,void 0===this._startLevel&&(this._startLevel=nt),-1!==nt&&(this.level=nt)}get firstLevel(){return this._firstLevel}set firstLevel(nt){this._firstLevel=nt}get startLevel(){if(void 0===this._startLevel){const nt=this.hls.config.startLevel;return void 0!==nt?nt:this.hls.firstAutoLevel}return this._startLevel}set startLevel(nt){this._startLevel=nt}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(nt){if(this.steering){const rt=this.steering.pathways(),it=nt.filter((nt=>-1!==rt.indexOf(nt)));if(nt.length<1)return void this.warn(`pathwayPriority ${nt} should contain at least one pathway from list: ${rt}`);this.steering.pathwayPriority=it}}onError(nt,rt){if(!rt.fatal&&rt.context&&rt.context.type===Bt&&rt.context.level===this.level){this.checkRetry(rt)||(this.requestScheduled=-1)}}onFragBuffered(nt,{frag:rt}){if(void 0!==rt&&rt.type===Ht){const nt=rt.elementaryStreams;if(!Object.keys(nt).some((rt=>!!nt[rt])))return;const it=this._levels[rt.level];null!=it&&it.loadError&&(this.log(`Resetting level error count of ${it.loadError} on frag buffered`),it.loadError=0)}}onLevelLoaded(nt,rt){var it;const{level:at,details:st}=rt,ot=this._levels[at];var lt;if(!ot)return this.warn(`Invalid level index ${at}`),void(null!=(lt=rt.deliveryDirectives)&&lt.skip&&(st.deltaUpdateFailed=!0));if(at===this.currentLevelIndex){0===ot.fragmentError&&(ot.loadError=0);let nt=ot.details;nt===rt.details&&nt.advanced&&(nt=void 0),this.playlistLoaded(at,rt,nt)}else null!=(it=rt.deliveryDirectives)&&it.skip&&(st.deltaUpdateFailed=!0)}loadPlaylist(nt){super.loadPlaylist();const rt=this.currentLevelIndex,it=this.currentLevel;if(it&&this.shouldLoadPlaylist(it)){let at=it.uri;if(nt)try{at=nt.addDirectives(at)}catch(nt){this.warn(`Could not construct new URL with HLS Delivery Directives: ${nt}`)}const st=it.attrs["PATHWAY-ID"];this.log(`Loading level index ${rt}${void 0!==(null==nt?void 0:nt.msn)?" at sn "+nt.msn+" part "+nt.part:""} with${st?" Pathway "+st:""} ${at}`),this.clearTimer(),this.hls.trigger(Ot.LEVEL_LOADING,{url:at,level:rt,pathwayId:it.attrs["PATHWAY-ID"],id:0,deliveryDirectives:nt||null})}}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(nt){this.level=nt,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=nt)}removeLevel(nt){var rt;const it=this._levels.filter(((rt,it)=>it!==nt||(this.steering&&this.steering.removeLevel(rt),rt===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,rt.details&&rt.details.fragments.forEach((nt=>nt.level=-1))),!1)));reassignFragmentLevelIndexes(it),this._levels=it,this.currentLevelIndex>-1&&null!=(rt=this.currentLevel)&&rt.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(Ot.LEVELS_UPDATED,{levels:it})}onLevelsUpdated(nt,{levels:rt}){this._levels=rt}checkMaxAutoUpdated(){const{autoLevelCapping:nt,maxAutoLevel:rt,maxHdcpLevel:it}=this.hls;this._maxAutoLevel!==rt&&(this._maxAutoLevel=rt,this.hls.trigger(Ot.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:nt,levels:this.levels,maxAutoLevel:rt,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:it}))}}function assignTrackIdsByGroup(nt){const rt={};nt.forEach((nt=>{const it=nt.groupId||"";nt.id=rt[it]=rt[it]||0,rt[it]++}))}class GapController extends Logger{constructor(nt,rt,it,at){super("gap-controller",at.logger),this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.ended=0,this.config=nt,this.media=rt,this.fragmentTracker=it,this.hls=at}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(nt,rt,it,at){const{config:st,media:ot,stalled:lt}=this;if(null===ot)return;const{currentTime:ut,seeking:ct}=ot,dt=this.seeking&&!ct,ht=!this.seeking&&ct;if(this.seeking=ct,ut!==nt){if(nt&&(this.ended=0),this.moved=!0,ct||(this.nudgeRetry=0),null!==lt){if(this.stallReported){const nt=self.performance.now()-lt;this.warn(`playback not stuck anymore @${ut}, after ${Math.round(nt)}ms`),this.stallReported=!1}this.stalled=null}return}if(ht||dt)return void(this.stalled=null);if(ot.paused&&!ct||ot.ended||0===ot.playbackRate||!BufferHelper.getBuffered(ot).length)return!this.ended&&ot.ended&&(this.ended=ut||1,this.hls.trigger(Ot.MEDIA_ENDED,{stalled:!1})),void(this.nudgeRetry=0);const pt=BufferHelper.bufferInfo(ot,ut,0),_t=pt.nextStart||0;if(ct){const nt=pt.len>2,it=!_t||rt&&rt.start<=ut||_t-ut>2&&!this.fragmentTracker.getPartialFragment(ut);if(nt||it)return;this.moved=!1}if(!this.moved&&null!==this.stalled){if(!(pt.len>0)&&!_t)return;const nt=Math.max(_t,pt.start||0)-ut,rt=!(null==it||!it.live)?2*it.targetduration:2,at=this.fragmentTracker.getPartialFragment(ut);if(nt>0&&(nt<=rt||at))return void(ot.paused||this._trySkipBufferHole(at))}const Et=self.performance.now();if(null===lt)return void(this.stalled=Et);const St=Et-lt;if(!ct&&St>=250){if(at===Ii&&(null==it||!it.live)&&Math.abs(ut-((null==it?void 0:it.edge)||0))<1){if(St<1e3||this.ended)return;return this.ended=ut||1,void this.hls.trigger(Ot.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(pt),!this.media)return}const wt=BufferHelper.bufferInfo(ot,ut,st.maxBufferHole);this._tryFixBufferStall(wt,St)}_tryFixBufferStall(nt,rt){const{config:it,fragmentTracker:at,media:st}=this;if(null===st)return;const ot=st.currentTime,lt=at.getPartialFragment(ot);if(lt){if(this._trySkipBufferHole(lt)||!this.media)return}(nt.len>it.maxBufferHole||nt.nextStart&&nt.nextStart-ot<it.maxBufferHole)&&rt>1e3*it.highBufferWatchdogPeriod&&(this.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(nt){const{hls:rt,media:it,stallReported:at}=this;if(!at&&it){this.stallReported=!0;const at=new Error(`Playback stalling at @${it.currentTime} due to low buffer (${JSON.stringify(nt)})`);this.warn(at.message),rt.trigger(Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.BUFFER_STALLED_ERROR,fatal:!1,error:at,buffer:nt.len})}}_trySkipBufferHole(nt){const{config:rt,hls:it,media:at}=this;if(null===at)return 0;const st=at.currentTime,ot=BufferHelper.bufferInfo(at,st,0),lt=st<ot.start?ot.start:ot.nextStart;if(lt){const ut=ot.len<=rt.maxBufferHole,ct=ot.len>0&&ot.len<1&&at.readyState<3,dt=lt-st;if(dt>0&&(ut||ct)){if(dt>rt.maxBufferHole){const{fragmentTracker:rt}=this;let it=!1;if(0===st){const nt=rt.getAppendedFrag(0,Ht);nt&&lt<nt.end&&(it=!0)}if(!it){const it=nt||rt.getAppendedFrag(st,Ht);if(it){let nt=!1,at=it.end;for(;at<lt;){const it=rt.getPartialFragment(at);if(!it){nt=!0;break}at+=it.duration}if(nt)return 0}}}const ot=Math.max(lt+.05,st+.1);if(this.warn(`skipping hole, adjusting currentTime from ${st} to ${ot}`),this.moved=!0,this.stalled=null,at.currentTime=ot,nt&&!nt.gap){const rt=new Error(`fragment loaded with buffer holes, seeking from ${st} to ${ot}`);it.trigger(Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:rt,reason:rt.message,frag:nt})}return ot}}return 0}_tryNudgeBuffer(){const{config:nt,hls:rt,media:it,nudgeRetry:at}=this;if(null===it)return;const st=it.currentTime;if(this.nudgeRetry++,at<nt.nudgeMaxRetry){const ot=st+(at+1)*nt.nudgeOffset,lt=new Error(`Nudging 'currentTime' from ${st} to ${ot}`);this.warn(lt.message),it.currentTime=ot,rt.trigger(Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.BUFFER_NUDGE_ON_STALL,error:lt,fatal:!1})}else{const it=new Error(`Playhead still not moving while enough data buffered @${st} after ${nt.nudgeMaxRetry} nudges`);this.error(it.message),rt.trigger(Ot.ERROR,{type:Pt.MEDIA_ERROR,details:kt.BUFFER_STALLED_ERROR,error:it,fatal:!0})}}}function getSourceBuffer(){return self.SourceBuffer||self.WebKitSourceBuffer}function isMSESupported(){if(!getMediaSource())return!1;const nt=getSourceBuffer();return!nt||nt.prototype&&"function"==typeof nt.prototype.appendBuffer&&"function"==typeof nt.prototype.remove}class StreamController extends BaseStreamController{constructor(nt,rt,it){super(nt,rt,it,"stream-controller",Ht),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{const nt=this.gapController;nt&&(nt.ended=0),this.tick()},this.onMediaSeeked=()=>{const nt=this.media,rt=nt?nt.currentTime:null;wt(rt)&&this.log(`Media seeked to ${rt.toFixed(3)}`);const it=this.getMainFwdBufferInfo();null!==it&&0!==it.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${it?it.len:"empty"})`)},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:nt}=this;nt.on(Ot.MANIFEST_PARSED,this.onManifestParsed,this),nt.on(Ot.LEVEL_LOADING,this.onLevelLoading,this),nt.on(Ot.LEVEL_LOADED,this.onLevelLoaded,this),nt.on(Ot.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),nt.on(Ot.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),nt.on(Ot.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),nt.on(Ot.BUFFER_CREATED,this.onBufferCreated,this),nt.on(Ot.BUFFER_FLUSHED,this.onBufferFlushed,this),nt.on(Ot.LEVELS_UPDATED,this.onLevelsUpdated,this),nt.on(Ot.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:nt}=this;nt.off(Ot.MANIFEST_PARSED,this.onManifestParsed,this),nt.off(Ot.LEVEL_LOADED,this.onLevelLoaded,this),nt.off(Ot.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),nt.off(Ot.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),nt.off(Ot.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),nt.off(Ot.BUFFER_CREATED,this.onBufferCreated,this),nt.off(Ot.BUFFER_FLUSHED,this.onBufferFlushed,this),nt.off(Ot.LEVELS_UPDATED,this.onLevelsUpdated,this),nt.off(Ot.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(nt,rt){if(this.levels){const{lastCurrentTime:it,hls:at}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let nt=at.startLevel;-1===nt&&(at.config.testBandwidth&&this.levels.length>1?(nt=0,this.bitrateTest=!0):nt=at.firstAutoLevel),at.nextLoadLevel=nt,this.level=at.loadLevel,this._hasEnoughToStart=!1}it>0&&-1===nt&&(this.log(`Override startPosition with lastCurrentTime @${it.toFixed(3)}`),nt=it),this.state=_i,this.nextLoadPosition=this.lastCurrentTime=nt,this.startPosition=rt?-1:nt,this.tick()}else this._forceStartLoad=!0,this.state=gi}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Mi:{const{levels:nt,level:rt}=this,it=null==nt?void 0:nt[rt],at=null==it?void 0:it.details;if(at&&(!at.live||this.levelLastLoaded===it)){if(this.waitForCdnTuneIn(at))break;this.state=_i;break}if(this.hls.nextLoadLevel!==this.level){this.state=_i;break}break}case Ti:{var nt;const rt=self.performance.now(),it=this.retryDate;if(!it||rt>=it||null!=(nt=this.media)&&nt.seeking){const{levels:nt,level:rt}=this,it=null==nt?void 0:nt[rt];this.resetStartWhenNotLoaded(it||null),this.state=_i}}}this.state===_i&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:nt,levelLastLoaded:rt,levels:it,media:at}=this;if(null===rt||!at&&(this.startFragRequested||!nt.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const st=this.buffering?nt.nextLoadLevel:nt.loadLevel;if(null==it||!it[st])return;const ot=it[st],lt=this.getMainFwdBufferInfo();if(null===lt)return;const ut=this.getLevelDetails();if(ut&&this._streamEnded(lt,ut)){const nt={};return this.altAudio&&(nt.type="video"),this.hls.trigger(Ot.BUFFER_EOS,nt),void(this.state=Ii)}if(!this.buffering)return;nt.loadLevel!==st&&-1===nt.manualLevel&&this.log(`Adapting to level ${st} from level ${this.level}`),this.level=nt.nextLoadLevel=st;const ct=ot.details;if(!ct||this.state===Mi||ct.live&&this.levelLastLoaded!==ot)return this.level=st,void(this.state=Mi);const dt=lt.len,ht=this.getMaxBufferLength(ot.maxBitrate);if(dt>=ht)return;this.backtrackFragment&&this.backtrackFragment.start>lt.end&&(this.backtrackFragment=null);const pt=this.backtrackFragment?this.backtrackFragment.start:lt.end;let _t=this.getNextFragment(pt,ct);if(this.couldBacktrack&&!this.fragPrevious&&_t&&"initSegment"!==_t.sn&&this.fragmentTracker.getState(_t)!==Nn){var Et;const nt=(null!=(Et=this.backtrackFragment)?Et:_t).sn-ct.startSN,rt=ct.fragments[nt-1];rt&&_t.cc===rt.cc&&(_t=rt,this.fragmentTracker.removeFragment(rt))}else this.backtrackFragment&&lt.len&&(this.backtrackFragment=null);if(_t&&this.isLoopLoading(_t,pt)){if(!_t.gap){const nt=this.audioOnly&&!this.altAudio?Wn:Jn,rt=(nt===Jn?this.videoBuffer:this.mediaBuffer)||this.media;rt&&this.afterBufferFlushed(rt,nt,Ht)}_t=this.getNextFragmentLoopLoading(_t,ct,lt,Ht,ht)}_t&&(!_t.initSegment||_t.initSegment.data||this.bitrateTest||(_t=_t.initSegment),this.loadFragment(_t,ot,pt))}loadFragment(nt,rt,it){const at=this.fragmentTracker.getState(nt);at===Ln||at===Mn?"initSegment"===nt.sn?this._loadInitSegment(nt,rt):this.bitrateTest?(this.log(`Fragment ${nt.sn} of level ${nt.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(nt,rt)):super.loadFragment(nt,rt,it):this.clearTrackerIfNeeded(nt)}getBufferedFrag(nt){return this.fragmentTracker.getBufferedFrag(nt,Ht)}followingBufferedFrag(nt){return nt?this.getBufferedFrag(nt.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:nt,media:rt}=this;if(null!=rt&&rt.readyState){let it;const at=this.getAppendedFrag(rt.currentTime);at&&at.start>1&&this.flushMainBuffer(0,at.start-1);const st=this.getLevelDetails();if(null!=st&&st.live){const nt=this.getMainFwdBufferInfo();if(!nt||nt.len<2*st.targetduration)return}if(!rt.paused&&nt){const rt=nt[this.hls.nextLoadLevel],at=this.fragLastKbps;it=at&&this.fragCurrent?this.fragCurrent.duration*rt.maxBitrate/(1e3*at)+1:0}else it=0;const ot=this.getBufferedFrag(rt.currentTime+it);if(ot){const nt=this.followingBufferedFrag(ot);if(nt){this.abortCurrentFrag();const rt=nt.maxStartPTS?nt.maxStartPTS:nt.start,it=nt.duration,at=Math.max(ot.end,rt+Math.min(Math.max(it-this.config.maxFragLookUpTolerance,it*(this.couldBacktrack?.5:.125)),it*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(at,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const nt=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,nt&&(nt.abortRequests(),this.fragmentTracker.removeFragment(nt)),this.state){case yi:case vi:case Ti:case Ai:case Ri:this.state=_i}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(nt,rt){super.flushMainBuffer(nt,rt,this.altAudio?"video":null)}onMediaAttached(nt,rt){super.onMediaAttached(nt,rt);const it=rt.media;it.removeEventListener("playing",this.onMediaPlaying),it.removeEventListener("seeked",this.onMediaSeeked),it.addEventListener("playing",this.onMediaPlaying),it.addEventListener("seeked",this.onMediaSeeked),this.gapController=new GapController(this.config,it,this.fragmentTracker,this.hls)}onMediaDetaching(nt,rt){const{media:it}=this;it&&(it.removeEventListener("playing",this.onMediaPlaying),it.removeEventListener("seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching(nt,rt);!!rt.transferMedia||(this._hasEnoughToStart=!1)}triggerEnded(){const nt=this.gapController;if(nt){var rt;if(nt.ended)return;nt.ended=(null==(rt=this.media)?void 0:rt.currentTime)||1}this.hls.trigger(Ot.MEDIA_ENDED,{stalled:!1})}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(Ot.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(nt,rt){let it=!1,at=!1;rt.levels.forEach((nt=>{const rt=nt.audioCodec;rt&&(it=it||-1!==rt.indexOf("mp4a.40.2"),at=at||-1!==rt.indexOf("mp4a.40.5"))})),this.audioCodecSwitch=it&&at&&!function changeTypeSupported(){var nt;const rt=getSourceBuffer();return"function"==typeof(null==rt||null==(nt=rt.prototype)?void 0:nt.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=rt.levels,this.startFragRequested=!1}onLevelLoading(nt,rt){const{levels:it}=this;if(!it||this.state!==_i)return;const at=it[rt.level];(!at.details||at.details.live&&this.levelLastLoaded!==at||this.waitForCdnTuneIn(at.details))&&(this.state=Mi)}onLevelLoaded(nt,rt){var it;const{levels:at,startFragRequested:st}=this,ot=rt.level,lt=rt.details,ut=lt.totalduration;if(!at)return void this.warn(`Levels were reset while loading level ${ot}`);this.log(`Level ${ot} loaded [${lt.startSN},${lt.endSN}]${lt.lastPartSn?`[part-${lt.lastPartSn}-${lt.lastPartIndex}]`:""}, cc [${lt.startCC}, ${lt.endCC}] duration:${ut}`);const ct=at[ot],dt=this.fragCurrent;!dt||this.state!==vi&&this.state!==Ti||dt.level!==rt.level&&dt.loader&&this.abortCurrentFrag();let ht=0;if(lt.live||null!=(it=ct.details)&&it.live){var pt;if(this.checkLiveUpdate(lt),lt.deltaUpdateFailed)return;ht=this.alignPlaylists(lt,ct.details,null==(pt=this.levelLastLoaded)?void 0:pt.details)}if(ct.details=lt,this.levelLastLoaded=ct,st||this.setStartPosition(lt,ht),this.hls.trigger(Ot.LEVEL_UPDATED,{details:lt,level:ot}),this.state===Mi){if(this.waitForCdnTuneIn(lt))return;this.state=_i}st&&lt.live&&this.synchronizeToLiveEdge(lt),this.tick()}synchronizeToLiveEdge(nt){const{config:rt,media:it}=this;if(!it)return;const at=this.hls.liveSyncPosition,st=it.currentTime,ot=nt.fragmentStart,lt=nt.edge,ut=st>=ot-rt.maxFragLookUpTolerance&&st<=lt;if(null!==at&&it.duration>at&&(st<at||!ut)){const ot=void 0!==rt.liveMaxLatencyDuration?rt.liveMaxLatencyDuration:rt.liveMaxLatencyDurationCount*nt.targetduration;(!ut&&it.readyState<4||st<lt-ot)&&(this._hasEnoughToStart||(this.nextLoadPosition=at),it.readyState&&(this.warn(`Playback: ${st.toFixed(3)} is located too far from the end of live sliding playlist: ${lt}, reset currentTime to : ${at.toFixed(3)}`),it.currentTime=at))}}_handleFragmentLoadProgress(nt){var rt;const it=nt.frag,{part:at,payload:st}=nt,{levels:ot}=this;if(!ot)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${it.sn} of level ${it.level} will not be buffered`);const lt=ot[it.level];if(!lt)return void this.warn(`Level ${it.level} not found on progress`);const ut=lt.details;if(!ut)return this.warn(`Dropping fragment ${it.sn} of level ${it.level} after level details were reset`),void this.fragmentTracker.removeFragment(it);const ct=lt.videoCodec,dt=ut.PTSKnown||!ut.live,ht=null==(rt=it.initSegment)?void 0:rt.data,pt=this._getAudioCodec(lt),_t=this.transmuxer=this.transmuxer||new TransmuxerInterface(this.hls,Ht,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),Et=at?at.index:-1,St=-1!==Et,wt=new ChunkMetadata(it.level,it.sn,it.stats.chunkCount,st.byteLength,Et,St),Lt=this.initPTS[it.cc];_t.push(st,ht,pt,ct,it,at,ut.totalduration,dt,wt,Lt)}onAudioTrackSwitching(nt,rt){const it=this.altAudio;if(!!!rt.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const nt=this.fragCurrent;nt&&(this.log("Switching to main audio track, cancel main fragment load"),nt.abortRequests(),this.fragmentTracker.removeFragment(nt)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const nt=this.hls;it&&(nt.trigger(Ot.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),nt.trigger(Ot.AUDIO_TRACK_SWITCHED,rt)}}onAudioTrackSwitched(nt,rt){const it=rt.id,at=!!this.hls.audioTracks[it].url;if(at){const nt=this.videoBuffer;nt&&this.mediaBuffer!==nt&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=nt)}this.altAudio=at,this.tick()}onBufferCreated(nt,rt){const it=rt.tracks;let at,st,ot=!1;for(const nt in it){const rt=it[nt];if("main"===rt.id){if(st=nt,at=rt,"video"===nt){const rt=it[nt];rt&&(this.videoBuffer=rt.buffer)}}else ot=!0}ot&&at?(this.log(`Alternate track found, use ${st}.buffered to schedule main fragment loading`),this.mediaBuffer=at.buffer):this.mediaBuffer=this.media}onFragBuffered(nt,rt){const{frag:it,part:at}=rt,st=it.type===Ht;if(st){if(this.fragContextChanged(it))return this.warn(`Fragment ${it.sn}${at?" p: "+at.index:""} of level ${it.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===Ri&&(this.state=_i));const nt=at?at.stats:it.stats;this.fragLastKbps=Math.round(8*nt.total/(nt.buffering.end-nt.loading.first)),"initSegment"!==it.sn&&(this.fragPrevious=it),this.fragBufferedComplete(it,at)}const ot=this.media;ot&&(!this._hasEnoughToStart&&ot.buffered.length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),st&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(nt,rt){var it;if(rt.fatal)this.state=wi;else switch(rt.details){case kt.FRAG_GAP:case kt.FRAG_PARSING_ERROR:case kt.FRAG_DECRYPT_ERROR:case kt.FRAG_LOAD_ERROR:case kt.FRAG_LOAD_TIMEOUT:case kt.KEY_LOAD_ERROR:case kt.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ht,rt);break;case kt.LEVEL_LOAD_ERROR:case kt.LEVEL_LOAD_TIMEOUT:case kt.LEVEL_PARSING_ERROR:rt.levelRetry||this.state!==Mi||(null==(it=rt.context)?void 0:it.type)!==Bt||(this.state=_i);break;case kt.BUFFER_APPEND_ERROR:case kt.BUFFER_FULL_ERROR:if(!rt.parent||"main"!==rt.parent)return;if(rt.details===kt.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(rt)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case kt.INTERNAL_EXCEPTION:this.recoverWorkerError(rt)}}checkBuffer(){const{media:nt,gapController:rt}=this;if(nt&&rt&&nt.readyState){if(this._hasEnoughToStart||!BufferHelper.getBuffered(nt).length){const nt=this.state,it=nt!==_i?this.fragCurrent:null,at=this.getLevelDetails();rt.poll(this.lastCurrentTime,it,at,nt)}this.lastCurrentTime=nt.currentTime}}onFragLoadEmergencyAborted(){this.state=_i,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(nt,{type:rt}){if(rt!==Wn||this.audioOnly&&!this.altAudio){const nt=(rt===Jn?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(nt,rt,Ht),this.tick()}}onLevelsUpdated(nt,rt){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=rt.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:nt}=this;if(!nt)return;const rt=nt.currentTime;let it=this.startPosition;if(it>=0){if(nt.seeking)return void this.log(`could not seek to ${it}, already seeking at ${rt}`);const at=this.getLevelDetails(),st=this.config.timelineOffset;st&&it&&(it+=(null==at?void 0:at.appliedTimelineOffset)||st);const ot=BufferHelper.getBuffered(nt),lt=ot.length?ot.start(0):0,ut=lt-it,ct=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);ut>0&&(ut<ct||this.loadingParts&&ut<2*((null==at?void 0:at.partTarget)||0))&&(this.log(`adjusting start position by ${ut} to match buffer start`),it+=ut,this.startPosition=it),rt<it&&(this.log(`seek to target start position ${it} from current time ${rt} buffer start ${lt}`),nt.currentTime=it)}}_getAudioCodec(nt){let rt=this.config.defaultAudioCodec||nt.audioCodec;return this.audioCodecSwap&&rt&&(this.log("Swapping audio codec"),rt=-1!==rt.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),rt}_loadBitrateTestFrag(nt,rt){nt.bitrateTest=!0,this._doFragLoad(nt,rt).then((it=>{const{hls:at}=this;if(!it||this.fragContextChanged(nt))return;rt.fragmentError=0,this.state=_i,this.startFragRequested=!1,this.bitrateTest=!1;const st=nt.stats;st.parsing.start=st.parsing.end=st.buffering.start=st.buffering.end=self.performance.now(),at.trigger(Ot.FRAG_LOADED,it),nt.bitrateTest=!1}))}_handleTransmuxComplete(nt){var rt;const it=this.playlistType,{hls:at}=this,{remuxResult:st,chunkMeta:ot}=nt,lt=this.getCurrentContext(ot);if(!lt)return void this.resetWhenMissingContext(ot);const{frag:ut,part:ct,level:dt}=lt,{video:ht,text:pt,id3:_t,initSegment:Et}=st,{details:St}=dt,Lt=this.altAudio?void 0:st.audio;if(this.fragContextChanged(ut))this.fragmentTracker.removeFragment(ut);else{if(this.state=Ai,Et){if(null!=Et&&Et.tracks){const nt=ut.initSegment||ut;this._bufferInitSegment(dt,Et.tracks,nt,ot),at.trigger(Ot.FRAG_PARSING_INIT_SEGMENT,{frag:nt,id:it,tracks:Et.tracks})}const nt=Et.initPTS,rt=Et.timescale;wt(nt)&&(this.initPTS[ut.cc]={baseTime:nt,timescale:rt},at.trigger(Ot.INIT_PTS_FOUND,{frag:ut,id:it,initPTS:nt,timescale:rt}))}if(ht&&St){const nt=St.fragments[ut.sn-1-St.startSN],rt=ut.sn===St.startSN,it=!nt||ut.cc>nt.cc;if(!1!==st.independent){const{startPTS:nt,endPTS:at,startDTS:st,endDTS:lt}=ht;if(ct)ct.elementaryStreams[ht.type]={startPTS:nt,endPTS:at,startDTS:st,endDTS:lt};else if(ht.firstKeyFrame&&ht.independent&&1===ot.id&&!it&&(this.couldBacktrack=!0),ht.dropped&&ht.independent){const st=this.getMainFwdBufferInfo(),ot=(st?st.end:this.getLoadPosition())+this.config.maxBufferHole,ct=ht.firstKeyFramePTS?ht.firstKeyFramePTS:nt;if(!rt&&ot<ct-this.config.maxBufferHole&&!it)return void this.backtrack(ut);it&&(ut.gap=!0),ut.setElementaryStreamInfo(ht.type,ut.start,at,ut.start,lt,!0)}else rt&&nt-(St.appliedTimelineOffset||0)>2&&(ut.gap=!0);ut.setElementaryStreamInfo(ht.type,nt,at,st,lt),this.backtrackFragment&&(this.backtrackFragment=ut),this.bufferFragmentData(ht,ut,ct,ot,rt||it)}else{if(!rt&&!it)return void this.backtrack(ut);ut.gap=!0}}if(Lt){const{startPTS:nt,endPTS:rt,startDTS:it,endDTS:at}=Lt;ct&&(ct.elementaryStreams[Wn]={startPTS:nt,endPTS:rt,startDTS:it,endDTS:at}),ut.setElementaryStreamInfo(Wn,nt,rt,it,at),this.bufferFragmentData(Lt,ut,ct,ot)}if(St&&null!=_t&&null!=(rt=_t.samples)&&rt.length){const nt={id:it,frag:ut,details:St,samples:_t.samples};at.trigger(Ot.FRAG_PARSING_METADATA,nt)}if(St&&pt){const nt={id:it,frag:ut,details:St,samples:pt.samples};at.trigger(Ot.FRAG_PARSING_USERDATA,nt)}}}_bufferInitSegment(nt,rt,it,at){if(this.state!==Ai)return;this.audioOnly=!!rt.audio&&!rt.video,this.altAudio&&!this.audioOnly&&delete rt.audio;const{audio:st,video:ot,audiovideo:lt}=rt;if(st){let it=pickMostCompleteCodecName(st.codec,nt.audioCodec);"mp4a"===it&&(it="mp4a.40.5");const at=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){it&&(it=-1!==it.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const nt=st.metadata;nt&&"channelCount"in nt&&1!==(nt.channelCount||1)&&-1===at.indexOf("firefox")&&(it="mp4a.40.5")}it&&-1!==it.indexOf("mp4a.40.5")&&-1!==at.indexOf("android")&&"audio/mpeg"!==st.container&&(it="mp4a.40.2",this.log(`Android: force audio codec to ${it}`)),nt.audioCodec&&nt.audioCodec!==it&&this.log(`Swapping manifest audio codec "${nt.audioCodec}" for "${it}"`),st.levelCodec=it,st.id="main",this.log(`Init audio buffer, container:${st.container}, codecs[selected/level/parsed]=[${it||""}/${nt.audioCodec||""}/${st.codec}]`),delete rt.audiovideo}if(ot){ot.levelCodec=nt.videoCodec,ot.id="main";const it=ot.codec;if(4===(null==it?void 0:it.length))switch(it){case"hvc1":case"hev1":ot.codec="hvc1.1.6.L120.90";break;case"av01":ot.codec="av01.0.04M.08";break;case"avc1":ot.codec="avc1.42e01e"}this.log(`Init video buffer, container:${ot.container}, codecs[level/parsed]=[${nt.videoCodec||""}/${it}${ot.codec!==it?" parsed-corrected="+ot.codec:""}}]`),delete rt.audiovideo}lt&&(this.log(`Init audiovideo buffer, container:${lt.container}, codecs[level/parsed]=[${nt.codecs}/${lt.codec}]`),delete rt.video,delete rt.audio);const ut=Object.keys(rt);if(ut.length){if(this.hls.trigger(Ot.BUFFER_CODECS,rt),!this.hls)return;ut.forEach((nt=>{const st=rt[nt].initSegment;null!=st&&st.byteLength&&this.hls.trigger(Ot.BUFFER_APPENDING,{type:nt,data:st,frag:it,part:null,chunkMeta:at,parent:it.type})}))}this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Ht)}get maxBufferLength(){const{levels:nt,level:rt}=this,it=null==nt?void 0:nt[rt];return it?this.getMaxBufferLength(it.maxBitrate):this.config.maxBufferLength}backtrack(nt){this.couldBacktrack=!0,this.backtrackFragment=nt,this.resetTransmuxer(),this.flushBufferGap(nt),this.fragmentTracker.removeFragment(nt),this.fragPrevious=null,this.nextLoadPosition=nt.start,this.state=_i}checkFragmentChanged(){const nt=this.media;let rt=null;if(nt&&nt.readyState>1&&!1===nt.seeking){const it=nt.currentTime;if(BufferHelper.isBuffered(nt,it)?rt=this.getAppendedFrag(it):BufferHelper.isBuffered(nt,it+.1)&&(rt=this.getAppendedFrag(it+.1)),rt){this.backtrackFragment=null;const nt=this.fragPlaying,it=rt.level;nt&&rt.sn===nt.sn&&nt.level===it||(this.fragPlaying=rt,this.hls.trigger(Ot.FRAG_CHANGED,{frag:rt}),nt&&nt.level===it||this.hls.trigger(Ot.LEVEL_SWITCHED,{level:it}))}}}get nextLevel(){const nt=this.nextBufferedFrag;return nt?nt.level:-1}get currentFrag(){var nt;if(this.fragPlaying)return this.fragPlaying;const rt=(null==(nt=this.media)?void 0:nt.currentTime)||this.lastCurrentTime;return wt(rt)?this.getAppendedFrag(rt):null}get currentProgramDateTime(){var nt;const rt=(null==(nt=this.media)?void 0:nt.currentTime)||this.lastCurrentTime;if(wt(rt)){const nt=this.getLevelDetails(),it=this.currentFrag||(nt?findFragmentByPTS(null,nt.fragments,rt):null);if(it){const nt=it.programDateTime;if(null!==nt){const at=nt+1e3*(rt-it.start);return new Date(at)}}}return null}get currentLevel(){const nt=this.currentFrag;return nt?nt.level:-1}get nextBufferedFrag(){const nt=this.currentFrag;return nt?this.followingBufferedFrag(nt):null}get forceStartLoad(){return this._forceStartLoad}}class KeyLoader{constructor(nt){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=nt}abort(nt){for(const it in this.keyUriToKeyInfo){const at=this.keyUriToKeyInfo[it].loader;if(at){var rt;if(nt&&nt!==(null==(rt=at.context)?void 0:rt.frag.type))return;at.abort()}}}detach(){for(const nt in this.keyUriToKeyInfo){const rt=this.keyUriToKeyInfo[nt];(rt.mediaKeySessionContext||rt.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[nt]}}destroy(){this.detach();for(const nt in this.keyUriToKeyInfo){const rt=this.keyUriToKeyInfo[nt].loader;rt&&rt.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(nt,rt=kt.KEY_LOAD_ERROR,it,at,st){return new LoadError({type:Pt.NETWORK_ERROR,details:rt,fatal:!1,frag:nt,response:st,error:it,networkDetails:at})}loadClear(nt,rt){if(this.emeController&&this.config.emeEnabled){const{sn:it,cc:at}=nt;for(let nt=0;nt<rt.length;nt++){const st=rt[nt];if(at<=st.cc&&("initSegment"===it||"initSegment"===st.sn||it<st.sn)){this.emeController.selectKeySystemFormat(st).then((nt=>{st.setKeyFormat(nt)}));break}}}}load(nt){return!nt.decryptdata&&nt.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(nt).then((rt=>this.loadInternal(nt,rt))):this.loadInternal(nt)}loadInternal(nt,rt){var it,at;rt&&nt.setKeyFormat(rt);const st=nt.decryptdata;if(!st){const it=new Error(rt?`Expected frag.decryptdata to be defined after setting format ${rt}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(nt,kt.KEY_LOAD_ERROR,it))}const ot=st.uri;if(!ot)return Promise.reject(this.createKeyLoadError(nt,kt.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${ot}"`)));let lt=this.keyUriToKeyInfo[ot];if(null!=(it=lt)&&it.decryptdata.key)return st.key=lt.decryptdata.key,Promise.resolve({frag:nt,keyInfo:lt});var ut;if(null!=(at=lt)&&at.keyLoadPromise)switch(null==(ut=lt.mediaKeySessionContext)?void 0:ut.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return lt.keyLoadPromise.then((rt=>(st.key=rt.keyInfo.decryptdata.key,{frag:nt,keyInfo:lt})))}switch(lt=this.keyUriToKeyInfo[ot]={decryptdata:st,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},st.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===st.keyFormat?this.loadKeyHTTP(lt,nt):this.loadKeyEME(lt,nt);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(lt,nt);default:return Promise.reject(this.createKeyLoadError(nt,kt.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${st.method}"`)))}}loadKeyEME(nt,rt){const it={frag:rt,keyInfo:nt};if(this.emeController&&this.config.emeEnabled){const rt=this.emeController.loadKey(it);if(rt)return(nt.keyLoadPromise=rt.then((rt=>(nt.mediaKeySessionContext=rt,it)))).catch((rt=>{throw nt.keyLoadPromise=null,rt}))}return Promise.resolve(it)}loadKeyHTTP(nt,rt){const it=this.config,at=new(0,it.loader)(it);return rt.keyLoader=nt.loader=at,nt.keyLoadPromise=new Promise(((st,ot)=>{const lt={keyInfo:nt,frag:rt,responseType:"arraybuffer",url:nt.decryptdata.uri},ut=it.keyLoadPolicy.default,ct={loadPolicy:ut,timeout:ut.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},dt={onSuccess:(nt,rt,it,at)=>{const{frag:lt,keyInfo:ut,url:ct}=it;if(!lt.decryptdata||ut!==this.keyUriToKeyInfo[ct])return ot(this.createKeyLoadError(lt,kt.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),at));ut.decryptdata.key=lt.decryptdata.key=new Uint8Array(nt.data),lt.keyLoader=null,ut.loader=null,st({frag:lt,keyInfo:ut})},onError:(nt,it,at,st)=>{this.resetLoader(it),ot(this.createKeyLoadError(rt,kt.KEY_LOAD_ERROR,new Error(`HTTP Error ${nt.code} loading key ${nt.text}`),at,_objectSpread2({url:lt.url,data:void 0},nt)))},onTimeout:(nt,it,at)=>{this.resetLoader(it),ot(this.createKeyLoadError(rt,kt.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),at))},onAbort:(nt,it,at)=>{this.resetLoader(it),ot(this.createKeyLoadError(rt,kt.INTERNAL_ABORTED,new Error("key loading aborted"),at))}};at.load(lt,ct,dt)}))}resetLoader(nt){const{frag:rt,keyInfo:it,url:at}=nt,st=it.loader;rt.keyLoader===st&&(rt.keyLoader=null,it.loader=null),delete this.keyUriToKeyInfo[at],st&&st.destroy()}}function mapContextToLevelType(nt){const{type:rt}=nt;switch(rt){case Ut:return jt;case Gt:return Kt;default:return Ht}}function getResponseUrl(nt,rt){let it=nt.url;return void 0!==it&&0!==it.indexOf("data:")||(it=rt.url),it}class PlaylistLoader{constructor(nt){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=nt,this.registerListeners()}startLoad(nt){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:nt}=this;nt.on(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.on(Ot.LEVEL_LOADING,this.onLevelLoading,this),nt.on(Ot.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),nt.on(Ot.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:nt}=this;nt.off(Ot.MANIFEST_LOADING,this.onManifestLoading,this),nt.off(Ot.LEVEL_LOADING,this.onLevelLoading,this),nt.off(Ot.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),nt.off(Ot.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(nt){const rt=this.hls.config,it=rt.pLoader,at=rt.loader,st=new(it||at)(rt);return this.loaders[nt.type]=st,st}getInternalLoader(nt){return this.loaders[nt.type]}resetInternalLoader(nt){this.loaders[nt]&&delete this.loaders[nt]}destroyInternalLoaders(){for(const nt in this.loaders){const rt=this.loaders[nt];rt&&rt.destroy(),this.resetInternalLoader(nt)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(nt,rt){const{url:it}=rt;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ft,url:it,deliveryDirectives:null})}onLevelLoading(nt,rt){const{id:it,level:at,pathwayId:st,url:ot,deliveryDirectives:lt}=rt;this.load({id:it,level:at,pathwayId:st,responseType:"text",type:Bt,url:ot,deliveryDirectives:lt})}onAudioTrackLoading(nt,rt){const{id:it,groupId:at,url:st,deliveryDirectives:ot}=rt;this.load({id:it,groupId:at,level:null,responseType:"text",type:Ut,url:st,deliveryDirectives:ot})}onSubtitleTrackLoading(nt,rt){const{id:it,groupId:at,url:st,deliveryDirectives:ot}=rt;this.load({id:it,groupId:at,level:null,responseType:"text",type:Gt,url:st,deliveryDirectives:ot})}load(nt){var rt;const it=this.hls.config;let at,st=this.getInternalLoader(nt);if(st){const rt=st.context;if(rt&&rt.url===nt.url&&rt.level===nt.level)return void this.hls.logger.trace("[playlist-loader]: playlist request ongoing");this.hls.logger.log(`[playlist-loader]: aborting previous loader for type: ${nt.type}`),st.abort()}if(at=nt.type===Ft?it.manifestLoadPolicy.default:_extends({},it.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),st=this.createInternalLoader(nt),wt(null==(rt=nt.deliveryDirectives)?void 0:rt.part)){let rt;if(nt.type===Bt&&null!==nt.level?rt=this.hls.levels[nt.level].details:nt.type===Ut&&null!==nt.id?rt=this.hls.audioTracks[nt.id].details:nt.type===Gt&&null!==nt.id&&(rt=this.hls.subtitleTracks[nt.id].details),rt){const nt=rt.partTarget,it=rt.targetduration;if(nt&&it){const rt=1e3*Math.max(3*nt,.8*it);at=_extends({},at,{maxTimeToFirstByteMs:Math.min(rt,at.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(rt,at.maxTimeToFirstByteMs)})}}}const ot=at.errorRetry||at.timeoutRetry||{},lt={loadPolicy:at,timeout:at.maxLoadTimeMs,maxRetry:ot.maxNumRetry||0,retryDelay:ot.retryDelayMs||0,maxRetryDelay:ot.maxRetryDelayMs||0},ut={onSuccess:(nt,rt,it,at)=>{const st=this.getInternalLoader(it);this.resetInternalLoader(it.type);const ot=nt.data;0===ot.indexOf("#EXTM3U")?(rt.parsing.start=performance.now(),M3U8Parser.isMediaPlaylist(ot)?this.handleTrackOrLevelPlaylist(nt,rt,it,at||null,st):this.handleMasterPlaylist(nt,rt,it,at)):this.handleManifestParsingError(nt,it,new Error("no EXTM3U delimiter"),at||null,rt)},onError:(nt,rt,it,at)=>{this.handleNetworkError(rt,it,!1,nt,at)},onTimeout:(nt,rt,it)=>{this.handleNetworkError(rt,it,!0,void 0,nt)}};st.load(nt,lt,ut)}handleMasterPlaylist(nt,rt,it,at){const st=this.hls,ot=nt.data,lt=getResponseUrl(nt,it),ut=M3U8Parser.parseMasterPlaylist(ot,lt);if(ut.playlistParsingError)return void this.handleManifestParsingError(nt,it,ut.playlistParsingError,at,rt);const{contentSteering:ct,levels:dt,sessionData:ht,sessionKeys:pt,startTimeOffset:_t,variableList:Et}=ut;this.variableList=Et;const{AUDIO:St=[],SUBTITLES:wt,"CLOSED-CAPTIONS":Lt}=M3U8Parser.parseMasterPlaylistMedia(ot,lt,ut);if(St.length){St.some((nt=>!nt.url))||!dt[0].audioCodec||dt[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),St.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new AttrList({}),bitrate:0,url:""}))}st.trigger(Ot.MANIFEST_LOADED,{levels:dt,audioTracks:St,subtitles:wt,captions:Lt,contentSteering:ct,url:lt,stats:rt,networkDetails:at,sessionData:ht,sessionKeys:pt,startTimeOffset:_t,variableList:Et})}handleTrackOrLevelPlaylist(nt,rt,it,at,st){const ot=this.hls,{id:lt,level:ut,type:ct}=it,dt=getResponseUrl(nt,it),ht=wt(ut)?ut:wt(lt)?lt:0,pt=mapContextToLevelType(it),_t=M3U8Parser.parseLevelPlaylist(nt.data,dt,ht,pt,0,this.variableList);if(ct===Ft){const nt={attrs:new AttrList({}),bitrate:0,details:_t,name:"",url:dt};ot.trigger(Ot.MANIFEST_LOADED,{levels:[nt],audioTracks:[],url:dt,stats:rt,networkDetails:at,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}rt.parsing.end=performance.now(),it.levelDetails=_t,this.handlePlaylistLoaded(_t,nt,rt,it,at,st)}handleManifestParsingError(nt,rt,it,at,st){this.hls.trigger(Ot.ERROR,{type:Pt.NETWORK_ERROR,details:kt.MANIFEST_PARSING_ERROR,fatal:rt.type===Ft,url:nt.url,err:it,error:it,reason:it.message,response:nt,context:rt,networkDetails:at,stats:st})}handleNetworkError(nt,rt,it=!1,at,st){let ot=`A network ${it?"timeout":"error"+(at?" (status "+at.code+")":"")} occurred while loading ${nt.type}`;nt.type===Bt?ot+=`: ${nt.level} id: ${nt.id}`:nt.type!==Ut&&nt.type!==Gt||(ot+=` id: ${nt.id} group-id: "${nt.groupId}"`);const lt=new Error(ot);this.hls.logger.warn(`[playlist-loader]: ${ot}`);let ut=kt.UNKNOWN,ct=!1;const dt=this.getInternalLoader(nt);switch(nt.type){case Ft:ut=it?kt.MANIFEST_LOAD_TIMEOUT:kt.MANIFEST_LOAD_ERROR,ct=!0;break;case Bt:ut=it?kt.LEVEL_LOAD_TIMEOUT:kt.LEVEL_LOAD_ERROR,ct=!1;break;case Ut:ut=it?kt.AUDIO_TRACK_LOAD_TIMEOUT:kt.AUDIO_TRACK_LOAD_ERROR,ct=!1;break;case Gt:ut=it?kt.SUBTITLE_TRACK_LOAD_TIMEOUT:kt.SUBTITLE_LOAD_ERROR,ct=!1}dt&&this.resetInternalLoader(nt.type);const ht={type:Pt.NETWORK_ERROR,details:ut,fatal:ct,url:nt.url,loader:dt,context:nt,error:lt,networkDetails:rt,stats:st};if(at){const it=(null==rt?void 0:rt.url)||nt.url;ht.response=_objectSpread2({url:it,data:void 0},at)}this.hls.trigger(Ot.ERROR,ht)}handlePlaylistLoaded(nt,rt,it,at,st,ot){const lt=this.hls,{type:ut,level:ct,id:dt,groupId:ht,deliveryDirectives:pt}=at,_t=getResponseUrl(rt,at),Et=mapContextToLevelType(at),St="number"==typeof at.level&&Et===Ht?ct:void 0;if(!nt.fragments.length){const nt=new Error("No Segments found in Playlist");return void lt.trigger(Ot.ERROR,{type:Pt.NETWORK_ERROR,details:kt.LEVEL_EMPTY_ERROR,fatal:!1,url:_t,error:nt,reason:nt.message,response:rt,context:at,level:St,parent:Et,networkDetails:st,stats:it})}nt.targetduration||(nt.playlistParsingError=new Error("Missing Target Duration"));const wt=nt.playlistParsingError;if(wt)lt.trigger(Ot.ERROR,{type:Pt.NETWORK_ERROR,details:kt.LEVEL_PARSING_ERROR,fatal:!1,url:_t,error:wt,reason:wt.message,response:rt,context:at,level:St,parent:Et,networkDetails:st,stats:it});else switch(nt.live&&ot&&(ot.getCacheAge&&(nt.ageHeader=ot.getCacheAge()||0),ot.getCacheAge&&!isNaN(nt.ageHeader)||(nt.ageHeader=0)),ut){case Ft:case Bt:lt.trigger(Ot.LEVEL_LOADED,{details:nt,level:St||0,id:dt||0,stats:it,networkDetails:st,deliveryDirectives:pt});break;case Ut:lt.trigger(Ot.AUDIO_TRACK_LOADED,{details:nt,id:dt||0,groupId:ht||"",stats:it,networkDetails:st,deliveryDirectives:pt});break;case Gt:lt.trigger(Ot.SUBTITLE_TRACK_LOADED,{details:nt,id:dt||0,groupId:ht||"",stats:it,networkDetails:st,deliveryDirectives:pt})}}}class Hls{static get version(){return Ni}static isMSESupported(){return isMSESupported()}static isSupported(){return function isSupported(){if(!isMSESupported())return!1;const nt=getMediaSource();return"function"==typeof(null==nt?void 0:nt.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some((rt=>nt.isTypeSupported(mimeTypeForCodec(rt,"video"))))||["mp4a.40.2","fLaC"].some((rt=>nt.isTypeSupported(mimeTypeForCodec(rt,"audio")))))}()}static getMediaSource(){return getMediaSource()}static get Events(){return Ot}static get MetadataSchema(){return Zi}static get ErrorTypes(){return Pt}static get ErrorDetails(){return kt}static get DefaultConfig(){return Hls.defaultConfig?Hls.defaultConfig:ys}static set DefaultConfig(nt){Hls.defaultConfig=nt}constructor(nt={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new ki,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this.triggeringException=void 0,this._sessionId=void 0;const rt=this.logger=function enableLogs(nt,rt,it){const at=createLogger();if("object"==typeof console&&!0===nt||"object"==typeof nt){const st=["debug","log","info","warn","error"];st.forEach((rt=>{at[rt]=getLoggerFn(rt,nt,it)}));try{at.log(`Debug logs enabled for "${rt}" in hls.js version undefined`)}catch(nt){return createLogger()}st.forEach((rt=>{Wt[rt]=getLoggerFn(rt,nt)}))}else _extends(Wt,at);return at}(nt.debug||!1,"Hls instance",nt.assetPlayerId),it=this.config=function mergeConfig(nt,rt,it){if((rt.liveSyncDurationCount||rt.liveMaxLatencyDurationCount)&&(rt.liveSyncDuration||rt.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==rt.liveMaxLatencyDurationCount&&(void 0===rt.liveSyncDurationCount||rt.liveMaxLatencyDurationCount<=rt.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==rt.liveMaxLatencyDuration&&(void 0===rt.liveSyncDuration||rt.liveMaxLatencyDuration<=rt.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const at=deepCpy(nt),st=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((nt=>{const ot=`${"level"===nt?"playlist":nt}LoadPolicy`,lt=void 0===rt[ot],ut=[];st.forEach((it=>{const st=`${nt}Loading${it}`,ct=rt[st];if(void 0!==ct&&lt){ut.push(st);const nt=at[ot].default;switch(rt[ot]={default:nt},it){case"TimeOut":nt.maxLoadTimeMs=ct,nt.maxTimeToFirstByteMs=ct;break;case"MaxRetry":nt.errorRetry.maxNumRetry=ct,nt.timeoutRetry.maxNumRetry=ct;break;case"RetryDelay":nt.errorRetry.retryDelayMs=ct,nt.timeoutRetry.retryDelayMs=ct;break;case"MaxRetryTimeout":nt.errorRetry.maxRetryDelayMs=ct,nt.timeoutRetry.maxRetryDelayMs=ct}}})),ut.length&&it.warn(`hls.js config: "${ut.join('", "')}" setting(s) are deprecated, use "${ot}": ${JSON.stringify(rt[ot])}`)})),_objectSpread2(_objectSpread2({},at),rt)}(Hls.DefaultConfig,nt,rt);this.userConfig=nt,it.progressive&&enableStreamingMode(it,rt);const{abrController:at,bufferController:st,capLevelController:ot,errorController:lt,fpsController:ut}=it,ct=new lt(this),dt=this.abrController=new at(this),ht=new FragmentTracker(this),pt=it.interstitialsController,_t=pt?this.interstitialsController=new pt(this,Hls):null,Et=this.bufferController=new st(this,ht),St=this.capLevelController=new ot(this),wt=new ut(this),Lt=new PlaylistLoader(this),Ct=it.contentSteeringController,Pt=Ct?new Ct(this):null,kt=this.levelController=new LevelController(this,Pt),Ft=new ID3TrackController(this),Bt=new KeyLoader(this.config),Ut=this.streamController=new StreamController(this,ht,Bt);St.setStreamController(Ut),wt.setStreamController(Ut);const Gt=[Lt,kt,Ut];_t&&Gt.splice(1,0,_t),Pt&&Gt.splice(1,0,Pt),this.networkControllers=Gt;const Ht=[dt,Et,St,wt,Ft,ht];this.audioTrackController=this.createController(it.audioTrackController,Gt);const jt=it.audioStreamController;jt&&Gt.push(new jt(this,ht,Bt)),this.subtitleTrackController=this.createController(it.subtitleTrackController,Gt);const Kt=it.subtitleStreamController;Kt&&Gt.push(new Kt(this,ht,Bt)),this.createController(it.timelineController,Ht),Bt.emeController=this.emeController=this.createController(it.emeController,Ht),this.cmcdController=this.createController(it.cmcdController,Ht),this.latencyController=this.createController(LatencyController,Ht),this.coreComponents=Ht,Gt.push(ct);const $t=ct.onErrorOut;"function"==typeof $t&&this.on(Ot.ERROR,$t,ct)}createController(nt,rt){if(nt){const it=new nt(this);return rt&&rt.push(it),it}return null}on(nt,rt,it=this){this._emitter.on(nt,rt,it)}once(nt,rt,it=this){this._emitter.once(nt,rt,it)}removeAllListeners(nt){this._emitter.removeAllListeners(nt)}off(nt,rt,it=this,at){this._emitter.off(nt,rt,it,at)}listeners(nt){return this._emitter.listeners(nt)}emit(nt,rt,it){return this._emitter.emit(nt,rt,it)}trigger(nt,rt){if(this.config.debug)return this.emit(nt,nt,rt);try{return this.emit(nt,nt,rt)}catch(rt){if(this.logger.error("An internal error happened while handling event "+nt+'. Error message: "'+rt.message+'". Here is a stacktrace:',rt),!this.triggeringException){this.triggeringException=!0;const it=nt===Ot.ERROR;this.trigger(Ot.ERROR,{type:Pt.OTHER_ERROR,details:kt.INTERNAL_EXCEPTION,fatal:it,event:nt,error:rt}),this.triggeringException=!1}}return!1}listenerCount(nt){return this._emitter.listenerCount(nt)}destroy(){this.logger.log("destroy"),this.trigger(Ot.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach((nt=>nt.destroy())),this.networkControllers.length=0,this.coreComponents.forEach((nt=>nt.destroy())),this.coreComponents.length=0;const nt=this.config;nt.xhrSetup=nt.fetchSetup=void 0,this.userConfig=null}attachMedia(nt){if(!nt||"media"in nt&&!nt.media){const rt=new Error(`attachMedia failed: invalid argument (${nt})`);return void this.trigger(Ot.ERROR,{type:Pt.OTHER_ERROR,details:kt.ATTACH_MEDIA_ERROR,fatal:!0,error:rt})}this.logger.log("attachMedia");const rt="media"in nt,it=rt?nt.media:nt,at=rt?nt:{media:it};this._media=it,this.trigger(Ot.MEDIA_ATTACHING,at)}detachMedia(){this.logger.log("detachMedia"),this.trigger(Ot.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const nt=this.bufferController.transferMedia();return this.trigger(Ot.MEDIA_DETACHING,{transferMedia:nt}),nt}loadSource(nt){this.stopLoad();const rt=this.media,it=this._url,at=this._url=Yn.buildAbsoluteURL(self.location.href,nt,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${at}`),rt&&it&&(it!==at||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(rt)),this.trigger(Ot.MANIFEST_LOADING,{url:nt})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(nt=-1,rt){this.logger.log(`startLoad(${nt+(rt?", <skip seek to start>":"")})`),this.resumeBuffering(),this.networkControllers.forEach((it=>{it.startLoad(nt,rt)}))}stopLoad(){this.logger.log("stopLoad"),this.networkControllers.forEach((nt=>{nt.stopLoad()}))}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach((nt=>{nt.resumeBuffering&&nt.resumeBuffering()})))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach((nt=>{nt.pauseBuffering&&nt.pauseBuffering()})))}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const nt=this._media,rt=null==nt?void 0:nt.currentTime;this.detachMedia(),nt&&(this.attachMedia(nt),rt&&this.startLoad(rt))}removeLevel(nt){this.levelController.removeLevel(nt)}get sessionId(){let nt=this._sessionId;return nt||(nt=this._sessionId=function uuid(){try{return crypto.randomUUID()}catch(nt){try{const nt=URL.createObjectURL(new Blob),rt=nt.toString();return URL.revokeObjectURL(nt),rt.slice(rt.lastIndexOf("/")+1)}catch(nt){let rt=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(nt=>{const it=(rt+16*Math.random())%16|0;return rt=Math.floor(rt/16),("x"==nt?it:3&it|8).toString(16)}))}}}()),nt}get levels(){const nt=this.levelController.levels;return nt||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get currentLevel(){return this.streamController.currentLevel}set currentLevel(nt){this.logger.log(`set currentLevel:${nt}`),this.levelController.manualLevel=nt,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(nt){this.logger.log(`set nextLevel:${nt}`),this.levelController.manualLevel=nt,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(nt){this.logger.log(`set loadLevel:${nt}`),this.levelController.manualLevel=nt}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(nt){this.levelController.nextLoadLevel=nt}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(nt){this.logger.log(`set firstLevel:${nt}`),this.levelController.firstLevel=nt}get startLevel(){const nt=this.levelController.startLevel;return-1===nt&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:nt}set startLevel(nt){this.logger.log(`set startLevel:${nt}`),-1!==nt&&(nt=Math.max(nt,this.minAutoLevel)),this.levelController.startLevel=nt}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(nt){const rt=!!nt;rt!==this.config.capLevelToPlayerSize&&(rt?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=rt)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:nt}=this.abrController;return nt?nt.getEstimate():NaN}set bandwidthEstimate(nt){this.abrController.resetEstimator(nt)}get abrEwmaDefaultEstimate(){const{bwEstimator:nt}=this.abrController;return nt?nt.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:nt}=this.abrController;return nt?nt.getEstimateTTFB():NaN}set autoLevelCapping(nt){this._autoLevelCapping!==nt&&(this.logger.log(`set autoLevelCapping:${nt}`),this._autoLevelCapping=nt,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(nt){(function isHdcpLevel(nt){return fn.indexOf(nt)>-1})(nt)&&this._maxHdcpLevel!==nt&&(this._maxHdcpLevel=nt,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:nt,config:{minAutoBitrate:rt}}=this;if(!nt)return 0;const it=nt.length;for(let at=0;at<it;at++)if(nt[at].maxBitrate>=rt)return at;return 0}get maxAutoLevel(){const{levels:nt,autoLevelCapping:rt,maxHdcpLevel:it}=this;let at;if(at=-1===rt&&null!=nt&&nt.length?nt.length-1:rt,it)for(let rt=at;rt--;){const at=nt[rt].attrs["HDCP-LEVEL"];if(at&&at<=it)return rt}return at}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(nt){this.abrController.nextAutoLevel=nt}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(nt){var rt;return(null==(rt=this.audioTrackController)?void 0:rt.setAudioOption(nt))||null}setSubtitleOption(nt){var rt;return(null==(rt=this.subtitleTrackController)?void 0:rt.setSubtitleOption(nt))||null}get allAudioTracks(){const nt=this.audioTrackController;return nt?nt.allAudioTracks:[]}get audioTracks(){const nt=this.audioTrackController;return nt?nt.audioTracks:[]}get audioTrack(){const nt=this.audioTrackController;return nt?nt.audioTrack:-1}set audioTrack(nt){const rt=this.audioTrackController;rt&&(rt.audioTrack=nt)}get allSubtitleTracks(){const nt=this.subtitleTrackController;return nt?nt.allSubtitleTracks:[]}get subtitleTracks(){const nt=this.subtitleTrackController;return nt?nt.subtitleTracks:[]}get subtitleTrack(){const nt=this.subtitleTrackController;return nt?nt.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(nt){const rt=this.subtitleTrackController;rt&&(rt.subtitleTrack=nt)}get subtitleDisplay(){const nt=this.subtitleTrackController;return!!nt&&nt.subtitleDisplay}set subtitleDisplay(nt){const rt=this.subtitleTrackController;rt&&(rt.subtitleDisplay=nt)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(nt){this.config.lowLatencyMode=nt}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(nt){this.latencyController.targetLatency=nt}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(nt){this.levelController.pathwayPriority=nt}get bufferedToEnd(){var nt;return!(null==(nt=this.bufferController)||!nt.bufferedToEnd)}get interstitialsManager(){var nt;return(null==(nt=this.interstitialsController)?void 0:nt.interstitialsManager)||null}getMediaDecodingInfo(nt,rt=this.allAudioTracks){return getMediaDecodingInfoPromise(nt,getAudioTracksByGroup(rt),navigator.mediaCapabilities)}}Hls.defaultConfig=void 0;const{ErrorTypes:Es,ErrorDetails:Ts,Events:Ss}=Hls;class MediaPlayerAdapterHTML5HLS extends MediaPlayerAdapterHTML5Video{constructor(nt){super(nt),this.currentSrc="",this.setup("video")}load(nt,rt,it,at,st){if(!nt)return void console.error("Bad source",nt,rt);this.active=!0,this.setVars(nt,rt,it,at,st);const ot=15e3,lt=new Hls({enableWorker:!0,liveDurationInfinity:!1,lowLatencyMode:!0,backBufferLength:0,fragLoadingTimeOut:ot,fragLoadingMaxRetry:1,levelLoadingMaxRetry:2,manifestLoadingMaxRetry:20,fragLoadingMaxRetryTimeout:ot,levelLoadingMaxRetryTimeout:ot,manifestLoadingMaxRetryTimeout:ot});this.setTextTracks(this.object,it),lt.loadSource(this.currentSrc),lt.attachMedia(this.object),lt.on(Ss.ERROR,((nt,rt)=>{if(console.error("HLS ERROR",rt),rt||(rt=nt),rt)if(rt.details&&rt.frag&&!rt.fatal){if(["fragParsingError","fragLoadError","bufferStalledError","bufferNudgeOnStall"].includes(rt.details))return this.skipSegment(rt.frag)}else if(rt.fatal)switch(rt.type){case Es.MEDIA_ERROR:rt.frag&&this.skipSegment(rt.frag),console.error("HLS fatal media error encountered, reload"),this.reload();break;case Es.NETWORK_ERROR:console.error("HLS fatal network error encountered, reload"),this.reload();break;default:console.error("HLS unknown fatal error encountered, destroy"),this.emit("error","HLS fatal error",!0)}})),this.hls=lt,this.connect()}skipSegment(nt){const rt=nt.start+nt.duration;if(nt.loader)console.warn("Fix level to "+rt),nt.loader.abort(),nt.loader.startPosition=rt,this.hls.trigger(Ss.LEVEL_LOADING,{url:nt.url});else{const it=this.hls.media.currentTime>=nt.start-12&&this.hls.media.currentTime<rt;console.warn("Skip from "+this.hls.media.currentTime+" to "+rt,nt,it),this.hls.stopLoad(),it&&(this.hls.media.currentTime=rt),this.hls.startLoad(rt),it&&this.hls.media.play()}}unload(){console.log("unload hls"),this.hls&&(console.log("unload hls disconnect"),this.hls.destroy(),this.hls=null,this.object.src="",console.log("unload hls super.unload"),super.unload(),console.log("unload hls OK"))}destroy(){console.log("hls destroy"),this.unload(),super.destroy()}}var bs={exports:{}};!function(nt){window,nt.exports=function(nt){var rt={};function i(it){if(rt[it])return rt[it].exports;var at=rt[it]={i:it,l:!1,exports:{}};return nt[it].call(at.exports,at,at.exports,i),at.l=!0,at.exports}return i.m=nt,i.c=rt,i.d=function(nt,rt,it){i.o(nt,rt)||Object.defineProperty(nt,rt,{enumerable:!0,get:it})},i.r=function(nt){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(nt,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(nt,"__esModule",{value:!0})},i.t=function(nt,rt){if(1&rt&&(nt=i(nt)),8&rt)return nt;if(4&rt&&"object"==typeof nt&&nt&&nt.__esModule)return nt;var it=Object.create(null);if(i.r(it),Object.defineProperty(it,"default",{enumerable:!0,value:nt}),2&rt&&"string"!=typeof nt)for(var at in nt)i.d(it,at,function(rt){return nt[rt]}.bind(null,at));return it},i.n=function(nt){var rt=nt&&nt.__esModule?function(){return nt.default}:function(){return nt};return i.d(rt,"a",rt),rt},i.o=function(nt,rt){return Object.prototype.hasOwnProperty.call(nt,rt)},i.p="",i(i.s=20)}([function(nt,rt,it){var at=it(9),st=it.n(at),ot=function(){function e(){}return e.e=function(nt,rt){nt&&!e.FORCE_GLOBAL_TAG||(nt=e.GLOBAL_TAG);var it="[".concat(nt,"] > ").concat(rt);e.ENABLE_CALLBACK&&e.emitter.emit("log","error",it),e.ENABLE_ERROR&&(console.error?console.error(it):console.warn?console.warn(it):console.log(it))},e.i=function(nt,rt){nt&&!e.FORCE_GLOBAL_TAG||(nt=e.GLOBAL_TAG);var it="[".concat(nt,"] > ").concat(rt);e.ENABLE_CALLBACK&&e.emitter.emit("log","info",it),e.ENABLE_INFO&&(console.info?console.info(it):console.log(it))},e.w=function(nt,rt){nt&&!e.FORCE_GLOBAL_TAG||(nt=e.GLOBAL_TAG);var it="[".concat(nt,"] > ").concat(rt);e.ENABLE_CALLBACK&&e.emitter.emit("log","warn",it),e.ENABLE_WARN&&(console.warn?console.warn(it):console.log(it))},e.d=function(nt,rt){nt&&!e.FORCE_GLOBAL_TAG||(nt=e.GLOBAL_TAG);var it="[".concat(nt,"] > ").concat(rt);e.ENABLE_CALLBACK&&e.emitter.emit("log","debug",it),e.ENABLE_DEBUG&&(console.debug?console.debug(it):console.log(it))},e.v=function(nt,rt){nt&&!e.FORCE_GLOBAL_TAG||(nt=e.GLOBAL_TAG);var it="[".concat(nt,"] > ").concat(rt);e.ENABLE_CALLBACK&&e.emitter.emit("log","verbose",it),e.ENABLE_VERBOSE&&console.log(it)},e}();ot.GLOBAL_TAG="mpegts.js",ot.FORCE_GLOBAL_TAG=!1,ot.ENABLE_ERROR=!0,ot.ENABLE_INFO=!0,ot.ENABLE_WARN=!0,ot.ENABLE_DEBUG=!0,ot.ENABLE_VERBOSE=!0,ot.ENABLE_CALLBACK=!1,ot.emitter=new st.a,rt.a=ot},function(nt,rt,it){var at;!function(nt){nt.IO_ERROR="io_error",nt.DEMUX_ERROR="demux_error",nt.INIT_SEGMENT="init_segment",nt.MEDIA_SEGMENT="media_segment",nt.LOADING_COMPLETE="loading_complete",nt.RECOVERED_EARLY_EOF="recovered_early_eof",nt.MEDIA_INFO="media_info",nt.METADATA_ARRIVED="metadata_arrived",nt.SCRIPTDATA_ARRIVED="scriptdata_arrived",nt.TIMED_ID3_METADATA_ARRIVED="timed_id3_metadata_arrived",nt.SYNCHRONOUS_KLV_METADATA_ARRIVED="synchronous_klv_metadata_arrived",nt.ASYNCHRONOUS_KLV_METADATA_ARRIVED="asynchronous_klv_metadata_arrived",nt.SMPTE2038_METADATA_ARRIVED="smpte2038_metadata_arrived",nt.SCTE35_METADATA_ARRIVED="scte35_metadata_arrived",nt.PES_PRIVATE_DATA_DESCRIPTOR="pes_private_data_descriptor",nt.PES_PRIVATE_DATA_ARRIVED="pes_private_data_arrived",nt.STATISTICS_INFO="statistics_info",nt.RECOMMEND_SEEKPOINT="recommend_seekpoint"}(at||(at={})),rt.a=at},function(nt,rt,it){it.d(rt,"c",(function(){return st})),it.d(rt,"b",(function(){return ot})),it.d(rt,"a",(function(){return lt}));var at=it(3),st={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},ot={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},lt=function(){function e(nt){this._type=nt||"undefined",this._status=st.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return e.prototype.destroy=function(){this._status=st.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},e.prototype.isWorking=function(){return this._status===st.kConnecting||this._status===st.kBuffering},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(nt){this._onContentLengthKnown=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(nt){this._onURLRedirect=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(nt){this._onDataArrival=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(nt){this._onError=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{get:function(){return this._onComplete},set:function(nt){this._onComplete=nt},enumerable:!1,configurable:!0}),e.prototype.open=function(nt,rt){throw new at.c("Unimplemented abstract function!")},e.prototype.abort=function(){throw new at.c("Unimplemented abstract function!")},e}()},function(nt,rt,it){it.d(rt,"d",(function(){return ot})),it.d(rt,"a",(function(){return lt})),it.d(rt,"b",(function(){return ut})),it.d(rt,"c",(function(){return ct}));var at,st=(at=function(nt,rt){return(at=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(nt,rt){nt.__proto__=rt}||function(nt,rt){for(var it in rt)Object.prototype.hasOwnProperty.call(rt,it)&&(nt[it]=rt[it])})(nt,rt)},function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Class extends value "+String(rt)+" is not a constructor or null");function i(){this.constructor=nt}at(nt,rt),nt.prototype=null===rt?Object.create(rt):(i.prototype=rt.prototype,new i)}),ot=function(){function e(nt){this._message=nt}return Object.defineProperty(e.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return this.name+": "+this.message},e}(),lt=function(nt){function t(rt){return nt.call(this,rt)||this}return st(t,nt),Object.defineProperty(t.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),t}(ot),ut=function(nt){function t(rt){return nt.call(this,rt)||this}return st(t,nt),Object.defineProperty(t.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),t}(ot),ct=function(nt){function t(rt){return nt.call(this,rt)||this}return st(t,nt),Object.defineProperty(t.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),t}(ot)},function(nt,rt,it){var at;!function(nt){nt.ERROR="error",nt.LOADING_COMPLETE="loading_complete",nt.RECOVERED_EARLY_EOF="recovered_early_eof",nt.MEDIA_INFO="media_info",nt.METADATA_ARRIVED="metadata_arrived",nt.SCRIPTDATA_ARRIVED="scriptdata_arrived",nt.TIMED_ID3_METADATA_ARRIVED="timed_id3_metadata_arrived",nt.SYNCHRONOUS_KLV_METADATA_ARRIVED="synchronous_klv_metadata_arrived",nt.ASYNCHRONOUS_KLV_METADATA_ARRIVED="asynchronous_klv_metadata_arrived",nt.SMPTE2038_METADATA_ARRIVED="smpte2038_metadata_arrived",nt.SCTE35_METADATA_ARRIVED="scte35_metadata_arrived",nt.PES_PRIVATE_DATA_DESCRIPTOR="pes_private_data_descriptor",nt.PES_PRIVATE_DATA_ARRIVED="pes_private_data_arrived",nt.STATISTICS_INFO="statistics_info",nt.DESTROYING="destroying"}(at||(at={})),rt.a=at},function(nt,rt,it){var at={};!function(){var nt=self.navigator.userAgent.toLowerCase(),rt=/(edge)\/([\w.]+)/.exec(nt)||/(opr)[\/]([\w.]+)/.exec(nt)||/(chrome)[ \/]([\w.]+)/.exec(nt)||/(iemobile)[\/]([\w.]+)/.exec(nt)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(nt)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(nt)||/(webkit)[ \/]([\w.]+)/.exec(nt)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(nt)||/(msie) ([\w.]+)/.exec(nt)||nt.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(nt)||nt.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(nt)||[],it=/(ipad)/.exec(nt)||/(ipod)/.exec(nt)||/(windows phone)/.exec(nt)||/(iphone)/.exec(nt)||/(kindle)/.exec(nt)||/(android)/.exec(nt)||/(windows)/.exec(nt)||/(mac)/.exec(nt)||/(linux)/.exec(nt)||/(cros)/.exec(nt)||[],st={browser:rt[5]||rt[3]||rt[1]||"",version:rt[2]||rt[4]||"0",majorVersion:rt[4]||rt[2]||"0",platform:it[0]||""},ot={};if(st.browser){ot[st.browser]=!0;var lt=st.majorVersion.split(".");ot.version={major:parseInt(st.majorVersion,10),string:st.version},lt.length>1&&(ot.version.minor=parseInt(lt[1],10)),lt.length>2&&(ot.version.build=parseInt(lt[2],10))}for(var ut in st.platform&&(ot[st.platform]=!0),(ot.chrome||ot.opr||ot.safari)&&(ot.webkit=!0),(ot.rv||ot.iemobile)&&(ot.rv&&delete ot.rv,st.browser="msie",ot.msie=!0),ot.edge&&(delete ot.edge,st.browser="msedge",ot.msedge=!0),ot.opr&&(st.browser="opera",ot.opera=!0),ot.safari&&ot.android&&(st.browser="android",ot.android=!0),ot.name=st.browser,ot.platform=st.platform,at)at.hasOwnProperty(ut)&&delete at[ut];Object.assign(at,ot)}(),rt.a=at},function(nt,rt,it){rt.a={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},function(nt,rt,it){var at;!function(nt){nt.ERROR="error",nt.SOURCE_OPEN="source_open",nt.UPDATE_END="update_end",nt.BUFFER_FULL="buffer_full",nt.START_STREAMING="start_streaming",nt.END_STREAMING="end_streaming"}(at||(at={})),rt.a=at},function(nt,rt,it){var at=it(9),st=it.n(at),ot=it(0),lt=function(){function e(){}return Object.defineProperty(e,"forceGlobalTag",{get:function(){return ot.a.FORCE_GLOBAL_TAG},set:function(nt){ot.a.FORCE_GLOBAL_TAG=nt,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"globalTag",{get:function(){return ot.a.GLOBAL_TAG},set:function(nt){ot.a.GLOBAL_TAG=nt,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableAll",{get:function(){return ot.a.ENABLE_VERBOSE&&ot.a.ENABLE_DEBUG&&ot.a.ENABLE_INFO&&ot.a.ENABLE_WARN&&ot.a.ENABLE_ERROR},set:function(nt){ot.a.ENABLE_VERBOSE=nt,ot.a.ENABLE_DEBUG=nt,ot.a.ENABLE_INFO=nt,ot.a.ENABLE_WARN=nt,ot.a.ENABLE_ERROR=nt,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableDebug",{get:function(){return ot.a.ENABLE_DEBUG},set:function(nt){ot.a.ENABLE_DEBUG=nt,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableVerbose",{get:function(){return ot.a.ENABLE_VERBOSE},set:function(nt){ot.a.ENABLE_VERBOSE=nt,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableInfo",{get:function(){return ot.a.ENABLE_INFO},set:function(nt){ot.a.ENABLE_INFO=nt,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableWarn",{get:function(){return ot.a.ENABLE_WARN},set:function(nt){ot.a.ENABLE_WARN=nt,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableError",{get:function(){return ot.a.ENABLE_ERROR},set:function(nt){ot.a.ENABLE_ERROR=nt,e._notifyChange()},enumerable:!1,configurable:!0}),e.getConfig=function(){return{globalTag:ot.a.GLOBAL_TAG,forceGlobalTag:ot.a.FORCE_GLOBAL_TAG,enableVerbose:ot.a.ENABLE_VERBOSE,enableDebug:ot.a.ENABLE_DEBUG,enableInfo:ot.a.ENABLE_INFO,enableWarn:ot.a.ENABLE_WARN,enableError:ot.a.ENABLE_ERROR,enableCallback:ot.a.ENABLE_CALLBACK}},e.applyConfig=function(nt){ot.a.GLOBAL_TAG=nt.globalTag,ot.a.FORCE_GLOBAL_TAG=nt.forceGlobalTag,ot.a.ENABLE_VERBOSE=nt.enableVerbose,ot.a.ENABLE_DEBUG=nt.enableDebug,ot.a.ENABLE_INFO=nt.enableInfo,ot.a.ENABLE_WARN=nt.enableWarn,ot.a.ENABLE_ERROR=nt.enableError,ot.a.ENABLE_CALLBACK=nt.enableCallback},e._notifyChange=function(){var nt=e.emitter;if(nt.listenerCount("change")>0){var rt=e.getConfig();nt.emit("change",rt)}},e.registerListener=function(nt){e.emitter.addListener("change",nt)},e.removeListener=function(nt){e.emitter.removeListener("change",nt)},e.addLogListener=function(nt){ot.a.emitter.addListener("log",nt),ot.a.emitter.listenerCount("log")>0&&(ot.a.ENABLE_CALLBACK=!0,e._notifyChange())},e.removeLogListener=function(nt){ot.a.emitter.removeListener("log",nt),0===ot.a.emitter.listenerCount("log")&&(ot.a.ENABLE_CALLBACK=!1,e._notifyChange())},e}();lt.emitter=new st.a,rt.a=lt},function(nt,rt,it){var at,st="object"==typeof Reflect?Reflect:null,ot=st&&"function"==typeof st.apply?st.apply:function(nt,rt,it){return Function.prototype.apply.call(nt,rt,it)};at=st&&"function"==typeof st.ownKeys?st.ownKeys:Object.getOwnPropertySymbols?function(nt){return Object.getOwnPropertyNames(nt).concat(Object.getOwnPropertySymbols(nt))}:function(nt){return Object.getOwnPropertyNames(nt)};var lt=Number.isNaN||function(nt){return nt!=nt};function s(){s.init.call(this)}nt.exports=s,nt.exports.once=function(nt,rt){return new Promise((function(it,at){function a(it){nt.removeListener(rt,r),at(it)}function r(){"function"==typeof nt.removeListener&&nt.removeListener("error",a),it([].slice.call(arguments))}g(nt,rt,r,{once:!0}),"error"!==rt&&function(nt,rt,it){"function"==typeof nt.on&&g(nt,"error",rt,it)}(nt,a,{once:!0})}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var ut=10;function _(nt){if("function"!=typeof nt)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof nt)}function c(nt){return void 0===nt._maxListeners?s.defaultMaxListeners:nt._maxListeners}function h(nt,rt,it,at){var st,ot,lt,ut;if(_(it),void 0===(ot=nt._events)?(ot=nt._events=Object.create(null),nt._eventsCount=0):(void 0!==ot.newListener&&(nt.emit("newListener",rt,it.listener?it.listener:it),ot=nt._events),lt=ot[rt]),void 0===lt)lt=ot[rt]=it,++nt._eventsCount;else if("function"==typeof lt?lt=ot[rt]=at?[it,lt]:[lt,it]:at?lt.unshift(it):lt.push(it),(st=c(nt))>0&&lt.length>st&&!lt.warned){lt.warned=!0;var ct=new Error("Possible EventEmitter memory leak detected. "+lt.length+" "+String(rt)+" listeners added. Use emitter.setMaxListeners() to increase limit");ct.name="MaxListenersExceededWarning",ct.emitter=nt,ct.type=rt,ct.count=lt.length,ut=ct,console&&console.warn&&console.warn(ut)}return nt}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(nt,rt,it){var at={fired:!1,wrapFn:void 0,target:nt,type:rt,listener:it},st=l.bind(at);return st.listener=it,at.wrapFn=st,st}function f(nt,rt,it){var at=nt._events;if(void 0===at)return[];var st=at[rt];return void 0===st?[]:"function"==typeof st?it?[st.listener||st]:[st]:it?function(nt){for(var rt=new Array(nt.length),it=0;it<rt.length;++it)rt[it]=nt[it].listener||nt[it];return rt}(st):m(st,st.length)}function p(nt){var rt=this._events;if(void 0!==rt){var it=rt[nt];if("function"==typeof it)return 1;if(void 0!==it)return it.length}return 0}function m(nt,rt){for(var it=new Array(rt),at=0;at<rt;++at)it[at]=nt[at];return it}function g(nt,rt,it,at){if("function"==typeof nt.on)at.once?nt.once(rt,it):nt.on(rt,it);else{if("function"!=typeof nt.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof nt);nt.addEventListener(rt,(function a(st){at.once&&nt.removeEventListener(rt,a),it(st)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return ut},set:function(nt){if("number"!=typeof nt||nt<0||lt(nt))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+nt+".");ut=nt}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(nt){if("number"!=typeof nt||nt<0||lt(nt))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+nt+".");return this._maxListeners=nt,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(nt){for(var rt=[],it=1;it<arguments.length;it++)rt.push(arguments[it]);var at="error"===nt,st=this._events;if(void 0!==st)at=at&&void 0===st.error;else if(!at)return!1;if(at){var lt;if(rt.length>0&&(lt=rt[0]),lt instanceof Error)throw lt;var ut=new Error("Unhandled error."+(lt?" ("+lt.message+")":""));throw ut.context=lt,ut}var ct=st[nt];if(void 0===ct)return!1;if("function"==typeof ct)ot(ct,this,rt);else{var dt=ct.length,ht=m(ct,dt);for(it=0;it<dt;++it)ot(ht[it],this,rt)}return!0},s.prototype.addListener=function(nt,rt){return h(this,nt,rt,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(nt,rt){return h(this,nt,rt,!0)},s.prototype.once=function(nt,rt){return _(rt),this.on(nt,u(this,nt,rt)),this},s.prototype.prependOnceListener=function(nt,rt){return _(rt),this.prependListener(nt,u(this,nt,rt)),this},s.prototype.removeListener=function(nt,rt){var it,at,st,ot,lt;if(_(rt),void 0===(at=this._events))return this;if(void 0===(it=at[nt]))return this;if(it===rt||it.listener===rt)0==--this._eventsCount?this._events=Object.create(null):(delete at[nt],at.removeListener&&this.emit("removeListener",nt,it.listener||rt));else if("function"!=typeof it){for(st=-1,ot=it.length-1;ot>=0;ot--)if(it[ot]===rt||it[ot].listener===rt){lt=it[ot].listener,st=ot;break}if(st<0)return this;0===st?it.shift():function(nt,rt){for(;rt+1<nt.length;rt++)nt[rt]=nt[rt+1];nt.pop()}(it,st),1===it.length&&(at[nt]=it[0]),void 0!==at.removeListener&&this.emit("removeListener",nt,lt||rt)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(nt){var rt,it,at;if(void 0===(it=this._events))return this;if(void 0===it.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==it[nt]&&(0==--this._eventsCount?this._events=Object.create(null):delete it[nt]),this;if(0===arguments.length){var st,ot=Object.keys(it);for(at=0;at<ot.length;++at)"removeListener"!==(st=ot[at])&&this.removeAllListeners(st);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(rt=it[nt]))this.removeListener(nt,rt);else if(void 0!==rt)for(at=rt.length-1;at>=0;at--)this.removeListener(nt,rt[at]);return this},s.prototype.listeners=function(nt){return f(this,nt,!0)},s.prototype.rawListeners=function(nt){return f(this,nt,!1)},s.listenerCount=function(nt,rt){return"function"==typeof nt.listenerCount?nt.listenerCount(rt):p.call(nt,rt)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?at(this._events):[]}},function(nt,rt,it){it.d(rt,"b",(function(){return ot})),it.d(rt,"a",(function(){return lt}));var at=it(2),st=it(6),ot={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},lt={NETWORK_EXCEPTION:at.b.EXCEPTION,NETWORK_STATUS_CODE_INVALID:at.b.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:at.b.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:at.b.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:st.a.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:st.a.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:st.a.CODEC_UNSUPPORTED}},function(nt,rt,it){it.d(rt,"d",(function(){return n})),it.d(rt,"b",(function(){return at})),it.d(rt,"a",(function(){return st})),it.d(rt,"c",(function(){return ot}));var n=function(nt,rt,it,at,st){this.dts=nt,this.pts=rt,this.duration=it,this.originalDts=at,this.isSyncPoint=st,this.fileposition=null},at=function(){function e(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return e.prototype.appendSyncPoint=function(nt){nt.isSyncPoint=!0,this.syncPoints.push(nt)},e}(),st=function(){function e(){this._list=[]}return e.prototype.clear=function(){this._list=[]},e.prototype.appendArray=function(nt){var rt=this._list;0!==nt.length&&(rt.length>0&&nt[0].originalDts<rt[rt.length-1].originalDts&&this.clear(),Array.prototype.push.apply(rt,nt))},e.prototype.getLastSyncPointBeforeDts=function(nt){if(0==this._list.length)return null;var rt=this._list,it=0,at=rt.length-1,st=0,ot=0,lt=at;for(nt<rt[0].dts&&(it=0,ot=lt+1);ot<=lt;){if((st=ot+Math.floor((lt-ot)/2))===at||nt>=rt[st].dts&&nt<rt[st+1].dts){it=st;break}rt[st].dts<nt?ot=st+1:lt=st-1}return this._list[it]},e}(),ot=function(){function e(nt){this._type=nt,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return 0===this._list.length},e.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},e.prototype._searchNearestSegmentBefore=function(nt){var rt=this._list;if(0===rt.length)return-2;var it=rt.length-1,at=0,st=0,ot=it,lt=0;if(nt<rt[0].originalBeginDts)return-1;for(;st<=ot;){if((at=st+Math.floor((ot-st)/2))===it||nt>rt[at].lastSample.originalDts&&nt<rt[at+1].originalBeginDts){lt=at;break}rt[at].originalBeginDts<nt?st=at+1:ot=at-1}return lt},e.prototype._searchNearestSegmentAfter=function(nt){return this._searchNearestSegmentBefore(nt)+1},e.prototype.append=function(nt){var rt=this._list,it=nt,at=this._lastAppendLocation,st=0;-1!==at&&at<rt.length&&it.originalBeginDts>=rt[at].lastSample.originalDts&&(at===rt.length-1||at<rt.length-1&&it.originalBeginDts<rt[at+1].originalBeginDts)?st=at+1:rt.length>0&&(st=this._searchNearestSegmentBefore(it.originalBeginDts)+1),this._lastAppendLocation=st,this._list.splice(st,0,it)},e.prototype.getLastSegmentBefore=function(nt){var rt=this._searchNearestSegmentBefore(nt);return rt>=0?this._list[rt]:null},e.prototype.getLastSampleBefore=function(nt){var rt=this.getLastSegmentBefore(nt);return null!=rt?rt.lastSample:null},e.prototype.getLastSyncPointBefore=function(nt){for(var rt=this._searchNearestSegmentBefore(nt),it=this._list[rt].syncPoints;0===it.length&&rt>0;)rt--,it=this._list[rt].syncPoints;return it.length>0?it[it.length-1]:null},e}()},function(nt,rt,it){var at=function(){function e(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return e.prototype.isComplete=function(){var nt=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,rt=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&nt&&rt},e.prototype.isSeekable=function(){return!0===this.hasKeyframesIndex},e.prototype.getNearestKeyframe=function(nt){if(null==this.keyframesIndex)return null;var rt=this.keyframesIndex,it=this._search(rt.times,nt);return{index:it,milliseconds:rt.times[it],fileposition:rt.filepositions[it]}},e.prototype._search=function(nt,rt){var it=0,at=nt.length-1,st=0,ot=0,lt=at;for(rt<nt[0]&&(it=0,ot=lt+1);ot<=lt;){if((st=ot+Math.floor((lt-ot)/2))===at||rt>=nt[st]&&rt<nt[st+1]){it=st;break}nt[st]<rt?ot=st+1:lt=st-1}return it},e}();rt.a=at},function(nt,rt,it){var at=it(9),st=it.n(at),ot=it(0),lt=it(5),ut=it(12);function d(nt,rt,it){var at=nt;if(rt+it<at.length){for(;it--;)if(128!=(192&at[++rt]))return!1;return!0}return!1}var ct,c=function(nt){for(var rt=[],it=nt,at=0,st=nt.length;at<st;)if(it[at]<128)rt.push(String.fromCharCode(it[at])),++at;else{if(it[at]<192);else if(it[at]<224){if(d(it,at,1)&&(ot=(31&it[at])<<6|63&it[at+1])>=128){rt.push(String.fromCharCode(65535&ot)),at+=2;continue}}else if(it[at]<240){if(d(it,at,2)&&(ot=(15&it[at])<<12|(63&it[at+1])<<6|63&it[at+2])>=2048&&55296!=(63488&ot)){rt.push(String.fromCharCode(65535&ot)),at+=3;continue}}else if(it[at]<248){var ot;if(d(it,at,3)&&(ot=(7&it[at])<<18|(63&it[at+1])<<12|(63&it[at+2])<<6|63&it[at+3])>65536&&ot<1114112){ot-=65536,rt.push(String.fromCharCode(ot>>>10|55296)),rt.push(String.fromCharCode(1023&ot|56320)),at+=4;continue}}rt.push(String.fromCharCode(65533)),++at}return rt.join("")},dt=it(3),ht=(ct=new ArrayBuffer(2),new DataView(ct).setInt16(0,256,!0),256===new Int16Array(ct)[0]),pt=function(){function e(){}return e.parseScriptData=function(nt,rt,it){var at={};try{var st=e.parseValue(nt,rt,it),lt=e.parseValue(nt,rt+st.size,it-st.size);at[st.data]=lt.data}catch(nt){ot.a.e("AMF",nt.toString())}return at},e.parseObject=function(nt,rt,it){if(it<3)throw new dt.a("Data not enough when parse ScriptDataObject");var at=e.parseString(nt,rt,it),st=e.parseValue(nt,rt+at.size,it-at.size),ot=st.objectEnd;return{data:{name:at.data,value:st.data},size:at.size+st.size,objectEnd:ot}},e.parseVariable=function(nt,rt,it){return e.parseObject(nt,rt,it)},e.parseString=function(nt,rt,it){if(it<2)throw new dt.a("Data not enough when parse String");var at=new DataView(nt,rt,it).getUint16(0,!ht);return{data:at>0?c(new Uint8Array(nt,rt+2,at)):"",size:2+at}},e.parseLongString=function(nt,rt,it){if(it<4)throw new dt.a("Data not enough when parse LongString");var at=new DataView(nt,rt,it).getUint32(0,!ht);return{data:at>0?c(new Uint8Array(nt,rt+4,at)):"",size:4+at}},e.parseDate=function(nt,rt,it){if(it<10)throw new dt.a("Data size invalid when parse Date");var at=new DataView(nt,rt,it),st=at.getFloat64(0,!ht),ot=at.getInt16(8,!ht);return{data:new Date(st+=60*ot*1e3),size:10}},e.parseValue=function(nt,rt,it){if(it<1)throw new dt.a("Data not enough when parse Value");var at,st=new DataView(nt,rt,it),lt=1,ut=st.getUint8(0),ct=!1;try{switch(ut){case 0:at=st.getFloat64(1,!ht),lt+=8;break;case 1:at=!!st.getUint8(1),lt+=1;break;case 2:var pt=e.parseString(nt,rt+1,it-1);at=pt.data,lt+=pt.size;break;case 3:at={};var _t=0;for(9==(16777215&st.getUint32(it-4,!ht))&&(_t=3);lt<it-4;){var Et=e.parseObject(nt,rt+lt,it-lt-_t);if(Et.objectEnd)break;at[Et.data.name]=Et.data.value,lt+=Et.size}lt<=it-3&&9==(16777215&st.getUint32(lt-1,!ht))&&(lt+=3);break;case 8:for(at={},lt+=4,_t=0,9==(16777215&st.getUint32(it-4,!ht))&&(_t=3);lt<it-8;){var St=e.parseVariable(nt,rt+lt,it-lt-_t);if(St.objectEnd)break;at[St.data.name]=St.data.value,lt+=St.size}lt<=it-3&&9==(16777215&st.getUint32(lt-1,!ht))&&(lt+=3);break;case 9:at=void 0,lt=1,ct=!0;break;case 10:at=[];var wt=st.getUint32(1,!ht);lt+=4;for(var Lt=0;Lt<wt;Lt++){var Ct=e.parseValue(nt,rt+lt,it-lt);at.push(Ct.data),lt+=Ct.size}break;case 11:var Pt=e.parseDate(nt,rt+1,it-1);at=Pt.data,lt+=Pt.size;break;case 12:var kt=e.parseString(nt,rt+1,it-1);at=kt.data,lt+=kt.size;break;default:lt=it,ot.a.w("AMF","Unsupported AMF value type "+ut)}}catch(nt){ot.a.e("AMF",nt.toString())}return{data:at,size:lt,objectEnd:ct}},e}(),_t=function(){function e(nt){this.TAG="ExpGolomb",this._buffer=nt,this._buffer_index=0,this._total_bytes=nt.byteLength,this._total_bits=8*nt.byteLength,this._current_word=0,this._current_word_bits_left=0}return e.prototype.destroy=function(){this._buffer=null},e.prototype._fillCurrentWord=function(){var nt=this._total_bytes-this._buffer_index;if(nt<=0)throw new dt.a("ExpGolomb: _fillCurrentWord() but no bytes available");var rt=Math.min(4,nt),it=new Uint8Array(4);it.set(this._buffer.subarray(this._buffer_index,this._buffer_index+rt)),this._current_word=new DataView(it.buffer).getUint32(0,!1),this._buffer_index+=rt,this._current_word_bits_left=8*rt},e.prototype.readBits=function(nt){if(nt>32)throw new dt.b("ExpGolomb: readBits() bits exceeded max 32bits!");if(nt<=this._current_word_bits_left){var rt=this._current_word>>>32-nt;return this._current_word<<=nt,this._current_word_bits_left-=nt,rt}var it=this._current_word_bits_left?this._current_word:0;it>>>=32-this._current_word_bits_left;var at=nt-this._current_word_bits_left;this._fillCurrentWord();var st=Math.min(at,this._current_word_bits_left),ot=this._current_word>>>32-st;return this._current_word<<=st,this._current_word_bits_left-=st,it<<st|ot},e.prototype.readBool=function(){return 1===this.readBits(1)},e.prototype.readByte=function(){return this.readBits(8)},e.prototype._skipLeadingZero=function(){var nt;for(nt=0;nt<this._current_word_bits_left;nt++)if(this._current_word&2147483648>>>nt)return this._current_word<<=nt,this._current_word_bits_left-=nt,nt;return this._fillCurrentWord(),nt+this._skipLeadingZero()},e.prototype.readUEG=function(){var nt=this._skipLeadingZero();return this.readBits(nt+1)-1},e.prototype.readSEG=function(){var nt=this.readUEG();return 1&nt?nt+1>>>1:-1*(nt>>>1)},e}(),Et=function(){function e(){}return e._ebsp2rbsp=function(nt){for(var rt=nt,it=rt.byteLength,at=new Uint8Array(it),st=0,ot=0;ot<it;ot++)ot>=2&&3===rt[ot]&&0===rt[ot-1]&&0===rt[ot-2]||(at[st]=rt[ot],st++);return new Uint8Array(at.buffer,0,st)},e.parseSPS=function(nt){for(var rt=nt.subarray(1,4),it="avc1.",at=0;at<3;at++){var st=rt[at].toString(16);st.length<2&&(st="0"+st),it+=st}var ot=e._ebsp2rbsp(nt),lt=new _t(ot);lt.readByte();var ut=lt.readByte();lt.readByte();var ct=lt.readByte();lt.readUEG();var dt=e.getProfileString(ut),ht=e.getLevelString(ct),pt=1,Et=420,St=8,wt=8;if((100===ut||110===ut||122===ut||244===ut||44===ut||83===ut||86===ut||118===ut||128===ut||138===ut||144===ut)&&(3===(pt=lt.readUEG())&&lt.readBits(1),pt<=3&&(Et=[0,420,422,444][pt]),St=lt.readUEG()+8,wt=lt.readUEG()+8,lt.readBits(1),lt.readBool()))for(var Lt=3!==pt?8:12,Ct=0;Ct<Lt;Ct++)lt.readBool()&&(Ct<6?e._skipScalingList(lt,16):e._skipScalingList(lt,64));lt.readUEG();var Pt=lt.readUEG();if(0===Pt)lt.readUEG();else if(1===Pt){lt.readBits(1),lt.readSEG(),lt.readSEG();var kt=lt.readUEG();for(Ct=0;Ct<kt;Ct++)lt.readSEG()}var Ot=lt.readUEG();lt.readBits(1);var Ft=lt.readUEG(),Bt=lt.readUEG(),Ut=lt.readBits(1);0===Ut&&lt.readBits(1),lt.readBits(1);var Gt=0,Ht=0,jt=0,Kt=0;lt.readBool()&&(Gt=lt.readUEG(),Ht=lt.readUEG(),jt=lt.readUEG(),Kt=lt.readUEG());var $t=1,Yt=1,Wt=0,Qt=!0,en=0,nn=0;if(lt.readBool()){if(lt.readBool()){var an=lt.readByte();an>0&&an<16?($t=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][an-1],Yt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][an-1]):255===an&&($t=lt.readByte()<<8|lt.readByte(),Yt=lt.readByte()<<8|lt.readByte())}if(lt.readBool()&&lt.readBool(),lt.readBool()&&(lt.readBits(4),lt.readBool()&&lt.readBits(24)),lt.readBool()&&(lt.readUEG(),lt.readUEG()),lt.readBool()){var ln=lt.readBits(32),hn=lt.readBits(32);Qt=lt.readBool(),Wt=(en=hn)/(nn=2*ln)}}var fn=1;1===$t&&1===Yt||(fn=$t/Yt);var pn=0,mn=0;0===pt?(pn=1,mn=2-Ut):(pn=3===pt?1:2,mn=(1===pt?2:1)*(2-Ut));var gn=16*(Ft+1),_n=16*(Bt+1)*(2-Ut);gn-=(Gt+Ht)*pn,_n-=(jt+Kt)*mn;var vn=Math.ceil(gn*fn);return lt.destroy(),lt=null,{codec_mimetype:it,profile_idc:ut,level_idc:ct,profile_string:dt,level_string:ht,chroma_format_idc:pt,bit_depth:St,bit_depth_luma:St,bit_depth_chroma:wt,ref_frames:Ot,chroma_format:Et,chroma_format_string:e.getChromaFormatString(Et),frame_rate:{fixed:Qt,fps:Wt,fps_den:nn,fps_num:en},sar_ratio:{width:$t,height:Yt},codec_size:{width:gn,height:_n},present_size:{width:vn,height:_n}}},e._skipScalingList=function(nt,rt){for(var it=8,at=8,st=0;st<rt;st++)0!==at&&(at=(it+nt.readSEG()+256)%256),it=0===at?it:at},e.getProfileString=function(nt){switch(nt){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},e.getLevelString=function(nt){return(nt/10).toFixed(1)},e.getChromaFormatString=function(nt){switch(nt){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},e}(),St=it(6),wt=function(){function e(){}return e._ebsp2rbsp=function(nt){for(var rt=nt,it=rt.byteLength,at=new Uint8Array(it),st=0,ot=0;ot<it;ot++)ot>=2&&3===rt[ot]&&0===rt[ot-1]&&0===rt[ot-2]||(at[st]=rt[ot],st++);return new Uint8Array(at.buffer,0,st)},e.parseVPS=function(nt){var rt=e._ebsp2rbsp(nt),it=new _t(rt);return it.readByte(),it.readByte(),it.readBits(4),it.readBits(2),it.readBits(6),{num_temporal_layers:it.readBits(3)+1,temporal_id_nested:it.readBool()}},e.parseSPS=function(nt){var rt=e._ebsp2rbsp(nt),it=new _t(rt);it.readByte(),it.readByte();for(var at=0,st=0,ot=0,lt=0,ut=(it.readBits(4),it.readBits(3)),ct=(it.readBool(),it.readBits(2)),dt=it.readBool(),ht=it.readBits(5),pt=it.readByte(),Et=it.readByte(),St=it.readByte(),wt=it.readByte(),Lt=it.readByte(),Ct=it.readByte(),Pt=it.readByte(),kt=it.readByte(),Ot=it.readByte(),Ft=it.readByte(),Bt=it.readByte(),Ut=[],Gt=[],Ht=0;Ht<ut;Ht++)Ut.push(it.readBool()),Gt.push(it.readBool());if(ut>0)for(Ht=ut;Ht<8;Ht++)it.readBits(2);for(Ht=0;Ht<ut;Ht++)Ut[Ht]&&(it.readByte(),it.readByte(),it.readByte(),it.readByte(),it.readByte(),it.readByte(),it.readByte(),it.readByte(),it.readByte(),it.readByte(),it.readByte()),Gt[Ht]&&it.readByte();it.readUEG();var jt=it.readUEG();3==jt&&it.readBits(1);var Kt=it.readUEG(),$t=it.readUEG();it.readBool()&&(at+=it.readUEG(),st+=it.readUEG(),ot+=it.readUEG(),lt+=it.readUEG());var Yt=it.readUEG(),Wt=it.readUEG(),Qt=it.readUEG();for(Ht=it.readBool()?0:ut;Ht<=ut;Ht++)it.readUEG(),it.readUEG(),it.readUEG();if(it.readUEG(),it.readUEG(),it.readUEG(),it.readUEG(),it.readUEG(),it.readUEG(),it.readBool()&&it.readBool())for(var en=0;en<4;en++)for(var nn=0;nn<(3===en?2:6);nn++)if(it.readBool()){var an=Math.min(64,1<<4+(en<<1));for(en>1&&it.readSEG(),Ht=0;Ht<an;Ht++)it.readSEG()}else it.readUEG();it.readBool(),it.readBool(),it.readBool()&&(it.readByte(),it.readUEG(),it.readUEG(),it.readBool());var ln=it.readUEG(),hn=0;for(Ht=0;Ht<ln;Ht++){var fn=!1;if(0!==Ht&&(fn=it.readBool()),fn){Ht===ln&&it.readUEG(),it.readBool(),it.readUEG();for(var pn=0,mn=0;mn<=hn;mn++){var gn=it.readBool(),_n=!1;gn||(_n=it.readBool()),(gn||_n)&&pn++}hn=pn}else{var vn=it.readUEG(),En=it.readUEG();for(hn=vn+En,mn=0;mn<vn;mn++)it.readUEG(),it.readBool();for(mn=0;mn<En;mn++)it.readUEG(),it.readBool()}}if(it.readBool()){var Tn=it.readUEG();for(Ht=0;Ht<Tn;Ht++){for(mn=0;mn<Qt+4;mn++)it.readBits(1);it.readBits(1)}}var bn=0,An=1,Rn=1,In=!1,Ln=1,Dn=1;if(it.readBool(),it.readBool(),it.readBool()){if(it.readBool()){var Mn=it.readByte();Mn>0&&Mn<=16?(An=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][Mn-1],Rn=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][Mn-1]):255===Mn&&(An=it.readBits(16),Rn=it.readBits(16))}if(it.readBool()&&it.readBool(),it.readBool()&&(it.readBits(3),it.readBool(),it.readBool()&&(it.readByte(),it.readByte(),it.readByte())),it.readBool()&&(it.readUEG(),it.readUEG()),it.readBool(),it.readBool(),it.readBool(),it.readBool()&&(it.readUEG(),it.readUEG(),it.readUEG(),it.readUEG()),it.readBool()&&(Ln=it.readBits(32),Dn=it.readBits(32),it.readBool()&&it.readUEG(),it.readBool())){var Nn=!1,xn=!1,Un=!1;for(Nn=it.readBool(),xn=it.readBool(),(Nn||xn)&&((Un=it.readBool())&&(it.readByte(),it.readBits(5),it.readBool(),it.readBits(5)),it.readBits(4),it.readBits(4),Un&&it.readBits(4),it.readBits(5),it.readBits(5),it.readBits(5)),Ht=0;Ht<=ut;Ht++){var Hn=it.readBool();In=Hn;var Kn=!0,Yn=1;Hn||(Kn=it.readBool());var Wn=!1;if(Kn?it.readUEG():Wn=it.readBool(),Wn||(Yn=it.readUEG()+1),Nn){for(mn=0;mn<Yn;mn++)it.readUEG(),it.readUEG(),Un&&(it.readUEG(),it.readUEG());it.readBool()}if(xn){for(mn=0;mn<Yn;mn++)it.readUEG(),it.readUEG(),Un&&(it.readUEG(),it.readUEG());it.readBool()}}}it.readBool()&&(it.readBool(),it.readBool(),it.readBool(),bn=it.readUEG(),it.readUEG(),it.readUEG(),it.readUEG(),it.readUEG())}it.readBool();var Jn="hvc1.".concat(ht,".1.L").concat(Bt,".B0"),er=Kt-(at+st)*(1===jt||2===jt?2:1),or=$t-(ot+lt)*(1===jt?2:1),dr=1;return 1!==An&&1!==Rn&&(dr=An/Rn),it.destroy(),it=null,{codec_mimetype:Jn,profile_string:e.getProfileString(ht),level_string:e.getLevelString(Bt),profile_idc:ht,bit_depth:Yt+8,ref_frames:1,chroma_format:jt,chroma_format_string:e.getChromaFormatString(jt),general_level_idc:Bt,general_profile_space:ct,general_tier_flag:dt,general_profile_idc:ht,general_profile_compatibility_flags_1:pt,general_profile_compatibility_flags_2:Et,general_profile_compatibility_flags_3:St,general_profile_compatibility_flags_4:wt,general_constraint_indicator_flags_1:Lt,general_constraint_indicator_flags_2:Ct,general_constraint_indicator_flags_3:Pt,general_constraint_indicator_flags_4:kt,general_constraint_indicator_flags_5:Ot,general_constraint_indicator_flags_6:Ft,min_spatial_segmentation_idc:bn,constant_frame_rate:0,chroma_format_idc:jt,bit_depth_luma_minus8:Yt,bit_depth_chroma_minus8:Wt,frame_rate:{fixed:In,fps:Dn/Ln,fps_den:Ln,fps_num:Dn},sar_ratio:{width:An,height:Rn},codec_size:{width:er,height:or},present_size:{width:er*dr,height:or}}},e.parsePPS=function(nt){var rt=e._ebsp2rbsp(nt),it=new _t(rt);it.readByte(),it.readByte(),it.readUEG(),it.readUEG(),it.readBool(),it.readBool(),it.readBits(3),it.readBool(),it.readBool(),it.readUEG(),it.readUEG(),it.readSEG(),it.readBool(),it.readBool(),it.readBool()&&it.readUEG(),it.readSEG(),it.readSEG(),it.readBool(),it.readBool(),it.readBool(),it.readBool();var at=it.readBool(),st=it.readBool(),ot=1;return st&&at?ot=0:st?ot=3:at&&(ot=2),{parallelismType:ot}},e.getChromaFormatString=function(nt){switch(nt){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}},e.getProfileString=function(nt){switch(nt){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}},e.getLevelString=function(nt){return(nt/30).toFixed(1)},e}();function v(nt){return nt.byteOffset%2==0&&nt.byteLength%2==0}function y(nt){return nt.byteOffset%4==0&&nt.byteLength%4==0}function S(nt,rt){for(var it=0;it<nt.length;it++)if(nt[it]!==rt[it])return!1;return!0}var Lt,b=function(nt,rt){return nt.byteLength===rt.byteLength&&(y(nt)&&y(rt)?function(nt,rt){return S(new Uint32Array(nt.buffer,nt.byteOffset,nt.byteLength/4),new Uint32Array(rt.buffer,rt.byteOffset,rt.byteLength/4))}(nt,rt):v(nt)&&v(rt)?function(nt,rt){return S(new Uint16Array(nt.buffer,nt.byteOffset,nt.byteLength/2),new Uint16Array(rt.buffer,rt.byteOffset,rt.byteLength/2))}(nt,rt):function(nt,rt){return S(nt,rt)}(nt,rt))},A=function(){return(A=Object.assign||function(nt){for(var rt,it=1,at=arguments.length;it<at;it++)for(var st in rt=arguments[it])Object.prototype.hasOwnProperty.call(rt,st)&&(nt[st]=rt[st]);return nt}).apply(this,arguments)},Ct=function(){function e(){}return e.parseOBUs=function(nt,rt){for(var it=0;it<nt.byteLength;){var at=it,st=(nt[it],(120&nt[it])>>3),ot=!!(4&nt[it]),lt=!!(2&nt[it]);nt[it],it+=1,ot&&(it+=1);var ut=Number.POSITIVE_INFINITY;if(lt){ut=0;for(var ct=0;;ct++){var dt=nt[it++];if(ut|=(127&dt)<<7*ct,!(128&dt))break}}console.log(st),1===st?rt=A(A({},e.parseSeuqneceHeader(nt.subarray(it,it+ut))),{sequence_header_data:nt.subarray(at,it+ut)}):(3==st&&rt||6==st&&rt)&&(rt=e.parseOBUFrameHeader(nt.subarray(it,it+ut),0,0,rt)),it+=ut}return rt},e.parseSeuqneceHeader=function(nt){var rt=new _t(nt),it=rt.readBits(3),at=(rt.readBool(),rt.readBool()),st=!0,ot=0,lt=1,ut=void 0,ct=[];if(at)ct.push({operating_point_idc:0,level:rt.readBits(5),tier:0});else{if(rt.readBool()){var dt=rt.readBits(32),ht=rt.readBits(32),pt=rt.readBool();if(pt){for(var Et=0;0===rt.readBits(1);)Et+=1;Et>=32||rt.readBits(Et)}ot=ht,lt=dt,st=pt,rt.readBool()&&(rt.readBits(5),rt.readBits(32),ut=rt.readBits(5),rt.readBits(5))}for(var St=rt.readBool(),wt=rt.readBits(5),Lt=0;Lt<=wt;Lt++){var Ct=rt.readBits(12),Pt=rt.readBits(5),kt=Pt>7?rt.readBits(1):0;ct.push({operating_point_idc:Ct,level:Pt,tier:kt}),St&&rt.readBool()&&rt.readBits(4)}}var Ot=ct[0],Ft=Ot.level,Bt=Ot.tier,Ut=rt.readBits(4),Gt=rt.readBits(4),Ht=rt.readBits(Ut+1)+1,jt=rt.readBits(Gt+1)+1,Kt=!1;at||(Kt=rt.readBool()),Kt&&(rt.readBits(4),rt.readBits(4)),rt.readBool(),rt.readBool(),rt.readBool();var $t=!1,Yt=2,Wt=2,Qt=0;at||(rt.readBool(),rt.readBool(),rt.readBool(),rt.readBool(),($t=rt.readBool())&&(rt.readBool(),rt.readBool()),Wt=(Yt=rt.readBool()?2:rt.readBits(1))?rt.readBool()?2:rt.readBits(1):2,Qt=$t?rt.readBits(3)+1:0);var en=rt.readBool(),nn=(rt.readBool(),rt.readBool(),rt.readBool()),an=8;an=2===it&&nn?rt.readBool()?12:10:nn?10:8;var ln=!1;1!==it&&(ln=rt.readBool()),rt.readBool()&&(rt.readBits(8),rt.readBits(8),rt.readBits(8));var hn=1,fn=1;return ln?(rt.readBits(1),hn=1,fn=1):(rt.readBits(1),0==it?(hn=1,fn=1):1==it?(hn=0,fn=0):12==an?rt.readBits(1)&&rt.readBits(1):(hn=1,fn=0),hn&&fn&&rt.readBits(2),rt.readBits(1)),rt.readBool(),rt.destroy(),rt=null,{codec_mimetype:"av01.".concat(it,".").concat(e.getLevelString(Ft,Bt),".").concat(an.toString(10).padStart(2,"0")),level:Ft,tier:Bt,level_string:e.getLevelString(Ft,Bt),profile_idc:it,profile_string:"".concat(it),bit_depth:an,ref_frames:1,chroma_format:e.getChromaFormat(ln,hn,fn),chroma_format_string:e.getChromaFormatString(ln,hn,fn),sequence_header:{frame_id_numbers_present_flag:Kt,additional_frame_id_length_minus_1:void 0,delta_frame_id_length_minus_2:void 0,reduced_still_picture_header:at,decoder_model_info_present_flag:!1,operating_points:ct,buffer_removal_time_length_minus_1:ut,equal_picture_interval:st,seq_force_screen_content_tools:Yt,seq_force_integer_mv:Wt,enable_order_hint:$t,order_hint_bits:Qt,enable_superres:en,frame_width_bit:Ut+1,frame_height_bit:Gt+1,max_frame_width:Ht,max_frame_height:jt},keyframe:void 0,frame_rate:{fixed:st,fps:ot/lt,fps_den:lt,fps_num:ot}}},e.parseOBUFrameHeader=function(nt,rt,it,at){var st=at.sequence_header,ot=new _t(nt),lt=(st.max_frame_width,st.max_frame_height,0);st.frame_id_numbers_present_flag&&(lt=st.additional_frame_id_length_minus_1+st.delta_frame_id_length_minus_2+3);var ut=0,ct=!0,dt=!0,ht=!1;if(!st.reduced_still_picture_header){if(ot.readBool())return at;ct=2===(ut=ot.readBits(2))||0===ut,(dt=ot.readBool())&&st.decoder_model_info_present_flag&&st.equal_picture_interval,dt&&ot.readBool(),ht=!!(3===ut||0===ut&&dt)||ot.readBool()}at.keyframe=ct,ot.readBool();var pt=st.seq_force_screen_content_tools;2===st.seq_force_screen_content_tools&&(pt=ot.readBits(1)),pt&&(st.seq_force_integer_mv,2==st.seq_force_integer_mv&&ot.readBits(1)),st.frame_id_numbers_present_flag&&ot.readBits(lt);var Et=!1;if(Et=3==ut||!st.reduced_still_picture_header&&ot.readBool(),ot.readBits(st.order_hint_bits),ct||ht||ot.readBits(3),st.decoder_model_info_present_flag&&ot.readBool())for(var St=0;St<=st.operating_points_cnt_minus_1;St++)if(st.operating_points[St].decoder_model_present_for_this_op[St]){var wt=st.operating_points[St].operating_point_idc;(0===wt||wt>>rt&1&&wt>>it+8&1)&&ot.readBits(st.buffer_removal_time_length_minus_1+1)}var Lt=255;if(3===ut||0==ut&&dt||(Lt=ot.readBits(8)),(ct||255!==Lt)&&ht&&st.enable_order_hint)for(var Ct=0;Ct<8;Ct++)ot.readBits(st.order_hint_bits);if(ct){var Pt=e.frameSizeAndRenderSize(ot,Et,st);at.codec_size={width:Pt.FrameWidth,height:Pt.FrameHeight},at.present_size={width:Pt.RenderWidth,height:Pt.RenderHeight},at.sar_ratio={width:Pt.RenderWidth/Pt.FrameWidth,height:Pt.RenderHeight/Pt.FrameHeight}}return ot.destroy(),ot=null,at},e.frameSizeAndRenderSize=function(nt,rt,it){var at=it.max_frame_width,st=it.max_frame_height;rt&&(at=nt.readBits(it.frame_width_bit)+1,st=nt.readBits(it.frame_height_bit)+1);var ot=!1;it.enable_superres&&(ot=nt.readBool());var lt=8;ot&&(lt=nt.readBits(3)+9);var ut=at;at=Math.floor((8*ut+lt/2)/lt);var ct=ut,dt=st;if(nt.readBool()){var ht=nt.readBits(16)+1,pt=nt.readBits(16)+1;ct=nt.readBits(ht)+1,dt=nt.readBits(pt)+1}return{UpscaledWidth:ut,FrameWidth:at,FrameHeight:st,RenderWidth:ct,RenderHeight:dt}},e.getLevelString=function(nt,rt){return"".concat(nt.toString(10).padStart(2,"0")).concat(0===rt?"M":"H")},e.getChromaFormat=function(nt,rt,it){return nt?0:0===rt&&0===it?3:1===rt&&0===it?2:1===rt&&1===it?1:Number.NaN},e.getChromaFormatString=function(nt,rt,it){return nt?"4:0:0":0===rt&&0===it?"4:4:4":1===rt&&0===it?"4:2:2":1===rt&&1===it?"4:2:0":"Unknown"},e}(),Pt=function(){function e(nt,rt){this.TAG="FLVDemuxer",this._config=rt,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=nt.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=nt.hasAudioTrack,this._hasVideo=nt.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new ut.a,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var nt=new ArrayBuffer(2);return new DataView(nt).setInt16(0,256,!0),256===new Int16Array(nt)[0]}()}return e.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},e.probe=function(nt){var rt=new Uint8Array(nt);if(rt.byteLength<9)return{needMoreData:!0};var it={match:!1};if(70!==rt[0]||76!==rt[1]||86!==rt[2]||1!==rt[3])return it;var at,st,ot=(4&rt[4])>>>2!=0,lt=!!(1&rt[4]),ut=(at=rt)[st=5]<<24|at[st+1]<<16|at[st+2]<<8|at[st+3];return ut<9?it:{match:!0,consumed:ut,dataOffset:ut,hasAudioTrack:ot,hasVideoTrack:lt}},e.prototype.bindDataSource=function(nt){return nt.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(e.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(nt){this._onTrackMetadata=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(nt){this._onMediaInfo=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(nt){this._onMetaDataArrived=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(nt){this._onScriptDataArrived=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(nt){this._onError=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(nt){this._onDataAvailable=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(nt){this._timestampBase=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedDuration",{get:function(){return this._duration},set:function(nt){this._durationOverrided=!0,this._duration=nt,this._mediaInfo.duration=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasAudio",{set:function(nt){this._hasAudioFlagOverrided=!0,this._hasAudio=nt,this._mediaInfo.hasAudio=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasVideo",{set:function(nt){this._hasVideoFlagOverrided=!0,this._hasVideo=nt,this._mediaInfo.hasVideo=nt},enumerable:!1,configurable:!0}),e.prototype.resetMediaInfo=function(){this._mediaInfo=new ut.a},e.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},e.prototype.parseChunks=function(nt,rt){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new dt.a("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var it=0,at=this._littleEndian;if(0===rt){if(!(nt.byteLength>13))return 0;it=e.probe(nt).dataOffset}for(this._firstParse&&(this._firstParse=!1,rt+it!==this._dataOffset&&ot.a.w(this.TAG,"First time parsing but chunk byteStart invalid!"),0!==(st=new DataView(nt,it)).getUint32(0,!at)&&ot.a.w(this.TAG,"PrevTagSize0 !== 0 !!!"),it+=4);it<nt.byteLength;){this._dispatch=!0;var st=new DataView(nt,it);if(it+11+4>nt.byteLength)break;var lt=st.getUint8(0),ut=16777215&st.getUint32(0,!at);if(it+11+ut+4>nt.byteLength)break;if(8===lt||9===lt||18===lt){var ct=st.getUint8(4),ht=st.getUint8(5),pt=st.getUint8(6)|ht<<8|ct<<16|st.getUint8(7)<<24;16777215&st.getUint32(7,!at)&&ot.a.w(this.TAG,"Meet tag which has StreamID != 0!");var _t=it+11;switch(lt){case 8:this._parseAudioData(nt,_t,ut,pt);break;case 9:this._parseVideoData(nt,_t,ut,pt,rt+it);break;case 18:this._parseScriptData(nt,_t,ut)}var Et=st.getUint32(11+ut,!at);Et!==11+ut&&ot.a.w(this.TAG,"Invalid PrevTagSize ".concat(Et)),it+=11+ut+4}else ot.a.w(this.TAG,"Unsupported tag type ".concat(lt,", skipped")),it+=11+ut+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),it},e.prototype._parseScriptData=function(nt,rt,it){var at=pt.parseScriptData(nt,rt,it);if(at.hasOwnProperty("onMetaData")){if(null==at.onMetaData||"object"!=typeof at.onMetaData)return void ot.a.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&ot.a.w(this.TAG,"Found another onMetaData tag!"),this._metadata=at;var st=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},st)),"boolean"==typeof st.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=st.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof st.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=st.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof st.audiodatarate&&(this._mediaInfo.audioDataRate=st.audiodatarate),"number"==typeof st.videodatarate&&(this._mediaInfo.videoDataRate=st.videodatarate),"number"==typeof st.width&&(this._mediaInfo.width=st.width),"number"==typeof st.height&&(this._mediaInfo.height=st.height),"number"==typeof st.duration){if(!this._durationOverrided){var lt=Math.floor(st.duration*this._timescale);this._duration=lt,this._mediaInfo.duration=lt}}else this._mediaInfo.duration=0;if("number"==typeof st.framerate){var ut=Math.floor(1e3*st.framerate);if(ut>0){var ct=ut/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=ct,this._referenceFrameRate.fps_num=ut,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=ct}}if("object"==typeof st.keyframes){this._mediaInfo.hasKeyframesIndex=!0;var dt=st.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(dt),st.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=st,ot.a.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(at).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},at))},e.prototype._parseKeyframesIndex=function(nt){for(var rt=[],it=[],at=1;at<nt.times.length;at++){var st=this._timestampBase+Math.floor(1e3*nt.times[at]);rt.push(st),it.push(nt.filepositions[at])}return{times:rt,filepositions:it}},e.prototype._parseAudioData=function(nt,rt,it,at){if(it<=1)ot.a.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){this._littleEndian;var st=new DataView(nt,rt,it).getUint8(0),lt=st>>>4;if(9!==lt)if(2===lt||10===lt){var ut=0,ct=(12&st)>>>2;if(ct>=0&&ct<=4){ut=this._flvSoundRateTable[ct];var dt=1&st,ht=this._audioMetadata,pt=this._audioTrack;if(ht||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(ht=this._audioMetadata={}).type="audio",ht.id=pt.id,ht.timescale=this._timescale,ht.duration=this._duration,ht.audioSampleRate=ut,ht.channelCount=0===dt?1:2),10===lt){var _t=this._parseAACAudioData(nt,rt+1,it-1);if(null==_t)return;if(0===_t.packetType){if(ht.config){if(b(_t.data.config,ht.config))return;ot.a.w(this.TAG,"AudioSpecificConfig has been changed, re-generate initialization segment")}var Et=_t.data;ht.audioSampleRate=Et.samplingRate,ht.channelCount=Et.channelCount,ht.codec=Et.codec,ht.originalCodec=Et.originalCodec,ht.config=Et.config,ht.refSampleDuration=1024/ht.audioSampleRate*ht.timescale,ot.a.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",ht),(Ct=this._mediaInfo).audioCodec=ht.originalCodec,Ct.audioSampleRate=ht.audioSampleRate,Ct.audioChannelCount=ht.channelCount,Ct.hasVideo?null!=Ct.videoCodec&&(Ct.mimeType='video/x-flv; codecs="'+Ct.videoCodec+","+Ct.audioCodec+'"'):Ct.mimeType='video/x-flv; codecs="'+Ct.audioCodec+'"',Ct.isComplete()&&this._onMediaInfo(Ct)}else if(1===_t.packetType){var wt=this._timestampBase+at,Lt={unit:_t.data,length:_t.data.byteLength,dts:wt,pts:wt};pt.samples.push(Lt),pt.length+=_t.data.length}else ot.a.e(this.TAG,"Flv: Unsupported AAC data type ".concat(_t.packetType))}else if(2===lt){if(!ht.codec){var Ct;if(null==(Et=this._parseMP3AudioData(nt,rt+1,it-1,!0)))return;ht.audioSampleRate=Et.samplingRate,ht.channelCount=Et.channelCount,ht.codec=Et.codec,ht.originalCodec=Et.originalCodec,ht.refSampleDuration=1152/ht.audioSampleRate*ht.timescale,ot.a.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",ht),(Ct=this._mediaInfo).audioCodec=ht.codec,Ct.audioSampleRate=ht.audioSampleRate,Ct.audioChannelCount=ht.channelCount,Ct.audioDataRate=Et.bitRate,Ct.hasVideo?null!=Ct.videoCodec&&(Ct.mimeType='video/x-flv; codecs="'+Ct.videoCodec+","+Ct.audioCodec+'"'):Ct.mimeType='video/x-flv; codecs="'+Ct.audioCodec+'"',Ct.isComplete()&&this._onMediaInfo(Ct)}var Pt=this._parseMP3AudioData(nt,rt+1,it-1,!1);if(null==Pt)return;wt=this._timestampBase+at;var kt={unit:Pt,length:Pt.byteLength,dts:wt,pts:wt};pt.samples.push(kt),pt.length+=Pt.length}}else this._onError(St.a.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+ct)}else this._onError(St.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+lt);else{if(it<=5)return void ot.a.w(this.TAG,"Flv: Invalid audio packet, missing AudioFourCC in Ehnanced FLV payload!");var Ot=15&st,Ft=String.fromCharCode.apply(String,new Uint8Array(nt,rt,it).slice(1,5));switch(Ft){case"Opus":this._parseOpusAudioPacket(nt,rt+5,it-5,at,Ot);break;case"fLaC":this._parseFlacAudioPacket(nt,rt+5,it-5,at,Ot);break;default:this._onError(St.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec: "+Ft)}}}},e.prototype._parseAACAudioData=function(nt,rt,it){if(!(it<=1)){var at={},st=new Uint8Array(nt,rt,it);return at.packetType=st[0],0===st[0]?at.data=this._parseAACAudioSpecificConfig(nt,rt+1,it-1):at.data=st.subarray(1),at}ot.a.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},e.prototype._parseAACAudioSpecificConfig=function(nt,rt,it){var at,st,ot=new Uint8Array(nt,rt,it),lt=null,ut=0,ct=null;if(ut=at=ot[0]>>>3,(st=(7&ot[0])<<1|ot[1]>>>7)<0||st>=this._mpegSamplingRates.length)this._onError(St.a.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var dt=this._mpegSamplingRates[st],ht=(120&ot[1])>>>3;if(!(ht<0||ht>=8)){5===ut&&(ct=(7&ot[1])<<1|ot[2]>>>7,ot[2]);var pt=self.navigator.userAgent.toLowerCase();return-1!==pt.indexOf("firefox")?st>=6?(ut=5,lt=new Array(4),ct=st-3):(ut=2,lt=new Array(2),ct=st):-1!==pt.indexOf("android")?(ut=2,lt=new Array(2),ct=st):(ut=5,ct=st,lt=new Array(4),st>=6?ct=st-3:1===ht&&(ut=2,lt=new Array(2),ct=st)),lt[0]=ut<<3,lt[0]|=(15&st)>>>1,lt[1]=(15&st)<<7,lt[1]|=(15&ht)<<3,5===ut&&(lt[1]|=(15&ct)>>>1,lt[2]=(1&ct)<<7,lt[2]|=8,lt[3]=0),{config:lt,samplingRate:dt,channelCount:ht,codec:"mp4a.40."+ut,originalCodec:"mp4a.40."+at}}this._onError(St.a.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},e.prototype._parseMP3AudioData=function(nt,rt,it,at){if(!(it<4)){this._littleEndian;var st=new Uint8Array(nt,rt,it),lt=null;if(at){if(255!==st[0])return;var ut=st[1]>>>3&3,ct=(6&st[1])>>1,dt=(240&st[2])>>>4,ht=(12&st[2])>>>2,pt=3&~(st[3]>>>6)?2:1,_t=0,Et=0;switch(ut){case 0:_t=this._mpegAudioV25SampleRateTable[ht];break;case 2:_t=this._mpegAudioV20SampleRateTable[ht];break;case 3:_t=this._mpegAudioV10SampleRateTable[ht]}switch(ct){case 1:dt<this._mpegAudioL3BitRateTable.length&&(Et=this._mpegAudioL3BitRateTable[dt]);break;case 2:dt<this._mpegAudioL2BitRateTable.length&&(Et=this._mpegAudioL2BitRateTable[dt]);break;case 3:dt<this._mpegAudioL1BitRateTable.length&&(Et=this._mpegAudioL1BitRateTable[dt])}lt={bitRate:Et,samplingRate:_t,channelCount:pt,codec:"mp3",originalCodec:"mp3"}}else lt=st;return lt}ot.a.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},e.prototype._parseOpusAudioPacket=function(nt,rt,it,at,st){if(0===st)this._parseOpusSequenceHeader(nt,rt,it);else if(1===st)this._parseOpusAudioData(nt,rt,it,at);else if(2!==st)return void this._onError(St.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(st))},e.prototype._parseOpusSequenceHeader=function(nt,rt,it){if(it<=16)ot.a.w(this.TAG,"Flv: Invalid OpusSequenceHeader, lack of data!");else{var at=this._audioMetadata,st=this._audioTrack;at||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(at=this._audioMetadata={}).type="audio",at.id=st.id,at.timescale=this._timescale,at.duration=this._duration);var lt=new DataView(nt,rt,it);lt.setUint8(8,0);var ut=lt.getUint8(9);lt.setUint16(10,lt.getUint16(10,!0),!1);var ct=lt.getUint32(12,!0);lt.setUint32(12,lt.getUint32(12,!0),!1);var dt={config:new Uint8Array(nt,rt+8,it-8),channelCount:ut,samplingFrequence:ct,codec:"opus",originalCodec:"opus"};if(at.config){if(b(dt.config,at.config))return;ot.a.w(this.TAG,"OpusSequenceHeader has been changed, re-generate initialization segment")}at.audioSampleRate=dt.samplingFrequence,at.channelCount=dt.channelCount,at.codec=dt.codec,at.originalCodec=dt.originalCodec,at.config=dt.config,at.refSampleDuration=20,ot.a.v(this.TAG,"Parsed OpusSequenceHeader"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",at);var ht=this._mediaInfo;ht.audioCodec=at.originalCodec,ht.audioSampleRate=at.audioSampleRate,ht.audioChannelCount=at.channelCount,ht.hasVideo?null!=ht.videoCodec&&(ht.mimeType='video/x-flv; codecs="'+ht.videoCodec+","+ht.audioCodec+'"'):ht.mimeType='video/x-flv; codecs="'+ht.audioCodec+'"',ht.isComplete()&&this._onMediaInfo(ht)}},e.prototype._parseOpusAudioData=function(nt,rt,it,at){var st=this._audioTrack,ot=new Uint8Array(nt,rt,it),lt=this._timestampBase+at,ut={unit:ot,length:ot.byteLength,dts:lt,pts:lt};st.samples.push(ut),st.length+=ot.length},e.prototype._parseFlacAudioPacket=function(nt,rt,it,at,st){if(0===st)this._parseFlacSequenceHeader(nt,rt,it);else if(1===st)this._parseFlacAudioData(nt,rt,it,at);else if(2!==st)return void this._onError(St.a.FORMAT_ERROR,"Flv: Invalid Flac audio packet type ".concat(st))},e.prototype._parseFlacSequenceHeader=function(nt,rt,it){var at=this._audioMetadata,st=this._audioTrack;at||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(at=this._audioMetadata={}).type="audio",at.id=st.id,at.timescale=this._timescale,at.duration=this._duration);var lt=new Uint8Array(nt,rt+4,it-4),ut=new _t(lt),ct=ut.readBits(16),dt=ut.readBits(16),ht=dt===ct?dt:null;ut.readBits(24),ut.readBits(24);var pt=ut.readBits(20),Et=ut.readBits(3)+1,St=ut.readBits(5)+1;ut.destroy();var wt=new Uint8Array(lt.byteLength+4);wt.set(lt,4),wt[0]=128,wt[1]=lt.byteLength>>>16&255,wt[2]=lt.byteLength>>>8&255,wt[3]=lt.byteLength>>>0&255;var Lt={config:wt,channelCount:Et,samplingFrequence:pt,sampleSize:St,codec:"flac",originalCodec:"flac"};if(at.config){if(b(Lt.config,at.config))return;ot.a.w(this.TAG,"FlacSequenceHeader has been changed, re-generate initialization segment")}at.audioSampleRate=Lt.samplingFrequence,at.channelCount=Lt.channelCount,at.sampleSize=Lt.sampleSize,at.codec=Lt.codec,at.originalCodec=Lt.originalCodec,at.config=Lt.config,at.refSampleDuration=null!=ht?1e3*ht/Lt.samplingFrequence:null,ot.a.v(this.TAG,"Parsed FlacSequenceHeader"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",at);var Ct=this._mediaInfo;Ct.audioCodec=at.originalCodec,Ct.audioSampleRate=at.audioSampleRate,Ct.audioChannelCount=at.channelCount,Ct.hasVideo?null!=Ct.videoCodec&&(Ct.mimeType='video/x-flv; codecs="'+Ct.videoCodec+","+Ct.audioCodec+'"'):Ct.mimeType='video/x-flv; codecs="'+Ct.audioCodec+'"',Ct.isComplete()&&this._onMediaInfo(Ct)},e.prototype._parseFlacAudioData=function(nt,rt,it,at){var st=this._audioTrack,ot=new Uint8Array(nt,rt,it),lt=this._timestampBase+at,ut={unit:ot,length:ot.byteLength,dts:lt,pts:lt};st.samples.push(ut),st.length+=ot.length},e.prototype._parseVideoData=function(nt,rt,it,at,st){if(it<=1)ot.a.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var lt=new Uint8Array(nt,rt,it)[0],ut=(112&lt)>>>4;if(128&lt){var ct=15&lt,dt=String.fromCharCode.apply(String,new Uint8Array(nt,rt,it).slice(1,5));if("hvc1"===dt)this._parseEnhancedHEVCVideoPacket(nt,rt+5,it-5,at,st,ut,ct);else{if("av01"!==dt)return void this._onError(St.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: ".concat(dt));this._parseEnhancedAV1VideoPacket(nt,rt+5,it-5,at,st,ut,ct)}}else{var ht=15&lt;if(7===ht)this._parseAVCVideoPacket(nt,rt+1,it-1,at,st,ut);else{if(12!==ht)return void this._onError(St.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: ".concat(ht));this._parseHEVCVideoPacket(nt,rt+1,it-1,at,st,ut)}}}},e.prototype._parseAVCVideoPacket=function(nt,rt,it,at,st,lt){if(it<4)ot.a.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var ut=this._littleEndian,ct=new DataView(nt,rt,it),dt=ct.getUint8(0),ht=(16777215&ct.getUint32(0,!ut))<<8>>8;if(0===dt)this._parseAVCDecoderConfigurationRecord(nt,rt+4,it-4);else if(1===dt)this._parseAVCVideoData(nt,rt+4,it-4,at,st,lt,ht);else if(2!==dt)return void this._onError(St.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(dt))}},e.prototype._parseHEVCVideoPacket=function(nt,rt,it,at,st,lt){if(it<4)ot.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var ut=this._littleEndian,ct=new DataView(nt,rt,it),dt=ct.getUint8(0),ht=(16777215&ct.getUint32(0,!ut))<<8>>8;if(0===dt)this._parseHEVCDecoderConfigurationRecord(nt,rt+4,it-4);else if(1===dt)this._parseHEVCVideoData(nt,rt+4,it-4,at,st,lt,ht);else if(2!==dt)return void this._onError(St.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(dt))}},e.prototype._parseEnhancedHEVCVideoPacket=function(nt,rt,it,at,st,ot,lt){var ut=this._littleEndian,ct=new DataView(nt,rt,it);if(0===lt)this._parseHEVCDecoderConfigurationRecord(nt,rt,it);else if(1===lt){var dt=(4294967040&ct.getUint32(0,!ut))>>8;this._parseHEVCVideoData(nt,rt+3,it-3,at,st,ot,dt)}else if(3===lt)this._parseHEVCVideoData(nt,rt,it,at,st,ot,0);else if(2!==lt)return void this._onError(St.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(lt))},e.prototype._parseEnhancedAV1VideoPacket=function(nt,rt,it,at,st,ot,lt){if(this._littleEndian,0===lt)this._parseAV1CodecConfigurationRecord(nt,rt,it);else if(1===lt)this._parseAV1VideoData(nt,rt,it,at,st,ot,0);else{if(5===lt)return void this._onError(St.a.FORMAT_ERROR,"Flv: Not Supported MP2T AV1 video packet type ".concat(lt));if(2!==lt)return void this._onError(St.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(lt))}},e.prototype._parseAVCDecoderConfigurationRecord=function(nt,rt,it){if(it<7)ot.a.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var at=this._videoMetadata,st=this._videoTrack,lt=this._littleEndian,ut=new DataView(nt,rt,it);if(at){if(void 0!==at.avcc){var ct=new Uint8Array(nt,rt,it);if(b(ct,at.avcc))return;ot.a.w(this.TAG,"AVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(at=this._videoMetadata={}).type="video",at.id=st.id,at.timescale=this._timescale,at.duration=this._duration;var dt=ut.getUint8(0),ht=ut.getUint8(1);if(ut.getUint8(2),ut.getUint8(3),1===dt&&0!==ht)if(this._naluLengthSize=1+(3&ut.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var pt=31&ut.getUint8(5);if(0!==pt){pt>1&&ot.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = ".concat(pt));for(var _t=6,wt=0;wt<pt;wt++){var Lt=ut.getUint16(_t,!lt);if(_t+=2,0!==Lt){var Ct=new Uint8Array(nt,rt+_t,Lt);_t+=Lt;var Pt=Et.parseSPS(Ct);if(0===wt){at.codecWidth=Pt.codec_size.width,at.codecHeight=Pt.codec_size.height,at.presentWidth=Pt.present_size.width,at.presentHeight=Pt.present_size.height,at.profile=Pt.profile_string,at.level=Pt.level_string,at.bitDepth=Pt.bit_depth,at.chromaFormat=Pt.chroma_format,at.sarRatio=Pt.sar_ratio,at.frameRate=Pt.frame_rate,!1!==Pt.frame_rate.fixed&&0!==Pt.frame_rate.fps_num&&0!==Pt.frame_rate.fps_den||(at.frameRate=this._referenceFrameRate);var kt=at.frameRate.fps_den,Ot=at.frameRate.fps_num;at.refSampleDuration=at.timescale*(kt/Ot);for(var Ft=Ct.subarray(1,4),Bt="avc1.",Ut=0;Ut<3;Ut++){var Gt=Ft[Ut].toString(16);Gt.length<2&&(Gt="0"+Gt),Bt+=Gt}at.codec=Bt;var Ht=this._mediaInfo;Ht.width=at.codecWidth,Ht.height=at.codecHeight,Ht.fps=at.frameRate.fps,Ht.profile=at.profile,Ht.level=at.level,Ht.refFrames=Pt.ref_frames,Ht.chromaFormat=Pt.chroma_format_string,Ht.sarNum=at.sarRatio.width,Ht.sarDen=at.sarRatio.height,Ht.videoCodec=Bt,Ht.hasAudio?null!=Ht.audioCodec&&(Ht.mimeType='video/x-flv; codecs="'+Ht.videoCodec+","+Ht.audioCodec+'"'):Ht.mimeType='video/x-flv; codecs="'+Ht.videoCodec+'"',Ht.isComplete()&&this._onMediaInfo(Ht)}}}var jt=ut.getUint8(_t);if(0!==jt){for(jt>1&&ot.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = ".concat(jt)),_t++,wt=0;wt<jt;wt++)Lt=ut.getUint16(_t,!lt),_t+=2,0!==Lt&&(_t+=Lt);at.avcc=new Uint8Array(it),at.avcc.set(new Uint8Array(nt,rt,it),0),ot.a.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",at)}else this._onError(St.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(St.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(St.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: ".concat(this._naluLengthSize-1));else this._onError(St.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},e.prototype._parseHEVCDecoderConfigurationRecord=function(nt,rt,it){if(it<22)ot.a.w(this.TAG,"Flv: Invalid HEVCDecoderConfigurationRecord, lack of data!");else{var at=this._videoMetadata,st=this._videoTrack,lt=this._littleEndian,ut=new DataView(nt,rt,it);if(at){if(void 0!==at.hvcc){var ct=new Uint8Array(nt,rt,it);if(b(ct,at.hvcc))return;ot.a.w(this.TAG,"HEVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(at=this._videoMetadata={}).type="video",at.id=st.id,at.timescale=this._timescale,at.duration=this._duration;var dt=ut.getUint8(0),ht=31&ut.getUint8(1);if(0!==dt&&1!==dt||0===ht)this._onError(St.a.FORMAT_ERROR,"Flv: Invalid HEVCDecoderConfigurationRecord");else if(this._naluLengthSize=1+(3&ut.getUint8(21)),3===this._naluLengthSize||4===this._naluLengthSize){for(var pt=ut.getUint8(22),_t=0,Et=23;_t<pt;_t++){var Lt=63&ut.getUint8(Et+0),Ct=ut.getUint16(Et+1,!lt);Et+=3;for(var Pt=0;Pt<Ct;Pt++){var kt=ut.getUint16(Et+0,!lt);if(0===Pt)if(33===Lt){Et+=2;var Ot=new Uint8Array(nt,rt+Et,kt),Ft=wt.parseSPS(Ot);at.codecWidth=Ft.codec_size.width,at.codecHeight=Ft.codec_size.height,at.presentWidth=Ft.present_size.width,at.presentHeight=Ft.present_size.height,at.profile=Ft.profile_string,at.level=Ft.level_string,at.bitDepth=Ft.bit_depth,at.chromaFormat=Ft.chroma_format,at.sarRatio=Ft.sar_ratio,at.frameRate=Ft.frame_rate,!1!==Ft.frame_rate.fixed&&0!==Ft.frame_rate.fps_num&&0!==Ft.frame_rate.fps_den||(at.frameRate=this._referenceFrameRate);var Bt=at.frameRate.fps_den,Ut=at.frameRate.fps_num;at.refSampleDuration=at.timescale*(Bt/Ut),at.codec=Ft.codec_mimetype;var Gt=this._mediaInfo;Gt.width=at.codecWidth,Gt.height=at.codecHeight,Gt.fps=at.frameRate.fps,Gt.profile=at.profile,Gt.level=at.level,Gt.refFrames=Ft.ref_frames,Gt.chromaFormat=Ft.chroma_format_string,Gt.sarNum=at.sarRatio.width,Gt.sarDen=at.sarRatio.height,Gt.videoCodec=Ft.codec_mimetype,Gt.hasAudio?null!=Gt.audioCodec&&(Gt.mimeType='video/x-flv; codecs="'+Gt.videoCodec+","+Gt.audioCodec+'"'):Gt.mimeType='video/x-flv; codecs="'+Gt.videoCodec+'"',Gt.isComplete()&&this._onMediaInfo(Gt),Et+=kt}else Et+=2+kt;else Et+=2+kt}}at.hvcc=new Uint8Array(it),at.hvcc.set(new Uint8Array(nt,rt,it),0),ot.a.v(this.TAG,"Parsed HEVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",at)}else this._onError(St.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: ".concat(this._naluLengthSize-1))}},e.prototype._parseAV1CodecConfigurationRecord=function(nt,rt,it){if(it<4)ot.a.w(this.TAG,"Flv: Invalid AV1CodecConfigurationRecord, lack of data!");else{var at=this._videoMetadata,st=this._videoTrack,lt=(this._littleEndian,new DataView(nt,rt,it));at?void 0!==at.av1c&&ot.a.w(this.TAG,"Found another AV1CodecConfigurationRecord!"):(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(at=this._videoMetadata={}).type="video",at.id=st.id,at.timescale=this._timescale,at.duration=this._duration);var ut=127&lt.getUint8(0);if(lt.getUint8(1),lt.getUint8(1),lt.getUint8(2),1===ut){var ct=Ct.parseOBUs(new Uint8Array(nt,rt+4,it-4));if(null!=ct){at.profile=ct.profile_string,at.level=ct.level_string,at.bitDepth=ct.bit_depth,at.chromaFormat=ct.chroma_format,at.frameRate=ct.frame_rate,!1!==ct.frame_rate.fixed&&0!==ct.frame_rate.fps_num&&0!==ct.frame_rate.fps_den||(at.frameRate=this._referenceFrameRate);var dt=at.frameRate.fps_den,ht=at.frameRate.fps_num;at.refSampleDuration=at.timescale*(dt/ht),at.codec=ct.codec_mimetype,at.extra=ct;var pt=this._mediaInfo;pt.fps=at.frameRate.fps,pt.profile=at.profile,pt.level=at.level,pt.refFrames=ct.ref_frames,pt.chromaFormat=ct.chroma_format_string,pt.videoCodec=ct.codec_mimetype,pt.hasAudio?null!=pt.audioCodec&&(pt.mimeType='video/x-flv; codecs="'+pt.videoCodec+","+pt.audioCodec+'"'):pt.mimeType='video/x-flv; codecs="'+pt.videoCodec+'"',pt.isComplete()&&this._onMediaInfo(pt),at.av1c=new Uint8Array(it),at.av1c.set(new Uint8Array(nt,rt,it),0),ot.a.v(this.TAG,"Preparing AV1CodecConfigurationRecord")}else this._onError(St.a.FORMAT_ERROR,"Flv: Invalid AV1CodecConfigurationRecord")}else this._onError(St.a.FORMAT_ERROR,"Flv: Invalid AV1CodecConfigurationRecord")}},e.prototype._parseAVCVideoData=function(nt,rt,it,at,st,lt,ut){for(var ct=this._littleEndian,dt=new DataView(nt,rt,it),ht=[],pt=0,_t=0,Et=this._naluLengthSize,St=this._timestampBase+at,wt=1===lt;_t<it;){if(_t+4>=it){ot.a.w(this.TAG,"Malformed Nalu near timestamp ".concat(St,", offset = ").concat(_t,", dataSize = ").concat(it));break}var Lt=dt.getUint32(_t,!ct);if(3===Et&&(Lt>>>=8),Lt>it-Et)return void ot.a.w(this.TAG,"Malformed Nalus near timestamp ".concat(St,", NaluSize > DataSize!"));var Ct=31&dt.getUint8(_t+Et);5===Ct&&(wt=!0);var Pt=new Uint8Array(nt,rt+_t,Et+Lt),kt={type:Ct,data:Pt};ht.push(kt),pt+=Pt.byteLength,_t+=Et+Lt}if(ht.length){var Ot=this._videoTrack,Ft={units:ht,length:pt,isKeyframe:wt,dts:St,cts:ut,pts:St+ut};wt&&(Ft.fileposition=st),Ot.samples.push(Ft),Ot.length+=pt}},e.prototype._parseHEVCVideoData=function(nt,rt,it,at,st,lt,ut){for(var ct=this._littleEndian,dt=new DataView(nt,rt,it),ht=[],pt=0,_t=0,Et=this._naluLengthSize,St=this._timestampBase+at,wt=1===lt;_t<it;){if(_t+4>=it){ot.a.w(this.TAG,"Malformed Nalu near timestamp ".concat(St,", offset = ").concat(_t,", dataSize = ").concat(it));break}var Lt=dt.getUint32(_t,!ct);if(3===Et&&(Lt>>>=8),Lt>it-Et)return void ot.a.w(this.TAG,"Malformed Nalus near timestamp ".concat(St,", NaluSize > DataSize!"));var Ct=dt.getUint8(_t+Et)>>1&63;19!==Ct&&20!==Ct&&21!==Ct||(wt=!0);var Pt=new Uint8Array(nt,rt+_t,Et+Lt),kt={type:Ct,data:Pt};ht.push(kt),pt+=Pt.byteLength,_t+=Et+Lt}if(ht.length){var Ot=this._videoTrack,Ft={units:ht,length:pt,isKeyframe:wt,dts:St,cts:ut,pts:St+ut};wt&&(Ft.fileposition=st),Ot.samples.push(Ft),Ot.length+=pt}},e.prototype._parseAV1VideoData=function(nt,rt,it,at,st,lt,ut){this._littleEndian;var ct,dt=[],ht=this._timestampBase+at,pt=1===lt;if(pt){var _t=this._videoMetadata,Et=Ct.parseOBUs(new Uint8Array(nt,rt,it),_t.extra);if(null==Et)return void this._onError(St.a.FORMAT_ERROR,"Flv: Invalid AV1 VideoData");console.log(Et),_t.codecWidth=Et.codec_size.width,_t.codecHeight=Et.codec_size.height,_t.presentWidth=Et.present_size.width,_t.presentHeight=Et.present_size.height,_t.sarRatio=Et.sar_ratio;var wt=this._mediaInfo;wt.width=_t.codecWidth,wt.height=_t.codecHeight,wt.sarNum=_t.sarRatio.width,wt.sarDen=_t.sarRatio.height,ot.a.v(this.TAG,"Parsed AV1DecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",_t)}if(ct=it,dt.push({unitType:0,data:new Uint8Array(nt,rt+0,it)}),dt.length){var Lt=this._videoTrack,Pt={units:dt,length:ct,isKeyframe:pt,dts:ht,cts:ut,pts:ht+ut};pt&&(Pt.fileposition=st),Lt.samples.push(Pt),Lt.length+=ct}},e}(),kt=function(){function e(){}return e.prototype.destroy=function(){this.onError=null,this.onMediaInfo=null,this.onMetaDataArrived=null,this.onTrackMetadata=null,this.onDataAvailable=null,this.onTimedID3Metadata=null,this.onSynchronousKLVMetadata=null,this.onAsynchronousKLVMetadata=null,this.onSMPTE2038Metadata=null,this.onSCTE35Metadata=null,this.onPESPrivateData=null,this.onPESPrivateDataDescriptor=null},e}(),k=function(){this.program_pmt_pid={}};!function(nt){nt[nt.kMPEG1Audio=3]="kMPEG1Audio",nt[nt.kMPEG2Audio=4]="kMPEG2Audio",nt[nt.kPESPrivateData=6]="kPESPrivateData",nt[nt.kADTSAAC=15]="kADTSAAC",nt[nt.kLOASAAC=17]="kLOASAAC",nt[nt.kAC3=129]="kAC3",nt[nt.kEAC3=135]="kEAC3",nt[nt.kMetadata=21]="kMetadata",nt[nt.kSCTE35=134]="kSCTE35",nt[nt.kH264=27]="kH264",nt[nt.kH265=36]="kH265"}(Lt||(Lt={}));var Ot,M=function(){this.pid_stream_type={},this.common_pids={h264:void 0,h265:void 0,av1:void 0,adts_aac:void 0,loas_aac:void 0,opus:void 0,ac3:void 0,eac3:void 0,mp3:void 0},this.pes_private_data_pids={},this.timed_id3_pids={},this.synchronous_klv_pids={},this.asynchronous_klv_pids={},this.scte_35_pids={},this.smpte2038_pids={}},C=function(){},D=function(){},O=function(){this.slices=[],this.total_length=0,this.expected_length=0,this.file_position=0};!function(nt){nt[nt.kUnspecified=0]="kUnspecified",nt[nt.kSliceNonIDR=1]="kSliceNonIDR",nt[nt.kSliceDPA=2]="kSliceDPA",nt[nt.kSliceDPB=3]="kSliceDPB",nt[nt.kSliceDPC=4]="kSliceDPC",nt[nt.kSliceIDR=5]="kSliceIDR",nt[nt.kSliceSEI=6]="kSliceSEI",nt[nt.kSliceSPS=7]="kSliceSPS",nt[nt.kSlicePPS=8]="kSlicePPS",nt[nt.kSliceAUD=9]="kSliceAUD",nt[nt.kEndOfSequence=10]="kEndOfSequence",nt[nt.kEndOfStream=11]="kEndOfStream",nt[nt.kFiller=12]="kFiller",nt[nt.kSPSExt=13]="kSPSExt",nt[nt.kReserved0=14]="kReserved0"}(Ot||(Ot={}));var Ft,Bt,P=function(){},x=function(nt){var rt=nt.data.byteLength;this.type=nt.type,this.data=new Uint8Array(4+rt),new DataView(this.data.buffer).setUint32(0,rt),this.data.set(nt.data,4)},Ut=function(){function e(nt){this.TAG="H264AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=nt,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&ot.a.e(this.TAG,"Could not find H264 startcode until payload end!")}return e.prototype.findNextStartCodeOffset=function(nt){for(var rt=nt,it=this.data_;;){if(rt+3>=it.byteLength)return this.eof_flag_=!0,it.byteLength;var at=it[rt+0]<<24|it[rt+1]<<16|it[rt+2]<<8|it[rt+3],st=it[rt+0]<<16|it[rt+1]<<8|it[rt+2];if(1===at||1===st)return rt;rt++}},e.prototype.readNextNaluPayload=function(){for(var nt=this.data_,rt=null;null==rt&&!this.eof_flag_;){var it=this.current_startcode_offset_,at=31&nt[it+=1==(nt[it]<<24|nt[it+1]<<16|nt[it+2]<<8|nt[it+3])?4:3],st=(128&nt[it])>>>7,ot=this.findNextStartCodeOffset(it);if(this.current_startcode_offset_=ot,!(at>=Ot.kReserved0)&&0===st){var lt=nt.subarray(it,ot);(rt=new P).type=at,rt.data=lt}}return rt},e}(),Gt=function(){function e(nt,rt,it){var at=8+nt.byteLength+1+2+rt.byteLength,st=!1;66!==nt[3]&&77!==nt[3]&&88!==nt[3]&&(st=!0,at+=4);var ot=this.data=new Uint8Array(at);ot[0]=1,ot[1]=nt[1],ot[2]=nt[2],ot[3]=nt[3],ot[4]=255,ot[5]=225;var lt=nt.byteLength;ot[6]=lt>>>8,ot[7]=255&lt;var ut=8;ot.set(nt,8),ot[ut+=lt]=1;var ct=rt.byteLength;ot[ut+1]=ct>>>8,ot[ut+2]=255&ct,ot.set(rt,ut+3),ut+=3+ct,st&&(ot[ut]=252|it.chroma_format_idc,ot[ut+1]=248|it.bit_depth_luma-8,ot[ut+2]=248|it.bit_depth_chroma-8,ot[ut+3]=0,ut+=4)}return e.prototype.getData=function(){return this.data},e}();!function(nt){nt[nt.kNull=0]="kNull",nt[nt.kAACMain=1]="kAACMain",nt[nt.kAAC_LC=2]="kAAC_LC",nt[nt.kAAC_SSR=3]="kAAC_SSR",nt[nt.kAAC_LTP=4]="kAAC_LTP",nt[nt.kAAC_SBR=5]="kAAC_SBR",nt[nt.kAAC_Scalable=6]="kAAC_Scalable",nt[nt.kLayer1=32]="kLayer1",nt[nt.kLayer2=33]="kLayer2",nt[nt.kLayer3=34]="kLayer3"}(Ft||(Ft={})),function(nt){nt[nt.k96000Hz=0]="k96000Hz",nt[nt.k88200Hz=1]="k88200Hz",nt[nt.k64000Hz=2]="k64000Hz",nt[nt.k48000Hz=3]="k48000Hz",nt[nt.k44100Hz=4]="k44100Hz",nt[nt.k32000Hz=5]="k32000Hz",nt[nt.k24000Hz=6]="k24000Hz",nt[nt.k22050Hz=7]="k22050Hz",nt[nt.k16000Hz=8]="k16000Hz",nt[nt.k12000Hz=9]="k12000Hz",nt[nt.k11025Hz=10]="k11025Hz",nt[nt.k8000Hz=11]="k8000Hz",nt[nt.k7350Hz=12]="k7350Hz"}(Bt||(Bt={}));var Ht,jt,Kt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],$t=(Ht=function(nt,rt){return(Ht=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(nt,rt){nt.__proto__=rt}||function(nt,rt){for(var it in rt)Object.prototype.hasOwnProperty.call(rt,it)&&(nt[it]=rt[it])})(nt,rt)},function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Class extends value "+String(rt)+" is not a constructor or null");function i(){this.constructor=nt}Ht(nt,rt),nt.prototype=null===rt?Object.create(rt):(i.prototype=rt.prototype,new i)}),z=function(){},Yt=function(nt){function t(){return null!==nt&&nt.apply(this,arguments)||this}return $t(t,nt),t}(z),Wt=function(){function e(nt){this.TAG="AACADTSParser",this.data_=nt,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&ot.a.e(this.TAG,"Could not found ADTS syncword until payload end")}return e.prototype.findNextSyncwordOffset=function(nt){for(var rt=nt,it=this.data_;;){if(rt+7>=it.byteLength)return this.eof_flag_=!0,it.byteLength;if(4095==(it[rt+0]<<8|it[rt+1])>>>4)return rt;rt++}},e.prototype.readNextAACFrame=function(){for(var nt=this.data_,rt=null;null==rt&&!this.eof_flag_;){var it=this.current_syncword_offset_,at=(8&nt[it+1])>>>3,st=(6&nt[it+1])>>>1,ot=1&nt[it+1],lt=(192&nt[it+2])>>>6,ut=(60&nt[it+2])>>>2,ct=(1&nt[it+2])<<2|(192&nt[it+3])>>>6,dt=(3&nt[it+3])<<11|nt[it+4]<<3|(224&nt[it+5])>>>5;if(nt[it+6],it+dt>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var ht=1===ot?7:9,pt=dt-ht;it+=ht;var _t=this.findNextSyncwordOffset(it+pt);if(this.current_syncword_offset_=_t,(0===at||1===at)&&0===st){var Et=nt.subarray(it,it+pt);(rt=new z).audio_object_type=lt+1,rt.sampling_freq_index=ut,rt.sampling_frequency=Kt[ut],rt.channel_config=ct,rt.data=Et}}return rt},e.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},e.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},e}(),Qt=function(){function e(nt){this.TAG="AACLOASParser",this.data_=nt,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&ot.a.e(this.TAG,"Could not found LOAS syncword until payload end")}return e.prototype.findNextSyncwordOffset=function(nt){for(var rt=nt,it=this.data_;;){if(rt+1>=it.byteLength)return this.eof_flag_=!0,it.byteLength;if(695==(it[rt+0]<<3|it[rt+1]>>>5))return rt;rt++}},e.prototype.getLATMValue=function(nt){for(var rt=nt.readBits(2),it=0,at=0;at<=rt;at++)it<<=8,it|=nt.readByte();return it},e.prototype.readNextAACFrame=function(nt){for(var rt=this.data_,it=null;null==it&&!this.eof_flag_;){var at=this.current_syncword_offset_,st=(31&rt[at+1])<<8|rt[at+2];if(at+3+st>=this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var lt=new _t(rt.subarray(at+3,at+3+st)),ut=null;if(lt.readBool()){if(null==nt){ot.a.w(this.TAG,"StreamMuxConfig Missing"),this.current_syncword_offset_=this.findNextSyncwordOffset(at+3+st),lt.destroy();continue}ut=nt}else{var ct=lt.readBool();if(ct&&lt.readBool()){ot.a.e(this.TAG,"audioMuxVersionA is Not Supported"),lt.destroy();break}if(ct&&this.getLATMValue(lt),!lt.readBool()){ot.a.e(this.TAG,"allStreamsSameTimeFraming zero is Not Supported"),lt.destroy();break}if(0!==lt.readBits(6)){ot.a.e(this.TAG,"more than 2 numSubFrames Not Supported"),lt.destroy();break}if(0!==lt.readBits(4)){ot.a.e(this.TAG,"more than 2 numProgram Not Supported"),lt.destroy();break}if(0!==lt.readBits(3)){ot.a.e(this.TAG,"more than 2 numLayer Not Supported"),lt.destroy();break}var dt=ct?this.getLATMValue(lt):0,ht=lt.readBits(5);dt-=5;var pt=lt.readBits(4);dt-=4;var Et=lt.readBits(4);dt-=4,lt.readBits(3),(dt-=3)>0&&lt.readBits(dt);var St=lt.readBits(3);if(0!==St){ot.a.e(this.TAG,"frameLengthType = ".concat(St,". Only frameLengthType = 0 Supported")),lt.destroy();break}lt.readByte();var wt=lt.readBool();if(wt)if(ct)this.getLATMValue(lt);else{for(var Lt=0;;){Lt<<=8;var Ct=lt.readBool();if(Lt+=lt.readByte(),!Ct)break}console.log(Lt)}lt.readBool()&&lt.readByte(),(ut=new Yt).audio_object_type=ht,ut.sampling_freq_index=pt,ut.sampling_frequency=Kt[ut.sampling_freq_index],ut.channel_config=Et,ut.other_data_present=wt}for(var Pt=0;;){var kt=lt.readByte();if(Pt+=kt,255!==kt)break}for(var Ot=new Uint8Array(Pt),Ft=0;Ft<Pt;Ft++)Ot[Ft]=lt.readByte();(it=new Yt).audio_object_type=ut.audio_object_type,it.sampling_freq_index=ut.sampling_freq_index,it.sampling_frequency=Kt[ut.sampling_freq_index],it.channel_config=ut.channel_config,it.other_data_present=ut.other_data_present,it.data=Ot,this.current_syncword_offset_=this.findNextSyncwordOffset(at+3+st)}return it},e.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},e.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},e}(),W=function(nt){var rt=null,it=nt.audio_object_type,at=nt.audio_object_type,st=nt.sampling_freq_index,ot=nt.channel_config,lt=0,ut=navigator.userAgent.toLowerCase();-1!==ut.indexOf("firefox")?st>=6?(at=5,rt=new Array(4),lt=st-3):(at=2,rt=new Array(2),lt=st):-1!==ut.indexOf("android")?(at=2,rt=new Array(2),lt=st):(at=5,lt=st,rt=new Array(4),st>=6?lt=st-3:1===ot&&(at=2,rt=new Array(2),lt=st)),rt[0]=at<<3,rt[0]|=(15&st)>>>1,rt[1]=(15&st)<<7,rt[1]|=(15&ot)<<3,5===at&&(rt[1]|=(15&lt)>>>1,rt[2]=(1&lt)<<7,rt[2]|=8,rt[3]=0),this.config=rt,this.sampling_rate=Kt[st],this.channel_count=ot,this.codec_mimetype="mp4a.40."+at,this.original_codec_mimetype="mp4a.40."+it},Y=function(){},X=function(){};!function(nt){nt[nt.kSpliceNull=0]="kSpliceNull",nt[nt.kSpliceSchedule=4]="kSpliceSchedule",nt[nt.kSpliceInsert=5]="kSpliceInsert",nt[nt.kTimeSignal=6]="kTimeSignal",nt[nt.kBandwidthReservation=7]="kBandwidthReservation",nt[nt.kPrivateCommand=255]="kPrivateCommand"}(jt||(jt={}));var en,J=function(nt){var rt=nt.readBool();return rt?(nt.readBits(6),{time_specified_flag:rt,pts_time:4*nt.readBits(31)+nt.readBits(2)}):(nt.readBits(7),{time_specified_flag:rt})},Z=function(nt){var rt=nt.readBool();return nt.readBits(6),{auto_return:rt,duration:4*nt.readBits(31)+nt.readBits(2)}},$=function(nt,rt){var it=rt.readBits(8);return nt?{component_tag:it}:{component_tag:it,splice_time:J(rt)}},ee=function(nt){return{component_tag:nt.readBits(8),utc_splice_time:nt.readBits(32)}},te=function(nt){var rt=nt.readBits(32),it=nt.readBool();nt.readBits(7);var at={splice_event_id:rt,splice_event_cancel_indicator:it};if(it)return at;if(at.out_of_network_indicator=nt.readBool(),at.program_splice_flag=nt.readBool(),at.duration_flag=nt.readBool(),nt.readBits(5),at.program_splice_flag)at.utc_splice_time=nt.readBits(32);else{at.component_count=nt.readBits(8),at.components=[];for(var st=0;st<at.component_count;st++)at.components.push(ee(nt))}return at.duration_flag&&(at.break_duration=Z(nt)),at.unique_program_id=nt.readBits(16),at.avail_num=nt.readBits(8),at.avails_expected=nt.readBits(8),at},ie=function(nt,rt,it,at){return{descriptor_tag:nt,descriptor_length:rt,identifier:it,provider_avail_id:at.readBits(32)}},ne=function(nt,rt,it,at){var st=at.readBits(8),ot=at.readBits(3);at.readBits(5);for(var lt="",ut=0;ut<ot;ut++)lt+=String.fromCharCode(at.readBits(8));return{descriptor_tag:nt,descriptor_length:rt,identifier:it,preroll:st,dtmf_count:ot,DTMF_char:lt}},ae=function(nt){var rt=nt.readBits(8);return nt.readBits(7),{component_tag:rt,pts_offset:4*nt.readBits(31)+nt.readBits(2)}},re=function(nt,rt,it,at){var st=at.readBits(32),ot=at.readBool();at.readBits(7);var lt={descriptor_tag:nt,descriptor_length:rt,identifier:it,segmentation_event_id:st,segmentation_event_cancel_indicator:ot};if(ot)return lt;if(lt.program_segmentation_flag=at.readBool(),lt.segmentation_duration_flag=at.readBool(),lt.delivery_not_restricted_flag=at.readBool(),lt.delivery_not_restricted_flag?at.readBits(5):(lt.web_delivery_allowed_flag=at.readBool(),lt.no_regional_blackout_flag=at.readBool(),lt.archive_allowed_flag=at.readBool(),lt.device_restrictions=at.readBits(2)),!lt.program_segmentation_flag){lt.component_count=at.readBits(8),lt.components=[];for(var ut=0;ut<lt.component_count;ut++)lt.components.push(ae(at))}lt.segmentation_duration_flag&&(lt.segmentation_duration=at.readBits(40)),lt.segmentation_upid_type=at.readBits(8),lt.segmentation_upid_length=at.readBits(8);var ct=new Uint8Array(lt.segmentation_upid_length);for(ut=0;ut<lt.segmentation_upid_length;ut++)ct[ut]=at.readBits(8);return lt.segmentation_upid=ct.buffer,lt.segmentation_type_id=at.readBits(8),lt.segment_num=at.readBits(8),lt.segments_expected=at.readBits(8),52!==lt.segmentation_type_id&&54!==lt.segmentation_type_id&&56!==lt.segmentation_type_id&&58!==lt.segmentation_type_id||(lt.sub_segment_num=at.readBits(8),lt.sub_segments_expected=at.readBits(8)),lt},oe=function(nt,rt,it,at){return{descriptor_tag:nt,descriptor_length:rt,identifier:it,TAI_seconds:at.readBits(48),TAI_ns:at.readBits(32),UTC_offset:at.readBits(16)}},se=function(nt){return{component_tag:nt.readBits(8),ISO_code:String.fromCharCode(nt.readBits(8),nt.readBits(8),nt.readBits(8)),Bit_Stream_Mode:nt.readBits(3),Num_Channels:nt.readBits(4),Full_Srvc_Audio:nt.readBool()}},de=function(nt,rt,it,at){for(var st=at.readBits(4),ot=[],lt=0;lt<st;lt++)ot.push(se(at));return{descriptor_tag:nt,descriptor_length:rt,identifier:it,audio_count:st,components:ot}},_e=function(nt){var rt=new _t(nt),it=rt.readBits(8),at=rt.readBool(),st=rt.readBool();rt.readBits(2);var ot=rt.readBits(12),lt=rt.readBits(8),ut=rt.readBool(),ct=rt.readBits(6),dt=4*rt.readBits(31)+rt.readBits(2),ht=rt.readBits(8),pt=rt.readBits(12),Et=rt.readBits(12),St=rt.readBits(8),wt=null;St===jt.kSpliceNull?wt={}:St===jt.kSpliceSchedule?wt=function(nt){for(var rt=nt.readBits(8),it=[],at=0;at<rt;at++)it.push(te(nt));return{splice_count:rt,events:it}}(rt):St===jt.kSpliceInsert?wt=function(nt){var rt=nt.readBits(32),it=nt.readBool();nt.readBits(7);var at={splice_event_id:rt,splice_event_cancel_indicator:it};if(it)return at;if(at.out_of_network_indicator=nt.readBool(),at.program_splice_flag=nt.readBool(),at.duration_flag=nt.readBool(),at.splice_immediate_flag=nt.readBool(),nt.readBits(4),at.program_splice_flag&&!at.splice_immediate_flag&&(at.splice_time=J(nt)),!at.program_splice_flag){at.component_count=nt.readBits(8),at.components=[];for(var st=0;st<at.component_count;st++)at.components.push($(at.splice_immediate_flag,nt))}return at.duration_flag&&(at.break_duration=Z(nt)),at.unique_program_id=nt.readBits(16),at.avail_num=nt.readBits(8),at.avails_expected=nt.readBits(8),at}(rt):St===jt.kTimeSignal?wt=function(nt){return{splice_time:J(nt)}}(rt):St===jt.kBandwidthReservation?wt={}:St===jt.kPrivateCommand?wt=function(nt,rt){for(var it=String.fromCharCode(rt.readBits(8),rt.readBits(8),rt.readBits(8),rt.readBits(8)),at=new Uint8Array(nt-4),st=0;st<nt-4;st++)at[st]=rt.readBits(8);return{identifier:it,private_data:at.buffer}}(Et,rt):rt.readBits(8*Et);for(var Lt=[],Ct=rt.readBits(16),Pt=0;Pt<Ct;){var kt=rt.readBits(8),Ot=rt.readBits(8),Ft=String.fromCharCode(rt.readBits(8),rt.readBits(8),rt.readBits(8),rt.readBits(8));0===kt?Lt.push(ie(kt,Ot,Ft,rt)):1===kt?Lt.push(ne(kt,Ot,Ft,rt)):2===kt?Lt.push(re(kt,Ot,Ft,rt)):3===kt?Lt.push(oe(kt,Ot,Ft,rt)):4===kt?Lt.push(de(kt,Ot,Ft,rt)):rt.readBits(8*(Ot-4)),Pt+=2+Ot}var Bt={table_id:it,section_syntax_indicator:at,private_indicator:st,section_length:ot,protocol_version:lt,encrypted_packet:ut,encryption_algorithm:ct,pts_adjustment:dt,cw_index:ht,tier:pt,splice_command_length:Et,splice_command_type:St,splice_command:wt,descriptor_loop_length:Ct,splice_descriptors:Lt,E_CRC32:ut?rt.readBits(32):void 0,CRC32:rt.readBits(32)};if(St===jt.kSpliceInsert){var Ut=wt;if(Ut.splice_event_cancel_indicator)return{splice_command_type:St,detail:Bt,data:nt};if(Ut.program_splice_flag&&!Ut.splice_immediate_flag){var Gt=Ut.duration_flag?Ut.break_duration.auto_return:void 0,Ht=Ut.duration_flag?Ut.break_duration.duration/90:void 0;return Ut.splice_time.time_specified_flag?{splice_command_type:St,pts:(dt+Ut.splice_time.pts_time)%Math.pow(2,33),auto_return:Gt,duraiton:Ht,detail:Bt,data:nt}:{splice_command_type:St,auto_return:Gt,duraiton:Ht,detail:Bt,data:nt}}return{splice_command_type:St,auto_return:Gt=Ut.duration_flag?Ut.break_duration.auto_return:void 0,duraiton:Ht=Ut.duration_flag?Ut.break_duration.duration/90:void 0,detail:Bt,data:nt}}if(St===jt.kTimeSignal){var Kt=wt;return Kt.splice_time.time_specified_flag?{splice_command_type:St,pts:(dt+Kt.splice_time.pts_time)%Math.pow(2,33),detail:Bt,data:nt}:{splice_command_type:St,detail:Bt,data:nt}}return{splice_command_type:St,detail:Bt,data:nt}};!function(nt){nt[nt.kSliceIDR_W_RADL=19]="kSliceIDR_W_RADL",nt[nt.kSliceIDR_N_LP=20]="kSliceIDR_N_LP",nt[nt.kSliceCRA_NUT=21]="kSliceCRA_NUT",nt[nt.kSliceVPS=32]="kSliceVPS",nt[nt.kSliceSPS=33]="kSliceSPS",nt[nt.kSlicePPS=34]="kSlicePPS",nt[nt.kSliceAUD=35]="kSliceAUD"}(en||(en={}));var ce=function(){},he=function(nt){var rt=nt.data.byteLength;this.type=nt.type,this.data=new Uint8Array(4+rt),new DataView(this.data.buffer).setUint32(0,rt),this.data.set(nt.data,4)},nn=function(){function e(nt){this.TAG="H265AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=nt,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&ot.a.e(this.TAG,"Could not find H265 startcode until payload end!")}return e.prototype.findNextStartCodeOffset=function(nt){for(var rt=nt,it=this.data_;;){if(rt+3>=it.byteLength)return this.eof_flag_=!0,it.byteLength;var at=it[rt+0]<<24|it[rt+1]<<16|it[rt+2]<<8|it[rt+3],st=it[rt+0]<<16|it[rt+1]<<8|it[rt+2];if(1===at||1===st)return rt;rt++}},e.prototype.readNextNaluPayload=function(){for(var nt=this.data_,rt=null;null==rt&&!this.eof_flag_;){var it=this.current_startcode_offset_,at=nt[it+=1==(nt[it]<<24|nt[it+1]<<16|nt[it+2]<<8|nt[it+3])?4:3]>>1&63,st=(128&nt[it])>>>7,ot=this.findNextStartCodeOffset(it);if(this.current_startcode_offset_=ot,0===st){var lt=nt.subarray(it,ot);(rt=new ce).type=at,rt.data=lt}}return rt},e}(),an=function(){function e(nt,rt,it,at){var st=23+(5+nt.byteLength)+(5+rt.byteLength)+(5+it.byteLength),ot=this.data=new Uint8Array(st);ot[0]=1,ot[1]=(3&at.general_profile_space)<<6|(at.general_tier_flag?1:0)<<5|31&at.general_profile_idc,ot[2]=at.general_profile_compatibility_flags_1,ot[3]=at.general_profile_compatibility_flags_2,ot[4]=at.general_profile_compatibility_flags_3,ot[5]=at.general_profile_compatibility_flags_4,ot[6]=at.general_constraint_indicator_flags_1,ot[7]=at.general_constraint_indicator_flags_2,ot[8]=at.general_constraint_indicator_flags_3,ot[9]=at.general_constraint_indicator_flags_4,ot[10]=at.general_constraint_indicator_flags_5,ot[11]=at.general_constraint_indicator_flags_6,ot[12]=at.general_level_idc,ot[13]=240|(3840&at.min_spatial_segmentation_idc)>>8,ot[14]=255&at.min_spatial_segmentation_idc,ot[15]=252|3&at.parallelismType,ot[16]=252|3&at.chroma_format_idc,ot[17]=248|7&at.bit_depth_luma_minus8,ot[18]=248|7&at.bit_depth_chroma_minus8,ot[19]=0,ot[20]=0,ot[21]=(3&at.constant_frame_rate)<<6|(7&at.num_temporal_layers)<<3|(at.temporal_id_nested?1:0)<<2|3,ot[22]=3,ot[23]=128|en.kSliceVPS,ot[24]=0,ot[25]=1,ot[26]=(65280&nt.byteLength)>>8,ot[27]=255&nt.byteLength,ot.set(nt,28),ot[23+(5+nt.byteLength)+0]=128|en.kSliceSPS,ot[23+(5+nt.byteLength)+1]=0,ot[23+(5+nt.byteLength)+2]=1,ot[23+(5+nt.byteLength)+3]=(65280&rt.byteLength)>>8,ot[23+(5+nt.byteLength)+4]=255&rt.byteLength,ot.set(rt,23+(5+nt.byteLength)+5),ot[23+(5+nt.byteLength+5+rt.byteLength)+0]=128|en.kSlicePPS,ot[23+(5+nt.byteLength+5+rt.byteLength)+1]=0,ot[23+(5+nt.byteLength+5+rt.byteLength)+2]=1,ot[23+(5+nt.byteLength+5+rt.byteLength)+3]=(65280&it.byteLength)>>8,ot[23+(5+nt.byteLength+5+rt.byteLength)+4]=255&it.byteLength,ot.set(it,23+(5+nt.byteLength+5+rt.byteLength)+5)}return e.prototype.getData=function(){return this.data},e}(),fe=function(){},pe=function(){},me=function(){},ln=[[64,64,80,80,96,96,112,112,128,128,160,160,192,192,224,224,256,256,320,320,384,384,448,448,512,512,640,640,768,768,896,896,1024,1024,1152,1152,1280,1280],[69,70,87,88,104,105,121,122,139,140,174,175,208,209,243,244,278,279,348,349,417,418,487,488,557,558,696,697,835,836,975,976,1114,1115,1253,1254,1393,1394],[96,96,120,120,144,144,168,168,192,192,240,240,288,288,336,336,384,384,480,480,576,576,672,672,768,768,960,960,1152,1152,1344,1344,1536,1536,1728,1728,1920,1920]],hn=function(){function e(nt){this.TAG="AC3Parser",this.data_=nt,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&ot.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return e.prototype.findNextSyncwordOffset=function(nt){for(var rt=nt,it=this.data_;;){if(rt+7>=it.byteLength)return this.eof_flag_=!0,it.byteLength;if(2935==(it[rt+0]<<8|it[rt+1]))return rt;rt++}},e.prototype.readNextAC3Frame=function(){for(var nt=this.data_,rt=null;null==rt&&!this.eof_flag_;){var it=this.current_syncword_offset_,at=nt[it+4]>>6,st=[48e3,44200,33e3][at],ot=63&nt[it+4],lt=2*ln[at][ot];if(isNaN(lt)||it+lt>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var ut=this.findNextSyncwordOffset(it+lt);this.current_syncword_offset_=ut;var ct=nt[it+5]>>3,dt=7&nt[it+5],ht=nt[it+6]>>5,pt=0;!!(1&ht)&&1!==ht&&(pt+=2),!!(4&ht)&&(pt+=2),2===ht&&(pt+=2);var _t=(nt[it+6]<<8|nt[it+7])>>12-pt&1,Et=[2,1,2,3,3,4,4,5][ht]+_t;(rt=new me).sampling_frequency=st,rt.channel_count=Et,rt.channel_mode=ht,rt.bit_stream_identification=ct,rt.low_frequency_effects_channel_on=_t,rt.bit_stream_mode=dt,rt.frame_size_code=ot,rt.data=nt.subarray(it,it+lt)}return rt},e.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},e.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},e}(),ye=function(nt){var rt;rt=[nt.sampling_rate_code<<6|nt.bit_stream_identification<<1|nt.bit_stream_mode>>2,(3&nt.bit_stream_mode)<<6|nt.channel_mode<<3|nt.low_frequency_effects_channel_on<<2|nt.frame_size_code>>4,nt.frame_size_code<<4&224],this.config=rt,this.sampling_rate=nt.sampling_frequency,this.bit_stream_identification=nt.bit_stream_identification,this.bit_stream_mode=nt.bit_stream_mode,this.low_frequency_effects_channel_on=nt.low_frequency_effects_channel_on,this.channel_count=nt.channel_count,this.channel_mode=nt.channel_mode,this.codec_mimetype="ac-3",this.original_codec_mimetype="ac-3"},Se=function(){},fn=function(){function e(nt){this.TAG="EAC3Parser",this.data_=nt,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&ot.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return e.prototype.findNextSyncwordOffset=function(nt){for(var rt=nt,it=this.data_;;){if(rt+7>=it.byteLength)return this.eof_flag_=!0,it.byteLength;if(2935==(it[rt+0]<<8|it[rt+1]))return rt;rt++}},e.prototype.readNextEAC3Frame=function(){for(var nt=this.data_,rt=null;null==rt&&!this.eof_flag_;){var it=this.current_syncword_offset_,at=new _t(nt.subarray(it+2)),st=(at.readBits(2),at.readBits(3),at.readBits(11)+1<<1),ot=at.readBits(2),lt=null,ut=null;3===ot?(lt=[24e3,22060,16e3][ot=at.readBits(2)],ut=3):(lt=[48e3,44100,32e3][ot],ut=at.readBits(2));var ct=at.readBits(3),dt=at.readBits(1),ht=at.readBits(5);if(it+st>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var pt=this.findNextSyncwordOffset(it+st);this.current_syncword_offset_=pt;var Et=[2,1,2,3,3,4,4,5][ct]+dt;at.destroy(),(rt=new Se).sampling_frequency=lt,rt.channel_count=Et,rt.channel_mode=ct,rt.bit_stream_identification=ht,rt.low_frequency_effects_channel_on=dt,rt.frame_size=st,rt.num_blks=[1,2,3,6][ut],rt.data=nt.subarray(it,it+st)}return rt},e.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},e.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},e}(),Ae=function(nt){var rt,it=Math.floor(nt.frame_size*nt.sampling_frequency/(16*nt.num_blks));rt=[255&it,248&it,nt.sampling_rate_code<<6|nt.bit_stream_identification<<1,nt.channel_mode<<1|nt.low_frequency_effects_channel_on,0],this.config=rt,this.sampling_rate=nt.sampling_frequency,this.bit_stream_identification=nt.bit_stream_identification,this.num_blks=nt.num_blks,this.low_frequency_effects_channel_on=nt.low_frequency_effects_channel_on,this.channel_count=nt.channel_count,this.channel_mode=nt.channel_mode,this.codec_mimetype="ec-3",this.original_codec_mimetype="ec-3"},Ee=function(){},pn=function(){function e(nt){this.TAG="AV1OBUInMpegTsParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=nt,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&ot.a.e(this.TAG,"Could not find AV1 startcode until payload end!")}return e._ebsp2rbsp=function(nt){for(var rt=nt,it=rt.byteLength,at=new Uint8Array(it),st=0,ot=0;ot<it;ot++)ot>=2&&3===rt[ot]&&0===rt[ot-1]&&0===rt[ot-2]||(at[st]=rt[ot],st++);return new Uint8Array(at.buffer,0,st)},e.prototype.findNextStartCodeOffset=function(nt){for(var rt=nt,it=this.data_;;){if(rt+2>=it.byteLength)return this.eof_flag_=!0,it.byteLength;if(1==(it[rt+0]<<16|it[rt+1]<<8|it[rt+2]))return rt;rt++}},e.prototype.readNextOBUPayload=function(){for(var nt=this.data_,rt=null;null==rt&&!this.eof_flag_;){var it=this.current_startcode_offset_+3,at=this.findNextStartCodeOffset(it);this.current_startcode_offset_=at,rt=e._ebsp2rbsp(nt.subarray(it,at))}return rt},e}(),mn=function(){var e=function(nt,rt){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(nt,rt){nt.__proto__=rt}||function(nt,rt){for(var it in rt)Object.prototype.hasOwnProperty.call(rt,it)&&(nt[it]=rt[it])})(nt,rt)};return function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Class extends value "+String(rt)+" is not a constructor or null");function n(){this.constructor=nt}e(nt,rt),nt.prototype=null===rt?Object.create(rt):(n.prototype=rt.prototype,new n)}}(),Le=function(){return(Le=Object.assign||function(nt){for(var rt,it=1,at=arguments.length;it<at;it++)for(var st in rt=arguments[it])Object.prototype.hasOwnProperty.call(rt,st)&&(nt[st]=rt[st]);return nt}).apply(this,arguments)},gn=function(nt){function t(rt,it){var at=nt.call(this)||this;return at.TAG="TSDemuxer",at.first_parse_=!0,at.media_info_=new ut.a,at.timescale_=90,at.duration_=0,at.current_pmt_pid_=-1,at.program_pmt_map_={},at.pes_slice_queues_={},at.section_slice_queues_={},at.video_metadata_={vps:void 0,sps:void 0,pps:void 0,av1c:void 0,details:void 0},at.audio_metadata_={codec:void 0,audio_object_type:void 0,sampling_freq_index:void 0,sampling_frequency:void 0,channel_config:void 0},at.last_pcr_base_=NaN,at.timestamp_offset_=0,at.audio_last_sample_pts_=void 0,at.aac_last_incomplete_data_=null,at.has_video_=!1,at.has_audio_=!1,at.video_init_segment_dispatched_=!1,at.audio_init_segment_dispatched_=!1,at.video_metadata_changed_=!1,at.audio_metadata_changed_=!1,at.loas_previous_frame=null,at.video_track_={type:"video",id:1,sequenceNumber:0,samples:[],length:0},at.audio_track_={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},at.ts_packet_size_=rt.ts_packet_size,at.sync_offset_=rt.sync_offset,at.config_=it,at}return mn(t,nt),t.prototype.destroy=function(){this.media_info_=null,this.pes_slice_queues_=null,this.section_slice_queues_=null,this.video_metadata_=null,this.audio_metadata_=null,this.aac_last_incomplete_data_=null,this.video_track_=null,this.audio_track_=null,nt.prototype.destroy.call(this)},t.probe=function(nt){var rt=new Uint8Array(nt),it=-1,at=188;if(rt.byteLength<=3*at)return{needMoreData:!0};for(;-1===it;){for(var st=Math.min(1e3,rt.byteLength-3*at),lt=0;lt<st;){if(71===rt[lt]&&71===rt[lt+at]&&71===rt[lt+2*at]){it=lt;break}lt++}if(-1===it)if(188===at)at=192;else{if(192!==at)break;at=204}}return-1===it?{match:!1}:(192===at&&it>=4?(ot.a.v("TSDemuxer","ts_packet_size = 192, m2ts mode"),it-=4):204===at&&ot.a.v("TSDemuxer","ts_packet_size = 204, RS encoded MPEG2-TS stream"),{match:!0,consumed:0,ts_packet_size:at,sync_offset:it})},t.prototype.bindDataSource=function(nt){return nt.onDataArrival=this.parseChunks.bind(this),this},t.prototype.resetMediaInfo=function(){this.media_info_=new ut.a},t.prototype.parseChunks=function(nt,rt){if(!(this.onError&&this.onMediaInfo&&this.onTrackMetadata&&this.onDataAvailable))throw new dt.a("onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var it=0;for(this.first_parse_&&(this.first_parse_=!1,it=this.sync_offset_);it+this.ts_packet_size_<=nt.byteLength;){var at=rt+it;192===this.ts_packet_size_&&(it+=4);var st=new Uint8Array(nt,it,188),lt=st[0];if(71!==lt){ot.a.e(this.TAG,"sync_byte = ".concat(lt,", not 0x47"));break}var ut=(64&st[1])>>>6,ct=(st[1],(31&st[1])<<8|st[2]),ht=(48&st[3])>>>4,pt=15&st[3],_t=!(!this.pmt_||this.pmt_.pcr_pid!==ct),Et={},St=4;if(2==ht||3==ht){var wt=st[4];if(wt>0&&(_t||3==ht)&&(Et.discontinuity_indicator=(128&st[5])>>>7,Et.random_access_indicator=(64&st[5])>>>6,Et.elementary_stream_priority_indicator=(32&st[5])>>>5,(16&st[5])>>>4)){var Ct=300*this.getPcrBase(st)+((1&st[10])<<8|st[11]);this.last_pcr_=Ct}if(2==ht||5+wt===188){it+=188,204===this.ts_packet_size_&&(it+=16);continue}St=5+wt}if(1==ht||3==ht)if(0===ct||ct===this.current_pmt_pid_||null!=this.pmt_&&this.pmt_.pid_stream_type[ct]===Lt.kSCTE35){var Pt=188-St;this.handleSectionSlice(nt,it+St,Pt,{pid:ct,file_position:at,payload_unit_start_indicator:ut,continuity_conunter:pt,random_access_indicator:Et.random_access_indicator})}else if(null!=this.pmt_&&null!=this.pmt_.pid_stream_type[ct]){Pt=188-St;var kt=this.pmt_.pid_stream_type[ct];ct!==this.pmt_.common_pids.h264&&ct!==this.pmt_.common_pids.h265&&ct!==this.pmt_.common_pids.av1&&ct!==this.pmt_.common_pids.adts_aac&&ct!==this.pmt_.common_pids.loas_aac&&ct!==this.pmt_.common_pids.ac3&&ct!==this.pmt_.common_pids.eac3&&ct!==this.pmt_.common_pids.opus&&ct!==this.pmt_.common_pids.mp3&&!0!==this.pmt_.pes_private_data_pids[ct]&&!0!==this.pmt_.timed_id3_pids[ct]&&!0!==this.pmt_.synchronous_klv_pids[ct]&&!0!==this.pmt_.asynchronous_klv_pids[ct]||this.handlePESSlice(nt,it+St,Pt,{pid:ct,stream_type:kt,file_position:at,payload_unit_start_indicator:ut,continuity_conunter:pt,random_access_indicator:Et.random_access_indicator})}it+=188,204===this.ts_packet_size_&&(it+=16)}return this.dispatchAudioVideoMediaSegment(),it},t.prototype.handleSectionSlice=function(nt,rt,it,at){var st=new Uint8Array(nt,rt,it),ot=this.section_slice_queues_[at.pid];if(at.payload_unit_start_indicator){var lt=st[0];if(null!=ot&&0!==ot.total_length){var ut=new Uint8Array(nt,rt+1,Math.min(it,lt));ot.slices.push(ut),ot.total_length+=ut.byteLength,ot.total_length===ot.expected_length?this.emitSectionSlices(ot,at):this.clearSlices(ot,at)}for(var ct=1+lt;ct<st.byteLength&&255!==st[ct+0];){var dt=(15&st[ct+1])<<8|st[ct+2];this.section_slice_queues_[at.pid]=new O,(ot=this.section_slice_queues_[at.pid]).expected_length=dt+3,ot.file_position=at.file_position,ot.random_access_indicator=at.random_access_indicator,ut=new Uint8Array(nt,rt+ct,Math.min(it-ct,ot.expected_length-ot.total_length)),ot.slices.push(ut),ot.total_length+=ut.byteLength,ot.total_length===ot.expected_length?this.emitSectionSlices(ot,at):ot.total_length>=ot.expected_length&&this.clearSlices(ot,at),ct+=ut.byteLength}}else null!=ot&&0!==ot.total_length&&(ut=new Uint8Array(nt,rt,Math.min(it,ot.expected_length-ot.total_length)),ot.slices.push(ut),ot.total_length+=ut.byteLength,ot.total_length===ot.expected_length?this.emitSectionSlices(ot,at):ot.total_length>=ot.expected_length&&this.clearSlices(ot,at))},t.prototype.handlePESSlice=function(nt,rt,it,at){var st=new Uint8Array(nt,rt,it),lt=st[0]<<16|st[1]<<8|st[2],ut=(st[3],st[4]<<8|st[5]);if(at.payload_unit_start_indicator){if(1!==lt)return void ot.a.e(this.TAG,"handlePESSlice: packet_start_code_prefix should be 1 but with value ".concat(lt));var ct=this.pes_slice_queues_[at.pid];ct&&(0===ct.expected_length||ct.expected_length===ct.total_length?this.emitPESSlices(ct,at):this.clearSlices(ct,at)),this.pes_slice_queues_[at.pid]=new O,this.pes_slice_queues_[at.pid].file_position=at.file_position,this.pes_slice_queues_[at.pid].random_access_indicator=at.random_access_indicator}if(null!=this.pes_slice_queues_[at.pid]){var dt=this.pes_slice_queues_[at.pid];dt.slices.push(st),at.payload_unit_start_indicator&&(dt.expected_length=0===ut?0:ut+6),dt.total_length+=st.byteLength,dt.expected_length>0&&dt.expected_length===dt.total_length?this.emitPESSlices(dt,at):dt.expected_length>0&&dt.expected_length<dt.total_length&&this.clearSlices(dt,at)}},t.prototype.emitSectionSlices=function(nt,rt){for(var it=new Uint8Array(nt.total_length),at=0,st=0;at<nt.slices.length;at++){var ot=nt.slices[at];it.set(ot,st),st+=ot.byteLength}nt.slices=[],nt.expected_length=-1,nt.total_length=0;var lt=new D;lt.pid=rt.pid,lt.data=it,lt.file_position=nt.file_position,lt.random_access_indicator=nt.random_access_indicator,this.parseSection(lt)},t.prototype.emitPESSlices=function(nt,rt){for(var it=new Uint8Array(nt.total_length),at=0,st=0;at<nt.slices.length;at++){var ot=nt.slices[at];it.set(ot,st),st+=ot.byteLength}nt.slices=[],nt.expected_length=-1,nt.total_length=0;var lt=new C;lt.pid=rt.pid,lt.data=it,lt.stream_type=rt.stream_type,lt.file_position=nt.file_position,lt.random_access_indicator=nt.random_access_indicator,this.parsePES(lt)},t.prototype.clearSlices=function(nt,rt){nt.slices=[],nt.expected_length=-1,nt.total_length=0},t.prototype.parseSection=function(nt){var rt=nt.data,it=nt.pid;0===it?this.parsePAT(rt):it===this.current_pmt_pid_?this.parsePMT(rt):null!=this.pmt_&&this.pmt_.scte_35_pids[it]&&this.parseSCTE35(rt)},t.prototype.parsePES=function(nt){var rt=nt.data,it=rt[0]<<16|rt[1]<<8|rt[2],at=rt[3],st=rt[4]<<8|rt[5];if(1===it)if(188!==at&&190!==at&&191!==at&&240!==at&&241!==at&&255!==at&&242!==at&&248!==at){rt[6];var lt=(192&rt[7])>>>6,ut=rt[8],ct=void 0,dt=void 0;2!==lt&&3!==lt||(ct=this.getTimestamp(rt,9),dt=3===lt?this.getTimestamp(rt,14):ct);var ht=9+ut,pt=void 0;if(0!==st){if(st<3+ut)return void ot.a.v(this.TAG,"Malformed PES: PES_packet_length < 3 + PES_header_data_length");pt=st-3-ut}else pt=rt.byteLength-ht;var _t=rt.subarray(ht,ht+pt);switch(nt.stream_type){case Lt.kMPEG1Audio:case Lt.kMPEG2Audio:this.parseMP3Payload(_t,ct);break;case Lt.kPESPrivateData:this.pmt_.common_pids.av1===nt.pid?this.parseAV1Payload(_t,ct,dt,nt.file_position,nt.random_access_indicator):this.pmt_.common_pids.opus===nt.pid?this.parseOpusPayload(_t,ct):this.pmt_.common_pids.ac3===nt.pid?this.parseAC3Payload(_t,ct):this.pmt_.common_pids.eac3===nt.pid?this.parseEAC3Payload(_t,ct):this.pmt_.asynchronous_klv_pids[nt.pid]?this.parseAsynchronousKLVMetadataPayload(_t,nt.pid,at):this.pmt_.smpte2038_pids[nt.pid]?this.parseSMPTE2038MetadataPayload(_t,ct,dt,nt.pid,at):this.parsePESPrivateDataPayload(_t,ct,dt,nt.pid,at);break;case Lt.kADTSAAC:this.parseADTSAACPayload(_t,ct);break;case Lt.kLOASAAC:this.parseLOASAACPayload(_t,ct);break;case Lt.kAC3:this.parseAC3Payload(_t,ct);break;case Lt.kEAC3:this.parseEAC3Payload(_t,ct);break;case Lt.kMetadata:this.pmt_.timed_id3_pids[nt.pid]?this.parseTimedID3MetadataPayload(_t,ct,dt,nt.pid,at):this.pmt_.synchronous_klv_pids[nt.pid]&&this.parseSynchronousKLVMetadataPayload(_t,ct,dt,nt.pid,at);break;case Lt.kH264:this.parseH264Payload(_t,ct,dt,nt.file_position,nt.random_access_indicator);break;case Lt.kH265:this.parseH265Payload(_t,ct,dt,nt.file_position,nt.random_access_indicator)}}else 188!==at&&191!==at&&240!==at&&241!==at&&255!==at&&242!==at&&248!==at||nt.stream_type!==Lt.kPESPrivateData||(ht=6,pt=void 0,pt=0!==st?st:rt.byteLength-ht,_t=rt.subarray(ht,ht+pt),this.parsePESPrivateDataPayload(_t,void 0,void 0,nt.pid,at));else ot.a.e(this.TAG,"parsePES: packet_start_code_prefix should be 1 but with value ".concat(it))},t.prototype.parsePAT=function(nt){var rt=nt[0];if(0===rt){var it=(15&nt[1])<<8|nt[2],at=(nt[3],nt[4],(62&nt[5])>>>1),st=1&nt[5],lt=nt[6],ut=(nt[7],null);if(1===st&&0===lt)(ut=new k).version_number=at;else if(null==(ut=this.pat_))return;for(var ct=it-5-4,dt=-1,ht=-1,pt=8;pt<8+ct;pt+=4){var _t=nt[pt]<<8|nt[pt+1],Et=(31&nt[pt+2])<<8|nt[pt+3];0===_t?ut.network_pid=Et:(ut.program_pmt_pid[_t]=Et,-1===dt&&(dt=_t),-1===ht&&(ht=Et))}1===st&&0===lt&&(null==this.pat_&&ot.a.v(this.TAG,"Parsed first PAT: ".concat(JSON.stringify(ut))),this.pat_=ut,this.current_program_=dt,this.current_pmt_pid_=ht)}else ot.a.e(this.TAG,"parsePAT: table_id ".concat(rt," is not corresponded to PAT!"))},t.prototype.parsePMT=function(nt){var rt=nt[0];if(2===rt){var it=(15&nt[1])<<8|nt[2],at=nt[3]<<8|nt[4],st=(62&nt[5])>>>1,lt=1&nt[5],ut=nt[6],ct=(nt[7],null);if(1===lt&&0===ut)(ct=new M).program_number=at,ct.version_number=st,this.program_pmt_map_[at]=ct;else if(null==(ct=this.program_pmt_map_[at]))return;ct.pcr_pid=(31&nt[8])<<8|nt[9];for(var dt=(15&nt[10])<<8|nt[11],ht=12+dt,pt=it-9-dt-4,_t=ht;_t<ht+pt;){var Et=nt[_t],St=(31&nt[_t+1])<<8|nt[_t+2],wt=(15&nt[_t+3])<<8|nt[_t+4];ct.pid_stream_type[St]=Et;var Ct=ct.common_pids.h264||ct.common_pids.h265,Pt=ct.common_pids.adts_aac||ct.common_pids.loas_aac||ct.common_pids.ac3||ct.common_pids.eac3||ct.common_pids.opus||ct.common_pids.mp3;if(Et!==Lt.kH264||Ct)if(Et!==Lt.kH265||Ct)if(Et!==Lt.kADTSAAC||Pt)if(Et!==Lt.kLOASAAC||Pt)if(Et!==Lt.kAC3||Pt)if(Et!==Lt.kEAC3||Pt)if(Et!==Lt.kMPEG1Audio&&Et!==Lt.kMPEG2Audio||Pt)if(Et===Lt.kPESPrivateData){if(ct.pes_private_data_pids[St]=!0,wt>0){for(var kt=_t+5;kt<_t+5+wt;){var Ot=nt[kt+0],Ft=nt[kt+1];if(5===Ot){var Bt=String.fromCharCode.apply(String,Array.from(nt.subarray(kt+2,kt+2+Ft)));"VANC"===Bt?ct.smpte2038_pids[St]=!0:"AV01"===Bt?ct.common_pids.av1=St:"Opus"===Bt?ct.common_pids.opus=St:"KLVA"===Bt&&(ct.asynchronous_klv_pids[St]=!0)}else if(127===Ot){if(St===ct.common_pids.opus){var Ut=null;if(128===nt[kt+2]&&(Ut=nt[kt+3]),null==Ut){ot.a.e(this.TAG,"Not Supported Opus channel count.");continue}var Gt={codec:"opus",channel_count:15&Ut?15&Ut:2,channel_config_code:Ut,sample_rate:48e3},Ht={codec:"opus",meta:Gt};0==this.audio_init_segment_dispatched_?(this.audio_metadata_=Gt,this.dispatchAudioInitSegment(Ht)):this.detectAudioMetadataChange(Ht)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(Ht))}}else 128===Ot&&St===ct.common_pids.av1&&(this.video_metadata_.av1c=nt.subarray(kt+2,kt+2+Ft));kt+=2+Ft}var jt=nt.subarray(_t+5,_t+5+wt);this.dispatchPESPrivateDataDescriptor(St,Et,jt)}}else if(Et===Lt.kMetadata){if(wt>0)for(kt=_t+5;kt<_t+5+wt;){Ot=nt[kt+0];var Kt=nt[kt+1];if(38===Ot){var $t=nt[kt+2]<<8|nt[kt+3],Yt=null;65535===$t&&(Yt=String.fromCharCode.apply(String,Array.from(nt.subarray(kt+4,kt+4+4))));var Wt=null;if(255===nt[kt+4+(65535===$t?4:0)]){var Qt=4+(65535===$t?4:0)+1;Wt=String.fromCharCode.apply(String,Array.from(nt.subarray(kt+Qt,kt+Qt+4)))}"ID3 "===Yt&&"ID3 "===Wt?ct.timed_id3_pids[St]=!0:"KLVA"===Wt&&(ct.synchronous_klv_pids[St]=!0)}kt+=2+Kt}}else Et===Lt.kSCTE35&&(ct.scte_35_pids[St]=!0);else ct.common_pids.mp3=St;else ct.common_pids.eac3=St;else ct.common_pids.ac3=St;else ct.common_pids.loas_aac=St;else ct.common_pids.adts_aac=St;else ct.common_pids.h265=St;else ct.common_pids.h264=St;_t+=5+wt}at===this.current_program_&&(null==this.pmt_&&ot.a.v(this.TAG,"Parsed first PMT: ".concat(JSON.stringify(ct))),this.pmt_=ct,(ct.common_pids.h264||ct.common_pids.h265||ct.common_pids.av1)&&(this.has_video_=!0),(ct.common_pids.adts_aac||ct.common_pids.loas_aac||ct.common_pids.ac3||ct.common_pids.opus||ct.common_pids.mp3)&&(this.has_audio_=!0))}else ot.a.e(this.TAG,"parsePMT: table_id ".concat(rt," is not corresponded to PMT!"))},t.prototype.parseSCTE35=function(nt){var rt=_e(nt);if(null!=rt.pts){var it=Math.floor(rt.pts/this.timescale_);rt.pts=it}else rt.nearest_pts=this.getNearestTimestampMilliseconds();this.onSCTE35Metadata&&this.onSCTE35Metadata(rt)},t.prototype.parseAV1Payload=function(nt,rt,it,at,st){for(var ot=new pn(nt),lt=null,ut=[],ct=0,dt=!1,ht=null;null!=(lt=ot.readNextOBUPayload());){if((ht=Ct.parseOBUs(lt,this.video_metadata_.details))&&!0===ht.keyframe)if(this.video_init_segment_dispatched_){var pt;!0===this.detectVideoMetadataChange(null,ht)&&(this.video_metadata_changed_=!0,this.dispatchVideoMediaSegment(),(pt=new Uint8Array(new ArrayBuffer(this.video_metadata_.av1c.byteLength+ht.sequence_header_data.byteLength))).set(this.video_metadata_.av1c,0),pt.set(ht.sequence_header_data,this.video_metadata_.av1c.byteLength),ht.av1c=pt,this.dispatchVideoInitSegment())}else(pt=new Uint8Array(new ArrayBuffer(this.video_metadata_.av1c.byteLength+ht.sequence_header_data.byteLength))).set(this.video_metadata_.av1c,0),pt.set(ht.sequence_header_data,this.video_metadata_.av1c.byteLength),ht.av1c=pt,this.video_metadata_.details=ht,this.dispatchVideoInitSegment();this.video_metadata_.details=ht,dt||(dt=ht.keyframe),ut.push({data:lt}),ct+=lt.byteLength}var _t=Math.floor(rt/this.timescale_),Et=Math.floor(it/this.timescale_);if(ut.length){var St=this.video_track_,wt={units:ut,length:ct,isKeyframe:dt,dts:Et,pts:_t,cts:_t-Et,file_position:at};St.samples.push(wt),St.length+=ct}},t.prototype.parseH264Payload=function(nt,rt,it,at,st){for(var lt=new Ut(nt),ut=null,ct=[],dt=0,ht=!1;null!=(ut=lt.readNextNaluPayload());){var pt=new x(ut);if(pt.type===Ot.kSliceSPS){var _t=Et.parseSPS(ut.data);this.video_init_segment_dispatched_?!0===this.detectVideoMetadataChange(pt,_t)&&(ot.a.v(this.TAG,"H264: Critical h264 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:pt,pps:void 0,av1c:void 0,details:_t}):(this.video_metadata_.sps=pt,this.video_metadata_.details=_t)}else pt.type===Ot.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(this.video_metadata_.pps=pt,this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):(pt.type===Ot.kSliceIDR||pt.type===Ot.kSliceNonIDR&&1===st)&&(ht=!0);this.video_init_segment_dispatched_&&(ct.push(pt),dt+=pt.data.byteLength)}var St=Math.floor(rt/this.timescale_),wt=Math.floor(it/this.timescale_);if(ct.length){var Lt=this.video_track_,Ct={units:ct,length:dt,isKeyframe:ht,dts:wt,pts:St,cts:St-wt,file_position:at};Lt.samples.push(Ct),Lt.length+=dt}},t.prototype.parseH265Payload=function(nt,rt,it,at,st){for(var lt=new nn(nt),ut=null,ct=[],dt=0,ht=!1;null!=(ut=lt.readNextNaluPayload());){var pt=new he(ut);if(pt.type===en.kSliceVPS){if(!this.video_init_segment_dispatched_){var _t=wt.parseVPS(ut.data);this.video_metadata_.vps=pt,this.video_metadata_.details=Le(Le({},this.video_metadata_.details),_t)}}else pt.type===en.kSliceSPS?(_t=wt.parseSPS(ut.data),this.video_init_segment_dispatched_?!0===this.detectVideoMetadataChange(pt,_t)&&(ot.a.v(this.TAG,"H265: Critical h265 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:pt,pps:void 0,av1c:void 0,details:_t}):(this.video_metadata_.sps=pt,this.video_metadata_.details=Le(Le({},this.video_metadata_.details),_t))):pt.type===en.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(_t=wt.parsePPS(ut.data),this.video_metadata_.pps=pt,this.video_metadata_.details=Le(Le({},this.video_metadata_.details),_t),this.video_metadata_.vps&&this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):pt.type!==en.kSliceIDR_W_RADL&&pt.type!==en.kSliceIDR_N_LP&&pt.type!==en.kSliceCRA_NUT||(ht=!0);this.video_init_segment_dispatched_&&(ct.push(pt),dt+=pt.data.byteLength)}var Et=Math.floor(rt/this.timescale_),St=Math.floor(it/this.timescale_);if(ct.length){var Lt=this.video_track_,Ct={units:ct,length:dt,isKeyframe:ht,dts:St,pts:Et,cts:Et-St,file_position:at};Lt.samples.push(Ct),Lt.length+=dt}},t.prototype.detectVideoMetadataChange=function(nt,rt){if(rt.codec_mimetype!==this.video_metadata_.details.codec_mimetype)return ot.a.v(this.TAG,"Video: Codec mimeType changed from "+"".concat(this.video_metadata_.details.codec_mimetype," to ").concat(rt.codec_mimetype)),!0;if(rt.codec_size.width!==this.video_metadata_.details.codec_size.width||rt.codec_size.height!==this.video_metadata_.details.codec_size.height){var it=this.video_metadata_.details.codec_size,at=rt.codec_size;return ot.a.v(this.TAG,"Video: Coded Resolution changed from "+"".concat(it.width,"x").concat(it.height," to ").concat(at.width,"x").concat(at.height)),!0}return rt.present_size.width!==this.video_metadata_.details.present_size.width&&(ot.a.v(this.TAG,"Video: Present resolution width changed from "+"".concat(this.video_metadata_.details.present_size.width," to ").concat(rt.present_size.width)),!0)},t.prototype.isInitSegmentDispatched=function(){return this.has_video_&&this.has_audio_?this.video_init_segment_dispatched_&&this.audio_init_segment_dispatched_:this.has_video_&&!this.has_audio_?this.video_init_segment_dispatched_:!(this.has_video_||!this.has_audio_)&&this.audio_init_segment_dispatched_},t.prototype.dispatchVideoInitSegment=function(){var nt=this.video_metadata_.details,rt={type:"video"};rt.id=this.video_track_.id,rt.timescale=1e3,rt.duration=this.duration_,rt.codecWidth=nt.codec_size.width,rt.codecHeight=nt.codec_size.height,rt.presentWidth=nt.present_size.width,rt.presentHeight=nt.present_size.height,rt.profile=nt.profile_string,rt.level=nt.level_string,rt.bitDepth=nt.bit_depth,rt.chromaFormat=nt.chroma_format,rt.sarRatio=nt.sar_ratio,rt.frameRate=nt.frame_rate;var it=rt.frameRate.fps_den,at=rt.frameRate.fps_num;if(rt.refSampleDuration=it/at*1e3,rt.codec=nt.codec_mimetype,this.video_metadata_.av1c)rt.av1c=this.video_metadata_.av1c,0==this.video_init_segment_dispatched_&&ot.a.v(this.TAG,"Generated first AV1 for mimeType: ".concat(rt.codec));else if(this.video_metadata_.vps){var st=this.video_metadata_.vps.data.subarray(4),lt=this.video_metadata_.sps.data.subarray(4),ut=this.video_metadata_.pps.data.subarray(4),ct=new an(st,lt,ut,nt);rt.hvcc=ct.getData(),0==this.video_init_segment_dispatched_&&ot.a.v(this.TAG,"Generated first HEVCDecoderConfigurationRecord for mimeType: ".concat(rt.codec))}else{lt=this.video_metadata_.sps.data.subarray(4),ut=this.video_metadata_.pps.data.subarray(4);var dt=new Gt(lt,ut,nt);rt.avcc=dt.getData(),0==this.video_init_segment_dispatched_&&ot.a.v(this.TAG,"Generated first AVCDecoderConfigurationRecord for mimeType: ".concat(rt.codec))}this.onTrackMetadata("video",rt),this.video_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var ht=this.media_info_;ht.hasVideo=!0,ht.width=rt.codecWidth,ht.height=rt.codecHeight,ht.fps=rt.frameRate.fps,ht.profile=rt.profile,ht.level=rt.level,ht.refFrames=nt.ref_frames,ht.chromaFormat=nt.chroma_format_string,ht.sarNum=rt.sarRatio.width,ht.sarDen=rt.sarRatio.height,ht.videoCodec=rt.codec,ht.hasAudio&&ht.audioCodec?ht.mimeType='video/mp2t; codecs="'.concat(ht.videoCodec,",").concat(ht.audioCodec,'"'):ht.mimeType='video/mp2t; codecs="'.concat(ht.videoCodec,'"'),ht.isComplete()&&this.onMediaInfo(ht)},t.prototype.dispatchVideoMediaSegment=function(){this.isInitSegmentDispatched()&&this.video_track_.length&&this.onDataAvailable(null,this.video_track_)},t.prototype.dispatchAudioMediaSegment=function(){this.isInitSegmentDispatched()&&this.audio_track_.length&&this.onDataAvailable(this.audio_track_,null)},t.prototype.dispatchAudioVideoMediaSegment=function(){this.isInitSegmentDispatched()&&(this.audio_track_.length||this.video_track_.length)&&this.onDataAvailable(this.audio_track_,this.video_track_)},t.prototype.parseADTSAACPayload=function(nt,rt){if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var it=new Uint8Array(nt.byteLength+this.aac_last_incomplete_data_.byteLength);it.set(this.aac_last_incomplete_data_,0),it.set(nt,this.aac_last_incomplete_data_.byteLength),nt=it}var at,st;if(null!=rt&&(st=rt/this.timescale_),"aac"===this.audio_metadata_.codec){if(null==rt&&null!=this.audio_last_sample_pts_)at=1024/this.audio_metadata_.sampling_frequency*1e3,st=this.audio_last_sample_pts_+at;else if(null==rt)return void ot.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.audio_last_sample_pts_){at=1024/this.audio_metadata_.sampling_frequency*1e3;var lt=this.audio_last_sample_pts_+at;Math.abs(lt-st)>1&&(ot.a.w(this.TAG,"AAC: Detected pts overlapped, "+"expected: ".concat(lt,"ms, PES pts: ").concat(st,"ms")),st=lt)}}for(var ut,ct=new Wt(nt),dt=null,ht=st;null!=(dt=ct.readNextAACFrame());){at=1024/dt.sampling_frequency*1e3;var pt={codec:"aac",data:dt};0==this.audio_init_segment_dispatched_?(this.audio_metadata_={codec:"aac",audio_object_type:dt.audio_object_type,sampling_freq_index:dt.sampling_freq_index,sampling_frequency:dt.sampling_frequency,channel_config:dt.channel_config},this.dispatchAudioInitSegment(pt)):this.detectAudioMetadataChange(pt)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(pt)),ut=ht;var _t=Math.floor(ht),Et={unit:dt.data,length:dt.data.byteLength,pts:_t,dts:_t};this.audio_track_.samples.push(Et),this.audio_track_.length+=dt.data.byteLength,ht+=at}ct.hasIncompleteData()&&(this.aac_last_incomplete_data_=ct.getIncompleteData()),ut&&(this.audio_last_sample_pts_=ut)}},t.prototype.parseLOASAACPayload=function(nt,rt){var it;if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var at=new Uint8Array(nt.byteLength+this.aac_last_incomplete_data_.byteLength);at.set(this.aac_last_incomplete_data_,0),at.set(nt,this.aac_last_incomplete_data_.byteLength),nt=at}var st,lt;if(null!=rt&&(lt=rt/this.timescale_),"aac"===this.audio_metadata_.codec){if(null==rt&&null!=this.audio_last_sample_pts_)st=1024/this.audio_metadata_.sampling_frequency*1e3,lt=this.audio_last_sample_pts_+st;else if(null==rt)return void ot.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.audio_last_sample_pts_){st=1024/this.audio_metadata_.sampling_frequency*1e3;var ut=this.audio_last_sample_pts_+st;Math.abs(ut-lt)>1&&(ot.a.w(this.TAG,"AAC: Detected pts overlapped, "+"expected: ".concat(ut,"ms, PES pts: ").concat(lt,"ms")),lt=ut)}}for(var ct,dt=new Qt(nt),ht=null,pt=lt;null!=(ht=dt.readNextAACFrame(null!==(it=this.loas_previous_frame)&&void 0!==it?it:void 0));){this.loas_previous_frame=ht,st=1024/ht.sampling_frequency*1e3;var _t={codec:"aac",data:ht};0==this.audio_init_segment_dispatched_?(this.audio_metadata_={codec:"aac",audio_object_type:ht.audio_object_type,sampling_freq_index:ht.sampling_freq_index,sampling_frequency:ht.sampling_frequency,channel_config:ht.channel_config},this.dispatchAudioInitSegment(_t)):this.detectAudioMetadataChange(_t)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(_t)),ct=pt;var Et=Math.floor(pt),St={unit:ht.data,length:ht.data.byteLength,pts:Et,dts:Et};this.audio_track_.samples.push(St),this.audio_track_.length+=ht.data.byteLength,pt+=st}dt.hasIncompleteData()&&(this.aac_last_incomplete_data_=dt.getIncompleteData()),ct&&(this.audio_last_sample_pts_=ct)}},t.prototype.parseAC3Payload=function(nt,rt){if(!this.has_video_||this.video_init_segment_dispatched_){var it,at;if(null!=rt&&(at=rt/this.timescale_),"ac-3"===this.audio_metadata_.codec)if(null==rt&&null!=this.audio_last_sample_pts_)it=1536/this.audio_metadata_.sampling_frequency*1e3,at=this.audio_last_sample_pts_+it;else if(null==rt)return void ot.a.w(this.TAG,"AC3: Unknown pts");for(var st,lt=new hn(nt),ut=null,ct=at;null!=(ut=lt.readNextAC3Frame());){it=1536/ut.sampling_frequency*1e3;var dt={codec:"ac-3",data:ut};0==this.audio_init_segment_dispatched_?(this.audio_metadata_={codec:"ac-3",sampling_frequency:ut.sampling_frequency,bit_stream_identification:ut.bit_stream_identification,bit_stream_mode:ut.bit_stream_mode,low_frequency_effects_channel_on:ut.low_frequency_effects_channel_on,channel_mode:ut.channel_mode},this.dispatchAudioInitSegment(dt)):this.detectAudioMetadataChange(dt)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(dt)),st=ct;var ht=Math.floor(ct),pt={unit:ut.data,length:ut.data.byteLength,pts:ht,dts:ht};this.audio_track_.samples.push(pt),this.audio_track_.length+=ut.data.byteLength,ct+=it}st&&(this.audio_last_sample_pts_=st)}},t.prototype.parseEAC3Payload=function(nt,rt){if(!this.has_video_||this.video_init_segment_dispatched_){var it,at;if(null!=rt&&(at=rt/this.timescale_),"ec-3"===this.audio_metadata_.codec)if(null==rt&&null!=this.audio_last_sample_pts_)it=256*this.audio_metadata_.num_blks/this.audio_metadata_.sampling_frequency*1e3,at=this.audio_last_sample_pts_+it;else if(null==rt)return void ot.a.w(this.TAG,"EAC3: Unknown pts");for(var st,lt=new fn(nt),ut=null,ct=at;null!=(ut=lt.readNextEAC3Frame());){it=1536/ut.sampling_frequency*1e3;var dt={codec:"ec-3",data:ut};0==this.audio_init_segment_dispatched_?(this.audio_metadata_={codec:"ec-3",sampling_frequency:ut.sampling_frequency,bit_stream_identification:ut.bit_stream_identification,low_frequency_effects_channel_on:ut.low_frequency_effects_channel_on,num_blks:ut.num_blks,channel_mode:ut.channel_mode},this.dispatchAudioInitSegment(dt)):this.detectAudioMetadataChange(dt)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(dt)),st=ct;var ht=Math.floor(ct),pt={unit:ut.data,length:ut.data.byteLength,pts:ht,dts:ht};this.audio_track_.samples.push(pt),this.audio_track_.length+=ut.data.byteLength,ct+=it}st&&(this.audio_last_sample_pts_=st)}},t.prototype.parseOpusPayload=function(nt,rt){if(!this.has_video_||this.video_init_segment_dispatched_){var it,at;if(null!=rt&&(at=rt/this.timescale_),"opus"===this.audio_metadata_.codec)if(null==rt&&null!=this.audio_last_sample_pts_)it=20,at=this.audio_last_sample_pts_+it;else if(null==rt)return void ot.a.w(this.TAG,"Opus: Unknown pts");for(var st,lt=at,ut=0;ut<nt.length;){it=20;for(var ct=!!(16&nt[ut+1]),dt=!!(8&nt[ut+1]),ht=ut+2,pt=0;255===nt[ht];)pt+=255,ht+=1;pt+=nt[ht],ht+=1,ht+=ct?2:0,ht+=dt?2:0,st=lt;var _t=Math.floor(lt),Et=nt.slice(ht,ht+pt),St={unit:Et,length:Et.byteLength,pts:_t,dts:_t};this.audio_track_.samples.push(St),this.audio_track_.length+=Et.byteLength,lt+=it,ut=ht+pt}st&&(this.audio_last_sample_pts_=st)}},t.prototype.parseMP3Payload=function(nt,rt){if(!this.has_video_||this.video_init_segment_dispatched_){var it=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],at=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],st=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],ot=nt[1]>>>3&3,lt=(6&nt[1])>>1,ut=(240&nt[2])>>>4,ct=(12&nt[2])>>>2,dt=3&~(nt[3]>>>6)?2:1,ht=0,pt=34;switch(ot){case 0:ht=[11025,12e3,8e3,0][ct];break;case 2:ht=[22050,24e3,16e3,0][ct];break;case 3:ht=[44100,48e3,32e3,0][ct]}switch(lt){case 1:pt=34,ut<st.length&&st[ut];break;case 2:pt=33,ut<at.length&&at[ut];break;case 3:pt=32,ut<it.length&&it[ut]}var _t=new pe;_t.object_type=pt,_t.sample_rate=ht,_t.channel_count=dt,_t.data=nt;var Et={codec:"mp3",data:_t};0==this.audio_init_segment_dispatched_?(this.audio_metadata_={codec:"mp3",object_type:pt,sample_rate:ht,channel_count:dt},this.dispatchAudioInitSegment(Et)):this.detectAudioMetadataChange(Et)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(Et));var St={unit:nt,length:nt.byteLength,pts:rt/this.timescale_,dts:rt/this.timescale_};this.audio_track_.samples.push(St),this.audio_track_.length+=nt.byteLength}},t.prototype.detectAudioMetadataChange=function(nt){if(nt.codec!==this.audio_metadata_.codec)return ot.a.v(this.TAG,"Audio: Audio Codecs changed from "+"".concat(this.audio_metadata_.codec," to ").concat(nt.codec)),!0;if("aac"===nt.codec&&"aac"===this.audio_metadata_.codec){if((rt=nt.data).audio_object_type!==this.audio_metadata_.audio_object_type)return ot.a.v(this.TAG,"AAC: AudioObjectType changed from "+"".concat(this.audio_metadata_.audio_object_type," to ").concat(rt.audio_object_type)),!0;if(rt.sampling_freq_index!==this.audio_metadata_.sampling_freq_index)return ot.a.v(this.TAG,"AAC: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sampling_freq_index," to ").concat(rt.sampling_freq_index)),!0;if(rt.channel_config!==this.audio_metadata_.channel_config)return ot.a.v(this.TAG,"AAC: Channel configuration changed from "+"".concat(this.audio_metadata_.channel_config," to ").concat(rt.channel_config)),!0}else if("ac-3"===nt.codec&&"ac-3"===this.audio_metadata_.codec){var rt;if((rt=nt.data).sampling_frequency!==this.audio_metadata_.sampling_frequency)return ot.a.v(this.TAG,"AC3: Sampling Frequency changed from "+"".concat(this.audio_metadata_.sampling_frequency," to ").concat(rt.sampling_frequency)),!0;if(rt.bit_stream_identification!==this.audio_metadata_.bit_stream_identification)return ot.a.v(this.TAG,"AC3: Bit Stream Identification changed from "+"".concat(this.audio_metadata_.bit_stream_identification," to ").concat(rt.bit_stream_identification)),!0;if(rt.bit_stream_mode!==this.audio_metadata_.bit_stream_mode)return ot.a.v(this.TAG,"AC3: BitStream Mode changed from "+"".concat(this.audio_metadata_.bit_stream_mode," to ").concat(rt.bit_stream_mode)),!0;if(rt.channel_mode!==this.audio_metadata_.channel_mode)return ot.a.v(this.TAG,"AC3: Channel Mode changed from "+"".concat(this.audio_metadata_.channel_mode," to ").concat(rt.channel_mode)),!0;if(rt.low_frequency_effects_channel_on!==this.audio_metadata_.low_frequency_effects_channel_on)return ot.a.v(this.TAG,"AC3: Low Frequency Effects Channel On changed from "+"".concat(this.audio_metadata_.low_frequency_effects_channel_on," to ").concat(rt.low_frequency_effects_channel_on)),!0}else if("opus"===nt.codec&&"opus"===this.audio_metadata_.codec){if((it=nt.meta).sample_rate!==this.audio_metadata_.sample_rate)return ot.a.v(this.TAG,"Opus: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sample_rate," to ").concat(it.sample_rate)),!0;if(it.channel_count!==this.audio_metadata_.channel_count)return ot.a.v(this.TAG,"Opus: Channel count changed from "+"".concat(this.audio_metadata_.channel_count," to ").concat(it.channel_count)),!0}else if("mp3"===nt.codec&&"mp3"===this.audio_metadata_.codec){var it;if((it=nt.data).object_type!==this.audio_metadata_.object_type)return ot.a.v(this.TAG,"MP3: AudioObjectType changed from "+"".concat(this.audio_metadata_.object_type," to ").concat(it.object_type)),!0;if(it.sample_rate!==this.audio_metadata_.sample_rate)return ot.a.v(this.TAG,"MP3: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sample_rate," to ").concat(it.sample_rate)),!0;if(it.channel_count!==this.audio_metadata_.channel_count)return ot.a.v(this.TAG,"MP3: Channel count changed from "+"".concat(this.audio_metadata_.channel_count," to ").concat(it.channel_count)),!0}return!1},t.prototype.dispatchAudioInitSegment=function(nt){var rt={type:"audio"};if(rt.id=this.audio_track_.id,rt.timescale=1e3,rt.duration=this.duration_,"aac"===this.audio_metadata_.codec){var it="aac"===nt.codec?nt.data:null,at=new W(it);rt.audioSampleRate=at.sampling_rate,rt.channelCount=at.channel_count,rt.codec=at.codec_mimetype,rt.originalCodec=at.original_codec_mimetype,rt.config=at.config,rt.refSampleDuration=1024/rt.audioSampleRate*rt.timescale}else if("ac-3"===this.audio_metadata_.codec){var st="ac-3"===nt.codec?nt.data:null,lt=new ye(st);rt.audioSampleRate=lt.sampling_rate,rt.channelCount=lt.channel_count,rt.codec=lt.codec_mimetype,rt.originalCodec=lt.original_codec_mimetype,rt.config=lt.config,rt.refSampleDuration=1536/rt.audioSampleRate*rt.timescale}else if("ec-3"===this.audio_metadata_.codec){var ut="ec-3"===nt.codec?nt.data:null,ct=new Ae(ut);rt.audioSampleRate=ct.sampling_rate,rt.channelCount=ct.channel_count,rt.codec=ct.codec_mimetype,rt.originalCodec=ct.original_codec_mimetype,rt.config=ct.config,rt.refSampleDuration=256*ct.num_blks/rt.audioSampleRate*rt.timescale}else"opus"===this.audio_metadata_.codec?(rt.audioSampleRate=this.audio_metadata_.sample_rate,rt.channelCount=this.audio_metadata_.channel_count,rt.channelConfigCode=this.audio_metadata_.channel_config_code,rt.codec="opus",rt.originalCodec="opus",rt.config=void 0,rt.refSampleDuration=20):"mp3"===this.audio_metadata_.codec&&(rt.audioSampleRate=this.audio_metadata_.sample_rate,rt.channelCount=this.audio_metadata_.channel_count,rt.codec="mp3",rt.originalCodec="mp3",rt.config=void 0);0==this.audio_init_segment_dispatched_&&ot.a.v(this.TAG,"Generated first AudioSpecificConfig for mimeType: ".concat(rt.codec)),this.onTrackMetadata("audio",rt),this.audio_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var dt=this.media_info_;dt.hasAudio=!0,dt.audioCodec=rt.originalCodec,dt.audioSampleRate=rt.audioSampleRate,dt.audioChannelCount=rt.channelCount,dt.hasVideo&&dt.videoCodec?dt.mimeType='video/mp2t; codecs="'.concat(dt.videoCodec,",").concat(dt.audioCodec,'"'):dt.mimeType='video/mp2t; codecs="'.concat(dt.audioCodec,'"'),dt.isComplete()&&this.onMediaInfo(dt)},t.prototype.dispatchPESPrivateDataDescriptor=function(nt,rt,it){var at=new X;at.pid=nt,at.stream_type=rt,at.descriptor=it,this.onPESPrivateDataDescriptor&&this.onPESPrivateDataDescriptor(at)},t.prototype.parsePESPrivateDataPayload=function(nt,rt,it,at,st){var ot=new Y;if(ot.pid=at,ot.stream_id=st,ot.len=nt.byteLength,ot.data=nt,null!=rt){var lt=Math.floor(rt/this.timescale_);ot.pts=lt}else ot.nearest_pts=this.getNearestTimestampMilliseconds();if(null!=it){var ut=Math.floor(it/this.timescale_);ot.dts=ut}this.onPESPrivateData&&this.onPESPrivateData(ot)},t.prototype.parseTimedID3MetadataPayload=function(nt,rt,it,at,st){var ot=new Y;if(ot.pid=at,ot.stream_id=st,ot.len=nt.byteLength,ot.data=nt,null!=rt){var lt=Math.floor(rt/this.timescale_);ot.pts=lt}if(null!=it){var ut=Math.floor(it/this.timescale_);ot.dts=ut}this.onTimedID3Metadata&&this.onTimedID3Metadata(ot)},t.prototype.parseSynchronousKLVMetadataPayload=function(nt,rt,it,at,st){var ot=new Ee;if(ot.pid=at,ot.stream_id=st,ot.len=nt.byteLength,ot.data=nt,null!=rt){var lt=Math.floor(rt/this.timescale_);ot.pts=lt}if(null!=it){var ut=Math.floor(it/this.timescale_);ot.dts=ut}ot.access_units=function(nt){for(var rt=[],it=0;it+5<nt.byteLength;){var at=nt[it+0],st=nt[it+1],ot=nt[it+2],lt=nt[it+3]<<8|nt[it+4],ut=nt.slice(it+5,it+5+lt);rt.push({service_id:at,sequence_number:st,flags:ot,data:ut}),it+=5+lt}return rt}(nt),this.onSynchronousKLVMetadata&&this.onSynchronousKLVMetadata(ot)},t.prototype.parseAsynchronousKLVMetadataPayload=function(nt,rt,it){var at=new Y;at.pid=rt,at.stream_id=it,at.len=nt.byteLength,at.data=nt,this.onAsynchronousKLVMetadata&&this.onAsynchronousKLVMetadata(at)},t.prototype.parseSMPTE2038MetadataPayload=function(nt,rt,it,at,st){var ot=new fe;if(ot.pid=at,ot.stream_id=st,ot.len=nt.byteLength,ot.data=nt,null!=rt){var lt=Math.floor(rt/this.timescale_);ot.pts=lt}if(ot.nearest_pts=this.getNearestTimestampMilliseconds(),null!=it){var ut=Math.floor(it/this.timescale_);ot.dts=ut}ot.ancillaries=function(nt){for(var rt=new _t(nt),it=0,at=[];it+=6,0===rt.readBits(6);){var st=rt.readBool();it+=1;var ot=rt.readBits(11);it+=11;var lt=rt.readBits(12);it+=12;var ut=255&rt.readBits(10);it+=10;var ct=255&rt.readBits(10);it+=10;var dt=255&rt.readBits(10);it+=10;for(var ht=new Uint8Array(dt),pt=0;pt<dt;pt++){var Et=255&rt.readBits(10);it+=10,ht[pt]=Et}rt.readBits(10),it+=10;var St="User Defined";65===ut?7===ct&&(St="SCTE-104"):95===ut?220===ct?St="ARIB STD-B37 (1SEG)":221===ct?St="ARIB STD-B37 (ANALOG)":222===ct?St="ARIB STD-B37 (SD)":223===ct&&(St="ARIB STD-B37 (HD)"):97===ut&&(1===ct?St="EIA-708":2===ct&&(St="EIA-608")),at.push({yc_indicator:st,line_number:ot,horizontal_offset:lt,did:ut,sdid:ct,user_data:ht,description:St,information:{}}),rt.readBits(8-(it-Math.floor(it/8))%8),it+=(8-(it-Math.floor(it/8)))%8}return rt.destroy(),rt=null,at}(nt),this.onSMPTE2038Metadata&&this.onSMPTE2038Metadata(ot)},t.prototype.getNearestTimestampMilliseconds=function(){return null!=this.audio_last_sample_pts_?Math.floor(this.audio_last_sample_pts_):null!=this.last_pcr_?Math.floor(this.last_pcr_/300/this.timescale_):void 0},t.prototype.getPcrBase=function(nt){var rt=33554432*nt[6]+131072*nt[7]+512*nt[8]+2*nt[9]+(128&nt[10])/128+this.timestamp_offset_;return rt+4294967296<this.last_pcr_base_&&(rt+=8589934592,this.timestamp_offset_+=8589934592),this.last_pcr_base_=rt,rt},t.prototype.getTimestamp=function(nt,rt){var it=536870912*(14&nt[rt])+4194304*(255&nt[rt+1])+16384*(254&nt[rt+2])+128*(255&nt[rt+3])+(254&nt[rt+4])/2+this.timestamp_offset_;return it+4294967296<this.last_pcr_base_&&(it+=8589934592),it},t}(kt),we=function(nt,rt,it){for(var at,st=0,ot=rt.length;st<ot;st++)!at&&st in rt||(at||(at=Array.prototype.slice.call(rt,0,st)),at[st]=rt[st]);return nt.concat(at||Array.prototype.slice.call(rt))},_n=function(){function e(){}return e.init=function(){for(var nt in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],hvc1:[],hvcC:[],av01:[],av1C:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[],Opus:[],dOps:[],"ac-3":[],dac3:[],"ec-3":[],dec3:[],fLaC:[],dfLa:[]},e.types)e.types.hasOwnProperty(nt)&&(e.types[nt]=[nt.charCodeAt(0),nt.charCodeAt(1),nt.charCodeAt(2),nt.charCodeAt(3)]);var rt=e.constants={};rt.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),rt.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),rt.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),rt.STSC=rt.STCO=rt.STTS,rt.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),rt.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),rt.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),rt.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),rt.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),rt.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},e.box=function(nt){for(var rt=8,it=null,at=Array.prototype.slice.call(arguments,1),st=at.length,ot=0;ot<st;ot++)rt+=at[ot].byteLength;(it=new Uint8Array(rt))[0]=rt>>>24&255,it[1]=rt>>>16&255,it[2]=rt>>>8&255,it[3]=255&rt,it.set(nt,4);var lt=8;for(ot=0;ot<st;ot++)it.set(at[ot],lt),lt+=at[ot].byteLength;return it},e.generateInitSegment=function(nt){var rt=e.box(e.types.ftyp,e.constants.FTYP),it=e.moov(nt),at=new Uint8Array(rt.byteLength+it.byteLength);return at.set(rt,0),at.set(it,rt.byteLength),at},e.moov=function(nt){var rt=e.mvhd(nt.timescale,nt.duration),it=e.trak(nt),at=e.mvex(nt);return e.box(e.types.moov,rt,it,at)},e.mvhd=function(nt,rt){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,nt>>>24&255,nt>>>16&255,nt>>>8&255,255&nt,rt>>>24&255,rt>>>16&255,rt>>>8&255,255&rt,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},e.trak=function(nt){return e.box(e.types.trak,e.tkhd(nt),e.mdia(nt))},e.tkhd=function(nt){var rt=nt.id,it=nt.duration,at=nt.presentWidth,st=nt.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,rt>>>24&255,rt>>>16&255,rt>>>8&255,255&rt,0,0,0,0,it>>>24&255,it>>>16&255,it>>>8&255,255&it,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,at>>>8&255,255&at,0,0,st>>>8&255,255&st,0,0]))},e.mdia=function(nt){return e.box(e.types.mdia,e.mdhd(nt),e.hdlr(nt),e.minf(nt))},e.mdhd=function(nt){var rt=nt.timescale,it=nt.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,rt>>>24&255,rt>>>16&255,rt>>>8&255,255&rt,it>>>24&255,it>>>16&255,it>>>8&255,255&it,85,196,0,0]))},e.hdlr=function(nt){var rt=null;return rt="audio"===nt.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,rt)},e.minf=function(nt){var rt=null;return rt="audio"===nt.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,rt,e.dinf(),e.stbl(nt))},e.dinf=function(){return e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF))},e.stbl=function(nt){return e.box(e.types.stbl,e.stsd(nt),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO))},e.stsd=function(nt){return"audio"===nt.type?"mp3"===nt.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp3(nt)):"ac-3"===nt.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.ac3(nt)):"ec-3"===nt.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.ec3(nt)):"opus"===nt.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.Opus(nt)):"flac"==nt.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.fLaC(nt)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(nt)):"video"===nt.type&&nt.codec.startsWith("hvc1")?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.hvc1(nt)):"video"===nt.type&&nt.codec.startsWith("av01")?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.av01(nt)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(nt))},e.mp3=function(nt){var rt=nt.channelCount,it=nt.audioSampleRate,at=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,rt,0,16,0,0,0,0,it>>>8&255,255&it,0,0]);return e.box(e.types[".mp3"],at)},e.mp4a=function(nt){var rt=nt.channelCount,it=nt.audioSampleRate,at=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,rt,0,16,0,0,0,0,it>>>8&255,255&it,0,0]);return e.box(e.types.mp4a,at,e.esds(nt))},e.ac3=function(nt){var rt=nt.channelCount,it=nt.audioSampleRate,at=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,rt,0,16,0,0,0,0,it>>>8&255,255&it,0,0]);return e.box(e.types["ac-3"],at,e.box(e.types.dac3,new Uint8Array(nt.config)))},e.ec3=function(nt){var rt=nt.channelCount,it=nt.audioSampleRate,at=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,rt,0,16,0,0,0,0,it>>>8&255,255&it,0,0]);return e.box(e.types["ec-3"],at,e.box(e.types.dec3,new Uint8Array(nt.config)))},e.esds=function(nt){var rt=nt.config||[],it=rt.length,at=new Uint8Array([0,0,0,0,3,23+it,0,1,0,4,15+it,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([it]).concat(rt).concat([6,1,2]));return e.box(e.types.esds,at)},e.Opus=function(nt){var rt=nt.channelCount,it=nt.audioSampleRate,at=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,rt,0,16,0,0,0,0,it>>>8&255,255&it,0,0]);return e.box(e.types.Opus,at,e.dOps(nt))},e.dOps=function(nt){var rt=nt.channelCount,it=nt.channelConfigCode,at=nt.audioSampleRate;if(nt.config)return e.box(e.types.dOps,nt.config);var st=[];switch(it){case 1:case 2:st=[0];break;case 0:st=[255,1,1,0,1];break;case 128:st=[255,2,0,0,1];break;case 3:st=[1,2,1,0,2,1];break;case 4:st=[1,2,2,0,1,2,3];break;case 5:st=[1,3,2,0,4,1,2,3];break;case 6:st=[1,4,2,0,4,1,2,3,5];break;case 7:st=[1,4,2,0,4,1,2,3,5,6];break;case 8:st=[1,5,3,0,6,1,2,3,4,5,7];break;case 130:st=[1,1,2,0,1];break;case 131:st=[1,1,3,0,1,2];break;case 132:st=[1,1,4,0,1,2,3];break;case 133:st=[1,1,5,0,1,2,3,4];break;case 134:st=[1,1,6,0,1,2,3,4,5];break;case 135:st=[1,1,7,0,1,2,3,4,5,6];break;case 136:st=[1,1,8,0,1,2,3,4,5,6,7]}var ot=new Uint8Array(we([0,rt,0,0,at>>>24&255,at>>>17&255,at>>>8&255,at>>>0&255,0,0],st));return e.box(e.types.dOps,ot)},e.fLaC=function(nt){var rt=nt.channelCount,it=Math.min(nt.audioSampleRate,65535),at=nt.sampleSize,st=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,rt,0,at,0,0,0,0,it>>>8&255,255&it,0,0]);return e.box(e.types.fLaC,st,e.dfLa(nt))},e.dfLa=function(nt){var rt=new Uint8Array(we([0,0,0,0],nt.config));return e.box(e.types.dfLa,rt)},e.avc1=function(nt){var rt=nt.avcc,it=nt.codecWidth,at=nt.codecHeight,st=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,it>>>8&255,255&it,at>>>8&255,255&at,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.avc1,st,e.box(e.types.avcC,rt))},e.hvc1=function(nt){var rt=nt.hvcc,it=nt.codecWidth,at=nt.codecHeight,st=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,it>>>8&255,255&it,at>>>8&255,255&at,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.hvc1,st,e.box(e.types.hvcC,rt))},e.av01=function(nt){var rt=nt.av1c,it=nt.codecWidth||192,at=nt.codecHeight||108,st=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,it>>>8&255,255&it,at>>>8&255,255&at,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.av01,st,e.box(e.types.av1C,rt))},e.mvex=function(nt){return e.box(e.types.mvex,e.trex(nt))},e.trex=function(nt){var rt=nt.id,it=new Uint8Array([0,0,0,0,rt>>>24&255,rt>>>16&255,rt>>>8&255,255&rt,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,it)},e.moof=function(nt,rt){return e.box(e.types.moof,e.mfhd(nt.sequenceNumber),e.traf(nt,rt))},e.mfhd=function(nt){var rt=new Uint8Array([0,0,0,0,nt>>>24&255,nt>>>16&255,nt>>>8&255,255&nt]);return e.box(e.types.mfhd,rt)},e.traf=function(nt,rt){var it=nt.id,at=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,it>>>24&255,it>>>16&255,it>>>8&255,255&it])),st=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,rt>>>24&255,rt>>>16&255,rt>>>8&255,255&rt])),ot=e.sdtp(nt),lt=e.trun(nt,ot.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,at,st,lt,ot)},e.sdtp=function(nt){for(var rt=nt.samples||[],it=rt.length,at=new Uint8Array(4+it),st=0;st<it;st++){var ot=rt[st].flags;at[st+4]=ot.isLeading<<6|ot.dependsOn<<4|ot.isDependedOn<<2|ot.hasRedundancy}return e.box(e.types.sdtp,at)},e.trun=function(nt,rt){var it=nt.samples||[],at=it.length,st=12+16*at,ot=new Uint8Array(st);rt+=8+st,ot.set([0,0,15,1,at>>>24&255,at>>>16&255,at>>>8&255,255&at,rt>>>24&255,rt>>>16&255,rt>>>8&255,255&rt],0);for(var lt=0;lt<at;lt++){var ut=it[lt].duration,ct=it[lt].size,dt=it[lt].flags,ht=it[lt].cts;ot.set([ut>>>24&255,ut>>>16&255,ut>>>8&255,255&ut,ct>>>24&255,ct>>>16&255,ct>>>8&255,255&ct,dt.isLeading<<2|dt.dependsOn,dt.isDependedOn<<6|dt.hasRedundancy<<4|dt.isNonSync,0,0,ht>>>24&255,ht>>>16&255,ht>>>8&255,255&ht],12+16*lt)}return e.box(e.types.trun,ot)},e.mdat=function(nt){return e.box(e.types.mdat,nt)},e}();_n.init();var vn=_n,En=function(){function e(){}return e.getSilentFrame=function(nt,rt){if("mp4a.40.2"===nt){if(1===rt)return new Uint8Array([0,200,0,128,35,128]);if(2===rt)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===rt)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===rt)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===rt)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===rt)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===rt)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===rt)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===rt)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),Tn=it(11),bn=function(){function e(nt){this.TAG="MP4Remuxer",this._config=nt,this._isLive=!0===nt.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new Tn.c("audio"),this._videoSegmentInfoList=new Tn.c("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!lt.a.chrome||!(lt.a.version.major<50||50===lt.a.version.major&&lt.a.version.build<2661)),this._fillSilentAfterSeek=lt.a.msedge||lt.a.msie,this._mp3UseMpegAudio=!lt.a.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return e.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},e.prototype.bindDataSource=function(nt){return nt.onDataAvailable=this.remux.bind(this),nt.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(e.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(nt){this._onInitSegment=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(nt){this._onMediaSegment=nt},enumerable:!1,configurable:!0}),e.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},e.prototype.seek=function(nt){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},e.prototype.remux=function(nt,rt){if(!this._onMediaSegment)throw new dt.a("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(nt,rt),rt&&this._remuxVideo(rt),nt&&this._remuxAudio(nt)},e.prototype._onTrackMetadataReceived=function(nt,rt){var it=null,at="mp4",st=rt.codec;if("audio"===nt)this._audioMeta=rt,"mp3"===rt.codec&&this._mp3UseMpegAudio?(at="mpeg",st="",it=new Uint8Array):it=vn.generateInitSegment(rt);else{if("video"!==nt)return;this._videoMeta=rt,it=vn.generateInitSegment(rt)}if(!this._onInitSegment)throw new dt.a("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(nt,{type:nt,data:it.buffer,codec:st,container:"".concat(nt,"/").concat(at),mediaDuration:rt.duration})},e.prototype._calculateDtsBase=function(nt,rt){this._dtsBaseInited||(nt&&nt.samples&&nt.samples.length&&(this._audioDtsBase=nt.samples[0].dts),rt&&rt.samples&&rt.samples.length&&(this._videoDtsBase=rt.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},e.prototype.getTimestampBase=function(){if(this._dtsBaseInited)return this._dtsBase},e.prototype.flushStashedSamples=function(){var nt=this._videoStashedLastSample,rt=this._audioStashedLastSample,it={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=nt&&(it.samples.push(nt),it.length=nt.length);var at={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=rt&&(at.samples.push(rt),at.length=rt.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(it,!0),this._remuxAudio(at,!0)},e.prototype._remuxAudio=function(nt,rt){if(null!=this._audioMeta){var it,at=nt,st=at.samples,ut=void 0,ct=-1,dt=this._audioMeta.refSampleDuration,ht="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,pt=this._dtsBaseInited&&void 0===this._audioNextDts,_t=!1;if(st&&0!==st.length&&(1!==st.length||rt)){var Et=0,St=null,wt=0;ht?(Et=0,wt=at.length):(Et=8,wt=8+at.length);var Lt=null;if(st.length>1&&(wt-=(Lt=st.pop()).length),null!=this._audioStashedLastSample){var Ct=this._audioStashedLastSample;this._audioStashedLastSample=null,st.unshift(Ct),wt+=Ct.length}null!=Lt&&(this._audioStashedLastSample=Lt);var Pt=st[0].dts-this._dtsBase;if(this._audioNextDts)ut=Pt-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())ut=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(_t=!0);else{var kt=this._audioSegmentInfoList.getLastSampleBefore(Pt);if(null!=kt){var Ot=Pt-(kt.originalDts+kt.duration);Ot<=3&&(Ot=0),ut=Pt-(kt.dts+kt.duration+Ot)}else ut=0}if(_t){var Ft=Pt-ut,Bt=this._videoSegmentInfoList.getLastSegmentBefore(Pt);if(null!=Bt&&Bt.beginDts<Ft){if(nn=En.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var Ut=Bt.beginDts,Gt=Ft-Bt.beginDts;ot.a.v(this.TAG,"InsertPrefixSilentAudio: dts: ".concat(Ut,", duration: ").concat(Gt)),st.unshift({unit:nn,dts:Ut,pts:Ut}),wt+=nn.byteLength}}else _t=!1}for(var Ht=[],jt=0;jt<st.length;jt++){var Kt=(Ct=st[jt]).unit,$t=Ct.dts-this._dtsBase,Yt=(Ut=$t,!1),Wt=null,Qt=0;if(!($t<-.001)){if("mp3"!==this._audioMeta.codec&&null!=dt){var en=$t;if(this._audioNextDts&&(en=this._audioNextDts),(ut=$t-en)<=-3*dt){ot.a.w(this.TAG,"Dropping 1 audio frame (originalDts: ".concat($t," ms ,curRefDts: ").concat(en," ms)  due to dtsCorrection: ").concat(ut," ms overlap."));continue}if(ut>=3*dt&&this._fillAudioTimestampGap&&!lt.a.safari){Yt=!0;var nn,an=Math.floor(ut/dt);ot.a.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\n"+"originalDts: ".concat($t," ms, curRefDts: ").concat(en," ms, ")+"dtsCorrection: ".concat(Math.round(ut)," ms, generate: ").concat(an," frames")),Ut=Math.floor(en),Qt=Math.floor(en+dt)-Ut,null==(nn=En.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))&&(ot.a.w(this.TAG,"Unable to generate silent frame for "+"".concat(this._audioMeta.originalCodec," with ").concat(this._audioMeta.channelCount," channels, repeat last frame")),nn=Kt),Wt=[];for(var ln=0;ln<an;ln++){en+=dt;var hn=Math.floor(en),fn=Math.floor(en+dt)-hn,pn={dts:hn,pts:hn,cts:0,unit:nn,size:nn.byteLength,duration:fn,originalDts:$t,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};Wt.push(pn),wt+=pn.size}this._audioNextDts=en+dt}else Ut=Math.floor(en),Qt=Math.floor(en+dt)-Ut,this._audioNextDts=en+dt}else Ut=$t-ut,Qt=jt!==st.length-1?st[jt+1].dts-this._dtsBase-ut-Ut:null!=Lt?Lt.dts-this._dtsBase-ut-Ut:Ht.length>=1?Ht[Ht.length-1].duration:Math.floor(dt),this._audioNextDts=Ut+Qt;-1===ct&&(ct=Ut),Ht.push({dts:Ut,pts:Ut,cts:0,unit:Ct.unit,size:Ct.unit.byteLength,duration:Qt,originalDts:$t,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),Yt&&Ht.push.apply(Ht,Wt)}}if(0===Ht.length)return at.samples=[],void(at.length=0);for(ht?St=new Uint8Array(wt):((St=new Uint8Array(wt))[0]=wt>>>24&255,St[1]=wt>>>16&255,St[2]=wt>>>8&255,St[3]=255&wt,St.set(vn.types.mdat,4)),jt=0;jt<Ht.length;jt++)Kt=Ht[jt].unit,St.set(Kt,Et),Et+=Kt.byteLength;var mn=Ht[Ht.length-1];it=mn.dts+mn.duration;var gn=new Tn.b;gn.beginDts=ct,gn.endDts=it,gn.beginPts=ct,gn.endPts=it,gn.originalBeginDts=Ht[0].originalDts,gn.originalEndDts=mn.originalDts+mn.duration,gn.firstSample=new Tn.d(Ht[0].dts,Ht[0].pts,Ht[0].duration,Ht[0].originalDts,!1),gn.lastSample=new Tn.d(mn.dts,mn.pts,mn.duration,mn.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(gn),at.samples=Ht,at.sequenceNumber++;var _n=null;_n=ht?new Uint8Array:vn.moof(at,ct),at.samples=[],at.length=0;var bn={type:"audio",data:this._mergeBoxes(_n,St).buffer,sampleCount:Ht.length,info:gn};ht&&pt&&(bn.timestampOffset=ct),this._onMediaSegment("audio",bn)}}},e.prototype._remuxVideo=function(nt,rt){if(null!=this._videoMeta){var it,at,st=nt,ot=st.samples,lt=void 0,ut=-1,ct=-1;if(ot&&0!==ot.length&&(1!==ot.length||rt)){var dt=8,ht=null,pt=8+nt.length,_t=null;if(ot.length>1&&(pt-=(_t=ot.pop()).length),null!=this._videoStashedLastSample){var Et=this._videoStashedLastSample;this._videoStashedLastSample=null,ot.unshift(Et),pt+=Et.length}null!=_t&&(this._videoStashedLastSample=_t);var St=ot[0].dts-this._dtsBase;if(this._videoNextDts)lt=St-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())lt=0;else{var wt=this._videoSegmentInfoList.getLastSampleBefore(St);if(null!=wt){var Lt=St-(wt.originalDts+wt.duration);Lt<=3&&(Lt=0),lt=St-(wt.dts+wt.duration+Lt)}else lt=0}for(var Ct=new Tn.b,Pt=[],kt=0;kt<ot.length;kt++){var Ot=(Et=ot[kt]).dts-this._dtsBase,Ft=Et.isKeyframe,Bt=Ot-lt,Ut=Et.cts,Gt=Bt+Ut;-1===ut&&(ut=Bt,ct=Gt);var Ht=0;if(Ht=kt!==ot.length-1?ot[kt+1].dts-this._dtsBase-lt-Bt:null!=_t?_t.dts-this._dtsBase-lt-Bt:Pt.length>=1?Pt[Pt.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),Ft){var jt=new Tn.d(Bt,Gt,Ht,Et.dts,!0);jt.fileposition=Et.fileposition,Ct.appendSyncPoint(jt)}Pt.push({dts:Bt,pts:Gt,cts:Ut,units:Et.units,size:Et.length,isKeyframe:Ft,duration:Ht,originalDts:Ot,flags:{isLeading:0,dependsOn:Ft?2:1,isDependedOn:Ft?1:0,hasRedundancy:0,isNonSync:Ft?0:1}})}for((ht=new Uint8Array(pt))[0]=pt>>>24&255,ht[1]=pt>>>16&255,ht[2]=pt>>>8&255,ht[3]=255&pt,ht.set(vn.types.mdat,4),kt=0;kt<Pt.length;kt++)for(var Kt=Pt[kt].units;Kt.length;){var $t=Kt.shift().data;ht.set($t,dt),dt+=$t.byteLength}var Yt=Pt[Pt.length-1];if(it=Yt.dts+Yt.duration,at=Yt.pts+Yt.duration,this._videoNextDts=it,Ct.beginDts=ut,Ct.endDts=it,Ct.beginPts=ct,Ct.endPts=at,Ct.originalBeginDts=Pt[0].originalDts,Ct.originalEndDts=Yt.originalDts+Yt.duration,Ct.firstSample=new Tn.d(Pt[0].dts,Pt[0].pts,Pt[0].duration,Pt[0].originalDts,Pt[0].isKeyframe),Ct.lastSample=new Tn.d(Yt.dts,Yt.pts,Yt.duration,Yt.originalDts,Yt.isKeyframe),this._isLive||this._videoSegmentInfoList.append(Ct),st.samples=Pt,st.sequenceNumber++,this._forceFirstIDR){var Wt=Pt[0].flags;Wt.dependsOn=2,Wt.isNonSync=0}var Qt=vn.moof(st,ut);st.samples=[],st.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(Qt,ht).buffer,sampleCount:Pt.length,info:Ct})}}},e.prototype._mergeBoxes=function(nt,rt){var it=new Uint8Array(nt.byteLength+rt.byteLength);return it.set(nt,0),it.set(rt,nt.byteLength),it},e}(),An=it(14),Rn=it(1),In=(it(2),function(){function e(nt,rt){this.TAG="TransmuxingController",this._emitter=new st.a,this._config=rt,nt.segments||(nt.segments=[{duration:nt.duration,filesize:nt.filesize,url:nt.url}]),"boolean"!=typeof nt.cors&&(nt.cors=!0),"boolean"!=typeof nt.withCredentials&&(nt.withCredentials=!1),this._mediaDataSource=nt,this._currentSegmentIndex=0;var it=0;this._mediaDataSource.segments.forEach((function(at){at.timestampBase=it,it+=at.duration,at.cors=nt.cors,at.withCredentials=nt.withCredentials,rt.referrerPolicy&&(at.referrerPolicy=rt.referrerPolicy)})),isNaN(it)||this._mediaDataSource.duration===it||(this._mediaDataSource.duration=it),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return e.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(nt,rt){this._emitter.addListener(nt,rt)},e.prototype.off=function(nt,rt){this._emitter.removeListener(nt,rt)},e.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},e.prototype._loadSegment=function(nt,rt){this._currentSegmentIndex=nt;var it=this._mediaDataSource.segments[nt],at=this._ioctl=new An.a(it,this._config,nt);at.onError=this._onIOException.bind(this),at.onSeeked=this._onIOSeeked.bind(this),at.onComplete=this._onIOComplete.bind(this),at.onRedirect=this._onIORedirect.bind(this),at.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),rt?this._demuxer.bindDataSource(this._ioctl):at.onDataArrival=this._onInitChunkArrival.bind(this),at.open(rt)},e.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},e.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},e.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},e.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},e.prototype.seek=function(nt){if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var rt=this._searchSegmentIndexContains(nt);if(rt===this._currentSegmentIndex){var it=this._mediaInfo.segments[rt];if(null==it)this._pendingSeekTime=nt;else{var at=it.getNearestKeyframe(nt);this._remuxer.seek(at.milliseconds),this._ioctl.seek(at.fileposition),this._pendingResolveSeekPoint=at.milliseconds}}else{var st=this._mediaInfo.segments[rt];null==st?(this._pendingSeekTime=nt,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(rt)):(at=st.getNearestKeyframe(nt),this._internalAbort(),this._remuxer.seek(nt),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[rt].timestampBase,this._loadSegment(rt,at.fileposition),this._pendingResolveSeekPoint=at.milliseconds,this._reportSegmentMediaInfo(rt))}this._enableStatisticsReporter()}},e.prototype._searchSegmentIndexContains=function(nt){for(var rt=this._mediaDataSource.segments,it=rt.length-1,at=0;at<rt.length;at++)if(nt<rt[at].timestampBase){it=at-1;break}return it},e.prototype._onInitChunkArrival=function(nt,rt){var it=this,at=0;if(rt>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,at=this._demuxer.parseChunks(nt,rt);else{var st=null;(st=Pt.probe(nt)).match&&(this._setupFLVDemuxerRemuxer(st),at=this._demuxer.parseChunks(nt,rt)),st.match||st.needMoreData||(st=gn.probe(nt)).match&&(this._setupTSDemuxerRemuxer(st),at=this._demuxer.parseChunks(nt,rt)),st.match||st.needMoreData||(st=null,ot.a.e(this.TAG,"Non MPEG-TS/FLV, Unsupported media type!"),Promise.resolve().then((function(){it._internalAbort()})),this._emitter.emit(Rn.a.DEMUX_ERROR,St.a.FORMAT_UNSUPPORTED,"Non MPEG-TS/FLV, Unsupported media type!"))}return at},e.prototype._setupFLVDemuxerRemuxer=function(nt){this._demuxer=new Pt(nt,this._config),this._remuxer||(this._remuxer=new bn(this._config));var rt=this._mediaDataSource;null==rt.duration||isNaN(rt.duration)||(this._demuxer.overridedDuration=rt.duration),"boolean"==typeof rt.hasAudio&&(this._demuxer.overridedHasAudio=rt.hasAudio),"boolean"==typeof rt.hasVideo&&(this._demuxer.overridedHasVideo=rt.hasVideo),this._demuxer.timestampBase=rt.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},e.prototype._setupTSDemuxerRemuxer=function(nt){var rt=this._demuxer=new gn(nt,this._config);this._remuxer||(this._remuxer=new bn(this._config)),rt.onError=this._onDemuxException.bind(this),rt.onMediaInfo=this._onMediaInfo.bind(this),rt.onMetaDataArrived=this._onMetaDataArrived.bind(this),rt.onTimedID3Metadata=this._onTimedID3Metadata.bind(this),rt.onSynchronousKLVMetadata=this._onSynchronousKLVMetadata.bind(this),rt.onAsynchronousKLVMetadata=this._onAsynchronousKLVMetadata.bind(this),rt.onSMPTE2038Metadata=this._onSMPTE2038Metadata.bind(this),rt.onSCTE35Metadata=this._onSCTE35Metadata.bind(this),rt.onPESPrivateDataDescriptor=this._onPESPrivateDataDescriptor.bind(this),rt.onPESPrivateData=this._onPESPrivateData.bind(this),this._remuxer.bindDataSource(this._demuxer),this._demuxer.bindDataSource(this._ioctl),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},e.prototype._onMediaInfo=function(nt){var rt=this;null==this._mediaInfo&&(this._mediaInfo=Object.assign({},nt),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,ut.a.prototype));var it=Object.assign({},nt);Object.setPrototypeOf(it,ut.a.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=it,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then((function(){var nt=rt._pendingSeekTime;rt._pendingSeekTime=null,rt.seek(nt)}))},e.prototype._onMetaDataArrived=function(nt){this._emitter.emit(Rn.a.METADATA_ARRIVED,nt)},e.prototype._onScriptDataArrived=function(nt){this._emitter.emit(Rn.a.SCRIPTDATA_ARRIVED,nt)},e.prototype._onTimedID3Metadata=function(nt){var rt=this._remuxer.getTimestampBase();null!=rt&&(null!=nt.pts&&(nt.pts-=rt),null!=nt.dts&&(nt.dts-=rt),this._emitter.emit(Rn.a.TIMED_ID3_METADATA_ARRIVED,nt))},e.prototype._onSynchronousKLVMetadata=function(nt){var rt=this._remuxer.getTimestampBase();null!=rt&&(null!=nt.pts&&(nt.pts-=rt),null!=nt.dts&&(nt.dts-=rt),this._emitter.emit(Rn.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,nt))},e.prototype._onAsynchronousKLVMetadata=function(nt){this._emitter.emit(Rn.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,nt)},e.prototype._onSMPTE2038Metadata=function(nt){var rt=this._remuxer.getTimestampBase();null!=rt&&(null!=nt.pts&&(nt.pts-=rt),null!=nt.dts&&(nt.dts-=rt),null!=nt.nearest_pts&&(nt.nearest_pts-=rt),this._emitter.emit(Rn.a.SMPTE2038_METADATA_ARRIVED,nt))},e.prototype._onSCTE35Metadata=function(nt){var rt=this._remuxer.getTimestampBase();null!=rt&&(null!=nt.pts&&(nt.pts-=rt),null!=nt.nearest_pts&&(nt.nearest_pts-=rt),this._emitter.emit(Rn.a.SCTE35_METADATA_ARRIVED,nt))},e.prototype._onPESPrivateDataDescriptor=function(nt){this._emitter.emit(Rn.a.PES_PRIVATE_DATA_DESCRIPTOR,nt)},e.prototype._onPESPrivateData=function(nt){var rt=this._remuxer.getTimestampBase();null!=rt&&(null!=nt.pts&&(nt.pts-=rt),null!=nt.nearest_pts&&(nt.nearest_pts-=rt),null!=nt.dts&&(nt.dts-=rt),this._emitter.emit(Rn.a.PES_PRIVATE_DATA_ARRIVED,nt))},e.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},e.prototype._onIOComplete=function(nt){var rt=nt+1;rt<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer&&this._remuxer.flushStashedSamples(),this._loadSegment(rt)):(this._remuxer&&this._remuxer.flushStashedSamples(),this._emitter.emit(Rn.a.LOADING_COMPLETE),this._disableStatisticsReporter())},e.prototype._onIORedirect=function(nt){var rt=this._ioctl.extraData;this._mediaDataSource.segments[rt].redirectedURL=nt},e.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(Rn.a.RECOVERED_EARLY_EOF)},e.prototype._onIOException=function(nt,rt){ot.a.e(this.TAG,"IOException: type = ".concat(nt,", code = ").concat(rt.code,", msg = ").concat(rt.msg)),this._emitter.emit(Rn.a.IO_ERROR,nt,rt),this._disableStatisticsReporter()},e.prototype._onDemuxException=function(nt,rt){ot.a.e(this.TAG,"DemuxException: type = ".concat(nt,", info = ").concat(rt)),this._emitter.emit(Rn.a.DEMUX_ERROR,nt,rt)},e.prototype._onRemuxerInitSegmentArrival=function(nt,rt){this._emitter.emit(Rn.a.INIT_SEGMENT,nt,rt)},e.prototype._onRemuxerMediaSegmentArrival=function(nt,rt){if(null==this._pendingSeekTime&&(this._emitter.emit(Rn.a.MEDIA_SEGMENT,nt,rt),null!=this._pendingResolveSeekPoint&&"video"===nt)){var it=rt.info.syncPoints,at=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,lt.a.safari&&it.length>0&&it[0].originalDts===at&&(at=it[0].pts),this._emitter.emit(Rn.a.RECOMMEND_SEEKPOINT,at)}},e.prototype._enableStatisticsReporter=function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},e.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype._reportSegmentMediaInfo=function(nt){var rt=this._mediaInfo.segments[nt],it=Object.assign({},rt);it.duration=this._mediaInfo.duration,it.segmentCount=this._mediaInfo.segmentCount,delete it.segments,delete it.keyframesIndex,this._emitter.emit(Rn.a.MEDIA_INFO,it)},e.prototype._reportStatisticsInfo=function(){var nt={};nt.url=this._ioctl.currentURL,nt.hasRedirect=this._ioctl.hasRedirect,nt.hasRedirect&&(nt.redirectedURL=this._ioctl.currentRedirectedURL),nt.speed=this._ioctl.currentSpeed,nt.loaderType=this._ioctl.loaderType,nt.currentSegmentIndex=this._currentSegmentIndex,nt.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(Rn.a.STATISTICS_INFO,nt)},e}());rt.a=In},function(nt,rt,it){var at,st=it(0),ot=function(){function e(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return e.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},e.prototype.addBytes=function(nt){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=nt,this._totalBytes+=nt):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=nt,this._totalBytes+=nt):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=nt,this._totalBytes+=nt,this._lastCheckpoint=this._now())},Object.defineProperty(e.prototype,"currentKBps",{get:function(){this.addBytes(0);var nt=(this._now()-this._lastCheckpoint)/1e3;return 0==nt&&(nt=1),this._intervalBytes/nt/1024},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"averageKBps",{get:function(){var nt=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/nt/1024},enumerable:!1,configurable:!0}),e}(),lt=it(2),ut=it(5),ct=it(3),dt=(at=function(nt,rt){return(at=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(nt,rt){nt.__proto__=rt}||function(nt,rt){for(var it in rt)Object.prototype.hasOwnProperty.call(rt,it)&&(nt[it]=rt[it])})(nt,rt)},function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Class extends value "+String(rt)+" is not a constructor or null");function i(){this.constructor=nt}at(nt,rt),nt.prototype=null===rt?Object.create(rt):(i.prototype=rt.prototype,new i)}),ht=function(nt){function t(rt,it){var at=nt.call(this,"fetch-stream-loader")||this;return at.TAG="FetchStreamLoader",at._seekHandler=rt,at._config=it,at._needStash=!0,at._requestAbort=!1,at._abortController=null,at._contentLength=null,at._receivedLength=0,at}return dt(t,nt),t.isSupported=function(){try{var nt=ut.a.msedge&&ut.a.version.minor>=15048,rt=!ut.a.msedge||nt;return self.fetch&&self.ReadableStream&&rt}catch(nt){return!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),nt.prototype.destroy.call(this)},t.prototype.open=function(nt,rt){var it=this;this._dataSource=nt,this._range=rt;var at=nt.url;this._config.reuseRedirectedURL&&null!=nt.redirectedURL&&(at=nt.redirectedURL);var st=this._seekHandler.getConfig(at,rt),ot=new self.Headers;if("object"==typeof st.headers){var ut=st.headers;for(var dt in ut)ut.hasOwnProperty(dt)&&ot.append(dt,ut[dt])}var ht={method:"GET",headers:ot,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"==typeof this._config.headers)for(var dt in this._config.headers)ot.append(dt,this._config.headers[dt]);!1===nt.cors&&(ht.mode="same-origin"),nt.withCredentials&&(ht.credentials="include"),nt.referrerPolicy&&(ht.referrerPolicy=nt.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,ht.signal=this._abortController.signal),this._status=lt.c.kConnecting,self.fetch(st.url,ht).then((function(nt){if(it._requestAbort)return it._status=lt.c.kIdle,void nt.body.cancel();if(nt.ok&&nt.status>=200&&nt.status<=299){if(nt.url!==st.url&&it._onURLRedirect){var rt=it._seekHandler.removeURLParameters(nt.url);it._onURLRedirect(rt)}var at=nt.headers.get("Content-Length");return null!=at&&(it._contentLength=parseInt(at),0!==it._contentLength&&it._onContentLengthKnown&&it._onContentLengthKnown(it._contentLength)),it._pump.call(it,nt.body.getReader())}if(it._status=lt.c.kError,!it._onError)throw new ct.d("FetchStreamLoader: Http code invalid, "+nt.status+" "+nt.statusText);it._onError(lt.b.HTTP_STATUS_CODE_INVALID,{code:nt.status,msg:nt.statusText})})).catch((function(nt){if(!it._abortController||!it._abortController.signal.aborted){if(it._status=lt.c.kError,!it._onError)throw nt;it._onError(lt.b.EXCEPTION,{code:-1,msg:nt.message})}}))},t.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==lt.c.kBuffering||!ut.a.chrome)&&this._abortController)try{this._abortController.abort()}catch(nt){}},t.prototype._pump=function(nt){var rt=this;return nt.read().then((function(it){if(it.done)if(null!==rt._contentLength&&rt._receivedLength<rt._contentLength){rt._status=lt.c.kError;var at=lt.b.EARLY_EOF,st={code:-1,msg:"Fetch stream meet Early-EOF"};if(!rt._onError)throw new ct.d(st.msg);rt._onError(at,st)}else rt._status=lt.c.kComplete,rt._onComplete&&rt._onComplete(rt._range.from,rt._range.from+rt._receivedLength-1);else{if(rt._abortController&&rt._abortController.signal.aborted)return void(rt._status=lt.c.kComplete);if(!0===rt._requestAbort)return rt._status=lt.c.kComplete,nt.cancel();rt._status=lt.c.kBuffering;var ot=it.value.buffer,ut=rt._range.from+rt._receivedLength;rt._receivedLength+=ot.byteLength,rt._onDataArrival&&rt._onDataArrival(ot,ut,rt._receivedLength),rt._pump(nt)}})).catch((function(nt){if(rt._abortController&&rt._abortController.signal.aborted)rt._status=lt.c.kComplete;else if(11!==nt.code||!ut.a.msedge){rt._status=lt.c.kError;var it=0,at=null;if(19!==nt.code&&"network error"!==nt.message||!(null===rt._contentLength||null!==rt._contentLength&&rt._receivedLength<rt._contentLength)?(it=lt.b.EXCEPTION,at={code:nt.code,msg:nt.message}):(it=lt.b.EARLY_EOF,at={code:nt.code,msg:"Fetch stream meet Early-EOF"}),!rt._onError)throw new ct.d(at.msg);rt._onError(it,at)}}))},t}(lt.a),pt=function(){var e=function(nt,rt){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(nt,rt){nt.__proto__=rt}||function(nt,rt){for(var it in rt)Object.prototype.hasOwnProperty.call(rt,it)&&(nt[it]=rt[it])})(nt,rt)};return function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Class extends value "+String(rt)+" is not a constructor or null");function n(){this.constructor=nt}e(nt,rt),nt.prototype=null===rt?Object.create(rt):(n.prototype=rt.prototype,new n)}}(),_t=function(nt){function t(rt,it){var at=nt.call(this,"xhr-moz-chunked-loader")||this;return at.TAG="MozChunkedLoader",at._seekHandler=rt,at._config=it,at._needStash=!0,at._xhr=null,at._requestAbort=!1,at._contentLength=null,at._receivedLength=0,at}return pt(t,nt),t.isSupported=function(){try{var nt=new XMLHttpRequest;return nt.open("GET","https://example.com",!0),nt.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===nt.responseType}catch(nt){return st.a.w("MozChunkedLoader",nt.message),!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),nt.prototype.destroy.call(this)},t.prototype.open=function(nt,rt){this._dataSource=nt,this._range=rt;var it=nt.url;this._config.reuseRedirectedURL&&null!=nt.redirectedURL&&(it=nt.redirectedURL);var at=this._seekHandler.getConfig(it,rt);this._requestURL=at.url;var st=this._xhr=new XMLHttpRequest;if(st.open("GET",at.url,!0),st.responseType="moz-chunked-arraybuffer",st.onreadystatechange=this._onReadyStateChange.bind(this),st.onprogress=this._onProgress.bind(this),st.onloadend=this._onLoadEnd.bind(this),st.onerror=this._onXhrError.bind(this),nt.withCredentials&&(st.withCredentials=!0),"object"==typeof at.headers){var ot=at.headers;for(var ut in ot)ot.hasOwnProperty(ut)&&st.setRequestHeader(ut,ot[ut])}if("object"==typeof this._config.headers)for(var ut in ot=this._config.headers)ot.hasOwnProperty(ut)&&st.setRequestHeader(ut,ot[ut]);this._status=lt.c.kConnecting,st.send()},t.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=lt.c.kComplete},t.prototype._onReadyStateChange=function(nt){var rt=nt.target;if(2===rt.readyState){if(null!=rt.responseURL&&rt.responseURL!==this._requestURL&&this._onURLRedirect){var it=this._seekHandler.removeURLParameters(rt.responseURL);this._onURLRedirect(it)}if(0!==rt.status&&(rt.status<200||rt.status>299)){if(this._status=lt.c.kError,!this._onError)throw new ct.d("MozChunkedLoader: Http code invalid, "+rt.status+" "+rt.statusText);this._onError(lt.b.HTTP_STATUS_CODE_INVALID,{code:rt.status,msg:rt.statusText})}else this._status=lt.c.kBuffering}},t.prototype._onProgress=function(nt){if(this._status!==lt.c.kError){null===this._contentLength&&null!==nt.total&&0!==nt.total&&(this._contentLength=nt.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var rt=nt.target.response,it=this._range.from+this._receivedLength;this._receivedLength+=rt.byteLength,this._onDataArrival&&this._onDataArrival(rt,it,this._receivedLength)}},t.prototype._onLoadEnd=function(nt){!0!==this._requestAbort?this._status!==lt.c.kError&&(this._status=lt.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},t.prototype._onXhrError=function(nt){this._status=lt.c.kError;var rt=0,it=null;if(this._contentLength&&nt.loaded<this._contentLength?(rt=lt.b.EARLY_EOF,it={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(rt=lt.b.EXCEPTION,it={code:-1,msg:nt.constructor.name+" "+nt.type}),!this._onError)throw new ct.d(it.msg);this._onError(rt,it)},t}(lt.a),Et=function(){var e=function(nt,rt){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(nt,rt){nt.__proto__=rt}||function(nt,rt){for(var it in rt)Object.prototype.hasOwnProperty.call(rt,it)&&(nt[it]=rt[it])})(nt,rt)};return function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Class extends value "+String(rt)+" is not a constructor or null");function n(){this.constructor=nt}e(nt,rt),nt.prototype=null===rt?Object.create(rt):(n.prototype=rt.prototype,new n)}}(),St=(function(nt){function t(rt,it){var at=nt.call(this,"xhr-msstream-loader")||this;return at.TAG="MSStreamLoader",at._seekHandler=rt,at._config=it,at._needStash=!0,at._xhr=null,at._reader=null,at._totalRange=null,at._currentRange=null,at._currentRequestURL=null,at._currentRedirectedURL=null,at._contentLength=null,at._receivedLength=0,at._bufferLimit=16777216,at._lastTimeBufferSize=0,at._isReconnecting=!1,at}Et(t,nt),t.isSupported=function(){try{if(void 0===self.MSStream||void 0===self.MSStreamReader)return!1;var nt=new XMLHttpRequest;return nt.open("GET","https://example.com",!0),nt.responseType="ms-stream","ms-stream"===nt.responseType}catch(nt){return st.a.w("MSStreamLoader",nt.message),!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),this._reader&&(this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr=null),nt.prototype.destroy.call(this)},t.prototype.open=function(nt,rt){this._internalOpen(nt,rt,!1)},t.prototype._internalOpen=function(nt,rt,it){this._dataSource=nt,it?this._currentRange=rt:this._totalRange=rt;var at=nt.url;this._config.reuseRedirectedURL&&(null!=this._currentRedirectedURL?at=this._currentRedirectedURL:null!=nt.redirectedURL&&(at=nt.redirectedURL));var st=this._seekHandler.getConfig(at,rt);this._currentRequestURL=st.url;var ot=this._reader=new self.MSStreamReader;ot.onprogress=this._msrOnProgress.bind(this),ot.onload=this._msrOnLoad.bind(this),ot.onerror=this._msrOnError.bind(this);var ut=this._xhr=new XMLHttpRequest;if(ut.open("GET",st.url,!0),ut.responseType="ms-stream",ut.onreadystatechange=this._xhrOnReadyStateChange.bind(this),ut.onerror=this._xhrOnError.bind(this),nt.withCredentials&&(ut.withCredentials=!0),"object"==typeof st.headers){var ct=st.headers;for(var dt in ct)ct.hasOwnProperty(dt)&&ut.setRequestHeader(dt,ct[dt])}if("object"==typeof this._config.headers)for(var dt in ct=this._config.headers)ct.hasOwnProperty(dt)&&ut.setRequestHeader(dt,ct[dt]);this._isReconnecting?this._isReconnecting=!1:this._status=lt.c.kConnecting,ut.send()},t.prototype.abort=function(){this._internalAbort(),this._status=lt.c.kComplete},t.prototype._internalAbort=function(){this._reader&&(1===this._reader.readyState&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.abort(),this._xhr.onreadystatechange=null,this._xhr=null)},t.prototype._xhrOnReadyStateChange=function(nt){var rt=nt.target;if(2===rt.readyState)if(rt.status>=200&&rt.status<=299){if(this._status=lt.c.kBuffering,null!=rt.responseURL){var it=this._seekHandler.removeURLParameters(rt.responseURL);rt.responseURL!==this._currentRequestURL&&it!==this._currentRedirectedURL&&(this._currentRedirectedURL=it,this._onURLRedirect&&this._onURLRedirect(it))}var at=rt.getResponseHeader("Content-Length");if(null!=at&&null==this._contentLength){var st=parseInt(at);st>0&&(this._contentLength=st,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength))}}else{if(this._status=lt.c.kError,!this._onError)throw new ct.d("MSStreamLoader: Http code invalid, "+rt.status+" "+rt.statusText);this._onError(lt.b.HTTP_STATUS_CODE_INVALID,{code:rt.status,msg:rt.statusText})}else if(3===rt.readyState&&rt.status>=200&&rt.status<=299){this._status=lt.c.kBuffering;var ot=rt.response;this._reader.readAsArrayBuffer(ot)}},t.prototype._xhrOnError=function(nt){this._status=lt.c.kError;var rt=lt.b.EXCEPTION,it={code:-1,msg:nt.constructor.name+" "+nt.type};if(!this._onError)throw new ct.d(it.msg);this._onError(rt,it)},t.prototype._msrOnProgress=function(nt){var rt=nt.target.result;if(null!=rt){var it=rt.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=rt.byteLength;var at=this._totalRange.from+this._receivedLength;this._receivedLength+=it.byteLength,this._onDataArrival&&this._onDataArrival(it,at,this._receivedLength),rt.byteLength>=this._bufferLimit&&(st.a.v(this.TAG,"MSStream buffer exceeded max size near ".concat(at+it.byteLength,", reconnecting...")),this._doReconnectIfNeeded())}else this._doReconnectIfNeeded()},t.prototype._doReconnectIfNeeded=function(){if(null==this._contentLength||this._receivedLength<this._contentLength){this._isReconnecting=!0,this._lastTimeBufferSize=0,this._internalAbort();var nt={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,nt,!0)}},t.prototype._msrOnLoad=function(nt){this._status=lt.c.kComplete,this._onComplete&&this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1)},t.prototype._msrOnError=function(nt){this._status=lt.c.kError;var rt=0,it=null;if(this._contentLength&&this._receivedLength<this._contentLength?(rt=lt.b.EARLY_EOF,it={code:-1,msg:"MSStream meet Early-Eof"}):(rt=lt.b.EARLY_EOF,it={code:-1,msg:nt.constructor.name+" "+nt.type}),!this._onError)throw new ct.d(it.msg);this._onError(rt,it)}}(lt.a),function(){var e=function(nt,rt){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(nt,rt){nt.__proto__=rt}||function(nt,rt){for(var it in rt)Object.prototype.hasOwnProperty.call(rt,it)&&(nt[it]=rt[it])})(nt,rt)};return function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Class extends value "+String(rt)+" is not a constructor or null");function n(){this.constructor=nt}e(nt,rt),nt.prototype=null===rt?Object.create(rt):(n.prototype=rt.prototype,new n)}}()),wt=function(nt){function t(rt,it){var at=nt.call(this,"xhr-range-loader")||this;return at.TAG="RangeLoader",at._seekHandler=rt,at._config=it,at._needStash=!1,at._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],at._currentChunkSizeKB=384,at._currentSpeedNormalized=0,at._zeroSpeedChunkCount=0,at._xhr=null,at._speedSampler=new ot,at._requestAbort=!1,at._waitForTotalLength=!1,at._totalLengthReceived=!1,at._currentRequestURL=null,at._currentRedirectedURL=null,at._currentRequestRange=null,at._totalLength=null,at._contentLength=null,at._receivedLength=0,at._lastTimeLoaded=0,at}return St(t,nt),t.isSupported=function(){try{var nt=new XMLHttpRequest;return nt.open("GET","https://example.com",!0),nt.responseType="arraybuffer","arraybuffer"===nt.responseType}catch(nt){return st.a.w("RangeLoader",nt.message),!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),nt.prototype.destroy.call(this)},Object.defineProperty(t.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),t.prototype.open=function(nt,rt){this._dataSource=nt,this._range=rt,this._status=lt.c.kConnecting;var it=!1;null!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(it=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||it?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},t.prototype._openSubRange=function(){var nt=1024*this._currentChunkSizeKB,rt=this._range.from+this._receivedLength,it=rt+nt;null!=this._contentLength&&it-this._range.from>=this._contentLength&&(it=this._range.from+this._contentLength-1),this._currentRequestRange={from:rt,to:it},this._internalOpen(this._dataSource,this._currentRequestRange)},t.prototype._internalOpen=function(nt,rt){this._lastTimeLoaded=0;var it=nt.url;this._config.reuseRedirectedURL&&(null!=this._currentRedirectedURL?it=this._currentRedirectedURL:null!=nt.redirectedURL&&(it=nt.redirectedURL));var at=this._seekHandler.getConfig(it,rt);this._currentRequestURL=at.url;var st=this._xhr=new XMLHttpRequest;if(st.open("GET",at.url,!0),st.responseType="arraybuffer",st.onreadystatechange=this._onReadyStateChange.bind(this),st.onprogress=this._onProgress.bind(this),st.onload=this._onLoad.bind(this),st.onerror=this._onXhrError.bind(this),nt.withCredentials&&(st.withCredentials=!0),"object"==typeof at.headers){var ot=at.headers;for(var lt in ot)ot.hasOwnProperty(lt)&&st.setRequestHeader(lt,ot[lt])}if("object"==typeof this._config.headers)for(var lt in ot=this._config.headers)ot.hasOwnProperty(lt)&&st.setRequestHeader(lt,ot[lt]);st.send()},t.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=lt.c.kComplete},t.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},t.prototype._onReadyStateChange=function(nt){var rt=nt.target;if(2===rt.readyState){if(null!=rt.responseURL){var it=this._seekHandler.removeURLParameters(rt.responseURL);rt.responseURL!==this._currentRequestURL&&it!==this._currentRedirectedURL&&(this._currentRedirectedURL=it,this._onURLRedirect&&this._onURLRedirect(it))}if(rt.status>=200&&rt.status<=299){if(this._waitForTotalLength)return;this._status=lt.c.kBuffering}else{if(this._status=lt.c.kError,!this._onError)throw new ct.d("RangeLoader: Http code invalid, "+rt.status+" "+rt.statusText);this._onError(lt.b.HTTP_STATUS_CODE_INVALID,{code:rt.status,msg:rt.statusText})}}},t.prototype._onProgress=function(nt){if(this._status!==lt.c.kError){if(null===this._contentLength){var rt=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,rt=!0;var it=nt.total;this._internalAbort(),null!=it&0!==it&&(this._totalLength=it)}if(-1===this._range.to?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,rt)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var at=nt.loaded-this._lastTimeLoaded;this._lastTimeLoaded=nt.loaded,this._speedSampler.addBytes(at)}},t.prototype._normalizeSpeed=function(nt){var rt=this._chunkSizeKBList,it=rt.length-1,at=0,st=0,ot=it;if(nt<rt[0])return rt[0];for(;st<=ot;){if((at=st+Math.floor((ot-st)/2))===it||nt>=rt[at]&&nt<rt[at+1])return rt[at];rt[at]<nt?st=at+1:ot=at-1}},t.prototype._onLoad=function(nt){if(this._status!==lt.c.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var rt=this._speedSampler.lastSecondKBps;if(0===rt&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(rt=this._speedSampler.currentKBps)),0!==rt){var it=this._normalizeSpeed(rt);this._currentSpeedNormalized!==it&&(this._currentSpeedNormalized=it,this._currentChunkSizeKB=it)}var at=nt.target.response,st=this._range.from+this._receivedLength;this._receivedLength+=at.byteLength;var ot=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():ot=!0,this._onDataArrival&&this._onDataArrival(at,st,this._receivedLength),ot&&(this._status=lt.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},t.prototype._onXhrError=function(nt){this._status=lt.c.kError;var rt=0,it=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(rt=lt.b.EARLY_EOF,it={code:-1,msg:"RangeLoader meet Early-Eof"}):(rt=lt.b.EXCEPTION,it={code:-1,msg:nt.constructor.name+" "+nt.type}),!this._onError)throw new ct.d(it.msg);this._onError(rt,it)},t}(lt.a),Lt=function(){var e=function(nt,rt){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(nt,rt){nt.__proto__=rt}||function(nt,rt){for(var it in rt)Object.prototype.hasOwnProperty.call(rt,it)&&(nt[it]=rt[it])})(nt,rt)};return function(nt,rt){if("function"!=typeof rt&&null!==rt)throw new TypeError("Class extends value "+String(rt)+" is not a constructor or null");function n(){this.constructor=nt}e(nt,rt),nt.prototype=null===rt?Object.create(rt):(n.prototype=rt.prototype,new n)}}(),Ct=function(nt){function t(){var rt=nt.call(this,"websocket-loader")||this;return rt.TAG="WebSocketLoader",rt._needStash=!0,rt._ws=null,rt._requestAbort=!1,rt._receivedLength=0,rt}return Lt(t,nt),t.isSupported=function(){try{return void 0!==self.WebSocket}catch(nt){return!1}},t.prototype.destroy=function(){this._ws&&this.abort(),nt.prototype.destroy.call(this)},t.prototype.open=function(nt){try{var rt=this._ws=new self.WebSocket(nt.url);rt.binaryType="arraybuffer",rt.onopen=this._onWebSocketOpen.bind(this),rt.onclose=this._onWebSocketClose.bind(this),rt.onmessage=this._onWebSocketMessage.bind(this),rt.onerror=this._onWebSocketError.bind(this),this._status=lt.c.kConnecting}catch(nt){this._status=lt.c.kError;var it={code:nt.code,msg:nt.message};if(!this._onError)throw new ct.d(it.msg);this._onError(lt.b.EXCEPTION,it)}},t.prototype.abort=function(){var nt=this._ws;!nt||0!==nt.readyState&&1!==nt.readyState||(this._requestAbort=!0,nt.close()),this._ws=null,this._status=lt.c.kComplete},t.prototype._onWebSocketOpen=function(nt){this._status=lt.c.kBuffering},t.prototype._onWebSocketClose=function(nt){!0!==this._requestAbort?(this._status=lt.c.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},t.prototype._onWebSocketMessage=function(nt){var rt=this;if(nt.data instanceof ArrayBuffer)this._dispatchArrayBuffer(nt.data);else if(nt.data instanceof Blob){var it=new FileReader;it.onload=function(){rt._dispatchArrayBuffer(it.result)},it.readAsArrayBuffer(nt.data)}else{this._status=lt.c.kError;var at={code:-1,msg:"Unsupported WebSocket message type: "+nt.data.constructor.name};if(!this._onError)throw new ct.d(at.msg);this._onError(lt.b.EXCEPTION,at)}},t.prototype._dispatchArrayBuffer=function(nt){var rt=nt,it=this._receivedLength;this._receivedLength+=rt.byteLength,this._onDataArrival&&this._onDataArrival(rt,it,this._receivedLength)},t.prototype._onWebSocketError=function(nt){this._status=lt.c.kError;var rt={code:nt.code,msg:nt.message};if(!this._onError)throw new ct.d(rt.msg);this._onError(lt.b.EXCEPTION,rt)},t}(lt.a),Pt=function(){function e(nt){this._zeroStart=nt||!1}return e.prototype.getConfig=function(nt,rt){var it={};if(0!==rt.from||-1!==rt.to){var at=void 0;at=-1!==rt.to?"bytes=".concat(rt.from.toString(),"-").concat(rt.to.toString()):"bytes=".concat(rt.from.toString(),"-"),it.Range=at}else this._zeroStart&&(it.Range="bytes=0-");return{url:nt,headers:it}},e.prototype.removeURLParameters=function(nt){return nt},e}(),kt=function(){function e(nt,rt){this._startName=nt,this._endName=rt}return e.prototype.getConfig=function(nt,rt){var it=nt;if(0!==rt.from||-1!==rt.to){var at=!0;-1===it.indexOf("?")&&(it+="?",at=!1),at&&(it+="&"),it+="".concat(this._startName,"=").concat(rt.from.toString()),-1!==rt.to&&(it+="&".concat(this._endName,"=").concat(rt.to.toString()))}return{url:it,headers:{}}},e.prototype.removeURLParameters=function(nt){var rt=nt.split("?")[0],it=void 0,at=nt.indexOf("?");-1!==at&&(it=nt.substring(at+1));var st="";if(null!=it&&it.length>0)for(var ot=it.split("&"),lt=0;lt<ot.length;lt++){var ut=ot[lt].split("="),ct=lt>0;ut[0]!==this._startName&&ut[0]!==this._endName&&(ct&&(st+="&"),st+=ot[lt])}return 0===st.length?rt:rt+"?"+st},e}(),Ot=function(){function e(nt,rt,it){this.TAG="IOController",this._config=rt,this._extraData=it,this._stashInitialSize=65536,null!=rt.stashInitialSize&&rt.stashInitialSize>0&&(this._stashInitialSize=rt.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=Math.max(this._stashSize,3145728),this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===rt.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=nt,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(nt.url),this._refTotalLength=nt.filesize?nt.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new ot,this._speedNormalizeList=[32,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return e.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},e.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},e.prototype.isPaused=function(){return this._paused},Object.defineProperty(e.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extraData",{get:function(){return this._extraData},set:function(nt){this._extraData=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(nt){this._onDataArrival=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(nt){this._onSeeked=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(nt){this._onError=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{get:function(){return this._onComplete},set:function(nt){this._onComplete=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(nt){this._onRedirect=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(nt){this._onRecoveredEarlyEof=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasRedirect",{get:function(){return null!=this._redirectedURL||null!=this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentSpeed",{get:function(){return this._loaderClass===wt?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),e.prototype._selectSeekHandler=function(){var nt=this._config;if("range"===nt.seekType)this._seekHandler=new Pt(this._config.rangeLoadZeroStart);else if("param"===nt.seekType){var rt=nt.seekParamStart||"bstart",it=nt.seekParamEnd||"bend";this._seekHandler=new kt(rt,it)}else{if("custom"!==nt.seekType)throw new ct.b("Invalid seekType in config: ".concat(nt.seekType));if("function"!=typeof nt.customSeekHandler)throw new ct.b("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new nt.customSeekHandler}},e.prototype._selectLoader=function(){if(null!=this._config.customLoader)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=Ct;else if(ht.isSupported())this._loaderClass=ht;else if(_t.isSupported())this._loaderClass=_t;else{if(!wt.isSupported())throw new ct.d("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=wt}},e.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},e.prototype.open=function(nt){this._currentRange={from:0,to:-1},nt&&(this._currentRange.from=nt),this._speedSampler.reset(),nt||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},e.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},e.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},e.prototype.resume=function(){if(this._paused){this._paused=!1;var nt=this._resumeFrom;this._resumeFrom=0,this._internalSeek(nt,!0)}},e.prototype.seek=function(nt){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(nt,!0)},e.prototype._internalSeek=function(nt,rt){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(rt),this._loader.destroy(),this._loader=null;var it={from:nt,to:-1};this._currentRange={from:it.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,it),this._onSeeked&&this._onSeeked()},e.prototype.updateUrl=function(nt){if(!nt||"string"!=typeof nt||0===nt.length)throw new ct.b("Url must be a non-empty string!");this._dataSource.url=nt},e.prototype._expandBuffer=function(nt){for(var rt=this._stashSize;rt+1048576<nt;)rt*=2;if((rt+=1048576)!==this._bufferSize){var it=new ArrayBuffer(rt);if(this._stashUsed>0){var at=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(it,0,rt).set(at,0)}this._stashBuffer=it,this._bufferSize=rt}},e.prototype._normalizeSpeed=function(nt){var rt=this._speedNormalizeList,it=rt.length-1,at=0,st=0,ot=it;if(nt<rt[0])return rt[0];for(;st<=ot;){if((at=st+Math.floor((ot-st)/2))===it||nt>=rt[at]&&nt<rt[at+1])return rt[at];rt[at]<nt?st=at+1:ot=at-1}},e.prototype._adjustStashSize=function(nt){var rt=0;(rt=this._config.isLive?nt/8:nt<512?nt:nt>=512&&nt<=1024?Math.floor(1.5*nt):2*nt)>8192&&(rt=8192);var it=1024*rt+1048576;this._bufferSize<it&&this._expandBuffer(it),this._stashSize=1024*rt},e.prototype._dispatchChunks=function(nt,rt){return this._currentRange.to=rt+nt.byteLength-1,this._onDataArrival(nt,rt)},e.prototype._onURLRedirect=function(nt){this._redirectedURL=nt,this._onRedirect&&this._onRedirect(nt)},e.prototype._onContentLengthKnown=function(nt){nt&&this._fullRequestFlag&&(this._totalLength=nt,this._fullRequestFlag=!1)},e.prototype._onLoaderChunkArrival=function(nt,rt,it){if(!this._onDataArrival)throw new ct.a("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(nt.byteLength);var at=this._speedSampler.lastSecondKBps;if(0!==at){var st=this._normalizeSpeed(at);this._speedNormalized!==st&&(this._speedNormalized=st,this._adjustStashSize(st))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=rt),this._stashUsed+nt.byteLength<=this._stashSize)(ut=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(nt),this._stashUsed),this._stashUsed+=nt.byteLength;else if(ut=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var ot=this._stashBuffer.slice(0,this._stashUsed);(dt=this._dispatchChunks(ot,this._stashByteStart))<ot.byteLength?dt>0&&(ht=new Uint8Array(ot,dt),ut.set(ht,0),this._stashUsed=ht.byteLength,this._stashByteStart+=dt):(this._stashUsed=0,this._stashByteStart+=dt),this._stashUsed+nt.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+nt.byteLength),ut=new Uint8Array(this._stashBuffer,0,this._bufferSize)),ut.set(new Uint8Array(nt),this._stashUsed),this._stashUsed+=nt.byteLength}else(dt=this._dispatchChunks(nt,rt))<nt.byteLength&&((lt=nt.byteLength-dt)>this._bufferSize&&(this._expandBuffer(lt),ut=new Uint8Array(this._stashBuffer,0,this._bufferSize)),ut.set(new Uint8Array(nt,dt),0),this._stashUsed+=lt,this._stashByteStart=rt+dt);else if(0===this._stashUsed){var lt;(dt=this._dispatchChunks(nt,rt))<nt.byteLength&&((lt=nt.byteLength-dt)>this._bufferSize&&this._expandBuffer(lt),(ut=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(nt,dt),0),this._stashUsed+=lt,this._stashByteStart=rt+dt)}else{var ut,dt;if(this._stashUsed+nt.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+nt.byteLength),(ut=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(nt),this._stashUsed),this._stashUsed+=nt.byteLength,(dt=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&dt>0){var ht=new Uint8Array(this._stashBuffer,dt);ut.set(ht,0)}this._stashUsed-=dt,this._stashByteStart+=dt}}},e.prototype._flushStashBuffer=function(nt){if(this._stashUsed>0){var rt=this._stashBuffer.slice(0,this._stashUsed),it=this._dispatchChunks(rt,this._stashByteStart),at=rt.byteLength-it;if(it<rt.byteLength){if(!nt){if(it>0){var ot=new Uint8Array(this._stashBuffer,0,this._bufferSize),lt=new Uint8Array(rt,it);ot.set(lt,0),this._stashUsed=lt.byteLength,this._stashByteStart+=it}return 0}st.a.w(this.TAG,"".concat(at," bytes unconsumed data remain when flush buffer, dropped"))}return this._stashUsed=0,this._stashByteStart=0,at}return 0},e.prototype._onLoaderComplete=function(nt,rt){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},e.prototype._onLoaderError=function(nt,rt){switch(st.a.e(this.TAG,"Loader error, code = ".concat(rt.code,", msg = ").concat(rt.msg)),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,nt=lt.b.UNRECOVERABLE_EARLY_EOF),nt){case lt.b.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var it=this._currentRange.to+1;return void(it<this._totalLength&&(st.a.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(it,!1)))}nt=lt.b.UNRECOVERABLE_EARLY_EOF;case lt.b.UNRECOVERABLE_EARLY_EOF:case lt.b.CONNECTING_TIMEOUT:case lt.b.HTTP_STATUS_CODE_INVALID:case lt.b.EXCEPTION:}if(!this._onError)throw new ct.d("IOException: "+rt.msg);this._onError(nt,rt)},e}();rt.a=Ot},function(nt,rt,it){var at=function(){function e(){}return e.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(nt,rt){return nt.__proto__=rt,nt},Object.assign=Object.assign||function(nt){if(null==nt)throw new TypeError("Cannot convert undefined or null to object");for(var rt=Object(nt),it=1;it<arguments.length;it++){var at=arguments[it];if(null!=at)for(var st in at)at.hasOwnProperty(st)&&(rt[st]=at[st])}return rt},String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(nt,rt){var it=rt>0?0|rt:0;return this.substring(it,it+nt.length)===nt}}),"function"!=typeof self.Promise&&it(21).polyfill()},e}();at.install(),rt.a=at},function(nt,rt,it){var at=it(9),st=it.n(at),ot=it(0),lt=it(5),ut=it(7),ct=it(3),dt=function(){function e(nt){this.TAG="MSEController",this._config=nt,this._emitter=new st.a,this._config.isLive&&null==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onStartStreaming:this._onStartStreaming.bind(this),onEndStreaming:this._onEndStreaming.bind(this),onQualityChange:this._onQualityChange.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._useManagedMediaSource="ManagedMediaSource"in self&&!("MediaSource"in self),this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElementProxy=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]}}return e.prototype.destroy=function(){this._mediaSource&&this.shutdown(),this._mediaSourceObjectURL&&this.revokeObjectURL(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(nt,rt){this._emitter.addListener(nt,rt)},e.prototype.off=function(nt,rt){this._emitter.removeListener(nt,rt)},e.prototype.initialize=function(nt){if(this._mediaSource)throw new ct.a("MediaSource has been attached to an HTMLMediaElement!");this._useManagedMediaSource&&ot.a.v(this.TAG,"Using ManagedMediaSource");var rt=this._mediaSource=this._useManagedMediaSource?new self.ManagedMediaSource:new self.MediaSource;rt.addEventListener("sourceopen",this.e.onSourceOpen),rt.addEventListener("sourceended",this.e.onSourceEnded),rt.addEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(rt.addEventListener("startstreaming",this.e.onStartStreaming),rt.addEventListener("endstreaming",this.e.onEndStreaming),rt.addEventListener("qualitychange",this.e.onQualityChange)),this._mediaElementProxy=nt},e.prototype.shutdown=function(){if(this._mediaSource){var nt=this._mediaSource;for(var rt in this._sourceBuffers){var it=this._pendingSegments[rt];it.splice(0,it.length),this._pendingSegments[rt]=null,this._pendingRemoveRanges[rt]=null,this._lastInitSegments[rt]=null;var at=this._sourceBuffers[rt];if(at){if("closed"!==nt.readyState){try{nt.removeSourceBuffer(at)}catch(nt){ot.a.e(this.TAG,nt.message)}at.removeEventListener("error",this.e.onSourceBufferError),at.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[rt]=null,this._sourceBuffers[rt]=null}}if("open"===nt.readyState)try{nt.endOfStream()}catch(nt){ot.a.e(this.TAG,nt.message)}this._mediaElementProxy=null,nt.removeEventListener("sourceopen",this.e.onSourceOpen),nt.removeEventListener("sourceended",this.e.onSourceEnded),nt.removeEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(nt.removeEventListener("startstreaming",this.e.onStartStreaming),nt.removeEventListener("endstreaming",this.e.onEndStreaming),nt.removeEventListener("qualitychange",this.e.onQualityChange)),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._mediaSource=null}},e.prototype.isManagedMediaSource=function(){return this._useManagedMediaSource},e.prototype.getObject=function(){if(!this._mediaSource)throw new ct.a("MediaSource has not been initialized yet!");return this._mediaSource},e.prototype.getHandle=function(){if(!this._mediaSource)throw new ct.a("MediaSource has not been initialized yet!");return this._mediaSource.handle},e.prototype.getObjectURL=function(){if(!this._mediaSource)throw new ct.a("MediaSource has not been initialized yet!");return null==this._mediaSourceObjectURL&&(this._mediaSourceObjectURL=URL.createObjectURL(this._mediaSource)),this._mediaSourceObjectURL},e.prototype.revokeObjectURL=function(){this._mediaSourceObjectURL&&(URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},e.prototype.appendInitSegment=function(nt,rt){if(void 0===rt&&(rt=void 0),!this._mediaSource||"open"!==this._mediaSource.readyState||!1===this._mediaSource.streaming)return this._pendingSourceBufferInit.push(nt),void this._pendingSegments[nt.type].push(nt);var it=nt,at="".concat(it.container);it.codec&&it.codec.length>0&&("opus"===it.codec&&lt.a.safari&&(it.codec="Opus"),at+=";codecs=".concat(it.codec));var st=!1;if(ot.a.v(this.TAG,"Received Initialization Segment, mimeType: "+at),this._lastInitSegments[it.type]=it,at!==this._mimeTypes[it.type]){if(this._mimeTypes[it.type])ot.a.v(this.TAG,"Notice: ".concat(it.type," mimeType changed, origin: ").concat(this._mimeTypes[it.type],", target: ").concat(at));else{st=!0;try{var ct=this._sourceBuffers[it.type]=this._mediaSource.addSourceBuffer(at);ct.addEventListener("error",this.e.onSourceBufferError),ct.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(nt){return ot.a.e(this.TAG,nt.message),void this._emitter.emit(ut.a.ERROR,{code:nt.code,msg:nt.message})}}this._mimeTypes[it.type]=at}rt||this._pendingSegments[it.type].push(it),st||this._sourceBuffers[it.type]&&!this._sourceBuffers[it.type].updating&&this._doAppendSegments(),lt.a.safari&&"audio/mpeg"===it.container&&it.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=it.mediaDuration/1e3,this._updateMediaSourceDuration())},e.prototype.appendMediaSegment=function(nt){var rt=nt;this._pendingSegments[rt.type].push(rt),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var it=this._sourceBuffers[rt.type];!it||it.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},e.prototype.flush=function(){for(var nt in this._sourceBuffers)if(this._sourceBuffers[nt]){var rt=this._sourceBuffers[nt];if("open"===this._mediaSource.readyState)try{rt.abort()}catch(nt){ot.a.e(this.TAG,nt.message)}var it=this._pendingSegments[nt];if(it.splice(0,it.length),"closed"!==this._mediaSource.readyState){for(var at=0;at<rt.buffered.length;at++){var st=rt.buffered.start(at),ut=rt.buffered.end(at);this._pendingRemoveRanges[nt].push({start:st,end:ut})}if(rt.updating||this._doRemoveRanges(),lt.a.safari){var ct=this._lastInitSegments[nt];ct&&(this._pendingSegments[nt].push(ct),rt.updating||this._doAppendSegments())}}}},e.prototype.endOfStream=function(){var nt=this._mediaSource,rt=this._sourceBuffers;nt&&"open"===nt.readyState?rt.video&&rt.video.updating||rt.audio&&rt.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,nt.endOfStream()):nt&&"closed"===nt.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},e.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var nt=this._mediaElementProxy.getCurrentTime();for(var rt in this._sourceBuffers){var it=this._sourceBuffers[rt];if(it){var at=it.buffered;if(at.length>=1&&nt-at.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},e.prototype._doCleanupSourceBuffer=function(){var nt=this._mediaElementProxy.getCurrentTime();for(var rt in this._sourceBuffers){var it=this._sourceBuffers[rt];if(it){for(var at=it.buffered,st=!1,ot=0;ot<at.length;ot++){var lt=at.start(ot),ut=at.end(ot);if(lt<=nt&&nt<ut+3){if(nt-lt>=this._config.autoCleanupMaxBackwardDuration){st=!0;var ct=nt-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[rt].push({start:lt,end:ct})}}else ut<nt&&(st=!0,this._pendingRemoveRanges[rt].push({start:lt,end:ut}))}st&&!it.updating&&this._doRemoveRanges()}}},e.prototype._updateMediaSourceDuration=function(){var nt=this._sourceBuffers;if(0!==this._mediaElementProxy.getReadyState()&&"open"===this._mediaSource.readyState&&!(nt.video&&nt.video.updating||nt.audio&&nt.audio.updating)){var rt=this._mediaSource.duration,it=this._pendingMediaDuration;it>0&&(isNaN(rt)||it>rt)&&(ot.a.v(this.TAG,"Update MediaSource duration from ".concat(rt," to ").concat(it)),this._mediaSource.duration=it),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},e.prototype._doRemoveRanges=function(){for(var nt in this._pendingRemoveRanges)if(this._sourceBuffers[nt]&&!this._sourceBuffers[nt].updating)for(var rt=this._sourceBuffers[nt],it=this._pendingRemoveRanges[nt];it.length&&!rt.updating;){var at=it.shift();rt.remove(at.start,at.end)}},e.prototype._doAppendSegments=function(){var nt=this._pendingSegments;for(var rt in nt)if(this._sourceBuffers[rt]&&!this._sourceBuffers[rt].updating&&!1!==this._mediaSource.streaming&&nt[rt].length>0){var it=nt[rt].shift();if("number"==typeof it.timestampOffset&&isFinite(it.timestampOffset)){var at=this._sourceBuffers[rt].timestampOffset,st=it.timestampOffset/1e3;Math.abs(at-st)>.1&&(ot.a.v(this.TAG,"Update MPEG audio timestampOffset from ".concat(at," to ").concat(st)),this._sourceBuffers[rt].timestampOffset=st),delete it.timestampOffset}if(!it.data||0===it.data.byteLength)continue;try{this._sourceBuffers[rt].appendBuffer(it.data),this._isBufferFull=!1}catch(nt){this._pendingSegments[rt].unshift(it),22===nt.code?(this._isBufferFull||this._emitter.emit(ut.a.BUFFER_FULL),this._isBufferFull=!0):(ot.a.e(this.TAG,nt.message),this._emitter.emit(ut.a.ERROR,{code:nt.code,msg:nt.message}))}}},e.prototype._onSourceOpen=function(){if(ot.a.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var nt=this._pendingSourceBufferInit;nt.length;){var rt=nt.shift();this.appendInitSegment(rt,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(ut.a.SOURCE_OPEN)},e.prototype._onStartStreaming=function(){ot.a.v(this.TAG,"ManagedMediaSource onStartStreaming"),this._emitter.emit(ut.a.START_STREAMING)},e.prototype._onEndStreaming=function(){ot.a.v(this.TAG,"ManagedMediaSource onEndStreaming"),this._emitter.emit(ut.a.END_STREAMING)},e.prototype._onQualityChange=function(){ot.a.v(this.TAG,"ManagedMediaSource onQualityChange")},e.prototype._onSourceEnded=function(){ot.a.v(this.TAG,"MediaSource onSourceEnded")},e.prototype._onSourceClose=function(){ot.a.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(this._mediaSource.removeEventListener("startstreaming",this.e.onStartStreaming),this._mediaSource.removeEventListener("endstreaming",this.e.onEndStreaming),this._mediaSource.removeEventListener("qualitychange",this.e.onQualityChange)))},e.prototype._hasPendingSegments=function(){var nt=this._pendingSegments;return nt.video.length>0||nt.audio.length>0},e.prototype._hasPendingRemoveRanges=function(){var nt=this._pendingRemoveRanges;return nt.video.length>0||nt.audio.length>0},e.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(ut.a.UPDATE_END)},e.prototype._onSourceBufferError=function(nt){ot.a.e(this.TAG,"SourceBuffer Error: ".concat(nt))},e}();rt.a=dt},function(nt,rt,it){var at=it(9),st=it.n(at),ot=it(18),lt=it.n(ot),ut=it(0),ct=it(8),dt=it(13),ht=it(1),pt=(it(19),it(12)),_t=function(){function e(nt,rt){if(this.TAG="Transmuxer",this._emitter=new st.a,rt.enableWorker&&"undefined"!=typeof Worker)try{this._worker=lt()(19),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[nt,rt]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},ct.a.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:ct.a.getConfig()})}catch(it){ut.a.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new dt.a(nt,rt)}else this._controller=new dt.a(nt,rt);if(this._controller){var it=this._controller;it.on(ht.a.IO_ERROR,this._onIOError.bind(this)),it.on(ht.a.DEMUX_ERROR,this._onDemuxError.bind(this)),it.on(ht.a.INIT_SEGMENT,this._onInitSegment.bind(this)),it.on(ht.a.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),it.on(ht.a.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),it.on(ht.a.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),it.on(ht.a.MEDIA_INFO,this._onMediaInfo.bind(this)),it.on(ht.a.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),it.on(ht.a.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),it.on(ht.a.TIMED_ID3_METADATA_ARRIVED,this._onTimedID3MetadataArrived.bind(this)),it.on(ht.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,this._onSynchronousKLVMetadataArrived.bind(this)),it.on(ht.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,this._onAsynchronousKLVMetadataArrived.bind(this)),it.on(ht.a.SMPTE2038_METADATA_ARRIVED,this._onSMPTE2038MetadataArrived.bind(this)),it.on(ht.a.SCTE35_METADATA_ARRIVED,this._onSCTE35MetadataArrived.bind(this)),it.on(ht.a.PES_PRIVATE_DATA_DESCRIPTOR,this._onPESPrivateDataDescriptor.bind(this)),it.on(ht.a.PES_PRIVATE_DATA_ARRIVED,this._onPESPrivateDataArrived.bind(this)),it.on(ht.a.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),it.on(ht.a.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return e.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),ct.a.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(nt,rt){this._emitter.addListener(nt,rt)},e.prototype.off=function(nt,rt){this._emitter.removeListener(nt,rt)},e.prototype.hasWorker=function(){return null!=this._worker},e.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},e.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},e.prototype.seek=function(nt){this._worker?this._worker.postMessage({cmd:"seek",param:nt}):this._controller.seek(nt)},e.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},e.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},e.prototype._onInitSegment=function(nt,rt){var it=this;Promise.resolve().then((function(){it._emitter.emit(ht.a.INIT_SEGMENT,nt,rt)}))},e.prototype._onMediaSegment=function(nt,rt){var it=this;Promise.resolve().then((function(){it._emitter.emit(ht.a.MEDIA_SEGMENT,nt,rt)}))},e.prototype._onLoadingComplete=function(){var nt=this;Promise.resolve().then((function(){nt._emitter.emit(ht.a.LOADING_COMPLETE)}))},e.prototype._onRecoveredEarlyEof=function(){var nt=this;Promise.resolve().then((function(){nt._emitter.emit(ht.a.RECOVERED_EARLY_EOF)}))},e.prototype._onMediaInfo=function(nt){var rt=this;Promise.resolve().then((function(){rt._emitter.emit(ht.a.MEDIA_INFO,nt)}))},e.prototype._onMetaDataArrived=function(nt){var rt=this;Promise.resolve().then((function(){rt._emitter.emit(ht.a.METADATA_ARRIVED,nt)}))},e.prototype._onScriptDataArrived=function(nt){var rt=this;Promise.resolve().then((function(){rt._emitter.emit(ht.a.SCRIPTDATA_ARRIVED,nt)}))},e.prototype._onTimedID3MetadataArrived=function(nt){var rt=this;Promise.resolve().then((function(){rt._emitter.emit(ht.a.TIMED_ID3_METADATA_ARRIVED,nt)}))},e.prototype._onSynchronousKLVMetadataArrived=function(nt){var rt=this;Promise.resolve().then((function(){rt._emitter.emit(ht.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,nt)}))},e.prototype._onAsynchronousKLVMetadataArrived=function(nt){var rt=this;Promise.resolve().then((function(){rt._emitter.emit(ht.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,nt)}))},e.prototype._onSMPTE2038MetadataArrived=function(nt){var rt=this;Promise.resolve().then((function(){rt._emitter.emit(ht.a.SMPTE2038_METADATA_ARRIVED,nt)}))},e.prototype._onSCTE35MetadataArrived=function(nt){var rt=this;Promise.resolve().then((function(){rt._emitter.emit(ht.a.SCTE35_METADATA_ARRIVED,nt)}))},e.prototype._onPESPrivateDataDescriptor=function(nt){var rt=this;Promise.resolve().then((function(){rt._emitter.emit(ht.a.PES_PRIVATE_DATA_DESCRIPTOR,nt)}))},e.prototype._onPESPrivateDataArrived=function(nt){var rt=this;Promise.resolve().then((function(){rt._emitter.emit(ht.a.PES_PRIVATE_DATA_ARRIVED,nt)}))},e.prototype._onStatisticsInfo=function(nt){var rt=this;Promise.resolve().then((function(){rt._emitter.emit(ht.a.STATISTICS_INFO,nt)}))},e.prototype._onIOError=function(nt,rt){var it=this;Promise.resolve().then((function(){it._emitter.emit(ht.a.IO_ERROR,nt,rt)}))},e.prototype._onDemuxError=function(nt,rt){var it=this;Promise.resolve().then((function(){it._emitter.emit(ht.a.DEMUX_ERROR,nt,rt)}))},e.prototype._onRecommendSeekpoint=function(nt){var rt=this;Promise.resolve().then((function(){rt._emitter.emit(ht.a.RECOMMEND_SEEKPOINT,nt)}))},e.prototype._onLoggingConfigChanged=function(nt){this._worker&&this._worker.postMessage({cmd:"logging_config",param:nt})},e.prototype._onWorkerMessage=function(nt){var rt=nt.data,it=rt.data;if("destroyed"===rt.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(rt.msg){case ht.a.INIT_SEGMENT:case ht.a.MEDIA_SEGMENT:this._emitter.emit(rt.msg,it.type,it.data);break;case ht.a.LOADING_COMPLETE:case ht.a.RECOVERED_EARLY_EOF:this._emitter.emit(rt.msg);break;case ht.a.MEDIA_INFO:Object.setPrototypeOf(it,pt.a.prototype),this._emitter.emit(rt.msg,it);break;case ht.a.METADATA_ARRIVED:case ht.a.SCRIPTDATA_ARRIVED:case ht.a.TIMED_ID3_METADATA_ARRIVED:case ht.a.SYNCHRONOUS_KLV_METADATA_ARRIVED:case ht.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED:case ht.a.SMPTE2038_METADATA_ARRIVED:case ht.a.SCTE35_METADATA_ARRIVED:case ht.a.PES_PRIVATE_DATA_DESCRIPTOR:case ht.a.PES_PRIVATE_DATA_ARRIVED:case ht.a.STATISTICS_INFO:this._emitter.emit(rt.msg,it);break;case ht.a.IO_ERROR:case ht.a.DEMUX_ERROR:this._emitter.emit(rt.msg,it.type,it.info);break;case ht.a.RECOMMEND_SEEKPOINT:this._emitter.emit(rt.msg,it);break;case"logcat_callback":ut.a.emitter.emit("log",it.type,it.logcat)}},e}();rt.a=_t},function(nt,rt,it){function n(nt){var rt={};function i(it){if(rt[it])return rt[it].exports;var at=rt[it]={i:it,l:!1,exports:{}};return nt[it].call(at.exports,at,at.exports,i),at.l=!0,at.exports}i.m=nt,i.c=rt,i.i=function(nt){return nt},i.d=function(nt,rt,it){i.o(nt,rt)||Object.defineProperty(nt,rt,{configurable:!1,enumerable:!0,get:it})},i.r=function(nt){Object.defineProperty(nt,"__esModule",{value:!0})},i.n=function(nt){var rt=nt&&nt.__esModule?function(){return nt.default}:function(){return nt};return i.d(rt,"a",rt),rt},i.o=function(nt,rt){return Object.prototype.hasOwnProperty.call(nt,rt)},i.p="/",i.oe=function(nt){throw console.error(nt),nt};var it=i(i.s=ENTRY_MODULE);return it.default||it}function a(nt){return(nt+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function r(nt,rt,at){var st={};st[at]=[];var ot=rt.toString(),lt=ot.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!lt)return st;for(var ut,ct=lt[1],dt=new RegExp("(\\\\n|\\W)"+a(ct)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");ut=dt.exec(ot);)"dll-reference"!==ut[3]&&st[at].push(ut[3]);for(dt=new RegExp("\\("+a(ct)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");ut=dt.exec(ot);)nt[ut[2]]||(st[at].push(ut[1]),nt[ut[2]]=it(ut[1]).m),st[ut[2]]=st[ut[2]]||[],st[ut[2]].push(ut[4]);for(var ht,pt=Object.keys(st),_t=0;_t<pt.length;_t++)for(var Et=0;Et<st[pt[_t]].length;Et++)ht=st[pt[_t]][Et],isNaN(1*ht)||(st[pt[_t]][Et]=1*st[pt[_t]][Et]);return st}function o(nt){return Object.keys(nt).reduce((function(rt,it){return rt||nt[it].length>0}),!1)}nt.exports=function(nt,rt){rt=rt||{};var at={main:it.m},st=rt.all?{main:Object.keys(at.main)}:function(nt,rt){for(var it={main:[rt]},at={main:[]},st={main:{}};o(it);)for(var ot=Object.keys(it),lt=0;lt<ot.length;lt++){var ut=ot[lt],ct=it[ut].pop();if(st[ut]=st[ut]||{},!st[ut][ct]&&nt[ut][ct]){st[ut][ct]=!0,at[ut]=at[ut]||[],at[ut].push(ct);for(var dt=r(nt,nt[ut][ct],ut),ht=Object.keys(dt),pt=0;pt<ht.length;pt++)it[ht[pt]]=it[ht[pt]]||[],it[ht[pt]]=it[ht[pt]].concat(dt[ht[pt]])}}return at}(at,nt),ot="";Object.keys(st).filter((function(nt){return"main"!==nt})).forEach((function(nt){for(var rt=0;st[nt][rt];)rt++;st[nt].push(rt),at[nt][rt]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",ot=ot+"var "+nt+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(rt))+")({"+st[nt].map((function(rt){return JSON.stringify(rt)+": "+at[nt][rt].toString()})).join(",")+"});\n"})),ot=ot+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(nt))+")({"+st.main.map((function(nt){return JSON.stringify(nt)+": "+at.main[nt].toString()})).join(",")+"}))(self);";var lt=new self.Blob([ot],{type:"text/javascript"});if(rt.bare)return lt;var ut=(self.URL||self.webkitURL||self.mozURL||self.msURL).createObjectURL(lt),ct=new self.Worker(ut);return ct.objectURL=ut,ct}},function(nt,rt,it){it.r(rt),it(0);var at=it(8),st=it(15),ot=it(13),lt=it(1);rt.default=function(nt){var rt=null,it=function(rt,it){nt.postMessage({msg:"logcat_callback",data:{type:rt,logcat:it}})}.bind(this);function s(rt,it){var at={msg:lt.a.INIT_SEGMENT,data:{type:rt,data:it}};nt.postMessage(at,[it.data])}function d(rt,it){var at={msg:lt.a.MEDIA_SEGMENT,data:{type:rt,data:it}};nt.postMessage(at,[it.data])}function _(){var rt={msg:lt.a.LOADING_COMPLETE};nt.postMessage(rt)}function c(){var rt={msg:lt.a.RECOVERED_EARLY_EOF};nt.postMessage(rt)}function h(rt){var it={msg:lt.a.MEDIA_INFO,data:rt};nt.postMessage(it)}function l(rt){var it={msg:lt.a.METADATA_ARRIVED,data:rt};nt.postMessage(it)}function u(rt){var it={msg:lt.a.SCRIPTDATA_ARRIVED,data:rt};nt.postMessage(it)}function f(rt){var it={msg:lt.a.TIMED_ID3_METADATA_ARRIVED,data:rt};nt.postMessage(it)}function p(rt){var it={msg:lt.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,data:rt};nt.postMessage(it)}function m(rt){var it={msg:lt.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,data:rt};nt.postMessage(it)}function g(rt){var it={msg:lt.a.SMPTE2038_METADATA_ARRIVED,data:rt};nt.postMessage(it)}function v(rt){var it={msg:lt.a.SCTE35_METADATA_ARRIVED,data:rt};nt.postMessage(it)}function y(rt){var it={msg:lt.a.PES_PRIVATE_DATA_DESCRIPTOR,data:rt};nt.postMessage(it)}function S(rt){var it={msg:lt.a.PES_PRIVATE_DATA_ARRIVED,data:rt};nt.postMessage(it)}function b(rt){var it={msg:lt.a.STATISTICS_INFO,data:rt};nt.postMessage(it)}function A(rt,it){nt.postMessage({msg:lt.a.IO_ERROR,data:{type:rt,info:it}})}function E(rt,it){nt.postMessage({msg:lt.a.DEMUX_ERROR,data:{type:rt,info:it}})}function R(rt){nt.postMessage({msg:lt.a.RECOMMEND_SEEKPOINT,data:rt})}st.a.install(),nt.addEventListener("message",(function(st){switch(st.data.cmd){case"init":(rt=new ot.a(st.data.param[0],st.data.param[1])).on(lt.a.IO_ERROR,A.bind(this)),rt.on(lt.a.DEMUX_ERROR,E.bind(this)),rt.on(lt.a.INIT_SEGMENT,s.bind(this)),rt.on(lt.a.MEDIA_SEGMENT,d.bind(this)),rt.on(lt.a.LOADING_COMPLETE,_.bind(this)),rt.on(lt.a.RECOVERED_EARLY_EOF,c.bind(this)),rt.on(lt.a.MEDIA_INFO,h.bind(this)),rt.on(lt.a.METADATA_ARRIVED,l.bind(this)),rt.on(lt.a.SCRIPTDATA_ARRIVED,u.bind(this)),rt.on(lt.a.TIMED_ID3_METADATA_ARRIVED,f.bind(this)),rt.on(lt.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,p.bind(this)),rt.on(lt.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,m.bind(this)),rt.on(lt.a.SMPTE2038_METADATA_ARRIVED,g.bind(this)),rt.on(lt.a.SCTE35_METADATA_ARRIVED,v.bind(this)),rt.on(lt.a.PES_PRIVATE_DATA_DESCRIPTOR,y.bind(this)),rt.on(lt.a.PES_PRIVATE_DATA_ARRIVED,S.bind(this)),rt.on(lt.a.STATISTICS_INFO,b.bind(this)),rt.on(lt.a.RECOMMEND_SEEKPOINT,R.bind(this));break;case"destroy":rt&&(rt.destroy(),rt=null),nt.postMessage({msg:"destroyed"});break;case"start":rt.start();break;case"stop":rt.stop();break;case"seek":rt.seek(st.data.param);break;case"pause":rt.pause();break;case"resume":rt.resume();break;case"logging_config":var ut=st.data.param;at.a.applyConfig(ut),!0===ut.enableCallback?at.a.addLogListener(it):at.a.removeLogListener(it)}}))}},function(nt,rt,it){nt.exports=it(25).default},function(nt,rt,it){(function(rt,it){var at;at=function(){function e(nt){return"function"==typeof nt}var nt=Array.isArray?Array.isArray:function(nt){return"[object Array]"===Object.prototype.toString.call(nt)},at=0,st=void 0,ot=void 0,s=function(nt,rt){pt[at]=nt,pt[at+1]=rt,2===(at+=2)&&(ot?ot(p):Lt())},lt="undefined"!=typeof window?window:void 0,ut=lt||{},ct=ut.MutationObserver||ut.WebKitMutationObserver,dt="undefined"==typeof self&&void 0!==rt&&"[object process]"==={}.toString.call(rt),ht="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function u(){var nt=setTimeout;return function(){return nt(p,1)}}var pt=new Array(1e3);function p(){for(var nt=0;nt<at;nt+=2)(0,pt[nt])(pt[nt+1]),pt[nt]=void 0,pt[nt+1]=void 0;at=0}var _t,Et,St,wt,Lt=void 0;function b(nt,rt){var it=this,at=new this.constructor(R);void 0===at[Ct]&&I(at);var st=it._state;if(st){var ot=arguments[st-1];s((function(){return O(st,at,ot,it._result)}))}else C(it,at,nt,rt);return at}function A(nt){if(nt&&"object"==typeof nt&&nt.constructor===this)return nt;var rt=new this(R);return L(rt,nt),rt}dt?Lt=function(){return rt.nextTick(p)}:ct?(Et=0,St=new ct(p),wt=document.createTextNode(""),St.observe(wt,{characterData:!0}),Lt=function(){wt.data=Et=++Et%2}):ht?((_t=new MessageChannel).port1.onmessage=p,Lt=function(){return _t.port2.postMessage(0)}):Lt=void 0===lt?function(){try{var nt=Function("return this")().require("vertx");return void 0!==(st=nt.runOnLoop||nt.runOnContext)?function(){st(p)}:u()}catch(nt){return u()}}():u();var Ct=Math.random().toString(36).substring(2);function R(){}function T(nt,rt,it){rt.constructor===nt.constructor&&it===b&&rt.constructor.resolve===A?function(nt,rt){1===rt._state?w(nt,rt._result):2===rt._state?M(nt,rt._result):C(rt,void 0,(function(rt){return L(nt,rt)}),(function(rt){return M(nt,rt)}))}(nt,rt):void 0===it?w(nt,rt):e(it)?function(nt,rt,it){s((function(nt){var at=!1,st=function(nt,rt,it,at){try{nt.call(rt,it,at)}catch(nt){return nt}}(it,rt,(function(it){at||(at=!0,rt!==it?L(nt,it):w(nt,it))}),(function(rt){at||(at=!0,M(nt,rt))}),nt._label);!at&&st&&(at=!0,M(nt,st))}),nt)}(nt,rt,it):w(nt,rt)}function L(nt,rt){if(nt===rt)M(nt,new TypeError("You cannot resolve a promise with itself"));else if(st=typeof(at=rt),null===at||"object"!==st&&"function"!==st)w(nt,rt);else{var it=void 0;try{it=rt.then}catch(rt){return void M(nt,rt)}T(nt,rt,it)}var at,st}function k(nt){nt._onerror&&nt._onerror(nt._result),D(nt)}function w(nt,rt){void 0===nt._state&&(nt._result=rt,nt._state=1,0!==nt._subscribers.length&&s(D,nt))}function M(nt,rt){void 0===nt._state&&(nt._state=2,nt._result=rt,s(k,nt))}function C(nt,rt,it,at){var st=nt._subscribers,ot=st.length;nt._onerror=null,st[ot]=rt,st[ot+1]=it,st[ot+2]=at,0===ot&&nt._state&&s(D,nt)}function D(nt){var rt=nt._subscribers,it=nt._state;if(0!==rt.length){for(var at=void 0,st=void 0,ot=nt._result,lt=0;lt<rt.length;lt+=3)at=rt[lt],st=rt[lt+it],at?O(it,at,st,ot):st(ot);nt._subscribers.length=0}}function O(nt,rt,it,at){var st=e(it),ot=void 0,lt=void 0,ut=!0;if(st){try{ot=it(at)}catch(nt){ut=!1,lt=nt}if(rt===ot)return void M(rt,new TypeError("A promises callback cannot return that same promise."))}else ot=at;void 0!==rt._state||(st&&ut?L(rt,ot):!1===ut?M(rt,lt):1===nt?w(rt,ot):2===nt&&M(rt,ot))}var Pt=0;function I(nt){nt[Ct]=Pt++,nt._state=void 0,nt._result=void 0,nt._subscribers=[]}var kt=function(){function e(rt,it){this._instanceConstructor=rt,this.promise=new rt(R),this.promise[Ct]||I(this.promise),nt(it)?(this.length=it.length,this._remaining=it.length,this._result=new Array(this.length),0===this.length?w(this.promise,this._result):(this.length=this.length||0,this._enumerate(it),0===this._remaining&&w(this.promise,this._result))):M(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(nt){for(var rt=0;void 0===this._state&&rt<nt.length;rt++)this._eachEntry(nt[rt],rt)},e.prototype._eachEntry=function(nt,rt){var it=this._instanceConstructor,at=it.resolve;if(at===A){var st=void 0,ot=void 0,lt=!1;try{st=nt.then}catch(nt){lt=!0,ot=nt}if(st===b&&void 0!==nt._state)this._settledAt(nt._state,rt,nt._result);else if("function"!=typeof st)this._remaining--,this._result[rt]=nt;else if(it===Ot){var ut=new it(R);lt?M(ut,ot):T(ut,nt,st),this._willSettleAt(ut,rt)}else this._willSettleAt(new it((function(rt){return rt(nt)})),rt)}else this._willSettleAt(at(nt),rt)},e.prototype._settledAt=function(nt,rt,it){var at=this.promise;void 0===at._state&&(this._remaining--,2===nt?M(at,it):this._result[rt]=it),0===this._remaining&&w(at,this._result)},e.prototype._willSettleAt=function(nt,rt){var it=this;C(nt,void 0,(function(nt){return it._settledAt(1,rt,nt)}),(function(nt){return it._settledAt(2,rt,nt)}))},e}(),Ot=function(){function t(nt){this[Ct]=Pt++,this._result=this._state=void 0,this._subscribers=[],R!==nt&&("function"!=typeof nt&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(nt,rt){try{rt((function(rt){L(nt,rt)}),(function(rt){M(nt,rt)}))}catch(rt){M(nt,rt)}}(this,nt):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(nt){return this.then(null,nt)},t.prototype.finally=function(nt){var rt=this.constructor;return e(nt)?this.then((function(it){return rt.resolve(nt()).then((function(){return it}))}),(function(it){return rt.resolve(nt()).then((function(){throw it}))})):this.then(nt,nt)},t}();return Ot.prototype.then=b,Ot.all=function(nt){return new kt(this,nt).promise},Ot.race=function(rt){var it=this;return nt(rt)?new it((function(nt,at){for(var st=rt.length,ot=0;ot<st;ot++)it.resolve(rt[ot]).then(nt,at)})):new it((function(nt,rt){return rt(new TypeError("You must pass an array to race."))}))},Ot.resolve=A,Ot.reject=function(nt){var rt=new this(R);return M(rt,nt),rt},Ot._setScheduler=function(nt){ot=nt},Ot._setAsap=function(nt){s=nt},Ot._asap=s,Ot.polyfill=function(){var nt=void 0;if(void 0!==it)nt=it;else if("undefined"!=typeof self)nt=self;else try{nt=Function("return this")()}catch(nt){throw new Error("polyfill failed because global object is unavailable in this environment")}var rt=nt.Promise;if(rt){var at=null;try{at=Object.prototype.toString.call(rt.resolve())}catch(nt){}if("[object Promise]"===at&&!rt.cast)return}nt.Promise=Ot},Ot.Promise=Ot,Ot},nt.exports=at()}).call(this,it(22),it(23))},function(nt,rt){var it,at,st=nt.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(nt){if(it===setTimeout)return setTimeout(nt,0);if((it===r||!it)&&setTimeout)return it=setTimeout,setTimeout(nt,0);try{return it(nt,0)}catch(rt){try{return it.call(null,nt,0)}catch(rt){return it.call(this,nt,0)}}}!function(){try{it="function"==typeof setTimeout?setTimeout:r}catch(nt){it=r}try{at="function"==typeof clearTimeout?clearTimeout:o}catch(nt){at=o}}();var ot,lt=[],ut=!1,ct=-1;function l(){ut&&ot&&(ut=!1,ot.length?lt=ot.concat(lt):ct=-1,lt.length&&u())}function u(){if(!ut){var nt=s(l);ut=!0;for(var rt=lt.length;rt;){for(ot=lt,lt=[];++ct<rt;)ot&&ot[ct].run();ct=-1,rt=lt.length}ot=null,ut=!1,function(nt){if(at===clearTimeout)return clearTimeout(nt);if((at===o||!at)&&clearTimeout)return at=clearTimeout,clearTimeout(nt);try{at(nt)}catch(rt){try{return at.call(null,nt)}catch(rt){return at.call(this,nt)}}}(nt)}}function f(nt,rt){this.fun=nt,this.array=rt}function p(){}st.nextTick=function(nt){var rt=new Array(arguments.length-1);if(arguments.length>1)for(var it=1;it<arguments.length;it++)rt[it-1]=arguments[it];lt.push(new f(nt,rt)),1!==lt.length||ut||s(u)},f.prototype.run=function(){this.fun.apply(null,this.array)},st.title="browser",st.browser=!0,st.env={},st.argv=[],st.version="",st.versions={},st.on=p,st.addListener=p,st.once=p,st.off=p,st.removeListener=p,st.removeAllListeners=p,st.emit=p,st.prependListener=p,st.prependOnceListener=p,st.listeners=function(nt){return[]},st.binding=function(nt){throw new Error("process.binding is not supported")},st.cwd=function(){return"/"},st.chdir=function(nt){throw new Error("process.chdir is not supported")},st.umask=function(){return 0}},function(nt,rt){var it;it=function(){return this}();try{it=it||new Function("return this")()}catch(nt){"object"==typeof window&&(it=window)}nt.exports=it},function(nt,rt,it){it.r(rt);var at=it(0),st=it(8),ot=it(3),lt=it(7),ut=it(16),ct=it(17),dt=it(1),ht=it(4),pt=it(10);rt.default=function(nt){var rt="PlayerEngineWorker",it=function(rt,it){nt.postMessage({msg:"logcat_callback",type:rt,logcat:it})}.bind(void 0),_t=null,Et=null,St=null,wt=null,Lt=!1,Ct=!1,Pt=0,kt=0,Ot=!1;function b(){St&&(St.shutdown(),St.destroy(),St=null)}function A(){if(null==_t||null==Et)throw new ot.a("Worker not initialized");if(wt)throw new ot.a("Transmuxer has been initialized");Ct||(!Et.deferLoadAfterSourceOpen||Lt?((wt=new ct.a(_t,Et)).on(dt.a.INIT_SEGMENT,(function(nt,rt){St.appendInitSegment(rt)})),wt.on(dt.a.MEDIA_SEGMENT,(function(rt,it){St.appendMediaSegment(it),nt.postMessage({msg:"buffered_position_changed",buffered_position_milliseconds:it.info.endDts})})),wt.on(dt.a.LOADING_COMPLETE,(function(){St.endOfStream(),nt.postMessage({msg:"player_event",event:ht.a.LOADING_COMPLETE})})),wt.on(dt.a.RECOVERED_EARLY_EOF,(function(){nt.postMessage({msg:"player_event",event:ht.a.RECOVERED_EARLY_EOF})})),wt.on(dt.a.IO_ERROR,(function(rt,it){nt.postMessage({msg:"player_event",event:ht.a.ERROR,error_type:pt.b.NETWORK_ERROR,error_detail:rt,info:it})})),wt.on(dt.a.DEMUX_ERROR,(function(rt,it){nt.postMessage({msg:"player_event",event:ht.a.ERROR,error_type:pt.b.MEDIA_ERROR,error_detail:rt,info:it})})),wt.on(dt.a.MEDIA_INFO,(function(nt){w(dt.a.MEDIA_INFO,nt)})),wt.on(dt.a.STATISTICS_INFO,(function(nt){w(dt.a.STATISTICS_INFO,nt)})),wt.on(dt.a.RECOMMEND_SEEKPOINT,(function(rt){!function(rt){nt.postMessage({msg:"transmuxing_event",event:dt.a.RECOMMEND_SEEKPOINT,milliseconds:rt})}(rt)})),wt.on(dt.a.METADATA_ARRIVED,(function(nt){M(ht.a.METADATA_ARRIVED,nt)})),wt.on(dt.a.SCRIPTDATA_ARRIVED,(function(nt){M(ht.a.SCRIPTDATA_ARRIVED,nt)})),wt.on(dt.a.TIMED_ID3_METADATA_ARRIVED,(function(nt){M(ht.a.TIMED_ID3_METADATA_ARRIVED,nt)})),wt.on(dt.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,(function(nt){M(ht.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,nt)})),wt.on(dt.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,(function(nt){M(ht.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,nt)})),wt.on(dt.a.SMPTE2038_METADATA_ARRIVED,(function(nt){M(ht.a.SMPTE2038_METADATA_ARRIVED,nt)})),wt.on(dt.a.SCTE35_METADATA_ARRIVED,(function(nt){M(ht.a.SCTE35_METADATA_ARRIVED,nt)})),wt.on(dt.a.PES_PRIVATE_DATA_DESCRIPTOR,(function(nt){M(ht.a.PES_PRIVATE_DATA_DESCRIPTOR,nt)})),wt.on(dt.a.PES_PRIVATE_DATA_ARRIVED,(function(nt){M(ht.a.PES_PRIVATE_DATA_ARRIVED,nt)})),wt.open()):Ct=!0)}function E(){St&&St.flush(),wt&&(wt.close(),wt.destroy(),wt=null)}function R(){Lt=!0,Ct&&(Ct=!1,A())}function T(){nt.postMessage({msg:"mse_event",event:lt.a.UPDATE_END})}function L(){at.a.v(rt,"MSE SourceBuffer is full, report to main thread"),nt.postMessage({msg:"mse_event",event:lt.a.BUFFER_FULL})}function k(rt){nt.postMessage({msg:"player_event",event:ht.a.ERROR,error_type:pt.b.MEDIA_ERROR,error_detail:pt.b.MEDIA_MSE_ERROR,info:rt})}function w(rt,it){nt.postMessage({msg:"transmuxing_event",event:rt,info:it})}function M(rt,it){nt.postMessage({msg:"player_event",event:rt,extraData:it})}nt.addEventListener("message",(function(ot){if(!Ot){var ct=ot.data;switch(ct.cmd){case"logging_config":var dt=ct;st.a.applyConfig(dt.logging_config),!0===dt.logging_config.enableCallback?st.a.addLogListener(it):st.a.removeLogListener(it);break;case"init":_t=(dt=ct).media_data_source,Et=dt.config;break;case"destroy":wt&&E(),St&&b(),Ot=!0,nt.postMessage({msg:"destroyed"});break;case"initialize_mse":!function(){at.a.v(rt,"Initializing MediaSource in DedicatedWorker"),(St=new ut.a(Et)).on(lt.a.SOURCE_OPEN,R.bind(this)),St.on(lt.a.UPDATE_END,T.bind(this)),St.on(lt.a.BUFFER_FULL,L.bind(this)),St.on(lt.a.ERROR,k.bind(this)),St.initialize({getCurrentTime:function(){return Pt},getReadyState:function(){return kt}});var it=St.getHandle();nt.postMessage({msg:"mse_init",handle:it},[it])}();break;case"shutdown_mse":b();break;case"load":A();break;case"unload":E();break;case"unbuffered_seek":dt=ct,St.flush(),wt.seek(dt.milliseconds);break;case"timeupdate":Pt=(dt=ct).current_time;break;case"readystatechange":kt=(dt=ct).ready_state;break;case"pause_transmuxer":wt.pause();break;case"resume_transmuxer":wt.resume()}}}))}},function(nt,rt,it){it.r(rt);var at=it(15),st=it(14),ot={enableWorker:!1,enableWorkerForMSE:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,liveBufferLatencyChasing:!1,liveBufferLatencyChasingOnPaused:!1,liveBufferLatencyMaxLatency:1.5,liveBufferLatencyMinRemain:.5,liveSync:!1,liveSyncMaxLatency:1.2,liveSyncTargetLatency:.8,liveSyncPlaybackRate:1.2,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function o(){return Object.assign({},ot)}var lt=function(){function e(){}return e.supportMSEH264Playback=function(){var nt=self.MediaSource&&self.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),rt=self.ManagedMediaSource&&self.ManagedMediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');return nt||rt},e.supportMSEH265Playback=function(){var nt=self.MediaSource&&self.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"'),rt=self.ManagedMediaSource&&self.ManagedMediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"');return nt||rt},e.supportNetworkStreamIO=function(){var nt=new st.a({},o()),rt=nt.loaderType;return nt.destroy(),"fetch-stream-loader"==rt||"xhr-moz-chunked-loader"==rt},e.getNetworkLoaderTypeName=function(){var nt=new st.a({},o()),rt=nt.loaderType;return nt.destroy(),rt},e.supportNativeMediaPlayback=function(nt){null==e.videoElement&&(e.videoElement=window.document.createElement("video"));var rt=e.videoElement.canPlayType(nt);return"probably"===rt||"maybe"==rt},e.getFeatureList=function(){var nt={msePlayback:!1,mseLivePlayback:!1,mseH265Playback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeMP4H265Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return nt.msePlayback=e.supportMSEH264Playback(),nt.networkStreamIO=e.supportNetworkStreamIO(),nt.networkLoaderName=e.getNetworkLoaderTypeName(),nt.mseLivePlayback=nt.msePlayback&&nt.networkStreamIO,nt.mseH265Playback=e.supportMSEH265Playback(),nt.nativeMP4H264Playback=e.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),nt.nativeMP4H265Playback=e.supportNativeMediaPlayback('video/mp4; codecs="hvc1.1.6.L93.B0"'),nt.nativeWebmVP8Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),nt.nativeWebmVP9Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp9"'),nt},e}(),ut=it(2),ct=it(0),dt=it(9),ht=it.n(dt),pt=it(16),_t=it(4),Et=it(17),St=it(7),wt=it(10),Lt=it(3),Ct=it(1),Pt=it(5),kt=it(11),Ot=function(){function e(nt,rt,it){this.TAG="SeekingHandler",this._config=null,this._media_element=null,this._always_seek_keyframe=!1,this._on_unbuffered_seek=null,this._request_set_current_time=!1,this._seek_request_record_clocktime=null,this._idr_sample_list=new kt.a,this.e=null,this._config=nt,this._media_element=rt,this._on_unbuffered_seek=it,this.e={onMediaSeeking:this._onMediaSeeking.bind(this)};var at=Pt.a.chrome&&(Pt.a.version.major<50||50===Pt.a.version.major&&Pt.a.version.build<2661);this._always_seek_keyframe=!!(at||Pt.a.msedge||Pt.a.msie),this._always_seek_keyframe&&(this._config.accurateSeek=!1),this._media_element.addEventListener("seeking",this.e.onMediaSeeking)}return e.prototype.destroy=function(){this._idr_sample_list.clear(),this._idr_sample_list=null,this._media_element.removeEventListener("seeking",this.e.onMediaSeeking),this._media_element=null,this._on_unbuffered_seek=null},e.prototype.seek=function(nt){var rt=this._isPositionBuffered(nt),it=!1;if(nt<1&&this._media_element.buffered.length>0){var at=this._media_element.buffered.start(0);(at<1&&nt<at||Pt.a.safari)&&(it=!0,nt=Pt.a.safari?.1:at)}if(it)this.directSeek(nt);else if(rt)if(this._always_seek_keyframe){var st=this._getNearestKeyframe(Math.floor(1e3*nt));null!=st&&(nt=st.dts/1e3),this.directSeek(nt)}else this.directSeek(nt);else this._idr_sample_list.clear(),this._on_unbuffered_seek(Math.floor(1e3*nt)),this._config.accurateSeek&&this.directSeek(nt)},e.prototype.directSeek=function(nt){this._request_set_current_time=!0,this._media_element.currentTime=nt},e.prototype.appendSyncPoints=function(nt){this._idr_sample_list.appendArray(nt)},e.prototype._onMediaSeeking=function(nt){if(this._request_set_current_time)this._request_set_current_time=!1;else{var rt=this._media_element.currentTime,it=this._media_element.buffered;if(rt<1&&it.length>0){var at=it.start(0);if(at<1&&rt<at||Pt.a.safari){var st=Pt.a.safari?.1:at;return void this.directSeek(st)}}if(this._isPositionBuffered(rt)){if(this._always_seek_keyframe){var ot=this._getNearestKeyframe(Math.floor(1e3*rt));null!=ot&&(rt=ot.dts/1e3,this.directSeek(rt))}}else this._seek_request_record_clocktime=e._getClockTime(),window.setTimeout(this._pollAndApplyUnbufferedSeek.bind(this),50)}},e.prototype._pollAndApplyUnbufferedSeek=function(){if(null!=this._seek_request_record_clocktime)if(this._seek_request_record_clocktime<=e._getClockTime()-100){var nt=this._media_element.currentTime;this._seek_request_record_clocktime=null,this._isPositionBuffered(nt)||(this._idr_sample_list.clear(),this._on_unbuffered_seek(Math.floor(1e3*nt)),this._config.accurateSeek&&this.directSeek(nt))}else window.setTimeout(this._pollAndApplyUnbufferedSeek.bind(this),50)},e.prototype._isPositionBuffered=function(nt){for(var rt=this._media_element.buffered,it=0;it<rt.length;it++){var at=rt.start(it),st=rt.end(it);if(nt>=at&&nt<st)return!0}return!1},e.prototype._getNearestKeyframe=function(nt){return this._idr_sample_list.getLastSyncPointBeforeDts(nt)},e._getClockTime=function(){return self.performance&&self.performance.now?self.performance.now():Date.now()},e}(),Ft=function(){function e(nt,rt,it,at){this.TAG="LoadingController",this._config=null,this._media_element=null,this._on_pause_transmuxer=null,this._on_resume_transmuxer=null,this._paused=!1,this.e=null,this._config=nt,this._media_element=rt,this._on_pause_transmuxer=it,this._on_resume_transmuxer=at,this.e={onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this)}}return e.prototype.destroy=function(){this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this.e=null,this._media_element=null,this._config=null,this._on_pause_transmuxer=null,this._on_resume_transmuxer=null},e.prototype.notifyBufferedPositionChanged=function(nt){!this._config.isLive&&this._config.lazyLoad&&(null==nt?this._suspendTransmuxerIfNeeded():this._suspendTransmuxerIfBufferedPositionExceeded(nt))},e.prototype._onMediaTimeUpdate=function(nt){this._paused&&this._resumeTransmuxerIfNeeded()},e.prototype._suspendTransmuxerIfNeeded=function(){for(var nt=this._media_element.buffered,rt=this._media_element.currentTime,it=0,at=0;at<nt.length;at++){var st=nt.start(at),ot=nt.end(at);if(st<=rt&&rt<ot){it=ot;break}}it>0&&this._suspendTransmuxerIfBufferedPositionExceeded(it)},e.prototype._suspendTransmuxerIfBufferedPositionExceeded=function(nt){nt>=this._media_element.currentTime+this._config.lazyLoadMaxDuration&&!this._paused&&(ct.a.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this.suspendTransmuxer(),this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate))},e.prototype.suspendTransmuxer=function(){this._paused=!0,this._on_pause_transmuxer()},e.prototype._resumeTransmuxerIfNeeded=function(){for(var nt=this._media_element.buffered,rt=this._media_element.currentTime,it=this._config.lazyLoadRecoverDuration,at=!1,st=0;st<nt.length;st++){var ot=nt.start(st),lt=nt.end(st);if(rt>=ot&&rt<lt){rt>=lt-it&&(at=!0);break}}at&&(ct.a.v(this.TAG,"Continue loading from paused position"),this.resumeTransmuxer(),this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate))},e.prototype.resumeTransmuxer=function(){this._paused=!1,this._on_resume_transmuxer()},e}(),Bt=function(){function e(nt,rt){this.TAG="StartupStallJumper",this._media_element=null,this._on_direct_seek=null,this._canplay_received=!1,this.e=null,this._media_element=nt,this._on_direct_seek=rt,this.e={onMediaCanPlay:this._onMediaCanPlay.bind(this),onMediaStalled:this._onMediaStalled.bind(this),onMediaProgress:this._onMediaProgress.bind(this)},this._media_element.addEventListener("canplay",this.e.onMediaCanPlay),this._media_element.addEventListener("stalled",this.e.onMediaStalled),this._media_element.addEventListener("progress",this.e.onMediaProgress)}return e.prototype.destroy=function(){this._media_element.removeEventListener("canplay",this.e.onMediaCanPlay),this._media_element.removeEventListener("stalled",this.e.onMediaStalled),this._media_element.removeEventListener("progress",this.e.onMediaProgress),this._media_element=null,this._on_direct_seek=null},e.prototype._onMediaCanPlay=function(nt){this._canplay_received=!0,this._media_element.removeEventListener("canplay",this.e.onMediaCanPlay)},e.prototype._onMediaStalled=function(nt){this._detectAndFixStuckPlayback(!0)},e.prototype._onMediaProgress=function(nt){this._detectAndFixStuckPlayback()},e.prototype._detectAndFixStuckPlayback=function(nt){var rt=this._media_element,it=rt.buffered;nt||!this._canplay_received||rt.readyState<2?it.length>0&&rt.currentTime<it.start(0)&&(ct.a.w(this.TAG,"Playback seems stuck at ".concat(rt.currentTime,", seek to ").concat(it.start(0))),this._on_direct_seek(it.start(0)),this._media_element.removeEventListener("progress",this.e.onMediaProgress)):this._media_element.removeEventListener("progress",this.e.onMediaProgress)},e}(),Ut=function(){function e(nt,rt,it){this._config=null,this._media_element=null,this._on_direct_seek=null,this._config=nt,this._media_element=rt,this._on_direct_seek=it}return e.prototype.destroy=function(){this._on_direct_seek=null,this._media_element=null,this._config=null},e.prototype.notifyBufferedRangeUpdate=function(){this._chaseLiveLatency()},e.prototype._chaseLiveLatency=function(){var nt=this._media_element.buffered,rt=this._media_element.currentTime,it=this._media_element.paused;if(this._config.isLive&&this._config.liveBufferLatencyChasing&&0!=nt.length&&(this._config.liveBufferLatencyChasingOnPaused||!it)){var at=nt.end(nt.length-1);if(at>this._config.liveBufferLatencyMaxLatency&&at-rt>this._config.liveBufferLatencyMaxLatency){var st=at-this._config.liveBufferLatencyMinRemain;this._on_direct_seek(st)}}},e}(),Gt=function(){function e(nt,rt){this._config=null,this._media_element=null,this.e=null,this._config=nt,this._media_element=rt,this.e={onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this)},this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate)}return e.prototype.destroy=function(){this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element=null,this._config=null},e.prototype._onMediaTimeUpdate=function(nt){if(this._config.isLive&&this._config.liveSync){var rt=this._getCurrentLatency();if(rt>this._config.liveSyncMaxLatency){var it=Math.min(2,Math.max(1,this._config.liveSyncPlaybackRate));this._media_element.playbackRate=it}else rt>this._config.liveSyncTargetLatency||1!==this._media_element.playbackRate&&0!==this._media_element.playbackRate&&(this._media_element.playbackRate=1)}},e.prototype._getCurrentLatency=function(){if(!this._media_element)return 0;var nt=this._media_element.buffered,rt=this._media_element.currentTime;return 0==nt.length?0:nt.end(nt.length-1)-rt},e}(),Ht=function(){function e(nt,rt){this.TAG="PlayerEngineMainThread",this._emitter=new dt,this._media_element=null,this._mse_controller=null,this._transmuxer=null,this._pending_seek_time=null,this._seeking_handler=null,this._loading_controller=null,this._startup_stall_jumper=null,this._live_latency_chaser=null,this._live_latency_synchronizer=null,this._mse_source_opened=!1,this._has_pending_load=!1,this._loaded_metadata_received=!1,this._media_info=null,this._statistics_info=null,this.e=null,this._media_data_source=nt,this._config=o(),"object"==typeof rt&&Object.assign(this._config,rt),!0===nt.isLive&&(this._config.isLive=!0),this.e={onMediaLoadedMetadata:this._onMediaLoadedMetadata.bind(this)}}return e.prototype.destroy=function(){this._emitter.emit(_t.a.DESTROYING),this._transmuxer&&this.unload(),this._media_element&&this.detachMediaElement(),this.e=null,this._media_data_source=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(nt,rt){var it=this;this._emitter.addListener(nt,rt),nt===_t.a.MEDIA_INFO&&this._media_info?Promise.resolve().then((function(){return it._emitter.emit(_t.a.MEDIA_INFO,it.mediaInfo)})):nt==_t.a.STATISTICS_INFO&&this._statistics_info&&Promise.resolve().then((function(){return it._emitter.emit(_t.a.STATISTICS_INFO,it.statisticsInfo)}))},e.prototype.off=function(nt,rt){this._emitter.removeListener(nt,rt)},e.prototype.attachMediaElement=function(nt){var rt=this;this._media_element=nt,nt.src="",nt.removeAttribute("src"),nt.srcObject=null,nt.load(),nt.addEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._mse_controller=new pt.a(this._config),this._mse_controller.on(St.a.UPDATE_END,this._onMSEUpdateEnd.bind(this)),this._mse_controller.on(St.a.BUFFER_FULL,this._onMSEBufferFull.bind(this)),this._mse_controller.on(St.a.SOURCE_OPEN,this._onMSESourceOpen.bind(this)),this._mse_controller.on(St.a.ERROR,this._onMSEError.bind(this)),this._mse_controller.on(St.a.START_STREAMING,this._onMSEStartStreaming.bind(this)),this._mse_controller.on(St.a.END_STREAMING,this._onMSEEndStreaming.bind(this)),this._mse_controller.initialize({getCurrentTime:function(){return rt._media_element.currentTime},getReadyState:function(){return rt._media_element.readyState}}),this._mse_controller.isManagedMediaSource()?(nt.disableRemotePlayback=!0,nt.srcObject=this._mse_controller.getObject()):nt.src=this._mse_controller.getObjectURL()},e.prototype.detachMediaElement=function(){this._media_element&&(this._mse_controller.shutdown(),this._media_element.removeEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element=null,this._mse_controller.revokeObjectURL()),this._mse_controller&&(this._mse_controller.destroy(),this._mse_controller=null)},e.prototype.load=function(){var nt=this;if(!this._media_element)throw new Lt.a("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new Lt.a("load() has been called, please call unload() first!");this._has_pending_load||(!this._config.deferLoadAfterSourceOpen||this._mse_source_opened?(this._transmuxer=new Et.a(this._media_data_source,this._config),this._transmuxer.on(Ct.a.INIT_SEGMENT,(function(rt,it){nt._mse_controller.appendInitSegment(it)})),this._transmuxer.on(Ct.a.MEDIA_SEGMENT,(function(rt,it){nt._mse_controller.appendMediaSegment(it),!nt._config.isLive&&"video"===rt&&it.data&&it.data.byteLength>0&&"info"in it&&nt._seeking_handler.appendSyncPoints(it.info.syncPoints),nt._loading_controller.notifyBufferedPositionChanged(it.info.endDts/1e3)})),this._transmuxer.on(Ct.a.LOADING_COMPLETE,(function(){nt._mse_controller.endOfStream(),nt._emitter.emit(_t.a.LOADING_COMPLETE)})),this._transmuxer.on(Ct.a.RECOVERED_EARLY_EOF,(function(){nt._emitter.emit(_t.a.RECOVERED_EARLY_EOF)})),this._transmuxer.on(Ct.a.IO_ERROR,(function(rt,it){nt._emitter.emit(_t.a.ERROR,wt.b.NETWORK_ERROR,rt,it)})),this._transmuxer.on(Ct.a.DEMUX_ERROR,(function(rt,it){nt._emitter.emit(_t.a.ERROR,wt.b.MEDIA_ERROR,rt,it)})),this._transmuxer.on(Ct.a.MEDIA_INFO,(function(rt){nt._media_info=rt,nt._emitter.emit(_t.a.MEDIA_INFO,Object.assign({},rt))})),this._transmuxer.on(Ct.a.STATISTICS_INFO,(function(rt){nt._statistics_info=nt._fillStatisticsInfo(rt),nt._emitter.emit(_t.a.STATISTICS_INFO,Object.assign({},rt))})),this._transmuxer.on(Ct.a.RECOMMEND_SEEKPOINT,(function(rt){nt._media_element&&!nt._config.accurateSeek&&nt._seeking_handler.directSeek(rt/1e3)})),this._transmuxer.on(Ct.a.METADATA_ARRIVED,(function(rt){nt._emitter.emit(_t.a.METADATA_ARRIVED,rt)})),this._transmuxer.on(Ct.a.SCRIPTDATA_ARRIVED,(function(rt){nt._emitter.emit(_t.a.SCRIPTDATA_ARRIVED,rt)})),this._transmuxer.on(Ct.a.TIMED_ID3_METADATA_ARRIVED,(function(rt){nt._emitter.emit(_t.a.TIMED_ID3_METADATA_ARRIVED,rt)})),this._transmuxer.on(Ct.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,(function(rt){nt._emitter.emit(_t.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,rt)})),this._transmuxer.on(Ct.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,(function(rt){nt._emitter.emit(_t.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,rt)})),this._transmuxer.on(Ct.a.SMPTE2038_METADATA_ARRIVED,(function(rt){nt._emitter.emit(_t.a.SMPTE2038_METADATA_ARRIVED,rt)})),this._transmuxer.on(Ct.a.SCTE35_METADATA_ARRIVED,(function(rt){nt._emitter.emit(_t.a.SCTE35_METADATA_ARRIVED,rt)})),this._transmuxer.on(Ct.a.PES_PRIVATE_DATA_DESCRIPTOR,(function(rt){nt._emitter.emit(_t.a.PES_PRIVATE_DATA_DESCRIPTOR,rt)})),this._transmuxer.on(Ct.a.PES_PRIVATE_DATA_ARRIVED,(function(rt){nt._emitter.emit(_t.a.PES_PRIVATE_DATA_ARRIVED,rt)})),this._seeking_handler=new Ot(this._config,this._media_element,this._onRequiredUnbufferedSeek.bind(this)),this._loading_controller=new Ft(this._config,this._media_element,this._onRequestPauseTransmuxer.bind(this),this._onRequestResumeTransmuxer.bind(this)),this._startup_stall_jumper=new Bt(this._media_element,this._onRequestDirectSeek.bind(this)),this._config.isLive&&this._config.liveBufferLatencyChasing&&(this._live_latency_chaser=new Ut(this._config,this._media_element,this._onRequestDirectSeek.bind(this))),this._config.isLive&&this._config.liveSync&&(this._live_latency_synchronizer=new Gt(this._config,this._media_element)),this._media_element.readyState>0&&this._seeking_handler.directSeek(0),this._transmuxer.open()):this._has_pending_load=!0)},e.prototype.unload=function(){var nt,rt,it,at,st,ot,lt,ut,ct;null===(nt=this._media_element)||void 0===nt||nt.pause(),null===(rt=this._live_latency_synchronizer)||void 0===rt||rt.destroy(),this._live_latency_synchronizer=null,null===(it=this._live_latency_chaser)||void 0===it||it.destroy(),this._live_latency_chaser=null,null===(at=this._startup_stall_jumper)||void 0===at||at.destroy(),this._startup_stall_jumper=null,null===(st=this._loading_controller)||void 0===st||st.destroy(),this._loading_controller=null,null===(ot=this._seeking_handler)||void 0===ot||ot.destroy(),this._seeking_handler=null,null===(lt=this._mse_controller)||void 0===lt||lt.flush(),null===(ut=this._transmuxer)||void 0===ut||ut.close(),null===(ct=this._transmuxer)||void 0===ct||ct.destroy(),this._transmuxer=null},e.prototype.play=function(){return this._media_element.play()},e.prototype.pause=function(){this._media_element.pause()},e.prototype.seek=function(nt){this._media_element&&this._seeking_handler?this._seeking_handler.seek(nt):this._pending_seek_time=nt},Object.defineProperty(e.prototype,"mediaInfo",{get:function(){return Object.assign({},this._media_info)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){return Object.assign({},this._statistics_info)},enumerable:!1,configurable:!0}),e.prototype._onMSESourceOpen=function(){this._mse_source_opened=!0,this._has_pending_load&&(this._has_pending_load=!1,this.load())},e.prototype._onMSEUpdateEnd=function(){this._config.isLive&&this._config.liveBufferLatencyChasing&&this._live_latency_chaser&&this._live_latency_chaser.notifyBufferedRangeUpdate(),this._loading_controller.notifyBufferedPositionChanged()},e.prototype._onMSEBufferFull=function(){ct.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._loading_controller.suspendTransmuxer()},e.prototype._onMSEError=function(nt){this._emitter.emit(_t.a.ERROR,wt.b.MEDIA_ERROR,wt.a.MEDIA_MSE_ERROR,nt)},e.prototype._onMSEStartStreaming=function(){this._loaded_metadata_received&&(this._config.isLive||(ct.a.v(this.TAG,"Resume transmuxing task due to ManagedMediaSource onStartStreaming"),this._loading_controller.resumeTransmuxer()))},e.prototype._onMSEEndStreaming=function(){this._config.isLive||(ct.a.v(this.TAG,"Suspend transmuxing task due to ManagedMediaSource onEndStreaming"),this._loading_controller.suspendTransmuxer())},e.prototype._onMediaLoadedMetadata=function(nt){this._loaded_metadata_received=!0,null!=this._pending_seek_time&&(this._seeking_handler.seek(this._pending_seek_time),this._pending_seek_time=null)},e.prototype._onRequestDirectSeek=function(nt){this._seeking_handler.directSeek(nt)},e.prototype._onRequiredUnbufferedSeek=function(nt){this._mse_controller.flush(),this._transmuxer.seek(nt)},e.prototype._onRequestPauseTransmuxer=function(){this._transmuxer.pause()},e.prototype._onRequestResumeTransmuxer=function(){this._transmuxer.resume()},e.prototype._fillStatisticsInfo=function(nt){if(nt.playerType="MSEPlayer",!(this._media_element instanceof HTMLVideoElement))return nt;var rt=!0,it=0,at=0;if(this._media_element.getVideoPlaybackQuality){var st=this._media_element.getVideoPlaybackQuality();it=st.totalVideoFrames,at=st.droppedVideoFrames}else null!=this._media_element.webkitDecodedFrameCount?(it=this._media_element.webkitDecodedFrameCount,at=this._media_element.webkitDroppedFrameCount):rt=!1;return rt&&(nt.decodedFrames=it,nt.droppedFrames=at),nt},e}(),jt=it(18),Kt=it(8),$t=function(){function e(nt,rt){this.TAG="PlayerEngineDedicatedThread",this._emitter=new dt,this._media_element=null,this._worker_destroying=!1,this._seeking_handler=null,this._loading_controller=null,this._startup_stall_jumper=null,this._live_latency_chaser=null,this._live_latency_synchronizer=null,this._pending_seek_time=null,this._media_info=null,this._statistics_info=null,this.e=null,this._media_data_source=nt,this._config=o(),"object"==typeof rt&&Object.assign(this._config,rt),!0===nt.isLive&&(this._config.isLive=!0),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this),onMediaLoadedMetadata:this._onMediaLoadedMetadata.bind(this),onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this),onMediaReadyStateChanged:this._onMediaReadyStateChange.bind(this)},Kt.a.registerListener(this.e.onLoggingConfigChanged),this._worker=jt(24,{all:!0}),this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",media_data_source:this._media_data_source,config:this._config}),this._worker.postMessage({cmd:"logging_config",logging_config:Kt.a.getConfig()})}return e.isSupported=function(){return!(!self.Worker||!(self.MediaSource&&"canConstructInDedicatedWorker"in self.MediaSource&&!0===self.MediaSource.canConstructInDedicatedWorker||self.ManagedMediaSource&&"canConstructInDedicatedWorker"in self.ManagedMediaSource&&!0===self.ManagedMediaSource.canConstructInDedicatedWorker))},e.prototype.destroy=function(){this._emitter.emit(_t.a.DESTROYING),this.unload(),this.detachMediaElement(),this._worker_destroying=!0,this._worker.postMessage({cmd:"destroy"}),Kt.a.removeListener(this.e.onLoggingConfigChanged),this.e=null,this._media_data_source=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(nt,rt){var it=this;this._emitter.addListener(nt,rt),nt===_t.a.MEDIA_INFO&&this._media_info?Promise.resolve().then((function(){return it._emitter.emit(_t.a.MEDIA_INFO,it.mediaInfo)})):nt==_t.a.STATISTICS_INFO&&this._statistics_info&&Promise.resolve().then((function(){return it._emitter.emit(_t.a.STATISTICS_INFO,it.statisticsInfo)}))},e.prototype.off=function(nt,rt){this._emitter.removeListener(nt,rt)},e.prototype.attachMediaElement=function(nt){this._media_element=nt,this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element.addEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element.addEventListener("readystatechange",this.e.onMediaReadyStateChanged),this._worker.postMessage({cmd:"initialize_mse"})},e.prototype.detachMediaElement=function(){this._worker.postMessage({cmd:"shutdown_mse"}),this._media_element&&(this._media_element.removeEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element.removeEventListener("readystatechange",this.e.onMediaReadyStateChanged),this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element=null)},e.prototype.load=function(){this._worker.postMessage({cmd:"load"}),this._seeking_handler=new Ot(this._config,this._media_element,this._onRequiredUnbufferedSeek.bind(this)),this._loading_controller=new Ft(this._config,this._media_element,this._onRequestPauseTransmuxer.bind(this),this._onRequestResumeTransmuxer.bind(this)),this._startup_stall_jumper=new Bt(this._media_element,this._onRequestDirectSeek.bind(this)),this._config.isLive&&this._config.liveBufferLatencyChasing&&(this._live_latency_chaser=new Ut(this._config,this._media_element,this._onRequestDirectSeek.bind(this))),this._config.isLive&&this._config.liveSync&&(this._live_latency_synchronizer=new Gt(this._config,this._media_element)),this._media_element.readyState>0&&this._seeking_handler.directSeek(0)},e.prototype.unload=function(){var nt,rt,it,at,st,ot;null===(nt=this._media_element)||void 0===nt||nt.pause(),this._worker.postMessage({cmd:"unload"}),null===(rt=this._live_latency_synchronizer)||void 0===rt||rt.destroy(),this._live_latency_synchronizer=null,null===(it=this._live_latency_chaser)||void 0===it||it.destroy(),this._live_latency_chaser=null,null===(at=this._startup_stall_jumper)||void 0===at||at.destroy(),this._startup_stall_jumper=null,null===(st=this._loading_controller)||void 0===st||st.destroy(),this._loading_controller=null,null===(ot=this._seeking_handler)||void 0===ot||ot.destroy(),this._seeking_handler=null},e.prototype.play=function(){return this._media_element.play()},e.prototype.pause=function(){this._media_element.pause()},e.prototype.seek=function(nt){this._media_element&&this._seeking_handler?this._seeking_handler.seek(nt):this._pending_seek_time=nt},Object.defineProperty(e.prototype,"mediaInfo",{get:function(){return Object.assign({},this._media_info)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){return Object.assign({},this._statistics_info)},enumerable:!1,configurable:!0}),e.prototype._onLoggingConfigChanged=function(nt){var rt;null===(rt=this._worker)||void 0===rt||rt.postMessage({cmd:"logging_config",logging_config:nt})},e.prototype._onMSEUpdateEnd=function(){this._config.isLive&&this._config.liveBufferLatencyChasing&&this._live_latency_chaser&&this._live_latency_chaser.notifyBufferedRangeUpdate(),this._loading_controller.notifyBufferedPositionChanged()},e.prototype._onMSEBufferFull=function(){ct.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._loading_controller.suspendTransmuxer()},e.prototype._onMediaLoadedMetadata=function(nt){null!=this._pending_seek_time&&(this._seeking_handler.seek(this._pending_seek_time),this._pending_seek_time=null)},e.prototype._onRequestDirectSeek=function(nt){this._seeking_handler.directSeek(nt)},e.prototype._onRequiredUnbufferedSeek=function(nt){this._worker.postMessage({cmd:"unbuffered_seek",milliseconds:nt})},e.prototype._onRequestPauseTransmuxer=function(){this._worker.postMessage({cmd:"pause_transmuxer"})},e.prototype._onRequestResumeTransmuxer=function(){this._worker.postMessage({cmd:"resume_transmuxer"})},e.prototype._onMediaTimeUpdate=function(nt){this._worker.postMessage({cmd:"timeupdate",current_time:nt.target.currentTime})},e.prototype._onMediaReadyStateChange=function(nt){this._worker.postMessage({cmd:"readystatechange",ready_state:nt.target.readyState})},e.prototype._onWorkerMessage=function(nt){var rt,it=nt.data,at=it.msg;if("destroyed"==at||this._worker_destroying)return this._worker_destroying=!1,null===(rt=this._worker)||void 0===rt||rt.terminate(),void(this._worker=null);switch(at){case"mse_init":var st=it;"ManagedMediaSource"in self&&!("MediaSource"in self)&&(this._media_element.disableRemotePlayback=!0),this._media_element.srcObject=st.handle;break;case"mse_event":(st=it).event==St.a.UPDATE_END?this._onMSEUpdateEnd():st.event==St.a.BUFFER_FULL&&this._onMSEBufferFull();break;case"transmuxing_event":if((st=it).event==Ct.a.MEDIA_INFO){var ot=it;this._media_info=ot.info,this._emitter.emit(_t.a.MEDIA_INFO,Object.assign({},ot.info))}else if(st.event==Ct.a.STATISTICS_INFO){var lt=it;this._statistics_info=this._fillStatisticsInfo(lt.info),this._emitter.emit(_t.a.STATISTICS_INFO,Object.assign({},lt.info))}else if(st.event==Ct.a.RECOMMEND_SEEKPOINT){var ut=it;this._media_element&&!this._config.accurateSeek&&this._seeking_handler.directSeek(ut.milliseconds/1e3)}break;case"player_event":if((st=it).event==_t.a.ERROR){var dt=it;this._emitter.emit(_t.a.ERROR,dt.error_type,dt.error_detail,dt.info)}else if("extraData"in st){var ht=it;this._emitter.emit(ht.event,ht.extraData)}break;case"logcat_callback":st=it,ct.a.emitter.emit("log",st.type,st.logcat);break;case"buffered_position_changed":st=it,this._loading_controller.notifyBufferedPositionChanged(st.buffered_position_milliseconds/1e3)}},e.prototype._fillStatisticsInfo=function(nt){if(nt.playerType="MSEPlayer",!(this._media_element instanceof HTMLVideoElement))return nt;var rt=!0,it=0,at=0;if(this._media_element.getVideoPlaybackQuality){var st=this._media_element.getVideoPlaybackQuality();it=st.totalVideoFrames,at=st.droppedVideoFrames}else null!=this._media_element.webkitDecodedFrameCount?(it=this._media_element.webkitDecodedFrameCount,at=this._media_element.webkitDroppedFrameCount):rt=!1;return rt&&(nt.decodedFrames=it,nt.droppedFrames=at),nt},e}(),Yt=function(){function e(nt,rt){this.TAG="MSEPlayer",this._type="MSEPlayer",this._media_element=null,this._player_engine=null;var it=nt.type.toLowerCase();if("mse"!==it&&"mpegts"!==it&&"m2ts"!==it&&"flv"!==it)throw new Lt.b("MSEPlayer requires an mpegts/m2ts/flv MediaDataSource input!");if(rt&&rt.enableWorkerForMSE&&$t.isSupported())try{this._player_engine=new $t(nt,rt)}catch(it){ct.a.e(this.TAG,"Error while initializing PlayerEngineDedicatedThread, fallback to PlayerEngineMainThread"),this._player_engine=new Ht(nt,rt)}else this._player_engine=new Ht(nt,rt)}return e.prototype.destroy=function(){this._player_engine.destroy(),this._player_engine=null,this._media_element=null},e.prototype.on=function(nt,rt){this._player_engine.on(nt,rt)},e.prototype.off=function(nt,rt){this._player_engine.off(nt,rt)},e.prototype.attachMediaElement=function(nt){this._media_element=nt,this._player_engine.attachMediaElement(nt)},e.prototype.detachMediaElement=function(){this._media_element=null,this._player_engine.detachMediaElement()},e.prototype.load=function(){this._player_engine.load()},e.prototype.unload=function(){this._player_engine.unload()},e.prototype.play=function(){return this._player_engine.play()},e.prototype.pause=function(){this._player_engine.pause()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._media_element.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._media_element.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._media_element.volume},set:function(nt){this._media_element.volume=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._media_element.muted},set:function(nt){this._media_element.muted=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._media_element?this._media_element.currentTime:0},set:function(nt){this._player_engine.seek(nt)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mediaInfo",{get:function(){return this._player_engine.mediaInfo},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){return this._player_engine.statisticsInfo},enumerable:!1,configurable:!0}),e}(),Wt=function(){function e(nt,rt){this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new ht.a,this._config=o(),"object"==typeof rt&&Object.assign(this._config,rt);var it=nt.type.toLowerCase();if("mse"===it||"mpegts"===it||"m2ts"===it||"flv"===it)throw new Lt.b("NativePlayer does't support mse/mpegts/m2ts/flv MediaDataSource input!");if(nt.hasOwnProperty("segments"))throw new Lt.b("NativePlayer(".concat(nt.type,") doesn't support multipart playback!"));this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=nt,this._mediaElement=null}return e.prototype.destroy=function(){this._emitter.emit(_t.a.DESTROYING),this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(nt,rt){var it=this;nt===_t.a.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){it._emitter.emit(_t.a.MEDIA_INFO,it.mediaInfo)})):nt===_t.a.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){it._emitter.emit(_t.a.STATISTICS_INFO,it.statisticsInfo)})),this._emitter.addListener(nt,rt)},e.prototype.off=function(nt,rt){this._emitter.removeListener(nt,rt)},e.prototype.attachMediaElement=function(nt){if(this._mediaElement=nt,nt.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{nt.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(nt){}},e.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype.load=function(){if(!this._mediaElement)throw new Lt.a("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},e.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype.play=function(){return this._mediaElement.play()},e.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(nt){this._mediaElement.volume=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(nt){this._mediaElement.muted=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(nt){this._mediaElement?this._mediaElement.currentTime=nt:this._pendingSeekTime=nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mediaInfo",{get:function(){var nt={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(nt.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(nt.width=this._mediaElement.videoWidth,nt.height=this._mediaElement.videoHeight)),nt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){var nt={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return nt;var rt=!0,it=0,at=0;if(this._mediaElement.getVideoPlaybackQuality){var st=this._mediaElement.getVideoPlaybackQuality();it=st.totalVideoFrames,at=st.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(it=this._mediaElement.webkitDecodedFrameCount,at=this._mediaElement.webkitDroppedFrameCount):rt=!1;return rt&&(nt.decodedFrames=it,nt.droppedFrames=at),nt},enumerable:!1,configurable:!0}),e.prototype._onvLoadedMetadata=function(nt){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(_t.a.MEDIA_INFO,this.mediaInfo)},e.prototype._reportStatisticsInfo=function(){this._emitter.emit(_t.a.STATISTICS_INFO,this.statisticsInfo)},e}();at.a.install();var Qt={createPlayer:function(nt,rt){var it=nt;if(null==it||"object"!=typeof it)throw new Lt.b("MediaDataSource must be an javascript object!");if(!it.hasOwnProperty("type"))throw new Lt.b("MediaDataSource must has type field to indicate video file type!");switch(it.type){case"mse":case"mpegts":case"m2ts":case"flv":return new Yt(it,rt);default:return new Wt(it,rt)}},isSupported:function(){return lt.supportMSEH264Playback()},getFeatureList:function(){return lt.getFeatureList()}};Qt.BaseLoader=ut.a,Qt.LoaderStatus=ut.c,Qt.LoaderErrors=ut.b,Qt.Events=_t.a,Qt.ErrorTypes=wt.b,Qt.ErrorDetails=wt.a,Qt.MSEPlayer=Yt,Qt.NativePlayer=Wt,Qt.LoggingControl=Kt.a,Object.defineProperty(Qt,"version",{enumerable:!0,get:function(){return"1.7.3"}}),rt.default=Qt}])}(bs);var As=getDefaultExportFromCjs$1(bs.exports);class MediaPlayerAdapterHTML5TS extends MediaPlayerAdapterHTML5Video{constructor(nt){super(nt),this.currentSrc="",this.setup("video")}load(nt,rt,it,at,st){if(!nt)return void console.error("Bad source",nt,rt);this.active=!0,this.setVars(nt,rt,it,at,st),this.mpegts=As.createPlayer({type:"mse",url:this.currentSrc,isLive:"video"!=st},{lazyLoad:!1,enableWorker:!0,autoCleanupSourceBuffer:!0}),this.mpegts.attachMediaElement(this.object),this.errorListener=nt=>{const rt=this.time();if(rt!=this.lastErrorTime&&(this.errorsCount=0),this.errorsCount++,console.error("MPEGTS ERROR",nt,this.errorsCount,rt!=this.lastErrorTime),this.errorsCount>=(rt>0?20:3))this.emit("error",String(nt),!0),this.state="",this.emit("state","");else{const nt=this.errorsCount;this.object.error&&(this.mpegts.detachMediaElement(),console.warn("!! RENEWING VIDEO OBJECT"),this.recycle(),this.mpegts.attachMediaElement(this.object)),this.mpegts.unload(),this.mpegts.load(),this.mpegts.play(),this.errorsCount=nt}this.lastErrorTime=rt},this.logListener=(nt,rt)=>{String(rt).includes("sync_byte")&&this.errorListener(rt)};this.object.addEventListener("error",(nt=>{this.object.error&&(this.mpegts.detachMediaElement(),console.warn("!! RENEWING VIDEO OBJECT"),this.recycle(),this.mpegts.attachMediaElement(this.object),this.mpegts.play())})),this.mpegts.on(As.Events.ERROR,this.errorListener),this.mpegts.unload(),this.mpegts.load(),this.mpegts.play(),As.LoggingControl.addLogListener(this.logListener),this.connect()}unload(){console.log("unload ts"),this.mpegts&&(console.log("unload ts disconnect"),this.disconnect(),this.mpegts.unload(),this.logListener&&(As.LoggingControl.removeLogListener(this.logListener),delete this.logListener),this.object.src="",console.log("unload ts super.unload"),super.unload(),console.log("unload ts OK"))}destroy(){console.log("ts destroy"),this.unload(),super.destroy()}}class MediaPlayer extends EventEmitter$1{constructor(nt){super(),this.container=nt,this.innerContainer=this.container.querySelector("div"),this.innerContainer||(this.innerContainer=document.createElement("div"),this.container.appendChild(this.innerContainer)),this.adapters={},this.adapter="",this.current=null,this.state="",this.config=_t.config,this.hasErr=null,this.clearErrTimer=null,this.uiVisibility=!0,this.currentAudioTracks=null,this.currentSubtitleTracks=null,_t.on("config",(()=>{this.config=_t.config,Object.keys(this.adapters).forEach((nt=>{this.adapters[nt].config=_t.config}))}))}uiVisible(nt){if(this.current)return this.uiVisibility=nt,this.current.uiVisible(nt)}time(nt){return this.current?"number"==typeof nt?this.current.time(nt):this.current.time():0}duration(){if(this.current){let nt=this.current.duration;if(isNaN(nt))return 0;if(nt===1/0)if(this.current.object.buffered.length)for(let rt=0;rt<this.current.object.buffered.length;rt++)nt=this.current.object.buffered.end(rt);else nt=this.current.time()+2;return nt}return 0}ratio(nt){return this.current?"number"==typeof nt?this.current.ratio(nt):this.current.ratio():0}playbackRate(nt){return this.current?"number"==typeof nt?this.current.playbackRate(nt):this.current.playbackRate():1}videoRatio(){return this.current?this.current.videoRatio():0}show(){this.revealTimer&&clearTimeout(this.revealTimer),_t.localEmit("player-show"),this.revealTimer=setTimeout((()=>{document.documentElement.classList.add("playing");document.body.className.includes("video-")?document.body.classList.add("video"):(document.body.classList.add("video"),document.body.classList.add("video-loading")),this.current instanceof MediaPlayerAdapterAndroidNative||(this.container.style.display="flex",this.container.querySelectorAll("video, audio").forEach((nt=>{nt.style.display=nt==this.current.object?"block":"none"})))}),400)}hide(){this.revealTimer&&clearTimeout(this.revealTimer),document.documentElement.classList.remove("playing"),["video","video-loading","video-playing","video-paused"].forEach((nt=>document.body.classList.remove(nt))),_t.localEmit("player-hide"),this.container.style.display="none"}resume(){this.current&&("ended"==this.state?this.current.restart():this.current.resume())}pause(){this.current&&this.current.pause()}volume(nt){this.current&&this.current.volume(nt)}muted(){if(this.current)return this.current.object.muted}setState(nt,rt){this.state!=nt&&(this.state=nt,this.suspendStateChangeReporting||this.emit("state",nt,rt))}load(nt,rt,it,at,st,ot){if(this.setState("loading"),this.mediatype=st,this.suspendStateChangeReporting=!0,this.current&&this.current.unload(!0),window.plugins&&window.plugins.megacubo)this.setup("native",MediaPlayerAdapterAndroidNative);else{let it=rt.toLowerCase();it.includes("mpegurl")?this.setup("html5h",MediaPlayerAdapterHTML5HLS):it.includes("mp2t")||nt.endsWith(".ts")&&"video"==st||ot&&!0===ot.mpegts?this.setup("html5t",MediaPlayerAdapterHTML5TS):it.includes("dash")||nt.endsWith(".mpd")?this.setup("html5d",MediaPlayerAdapterHTML5DASH):it.includes("audio/")?this.setup("html5a",MediaPlayerAdapterHTML5Audio):this.setup("html5v",MediaPlayerAdapterHTML5Video)}const lt=this.current;this.suspendStateChangeReporting=!1,lt.errorsCount=0;try{lt.load(nt,rt,it,at,st)}catch(nt){console.error(nt)}return this.current=lt,this.show(),_t.config&&lt.volume(_t.config.volume),document.body.style.backgroundColor="transparent",lt}setup(nt,rt){if(this.adapter=nt,this.currentAudioTracks=[],this.currentSubtitleTracks=[],void 0===this.adapters[this.adapter]){const nt=new rt(this.innerContainer);nt.on("state",(nt=>{void 0!==nt&&(!nt&&this.hasErr&&(nt="error"),this.suspendStateChangeReporting||this.setState(nt,this.hasErr))})),nt.on("setup-ratio",(nt=>{this.current&&this.emit("setup-ratio",nt)})),nt.on("timeupdate",(nt=>{this.current&&this.emit("timeupdate",nt)})),nt.on("durationchange",(()=>{this.current&&this.emit("durationchange",this.uiVisibility)})),nt.on("audioTracks",(nt=>{this.current&&(this.equals(nt,this.currentAudioTracks)||(this.currentAudioTracks=nt,this.emit("audioTracks",nt)))})),nt.on("subtitleTracks",(nt=>{this.current&&(this.equals(nt,this.currentSubtitleTracks)||(this.currentSubtitleTracks=nt,this.emit("subtitleTracks",nt)))})),nt.on("error",((rt,it)=>{if(this.current)this.clearErrTimer&&clearTimeout(this.clearErrTimer),!0===it?(this.state="error",this.suspendStateChangeReporting||this.emit("state",this.state,rt),nt.unload()):(this.hasErr=String(rt),this.clearErrTimer=setTimeout((()=>{this.hasErr=null}),5e3));else try{nt.disconnect(),nt.unload()}catch(nt){}})),nt.on("ended",((nt,rt)=>{this.current&&(this.suspendStateChangeReporting=!0,this.pause(),setTimeout((()=>{this.suspendStateChangeReporting=!1,this.setState("ended")}),0))})),nt.config=_t.config,this.adapters[this.adapter]=nt}return this.current=this.adapters[this.adapter]}equals(nt,rt){return!(!nt||!rt||nt.length!=rt.length)&&nt.every(((it,at)=>nt[at]===rt[at]))}audioTracks(){return this.current?this.current.audioTracks():[]}audioTrack(nt){this.current&&this.current.audioTrack(nt)}subtitleTracks(){return this.current?this.current.subtitleTracks():[]}subtitleTrack(nt){this.current&&this.current.subtitleTrack(nt)}unload(nt){nt||console.log("unload"),this.current&&(this.current.unload(!0),nt||(this.hide(),this.current=null,this.setState("")))}}Object.defineProperty(Array.prototype,"unique",{enumerable:!1,configurable:!1,writable:!1,value:function(){return[...new Set(this)]}}),Object.defineProperty(String.prototype,"format",{enumerable:!1,configurable:!1,writable:!1,value:function(){var nt=arguments;return this.replace(/{(\d+)}/g,(function(rt,it){return void 0!==nt[it]?nt[it]:rt}))}}),Object.defineProperty(String.prototype,"replaceAll",{enumerable:!1,configurable:!1,writable:!1,value:function(nt,rt){var it=this;return it.includes(nt)&&(it=it.split(nt).join(rt)),String(it)}}),"function"!=typeof Object.values&&Object.defineProperty(Object.prototype,"values",{enumerable:!1,configurable:!1,writable:!1,value:nt=>{let rt=[];for(var it in nt)nt.hasOwnProperty(it)&&rt.push(nt[it]);return rt}});const css=(nt,rt,it)=>{if(it||(it=window),it&&it.document)try{var at=it.document.getElementById("css-"+rt);at?at.parentNode.removeChild(at):((at=it.document.createElement("style")).type="text/css",at.id="css-"+rt),at.innerText="",at.appendChild(it.document.createTextNode(nt)),it.document.body.insertAdjacentElement("beforeend",at)}catch(rt){console.log("CSS Error",rt,nt)}},time=()=>Date.now()/1e3,traceback=()=>{try{({}).debug()}catch(nt){const rt="is not a function";return nt.stack.split(rt).slice(1).join(rt).trim()}};class StreamerPlaybackTimeout extends EventEmitter$1{constructor(nt){super(),this.setMaxListeners(20),this.controls=nt,this.playbackTimeout=25e3,this.playbackTimeoutTimer=0,this.on("state",(nt=>{"loading"==nt?this.playbackTimeoutTimer||(this.playbackTimeoutTimer=setTimeout((()=>{console.warn("STUCK"),this.emit("stuck"),clearTimeout(this.playbackTimeoutTimer),player.current&&player.current.reload(),this.playbackTimeoutTimer=0,_t.emit("video-error","timeout","client playback timeout")}),this.playbackTimeout)):this.cancelTimeout()})),this.on("stop",(()=>{this.cancelTimeout()})),_t.on("streamer-reset-timeout",(nt=>{clearTimeout(this.playbackTimeoutTimer),this.playbackTimeoutTimer=0}))}cancelTimeout(){_t.osd.hide("debug-timeout"),_t.osd.hide("timeout"),clearTimeout(this.playbackTimeoutTimer),this.playbackTimeoutTimer=0,this.isTryOtherDlgActive()&&_t.menu.endModal()}isTryOtherDlgActive(){return!!document.getElementById("modal-template-option-wait")}ended(){clearTimeout(this.playbackTimeoutTimer),this.inLiveStream&&_t.emit("video-error","timeout","remote server timeout or end of stream")}prepareErrorData(nt){return{type:nt.type||"playback",details:nt.details||""}}time(){return Date.now()/1e3}}class StreamerOSD extends StreamerPlaybackTimeout{constructor(nt){super(nt),this.transmissionNotWorkingHintDelay=1e4,this.transmissionNotWorkingHintTimer=0,this.state="loading",this.osdID="video",this.OSDNameShown=!1,this.on("draw",(()=>{this.OSDLoadingHintShown=!1})),this.on("state",(nt=>{switch(nt){case"ended":clearTimeout(this.transmissionNotWorkingHintTimer),this.OSDNameShown=!1,_t.osd.hide(this.osdID+"-sub"),_t.osd.show(_t.lang.ENDED,"fas fa-play",this.osdID,"persistent");break;case"paused":clearTimeout(this.transmissionNotWorkingHintTimer),this.OSDNameShown=!1,_t.osd.hide(this.osdID+"-sub"),this.seekTimer?_t.osd.hide(this.osdID):_t.osd.show(_t.lang.PAUSED+'<span style="opacity: var(--opacity-level-2)"> &nbsp;&middot;&nbsp; </span>'+this.data.name,"fas fa-play",this.osdID,"persistent");break;case"loading":_t.osd.hide(this.osdID+"-sub"),_t.osd.hide(this.osdID),clearTimeout(this.transmissionNotWorkingHintTimer),this.transcodeStarting?(_t.osd.show(_t.lang.TRANSCODING_WAIT,"fas fa-circle-notch fa-spin",this.osdID,"persistent"),_t.osd.hide(this.osdID+"-sub")):this.transmissionNotWorkingHintTimer=setTimeout((()=>{if(this.active){if(_t.osd.hide(this.osdID),this.autoTuning){const nt=this.isZapping?this.zappingIcon:_t.config["tuning-icon"];_t.osd.show(_t.lang.BROADCAST_NOT_WORKING_HINT.format('<i class="'+nt+'"></i>'),"",this.osdID+"-sub","persistent")}_t.emit("streamer-is-slow")}}),this.transmissionNotWorkingHintDelay);break;case"playing":if(clearTimeout(this.transmissionNotWorkingHintTimer),_t.osd.hide(this.osdID+"-sub"),_t.osd.hide(this.osdID),!this.OSDNameShown){if(this.OSDNameShown=!0,this.autoTuning){const nt=this.isZapping?this.zappingIcon:_t.config["tuning-icon"];_t.osd.show(_t.lang.BROADCAST_NOT_WORKING_HINT.format('<i class="'+nt+'"></i>'),"",this.osdID+"-sub","normal")}_t.osd.show(this.data.name,this.data.icon||"",this.osdID,"normal")}break;case"":clearTimeout(this.transmissionNotWorkingHintTimer),_t.osd.hide(this.osdID+"-sub"),_t.osd.hide(this.osdID)}})),this.on("stop",(()=>{clearTimeout(this.transmissionNotWorkingHintTimer),this.OSDNameShown=!1,_t.osd.hide(this.osdID+"-sub"),_t.osd.hide(this.osdID)}))}}class StreamerCasting extends StreamerOSD{constructor(nt){super(nt),this.casting=!1,this.castingPaused=!1,_t.on("cast-start",(()=>this.castUIStart())),_t.on("cast-stop",(()=>this.castUIStop())),_t.on("external-player",(nt=>{parent.Manager.externalPlayer.play(nt).catch((nt=>{console.error(nt),_t.osd.show(String(nt),"fas fa-exclamation-triangle faclr-red","external-player","normal")}))})),this.on("before-seek",(nt=>{this.casting&&(player.otime||(player.otime=player.time),player.oresume||(player.oresume=player.resume),player.time=()=>{},player.resume=()=>{},this.emit("state","paused"),this.seekBarUpdate(!0,nt))})),this.on("after-seek",(nt=>{this.casting&&(this.seekBarUpdate(!0,nt),player.time=player.otime,player.resume=player.oresume,setTimeout((()=>{this.casting&&(this.emit("state","playing"),this.seekBarUpdate(!0,nt))}),2500))})),this.on("state",(nt=>{this.casting&&("playing"==nt?(this.unbindStateListener(),player.pause()):""==nt&&(this.casting=!1,this.castingPaused=!1,document.body.classList.remove("casting")))}))}castUIStart(){this.casting||(this.casting=!0,this.castingPaused=!1,this.unbindStateListener(),player.pause(),this.stateListener("playing"),document.body.classList.add("casting"),this.inLiveStream&&document.body.classList.add("casting-live"),this.emit("cast-start"))}castUIStop(){this.casting&&(this.casting=!1,this.castingPaused=!1,document.body.classList.remove("casting"),document.body.classList.remove("casting-live"),this.emit("cast-stop"),_t.emit("cast-stop"),this.active&&(this.bindStateListener(),player.state?player.resume():(player.load(this.activeSrc,this.activeMimetype,this.activeSubtitle,this.activeCookie,this.activeMediatype,this.data),this.stateListener("loading"))))}}class StreamerState extends StreamerCasting{constructor(nt){super(nt),this.state="",this.stateListener=(nt,rt,it)=>{if(nt!=this.state||it){switch("ended"==this.state&&_t.emit("video-resumed"),this.state=nt,console.log("STREAMER-STATE",this.state),this.state){case"paused":this.controls.querySelector(".play-button").style.display="inline-flex",this.controls.querySelector(".pause-button").style.display="none";break;case"loading":case"playing":this.controls.querySelector(".play-button").style.display="none",this.controls.querySelector(".pause-button").style.display="inline-flex";break;case"ended":this.controls.querySelector(".play-button").style.display="inline-flex",this.controls.querySelector(".pause-button").style.display="none",_t.emit("video-ended");break;case"error":!this.active||this.transitioning||this.transcodeStarting||(_t.emit("video-error","playback",rt?String(rt.details||rt):"playback error"),this.stop(!0));case"":this.stop()}this.emit("state",this.state)}},this.on("start",(()=>{this.stateListener("loading"),window.capacitor&&player.once("timeupdate",(()=>{"loading"==this.state&&this.stateListener("playing")}))})),this.on("stop",(()=>this.stateListener(""))),_t.on("streamer-show-tune-hint",(()=>{this.transitioning||_t.menu.dialog([{template:"question",text:document.title,fa:"fas fa-info-circle"},{template:"message",text:_t.lang.TUNING_HINT.format("<i class='fas "+_t.config["tuning-icon"]+"'></i>")},{template:"option",text:"OK",id:"submit",fa:"fas fa-check-circle"}])})),_t.on("streamer-client-pause",(()=>{!this.casting&&"paused"!=player.state&&player.pause()})),_t.on("streamer-client-resume",(()=>{!this.casting&&"paused"==player.state&&player.resume()})),this.positionReportingInterval=10,this.lastPositionReportingTime=time(),this.lastPositionReported=0,this.on("start",(()=>{this.positionReportingInterval=10,this.lastPositionReportingTime=time(),this.lastPositionReported=0})),player.on("timeupdate",(nt=>{if(!this.inLiveStream&&nt>=20){const rt=time();if(rt>this.lastPositionReportingTime+this.positionReportingInterval){this.lastPositionReportingTime=rt;let it=player.duration();it&&it>0&&(this.lastPositionReported=nt,_t.emit("state-atts",this.data.url,{duration:it,position:nt,source:this.data.source}))}}})),_t.on("resume-dialog",((nt,rt)=>{const next=()=>{console.warn("RESUME",nt);const next=rt=>("resume"===rt&&player.time(nt),player.resume(),!0);nt>.8*rt?(player.pause(),_t.menu.dialog([{template:"question",text:_t.lang.CONTINUE,fa:"fas fa-redo-alt"},{template:"option",text:_t.lang.RESUME_FROM_X.format(this.hmsSecondsToClock(nt)),id:"resume",fa:"fas fa-redo-alt"},{template:"option",text:_t.lang.PLAY_FROM_START,id:"play",fa:"fas fa-play"}],next,"resume-from")):next("resume")};this.transitioning?this.once("transitioned",next):next()}))}bindStateListener(){player.listeners("state").includes(this.stateListener)||player.on("state",this.stateListener),this.stateListening=!0}unbindStateListener(){console.log("STREAMER-UNBINDSTATELISTENER"),player.removeListener("state",this.stateListener),this.stateListening=!1}playOrPause(){if(this.active&&player.state)if(["paused","ended"].includes(player.state))if(this.casting)this.castingPaused?(this.castingPaused=!1,this.stateListener("playing"),_t.emit("streamer-resume")):(this.castingPaused=!0,this.stateListener("paused"),_t.emit("streamer-pause"));else{if(_t.config["unpause-jumpback"]){const nt=player.time();if(nt){const rt=Math.max(player.time()-_t.config["unpause-jumpback"],0);rt<nt&&player.time(rt)}}player.resume(),_t.emit("streamer-resume")}else player.pause(),_t.emit("streamer-pause")}playOrPauseNotIdle(){let nt=_t.idle.isIdle||_t.idle.lastIdleTime>Date.now()/1e3-.5;console.error("playOrPauseNotIdle() "+(nt?"Y":"N"),_t.idle.isIdle,_t.idle.lastIdleTime),nt||this.playOrPause()}isTuning(){if(!_t.osd)return"";let nt=_t.osd.textContent();return nt.includes(_t.lang.TUNING)||nt.includes(_t.lang.CONNECTING)}}class StreamerClientVideoAspectRatio extends StreamerState{constructor(nt){super(nt),this.aspectRatioList=[{h:16,v:9},{h:4,v:3},{h:16,v:10},{h:21,v:9}],this.activeAspectRatio=this.aspectRatioList[0],this.landscape=window.innerWidth>window.innerHeight,player.on("setup-ratio",(nt=>this.setupAspectRatio())),_t.on("ratio",(()=>this.switchAspectRatio())),_t.menu.on("resize",(()=>this.resize())),this.on("stop",(()=>{this.aspectRatioList=this.aspectRatioList.filter((nt=>void 0===nt.custom)),this.activeAspectRatio=this.aspectRatioList[0]}))}resize(){let nt=window.innerWidth>window.innerHeight;nt!=this.landscape?(this.landscape=nt,setTimeout((()=>this.applyAspectRatio(this.activeAspectRatio)),500)):this.applyAspectRatio(this.activeAspectRatio)}generateAspectRatioMetrics(nt){let rt=nt,it=1;for(;rt<Number.MAX_SAFE_INTEGER&&(!Number.isSafeInteger(rt)||!Number.isSafeInteger(it));)it++,rt=it*nt;return console.log("generateAspectRatioMetrics",nt,{v:it,h:rt}),{v:it,h:rt}}registerAspectRatio(nt){return this.aspectRatioList.some((rt=>rt.v==nt.v&&rt.h==nt.h))||(nt.custom=!0,this.aspectRatioList.push(nt)),nt}detectAspectRatio(){return player.videoRatio()}setupAspectRatio(){let nt=this.detectAspectRatio(),rt=this.generateAspectRatioMetrics(nt);this.applyAspectRatio(rt),this.registerAspectRatio(rt)}switchAspectRatio(){var nt=this.aspectRatioList[0],rt=this.aspectRatioList.indexOf(this.activeAspectRatio);rt<this.aspectRatioList.length-1&&(nt=this.aspectRatioList[rt+1]),console.log("RATIO",nt,this.activeAspectRatio,rt,this.aspectRatioList),this.applyAspectRatio(nt)}applyAspectRatio(nt){this.activeAspectRatio=nt,player.ratio(nt.h/nt.v)}}class StreamerIdle extends StreamerClientVideoAspectRatio{constructor(nt){super(nt);const rt=new RegExp("(^| )idle","g"),it=new RegExp("(^| )video[\\-a-z]+","g");this.on("state",(nt=>{let rt=document.body.className;rt=nt&&"error"!=nt?rt.replace(it," ")+" video-"+nt:rt.replace(it," "),document.body.className=rt.trim()})),_t.idle.on("idle",(()=>{(document.body.className||"").match(rt)||(document.body.className+=" idle"),player.uiVisible(!1)})),_t.idle.on("active",(()=>{const nt=document.body.className||"";nt.match(rt)&&(document.body.className=nt.replace(rt," ").trim()),player.uiVisible(!0)}))}}class StreamerSpeedo extends StreamerIdle{constructor(nt){super(nt),this.invalidSpeeds=["N/A",0],this.speedoLabel=document.querySelector("#loading-layer > span.loading-layer-status > span"),this.on("state",(nt=>{if(!this.isLocal())switch(nt){case"loading":this.speedoUpdate();break;case"playing":if(!this.speedoDurationReported&&!this.inLiveStream){let nt=player.duration();nt&&nt>0&&(this.speedoDurationReported=!0,_t.emit("streamer-duration",nt))}break;case"":this.speedoSemSet(-1,_t.lang.WAITING_CONNECTION)}})),this.on("start",(()=>{if(this.commitTime=time(),this.state="loading",this.speedoReset(),this.seekBarReset(),_t.emit("downlink",this.downlink()),this.isLocal())return this.speedoSemSet(-1,"")})),this.on("stop",(()=>{this.bitrate=0,this.currentSpeed=0,this.speedoDurationReported=!1})),_t.on("streamer-speed",(nt=>{this.currentSpeed=nt,this.speedoUpdate()})),_t.on("streamer-bitrate",(nt=>{this.bitrate=nt,this.speedoUpdate()})),navigator.connection.addEventListener("change",(()=>{console.log("NAVIGATOR.CONNECTION CHANGED!!!"),this.speedoUpdate(),_t.emit("downlink",this.downlink())}),{passive:!0}),_t.emit("downlink",this.downlink())}isLocal(){return this.data&&this.data.isLocal}downlink(nt){if(!navigator.onLine)return 0;let rt=navigator.connection&&navigator.connection.downlink?navigator.connection.downlink:0;return rt&&(rt*=1048576),nt&&rt<nt&&(rt=nt),rt!=this.latestDownlink&&(this.latestDownlink=rt,_t.emit("downlink",rt)),rt}speedoReset(){this.speedoSemSet(-1,_t.lang.WAITING_CONNECTION)}speedoUpdate(){if(!player.state)return;if(this.isLocal())return this.speedoSemSet(-1,"");let nt,rt=!this.commitTime||time()-this.commitTime<15,it=this.downlink(this.currentSpeed);if(this.invalidSpeeds.includes(this.currentSpeed))this.speedoSemSet(-1,this.transcodeStarting?_t.lang.TRANSCODING_WAIT:_t.lang.WAITING_CONNECTION);else{let at="";if(this.bitrate&&!this.invalidSpeeds.includes(this.bitrate)){let st=parseInt(this.currentSpeed/(this.bitrate/100));st>100?st=100:st<0&&(st=0),rt?at=_t.lang.WAITING_CONNECTION:it&&it<this.bitrate?at+=_t.lang.YOUR_CONNECTION_IS_SLOW_TIP.format('<i class="'+_t.config["tuning-icon"]+'"></i>')+": ":at+=_t.lang.SLOW_SERVER+": ",at+=" "+st+"%",st<80?nt=2:st<100?nt=1:(nt=0,at=_t.lang.STABLE_CONNECTION)}else at=rt?_t.lang.WAITING_CONNECTION:_t.lang.SLOW_SERVER+": "+((nt,rt=1)=>{if(isNaN(nt)||"number"!=typeof nt)return"N/A";if(0===nt)return"0 Bytes/ps";const it=rt<0?0:rt,at=Math.floor(Math.log(nt)/Math.log(1024));return parseFloat((nt/Math.pow(1024,at)).toFixed(it))+" "+["Bytes/ps","KBps","MBps","GBps","TBps","PBps","EBps","ZBps","YBps"][at]})(this.currentSpeed),nt=this.currentSpeed<=256e3?rt?-1:2:1;this.transcodeStarting&&(at=_t.lang.TRANSCODING_WAIT),this.speedoSemSet(nt,at)}}speedoSemSet(nt,rt){if(nt!==this.currentSem||this.transcodeStarting){const it=["green","orange","red"];this.currentSem=nt,this.speedoLabel.innerHTML=rt;const at=[this.getPlayerButton("stream-info"),document.querySelector("seekbar"),document.querySelector("button.recording")].filter((nt=>nt));it.forEach(((rt,it)=>{at.forEach((at=>{at.classList[it==nt?"add":"remove"]("faclr-"+rt)}))}))}}}class StreamerButtonActionFeedback extends StreamerSpeedo{constructor(nt){super(nt),this.buttonActionFeedbackTimer=0,this.buttonActionFeedbackIgnores=["stop","stream-info","tune","volume"],this.buttonActionFeedbackListeners={},this.on("draw",(()=>{this.buttonActionFeedbackLayer=document.querySelector("#button-action-feedback"),this.buttonActionFeedbackLayer.style.visibility="visible",this.buttonActionFeedbackLayerInner=this.buttonActionFeedbackLayer.querySelector("span")})),this.on("added-player-button",this.addedPlayerButton.bind(this)),this.on("updated-player-button",this.updatedPlayerButton.bind(this))}addedPlayerButton(nt,rt,it,at){this.buttonActionFeedbackIgnores.includes(nt)||(this.buttonActionFeedbackListeners[rt]=()=>this.buttonActionFeedback(nt,at),it.addEventListener("click",this.buttonActionFeedbackListeners[rt],{passive:!0}))}updatedPlayerButton(nt,rt,it,at){this.buttonActionFeedbackIgnores.includes(nt)||(console.warn("updatedPlayerButton",nt,rt,it,at),it.removeEventListener("click",this.buttonActionFeedbackListeners[rt]),this.buttonActionFeedbackListeners[rt]=()=>this.buttonActionFeedback(nt,at),it.addEventListener("click",this.buttonActionFeedbackListeners[rt],{passive:!0}))}buttonActionFeedback(nt,rt){if(["paused","loading"].includes(this.state))return;if("play-pause"==nt){if("playing"==this.state)return;rt="fas fa-play"}clearTimeout(this.buttonActionFeedbackTimer),this.buttonActionFeedbackLayerInner.innerHTML='<i class="'+rt+'" style="transform: scale(1); opacity: 1;"></i>',this.buttonActionFeedbackLayer.style.display="inline-block";const it=this.buttonActionFeedbackLayerInner.querySelector("i");it.style.transform="scale(1.5)",it.style.opacity="0.01",this.buttonActionFeedbackTimer=setTimeout((()=>{this.buttonActionFeedbackLayer.style.display="none"}),500)}}class StreamerSeek extends StreamerButtonActionFeedback{constructor(nt){super(nt),this.seekSkipSecs=5,this.seekbar=!1,this.seekBarShowTime=5e3,this.seekBarShowTimer=0,this.seekStepDelay=400,this.seekTimer=0,this.seekPlaybackStartTime=0,this.seekLastDuration=0,this.on("draw",(()=>{this.seekbar=this.controls.querySelector("seekbar"),this.seekbarLabel=this.controls.querySelector("span.status"),this.seekbarNput=this.seekbar.querySelector("input"),this.seekbarNputVis=this.seekbar.querySelector("div > div"),this.seekbarNput.addEventListener("input",(()=>{this.active&&(console.log("INPUTINPUT",this.seekbarNput.value),this.seekByPercentage(this.seekbarNput.value))}),{passive:!0}),this.seekRewindLayerCounter=document.querySelector("div#seek-back > span.seek-layer-time > span"),this.seekForwardLayerCounter=document.querySelector("div#seek-fwd > span.seek-layer-time > span"),_t.idle.on("active",(()=>this.seekBarUpdate(!0))),this.seekBarUpdate(!0)})),this.on("state",(nt=>{switch(["playing","error",""].includes(nt)&&(this.seekingFrom=null,console.log("removing seek layers",nt),document.body.classList.remove("seek-back"),document.body.classList.remove("seek-fwd"),"playing"==nt&&this.seekBarUpdate(!0)),nt){case"playing":if(!this.seekPlaybackStartTime){const nt=player.duration();this.seekPlaybackStartTime=time()-nt}break;case"":this.seekPlaybackStartTime=0}})),player.on("timeupdate",(()=>{player.uiVisibility&&this.seekBarUpdate()})),player.on("durationchange",(nt=>{const rt=player.duration();this.seekLastDuration>rt&&(this.seekPlaybackStartTime=time()-rt),this.seekLastDuration=rt,nt&&this.seekBarUpdate()})),player.on("play",(()=>{this.seekBarUpdate(!0)}))}hmsPrependZero(nt){return nt<10&&(nt="0"+nt),nt}hms(nt){let rt=parseInt(nt,10),it=this.hmsPrependZero(Math.floor(rt/3600)),at=this.hmsPrependZero(Math.floor((rt-3600*it)/60));return it+":"+at+":"+this.hmsPrependZero(rt-3600*it-60*at)}hmsMin(nt){if(nt<0&&(nt=Math.abs(nt)),nt<=60)return nt+"s";{let rt=parseInt(nt,10),it=Math.floor(rt/3600),at=this.hmsPrependZero(Math.floor((rt-3600*it)/60)),st=this.hmsPrependZero(rt-3600*it-60*at);return it>=1?(it=this.hmsPrependZero(it),it+":"+at+":"+st):at+":"+st}}seekBarReset(){this.seekBarUpdate(!0,0)}seekBarUpdate(nt,rt){if(this.active&&this.state&&(!["paused","ended","loading"].includes(player.state)||!0===nt)&&this.seekbarNput&&(!window.isIdle||"playing"!=player.state||!0===nt)){"number"!=typeof rt&&(rt=player.time());let nt=this.seekPercentage(rt),it=player.duration();this.seekbarLabel.innerHTML=this.seekbarLabelFormat(rt,it),nt!=this.lastPercent&&this.seekBarUpdateView(nt)}}seekBarUpdateView(nt){this.active&&this.state&&(this.lastPercent=nt,this.seekbarNputVis.style.width=nt+"%")}seekBarUpdateSpeed(){if(this.active&&this.seekbarNput&&"loading"==player.state){let nt=this.seekPercentage(),rt=player.duration(),it=player.time();this.seekbarLabel.innerHTML=this.seekbarLabelFormat(it,rt),nt!=this.lastPercent&&this.seekBarUpdateView(nt)}}seekbarLabelFormat(nt,rt){let it;return it=this.inLiveStream&&_t.config["use-local-time-counter"]?moment.unix(this.clockTimerCurrentTime()).format("LTS"):this.hms(nt)+' <font style="opacity: var(--opacity-level-2);">/</font> '+this.hms(rt),it}seekPercentage(nt){if(!this.active)return 0;"number"!=typeof nt&&(nt=player.time());let rt=0,it=player.duration();if(!it)return 0;this.inLiveStream&&(rt=it-_t.config["live-window-time"],rt<0&&(rt=0)),rt&&(it-=rt,(nt-=rt)<0&&(nt=0),it<0&&(it=0));let at=nt/(it/100);return(isNaN(at)||at>100)&&(at=100),parseInt(at)}seekTimeFromPercentage(nt){if(!this.active)return 0;let rt=0;player.time();let it=player.duration();this.inLiveStream&&(rt=it-_t.config["live-window-time"],rt<0&&(rt=0)),rt&&(it-=rt,it<0&&(it=0));let at=parseInt(rt+nt*(it/100));return console.log("SEEK PERCENT",nt,rt,player.time(),player.duration(),it,at),at}seekByPercentage(nt){if(this.active){let rt=player.time(),it=this.seekTimeFromPercentage(nt);this.seekTo(it,rt>it?"rewind":"forward"),_t.emit("streamer-seek",it),this.seekBarUpdate(!0)}}seekTo(nt,rt){if(!this.state)return;if(window.capacitor&&"video/mp2t"==this.activeMimetype)return clearTimeout(this.seekFailureTimer),void(this.seekFailureTimer=setTimeout((()=>_t.emit("streamer-seek-failure")),2e3));"number"!=typeof this.seekingFrom&&(this.seekingFrom=player.time());let it=nt,at=0,st=player.duration(),ot=Math.max(0,st-2);if(this.inLiveStream){if(at=st-_t.config["live-window-time"],this.seekingFrom<at&&(at=this.seekingFrom),player.current.object.buffered&&player.current.object.buffered.length){let nt=player.current.object.buffered.start(0);nt<at&&(at=nt)}at<0&&(at=0)}it<at?it=at:it>ot&&(it=ot),"rewind"==rt&&this.seekingFrom<it&&(it=this.seekingFrom),"forward"==rt&&this.seekingFrom>it&&(it=this.seekingFrom),this.emit("before-seek",it),clearTimeout(this.seekTimer),this.seekTimer=setTimeout((()=>{this.seekTimer=0,player.resume()}),1500);let lt=parseInt(it-this.seekingFrom);player.pause(),player.time(it),this.emit("after-seek",it),console.log("seeking pre",lt,it,this.seekingFrom),this.seekLayerRemoveTimer&&clearTimeout(this.seekLayerRemoveTimer),lt<0?(this.seekRewindLayerCounter.innerText="-"+this.hmsMin(lt),document.body.classList.remove("seek-fwd"),document.body.classList.add("seek-back")):lt>0?(this.seekForwardLayerCounter.innerText="+"+this.hmsMin(lt),document.body.classList.remove("seek-back"),document.body.classList.add("seek-fwd")):rt?"rewind"==rt?(this.seekRewindLayerCounter.innerText=this.hmsMin(lt),document.body.classList.add("seek-back"),document.body.classList.remove("seek-fwd")):(this.seekForwardLayerCounter.innerText=this.hmsMin(lt),document.body.classList.remove("seek-back"),document.body.classList.add("seek-fwd")):(document.body.classList.remove("seek-back"),document.body.classList.remove("seek-fwd")),this.seekLayerRemoveTimer=setTimeout((()=>{document.body.classList.remove("seek-back"),document.body.classList.remove("seek-fwd")}),3e3),this.seekBarUpdate(!0,it)}seekRewind(nt=1){if(this.active){let rt=player.time()-nt*this.seekSkipSecs;this.seekTo(rt,"rewind")}}seekForward(nt=1){if(this.active){let rt=player.time()+nt*this.seekSkipSecs;this.seekTo(rt,"forward")}}}class StreamerLiveStreamClockTimer extends StreamerSeek{constructor(nt){super(nt),this.useLiveStreamClockTimer=!0,this.calcOverDuration=!0,this.on("start",(()=>{this.resetClockTimer()})),player.on("durationchange",(()=>{this.detectPlayerReset()})),this.on("state",(nt=>{if("playing"===nt)this.detectPlayerReset()}))}detectPlayerReset(){const nt=player.duration();this.altPlaybackStartTime=time()-nt,nt<this.clockTimerLastDuration&&this.resetClockTimer()}resetClockTimer(){const nt=time(),rt=player.duration();this.calcOverDuration=!0,this.playbackStartTime=nt,this.initialPlaybackTime=player.time(),this.clockTimerLastDuration=this.initialDurationTime=rt,this.altPlaybackStartTime=nt-rt,this.initialDurationTime-this.initialPlaybackTime>60&&(this.calcOverDuration=!1)}clockTimerDuration(){return time()-(this.calcOverDuration?this.altPlaybackStartTime:this.playbackStartTime)+this.initialPlaybackTime}clockTimerCurrentTime(){const nt=player.time();return(this.calcOverDuration?this.altPlaybackStartTime:this.playbackStartTime)+(nt-this.initialPlaybackTime)}}class StreamerClientTimeWarp extends StreamerLiveStreamClockTimer{constructor(nt){super(nt),this.maxRateChange=.15,this.defaultBufferTimeSecs={pressure:6,lazy:20},this.currentPlaybackRate=1,player.on("timeupdate",(nt=>this.doTimeWarp(nt))),player.on("durationchange",(()=>this.doTimeWarp())),_t.on("streamer-connect",((nt,rt,it,at)=>{!_t.config["in-disk-caching-size"]&&rt.toLowerCase().includes("mpegurl")&&"video"!=at?this.bufferTimeSecs=this.defaultBufferTimeSecs.pressure:this.bufferTimeSecs=this.defaultBufferTimeSecs.lazy,player.playbackRate(.9)})),_t.on("outside-of-live-window",(()=>this.syncLiveWindow())),this.on("stuck",(()=>this.syncLiveWindow()))}syncLiveWindow(){if(!this.inLiveStream)return;const nt=player.time();let rt,it=player.duration();rt=!_t.config["in-disk-caching-size"]&&this.activeMimetype.includes("mpegurl")&&"video"!=this.activeMediatype?this.clockTimerDuration():it;let at=parseInt(rt-(_t.config["live-window-time"]+10));at&&at>nt+10&&this.seekTo(at,"forward")}doTimeWarp(nt){if(this.inLiveStream&&_t.config["playback-rate-control"]&&null!==this.timewarpInitialPlaybackTime){"number"!=typeof nt&&(nt=player.time());let rt,it=player.duration();if(rt=!_t.config["in-disk-caching-size"]&&this.activeMimetype.includes("mpegurl")&&"video"!=this.activeMediatype?this.clockTimerDuration():it,rt<nt)return;const at=rt-nt;let st=1+(at-this.bufferTimeSecs)*(this.maxRateChange/this.bufferTimeSecs);st=Math.min(1+this.maxRateChange,Math.max(1-this.maxRateChange,st)),Math.abs(st-this.currentPlaybackRate)>.02&&(this.currentPlaybackRate=st,console.warn("PlaybackRate="+st+"x","remaining "+parseInt(at)+" secs"),player.playbackRate(st))}}hmsSecondsToClock(nt){var rt=parseInt(nt,10),it=Math.floor(rt/3600),at=Math.floor((rt-3600*it)/60),st=rt-3600*it-60*at;return it<10&&(it="0"+it),at<10&&(at="0"+at),st<10&&(st="0"+st),it+":"+at+":"+st}}class StreamerAndroidNetworkIP extends StreamerClientTimeWarp{constructor(nt){super(nt),window.capacitor&&(plugins.megacubo.on("network-ip",(nt=>{nt&&(console.warn("Network IP received: "+nt),_t.emit("network-ip",nt))})),this.updateNetworkIp(),this.on("start",(()=>this.updateNetworkIp())))}updateNetworkIp(){plugins.megacubo.getNetworkIp()}}class StreamerClientVideoFullScreen extends StreamerAndroidNetworkIP{constructor(nt){super(nt);let rt=this.controls.querySelector("button.fullscreen");"fullscreen"==_t.config["startup-window"]?(this.inFullScreen=!0,document.body.classList.add("fullscreen"),rt&&(rt.style.display="none"),this.enterFullScreen()):(window.capacitor?(rt&&(rt.style.display="none"),plugins.megacubo.on("metrics",this.updateAndroidScreenMetrics.bind(this)),plugins.megacubo.on("nightmode",this.handleDarkModeInfoDialog.bind(this)),this.updateAndroidScreenMetrics(plugins.megacubo.metrics)):(this.inFullScreen=!1,rt&&(rt.style.display="inline-flex")),this.on("fullscreenchange",(nt=>{nt?document.body.classList.add("fullscreen"):document.body.classList.remove("fullscreen")})))}handleDarkModeInfoDialog(nt){nt.miui&&nt.mode&&16!=nt.mode&&_t.menu.dialog([{template:"question",text:document.title,fa:"fas fa-info-circle"},{template:"message",text:_t.lang.MIUI_DARK_MODE_HINT},{template:"option",text:"OK",id:"submit",fa:"fas fa-check-circle"}])}updateAndroidScreenMetrics(nt){nt&&void 0!==nt.bottom&&(this.metrics=nt),this.inFullScreen||!this.metrics?css(" :root { --menu-padding-top: 0px; --menu-padding-bottom: 0.5vmin; --menu-padding-right: 0.5vmin; --menu-padding-left: 0.5vmin; } ","frameless-window"):css(" :root { --menu-padding-top: "+this.metrics.top+"px; --menu-padding-bottom: calc(0.5vmin +  "+this.metrics.bottom+"px); --menu-padding-right:  calc(0.5vmin +  "+this.metrics.right+"px); --menu-padding-left: calc(0.5vmin +  "+this.metrics.left+"px); } ","frameless-window")}updateAfterLeaveAndroidMiniPlayer(){screen.width==window.outerWidth&&screen.height==window.outerHeight&&this.active&&this.enterFullScreen()}enterFullScreen(){window.capacitor?(this.pipLeaveListener||(this.pipLeaveListener=()=>{console.log("LEAVING PIP",screen.width,screen.height,window.outerWidth,window.outerHeight,this.active),this.updateAfterLeaveAndroidMiniPlayer()}),plugins.megacubo.enterFullScreen(),winActions.listeners("leave").includes(this.pipLeaveListener)||winActions.on("leave",this.pipLeaveListener)):parent.Manager.setFullScreen(!0),this.inFullScreen=!0,this.emit("fullscreenchange",this.inFullScreen)}leaveFullScreen(){this.inFullScreen&&(this.inFullScreen=!1,window.capacitor?(this.pipLeaveListener&&winActions.removeListener("leave",this.pipLeaveListener),plugins.megacubo.leaveFullScreen()):parent.Manager.setFullScreen(!1),this.emit("fullscreenchange",this.inFullScreen))}toggleFullScreen(){this.inFullScreen?this.leaveFullScreen():winActions&&winActions.inPIP?winActions.leave().catch(console.error):this.enterFullScreen()}}class StreamerAudioUI extends StreamerClientVideoFullScreen{constructor(nt){super(nt),this.isAudio=!1,_t.on("codecData",(nt=>{nt.audio&&!nt.video?(this.isAudio=!0,winActions&&winActions.backgroundModeLock("audio"),document.body.classList.add("audio")):(this.isAudio=!1,winActions&&winActions.backgroundModeUnlock("audio"),document.body.classList.remove("audio")),this.emit("codecData",nt)})),_t.on("streamer-audio-track",(nt=>{console.warn("SET TRACK",nt),player.audioTrack(nt)})),_t.on("streamer-subtitle-track",(nt=>{console.warn("SET TRACK",nt),player.subtitleTrack(nt)})),_t.on("streamer-add-subtitle-track",(nt=>{console.warn("ADD TRACK",nt),player.current&&player.current.addTextTrack(nt)})),this.on("stop",(()=>{this.isAudio=!1,winActions&&winActions.backgroundModeUnlock("audio"),document.body.classList.remove("audio")})),this.on("state",(nt=>{"playing"==nt&&this.muted&&(player.muted()||this.volumeMute())})),player.on("audioTracks",(nt=>_t.emit("audioTracks",nt))),player.on("subtitleTracks",(nt=>_t.emit("subtitleTracks",nt))),this.volumeInitialized=!1,this.volumeLastClickTime=0,this.volumeShowTimer=0,this.volumeHideTimer=0}startVolumeHideTimer(){clearTimeout(this.volumeHideTimer),this.volumeHideTimer=setTimeout((()=>this.volumeBarHide()),1500)}volumeBarVisible(){return"none"!=this.volumeBar.style.display}volumeBarShow(){this.volumeBar.style.display="inline-table",this.startVolumeHideTimer()}volumeBarHide(){this.volumeInputRect&&(this.volumeBar.style.display="none",this.volumeInputRect=null)}volumeBarToggle(nt){if(nt.target&&nt.target.tagName&&["button","volume-wrap","i"].includes(nt.target.tagName.toLowerCase()))if(this.volumeBarVisible()){let nt=time();this.volumeLastClickTime<nt-.4&&(this.volumeLastClickTime=nt,this.volumeBarHide())}else this.volumeBarShow()}volumeBarCalcValueFromMove(nt){this.volumeInputRect||(this.volumeInputRect=this.volumeInput.getBoundingClientRect());const rt=this.volumeInputRect;let it=100-(nt.touches[0].clientY-rt.top)/(rt.height/100);it=Math.max(0,Math.min(100,it)),this.volumeInput.value!=it&&(this.volumeInput.value=it,this.volumeChanged())}setupVolume(){this.addPlayerButton("volume","VOLUME","fas fa-volume-up",4,this.volumeBarShow.bind(this)),this.volumeButton=this.getPlayerButton("volume"),this.volumeButton.insertBefore(this.buildElementFromHTML('<volume><volume-wrap><div><input type="range" min="0" max="100" step="1" value="'+_t.config.volume+'" /><div id="volume-arrow"></div></div></volume-wrap></volume>'),this.volumeButton.firstChild),this.volumeBar=this.volumeButton.querySelector("volume"),this.volumeInput=this.volumeBar.querySelector("input"),window.capacitor?this.volumeInput.addEventListener("touchmove",this.volumeBarCalcValueFromMove.bind(this),{passive:!0}):(this.volumeInput.addEventListener("input",this.volumeChanged.bind(this)),this.volumeInput.addEventListener("mouseenter",(()=>{clearTimeout(this.volumeShowTimer),this.volumeShowTimer=setTimeout((()=>this.volumeBarShow()),400)})),this.volumeInput.addEventListener("mouseleave",(()=>{clearTimeout(this.volumeShowTimer)})));let nt,touchListener=rt=>{nt=!0,this.volumeInput.removeEventListener("touchstart",touchListener)};this.volumeInput.addEventListener("touchstart",touchListener),this.volumeInput.addEventListener("click",(rt=>{if(!rt.target||nt||!["volume-wrap","i"].includes(rt.target.tagName.toLowerCase()))return;parseFloat(this.volumeInput.value)?this.volumeMute():this.volumeUnmute()})),this.once("start",(()=>this.volumeChanged())),_t.idle.on("idle",(()=>this.volumeBarHide())),_t.menu.on("focus",(nt=>{nt==this.volumeButton?this.volumeBarVisible()||(this.volumeLastClickTime=time(),this.volumeBarShow()):this.volumeBarHide()})),this.volumeButton.addEventListener("blur",(()=>{document.activeElement==this.volumeInput||document.activeElement.contains(this.volumeInput)||this.volumeBarHide()}),{passive:!0})}isVolumeButtonActive(){let nt=_t.menu.selected();return nt&&nt.id&&"volume"==nt.id}volumeUp(){this.volumeInput.value=Math.min(parseInt(this.volumeInput.value)+1,100),this.volumeChanged()}volumeDown(){this.volumeInput.value=Math.max(parseInt(this.volumeInput.value)-1,0),this.volumeChanged()}volumeMute(){const nt=parseFloat(this.volumeInput.value);nt&&(this.unmuteVolume=nt),this.muted=!0,this.volumeInput.value=0,this.volumeChanged()}volumeUnmute(){this.muted=!1,this.volumeInput.value=this.unmuteVolume||100,this.volumeChanged()}volumeChanged(){let nt=parseInt(this.volumeInput.value);if(!this.volumeInitialized||nt!=this.volume){let rt="fas fa-volume-up",it=this.volume?50+this.volume/2:100;this.volume=nt,this.volume||(rt="fas fa-volume-mute"),css(`\n            i.fas.fa-volume-up { \n                -webkit-mask-image: linear-gradient(to right, white 0%, white ${it}%, rgba(255, 255, 255, 0.15) ${it}%);\n                mask-image: linear-gradient(to right, white 0%, white ${it}%, rgba(255, 255, 255, 0.15) ${it}%);\n            }`,"volume-icon"),this.volumeInput.style.background="linear-gradient(to right, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 1) "+nt+"%, rgba(0, 0, 0, 0.68) "+nt+".01%)",player.volume(nt),this.volumeInitialized?(_t.osd.show(this.volume?_t.lang.VOLUME+": "+nt:_t.lang.MUTE,rt,"volume","normal"),this.saveVolume()):this.volumeInitialized=!0,rt!=this.lastVolIcon&&(this.lastVolIcon=rt,this.updatePlayerButton("volume",null,rt))}this.startVolumeHideTimer()}saveVolume(){this.saveVolumeTimer&&clearTimeout(this.saveVolumeTimer),this.saveVolumeTimer=setTimeout((()=>{_t.emit("config-set","volume",this.volume)}),3e3)}}class StreamerClientControls extends StreamerAudioUI{constructor(nt){super(nt),_t.on("add-player-button",this.addPlayerButton.bind(this)),_t.on("update-player-button",this.updatePlayerButton.bind(this)),_t.on("enable-player-button",this.enablePlayerButton.bind(this)),_t.on("streamer-info",(nt=>{this.controls.querySelector("#streamer-info > div").innerHTML=nt.replaceAll("\n","<br />")})),this.on("state",(nt=>{["loading","paused"].includes(nt)&&_t.emit("streamer-update-streamer-info")})),this.addPlayerButton("play-pause","PAUSE",'\n            <i class="fas fa-play play-button"></i>\n            <i class="fas fa-pause pause-button"></i>',0,(()=>{this.playOrPauseNotIdle()})),this.addPlayerButton("stop","STOP","fas fa-stop",1,(()=>{if(this.casting)return this.castUIStop();this.stop()})),this.addPlayerButton("next","GO_NEXT","fas fa-step-forward",5,(()=>_t.emit("go-next"))),this.setupVolume(),this.addPlayerButton("tune","RETRY",_t.config["tuning-icon"],7,(()=>_t.emit("reload-dialog"))),this.addPlayerButton("ratio","ASPECT_RATIO","fas fa-expand-alt",10,(()=>{this.switchAspectRatio();let nt=this.activeAspectRatio.custom?_t.lang.ORIGINAL:this.activeAspectRatio.h+":"+this.activeAspectRatio.v;_t.osd.show(_t.lang.ASPECT_RATIO+": "+nt,"","ratio","normal")}),.9),window.capacitor||"fullscreen"==_t.config["startup-window"]||this.addPlayerButton("fullscreen","FULLSCREEN","fas fa-expand",11,(()=>{this.toggleFullScreen()}),.85),this.addPlayerButton("stream-info","ABOUT","fas fa-ellipsis-v",12,(()=>_t.emit("about"))),this.controls.querySelectorAll("button").forEach((nt=>{nt.addEventListener("touchstart",(()=>_t.menu.focus(nt)),{passive:!0})})),this.emit("draw"),document.querySelector("#menu").addEventListener("click",(nt=>{"menu"==nt.target.id&&(!this.active||_t.menu.inModal()||_t.menu.isExploring()||this.playOrPauseNotIdle())}))}buildElementFromHTML(nt){const rt=document.createElement("span");return rt.innerHTML=nt,rt.firstElementChild}addPlayerButton(nt,rt,it,at=-1,st,ot=-1){const lt=nt.split(" ")[0],ut=_t.lang[rt];if(this.getPlayerButton(lt))return;let ct=this.controls.querySelector("#buttons"),dt=it.includes("<")?it:'<i class="'+it+'"></i>',ht=`\n        <button id="${lt}" data-position="${at}" class="${nt}" title="${ut}" aria-label="${ut}">\n            <span class="button-icon">${dt}</span>\n            <span class="button-label"><span><span>${ut}</span></span></span>\n        </button>\n`;-1!=ot&&(ht=ht.replace("></i>",' style="transform: scale('+ot+')"></i>'));const pt=this.buildElementFromHTML(ht),Et=ct.querySelectorAll("button");if(Et.length){let nt,rt="after";Array.from(Et).some((it=>{if(!(parseInt(it.getAttribute("data-position"))<at))return nt=it,rt="before",!0;nt=it})),"after"==rt&&at>=7&&parseInt(nt.getAttribute("data-position"))<7&&(nt=ct.querySelector("span.filler")),"after"==rt?nt.insertAdjacentElement("afterend",pt):nt.parentNode.insertBefore(pt,nt)}else ct.insertBefore(pt,ct.firstChild);let St=ct.querySelector("#"+lt);"function"==typeof st?St.addEventListener("click",st,{passive:!0}):St.addEventListener("click",(()=>_t.emit(st)),{passive:!0}),"cast"==ut&&parent.Manager&&parent.Manager.exitPage.touch(),this.emit("added-player-button",lt,ut,St,it)}getPlayerButton(nt){return this.controls.querySelector("#buttons #"+nt.split(" ")[0])}updatePlayerButton(nt,rt,it,at=-1){let st=this.getPlayerButton(nt);if(!st)return console.error("Button #"+nt+" not found");if(rt&&(st.querySelector(".button-label > span > span").innerText=rt,st.setAttribute("title",rt),st.setAttribute("aria-label",rt)),it){let nt=`<i class="${it}"></i>`;-1!=at&&(nt=nt.replace("></i>",' style="transform: scale('+at+')"></i>')),st.querySelector("i").replaceWith(this.buildElementFromHTML(nt))}this.emit("updated-player-button",nt,rt,st,it)}enablePlayerButton(nt,rt){let it=this.getPlayerButton(nt);it?it.style.display=rt?"inline-flex":"none":console.error("Button "+nt+" not found")}}class StreamerClientController extends StreamerClientControls{constructor(nt){super(nt),this.active=!1,player.on("show",(()=>this.emit("show"))),player.on("hide",(()=>this.emit("hide")))}start(nt,rt,it,at){this.active=!0,this.activeSrc=nt,this.activeSubtitle=this.data.subtitle||"",this.activeCookie=it,this.activeMimetype=(rt||"").toLowerCase(),this.activeMediatype=at,this.inLiveStream=["live","audio"].includes(this.activeMediatype),player.load(nt,rt,this.activeSubtitle,it,this.activeMediatype,this.data),this.emit("start")}stop(nt){!this.active||this.transitioning||this.transcodeStarting||(this.active=!1,this.activeSrc="",this.activeMimetype="",player.unload(),console.log("STOPCLIENT",nt),!0!==nt&&_t.emit("stop"),this.emit("stop"),this.casting&&this.castUIStop())}}class StreamerClient extends StreamerClientController{constructor(nt){super(nt),this.bind(),(nt=>{nt.zappingIcon="fas fa-random",_t.on("is-zapping",((rt,it)=>{nt.isZapping=rt,rt?it?_t.osd.hide("zap"):(_t.osd.hide("streamer"),_t.osd.show(_t.lang.ZAPPING,nt.zappingIcon,"zap","persistent")):_t.osd.hide("zap")})),_t.on("streamer-connect",(()=>{nt.enablePlayerButton("zap",!!nt.isZapping),nt.enablePlayerButton("tune",!nt.isZapping)}))})(this)}errorCallback(nt,rt){this.autoTuning&&!this.transcodeStarting&&this.stateListening&&!rt.startsWith("video/")&&_t.menu.dialog([{template:"question",text:"",fa:"fas fa-question-circle"},{template:"option",text:_t.lang.PLAY_ALTERNATE,id:"tune",fa:_t.config["tuning-icon"]},{template:"option",text:_t.lang.STOP,id:"stop",fa:"fas fa-stop-circle"},{template:"option",text:_t.lang.RETRY,id:"retry",fa:"fas fa-sync"}],(nt=>{switch(nt){case"tune":_t.emit("tune");break;case"retry":_t.emit("retry");break;default:this.stop()}return!0}),"tune")}bind(){_t.on("pause",(()=>{console.warn("PAUSE"),player.pause()})),_t.on("debug-tuning",(()=>{this.debugTuning=!0})),_t.on("streamer-connect",((nt,rt,it,at,st,ot)=>{this.debugTuning&&_t.osd.show("CONNECT "+st.name,"fas fa-info-circle faclr-red","debug2","normal"),this.transitioning=!0,this.bindStateListener(),this.isTryOtherDlgActive()&&_t.menu.endModal(),this.data=st,this.autoTuning=ot,console.warn("CONNECT",nt,rt,it,at,st,ot),this.start(nt,rt,it,at),_t.osd.hide("streamer"),setTimeout((()=>{this.transitioning=!1,this.emit("transitioned"),this.emit("transitioned")}),150)})),_t.on("transcode-starting",(nt=>{console.warn("TRANSCODING",nt),this.transcodeStarting=nt,nt&&(_t.osd.hide("debug-conn-err"),_t.osd.hide("streamer")),nt=nt?"loading":this.state,this.stateListener(nt,null,!0),this.speedoUpdate()})),_t.on("streamer-connect-suspend",(()=>{this.unbindStateListener(),player.current&&player.current.hls&&player.current.hls.stopLoad(),player.pause(),this.stateListener("loading")})),_t.on("streamer-disconnect",((nt,rt)=>{this.unbindStateListener(),console.warn("DISCONNECT",nt,rt),this.autoTuning=rt,this.stop(!0)}))}}function create_fragment$4(nt){let rt,it,at,st,ot,lt,ut,ct,dt,ht,pt,_t,Et,St,wt,Lt,Ct,Pt,kt,Ot,Ft;return{c(){rt=element("player"),rt.innerHTML='<div><video crossorigin="" plays-inline="" webkit-playsinline="" poster="./assets/images/blank.png"></video> <audio crossorigin="" plays-inline="" webkit-playsinline="" poster="./assets/images/blank.png"></audio></div>',it=space(),at=element("controls"),at.innerHTML='<div id="streamer-info"><div></div></div> <seekbar><input type="range" min="0" max="100" value="0"/> <div><div></div></div></seekbar> <div id="buttons"><span class="status"></span> <span class="filler"></span></div> <div id="arrow-down-hint"><i class="fas fa-chevron-down"></i></div>',st=space(),ot=element("div"),lt=space(),ut=element("div"),ct=space(),dt=element("div"),dt.innerHTML='<span class="control-layer-icon"><i class="fas fa-play"></i></span>',ht=space(),pt=element("div"),pt.innerHTML='<span class="control-layer-icon"></span>',_t=space(),Et=element("div"),Et.innerHTML='<span class="control-layer-icon"><i class="fas fa-circle-notch fa-spin"></i></span> <span class="loading-layer-status"><span></span></span>',St=space(),wt=element("div"),wt.innerHTML='<span class="control-layer-icon"><i class="fab fa-chromecast"></i></span>',Lt=space(),Ct=element("div"),Ct.innerHTML='<span class="control-layer-icon"><i class="fas fas fa-backward"></i></span> <span class="seek-layer-time"><span></span></span>',Pt=space(),kt=element("div"),kt.innerHTML='<span class="control-layer-icon"></span>',Ot=space(),Ft=element("div"),Ft.innerHTML='<span class="control-layer-icon"><i class="fas fas fa-forward"></i></span> <span class="seek-layer-time"><span></span></span>',attr(ot,"class","curtain curtain-a"),attr(ut,"class","curtain curtain-b"),attr(dt,"id","paused-layer"),attr(dt,"class","control-layer"),attr(dt,"aria-hidden","true"),attr(pt,"id","audio-layer"),attr(pt,"class","control-layer"),attr(pt,"aria-hidden","true"),attr(Et,"id","loading-layer"),attr(Et,"class","control-layer"),attr(Et,"aria-hidden","true"),attr(wt,"id","cast-layer"),attr(wt,"class","control-layer"),attr(wt,"aria-hidden","true"),attr(Ct,"id","seek-back"),attr(Ct,"class","control-layer"),attr(Ct,"aria-hidden","true"),attr(kt,"id","button-action-feedback"),attr(kt,"class","control-layer"),attr(kt,"aria-hidden","true"),attr(Ft,"id","seek-fwd"),attr(Ft,"class","control-layer"),attr(Ft,"aria-hidden","true")},m(nt,Bt){insert(nt,rt,Bt),insert(nt,it,Bt),insert(nt,at,Bt),insert(nt,st,Bt),insert(nt,ot,Bt),insert(nt,lt,Bt),insert(nt,ut,Bt),insert(nt,ct,Bt),insert(nt,dt,Bt),insert(nt,ht,Bt),insert(nt,pt,Bt),insert(nt,_t,Bt),insert(nt,Et,Bt),insert(nt,St,Bt),insert(nt,wt,Bt),insert(nt,Lt,Bt),insert(nt,Ct,Bt),insert(nt,Pt,Bt),insert(nt,kt,Bt),insert(nt,Ot,Bt),insert(nt,Ft,Bt)},p:noop$1,i:noop$1,o:noop$1,d(nt){nt&&(detach(rt),detach(it),detach(at),detach(st),detach(ot),detach(lt),detach(ut),detach(ct),detach(dt),detach(ht),detach(pt),detach(_t),detach(Et),detach(St),detach(wt),detach(Lt),detach(Ct),detach(Pt),detach(kt),detach(Ot),detach(Ft))}}}function instance$2(nt){const load=()=>{window.player=new MediaPlayer(document.querySelector("player")),window.capacitor||["play","pause","seekbackward","seekforward","seekto","previoustrack","nexttrack","skipad"].forEach((nt=>{try{navigator.mediaSession.setActionHandler(nt,(()=>{}))}catch(nt){}})),_t.streamer=window.streamer=new StreamerClient(document.querySelector("controls")),_t.idle.on("away",(()=>{_t.streamer.active||_t.streamer.isTuning()||_t.idle.energySaver.start()})),_t.idle.on("active",(()=>_t.idle.energySaver.end())),_t.streamer.on("hide",(()=>{_t.idle.reset(),_t.idle.energySaver.end()})),_t.localEmit("streamer-ready"),_t.emit("streamer-ready")};return onMount((async()=>{_t.menu?load():_t.once("menu-ready",load)})),[]}class Player extends SvelteComponent{constructor(nt){super(),init(this,nt,instance$2,create_fragment$4,safe_not_equal,{})}}const colorChannelMixer=(nt,rt,it)=>parseInt(nt*it+rt*(1-it)),colorMixer=(nt,rt,it)=>"rgb("+[colorChannelMixer(nt[0],rt[0],it),colorChannelMixer(nt[1],rt[1],it),colorChannelMixer(nt[2],rt[2],it)].join(", ")+")",convertHexUnitTo256=nt=>parseInt(nt.repeat(2/nt.length),16),getAlphafloat=(nt,rt)=>{if(void 0!==nt)return nt/256;if(void 0!==rt){if(1<rt&&rt<=100)return rt/100;if(0<=rt&&rt<=1)return rt}return 1},hexToRGBA=(nt,rt)=>{if(!(nt=>/^#([A-Fa-f0-9]{3,4}){1,2}$/.test(nt))(nt))throw new Error("Invalid HEX "+nt);const it=Math.floor((nt.length-1)/3),at=((nt,rt)=>nt.match(new RegExp(`.{${rt}}`,"g")))(nt.slice(1),it),[st,ot,lt,ut]=at.map(convertHexUnitTo256);return"rgba("+[st,ot,lt,getAlphafloat(ut,rt)].join(", ")+")"},hexToRgb=nt=>{var rt=nt.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((nt,rt,it,at)=>rt+rt+it+it+at+at)),it=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(rt);return it?{r:parseInt(it[1],16),g:parseInt(it[2],16),b:parseInt(it[3],16)}:nt};const Rs=new class Theme{constructor(){this.curtains=Array.from(document.querySelectorAll(".curtain")),this.splashStartTime=(new Date).getTime(),window.addEventListener("resize",(()=>this.updateFontSize()))}renderBackground(nt){console.warn("theming renderbackground",nt);const rt=document.getElementById("background");if(nt.video){rt.style.backgroundImage="none";var it=rt.querySelector("video");it&&it.src==nt.video||(rt.innerHTML="&nbsp;",setTimeout((function(){rt.innerHTML='<video crossorigin src="'+nt.video+'" onerror="setTimeout(() => {if(this.parentNode)this.load()}, 500)" loop muted autoplay style="background-color: black;object-fit: cover;" poster="./assets/images/blank.png"></video>'}),1e3))}else{var at='url("'+nt.image+'")';rt.style.backgroundImage!=at&&(rt.style.backgroundImage=at),rt.innerHTML=""}this.setCurtainsTransition(!1,!1)}animateBackground(nt){console.warn("animateBackground",nt);var rt=document.body.className||"";if(nt.includes("-desktop")&&(nt=window.capacitor?"none":nt.replace("-desktop","")),nt!=this.currentAnimateBackground)if(this.currentAnimateBackground=nt,"fast"==nt){var it="animate-background-fast";rt.includes(it)||(document.body.className=rt.replace(new RegExp("animate-background-[a-z]+","g"),"")+" "+it)}else if("slow"==nt){it="animate-background-slow";rt.includes(it)||(document.body.className=rt.replace(new RegExp("animate-background-[a-z]+","g"),"")+" "+it)}else{it="animate-background";rt.includes(it)&&(document.body.className=rt.replace(new RegExp("animate-background-[a-z]+","g"),""))}}update(nt,rt,it,at,st){console.warn("theming",nt,rt,it,at,st);let ot=localStorage.getItem("background-data");const lt=document.getElementById("background"),ut=document.getElementById("splash");if(!lt)return;var ct,dt={image:screen.width>1920?"./assets/images/background-3840x2160.jpg":"./assets/images/background-1920x1080.jpg",video:"",color:"#15002C",fontColor:"#FFFFFF",animate:"none"};if(ot)ot=JSON.parse(ot),Object.keys(dt).forEach((function(nt){void 0===ot[nt]&&(ot[nt]=dt[nt])}));else{ot=dt;try{localStorage.setItem("background-data",JSON.stringify(ot))}catch($t){console.error($t),ot.video="",ot.image="",localStorage.setItem("background-data",JSON.stringify(ot)),ot.image=nt,ot.video=rt}}if(("string"==typeof nt||"string"==typeof rt)&&(nt!=ot.image&&(ot.image=nt||dt.image,ct=!0),rt!=ot.video&&(ot.video=rt||dt.video,ct=!0),at!=ot.fontColor&&(ot.fontColor=at,ct=!0),it!=ot.color&&(ot.color=it,ct=!0),st!=ot.animate&&(ot.animate=st||"none",ct=!0),ct))try{localStorage.setItem("background-data",JSON.stringify(ot))}catch($t){console.error($t),ot.image="",ot.video="",localStorage.setItem("background-data",JSON.stringify(ot)),ot.image=nt,ot.video=rt}ot.image||ot.video||(ot.image=dt.image),ot.video?ot.image="":ot.video=dt.video,console.warn("theming pre renderbackground",ot),!0===this.themeBackgroundReady?this.renderBackground(ot):void 0===this.themeBackgroundReady&&(this.themeBackgroundReady=(nt=>{this.themeBackgroundReady=!0,this.renderBackground(nt)}).apply(this,[ot])),ut&&(ut.style.backgroundColor=ot.color,ut.style.color=ot.fontColor);const ht='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif';let pt=_t.config["font-family"];pt?pt.includes(ht)||(pt+=","+ht):pt=ht;const Et=colorMixer(Object.values(hexToRgb(_t.config["background-color"])),[0,0,0],.5),St=hexToRGBA(_t.config["background-color"],_t.config["background-color-transparency"]/100),wt=hexToRGBA(_t.config["background-color"],.75),Lt=hexToRGBA(_t.config["font-color"],.6),Ct=parseFloat(window.getComputedStyle(document.documentElement).getPropertyValue("--menu-fx-nav-intensity-step").trim()),Pt=_t.config["fx-nav-intensity"]*Ct;let kt;if(_t.config["fx-nav-intensity"]){let nt=.175,rt=1;kt=nt+_t.config["fx-nav-intensity"]*((rt-nt)/10)}else kt=0;const Ot=window.capacitor?"1vmax":"9px",Ft=_t.config["uppercase-menu"]?"uppercase":"none";let setAlpha=(nt,rt)=>nt.replace("rgb(","rgba(").replace(")",", "+rt+")"),Bt=[70,70,70],Ut=.9,Gt=setAlpha(hexToRgb(colorMixer(Object.values(hexToRgb(_t.config["background-color"])),Bt,Ut)),.5),Ht=setAlpha(hexToRgb(colorMixer(Object.values(hexToRgb(_t.config["background-color"])),Bt,Ut)),.65),jt=setAlpha(hexToRgb(colorMixer(Object.values(hexToRgb(_t.config["background-color"])),Bt,Ut)),.7),Kt=setAlpha(hexToRgb(colorMixer(Object.values(hexToRgb(_t.config["background-color"])),Bt,Ut)),1);Bt=[255,255,255];let $t=hexToRgb(colorMixer(Object.values(hexToRgb(_t.config["background-color"])),Bt,.32)),Yt=hexToRgb(colorMixer(Object.values(hexToRgb(_t.config["background-color"])),Bt,.4)),Wt=_t.config["view-size"].landscape.x>1?"column":"row",Qt=_t.config["view-size"].portrait.x>1?"column":"row",en=`\n        :root {\n            --menu-fx-nav-duration: ${kt}s;\n            --font-color: ${_t.config["font-color"]};\n            --secondary-font-color: ${Lt};\n            --background-color: ${_t.config["background-color"]};\n            --modal-background-color: ${St};\n            --osd-background-color: ${wt};\n            --shadow-background-color: ${Et};\n            --menu-fx-nav-intensity: ${Pt};    \n            --radius: ${Ot};\n        }\n        @media (orientation: landscape) {\n            :root {\n                --entries-per-row: ${_t.config["view-size"].landscape.x} !important;\n                --entries-per-col: ${_t.config["view-size"].landscape.y} !important;\n            }\n        }\n        @media (orientation: portrait) {\n            :root {\n                --entries-per-row: ${_t.config["view-size"].portrait.x} !important;\n                --entries-per-col: ${_t.config["view-size"].portrait.y} !important;\n            }\n        }\n        body {\n            font-family: ${pt};\n        }\n        body.video, body.idle:not(.video) {\n            --shadow-background-color: rgba(0, 0, 0, 0.8);\n        }\n        body:not(.portrait) #menu content wrap {\n            grid-template-columns: repeat(${_t.config["view-size"].landscape.x}, 1fr);\n            grid-template-rows: repeat(${_t.config["view-size"].landscape.y}, 1fr);\n        }\n        body.portrait #menu content wrap {\n            grid-template-columns: repeat(${_t.config["view-size"].portrait.x}, 1fr);\n            grid-template-rows: repeat(${_t.config["view-size"].portrait.y}, 1fr);\n        }\n        *:not(input):not(textarea) {\n            text-transform: ${Ft};\n        }\n        #menu a span.entry-wrapper {\n            background: linear-gradient(to top, ${Gt} 0%, ${Ht} 75%, ${jt} 100%) !important;\n            border: 1px solid ${Ht} !important;\n        }\n        #menu content a.selected span.entry-wrapper {\n            background: linear-gradient(to top, ${Ht} 0%, ${jt} 75%, ${Kt} 100%) !important;\n            border: 1px solid ${Kt} !important;\n        }\n        .modal-wrap > div {\n            background: linear-gradient(to bottom, ${$t} 0%, ${Yt} 100%) !important;\n        }\n        /* removed as bugfix\n        body.portrait .entry-2x {\n            grid-${Qt}-start: span 2 !important;\n        }\n        */\n        body:not(.portrait) .entry-2x {\n            grid-${Wt}-start: span 2 !important;\n        }\n        `;_t.css(en,"theme"),this.updateFontSize(),this.animateBackground(ot.video?"none":ot.animate),_t.menu.resize(!0)}defaultFontSize(){const nt=window.innerHeight*window.innerWidth,rt=[[72720,12],[921600,18],[1927680,24],[384e4,28],[768e4,32]];let it,at;for(let st=0;st<rt.length-1;st++){const[ot,lt]=rt[st],[ut,ct]=rt[st+1];if(nt>=ot&&nt<=ut)return it=(ct-lt)/(ut-ot),at=lt-it*ot,it*nt+at}return nt>rt[rt.length-1][0]?rt[rt.length-1][1]:rt[0][1]}updateFontSize(){let nt=this.defaultFontSize();window.innerHeight>window.innerWidth&&(nt*=1.1),console.log({fontSize:nt,resolution:window.innerWidth+"x"+window.innerHeight}),_t.config&&_t.config["font-size"]&&(_t.config["font-size"]>3?nt+=.5*(_t.config["font-size"]-3):_t.config["font-size"]<3&&(nt-=.5*(3-_t.config["font-size"])));let rt=` :root { --menu-entry-name-font-size: ${nt}px; } `;_t.css(rt,"theme-font-size")}hideSplashScreen(){localStorage.setItem("splash-time-hint",String((new Date).getTime()-this.splashStartTime)),"function"==typeof this.themeBackgroundReady&&this.themeBackgroundReady();document.getElementById("background").style.visibility="visible";const nt=document.getElementById("splash");if(nt){var rt=document.querySelector("#main").style;rt.display="none",rt.visibility="visible",rt.display="block",document.body.style.backgroundImage="none",document.getElementById("background").style.visibility="visible"}setTimeout((()=>nt.parentNode.removeChild(nt)),200),_t.idle.reset()}closeCurtains(nt,rt,it){_t.config&&_t.config["fx-nav-intensity"]&&(this.curtainsOpening=!1,this.curtainsHideTimer&&clearTimeout(this.curtainsHideTimer),this.setCurtainsTransition(!1,!0),this.setCurtainsState(!0,nt),this.curtainsHideTimer=setTimeout((()=>{this.curtainsOpening||(this.setCurtainsTransition(!0),this.curtainsHideTimer=setTimeout((()=>{this.curtainsOpening||(this.curtainsHideTimer&&clearTimeout(this.curtainsHideTimer),this.setCurtainsState(!1),this.curtainsHideTimer=setTimeout((()=>{this.curtainsOpening||(rt&&(this.curtainsHideTimer=setTimeout((()=>{this.setCurtainsTransition(!1,!1),this.setCurtainsState(!0,nt)}),200)),it&&it())}),200))}),25))}),25))}openCurtains(nt,rt,it){_t.config&&_t.config["fx-nav-intensity"]&&(this.curtainsHideTimer&&clearTimeout(this.curtainsHideTimer),this.curtainsOpening=!0,this.setCurtainsTransition(!1,!0),this.setCurtainsState(!1,nt),this.curtainsHideTimer=setTimeout((()=>{this.curtainsOpening&&(this.setCurtainsTransition(!0),this.curtainsHideTimer=setTimeout((()=>{this.curtainsOpening&&(this.curtainsHideTimer&&clearTimeout(this.curtainsHideTimer),this.setCurtainsState(!0),this.curtainsHideTimer=setTimeout((()=>{this.curtainsOpening&&(rt&&(this.setCurtainsTransition(!1,!1),this.setCurtainsState(!0,nt)),it&&it())}),200))}),25))}),25))}setCurtainsTransition(nt,rt){const it={};it.transition=nt?"left 0.15s ease-in 0s, right 0.15s ease-in 0s, opacity 0.15s ease-in 0s":"none 0s ease 0s","boolean"==typeof rt&&(it.display=rt?"block":"none"),this.curtains.forEach((nt=>{nt.style.transition=it.transition,it.display&&(nt.style.display=it.display)}))}setCurtainsState(nt,rt){nt?(document.documentElement.classList.add("curtains-opened"),document.documentElement.classList.remove("curtains-closed")):(document.documentElement.classList.add("curtains-closed"),document.documentElement.classList.remove("curtains-opened")),"boolean"==typeof rt&&document.documentElement.classList[rt?"add":"remove"]("curtains-alpha")}};function create_fragment$3(nt){let rt;return{c(){rt=element("div"),rt.innerHTML='<div id="background"></div>',attr(rt,"id","background-wrapper")},m(nt,it){insert(nt,rt,it)},p:noop$1,i:noop$1,o:noop$1,d(nt){nt&&detach(rt)}}}_t.theme=Rs,_t.waitRenderer((()=>{Rs.update(),Rs.hideSplashScreen(),_t.on("config",(()=>Rs.update()))})),_t.on("theme-update",((nt,rt,it,at,st)=>{try{Rs.update(nt,rt,it,at,st)}catch(nt){console.error(nt)}})),_t.on("player-show",(()=>{Rs.animateBackground("none"),Rs.closeCurtains(!1,!0)})),_t.on("player-hide",(()=>{Rs.openCurtains(!1,!0,(()=>{Rs.animateBackground(_t.config["animate-background"])}))})),_t.idle.energySaver.on("start",(()=>{Rs.animateBackground("none"),Rs.closeCurtains(!0,!1)})),_t.idle.energySaver.on("end",(()=>{Rs.openCurtains(!0,!0,(()=>{Rs.animateBackground(_t.config["animate-background"])}))})),_t.on("exit-ui",(()=>{Rs.closeCurtains(!1,!1),Rs.closeCurtains=()=>{}}));class Theme extends SvelteComponent{constructor(nt){super(),init(this,nt,null,create_fragment$3,safe_not_equal,{})}}class Sounds{constructor(){this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.buffers={},this.enabled=!0,this.volume=100}async setup(nt){const rt=await fetch("assets/sounds/"+nt+".mp3"),it=await rt.arrayBuffer();this.buffers[nt]=await this.audioContext.decodeAudioData(it)}play(nt,rt=100){if(!this.enabled)return;if(rt*=this.volume/100,void 0===this.buffers[nt])return void this.setup(nt).then((()=>this.play(nt,rt))).catch((nt=>console.error("Erro ao carregar o som:",nt)));const it=this.audioContext.createBufferSource();it.buffer=this.buffers[nt];const at=this.audioContext.createGain();at.gain.value=rt/100,it.connect(at),at.connect(this.audioContext.destination),it.start(0),window.capacitor&&navigator&&navigator.vibrate&&navigator.vibrate(25)}}class MenuURLInputHelper{constructor(){this.events=[[".modal-wrap input","keyup",nt=>{if(13==nt.keyCode){nt.preventDefault();let rt=document.getElementById("modal-template-option-submit");rt&&rt.click()}}],['.modal-wrap input[placeholder^="http"]',"keyup",nt=>{let rt=nt.target.value;6!=rt.length||rt.includes(":")||(nt.target.value="http://"+rt)}]],this.active=!1}getInputElement(){return document.querySelector(".modal-wrap input, .modal-wrap textarea")}start(){if(!this.active){this.active=!0,this.bind(!0);let nt=this.getInputElement();nt&&nt.select()}}stop(){this.bind(!1),this.active=!1}bind(nt){const rt=nt?"addEventListener":"removeEventListener";this.events.forEach(((nt,it)=>{(nt=document.querySelector(this.events[it][0]))&&nt[rt](this.events[it][1],this.events[it][2])}))}}class MenuBase extends EventEmitter$1{constructor(nt){super(),this.setMaxListeners(20),console.log("Menu base",{container:nt,main:_t}),this.sounds=new Sounds,this.debug=!1,this.path="",this.container=nt,this.wrap=nt.querySelector("wrap"),console.log("Menu base"),nt.addEventListener("click",(nt=>{nt.preventDefault();const rt=nt.target.closest("a");rt&&!rt.classList.contains("entry-ignore")&&this.action(rt)})),_t.on("config",((nt,rt)=>this.sounds.volume=rt.volume)),_t.config&&void 0!==_t.config.volume&&(this.sounds.volume=_t.config.volume)}buildElementFromHTML(nt){const rt=document.createElement("span");return rt.innerHTML=nt,rt.firstElementChild}}class MenuIcons extends MenuBase{constructor(nt){super(nt),this.icons={"":{url:"fas fa-home"}},this.defaultIcons={back:"fas fa-chevron-left",action:"fas fa-cog",slider:"fas fa-cog",input:"fas fa-keyboard",stream:"fas fa-play-circle",check:"fas fa-toggle-off",group:"fas fa-box-open"},_t.on("icon",(nt=>{if(-1==nt.tabIndex)return;const rt=[nt.path,nt.name].filter((nt=>nt)).join("/");let it;void 0===this.icons[rt]&&(this.icons[rt]={});const at=!nt.alpha;if(this.icons[rt].cover!=at&&(this.icons[rt].cover=at,it=!0),this.icons[rt].url!=nt.url&&(this.icons[rt].url=nt.url,it=!0),it){let nt=this.currentEntries.map((nt=>this.prepareEntry(nt)));this.applyCurrentEntries(nt),this.uiUpdate(!1)}}))}}class MenuSelectionMemory extends MenuIcons{constructor(nt){super(nt),this.selectionMemory={},this.on("open",(()=>this.saveSelection())),this.on("focus",(()=>this.saveSelection())),this.on("scroll",(()=>this.saveSelection())),this.on("pos-modal-end",this.restoreSelection.bind(this)),_t.on("current-search",((nt,rt)=>{this.currentSearch=JSON.stringify({terms:nt,type:rt})}))}saveSelection(nt){if(this.rendering)return;this.debug&&console.error("saveSelection",this.wrap.scrollTop,this.selectedIndex,this.path);const rt=this.currentViewName();this.selectionMemory[this.path]||(this.selectionMemory[this.path]={}),this.selectionMemory[this.path][rt]={scroll:"default"==rt?"number"==typeof nt?nt:this.wrap.scrollTop:0,index:this.selectedIndex,search:this.currentSearch}}currentViewName(){return this.activeSpatialNavigationLayout().level}restoreSelection(){if(this.rendering)return;this.debug&&console.log("restoreSelection",this.path);const nt=this.currentViewName(),rt=this.selected();if(rt&&"menu-search"==rt.id)return;let it={scroll:0,index:this.path?1:0};const at=this.selectables();if(void 0!==this.selectionMemory[this.path]&&this.selectionMemory[this.path][nt]){const rt=this.path.includes(_t.lang.SEARCH)||this.path.includes(_t.lang.MORE_RESULTS)||this.path.includes(_t.lang.SEARCH_MORE),at=rt&&this.currentSearch==this.selectionMemory[this.path][nt].search;rt&&!at||(it=this.selectionMemory[this.path][nt],0==it.index&&this.path&&(it.index=1))}let st;if("default"==this.activeSpatialNavigationLayout().level&&this.currentElements[it.index]){let nt=this.viewportRange(it.scroll);(it.index<nt.start||it.index>=nt.end)&&(it.index=nt.start),this.focus(this.currentElements[it.index],!0);const rt=this.wrap.scrollTop,at=this.wrap.scrollTop+this.wrap.clientHeight;(it.scroll<rt||it.scroll>at)&&this.scrollTop(it.scroll,!0),st=!0}else at.includes(rt)||this.reset();return st}scrollTop(nt,rt){return"number"==typeof nt&&(this.wrap.scroll({top:nt,left:0,behavior:rt?"instant":"smooth"}),this.saveSelection(nt)),this.wrap.scrollTop}}class MenuSpatialNavigation extends MenuSelectionMemory{constructor(nt){super(nt),this.layouts=[],this.defaultNavGroup="",this.angleWeight=.0125,this.className="selected",this.parentClassName="selected-parent",this.selectedIndex=0;const scrollEndTrigger=()=>{if(this.rendering)return setTimeout(scrollEndTrigger,100);this.lastScrollTop!==this.wrap.scrollTop&&(this.debug&&console.log("menu.scroll",this.rendering,this.wrap.scrollTop),this.lastScrollTop=this.wrap.scrollTop,this.emit("scroll",this.wrap.scrollTop))};for(const nt of["scrollend","resize"])this.wrap.addEventListener(nt,scrollEndTrigger,{capture:!0,passive:!0});this.wrap.addEventListener("touchstart",(()=>{this.wrap.style.scrollSnapType="none"})),this.wrap.addEventListener("touchend",(()=>{this.wrap.style.scrollSnapType="y mandatory"}));const resizeListener=()=>this.resize();window.addEventListener("resize",resizeListener,{capture:!0}),window.addEventListener("orientationchange",resizeListener,{capture:!0}),screen.orientation&&screen.orientation.addEventListener("change",resizeListener),this.once("render",this.adjustIconSize.bind(this)),setTimeout((()=>{this.setGridLayout(4,3,1,8),resizeListener()}),0)}setGridLayout(nt,rt,it,at){this._gridLayoutX=nt,this._gridLayoutY=rt,this._gridLayoutPortraitX=it,this._gridLayoutPortraitY=at,this.resize()}resize(nt){if(!0!==nt&&this.lastSize&&this.lastSize.x==window.innerWidth&&this.lastSize.y==window.innerHeight)return;this.lastSize={x:window.innerWidth,y:window.innerHeight};const rt=window.innerHeight>window.innerWidth;rt?(this.gridLayoutX=this._gridLayoutPortraitX,this.gridLayoutY=this._gridLayoutPortraitY):(this.gridLayoutX=this._gridLayoutX,this.gridLayoutY=this._gridLayoutY);const it=_t.config["view-size"][rt?"portrait":"landscape"].x>=3,at=1==_t.config["view-size"][rt?"portrait":"landscape"].x;document.body.classList[it?"add":"remove"]("menu-wide"),document.body.classList[at?"add":"remove"]("portrait"),this.adjustIconSize(),this.sideMenuSync(!0),window.capacitor&&plugins.megacubo.updateScreenMetrics()}adjustIconSize(){let nt=document.querySelector("a:not(.entry-2x) .entry-icon-image");if(nt){let rt=nt.getBoundingClientRect();if(rt&&rt.width){let nt=.85*Math.min(rt.width,rt.height);css(`\n\n\t\t\t\t#menu content a .entry-icon-image i {\n    \t\t\t\tfont-size: ${nt}px;\n    \t\t\t\tline-height: ${rt.height}px;\n    \t\t\t\tmin-height: ${rt.height}px;\n\t\t\t\t}\n\n\t\t\t\t`,"entry-icon-i")}}}isVisible(nt){return null!==nt.offsetParent}selector(nt){return Array.from(document.querySelectorAll(nt)).filter(this.isVisible)}start(){document.body.addEventListener("focus",(nt=>{setTimeout((()=>{document.activeElement==document.body&&(this.debug&&console.log("body focus, menu.reset",nt),this.reset())}),100)}),{passive:!0}),this.reset()}updateElement(nt){if(!nt.parentNode){let rt,it;["title","data-path","id"].some((nt=>{if(it=e.getAttribute(nt)&&!it.includes('"'))return rt=nt,!0}));let at=e.tagName+(rt?"["+rt+'="'+it+'"]':""),st=document.querySelector(at);st&&(nt=st)}return nt}selectables(){let nt=[],rt=this.activeSpatialNavigationLayout();return rt&&(nt="function"==typeof rt.resetSelector?rt.resetSelector():this.entries()),nt.filter((nt=>nt.parentNode))}updateSelectedElementClasses(nt){if(nt&&nt.classList){for(const nt of document.querySelectorAll("."+this.className))nt.classList.remove(this.className);for(const nt of document.querySelectorAll("."+this.parentClassName))nt.classList.remove(this.parentClassName);nt.classList.add(this.className),nt.parentNode&&nt.parentNode.classList&&nt.parentNode.classList.add(this.parentClassName)}}findSelected(nt){let rt,it=document.activeElement;if(it==document.body&&(it=document.querySelector("."+this.className)),!nt&&it)return it;if(it&&it!=document.body){rt=this.selectables();let nt=rt.filter((nt=>nt.classList.contains(this.className)));nt.length?it=nt[0]:(it=this.updateElement(it),it.parentNode&&rt.includes(it)||(it=!1))}if(!it||it==document||it==document.body){let nt;if(void 0===rt&&(rt=this.selectables()),rt.length)try{nt=rt.filter((nt=>nt.classList.contains(this.className)))}catch(nt){}it=nt&&nt.length?nt[0]:rt[0]}return it&&"menu-omni-input"==it.id&&(it=it.parentNode),this.debug&&console.log("findSelected",it,rt),it}selected(nt){let rt=this.findSelected(nt);return rt&&(rt.classList.contains(this.className)||this.updateSelectedElementClasses(rt),rt.focus({preventScroll:!0})),rt}focus(nt,rt){if(this.rendering)return;this.debug&&console.error("focus",nt,this.wrap.scrollTop),nt||(nt=this.entries().shift());const it=this.activeSpatialNavigationLayout().level;if(nt&&nt!=document.querySelector("."+this.className)){this.debug&&console.log("FOCUSENTRY",nt),this.updateSelectedElementClasses(nt);const it=this.currentElements.indexOf(nt);if(-1!=it&&(this.selectedIndex=it),document.activeElement&&"input"==document.activeElement.tagName.toLowerCase()){let rt=document.activeElement;rt.style.visibility="hidden",nt.focus({preventScroll:!0}),rt.style.visibility="inherit"}else nt.focus({preventScroll:!0});let at=nt.querySelector('input:not([type="range"]), textarea');at&&at.focus({preventScroll:!0}),rt||nt.scrollIntoViewIfNeeded({behavior:"auto",block:"nearest",inline:"nearest"}),this.emit("focus",nt,it)}else this.debug&&console.log("Already focused",{currentLayer:it,a:nt,selected:document.querySelector("."+this.className),scrollLeft:this.container.scrollLeft,scrollTop:this.wrap.scrollTop});return null}activeSpatialNavigationLayout(){let nt={selector:"body",level:"default"};return this.layouts.some((rt=>{if(nt||(nt=rt),rt.condition())return nt=rt,!0})),nt}reset(){this.debug&&console.log("reset");let nt,rt=this.activeSpatialNavigationLayout();if(nt="function"==typeof rt.resetSelector?rt.resetSelector():this.entries(),nt.length&&!nt.includes(this.selected())&&(nt=nt.filter((nt=>"back"!=nt.getAttribute("data-type"))).slice(0),nt.length)){let rt=this.sounds;this.focus(nt[0]),this.sounds=rt}}entries(nt){let rt=[],it=this.activeSpatialNavigationLayout().selector;return"function"==typeof it&&(it=it()),"string"==typeof it?rt.push(...this.selector(it)):Array.isArray(it)?rt.push(...it):console.error("Bad layer selector"),rt=rt.filter((nt=>!nt.className||!String(nt.className).includes("menu-not-navigable"))),!0===nt&&(rt=rt.filter((nt=>nt.parentNode&&nt.parentNode==this.wrap))),rt}addSpatialNavigationLayout(nt){return!0!==nt.default&&this.defaultNavGroup||(this.defaultNavGroup=nt.level),this.layouts.push(nt)}distance(nt,rt,it){let at=Math.hypot(rt.left-nt.left,rt.top-nt.top);return it&&(at+=at*(this.angleWeight*it)),at}angle(nt,rt){let it=rt.top-nt.top,at=rt.left-nt.left,st=Math.atan2(it,at);return st*=180/Math.PI,st+=90,st<0&&(st=360+st),st}isAngleWithinRange(nt,rt,it){return it>rt?nt>=rt&&nt<=it:nt<it||nt>rt}coords(nt){if(nt&&"function"==typeof nt.getBoundingClientRect){let rt=nt.getBoundingClientRect();return{left:parseInt(rt.left+rt.width/2),top:parseInt(rt.top+rt.height/2)}}}opposite(nt,rt,it){let at,st=rt.indexOf(nt),ot=this.gridLayoutX;switch(this.gridLayoutY,it){case"down":at=st%ot;break;case"up":at=Math.floor(rt.length/ot)*ot+st%ot,at>=rt.length&&(at=(Math.floor(rt.length/ot)-1)*ot+st%ot);break;case"left":at=st,at+=ot-1,at>=rt.length&&(at=rt.length-1);break;case"right":at=st,at-=ot-1,at<0&&(at=0)}return this.debug&&console.log(at,rt.length),rt[at]}angleCenter(nt,rt){const it=(nt+(rt-nt+360)%360/2)%360;return it<0?it+360:it}angleDiff(nt,rt,it){const at=this.angleCenter(rt,it),st=Math.abs(nt-at);return Math.min(st,360-st)}arrow(nt,rt){let it,at,st,ot,lt=this.entries(),ut=this.activeSpatialNavigationLayout(),ct=this.selected();switch(nt){case"up":st=270,ot=90;break;case"right":st=0,ot=180;break;case"down":st=90,ot=270;break;case"left":st=180,ot=360}const dt=this.coords(ct);dt?lt.forEach((rt=>{if(rt!=ct){const lt=this.coords(rt);if(lt){if(["up","down"].includes(nt)&&lt.top==dt.top&&rt.offsetHeight==ct.offsetHeight)return;if(["left","right"].includes(nt)&&lt.left==dt.left&&rt.offsetWidth==ct.offsetWidth)return;const ut=this.angle(dt,lt);if(this.isAngleWithinRange(ut,st,ot)){const ht=this.angleDiff(ut,st,ot),pt=this.distance(dt,lt,ht);this.debug&&console.warn("POINTER",pt,{df:ht,angle:ut,directionAngleStart:st,directionAngleEnd:ot},nt,ct,rt,dt,lt),(!it||pt<at||rt.parentNode==ct.parentNode&&it.parentNode!=ct.parentNode)&&(it=rt,at=pt)}}}})):(it=lt[0],at=99999),it||!0===rt||"function"==typeof ut.overScrollAction&&!0===ut.overScrollAction(nt,ct)||(it=this.opposite(ct,lt,nt),this.debug&&console.log("opposite",ct,lt,nt,it)),it&&(this.debug&&console.warn("POINTER",it,at),this.focus(it)),this.emit("arrow",it,nt)}}class MenuBBCode extends MenuSpatialNavigation{constructor(nt){super(nt),this.funnyTextColors=["#3F0","#39F","#8d45ff","#ff02c9","#e48610"],this.bbCodeMap={b:nt=>"[|"==nt.substr(0,2)?"</strong>":"<strong>",i:nt=>"[|"==nt.substr(0,2)?"</i>":"<i>",alpha:nt=>"[|"==nt.substr(0,2)?"</font>":'<font style="color: var(--secondary-font-color); text-shadow: none;">',color:(nt,rt)=>{if("[|"==nt.substr(0,2))return"</font>";return'<font style="color: '+rt.split(" ").slice(1).join(" ")+';">'}}}removeBBCode(nt){return nt.replace(new RegExp("\\[\\|?([^\\]]*)\\]","g"),"")}parseBBCode(nt){return void 0===this.replaceBBCodeFnPtr&&(this.replaceBBCodeRegex=new RegExp("\\[(fun|"+Object.keys(this.bbCodeMap).join("|")+")"),this.replaceBBCodeFnPtr=this.replaceBBCode.bind(this),this.replaceBBCodeFunnyTextFnPtr=this.replaceBBCodeFunnyText.bind(this)),nt.match(this.replaceBBCodeRegex)?(nt=nt.replace(new RegExp("\\[fun\\]([^\\[]*)\\[\\|?fun\\]","gi"),this.replaceBBCodeFunnyTextFnPtr)).replace(new RegExp("\\[\\|?([^\\]]*)\\]","g"),this.replaceBBCodeFnPtr):nt}replaceBBCode(nt,rt,it,at){const st=rt.split(" ").shift().toLowerCase();return this.bbCodeMap[st]?this.bbCodeMap[st](nt,rt,at):at}replaceBBCodeFunnyText(nt,rt,it,at){return this.makeFunnyText(rt)}makeFunnyText(nt){if(nt.includes("&")&&nt.includes(";")){const rt=document.createElement("span");rt.innerHTML=nt,nt=rt.innerText}if(!_t.config["kids-fun-titles"])return nt;const rt=nt.length>15?3:nt.length>5?2:1,it=[1,.9675,.925],at=this.funnyTextColors.length*rt;return nt.split("").map(((nt,st)=>{const ot=--st<2?1:it[Math.floor(Math.random()*it.length)],lt=st,ut=Math.floor(st/at);ut&&(st-=ut*at);const ct=Math.floor(st/rt);return" "==nt&&(nt="&nbsp;"),'<font class="funny-text" style="color: '+(-1==lt?"white":this.funnyTextColors[ct])+";transform: scale("+ot+');">'+nt+"</font>"})).join("")}}class MenuModal extends MenuBBCode{constructor(nt){super(nt),this.inputHelper=new MenuURLInputHelper,this.modalTemplates={},this.modalContainer=document.getElementById("modal"),this.modalContent=this.modalContainer.querySelector("#modal-content"),this.modalContent.parentNode.addEventListener("click",(nt=>{"modal-content"==nt.target.id&&(this.inModalMandatory()||this.endModal())}))}plainText(nt){const rt=document.createElement("div");return rt.innerHTML=nt,rt.textContent}inModal(){return document.body.classList.contains("modal")}inModalMandatory(){return this.inModal()&&document.body.classList.contains("modal-mandatory")}startModal(nt,rt){this.sounds.play("warn",80),this.emit("pre-modal-start"),this.modalContent.innerHTML=nt,document.body.classList.add("modal"),rt&&document.body.classList.add("modal-mandatory"),this.inputHelper.start(),this.reset()}endModal(nt){this.inModal()&&(this.debug&&console.log("ENDMODAL"),this.inputHelper.stop(),document.body.classList.remove("modal"),document.body.classList.remove("modal-mandatory"),this.emit("modal-end",nt),setTimeout((()=>this.emit("pos-modal-end")),100))}replaceTags(nt,rt){return rt.name&&!rt.rawname&&(rt.rawname=rt.name),Object.keys(rt).forEach((it=>{let at=typeof rt[it];if(["string","number","boolean"].includes(at)){let st=("boolean"==typeof rt.raw?!rt.raw:"string"==at&&!rt[it].includes("<"))?this.fixQuotes(rt[it]):String(rt[it]);st.includes("[")&&"rawname"==it&&(st=this.parseBBCode(st)),(nt=nt.split("{"+it+"}").join(st)).includes("\r\n")&&(nt=nt.replace(new RegExp("\r\n","g"),"<br />"))}})),nt=nt.replace(new RegExp("\\{[a-z\\-]+\\}","g"),""),rt.details&&rt.details.includes("<")&&console.log("TEMPLATE",nt),nt}fixQuotes(nt){return String(nt||"").replace(new RegExp('"',"g"),"&quot;")}}class MenuPlayer extends MenuModal{constructor(nt){super(nt)}inPlayer(){return"undefined"!=typeof streamer&&streamer.active}isExploring(){return!this.inModal()&&(!this.inPlayer()||document.body.classList.contains("menu-playing"))}showWhilePlaying(nt,rt){nt?(_t.emit("menu-playing",!0),document.body.classList.add("menu-playing"),rt||setTimeout((()=>{this.restoreSelection()||this.reset()}),100)):(_t.emit("menu-playing",!1),document.body.classList.remove("menu-playing"),_t.idle.reset(),_t.idle.lock(.1))}}class MenuFx extends MenuPlayer{constructor(nt){super(nt),this.fxNavTimer=0,this.fxModalTimer=0,this.on("pre-render",((nt,rt)=>{"string"!=typeof rt&&(rt=-1),nt!=rt&&(-1==rt||nt.length>=rt.length?this.fxNavIn():this.fxNavOut())})),this.on("pre-modal-start",(()=>{this.fxPromptIn()})),setTimeout((()=>{this.wrap.parentNode.classList.add("effect-inflate-deflate-parent"),this.modalContent.parentNode.classList.add("effect-inflate-deflate-parent")}))}fxNavIn(){_t.config["fx-nav-intensity"]&&(clearTimeout(this.fxNavTimer),this.wrap.classList.contains("effect-inflate")?(this.wrap.classList.remove("effect-inflate"),setTimeout((()=>this.fxNavIn()),0)):(this.wrap.style.transition="none",this.wrap.classList.remove("effect-deflate"),this.wrap.classList.add("effect-inflate"),this.fxNavTimer=setTimeout((()=>{this.wrap.classList.remove("effect-inflate")}),1500)))}fxNavOut(){_t.config["fx-nav-intensity"]&&(clearTimeout(this.fxNavTimer),this.wrap.classList.contains("effect-deflate")?(this.wrap.classList.remove("effect-deflate"),setTimeout((()=>{this.fxNavOut()}),0)):(this.wrap.style.transition="none",this.wrap.classList.remove("effect-inflate"),this.wrap.classList.add("effect-deflate"),this.fxNavTimer=setTimeout((()=>{this.wrap.classList.remove("effect-deflate")}),1500)))}fxPromptIn(){_t.config["fx-nav-intensity"]&&(clearTimeout(this.fxModalTimer),this.modalContent.classList.contains("effect-inflate")?(this.modalContent.classList.remove("effect-inflate"),setTimeout((()=>this.fxPromptIn()),0)):(this.modalContent.style.transition="none",this.modalContent.classList.remove("effect-deflate"),this.modalContent.classList.add("effect-inflate"),this.fxModalTimer=setTimeout((()=>{this.modalContent.classList.remove("effect-inflate")}),1500)))}}class MenuDialogQueue extends MenuFx{constructor(nt){super(nt),this.dialogQueue=[],this.on("pos-modal-end",this.nextDialog.bind(this))}queueDialog(nt){this.dialogQueue.push(nt),this.nextDialog()}nextDialog(){if(!this.inModal()&&this.dialogQueue.length){this.dialogQueue.shift()()}}}class MenuDialog extends MenuDialogQueue{constructor(nt){super(nt),this.lastSelectTriggerer=!1,this.modalTemplates.option='\n\t\t\t<a href="javascript:;" class="modal-template-option" id="modal-template-option-{id}" title="{plainText}" aria-label="{plainText}">\n\t\t\t\t{aside}\n\t\t\t\t{tag-icon}\n\t\t\t\t<div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{text}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t',this.modalTemplates["option-detailed"]='\n\t\t\t<a href="javascript:;" class="modal-template-option-detailed" id="modal-template-option-detailed-{id}" title="{plainText}" aria-label="{plainText}">\n\t\t\t\t{aside}\n\t\t\t\t<div>\n\t\t\t\t\t<div class="modal-template-option-detailed-name">\n\t\t\t\t\t\t{tag-icon} {text}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="modal-template-option-detailed-details">{details}</div>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t',this.modalTemplates["options-group"]='\n\t\t\t<div class="modal-template-options">\n\t\t\t\t{opts}\n\t\t\t</a>\n\t\t',this.modalTemplates.text='\n\t\t\t<span class="modal-template-text" id="modal-template-option-{id}">\n\t\t\t\t<i class="fas fa-caret-right"></i>\n\t\t\t\t<input type="text" placeholder="{placeholder}" value="{text}" aria-label="{plainText}" onmousedown="main.menu.inputPaste(this)" />\n\t\t\t</span>\n\t\t',this.modalTemplates.textarea='\n\t\t\t<span class="modal-template-textarea" id="modal-template-option-{id}">\n\t\t\t\t<span>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t<i class="fas fa-caret-right"></i>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t\t<textarea placeholder="{placeholder}" rows="3" aria-label="{plainText}">{text}</textarea>\n\t\t\t</span>\n\t\t',this.modalTemplates.message='\n\t\t\t<span class="modal-template-message" aria-label="{plainText}">\n\t\t\t\t{text}\n\t\t\t</span>\n\t\t',this.modalTemplates.slider='\n\t\t\t<span class="modal-template-slider" id="modal-template-option-{id}">\n\t\t\t\t<span class="modal-template-slider-left"><i class="fas fa-caret-left"></i></span>\n\t\t\t\t<input type="range" class="modal-template-slider-track" aria-label="{plainText}" />\n\t\t\t\t<span class="modal-template-slider-right"><i class="fas fa-caret-right"></i></span>\n\t\t\t</span>\n\t\t',this.modalTemplates.question='\n\t\t\t<span class="modal-template-question" aria-label="{plainText}">\n\t\t\t\t{tag-icon}{text}\n\t\t\t</span>\n\t\t'}inputPaste(nt){!nt.value&&top.navigator.clipboard&&top.navigator.clipboard.readText().then((rt=>{rt&&((rt=rt.trim()).startsWith("http")||rt.startsWith("//"))&&(nt.value=rt,nt.select())})).catch(console.error)}text2id(nt){return nt.match(new RegExp("^[A-Za-z0-9\\-_]+$","g"))?nt:nt.toLowerCase().replace(new RegExp("[^a-z0-9]+","gi"),"")}dialog(nt,rt,it,at){this.queueDialog((()=>{this.debug&&console.log("DIALOG",nt,rt,it,at);let st,ot,lt,ut="",ct="",callback=(nt,it)=>{if(!st){if(this.debug&&console.log("DIALOG CALLBACK",nt,parseInt(nt),it,st),st=!0,-1==nt&&(nt=!1),"submit"==nt){let rt=this.modalContainer.querySelector("input, textarea");rt&&(nt=rt.value)}!0!==it&&(this.endModal(),"function"==typeof rt?rt(nt):"string"==typeof rt?(rt=[rt,nt],this.debug&&console.warn("STRCB",rt),_t.emit(...rt)):Array.isArray(rt)&&(rt.push(nt),this.debug&&console.warn("ARRCB",rt),_t.emit(...rt)))}},dt=0,ht=!0;(nt=nt.map((nt=>(void 0===nt.oid&&void 0!==nt.id&&(nt.oid=nt.id,nt.id=this.text2id(nt.id)),nt)))).forEach((nt=>{let rt=nt.template,at=["option","option-detailed","text","slider"].includes(rt);"option"==rt&&nt.details&&(rt="option-detailed");let st=this.modalTemplates[rt];nt["tag-icon"]="",nt.fa&&(nt.fa.includes("//")?nt["tag-icon"]='<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=" style="background-image: url(&quot;'+nt.fa+'&quot;);"> ':nt["tag-icon"]='<i class="'+nt.fa+'"></i> '),nt.isPassword&&(st=st.replace('type="text"','type="password"')),nt.text||(nt.text=nt.plainText||""),nt.plainText||(nt.plainText=this.plainText(nt.text)),nt.text=String(nt.text).replaceAll('"',"&quot;"),nt.plainText=String(nt.plainText).replaceAll('"',""),st=this.replaceTags(st,nt),this.debug&&console.log(st,nt),at?(dt++,(!ot||nt.id&&nt.id==it)&&(ot=nt.id),"text"==nt.template&&(lt=!0),ht&&nt.plainText.length>50&&(ht=!1),ct+=st):ut+=st})),ct&&(ut+=this.replaceTags(this.modalTemplates["options-group"],{opts:ct})),console.log("MODALFOCUS",it,ot,ht),this.startModal('<div class="modal-wrap"><div>'+ut+"</div></div>",at);let pt=this.modalContent;if(ht){let nt=2,rt=4;if(lt&&(nt=3,rt=4),dt==nt||dt>=rt){let nt=pt.querySelector(".modal-template-options");nt&&(nt.className=nt.className+" two-columns")}}nt.forEach((nt=>{if(["option","option-detailed"].includes(nt.template)){let rt=pt.querySelector("#modal-template-option-"+nt.id+", #modal-template-option-detailed-"+nt.id);rt&&(rt.addEventListener("click",(()=>{let rt=nt.oid||nt.id;this.debug&&console.log("OPTCLK",rt,callback),callback(rt)})),String(nt.id)==String(ot)&&(rt.focus(),rt.scrollIntoViewIfNeeded({behavior:"instant"})))}else"message"==nt.template&&nt.text.includes("<i ")&&Array.from(pt.querySelectorAll(".modal-template-message i")).forEach((nt=>{nt.parentNode.style.display="block"}))})),this.on("modal-end",(nt=>{st||callback(-1,nt)})),this.emit("dialog-start")}))}info(nt,rt,it,at){this.queueDialog((()=>{let st,ot=[{template:"question",text:nt,fa:at||"fas fa-info-circle"},{template:"message",text:rt},{template:"option",text:"OK",id:"submit",fa:"fas fa-check-circle"}];this.dialog(ot,(nt=>(st||(this.debug&&console.log("infocb",nt,st),st=!0,this.endModal(),"function"==typeof it&&it()),!0)),"submit")}))}}class MenuSelect extends MenuDialog{constructor(nt){super(nt)}select(nt,rt,it,at){let st,ot={},lt=[{template:"question",text:nt,fa:it}];lt.push(...rt.map((nt=>(nt.template="option",nt.text||(nt.text=String(nt.name)),nt.id=this.text2id(nt.text),ot[nt.id]=nt.text,nt.selected&&(nt.fa="fas fa-check-circle",st=nt.id),nt)))),this.debug&&console.warn("SELECT",rt),this.dialog(lt,(nt=>{void 0!==ot[nt]&&(nt=ot[nt]),at(nt),this.endModal(),this.emit("select-end",nt)}),st),this.emit("select-start")}}class MenuOpenFile extends MenuSelect{constructor(nt){super(nt),this.openFileDialogChooser=!1}async openFile(nt,rt,it){return window.capacitor&&await window.capacitor.requestPermission("READ_EXTERNAL_STORAGE").catch(alert),this.openFileDialogChooser||(this.openFileDialogChooser=document.createElement("input"),this.openFileDialogChooser.type="file",this.openFileDialogChooser.style.opacity=.05,document.body.appendChild(this.openFileDialogChooser)),this.openFileDialogChooser.value="",it?this.openFileDialogChooser.setAttribute("accept",it):this.openFileDialogChooser.removeAttribute("accept"),this.openFileDialogChooser.currentListener&&this.openFileDialogChooser.removeEventListener("change",this.openFileDialogChooser.currentListener),new Promise(((it,at)=>{this.openFileDialogChooser.currentListener=st=>{this.openFileDialogChooser.files.length&&this.openFileDialogChooser.files[0].name?this.sendFile(nt,this.openFileDialogChooser.files[0],this.openFileDialogChooser.value,rt).then(it).catch(at):at("Bad upload data")},this.openFileDialogChooser.addEventListener("change",this.openFileDialogChooser.currentListener),this.openFileDialogChooser.click()}))}sendFile(nt,rt,it,at){return new Promise(((it,st)=>{window.filesent=rt;const ot=new XMLHttpRequest,lt=new FormData;at&&lt.append("cbid",at),lt.append("file",rt),ot.open("POST",nt,!0),ot.onreadystatechange=()=>{4===ot.readyState&&(200===ot.status?it(ot.responseText):st(ot.statusText))},ot.onerror=nt=>st(nt),ot.send(lt)}))}}class MenuPrompt extends MenuOpenFile{constructor(nt){super(nt),this.promptMemory={}}prompt(nt){this.debug&&console.log("PROMPT",nt);let rt,it=[{template:"question",text:nt.question,fa:nt.fa}];nt.message&&it.splice(1,0,{template:"message",text:nt.message});const at=nt.question||nt.placeholder;console.warn("MEMID",at,nt),it.push({template:nt.multiline?"textarea":"text",text:this.promptMemory[at]||nt.defaultValue||"",id:"text",isPassword:nt.isPassword,placeholder:nt.placeholder}),Array.isArray(nt.extraOpts)&&nt.extraOpts.length?it.push(...nt.extraOpts):it.push({template:"option",text:"OK",id:"submit",fa:"fas fa-check-circle"}),this.dialog(it,(rt=>{let it=!0;this.debug&&console.log("PROMPT CALLBACK",rt,nt.callback,typeof nt.callback),"string"==typeof rt&&rt&&(this.promptMemory[at]=rt),"function"==typeof nt.callback?it=nt.callback(rt):"string"==typeof nt.callback?(nt.callback=[nt.callback,rt],this.debug&&console.warn("STRCB",nt.callback),_t.emit(...nt.callback)):Array.isArray(nt.callback)&&(nt.callback.push(rt),this.debug&&console.warn("ARRCB",nt.callback),_t.emit(...nt.callback)),!1!==it&&(this.endModal(),this.emit("prompt-end",rt))}),"submit"),this.inputHelper.stop(),this.emit("prompt-start"),rt=this.modalContent.querySelector("#modal-template-option-submit"),rt&&rt.addEventListener("keypress",(nt=>{this.debug&&console.log(nt.keyCode),13!=nt.keyCode&&_t.hotkeys.arrowUpPressed()})),_t.hotkeys.arrowUpPressed(),setTimeout((()=>{this.inputHelper.start()}),200)}}class MenuSlider extends MenuPrompt{constructor(nt){super(nt)}sliderSetValue(nt,rt,it,at){const st=nt.querySelector(".modal-template-slider-track");this.debug&&console.warn("BROOW",st.value,rt),st.value=rt,this.sliderSync(nt,it,at)}sliderVal(nt,rt){const it=nt.querySelector(".modal-template-slider-track");return parseInt(it.value)}sliderSync(nt,rt,it){var at,st,ot=nt.querySelector(".modal-template-slider-track"),lt=rt.end-rt.start,ut=parseInt(ot.value);ut<rt.start?ut=rt.start:ut>rt.end&&(ut=rt.end),this.debug&&console.warn("SLIDER VALUE A",nt,nt.querySelector(".modal-template-slider-track").value,ot.value),st="time"==it?_t.clock.humanize(ut,!0):it?it.replace(new RegExp("\\{0\\}"),ut||"0"):ut||"0",(at=nt.parentNode.parentNode.querySelector(".modal-template-question")).innerHTML=at.innerHTML.split(": ")[0]+": "+st,this.debug&&console.warn("SLIDER VALUE B",ut,"|",ot,ot.style.background,undefined,lt,rt,1,ot.value),ut<=rt.start?(nt.querySelector(".fa-caret-left").style.opacity=.1,nt.querySelector(".fa-caret-right").style.opacity=1):ut>=rt.end?(nt.querySelector(".fa-caret-left").style.opacity=1,nt.querySelector(".fa-caret-right").style.opacity=.1):(nt.querySelector(".fa-caret-left").style.opacity=1,nt.querySelector(".fa-caret-right").style.opacity=1)}sliderIncreaseLeft(nt,rt,it,at,st){return this.debug&&console.warn(nt,rt),rt>=it.start&&(rt-=st)<it.start&&(rt=it.start),rt=parseInt(rt),this.sliderSetValue(nt,rt,it,at),rt}sliderIncreaseRight(nt,rt,it,at,st){return rt<=it.end&&(rt+=st)>it.end&&(rt=it.end),rt=parseInt(rt),this.sliderSetValue(nt,rt,it,at),rt}slider(nt,rt,it,at,st,ot,lt){let ut,ct,dt,ht=[{template:"question",text:nt,fa:lt}];rt&&rt!=nt&&ht.push({template:"message",text:rt}),ht.push({template:"option",text:"OK",fa:"fas fa-check-circle",id:"submit"}),this.dialog(ht,(nt=>{!1!==nt&&(nt=this.sliderVal(dt,it),!1!==ot(nt)&&(this.endModal(),this.emit("slider-end",nt,dt)))}),""),ut=this.modalContent.querySelector("#modal-template-option-submit"),ut.parentElement.insertBefore(this.buildElementFromHTML(this.modalTemplates.slider),ut),ut.addEventListener("keydown",(nt=>{switch(nt.keyCode){case 13:ut.submit&&ut.submit();break;case 37:nt.preventDefault(),at=this.sliderIncreaseLeft(dt,at,it,st,1);break;case 39:nt.preventDefault(),at=this.sliderIncreaseRight(dt,at,it,st,1)}})),ct=this.modalContent.querySelector(".modal-template-slider-track"),dt=ct.parentNode,this.debug&&console.warn("SLIDER VAL",dt,ct),this.emit("slider-start"),ct.setAttribute("min",it.start),ct.setAttribute("max",it.end),ct.setAttribute("step",1),ct.addEventListener("input",(()=>this.sliderSync(dt,it,st))),ct.addEventListener("change",(()=>this.sliderSync(dt,it,st))),ct.parentNode.addEventListener("keydown",(nt=>{if(console.log("SLIDERINPUT",nt,ut),13===nt.keyCode)ut.click()})),this.sliderSetValue(dt,at,it,st),this.modalContent.querySelector(".modal-template-slider-left").addEventListener("click",(nt=>{at=this.sliderIncreaseLeft(dt,at,it,st,1)})),this.modalContent.querySelector(".modal-template-slider-right").addEventListener("click",(nt=>{at=this.sliderIncreaseRight(dt,at,it,st,1)}))}}class MenuStatusFlags extends MenuSlider{constructor(nt){super(nt),this.statusFlags={},this.on("render",this.processStatusFlags.bind(this)),_t.on("stream-state-set",((nt,rt)=>{this.debug&&console.warn("SETFLAGEVT",nt,rt),rt&&this.setStatusFlag(nt,rt,!1)})),_t.on("stream-state-sync",(nt=>{this.debug&&console.warn("SYNCSTATUSFLAGS",nt,this.wrap.scrollTop),Object.keys(nt).forEach((rt=>{nt[rt]&&this.setStatusFlag(rt,nt[rt],!0)})),this.processStatusFlags()}))}setStatusFlag(nt,rt,it){nt&&(void 0!==this.statusFlags[nt]&&this.statusFlags[nt]==rt||(this.statusFlags[nt]=rt,!0!==it&&this.processStatusFlags()))}statusAddHTML(nt){if(nt.url&&void 0!==this.statusFlags[nt.url]){let rt=this.statusFlags[nt.url],it=nt.type||"stream",at=nt.class||"";if(rt&&!at.includes("skip-testing")&&("stream"==it||at.match(new RegExp("(allow-stream-state|entry-meta-stream)")))){let it="",at="";if("tune"==rt)it='<i class="fas fa-layer-group"></i>';else if("folder"==rt)it='<i class="fas fa-box-open"></i>';else if("waiting"==rt)it='<i class="fas fa-clock"></i>';else{let nt;rt.endsWith(",watched")&&(nt=!0,rt=rt.substr(0,rt.length-8));let st="",ot=nt?"fas fa-check":"";"offline"==rt?(nt||(ot="fas fa-times"),at="entry-status-flag entry-status-flag-failure"):(nt||(ot="fas fa-play"),at="entry-status-flag entry-status-flag-success",_t.config["status-flags-type"]&&(st=" "+rt)),it='<i class="'+ot+'" aria-hidden="true"></i>'+st,_t.config["status-flags-type"]&&(it="&nbsp;"+it+"&nbsp;")}nt.statusFlagsClass=at,nt.statusFlags=it;"offline"==rt?nt.class&&nt.class.includes("entry-disabled")||(nt.class=(nt.class||"")+" entry-disabled"):nt.class&&nt.class.includes("entry-disabled")&&(nt.class=nt.class.replace(new RegExp("( |^)entry-disabled","g"),""))}}return nt}processStatusFlags(){this.currentEntries.map((nt=>this.statusAddHTML(nt))),this.uiUpdate(!1)}}class MenuNav extends MenuStatusFlags{constructor(nt){super(nt),this.sideMenuWidthCache=null,this.sideMenuSyncTimer=0,setTimeout((()=>this.sideMenu(!1,"instant")),0),this.scrollendPolyfillElement(this.container),this.container.addEventListener("scrollend",(()=>this.sideMenuSync()))}scrollendPolyfillElement(nt){if("onscrollend"in window)return;let rt;const dispatchScrollEndEvent=()=>{const rt=new CustomEvent("scrollend");nt.dispatchEvent(rt)};nt.addEventListener("scroll",(()=>{window.clearTimeout(rt),rt=setTimeout(dispatchScrollEndEvent,150)}),!1)}inSideMenu(){const nt=this.getSideMenuWidth();return this.container.scrollLeft<=nt/2}sideMenuSync(nt,rt){!0===nt&&(this.sideMenuWidthCache=null);const it="boolean"==typeof rt?rt:this.inSideMenu();it!=document.body.classList.contains("side-menu")&&(document.body.classList[it?"add":"remove"]("side-menu"),this.selected(!0))}sideMenu(nt,rt="smooth"){this.container.scroll({top:0,left:nt?0:this.getSideMenuWidth(),behavior:rt})}getSideMenuWidth(){if(this.sideMenuWidthCache)return this.sideMenuWidthCache;const nt=document.createElement("div");return nt.style.visibility="hidden",nt.style.boxSize="content-box",nt.style.position="absolute",nt.style.maxHeight="none",nt.style.height="var(--nav-width)",document.body.appendChild(nt),this.sideMenuWidthCache=nt.clientHeight,document.body.removeChild(nt),this.sideMenuWidthCache}}let Is=class Menu extends MenuNav{constructor(nt){console.log("menu init");try{super(nt)}catch(nt){console.error(nt)}console.log("menu init"),_t.on("menu-playing",(()=>{document.body.classList.contains("menu-playing")||(document.body.classList.add("menu-playing"),_t.emit("menu-playing",!0),setTimeout((()=>this.reset()),100))})),_t.on("menu-playing-close",(()=>{document.body.classList.contains("menu-playing")&&(document.body.classList.remove("menu-playing"),_t.emit("menu-playing",!1))})),_t.on("render",((nt,rt,it)=>{this.render(nt,rt,it)})),_t.on("menu-select",((nt,rt,it)=>{this.setupSelect(nt,rt,it)})),_t.on("info",((nt,rt,it)=>{this.info(nt,rt,null,it)})),_t.on("dialog",((nt,rt,it,at)=>{this.dialog(nt,rt,it,at)})),_t.on("dialog-close",(nt=>{this.endModal(nt)})),_t.on("prompt",(nt=>this.prompt(nt))),this.currentEntries=[],this.currentElements=[],this.range={start:0,end:99},this.ranging=!1,_t.on("trigger",(nt=>{this.debug&&console.warn("TRIGGER",nt),this.get(nt).forEach((nt=>{nt.click()}))})),_t.on("menu-busy",(nt=>{this.busy=nt,document.querySelector(".menu-busy").style.display=this.busy?"flex":"none",document.querySelector(".menu-time time").style.display=this.busy?"none":"flex"})),console.log("menu init")}get(nt){let rt=[];if(nt){let it=Object.keys(nt);it.length&&this.currentEntries.forEach(((at,st)=>{it.every((rt=>nt[rt]==at[rt]))&&rt.push(this.currentElements[st])}))}return rt}diffEntries(nt,rt){let it;return["name","details","fa","type","prepend","class"].some((at=>{if(nt[at]!=rt[at])return it=at,!0})),it}render(nt,rt,it){this.debug&&console.log("menu render",rt,it,this.wrap.scrollTop),this.rendering=!0;let at=this.path,st=rt==this.path;nt=nt.map((nt=>this.prepareEntry(nt)));let ot=this.applyCurrentEntries(nt);this.emit("pre-render",rt,this.path),this.path=rt,ot&&this.uiUpdate(st,!0),setTimeout((()=>{this.currentElements=Array.from(this.wrap.getElementsByTagName("a")),this.has2xEntry=this.currentElements.slice(0,2).some((nt=>nt.classList.contains("entry-2x"))),this.rendering=!1,st?this.restoreSelection():this.selected(),this.emit("render",this.path,it,at),this.debug&&console.log("menu rendered",rt,it,this.wrap.scrollTop)}),0)}uiUpdate(nt,rt){if(!0!==rt&&this.rendering)return;let it=0,at=this.path;nt?void 0!==this.selectionMemory[at]&&this.selectionMemory[at].default&&(it=this.selectionMemory[at].default.scroll):it=this.wrap.scrollTop,this.wrap.style.minHeight=it+this.wrap.offsetHeight+"px",this.emit("updated"),this.scrollTop(it,!0),this.wrap.style.minHeight=0,this.getRange(it)}applyCurrentEntries(nt){let rt;return this.currentEntries.length>nt.length&&(rt=!0,this.currentEntries.splice(nt.length,this.currentEntries.length-nt.length)),nt.forEach(((it,at)=>{if(this.currentEntries[at]){const st=Object.keys(it),ot=Object.keys(this.currentEntries[at]).filter((nt=>!st.includes(nt)));for(const nt of ot)rt=!0,delete this.currentEntries[at][nt];for(const it of st)this.currentEntries[at].hasOwnProperty(it)&&this.currentEntries[at][it]===nt[at][it]||(rt=!0,this.currentEntries[at][it]=nt[at][it])}else rt=!0,this.currentEntries[at]=nt[at]})),rt}viewportRange(nt){let rt=this.gridLayoutX*this.gridLayoutY;if(this.currentElements.length){"number"!=typeof nt&&(nt=this.wrap.scrollTop);const it=this.currentElements[this.currentElements.length-1].offsetHeight;let at=Math.round(nt/it)*this.gridLayoutX;this.has2xEntry&&(at?at--:rt--);return{start:at,end:Math.max(at,Math.min(at+rt,this.currentElements.length-1))}}return{start:0,end:rt}}viewportEntries(){let nt=[],rt=this.currentElements;if(rt.length){let it=this.viewportRange();nt=rt.slice(it.start,it.end)}return nt}getRange(nt){"number"!=typeof nt&&(nt=this.wrap.scrollTop),this.ranging=!1;let rt=[],it=this.gridLayoutX,at=Math.ceil(this.gridLayoutX*this.gridLayoutY)+2*it,st=_t.config["show-logos"]&&this.currentEntries.length>=at;if(this.range=this.viewportRange(nt),st){let nt=Object.assign({},this.range);nt.end+=it,nt.start>=it&&(nt.start-=it),this.currentEntries.forEach(((it,at)=>{const st=at<nt.start||at>nt.end;rt[at]=Object.assign({lazy:st},it),st&&!this.ranging&&(this.ranging=!0)}))}else rt=this.currentEntries.slice(0);return rt}updateRange(nt){if(this.ranging){const rt=[];if(_t.config["show-logos"]&&this.currentEntries.length>this.gridLayoutX*this.gridLayoutY){const it=new RegExp("<img","i"),at=this.currentElements,st=this.wrap.scrollTop,ot=this.getRange(nt);this.debug&&console.warn("UPDATING RANGE",nt,st,ot),ot.forEach(((nt,st)=>{if(!at[nt.tabindex])return;this.debug;const ot=nt.lazy&&at[nt.tabindex].innerHTML.match(it);ot!=at[nt.tabindex].getAttribute("data-lazy")?(at[nt.tabindex].setAttribute("data-lazy",!!ot),rt.push(at[nt.tabindex])):at[nt.tabindex].setAttribute("data-lazy",!1)})),this.wrap.scrollTop=st,_t.emit("menu-update-range",this.range,this.path),rt.length&&(this.debug&&console.log("updateRange",rt,this.range,this.selectedIndex),this.selectedIndex<this.range.start||this.selectedIndex>=this.range.end?this.focus(this.currentElements[this.range.start],!0):this.focus(this.currentElements[this.selectedIndex],!0))}}}delayedFocus(nt){setTimeout((()=>{this.debug&&console.warn("DELAYED FOCUS",nt),this.focus(nt)}),50)}check(nt){this.sounds.play("switch",65);const rt=nt.tabIndex,it=!nt.querySelector(".fa-toggle-on"),at=nt.dataset.path;this.currentEntries[rt].fa="fas fa-toggle-"+(it?"on":"off"),this.currentEntries[rt].value=it,this.debug&&console.warn("NAVCHK",at,it),_t.emit("menu-check",at,it),this.uiUpdate(!1)}setupSelect(nt,rt,it){const at=this.wrap.querySelector('[data-path="'+rt.replaceAll('"',"&quot;")+'"]');if(at&&at.length){const nt=at.querySelector("img");nt&&nt.length&&(nt=window.getComputedStyle(nt).getPropertyValue("background-image"),nt&&(nt=nt.match(new RegExp("url\\(['\"]*([^\\)'\"]*)","i")),nt&&(it=nt[1])))}Array.isArray(nt)&&this.select(rt.split("/").pop(),nt,it,(it=>{if(console.warn("NAVSELECT",rt,nt,it),it){this.debug&&console.warn("NAVSELECT",rt,nt,it);let st=rt+"/"+it;nt.some((nt=>{if(nt.name==it)return nt.path&&(st=nt.path),!0})),_t.emit("menu-open",st),at&&at.setAttribute("data-default-value",it)}this.lastSelectTriggerer&&this.delayedFocus(this.lastSelectTriggerer),this.lastSelectTriggerer=null}))}setupSlider(nt){const rt=nt.getAttribute("data-path"),it=parseInt(nt.getAttribute("data-range-start")||0),at=parseInt(nt.getAttribute("data-range-end")||100),st=nt.getAttribute("data-mask"),ot=this.currentEntries[nt.tabIndex].value||"",lt=nt.getAttribute("data-original-icon")||"",ut=nt.getAttribute("data-question")||nt.getAttribute("title"),ct=nt.getAttribute("data-dialog-details");this.slider(ut,ct,{start:it,end:at},parseInt(ot||0),st,(it=>{const at=nt.tabIndex;!1!==it&&(this.debug&&console.warn("NAVINPUT",rt,it),_t.emit("menu-input",rt,it),this.currentEntries[at]&&(this.currentEntries[at].value=it,this.prepareEntry(this.currentEntries[at],at)),this.uiUpdate(!1)),setTimeout((()=>{console.warn("DELAYED FOCUS ON",at,this.currentElements[at]),this.focus(this.currentElements[at])}),200)}),lt)}open(nt){this.focus(nt);let rt=nt.getAttribute("data-path"),it=nt.getAttribute("data-type"),at=nt.tabIndex||0;if(!this.busy){switch(it){case"back":this.sounds.play("click-out",50);break;case"group":this.sounds.play("click-in",65);break;case"stream":this.sounds.play("warn",80)}"{tabindex}"==at&&(at=!1),"back"==it&&(rt=rt.split("/"),rt.pop(),rt.pop(),rt=rt.join("/")),this.debug&&console.warn("menu-open",rt,it,at||!1),this.emit("open",it,rt,nt,at||!1),"action"==it||"input"==it?_t.emit("menu-action",rt,at||!1):"back"==it?_t.emit("menu-back"):"select"==it?(this.lastSelectTriggerer=nt,_t.emit("menu-select",rt,at||!1)):_t.emit("menu-open",rt,at||!1)}}action(nt){let rt=nt.getAttribute("data-type");switch(console.log("action",rt,nt),rt){case"slider":this.setupSlider(nt);break;case"check":this.check(nt);break;default:"select"==rt&&(this.lastSelectTriggerer=nt),this.open(nt)}return!1}triggerAction(nt,rt){return new Promise(((it,at)=>{let st,ot=0;this.once("render",(lt=>{if(!st)if(clearTimeout(ot),lt==nt){let nt=-1;this.currentEntries.some(((it,at)=>{if(it.name==rt)return nt=at,!0})),-1!=nt?(this.currentElements[nt].click(),it(!0)):at("option not found")}else at("navigation failed")})),_t.emit("menu-open",nt),ot=setTimeout((()=>{st=!0,at("timeout")}),5e3)}))}prepareEntry(nt,rt){return nt.url||(nt.url="javascript:;"),nt.type||(nt.type=(nt.url,"stream")),"back"!=nt.type&&(nt.fa||(this.icons[nt.path]&&this.icons[nt.path].url.startsWith("fa")&&(nt.fa=this.icons[nt.path].url),nt.icon&&nt.icon.startsWith("fa")?nt.fa=nt.icon:this.defaultIcons[nt.type]&&(nt.fa="fas "+this.defaultIcons[nt.type])),nt.fa&&!this.icons[nt.path]&&(this.icons[nt.path]={url:nt.fa})),"check"==nt.type&&(nt.fa="fas fa-toggle-"+(nt.value?"on":"off")),"string"!=typeof nt.statusFlags&&(nt.statusFlags=""),nt.maskText="",nt.mask&&void 0!==nt.value&&("time"===nt.mask?nt.maskText=_t.clock.humanize(nt.value,!0):"boolean"!=typeof nt.value&&(nt.maskText=nt.mask.replace("{0}",nt.value))),nt.rawname&&nt.rawname.includes("[")&&(nt.rawname=this.parseBBCode(nt.rawname)),nt.wrapperClass="entry-wrapper",!nt.side&&this.icons[nt.path]&&this.icons[nt.path].cover&&(_t.config["stretch-logos"]||nt.class&&nt.class.includes("entry-force-cover"))?(nt.cover=!0,nt.wrapperClass+=" entry-cover-active"):(nt.cover&&(nt.cover=!1),nt.wrapperClass.includes("entry-cover-active")&&(nt.wrapperClass=nt.wrapperClass.replace(new RegExp(" *entry-cover-active *","g")," "))),"string"!=typeof nt.prepend&&(nt.prepend=""),nt.key=(nt.path&&" "!=nt.path?nt.path:String(Math.random()))+(nt.url||""),nt}};class OMNIUtils extends EventEmitter$1{constructor(){super(),this.xtraChars=new Set(" -+@!".split(""))}isNumeric(nt){return!!String(nt).match(new RegExp("^[0-9]+$"))}isXtraChar(nt){return this.xtraChars.has(nt)}isLetter(nt){return String(nt).toLowerCase()!=String(nt).toUpperCase()}isNumberOrLetter(nt){return this.isNumeric(nt)||this.isXtraChar(nt)||this.isLetter(nt)}}class OMNI extends OMNIUtils{constructor(){super(),this.opts={omniInterval:1500,autoSubmit:!0},this.omniTimer=0,this.type="",this.typing="",this.defaultValue="",this.element=document.querySelector(".menu-omni"),this.button=document.querySelector(".menu-omni .menu-omni-submit"),this.input=document.querySelector(".menu-omni input"),this.rinput=this.input,this.setup(),this.bind(),document.addEventListener("keyup",this.eventHandler.bind(this))}bind(){_t.on("omni-show",(()=>this.show(!0))),_t.on("omni-hide",(()=>this.hide())),_t.on("omni-callback",((nt,rt)=>{rt?this.save():this.updateIcon("fas fa-times-circle")}))}active(){return null!==this.element.offsetParent}show(nt){_t.menu.sideMenu(!1,"instant"),this.element.style.display="inline-flex",nt&&this.focus(!0)}showPortrait(){document.body.classList.add("portrait-search"),this.focus(!0),this.input.addEventListener("blur",(()=>{document.body.classList.remove("portrait-search")}),{once:!0})}hide(){this.element.style.display="none",_t.menu.reset()}submit(){let nt=this.save();if(nt)return this.typing=nt,this.type=this.isNumeric(nt)?"numeric":"mixed",this.trigger(!0),!0}setup(){this.hide(),this.button.addEventListener("click",(nt=>{this.element.classList.contains("selected")&&this.submit()||this.focus(!0)})),this.element.addEventListener("click",(nt=>{nt.target.tagName&&"i"==nt.target.tagName.toLowerCase()&&this.element.classList.contains("selected")&&this.submit()||this.focus(!0)})),this.input.setAttribute("placeholder",_t.lang.WHAT_TO_WATCH),this.input.addEventListener("keydown",(nt=>{"Enter"===nt.key&&this.submit()}))}focus(nt){this.show(),this.input.value=this.defaultValue,nt&&this.input.select(),_t.menu.focus(this.element),this.input.focus(),this.input.addEventListener("blur",(()=>{_t.menu.focus(_t.menu.currentElements[0]),this.save(),this.hide()}),{once:!0}),nt||(this.rinput.selectionStart=this.rinput.selectionEnd=this.rinput.value.length)}save(){this.updateIcon("fas fa-search");let nt=this.input.value;return nt&&(nt=nt.toLowerCase(),this.defaultValue=nt),nt}validateEvent(nt){if(nt.altKey||nt.ctrlKey||nt.metaKey||nt.shiftKey)console.warn("MODKEY ignored");else if(nt.key&&nt.key.startsWith("Arrow")||["Up","Down","Left","Right"].includes(nt.key)){if(nt.target==this.rinput){switch(nt.key.replace("Arrow","")){case"Right":this.rinput.selectionEnd===this.rinput.value.length&&this.emit("right");break;case"Left":0===this.rinput.selectionStart&&this.emit("left")}this.rinputLastKey=nt.key}}else{if(!nt.target||!nt.target.tagName.match(new RegExp("^(input|textarea)$","i"))||nt.target==this.rinput){if(_t.menu.inModal()){var rt=document.querySelector('#modal-content input[type="text"]');if(rt)return void rt.focus()}return!0}console.warn("INPUT ignored")}}update(){clearTimeout(this.omniTimer),this.typing=this.rinput.value,this.typing.length&&(this.type=this.isNumeric(this.typing)?"numeric":"mixed",this.updateIcon("numeric"==this.type?"fas fa-star":"fas fa-search"),this.opts.autoSubmit&&(this.omniTimer=setTimeout(this.trigger.bind(this),this.opts.omniInterval)))}updateIcon(nt){let rt=this.element.querySelector("i");rt.className.includes(nt)||(rt.outerHTML=`<i class="${nt}"></i>`)}eventHandler(nt){this.validateEvent(nt)&&(nt.target&&nt.target!=this.rinput?nt.key&&1==nt.key.length&&" "!=nt.key&&(this.defaultValue=nt.key,_t.menu.inPlayer()&&!_t.menu.isExploring()&&_t.menu.showWhilePlaying(!0,!0),this.focus(!1),this.update()):this.update())}trigger(nt){if(console.warn("DIALER TRIGGER",this.type,this.typing),this.typing){if("numeric"!=this.type&&1==this.typing.length){let nt=this.typing.toLowerCase(),rt=-1;if("."!=nt&&"*"!=nt)return _t.menu.currentEntries.some(((it,at)=>{if("back"!=it.type)return it.name.charAt(0).toLowerCase()==nt?(rt=at,!0):void 0})),rt<0&&_t.menu.currentEntries.some(((it,at)=>{if("back"!=it.type)return!(it.name.charAt(0).toLowerCase()<nt)||void(rt=at)})),rt<0&&(rt=_t.menu.currentEntries.length-1),void(rt>0&&_t.menu.focus(_t.menu.currentElements[rt]))}_t.emit("omni",this.typing,this.type),this.updateIcon("fas fa-circle-notch fa-spin")}}}class WindowActions extends EventEmitter$1{constructor(){super(),this.backgroundModeLocks=[]}openExternalURL(nt){parent.api?parent.api.openExternal(nt):window.open(nt,"_system")}backgroundModeLock(nt){this.backgroundModeLocks.includes(nt)||this.backgroundModeLocks.push(nt)}backgroundModeUnlock(nt){this.backgroundModeLocks=this.backgroundModeLocks.filter((rt=>rt!=nt))}askExit(){let nt=[{template:"question",text:_t.lang.ASK_EXIT,fa:"fas fa-times-circle"},{template:"option",text:_t.lang.NO,id:"no"},{template:"option",text:_t.lang.YES,id:"yes"}];this.canAutoRestart()&&nt.push({template:"option",text:_t.lang.RESTARTAPP,id:"restart"}),_t.menu.dialog(nt,(nt=>{"yes"==nt?this.exit():"restart"==nt&&this.restart()}),"no")}askRestart(){_t.menu.dialog([{template:"question",text:document.title,fa:"fas fa-info-circle"},{template:"message",text:_t.lang.SHOULD_RESTART},{template:"option",text:"OK",id:"submit",fa:"fas fa-check-circle"},{template:"option",text:_t.lang.RESTART_LATER,id:"back",fa:"fas fa-times-circle"}],(nt=>{"back"==nt?_t.osd.show(_t.lang.SHOULD_RESTART,"fas fa-exclamation-triangle faclr-red","restart","normal"):this.restart()}),"submit")}exitUI(nt){console.log("exitUI()"),void 0!==window.capacitor&&this.setBackgroundMode(!1,!0);try{_t.streamer.stop()}catch(nt){console.error(nt)}_t.localEmit("exit-ui"),nt&&setTimeout(nt,400)}canAutoRestart(){let nt;return(parent.api&&"win32"==parent.api.platform||void 0!==window.capacitor&&window.capacitor&&parseInt(device.version)<10&&"undefined"!=typeof plugins&&plugins.megacubo)&&(nt=!0),nt}restart(){let next=nt=>{if(nt){if("undefined"!=typeof plugins&&plugins.megacubo)return plugins.megacubo.restartApp();if(parent.Manager)return void parent.api.restart()}this.exit()};this.canAutoRestart()?next(!0):_t.menu.dialog([{template:"question",text:document.title,fa:"fas fa-info-circle"},{template:"message",text:_t.lang.SHOULD_RESTART},{template:"option",text:"OK",id:"submit",fa:"fas fa-check-circle"}],next)}exit(nt){console.log("exit("+nt+")"),_t.streamer&&_t.streamer.active&&_t.streamer.stop(),!nt&&this.backgroundModeLocks.length?void 0!==window.capacitor?(this.setBackgroundMode(!0,!0),cordova.plugins.backgroundMode.moveToBackground()):parent.api.tray.goToTray():(window.capacitor&&this.setBackgroundMode(!1,!0),this.exitUI((()=>{_t.emit("exit"),window.capacitor?setTimeout((()=>{window.capacitor.App.exitApp()}),400):parent.Manager.close()})))}}class WinActionsMiniplayer extends WindowActions{constructor(nt){super(),this.main=nt,this.enabled=!0,this.pipSupported=null,this.inPIP=!1}supports(){return!0}set(nt){nt!=this.inPIP&&(nt&&!this.enabled||(console.warn("SET PIP",nt,this.inPIP),this.inPIP=!0===nt||"true"===nt,this.emit(this.inPIP?"enter":"leave")))}toggle(){return console.log("winActions.toggle",this.inPIP),this.inPIP?this.leave():this.enter()}async leave(){return this.set(!1),!0}getDimensions(nt){const rt=window.capacitor?screen:parent.Manager.getScreenSize(nt);let it=Math.min(rt.width,rt.height)/2,at=Math.max(rt.width,rt.height)/3;at<it&&(it=at),it=parseInt(it);let st=window.innerWidth/window.innerHeight;return _t.streamer&&_t.streamer.active&&(st=_t.streamer.activeAspectRatio.h/_t.streamer.activeAspectRatio.v),{width:it,height:parseInt(it/st)}}enterIfPlaying(){if(this.enabled&&this.supports()&&_t.streamer&&(_t.streamer.active||_t.streamer.isTuning()))return this.enter().catch((nt=>console.error("PIP FAILURE",nt))),!0}}class AndroidWinActions extends WinActionsMiniplayer{constructor(nt){super(nt),this.pip=PictureInPicture,this.appPaused=!1,this.setup(),this.on("enter",(()=>{document.body.classList.add("miniplayer-android")})),this.on("leave",(()=>{this.enteredPipTimeMs=!1,console.warn("leaved miniplayer"),document.body.classList.remove("miniplayer-android"),nt.streamer&&nt.streamer.active&&nt.streamer.enterFullScreen(),this.appPaused&&(clearTimeout(this.waitAppResumeTimer),this.waitAppResumeTimer=setTimeout((()=>{this.appPaused&&player.emit("app-pause",!0)}),2e3))}))}supports(){return!0}observePIPLeave(){this.observePIPLeaveTimer&&clearTimeout(this.observePIPLeaveTimer);let nt=2e3;if(this.enteredPipTimeMs){const rt=(new Date).getTime();nt=Math.max(nt,this.enteredPipTimeMs+7e3-rt)}this.observePIPLeaveTimer=setTimeout((()=>{this.seemsPIP()||(console.log("exiting PIP Mode after observing"),this.leave())}),nt),console.log("observing PIP leave",nt,this.inPIP)}setup(){if(this.pip){const stateListener=()=>{setTimeout((()=>{!_t.streamer.active||_t.streamer.isAudio||_t.streamer.casting?this.pip.autoPIP(!1,0,0):this.pip.autoPIP(!0,240*player.videoRatio(),240)}),0)};_t.streamer.on("state",stateListener),_t.streamer.on("cast-start",stateListener),_t.streamer.on("cast-stop",stateListener),_t.streamer.on("codecData",stateListener),player.on("app-pause",(nt=>{if(this.inPIP&&!nt)return;this.appPaused=!0;let rt=this.backgroundModeLocks.length,it=this.backgroundModeLocks.filter((nt=>"schedules"!=nt)).length;console.warn("app-pause",nt,rt,this.inPIP),_t.streamer&&(it||(it=_t.streamer.casting||_t.streamer.isAudio),_t.streamer.casting||_t.streamer.isAudio?rt=!0:nt?it||_t.streamer.stop():this.enterIfPlaying()?(console.warn("app-pause","entered miniplayer"),rt=!1):it||_t.streamer.stop()),rt&&this.setBackgroundMode(!0)})),player.on("app-resume",(()=>{console.warn("app-resume",this.inPIP),this.appPaused=!1,this.setBackgroundMode(!1),this.inPIP&&this.observePIPLeave()}));const listener=()=>{let nt=this.seemsPIP();nt!=this.inPIP&&(console.warn("miniplayer change on resize"),nt?this.set(nt):this.observePIPLeave())};window.addEventListener("resize",listener),window.addEventListener("orientationchange",listener,{capture:!0}),screen.orientation&&screen.orientation.addEventListener("change",listener)}}setBackgroundMode(nt,rt){const it=(new Date).getTime()/1e3;if(this.setBackgroundModeTimer&&clearTimeout(this.setBackgroundModeTimer),rt||!this.lastSetBackgroundMode||it-this.lastSetBackgroundMode>=5)nt!==this.currentBackgroundModeState&&(this.lastSetBackgroundMode=it,this.currentBackgroundModeState=nt,nt?cordova.plugins.backgroundMode.enable():cordova.plugins.backgroundMode.disable());else{const at=1e3*(this.lastSetBackgroundMode+5-it);this.setBackgroundModeTimer=setTimeout((()=>{this.setBackgroundMode(nt,rt)}),at)}}prepare(){return new Promise(((nt,rt)=>{if(this.pip)if("boolean"==typeof this.pipSupported)this.setBackgroundMode(!0),nt(!0);else try{this.pip.isPipModeSupported((it=>{this.pipSupported=it,it?(this.setBackgroundMode(!0),nt(!0)):rt("pip mode not supported")}),(nt=>{console.error(nt),rt("pip not supported: "+String(nt))}))}catch(nt){console.error(nt),rt("PIP error: "+String(nt))}else rt("PIP unavailable")}))}seemsPIP(){return window.innerHeight<screen.height/2}enter(){return new Promise(((nt,rt)=>this.enabled?this.supports()?void this.prepare().then((()=>{console.warn("ABOUT TO PIP",this.inPIP);let it=this.getDimensions();this.pip.enter(it.width,it.height,(it=>{it?(this.enteredPipTimeMs=(new Date).getTime(),console.log("enter: "+String(it)),this.set(!0),nt(it)):(console.error("pip.enter() failed to enter pip mode"),this.set(!1),rt("failed to enter pip mode"))}),(nt=>{this.set(!1),console.error("pip.enter() error",nt),rt(nt)}))})).catch(rt):rt("not supported"):rt("miniplayer disabled")))}}class ElectronWinActions extends WinActionsMiniplayer{constructor(nt){super(nt),this.pip=parent.Manager,this.setup()}setup(){this.pip&&(this.pip.minimizeWindow=()=>{this.pip.miniPlayerActive?(this.pip.prepareLeaveMiniPlayer(),parent.api.window.hide(),parent.api.window.restore(),setTimeout((()=>{parent.api.window.show(),parent.api.window.minimize()}),0)):this.enterIfPlaying()||parent.api.window.minimize()},this.pip.closeWindow=()=>this.exit(),this.pip.on("miniplayer-on",(()=>this.set(!0))),this.pip.on("miniplayer-off",(()=>this.set(!1))),window.addEventListener("resize",(()=>this.resize()),150))}resize(){!1===this.pip.resizeListenerDisabled&&(this.seemsPIP()?this.pip.miniPlayerActive||(this.pip.miniPlayerActive=!0,this.pip.emit("miniplayer-on")):this.pip.miniPlayerActive&&(this.pip.miniPlayerActive=!1,this.pip.emit("miniplayer-off")))}seemsPIP(){let nt=this.getDimensions();return["height","width"].forEach((rt=>nt[rt]=1.5*nt[rt])),window.innerWidth<=nt.width&&window.innerHeight<=nt.height}enter(){return new Promise(((nt,rt)=>{if(!this.enabled)return rt("miniplayer disabled");if(!this.inPIP){let nt=this.getDimensions();this.pip.enterMiniPlayer(nt.width,nt.height),this.set(!0)}nt(!0)}))}leave(){return new Promise(((nt,rt)=>{this.inPIP&&(this.pip.leaveMiniPlayer(),this.set(!1)),nt(!0)}))}}const ws={HOME:[()=>{_t.menu.scrollTop()?_t.menu.scrollTop(0):_t.menu.triggerAction("").catch(console.error)},"up",!0],PLAYPAUSE:[()=>{_t.menu.inPlayer()&&streamer.playOrPause()},"up"],PLAY_PREVIOUS:[()=>{_t.emit("go-prev")},"up"],PLAY_NEXT:[()=>{_t.emit("go-next")},"up"],BACKNOTINPUT:[()=>{_t.hotkeys.escapePressed()},"hold"],BACK:[()=>{},"up",!0],ESCAPE:[()=>{_t.hotkeys.escapePressed()},"up",!0],STOP:[()=>{_t.streamer.stop()},"up",!0],VOLUMEUP:[()=>{_t.streamer.volumeUp(1)},"hols",!0],VOLUMEDOWN:[()=>{_t.streamer.volumeDown(1)},"hold",!0],VOLUMEMUTE:[()=>{_t.streamer.volumeMute()},"up",!0],SEEKREWIND:[()=>{_t.streamer.seekRewind()},"hold",!0],SEEKFORWARD:[()=>{_t.streamer.seekForward()},"hold",!0],NAVUP:[()=>{_t.hotkeys.arrowUpPressed()},"hold",!0],NAVDOWN:[()=>{_t.hotkeys.arrowDownPressed()},"hold",!0],NAVRIGHT:[()=>{_t.hotkeys.arrowRightPressed()},"hold",!1],NAVLEFT:[()=>{_t.hotkeys.arrowLeftPressed()},"hold",!1],NAVENTER:[()=>{_t.hotkeys.enterPressed()},"up"],SEARCH:[()=>{_t.omni.show(),_t.omni.focus()},"up",!0],OPENURL:[()=>{_t.menu.triggerAction(_t.lang.TOOLS,_t.lang.OPEN_URL).catch(console.error)},"up",!0],HISTORY:[()=>{_t.menu.triggerAction(_t.lang.TOOLS,_t.lang.KEEP_WATCHING).catch(console.error)},"up",!0],BOOKMARKS:[()=>{_t.menu.triggerAction(_t.lang.BOOKMARKS).catch(console.error)},"up",!0],LANGUAGE:[()=>{_t.menu.triggerAction(_t.lang.OPTIONS,_t.lang.LANGUAGE).catch(console.error)},"up",!0],BOOKMARK:[()=>{_t.emit("toggle-fav")},"up",!0],DEVTOOLS:[()=>{_t.emit("devtools")},"up",!0],RELOAD:[()=>{streamer.isZapping?_t.emit("zap"):_t.emit("reload-dialog")},"up",!0],MINIPLAYER:[()=>{winActions.toggle().catch(console.error)},"up",!0],RECORDING:[()=>{_t.emit("recording")},"up",!0],ABOUT:[()=>{_t.emit("about")},"up",!0],FULLSCREEN:[()=>{parent.Manager&&(parent.Manager.toggleFullScreen(),window.main.idle.reset&&window.main.idle.reset())},"up",!0]};class HotkeysHandler{constructor(){this.specials={backspace:8,tab:9,enter:13,pause:19,capslock:20,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,"?":191,minus:[189,109],plus:[187,107],pause:19,browserback:166,browserforward:167,browserrefresh:168,browserstop:169,browsersearch:170,browserbookmarks:171,browserhome:172,volumemute:173,volumedown:174,volumeup:175,mediatracknext:176,mediatrackprevious:177,mediastop:178,mediaplaypause:179,mediaselect:181,mediaback:182},this.lists={},this.active=null,this.pressed={},this.isStarted=!1}getKey(nt,rt){var it=nt;rt.ctrl&&(it+="_ctrl"),rt.alt&&(it+="_alt"),rt.shift&&(it+="_shift");var keyMaker=function(nt,rt){return rt&&16!==rt&&17!==rt&&18!==rt&&(nt+="_"+rt),nt};if(Array.isArray(rt.which)){var at=[];return rt.which.forEach((function(nt){at.push(keyMaker(it,nt))})),at}return keyMaker(it,rt.which)}isNumeric(nt){return!!String(nt).match(new RegExp("^[0-9]+$"))}getMaskObject(nt){var rt={};return nt.split("+").forEach((function(nt){"ctrl"===nt||"alt"===nt||"shift"===nt?rt[nt]=!0:rt.which=this.specials[nt]||(this.isNumeric(nt)?nt:nt.toUpperCase().charCodeAt())}),this),rt}checkIsInput(nt){var rt=nt.tagName.toLowerCase(),it=nt.type;return"input"===rt&&["text","password","file","search","range"].indexOf(it)>-1||"textarea"===rt}run(nt,rt){if(this.active){var it={ctrl:rt.ctrlKey,alt:rt.altKey,shift:rt.shiftKey,which:rt.which},at=this.getKey(nt,it),st=this.active[at];if(st){var ot=this.checkIsInput(rt.target),lt=!1;st.forEach((function(nt){ot&&!nt.enableInInput||(lt||(rt.preventDefault(),lt=!0),nt.handler(rt))}))}}}start(nt){if(nt=nt||"default",this.active=this.lists[nt],!this.isStarted)return this.keydownListener=nt=>{this.pressed[nt.which]||this.run("down",nt),this.pressed[nt.which]=!0,this.run("hold",nt)},this.keyupListener=nt=>{this.pressed[nt.which]=!1,this.run("up",nt)},document.addEventListener("keydown",this.keydownListener),document.addEventListener("keyup",this.keyupListener),this.isStarted=!0,this}stop(){return document.removeEventListener("keydown",this.keydownListener),document.removeEventListener("keyup",this.keyupListener),this.isStarted=!1,this}add(nt){if(!nt.mask)throw new Error("this.handler.add: required parameter 'params.mask' is undefined.");if(!nt.handler)throw new Error("this.handler.add: required parameter 'params.handler' is undefined.");var rt=nt.type||"down";return(nt.list?nt.list.replace(/\s+/g,"").split(","):["default"]).forEach((function(it){this.lists[it]||(this.lists[it]={});var at=this.lists[it];nt.mask.toLowerCase().replace(/\s+/g,"").split(",").forEach((function(it){var st=this.getMaskObject(it),ot=this.getKey(rt,st);Array.isArray(ot)||(ot=[ot]),ot.forEach((function(rt){at[rt]||(at[rt]=[]),at[rt].push(nt)}))}),this)}),this),this}remove(nt){if(!nt.mask)throw new Error("this.handler.remove: required parameter 'params.mask' is undefined.");var rt=nt.type||"down";return(nt.list?nt.list.replace(/\s+/g,"").split(","):["default"]).forEach((function(it){if(!this.lists[it])return!0;nt.mask.toLowerCase().replace(/\s+/g,"").split(",").forEach((function(nt){var at=this.getMaskObject(nt),st=this.getKey(rt,at);Array.isArray(st)||(st=[st]),st.forEach((function(nt){delete this.lists[it][nt]}),this)}),this)}),this),this}}class GamepadHandler{constructor(){this.connectedGamepads={},this.lastActionTimes={},this.minInterval=200,this.events={x:[],o:[],up:[],down:[],left:[],right:[]},window.addEventListener("gamepadconnected",(nt=>{console.log("Gamepad connected:",nt.gamepad),this.connectedGamepads[nt.gamepad.index]=nt.gamepad,this.lastActionTimes[nt.gamepad.index]={leftStick:0,rightStick:0,dpadUp:0,dpadDown:0,dpadLeft:0,dpadRight:0,buttonX:0,buttonO:0},this.requestUpdate()})),window.addEventListener("gamepaddisconnected",(nt=>{console.log("Gamepad disconnected:",nt.gamepad),delete this.connectedGamepads[nt.gamepad.index],delete this.lastActionTimes[nt.gamepad.index]}))}requestUpdate(){this.animationFrameId||(this.animationFrameId=window.requestAnimationFrame(this.updateGamepadStatus.bind(this)))}updateGamepadStatus(){if(!Object.keys(this.connectedGamepads))return;const nt=Date.now();for(let rt in this.connectedGamepads){const it=this.connectedGamepads[rt],at=this.lastActionTimes[rt];if(it){const rt=it.buttons[0]||{},st=it.buttons[1]||{};rt.pressed&&this.canEmitEvent(at.buttonX)&&(this.emit("x"),at.buttonX=nt),st.pressed&&this.canEmitEvent(at.buttonO)&&(this.emit("o"),at.buttonO=nt);const ot=it.buttons[12]||{},lt=it.buttons[13]||{},ut=it.buttons[14]||{},ct=it.buttons[15]||{};ot.pressed&&this.canEmitEvent(at.dpadUp)&&(this.emit("up"),at.dpadUp=nt),lt.pressed&&this.canEmitEvent(at.dpadDown)&&(this.emit("down"),at.dpadDown=nt),ut.pressed&&this.canEmitEvent(at.dpadLeft)&&(this.emit("left"),at.dpadLeft=nt),ct.pressed&&this.canEmitEvent(at.dpadRight)&&(this.emit("right"),at.dpadRight=nt);const dt=.5,ht=it.axes[0],pt=it.axes[1];ht<-dt&&this.canEmitEvent(at.leftStick)?(this.emit("left"),at.leftStick=nt):ht>dt&&this.canEmitEvent(at.leftStick)?(this.emit("right"),at.leftStick=nt):pt<-dt&&this.canEmitEvent(at.leftStick)?(this.emit("up"),at.leftStick=nt):pt>dt&&this.canEmitEvent(at.leftStick)&&(this.emit("down"),at.leftStick=nt)}}this.animationFrameId=window.requestAnimationFrame(this.updateGamepadStatus.bind(this))}canEmitEvent(nt){return Date.now()-nt>this.minInterval}on(nt,rt){nt in this.events&&this.events[nt].push(rt)}emit(nt){nt in this.events&&this.events[nt].forEach((nt=>nt()))}}class Hotkeys{constructor(){this.handler=new HotkeysHandler,this.gamepadHandler=new GamepadHandler,this.gamepadHandler.on("up",this.arrowUpPressed.bind(this)),this.gamepadHandler.on("down",this.arrowDownPressed.bind(this)),this.gamepadHandler.on("left",this.arrowLeftPressed.bind(this)),this.gamepadHandler.on("right",this.arrowRightPressed.bind(this)),this.gamepadHandler.on("x",this.enterPressed.bind(this)),this.gamepadHandler.on("o",this.escapePressed.bind(this)),this.shortcuts=[]}create(nt,rt,it,at){let st={type:it||"down",mask:nt=nt.replaceAll(" ",","),enableInInput:!!at,handler:()=>{console.log(nt+" pressed",document.URL),rt.call(window.top)}};return this.handler.add(st),st}start(nt){if(this.end(),"object"==typeof nt){for(let rt in nt)Array.isArray(ws[nt[rt]])&&rt.split(" ").forEach((it=>{let at=ws[nt[rt]].slice(0);at.unshift(it),this.shortcuts.push(this.create.apply(this,at))}));this.handler.start()}else console.error("Error loading hotkey's actions.")}end(){this.handler.stop(),this.shortcuts.forEach((nt=>this.handler.remove(nt)))}getHotkeyAction(nt,rt){if(_t.config.hotkeys){let it="";return Object.keys(_t.config.hotkeys).forEach((rt=>{_t.config.hotkeys[rt]==nt&&(it=rt)})),it?rt?it:" ("+it+")":""}return""}arePlayerControlsVisible(){return window.streamer&&[0,"0","0px"].includes(window.getComputedStyle(_t.streamer.controls).getPropertyValue("bottom"))}escapePressed(){if(console.log("Escape pressed"),_t.menu.inModal())_t.menu.inModalMandatory()||_t.menu.endModal();else{if(_t.omni.active())return _t.omni.hide();if(_t.streamer.casting)return _t.streamer.castUIStop();let nt=_t.menu.inPlayer(),rt=nt&&_t.menu.isExploring();nt&&!rt?"playing"==_t.streamer.state&&this.arePlayerControlsVisible()?(_t.idle.start(),_t.idle.lock(1)):_t.streamer.stop():_t.menu.path?_t.emit("menu-back"):nt?_t.idle.start():_t.menu.inSideMenu()?menu.sideMenu(!1):menu.inModal()||menu.sideMenu(!0)}}arrowUpPressed(nt){let rt=_t.menu.inPlayer(),it=_t.menu.isExploring();_t.menu.inModal()||!rt||it?nt||_t.menu.arrow("up"):!nt&&_t.streamer.isVolumeButtonActive()?_t.streamer.volumeUp(1):(_t.idle.start(),_t.idle.lock(1))}arrowDownPressed(nt){if(!_t.menu.inModal()&&_t.menu.inPlayer())_t.menu.isExploring()?nt||_t.menu.arrow("down"):!nt&&_t.streamer.isVolumeButtonActive()?_t.streamer.volumeDown(1):_t.idle.isIdle?_t.idle.reset():nt?(_t.emit("menu-playing",!0),document.body.classList.add("menu-playing")):nt||_t.menu.arrow("down");else{let rt=_t.menu.selected();rt&&"input"==rt.tagName.toLowerCase()&&rt.id&&"menu-omni-input"==rt.id?_t.menu.focus(_t.menu.currentElements[_t.menu.selectedIndex]):nt||_t.menu.arrow("down")}}arrowRightPressed(nt){let rt=_t.menu.inPlayer(),it=rt&&_t.menu.isExploring();rt&&!it?_t.streamer.isSeeking?_t.streamer.seekForward():_t.idle.isIdle||nt?(_t.streamer.seekForward(),_t.idle.start(),_t.idle.lock(1)):nt||_t.menu.arrow("right"):nt||_t.menu.arrow("right")}arrowLeftPressed(nt){let rt=_t.menu.inPlayer(),it=rt&&_t.menu.isExploring();rt&&!it?_t.streamer.isSeeking?_t.streamer.seekRewind():_t.idle.isIdle||nt?(_t.streamer.seekRewind(),_t.idle.start(),_t.idle.lock(1)):nt||_t.menu.arrow("left"):nt||_t.menu.arrow("left")}enterPressed(){if(console.log("ENTER PRESSED",_t.menu.inPlayer(),_t.menu.isExploring(),this.arePlayerControlsVisible(),document.activeElement,_t.streamer.active,_t.idle.isIdle,document.body.className.indexOf("idle")),_t.menu.inPlayer()){let nt=_t.menu.selected(!1);if(nt&&_t.idle.isIdle&&"paused"!=_t.streamer.state)return console.log("ENTER IGNORED ON IDLE OUT",nt),_t.idle.reset()}}}class Clock{constructor(nt){this.element=nt,this.update();let rt=61-(new Date).getSeconds();setTimeout((()=>{setInterval(this.update.bind(this),6e4),this.update()}),1e3*rt)}update(){this.element.innerText=moment().format("LT")}humanize(nt,rt){const it=moment.duration(nt,"seconds"),at=it.days(),st=it.hours(),ot=it.minutes(),lt=it.seconds();let ut="";return 1==at?ut+=_t.lang.X_DAY.format(at)+", ":at>1&&(ut+=_t.lang.X_DAYS.format(at)+", "),1==st?ut+=_t.lang.X_HOUR.format(st)+", ":st>1&&(ut+=_t.lang.X_HOURS.format(st)+", "),1==ot?ut+=_t.lang.X_MINUTE.format(ot)+", ":ot>1&&(ut+=_t.lang.X_MINUTES.format(ot)+", "),1==lt?ut+=_t.lang.X_SECOND.format(lt)+", ":lt>1?ut+=_t.lang.X_SECONDS.format(lt)+", ":ut||(ut=rt?_t.lang.DISABLED:_t.lang.X_SECONDS.format(lt)),ut=ut.replace(/,\s*$/,""),ut}}const Ls={points:{x:{start:0,end:0},y:{start:0,end:0}},add:function(nt,rt,it){it=Object.assign({diagonal:!0,horizontal:!0,vertical:!0,swipeDistance:100},it),nt.addEventListener("touchstart",(function(nt){Ls.points.x.start=nt.changedTouches[0].clientX,Ls.points.y.start=nt.changedTouches[0].clientY}),!1),nt.addEventListener("touchend",(function(at){Ls.points.x.end=at.changedTouches[0].clientX,Ls.points.y.end=at.changedTouches[0].clientY,Ls.calculateSwipes(nt,rt,it)}),!1),nt.addEventListener("mousedown",(function(nt){Ls.points.x.start=nt.clientX,Ls.points.y.start=nt.clientY}),!1),nt.addEventListener("mouseup",(function(at){Ls.points.x.end=at.clientX,Ls.points.y.end=at.clientY,Ls.calculateSwipes(nt,rt,it)}),!1)},calculateSwipes:function(nt,rt,it){let at=Ls.points.x.start-Ls.points.x.end,st=Ls.points.y.start-Ls.points.y.end;(Math.abs(at)>it.swipeDistance||Math.abs(st)>it.swipeDistance)&&(it.diagonal&&Math.abs(at)>it.swipeDistance&&Math.abs(st)>it.swipeDistance?rt({swipeLength:Math.sqrt(Math.pow(at,2)+Math.pow(st,2)),direction:(st>0?"up":"down")+"-"+(at>0?"left":"right"),target:nt}):it.horizontal&&Math.abs(at)>it.swipeDistance?rt({swipeLength:Math.abs(at),direction:at>0?"left":"right",target:nt}):it.vertical&&Math.abs(st)>it.swipeDistance&&rt({swipeLength:Math.abs(st),direction:st>0?"up":"down",target:nt}))}};class FFmpegController{constructor(nt){this.master=nt,this.debug=!1,this.executionIds={}}bind(){_t.on("ffmpeg-exec",this.exec.bind(this)),_t.on("ffmpeg-abort",this.abort.bind(this)),_t.on("ffmpeg-exit",this.exit.bind(this)),window.addEventListener("beforeunload",(()=>this.exit())),window.addEventListener("unload",(()=>this.exit()))}trimErrorMessage(nt){return String(nt).split("\n").map((nt=>nt.trim())).filter((nt=>nt.length>2)).slice(-2).join("\n")}exec(nt,rt,it){this.debug&&console.log("ffmpeg.exec",nt,rt),this.master.exec(rt,(at=>{this.debug&&console.log("ffmpeg.exec returned",rt,at);let st=at.indexOf("-");if(-1!=st){let rt=at.substr(0,st),ot=at.substr(st+1);if("start"==rt){let rt=parseInt(ot);this.executionIds[nt]&&"kill"==this.executionIds[nt]?(delete this.executionIds[nt],this._abort(rt)):this.executionIds[nt]=rt}else"metadata"==rt?_t.emit("ffmpeg-metadata-"+nt,ot):(delete this.executionIds[nt],it&&(ot=this.trimErrorMessage(ot)),_t.emit("ffmpeg-callback-"+nt,null,ot))}else delete this.executionIds[nt],console.error("ffmpeg.exec badly formatted response",rt.join(" "),at),it&&(at=this.trimErrorMessage(at)),_t.emit("ffmpeg-callback-"+nt,at||"error","")}),(at=>{console.error("ffmpeg.exec error",rt.join(" "),at),it&&(at=this.trimErrorMessage(at)),_t.emit("ffmpeg-callback-"+nt,at||"error",""),delete this.executionIds[nt]}))}abort(nt){if(this.debug&&console.log("ffmpeg.exec abort "+nt),void 0!==this.executionIds[nt]&&"kill"!=this.executionIds[nt]){let rt=this.executionIds[nt];this._abort(rt)}else this.executionIds[nt]="kill"}cleanup(){this.master.cleanup&&this.master.cleanup("99999")}exit(){this.debug&&console.log("ffmpeg.exec exit"),Object.values(this.executionIds).forEach((nt=>{"kill"!=nt&&this._abort(nt)}))}_abort(nt){this.debug&&console.log("ffmpeg.exec _abort "+nt);let rt=[];Object.keys(this.executionIds).forEach((it=>{this.executionIds[it]==nt?delete this.executionIds[it]:"kill"!=this.executionIds[it]&&rt.push(this.executionIds[it])}));this.master.abort?this.master.abort(nt):this.master.kill(nt)}}var Cs=!1;function configUpdated(){menu.sounds.enabled=_t.config["ui-sounds"];const nt=_t.config["view-size"];if(menu.setGridLayout(nt.landscape.x,nt.landscape.y,nt.portrait.x,nt.portrait.y),function hideBackButton(nt){nt!=Cs&&css((Cs=nt)?' #menu a[data-type="back"] { display: none; } ':" ","hide-back-button")}(_t.config["hide-back-button"]),void 0!==window.winActions&&window.winActions&&(window.winActions.enabled=_t.config["miniplayer-auto"],!window.capacitor&&(parent.Manager.fsapi=!!_t.config.fsapi,!window.configReceived)))switch(window.configReceived=!0,_t.config["startup-window"]){case"fullscreen":parent.Manager&&parent.Manager.setFullScreen&&parent.Manager.setFullScreen(!0);break;case"miniplayer":window.winActions.enter()}}function handleSwipe(nt){if(_t.menu.inModal())return;console.log("swipey",nt);let rt,it=innerHeight>innerWidth?"portrait":"landscape",at=["up","down"].includes(nt.direction)?innerHeight:innerWidth;switch(nt.direction){case"left":case"right":rt=at/("portrait"==it?2:3);break;case"up":case"down":rt=at/("portrait"==it?3:2)}if(rt&&nt.swipeLength>=rt){let it=Math.round((nt.swipeLength-rt)/rt);switch(it<1&&(it=1),console.log("SWIPE WEIGHT",it),nt.direction){case"left":_t.menu.inPlayer()&&!_t.menu.isExploring()&&_t.hotkeys.arrowRightPressed(!0);break;case"right":_t.menu.inPlayer()&&!_t.menu.isExploring()&&_t.hotkeys.arrowLeftPressed(!0);break;case"up":_t.menu.inPlayer()&&(_t.menu.isExploring()||_t.hotkeys.arrowDownPressed(!0));break;case"down":_t.menu.inPlayer()&&(_t.menu.isExploring()?_t.menu.wrap.scrollTop||(_t.menu.emit("menu-playing",!0),document.body.classList.remove("menu-playing")):_t.hotkeys.arrowUpPressed(!1))}}}window.handleOpenURL=nt=>{setTimeout((function(){nt&&nt.match("^[a-z]*:?//")&&_t.waitMain((()=>{channel.post("message",["open-url",nt.replace(new RegExp(".*megacubo.tv/(w|assistir)/",""),"mega://")])}))}),0)};const getFontList=()=>((()=>{if("function"!=typeof window.isFontAvailable){var nt,rt=document.body||document.querySelector("body"),it=document.createElement("span");it.innerHTML=Array(100).join("wi"),it.style.cssText=["position:absolute","width:auto","font-size:128px","left:-99999px"].join(" !important;");var getWidth=at=>(it.style.fontFamily=at.split(",").map((nt=>"'"+nt.trim()+"'")).join(","),rt.appendChild(it),nt=it.clientWidth,rt.removeChild(it),nt),at=getWidth("monospace"),st=getWidth("serif"),ot=getWidth("sans-serif");window.isFontAvailable=nt=>at!==getWidth(nt+",monospace")||ot!==getWidth(nt+",sans-serif")||st!==getWidth(nt+",serif")}})(),["-apple-system","Arial","BlinkMacSystemFont","Calibri","Cantarell","Century Gothic","Comic Sans","Consolas","Courier","Dejavu Sans","Dejavu Serif","Futura","Georgia","Gill Sans","Gotham","Helvetica","Helvetica Neue","Impact","Lato","Lucida Sans","Myriad Pro","Netflix Sans","Open Sans","Oxygen-Sans","Palatino","Roboto","Segoe UI","sans-serif","Tahoma","Times New Roman","Trebuchet","Ubuntu","Verdana","Zapfino"].filter(isFontAvailable)),initApp=()=>{_t.css=css,window.main=_t,_t.on("clipboard-write",((nt,rt)=>{top.navigator.clipboard?top.navigator.clipboard.writeText(nt).then((()=>{rt&&_t.osd.show(rt,"fas fa-check-circle faclr-green","clipboard","normal")})).catch((nt=>{_t.osd.show(String(nt.message||nt),"fas fa-exclamation-triangle faclr-red","clipboard","normal")})):_t.osd.show("Your webview doesn't supports copying to clipboard.","fas fa-exclamation-triangle faclr-red","clipboard","normal")})),_t.on("open-external-url",(nt=>winActions.openExternalURL(nt))),_t.on("open-external-file",((nt,rt)=>function openExternalFile(nt,rt){console.log("openExternalFile",nt),window.capacitor?alert("Cannot open file: "+nt.split("/").pop()):parent.api?parent.api.openExternal(nt):window.open(nt,"_system")}(nt))),_t.on("load-js",(nt=>{console.warn("LOADJS "+nt);var rt=document.createElement("script");rt.src=nt,rt.async=!0,document.querySelector("head, body").appendChild(rt)})),_t.on("call-js",(nt=>{console.log("CALLJS");const rt=document.createElement("script"),it=document.querySelector("head, body");rt.textContent=nt,it.appendChild(rt),setTimeout((()=>it.removeChild(rt)),100)})),_t.on("download",(async(nt,rt)=>{if(console.log("download",nt,rt),window.capacitor)await capacitor.NativeFileDownloader.scheduleFileDownload({url:nt,fileName:rt});else{let it=document.createElement("a");it.setAttribute("href",nt),it.setAttribute("download",rt),it.style.display="none",document.body.appendChild(it),it.click(),document.body.removeChild(it)}})),_t.on("config",configUpdated),_t.on("fontlist",(()=>_t.emit("fontlist",getFontList()))),_t.on("css",((nt,rt)=>_t.css(nt,rt))),console.log("load app"),menu=new Is(document.querySelector("#menu")),_t.menu=menu,console.log("load app"),_t.on("sound",((nt,rt)=>menu.sounds.play(nt,rt))),menu.on("render",(nt=>{menu.lastNavPath!==nt&&(menu.lastNavPath=nt,menu.sideMenu(!1,"instant")),nt?document.body.classList.contains("home")&&document.body.classList.remove("home"):document.body.classList.add("home"),setTimeout((()=>{"function"==typeof verticalArrowsUpdate&&verticalArrowsUpdate()}),0)})),console.log("load app"),configUpdated(_t.config),[{level:"default",selector:"#menu wrap a, .menu-omni, body.video #menu-playing-close",condition:()=>menu.isExploring()&&!menu.inSideMenu(),resetSelector:()=>menu.viewportEntries(),default:!0,overScrollAction:(nt,rt)=>{if("up"==nt||"down"==nt){let it=menu.inPlayer();if(console.log("OVERSCROLLACTION",it),!it){let it;if(rt){let at=menu.entries(!0),st=at.indexOf(rt),ot=Math.floor(at.length/menu.gridLayoutX);console.log("OVERSCROLLACTION",nt,at.length,st,ot),"up"==nt?(st+=at.length*ot,it=at[st]?at[st]:at.pop()):(st-=at.length*ot,it=at[st]?at[st]:at.shift())}return it||(it=rt),menu.focus(it),!0}"up"==nt&&menu.showWhilePlaying(!1)}else if("left"==nt&&!menu.inSideMenu()&&!menu.inModal())return menu.sideMenu(!0),setTimeout((()=>menu.reset()),250),!0}},{level:"nav-menu",selector:"body.side-menu #menu nav a",condition:()=>(menu.inPlayer(),menu.inSideMenu()&&!menu.inModal()&&menu.isExploring()),overScrollAction:(nt,rt)=>{if("up"==nt||"down"==nt){let rt=menu.inPlayer();if(console.log("OVERSCROLLACTION",rt),!rt){let rt=Array.from(menu.container.querySelectorAll("entry-nav"))["down"==nt?"shift":"pop"]();return menu.focus(rt),!0}"up"!=nt&&"left"!=nt||menu.showWhilePlaying(!1)}else if("right"==nt)return menu.sideMenu(!1),!0}},{level:"modal",selector:"#modal-content input, #modal-content textarea, #modal-content .button, #modal-content a",condition:()=>menu.inModal()},{level:"player",selector:"controls button",condition:()=>menu.inPlayer()&&!menu.inModal()&&!menu.isExploring(),overScrollAction:nt=>"down"==nt?(menu.showWhilePlaying(!0),!0):"up"==nt?(_t.idle.start(),!0):void 0}].forEach(menu.addSpatialNavigationLayout.bind(menu)),console.log("load app"),menu.start(),console.log("load app"),menu.on("arrow",((nt,rt)=>{menu.sounds.play("menu",7),setTimeout((()=>{"function"==typeof verticalArrowsUpdate&&verticalArrowsUpdate()}),0)})),console.log("load app"),menu.on("prompt-start",menu.reset.bind(menu)),menu.on("ask-start",menu.reset.bind(menu)),console.log("load app"),_t.on("streamer-ready",(()=>{_t.streamer.on("show",menu.reset.bind(menu)),_t.streamer.on("state",(nt=>{"playing"==nt&&menu.modalContainer&&menu.modalContainer.querySelector("#modal-template-option-wait")&&menu.endModal()})),_t.streamer.on("stop",(()=>{menu.modalContainer&&(menu.modalContainer.querySelector("#modal-template-option-wait")||menu.modalContainer.querySelector("#modal-template-option-resume"))&&menu.endModal(),menu.showWhilePlaying(!1),menu.restoreSelection()||menu.reset(),menu.sideMenu(!1,"instant")})),console.log("load app");const nt=window.capacitor?AndroidWinActions:ElectronWinActions;window.winActions=new nt(_t),_t.on("open-file",((nt,rt,it)=>{parent.Manager?parent.Manager.openFile(it,((nt,it)=>_t.emit(rt,nt?null:[it]))):(window.capacitor&&window.winActions&&winActions.backgroundModeLock("open-file"),menu.openFile(nt,rt,it).catch((nt=>{_t.osd.show(String(nt),"fas fa-exclamation-triangle","menu","normal"),_t.emit(rt,null)})).finally((()=>{winActions&&winActions.backgroundModeUnlock("open-file")})))})),_t.on("restart",(()=>winActions&&winActions.restart())),_t.on("ask-exit",(()=>winActions&&winActions.askExit())),_t.on("ask-restart",(()=>winActions&&winActions.askRestart())),_t.on("exit",(nt=>winActions&&winActions.exit(nt))),_t.on("background-mode-lock",(nt=>{player&&winActions&&winActions&&winActions.backgroundModeLock(nt)})),_t.on("background-mode-unlock",(nt=>{player&&winActions&&winActions&&winActions.backgroundModeUnlock(nt)})),window.capacitor?(winActions&&winActions.setBackgroundMode(!0),window.cordova.plugins.backgroundMode.disableBatteryOptimizations(),setTimeout((()=>winActions&&winActions.setBackgroundMode(!1)),5e3),window.cordova.plugins.backgroundMode.setDefaults({title:document.title,text:_t.lang.RUNNING_IN_BACKGROUND||"...",icon:"icon",color:_t.config["background-color"].slice(-6),resume:!0,hidden:!0,silent:!1,allowClose:!0,closeTitle:_t.lang.CLOSE||"X"})):document.body.addEventListener("dblclick",(nt=>{nt.clientY<window.innerHeight/10&&(_t.streamer.toggleFullScreen(),nt.preventDefault(),nt.stopPropagation())})),parent.Manager&&parent.Manager.appLoaded()})),_t.localEmit("menu-ready"),_t.emit("menu-ready"),console.log("load app"),document.querySelector("#menu-playing-close").addEventListener("click",(()=>{menu.showWhilePlaying(!1)})),document.querySelector("div#arrow-down-hint i").addEventListener("click",(()=>{menu.showWhilePlaying(!0)})),console.log("load app"),_t.omni=new OMNI,_t.omni.on("left",(()=>menu.arrow("left"))),_t.omni.on("right",(()=>menu.arrow("right"))),_t.omni.on("down",(()=>menu.arrow("down"))),_t.omni.on("up",(()=>menu.arrow("up"))),menu.on("scroll",(nt=>{menu.debug&&console.log("menu scroll",nt),menu.updateRange(nt),menuLocationShow(),verticalArrowsUpdate()}));var nt=document.querySelector(".menu-location-pagination"),rt=nt.querySelector("span"),it=0,at=!1;const menuLocationShow=st=>{clearTimeout(it),at||(at=!0,nt.style.display="inline-block"),"string"==typeof st&&(rt.innerHTML=st),menu.selectedIndex<2&&(it=setTimeout((()=>{at&&(at=!1,nt.style.display="none")}),5e3))},menuLocationListener=()=>{let nt=menu.selectedIndex+1,rt=menu.currentElements.length;menuLocationShow(" "+nt+"/"+rt)};menu.on("arrow",menuLocationListener),menu.on("focus",menuLocationListener),menu.on("render",menuLocationListener),console.log("load app");var st=document.querySelector("#home-arrows-top"),ot=document.querySelector("#home-arrows-bottom");st.addEventListener("click",(()=>menu.arrow("up"))),ot.addEventListener("click",(()=>menu.arrow("down")));const lt=document.querySelector("#menu wrap"),ut={bottom:null,top:null,timer:0};window.verticalArrowsUpdate=()=>{const nt=menu.currentElements;if(nt.length>menu.gridLayoutX*menu.gridLayoutY){var rt=nt[nt.length-1].offsetTop-lt.scrollTop,it=nt[0].offsetTop-lt.scrollTop;rt>=lt.parentNode.offsetHeight?!0!==ut.bottom&&(ut.bottom=!0,ot.style.opacity="var(--opacity-level-3)"):!1!==ut.bottom&&(ut.bottom=!1,ot.style.opacity=0),it<0?!0!==ut.top&&(ut.top=!0,st.style.opacity="var(--opacity-level-3)"):!1!==ut.top&&(ut.top=!1,st.style.opacity=0)}else ut.top=ut.bottom=!1,st.style.opacity=0,ot.style.opacity=0},console.log("load app"),configUpdated(config),console.log("load app"),_t.hotkeys=new Hotkeys,_t.hotkeys.start(_t.config.hotkeys),_t.on("config",((nt,rt)=>{nt.includes("hotkeys")&&_t.hotkeys.start(rt.hotkeys)})),console.log("load app"),_t.clock=new Clock(document.querySelector(".menu-time time"));var ct=document.querySelector(".side-menu-toggle");window.capacitor?(menu.sideMenu(!1,"instant"),ct.addEventListener("click",(()=>{menu.inSideMenu()||menu.inModal()||menu.sideMenu(!0)}))):(ct.addEventListener("mouseenter",(()=>{menu.inSideMenu()||menu.inModal()||menu.sideMenu(!0)})),lt.addEventListener("mouseenter",(()=>menu.sideMenu(!1)))),console.log("load app"),moment.tz.setDefault(parent.Intl.DateTimeFormat().resolvedOptions().timeZone),_t.lang.locale&&!moment.locales().includes(_t.lang.locale)&&function importMomentLocale(nt,rt){var it=new XMLHttpRequest;it.open("GET","../dist/moment-locale/"+nt+".js",!0),it.onreadystatechange=function(){if(4===it.readyState)if(200===it.status){rt&&setTimeout((()=>rt()),100),window.global=window;var nt=it.responseText.replace(new RegExp("module.export.*="),""),at=document.createElement("script");at.type="text/javascript";try{at.appendChild(document.createTextNode(nt))}catch(rt){at.text=nt}document.head.appendChild(at)}else console.error("Request failed: "+it.statusText)},it.send(null)}(_t.lang.locale,(()=>{moment.locale(_t.lang.locale),_t.clock.update()})),Ls.add(document.body,handleSwipe,{diagonal:!1}),console.log("load app");var dt=0;["mousewheel","DOMMouseScroll"].forEach((nt=>{window.addEventListener(nt,(nt=>{if(!menu.inPlayer()||menu.isExploring())return;let rt=(new Date).getTime();if(rt>dt+200){dt=rt,(nt.wheelDelta||-nt.detail)>0?_t.hotkeys.arrowUpPressed():_t.hotkeys.arrowDownPressed()}}))})),console.log("load app"),_t.on("share",((nt,rt,it)=>{console.log("share",nt,rt,it),window.capacitor?capacitor.Share.share({text:rt,url:it,title:nt}).catch((nt=>{console.error("Share error",nt)})):winActions.openExternalURL("https://megacubo.tv/share/?url="+encodeURIComponent(it)+"&title="+encodeURIComponent(nt)+"&text="+encodeURIComponent(rt))})),_t.idle.on("idle",(()=>{menu.inPlayer()&&!menu.isExploring()&&document.activeElement!=document.body&&document.activeElement.blur()})),_t.menu.wrap.addEventListener("scroll",(()=>_t.idle.reset()));const ht=new FFmpegController(parent.ffmpeg);let pt;window.capacitor||_t.on("ffmpeg-path",((nt,rt)=>{console.log("ffmpeg-path",nt,rt),ht.master.executableDir=ht.executableDir=nt,ht.master.executable=rt})),ht.bind(),console.log("load app"),_t.localEmit("renderer");const wake=()=>{pt||(pt=!0,document.body.classList.remove("nav-hint"))};document.body.addEventListener("keydown",wake,{once:!0}),document.body.addEventListener("touchstart",wake,{once:!0}),setTimeout((()=>{pt||document.body.addEventListener("mousemove",wake,{once:!0})}),4e3),console.log("load app")};if(window.onerror=function(nt,rt,it,at,st){let ot="object"==typeof st&&null!==st&&st.stack?st.stack:traceback();return console.error(st||nt,{errorObj:st,message:nt,file:rt,stack:ot}),!0},window.capacitor){function adjustLayoutForKeyboard(nt){const rt=document.body.querySelector("div#modal > div > div");if(rt){const at=rt.querySelector(".modal-wrap");if(nt){const st=window.innerHeight-nt;if(rt.style.height=st+"px",at&&at.offsetHeight>st){var it=at.querySelector("span.modal-template-question");it&&(it.style.display="none")}}else rt.style.height="100vh",at&&(at.querySelector("span.modal-template-question").style.display="flex")}}capacitor.App.addListener("backButton",(()=>{_t.hotkeys&&_t.hotkeys.escapePressed()})),capacitor.Keyboard.addListener("keyboardWillShow",(function(nt){adjustLayoutForKeyboard(nt.keyboardHeight)})),capacitor.Keyboard.addListener("keyboardWillHide",(function(){adjustLayoutForKeyboard(!1)}))}class Crashlog{constructor(){this.maxAlerts=8}replaceCircular(nt,rt){if(rt=rt||new WeakSet,nt&&"object"==typeof nt){if(rt.has(nt))return"[Circular]";if(nt instanceof Error){var it={};Object.getOwnPropertyNames(value).forEach((nt=>{it[nt]=value[nt]})),nt=it}rt.add(nt);var at=Array.isArray(nt)?[]:{};for(var st in nt)console.error("IDX "+st),at[st]=this.replaceCircular(nt[st],rt);return nt.stack&&(at.stack=this.replaceCircular(nt.stack)),rt.delete(nt),at}return nt}save(nt,rt,it,at){const st=at&&at.stack?at.stack:traceback();main.emit("crash",nt+" "+rt+":"+it+" "+st)}}function get_each_context$1(nt,rt,it){const at=nt.slice();return at[5]=rt[it],at}function get_each_context_1(nt,rt,it){const at=nt.slice();return at[5]=rt[it],at}function create_each_block_1(nt,rt){let it,at,st,ot,lt,ut,ct,dt,ht,pt,_t,Et,St,wt,Lt,Ct,Pt,kt,Ot,Ft=rt[5].prepend+"",Bt=(rt[5].rawname||rt[5].name)+"";return{key:nt,first:null,c(){it=element("a"),at=element("span"),st=element("i"),lt=space(),ut=element("span"),ct=new HtmlTag(!1),dt=space(),ht=new HtmlTag(!1),pt=space(),attr(st,"class",ot=rt[5].fa),ct.a=dt,ht.a=null,attr(at,"class","entry-wrapper"),attr(it,"href",_t=rt[5].url),attr(it,"tabindex",Et=rt[5].tabindex),attr(it,"class","entry entry-nav"),attr(it,"data-type",St=rt[5].type),attr(it,"data-path",wt=rt[5].path),attr(it,"key",Lt=rt[5].key),attr(it,"aria-label",Ct=rt[5].name),attr(it,"data-original-icon",Pt=rt[5].originalIcon),attr(it,"data-question",kt=rt[5].question),attr(it,"data-dialog-details",Ot=rt[5].dialogDetails),attr(it,"draggable","false"),this.first=it},m(nt,rt){insert(nt,it,rt),append(it,at),append(at,st),append(at,lt),append(at,ut),ct.m(Ft,ut),append(ut,dt),ht.m(Bt,ut),append(it,pt)},p(nt,at){rt=nt,2&at&&ot!==(ot=rt[5].fa)&&attr(st,"class",ot),2&at&&Ft!==(Ft=rt[5].prepend+"")&&ct.p(Ft),2&at&&Bt!==(Bt=(rt[5].rawname||rt[5].name)+"")&&ht.p(Bt),2&at&&_t!==(_t=rt[5].url)&&attr(it,"href",_t),2&at&&Et!==(Et=rt[5].tabindex)&&attr(it,"tabindex",Et),2&at&&St!==(St=rt[5].type)&&attr(it,"data-type",St),2&at&&wt!==(wt=rt[5].path)&&attr(it,"data-path",wt),2&at&&Lt!==(Lt=rt[5].key)&&attr(it,"key",Lt),2&at&&Ct!==(Ct=rt[5].name)&&attr(it,"aria-label",Ct),2&at&&Pt!==(Pt=rt[5].originalIcon)&&attr(it,"data-original-icon",Pt),2&at&&kt!==(kt=rt[5].question)&&attr(it,"data-question",kt),2&at&&Ot!==(Ot=rt[5].dialogDetails)&&attr(it,"data-dialog-details",Ot)},d(nt){nt&&detach(it)}}}function create_if_block_4(nt){let rt,it,at;return{c(){rt=element("div"),it=element("img"),src_url_equal(it.src,at=nt[3][nt[5].path].url)||attr(it,"src",at),attr(it,"alt",""),attr(it,"draggable","false"),attr(rt,"class","entry-cover-container"),attr(rt,"aria-hidden","true")},m(nt,at){insert(nt,rt,at),append(rt,it)},p(nt,rt){9&rt&&!src_url_equal(it.src,at=nt[3][nt[5].path].url)&&attr(it,"src",at)},d(nt){nt&&detach(rt)}}}function create_if_block_3(nt){let rt,it;return{c(){rt=element("img"),src_url_equal(rt.src,it=Ds)||attr(rt,"src",it),attr(rt,"draggable","false"),attr(rt,"alt",""),set_style(rt,"background-image","url("+nt[3][nt[5].path].url+")"),attr(rt,"aria-hidden","true")},m(nt,it){insert(nt,rt,it)},p(nt,it){9&it&&set_style(rt,"background-image","url("+nt[3][nt[5].path].url+")")},d(nt){nt&&detach(rt)}}}function create_if_block_2(nt){let rt,it,at;return{c(){rt=element("i"),attr(rt,"class",it=nt[5].fa),attr(rt,"style",at=nt[5].faStyle||""),attr(rt,"aria-hidden","true")},m(nt,it){insert(nt,rt,it)},p(nt,st){1&st&&it!==(it=nt[5].fa)&&attr(rt,"class",it),1&st&&at!==(at=nt[5].faStyle||"")&&attr(rt,"style",at)},d(nt){nt&&detach(rt)}}}function create_each_block$1(nt,rt){let it,at,st,ot,lt,ut,ct,dt,ht,pt,_t,Et,St,wt,Lt,Ct,Pt,kt,Ot,Ft,Bt,Ut,Gt,Ht,jt,Kt,$t,Yt,Wt,Qt,en,nn,an,ln=rt[5].statusFlags+"",hn=rt[5].prepend+"",fn=(rt[5].rawname||rt[5].name)+"",pn=[rt[5].details,rt[5].maskText].filter(func).join(" &middot; ")+"",mn=rt[5].cover&&create_if_block_4(rt);function select_block_type(nt,rt){return 9&rt&&(Pt=null),null==Pt&&(Pt=!(nt[3][nt[5].path]&&"back"!=nt[5].type&&!nt[3][nt[5].path].url.startsWith("fa"))),Pt?create_if_block_2:nt[5].cover?void 0:create_if_block_3}let gn=select_block_type(rt,-1),_n=gn&&gn(rt);return{key:nt,first:null,c(){it=element("a"),at=element("span"),mn&&mn.c(),st=space(),ot=element("span"),lt=element("span"),ut=element("span"),dt=space(),ht=element("span"),pt=new HtmlTag(!1),_t=space(),Et=new HtmlTag(!1),St=space(),wt=element("span"),Lt=space(),Ct=element("span"),_n&&_n.c(),Ot=space(),attr(ut,"class",ct=rt[5].statusFlagsClass),pt.a=_t,Et.a=null,attr(ht,"class","entry-name-label"),attr(lt,"class","entry-name"),attr(wt,"class","entry-details"),attr(ot,"class","entry-data-in"),attr(Ct,"class","entry-icon-image"),attr(at,"class",kt=rt[5].wrapperClass),attr(it,"href",Ft=rt[5].url),attr(it,"tabindex",Bt=rt[5].tabindex),attr(it,"class",Ut=rt[5].class),attr(it,"title",Gt=rt[5].name),attr(it,"aria-label",Ht=rt[5].name),attr(it,"data-type",jt=rt[5].type),attr(it,"data-path",Kt=rt[5].path),attr(it,"key",$t=rt[5].key),attr(it,"draggable","false"),attr(it,"data-range-start",Yt=rt[5].range?rt[5].range.start:0),attr(it,"data-range-end",Wt=rt[5].range?rt[5].range.end:100),attr(it,"data-mask",Qt=rt[5].mask),attr(it,"data-original-icon",en=rt[5].originalIcon),attr(it,"data-question",nn=rt[5].question),attr(it,"data-dialog-details",an=rt[5].dialogDetails),set_style(it,"order",rt[5].tabindex),this.first=it},m(nt,rt){insert(nt,it,rt),append(it,at),mn&&mn.m(at,null),append(at,st),append(at,ot),append(ot,lt),append(lt,ut),ut.innerHTML=ln,append(lt,dt),append(lt,ht),pt.m(hn,ht),append(ht,_t),Et.m(fn,ht),append(ot,St),append(ot,wt),wt.innerHTML=pn,append(at,Lt),append(at,Ct),_n&&_n.m(Ct,null),append(it,Ot)},p(nt,ot){(rt=nt)[5].cover?mn?mn.p(rt,ot):(mn=create_if_block_4(rt),mn.c(),mn.m(at,st)):mn&&(mn.d(1),mn=null),1&ot&&ln!==(ln=rt[5].statusFlags+"")&&(ut.innerHTML=ln),1&ot&&ct!==(ct=rt[5].statusFlagsClass)&&attr(ut,"class",ct),1&ot&&hn!==(hn=rt[5].prepend+"")&&pt.p(hn),1&ot&&fn!==(fn=(rt[5].rawname||rt[5].name)+"")&&Et.p(fn),1&ot&&pn!==(pn=[rt[5].details,rt[5].maskText].filter(func).join(" &middot; ")+"")&&(wt.innerHTML=pn),gn===(gn=select_block_type(rt,ot))&&_n?_n.p(rt,ot):(_n&&_n.d(1),_n=gn&&gn(rt),_n&&(_n.c(),_n.m(Ct,null))),1&ot&&kt!==(kt=rt[5].wrapperClass)&&attr(at,"class",kt),1&ot&&Ft!==(Ft=rt[5].url)&&attr(it,"href",Ft),1&ot&&Bt!==(Bt=rt[5].tabindex)&&attr(it,"tabindex",Bt),1&ot&&Ut!==(Ut=rt[5].class)&&attr(it,"class",Ut),1&ot&&Gt!==(Gt=rt[5].name)&&attr(it,"title",Gt),1&ot&&Ht!==(Ht=rt[5].name)&&attr(it,"aria-label",Ht),1&ot&&jt!==(jt=rt[5].type)&&attr(it,"data-type",jt),1&ot&&Kt!==(Kt=rt[5].path)&&attr(it,"data-path",Kt),1&ot&&$t!==($t=rt[5].key)&&attr(it,"key",$t),1&ot&&Yt!==(Yt=rt[5].range?rt[5].range.start:0)&&attr(it,"data-range-start",Yt),1&ot&&Wt!==(Wt=rt[5].range?rt[5].range.end:100)&&attr(it,"data-range-end",Wt),1&ot&&Qt!==(Qt=rt[5].mask)&&attr(it,"data-mask",Qt),1&ot&&en!==(en=rt[5].originalIcon)&&attr(it,"data-original-icon",en),1&ot&&nn!==(nn=rt[5].question)&&attr(it,"data-question",nn),1&ot&&an!==(an=rt[5].dialogDetails)&&attr(it,"data-dialog-details",an),1&ot&&set_style(it,"order",rt[5].tabindex)},d(nt){nt&&detach(it),mn&&mn.d(),_n&&_n.d()}}}function create_if_block(nt){let rt,it;function select_block_type_1(nt,it){return 24&it&&(rt=null),null==rt&&(rt=!!nt[3][nt[4]].url.startsWith("fa")),rt?create_if_block_1:create_else_block}let at=select_block_type_1(nt,-1),st=at(nt);return{c(){st.c(),it=function empty(){return text("")}()},m(nt,rt){st.m(nt,rt),insert(nt,it,rt)},p(nt,rt){at===(at=select_block_type_1(nt,rt))&&st?st.p(nt,rt):(st.d(1),st=at(nt),st&&(st.c(),st.m(it.parentNode,it)))},d(nt){nt&&detach(it),st.d(nt)}}}function create_else_block(nt){let rt,it;return{c(){rt=element("img"),src_url_equal(rt.src,it=nt[3][nt[4]].url)||attr(rt,"src",it),attr(rt,"alt","")},m(nt,it){insert(nt,rt,it)},p(nt,at){24&at&&!src_url_equal(rt.src,it=nt[3][nt[4]].url)&&attr(rt,"src",it)},d(nt){nt&&detach(rt)}}}function create_if_block_1(nt){let rt,it;return{c(){rt=element("i"),attr(rt,"class",it=nt[3][nt[4]].url),attr(rt,"aria-hidden","true")},m(nt,it){insert(nt,rt,it)},p(nt,at){24&at&&it!==(it=nt[3][nt[4]].url)&&attr(rt,"class",it)},d(nt){nt&&detach(rt)}}}function create_fragment$2(nt){let rt,it,at,st,ot,lt,ut,ct,dt,ht,pt,_t,Et,St,wt,Lt,Ct,Pt,kt,Ot,Ft,Bt,Ut,Gt,Ht,jt,Kt,$t,Yt,Wt,Qt,en,nn,an,ln,hn,fn,pn=[],mn=new Map,gn=[],_n=new Map,vn=nt[4].split("/").pop()+"",En=ensure_array_like(nt[1]);const get_key=nt=>nt[5].key;for(let rt=0;rt<En.length;rt+=1){let it=get_each_context_1(nt,En,rt),at=get_key(it);mn.set(at,pn[rt]=create_each_block_1(at,it))}let Tn=ensure_array_like(nt[0]);const get_key_1=nt=>nt[5].key;for(let rt=0;rt<Tn.length;rt+=1){let it=get_each_context$1(nt,Tn,rt),at=get_key_1(it);_n.set(at,gn[rt]=create_each_block$1(at,it))}let bn=nt[3][nt[4]]&&create_if_block(nt);return{c(){rt=element("a"),it=element("div"),it.innerHTML='<i class="fas fa-times-circle"></i>',st=space(),ot=element("div"),lt=element("span"),ut=element("span"),ct=element("input"),ht=space(),pt=element("div"),pt.innerHTML='<i class="fas fa-search"></i>',_t=space(),Et=element("div"),St=element("nav"),wt=element("div");for(let nt=0;nt<pn.length;nt+=1)pn[nt].c();Lt=space(),Ct=element("div"),Ct.innerHTML='<div><span><img src="assets/images/default_icon_white.png" alt="" style="width: 5vmax; height: 5vmax;"/></span></div>',Pt=space(),kt=element("div"),Ot=element("content"),Ft=element("wrap");for(let nt=0;nt<gn.length;nt+=1)gn[nt].c();Bt=space(),Ut=element("div"),Ut.innerHTML='<div><span id="home-arrows-top"><i class="fas fa-chevron-up"></i></span> <span style="flex-grow: 1;"></span> <span id="home-arrows-bottom"><i class="fas fa-chevron-down"></i></span></div>',Gt=space(),Ht=element("div"),jt=element("span"),Kt=element("span"),$t=element("span"),bn&&bn.c(),Yt=space(),Wt=element("span"),Qt=text(vn),en=space(),nn=element("span"),nn.innerHTML='<i class="fas fa-stream"></i> <span></span>',an=space(),ln=element("span"),ln.innerHTML='<time></time> <span class="menu-busy"><i class="fas fa-mega spin-x-alt" aria-hidden="true"></i></span>',hn=space(),fn=element("div"),fn.innerHTML='<div><div><div id="modal-content"></div></div></div>',attr(rt,"href","#close-menu"),attr(rt,"title",at=nt[2].CLOSE),attr(rt,"id","menu-playing-close"),attr(ct,"type","text"),attr(ct,"id","menu-omni-input"),attr(ct,"placeholder",dt=nt[2].WHAT_TO_WATCH),attr(pt,"class","menu-omni-submit"),attr(ut,"id","menu-search"),attr(lt,"class","menu-omni"),set_style(lt,"flex","1"),attr(Ct,"class","side-menu-toggle"),attr(Et,"class","side-menu-out"),attr(Ut,"id","home-arrows"),attr(Ut,"aria-hidden","true"),attr($t,"class","menu-location-icon"),attr(Wt,"class","menu-location-text"),attr(Kt,"class","menu-location-anchor"),attr(nn,"class","menu-location-pagination"),attr(jt,"class","menu-location"),attr(jt,"aria-hidden","true"),attr(ln,"class","menu-time"),attr(ln,"aria-hidden","true"),attr(Ht,"id","menubar"),attr(kt,"class","content-out"),attr(ot,"id","menu"),attr(fn,"id","modal")},m(nt,at){insert(nt,rt,at),append(rt,it),insert(nt,st,at),insert(nt,ot,at),append(ot,lt),append(lt,ut),append(ut,ct),append(ut,ht),append(ut,pt),append(ot,_t),append(ot,Et),append(Et,St),append(St,wt);for(let nt=0;nt<pn.length;nt+=1)pn[nt]&&pn[nt].m(wt,null);append(St,Lt),append(St,Ct),append(ot,Pt),append(ot,kt),append(kt,Ot),append(Ot,Ft);for(let nt=0;nt<gn.length;nt+=1)gn[nt]&&gn[nt].m(Ft,null);append(kt,Bt),append(kt,Ut),append(kt,Gt),append(kt,Ht),append(Ht,jt),append(jt,Kt),append(Kt,$t),bn&&bn.m($t,null),append(Kt,Yt),append(Kt,Wt),append(Wt,Qt),append(jt,en),append(jt,nn),append(Ht,an),append(Ht,ln),insert(nt,hn,at),insert(nt,fn,at)},p(nt,[it]){4&it&&at!==(at=nt[2].CLOSE)&&attr(rt,"title",at),4&it&&dt!==(dt=nt[2].WHAT_TO_WATCH)&&attr(ct,"placeholder",dt),2&it&&(En=ensure_array_like(nt[1]),pn=update_keyed_each(pn,it,get_key,0,nt,En,mn,wt,destroy_block,create_each_block_1,null,get_each_context_1)),9&it&&(Tn=ensure_array_like(nt[0]),gn=update_keyed_each(gn,it,get_key_1,0,nt,Tn,_n,Ft,destroy_block,create_each_block$1,null,get_each_context$1)),nt[3][nt[4]]?bn?bn.p(nt,it):(bn=create_if_block(nt),bn.c(),bn.m($t,null)):bn&&(bn.d(1),bn=null),16&it&&vn!==(vn=nt[4].split("/").pop()+"")&&function set_data(nt,rt){rt=""+rt,nt.data!==rt&&(nt.data=rt)}(Qt,vn)},i:noop$1,o:noop$1,d(nt){nt&&(detach(rt),detach(st),detach(ot),detach(hn),detach(fn));for(let nt=0;nt<pn.length;nt+=1)pn[nt].d();for(let nt=0;nt<gn.length;nt+=1)gn[nt].d();bn&&bn.d()}}}const Ds="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",func=nt=>nt;function instance$1(nt,rt,it){let at=[],st=[],ot={},lt={},ut="";return(nt=>{const rt=new Crashlog;nt.addEventListener("error",(nt=>(rt.save(nt.message||String(nt),nt.filename,nt.lineno,nt.error),!0)))})(window),onMount((async()=>{_t.on("lang",(()=>{it(2,ot=_t.lang)})),_t.waitMain((()=>{initApp();const nt=document.querySelector("wrap");_t.menu.on("updated",(()=>{it(4,ut=_t.menu.path),it(3,lt=_t.menu.icons);const rt=_t.menu.currentEntries.map((nt=>nt.key));Array.from(nt.getElementsByTagName("a")).forEach((it=>{rt.includes(it.getAttribute("key"))||nt.removeChild(it)})),it(0,at=_t.menu.currentEntries),_t.menu.path||it(1,st=_t.menu.currentEntries.filter((nt=>nt.side)))}))}))})),[at,st,ot,lt,ut]}class Menu extends SvelteComponent{constructor(nt){super(),init(this,nt,instance$1,create_fragment$2,safe_not_equal,{})}}class Speaker{constructor(){this.messages=[],this.voice=null,this.currentMessage=null,this.pumpDelay=250,window.speechSynthesis.addEventListener("voiceschanged",(()=>{this.voice=null}))}prepareText(nt){return this.decoder||(this.decoder=document.createElement("span")),this.decoder.innerHTML=nt.replace(new RegExp("(<([^>]+)>)","gi"),""),this.decoder.innerText}chooseVoice(){if(this.voice)return this.voice;let nt;_t.lang&&_t.lang.locale&&(nt=_t.lang.locale);let rt=window.speechSynthesis.getVoices();if(rt.length){let it=rt.filter((rt=>rt.lang.substr(0,2)==nt));it.length&&(rt=it);let at=rt.filter((nt=>nt.default));return this.voice=at.length?at[0]:rt[0],this.voice}}queue(nt,rt){nt.includes("-sub")||(this.messages=this.messages.filter((rt=>(rt.id==nt&&console.warn("CANCELLING SPEAK",rt),rt.id!=nt))),this.currentMessage&&this.currentMessage.id==nt&&(console.warn("CANCELLING ACTIVE SPEAK",this.currentMessage.text),window.speechSynthesis.cancel(),this.currentMessage=null),this.messages.push({id:nt,text:this.prepareText(rt)}),console.warn("SPEAK MESSAGES",this.messages.slice(0),this.currentMessage),setTimeout((()=>this.pump()),this.pumpDelay))}speak(nt,rt){this.queue(nt,rt)}pump(){if(this.messages.length&&!window.speechSynthesis.speaking){let nt=this.messages.shift();const rt=this.chooseVoice(),it=new SpeechSynthesisUtterance;it.id=nt.id,it.text=nt.text,it.voice=rt,it.addEventListener("boundary",(()=>{(!this.currentMessage||this.currentMessage.id==it.id&&this.currentMessage.text!=it.text)&&(console.warn("CANCELLING ACTIVE SPEAK*",this.currentMessage?this.currentMessage.text:null),window.speechSynthesis.cancel(),setTimeout((()=>this.pump()),this.pumpDelay))})),it.addEventListener("end",(()=>{console.log("SPEAKED",nt.text),this.currentMessage&&this.currentMessage.id==it.id&&this.currentMessage.text==it.text&&(this.currentMessage=null),setTimeout((()=>this.pump()),this.pumpDelay)})),this.currentMessage=nt,window.speechSynthesis.speak(it)}window.speechSynthesis.resume(),this.messages.length&&setTimeout((()=>this.pump()),this.pumpDelay)}}class OSD extends EventEmitter$1{constructor(nt){super(),"string"==typeof nt&&(nt=document.querySelector(nt)),this.root=nt,this.messages=[],this.timers={},_t.on("osd-show",this.show.bind(this)),_t.on("osd-hide",this.hide.bind(this))}show(nt,rt,it,at){document.body.classList.add("osd");const st="osd-entry-"+it;let ot=this.messages.findIndex((nt=>nt.id==st));-1==ot&&(ot=0,this.messages.unshift({classes:["osd-entry"],id:st})),this.messages[ot].text=nt,rt?rt.includes(".")?this.messages[ot].icon='<img src="'+rt+'" style="display: none;" onload="this.style.display=&apos;inline-block&apos;" />':this.messages[ot].icon='<i class="'+rt+'"></i>':this.messages[ot].icon="",void 0!==this.timers[it]&&clearTimeout(this.timers[it]),this.messages[ot].time=this.parseTime(at),-1==this.messages[ot].time?this.timers[it]&&clearTimeout(this.timers[it]):(this.messages[ot].listener=()=>this.hide(it),this.timers[it]=setTimeout(this.messages[ot].listener,this.messages[ot].time)),this.emit("updated"),_t.config["osd-speak"]&&window.speechSynthesis&&(this.speaker||(this.speaker=new Speaker),this.speaker.speak(it,nt))}hide(nt){const rt="osd-entry-"+nt,it=this.messages.findIndex((nt=>nt.id==rt));-1!=it&&(this.messages.splice(it,1),this.messages.length||document.body.classList.remove("osd"),this.emit("updated"))}parseTime(nt){switch(nt){case"short":nt=3e3;break;case"normal":nt=5e3;break;case"long":nt=8e3;break;case"persistent":nt=-1}return parseFloat(nt)}textContent(){return this.messages.map((nt=>nt.text)).join("\r\n")}}function get_each_context(nt,rt,it){const at=nt.slice();return at[2]=rt[it],at}function create_each_block(nt){let rt,it,at,st,ot,lt,ut,ct=nt[2].icon+"",dt=nt[2].text+"";return{c(){rt=element("div"),it=element("div"),at=space(),st=element("div"),ot=element("div"),lt=space(),attr(it,"class","osd-icon"),attr(st,"class","osd-text slide-in-from-left"),attr(rt,"class",ut=nt[2].classes.join(" "))},m(nt,ut){insert(nt,rt,ut),append(rt,it),it.innerHTML=ct,append(rt,at),append(rt,st),append(st,ot),ot.innerHTML=dt,append(rt,lt)},p(nt,at){1&at&&ct!==(ct=nt[2].icon+"")&&(it.innerHTML=ct),1&at&&dt!==(dt=nt[2].text+"")&&(ot.innerHTML=dt),1&at&&ut!==(ut=nt[2].classes.join(" "))&&attr(rt,"class",ut)},d(nt){nt&&detach(rt)}}}function create_fragment$1(nt){let rt,it=ensure_array_like(nt[0]),at=[];for(let rt=0;rt<it.length;rt+=1)at[rt]=create_each_block(get_each_context(nt,it,rt));return{c(){rt=element("div");for(let nt=0;nt<at.length;nt+=1)at[nt].c();attr(rt,"id","osd-root")},m(nt,it){insert(nt,rt,it);for(let nt=0;nt<at.length;nt+=1)at[nt]&&at[nt].m(rt,null)},p(nt,[st]){if(1&st){let ot;for(it=ensure_array_like(nt[0]),ot=0;ot<it.length;ot+=1){const lt=get_each_context(nt,it,ot);at[ot]?at[ot].p(lt,st):(at[ot]=create_each_block(lt),at[ot].c(),at[ot].m(rt,null))}for(;ot<at.length;ot+=1)at[ot].d(1);at.length=it.length}},i:noop$1,o:noop$1,d(nt){nt&&detach(rt),function destroy_each(nt,rt){for(let it=0;it<nt.length;it+=1)nt[it]&&nt[it].d(rt)}(at,nt)}}}function instance(nt,rt,it){let at=[];return console.warn("OSD STEP1"),onMount((async()=>{console.warn("OSD STEP2"),_t.on("display-error",(nt=>{console.error(nt),_t.osd&&_t.osd.show(nt,"fas fa-exclamation-triangle faclr-red","error","normal")})),console.warn("OSD STEP3"),_t.osd=new OSD(document.getElementById("osd-root")),_t.osd.on("updated",(()=>{it(0,at=_t.osd.messages)})),_t.waitMain((()=>{const nt="network-state",updateInternetConnState=()=>{navigator.onLine?(_t.emit("network-state-up"),_t.osd.hide(nt)):(_t.emit("network-state-down"),_t.osd.show(_t.lang.NO_INTERNET_CONNECTION,"fas fa-exclamation-triangle faclr-red",nt,"persistent"))};window.addEventListener("online",updateInternetConnState),window.addEventListener("offline",updateInternetConnState),navigator.onLine||updateInternetConnState()}))})),[at]}class Osd extends SvelteComponent{constructor(nt){super(),init(this,nt,instance,create_fragment$1,safe_not_equal,{})}}function create_fragment(nt){let rt,it,at,st,ot,lt,ut,ct,dt,ht,pt,_t,Et,St,wt;return ut=new Theme({}),dt=new Player({}),_t=new Menu({}),St=new Osd({}),{c(){rt=element("link"),it=space(),at=element("link"),st=space(),ot=element("link"),lt=space(),create_component(ut.$$.fragment),ct=space(),create_component(dt.$$.fragment),ht=space(),pt=element("div"),create_component(_t.$$.fragment),Et=space(),create_component(St.$$.fragment),attr(rt,"rel","stylesheet"),attr(rt,"global",""),attr(rt,"href","./assets/css/all.min.css"),attr(at,"rel","stylesheet"),attr(at,"global",""),attr(at,"href","./assets/icons/icons.css"),attr(ot,"rel","stylesheet"),attr(ot,"href","./dist/renderer.css"),attr(pt,"id","main")},m(nt,Lt){insert(nt,rt,Lt),insert(nt,it,Lt),insert(nt,at,Lt),insert(nt,st,Lt),insert(nt,ot,Lt),insert(nt,lt,Lt),mount_component(ut,nt,Lt),insert(nt,ct,Lt),mount_component(dt,nt,Lt),insert(nt,ht,Lt),insert(nt,pt,Lt),mount_component(_t,pt,null),append(pt,Et),mount_component(St,pt,null),wt=!0},p:noop$1,i(nt){wt||(transition_in(ut.$$.fragment,nt),transition_in(dt.$$.fragment,nt),transition_in(_t.$$.fragment,nt),transition_in(St.$$.fragment,nt),wt=!0)},o(nt){transition_out(ut.$$.fragment,nt),transition_out(dt.$$.fragment,nt),transition_out(_t.$$.fragment,nt),transition_out(St.$$.fragment,nt),wt=!1},d(nt){nt&&(detach(rt),detach(it),detach(at),detach(st),detach(ot),detach(lt),detach(ct),detach(ht),detach(pt)),destroy_component(ut,nt),destroy_component(dt,nt),destroy_component(_t),destroy_component(St)}}}return class App extends SvelteComponent{constructor(nt){super(),init(this,nt,null,create_fragment,safe_not_equal,{})}}}();
